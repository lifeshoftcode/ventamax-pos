const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SaleReportTable-BqR42KvU.js","assets/react-rfUEOKBT.js","assets/@sentry-C9RpjZZ5.js","assets/hoist-non-react-statics-DzxTubvU.js","assets/react-is-CkhetEIG.js","assets/luxon-BWY9yW-5.js","assets/styled-components-BzLUfkZ7.js","assets/shallowequal-DAPzeuxg.js","assets/@emotion-CJOp8bw3.js","assets/fortawesome-bundle-DmAwtW_I.js","assets/prop-types-DRkc8p4u.js","assets/react-to-print-F63qNxNA.js","assets/react-dom-CWvG3IXd.js","assets/scheduler-C323NY8X.js","assets/react-redux-BpD1u4T_.js","assets/use-sync-external-store-Crb5SR0Q.js","assets/firebase-Bi7PrE1-.js","assets/tslib-DMafyLhP.js","assets/idb-BXWtuYvb.js","assets/antd-j42DH-28.js","assets/@ant-design-BOJYnYvx.js","assets/rc-util-C_kT1Pk-.js","assets/@babel-DQaiFHLa.js","assets/throttle-debounce-CUWDS_la.js","assets/classnames-C28gIRGy.js","assets/resize-observer-polyfill-BlcKtro_.js","assets/json2mq-C8mWzkA0.js","assets/string-convert-Bhuo--sE.js","assets/rc-resize-observer-CVw_Y2pA.js","assets/rc-pagination-KA8P55Kf.js","assets/rc-picker-DH5JTmAh.js","assets/dayjs-DQ_OJjfb.js","assets/rc-motion-F1MUgz2i.js","assets/@rc-component-DxyG_Y2B.js","assets/rc-overflow-CaWLhvk3.js","assets/scroll-into-view-if-needed-DzP2pgWD.js","assets/compute-scroll-into-view-DX-5lRff.js","assets/rc-notification-D74cTc8r.js","assets/rc-collapse-BI4JetZt.js","assets/rc-dialog-fBSOMSMf.js","assets/rc-field-form-BUHLZMO7.js","assets/rc-select-DqdyuVBS.js","assets/rc-virtual-list-Qta6jkBc.js","assets/rc-tooltip-CG8TVdPc.js","assets/rc-dropdown-CtvU_cpG.js","assets/rc-menu-DuuJLGul.js","assets/rc-checkbox-BWD1hXIW.js","assets/rc-tabs-Cr99MSui.js","assets/rc-cascader-BLh4hl1a.js","assets/rc-tree-iXRYS6u9.js","assets/rc-segmented-BKWhqiCO.js","assets/rc-input-number-C8RExCFJ.js","assets/rc-input-BrplG3Px.js","assets/rc-slider-Cxg2mE7Z.js","assets/rc-drawer-CImWsfBY.js","assets/rc-image-DZmcFfgd.js","assets/rc-textarea-TypTsaWD.js","assets/rc-mentions-B3qlsLWL.js","assets/rc-progress-CqcvTdp4.js","assets/rc-rate-BgFFP8Cu.js","assets/rc-steps-DaZHkSYD.js","assets/rc-switch-BwrdY8B1.js","assets/rc-table-CTaRmOEq.js","assets/rc-tree-select-BHlP8Nzj.js","assets/copy-to-clipboard-U8AMuClB.js","assets/toggle-selection-DGa8lynz.js","assets/rc-upload-BFAmo5YR.js","assets/react-router-dom-I0lnFv1F.js","assets/react-router-d3h5byfE.js","assets/@remix-run-DFS2GQke.js","assets/@reduxjs-TYVnLVsu.js","assets/immer-C0GRqQ_d.js","assets/redux-Pkr-OV8C.js","assets/redux-thunk-CY0Q9z1Q.js","assets/framer-motion-BahAblW5.js","assets/react-popper-DWMYTNqV.js","assets/@popperjs-CMBiYTiD.js","assets/nanoid-OxPLOBIU.js","assets/yet-another-react-lightbox-CU6vqjhs.js","assets/yet-another-react-lightbox-DGRmvvlk.css","assets/@supabase-kpI-vHkG.js","assets/react-helmet-async-mH61wGUr.js","assets/invariant-BDCZZhhA.js","assets/lodash-Bii6Cmo5.js","assets/libphonenumber-js-BjFIu9YR.js","assets/country-flag-icons-ZZ6o7arK.js","assets/react-zoom-pan-pinch-BsIRrnk0.js","assets/@tanstack-ku59xrFY.js","assets/react-barcode-DYUTUow9.js","assets/jsbarcode-CCImmBHL.js","assets/html2canvas-DadlvMMh.js","assets/jspdf-DA_NNWqC.js","assets/fflate-DRMPHaEN.js","assets/bcryptjs-UwuLHmlE.js","assets/@casl-Dm1p89cb.js","assets/@ucast-BZ_ondnv.js","assets/print-js-BNOJORLg.js","assets/pdfmake-W4Ssq9oK.js","assets/react-chartjs-2-BhKEQuOQ.js","assets/chart.js-B2VU77fl.js","assets/@kurkle-BZxJdD1U.js","assets/lightweight-charts-BFv_P73W.js","assets/fancy-canvas-DqIfKA7H.js","assets/exceljs-DADyeoF6.js","assets/react-markdown-D54YYYhm.js","assets/property-information-CLgGhD1-.js","assets/unist-util-visit-SwKB2sUE.js","assets/unist-util-visit-parents-MnEmTlHn.js","assets/unist-util-is-DiTsIWAy.js","assets/hast-util-whitespace-D1ONPEmv.js","assets/space-separated-tokens-DD3iYX1K.js","assets/comma-separated-tokens-xMQ5YY98.js","assets/style-to-object-DB6SD-wt.js","assets/inline-style-parser-D4u_cg7q.js","assets/unified-Be3qCFGf.js","assets/bail-FqpXQuLt.js","assets/is-buffer-DR4WRMs3.js","assets/extend-DyvUZfS1.js","assets/is-plain-obj-C1gvLhAf.js","assets/trough-BLo6HeTa.js","assets/vfile-DXaTyxVO.js","assets/vfile-message-BOGBuebs.js","assets/unist-util-stringify-position-Ch_qCilz.js","assets/remark-parse-CQxuRO-h.js","assets/mdast-util-from-markdown-CLAsVoWb.js","assets/micromark-CTBPIv-_.js","assets/micromark-util-combine-extensions-Bka6Sc1c.js","assets/micromark-util-chunked-DrRIdSP-.js","assets/micromark-factory-space-x2vfxbz5.js","assets/micromark-util-character-Bcm1tP9o.js","assets/micromark-core-commonmark-AH8VCgT7.js","assets/micromark-util-classify-character-Cq7Fg3xE.js","assets/micromark-util-resolve-all-PQCKh0dx.js","assets/decode-named-character-reference-C3-224fz.js","assets/micromark-util-subtokenize-QwsxNXk2.js","assets/micromark-factory-destination-CypD_wgM.js","assets/micromark-factory-label-CRHH4ZHP.js","assets/micromark-factory-title-B7kCBvC9.js","assets/micromark-factory-whitespace-B322EA6O.js","assets/micromark-util-normalize-identifier-C9ANKk3v.js","assets/micromark-util-html-tag-name-DbKNfynz.js","assets/micromark-util-decode-numeric-character-reference-DRnCnno4.js","assets/micromark-util-decode-string-DJl8Y_PO.js","assets/mdast-util-to-string-C_aolqmU.js","assets/remark-rehype-BJ4RwZvz.js","assets/mdast-util-to-hast-Dxh8Xa5R.js","assets/micromark-util-sanitize-uri-nvkIJkgW.js","assets/unist-util-position-KiAvrw8y.js","assets/trim-lines-D8znQY54.js","assets/mdast-util-definitions-CfSXY7bG.js","assets/unist-util-generated-CMz5gPdA.js","assets/react-resizable-Dks54vAc.js","assets/react-draggable-tQ-U4Cs0.js","assets/clsx-DZfZ8_xD.js","assets/react-resizable-CMKNK2uU.css","assets/browser-image-compression-BgY3rL5_.js","assets/draft-js-DAs_DQPn.js","assets/immutable-DXvhHeRx.js","assets/fbjs-DyKbDm8H.js","assets/ua-parser-js-D66YbI_D.js","assets/setimmediate-Iuu2flFm.js","assets/object-assign-Dw8nQtKq.js","assets/draft-js-Hec2WTOF.css","assets/gsap-THuJE7GK.js","assets/@gsap-BvwWf4K0.js","assets/i18next-CWBR8qAX.js","assets/react-i18next-BuNVbWF_.js","assets/ClientSelectionModal-gClGm238.js","assets/ClientSelectionToolbar-pHIqA2JJ.js","assets/ClientListContainer-BWn2UYBo.js","assets/ClientPaginationBar-DMyZBPQ6.js","assets/Body-BP4WU2vx.js"])))=>i.map(i=>d[i]);
var z1=Object.defineProperty;var U1=(e,n,s)=>n in e?z1(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s;var qc=(e,n,s)=>U1(e,typeof n!="symbol"?n+"":n,s);import{r as m,j as t,a as st}from"./react-rfUEOKBT.js";import{c as W1}from"./react-dom-CWvG3IXd.js";import{i as q1,a as V1,p as G1,g as $x,b as _1,c as H1,d as Q1,e as Y1,f as K1,h as F,u as je,j as Vr,k as Rx,l as le,w as dt,T as ue,q as he,m as Me,n as Ot,o as Te,r as Fo,s as de,t as Se,D as J1,v as te,x as De,y as it,z as uu,A as In,B as Nx,C as Ss,E as Po,F as X1,G as Z1,H as fn,I as Ox,J as Mx,K as eC,L as tC,M as Fx,N as ua}from"./firebase-Bi7PrE1-.js";import{L as Xa,N as nC,B as sC}from"./react-router-dom-I0lnFv1F.js";import{u as D,a as W,s as oC,P as rC}from"./react-redux-BpD1u4T_.js";import{c as Ee,a as Za,b as pu,d as iC,i as aC,e as cC,n as En}from"./@reduxjs-TYVnLVsu.js";import"./hoist-non-react-statics-DzxTubvU.js";import"./react-is-CkhetEIG.js";import{d as We,c as Bx}from"./dayjs-DQ_OJjfb.js";import{D as ce,a as lC}from"./luxon-BWY9yW-5.js";import{q as l,A as qe,W as sn,L as dC}from"./styled-components-BzLUfkZ7.js";import{F as O,f as uC,a as Vc,b as pa,c as Or,d as pC,e as mC,g as Lx,h as Do,i as hC,j as Dp,k as gC,l as fC,m as xC,n as vd,o as zx,p as Ea,q as bC,r as yC,s as vC,t as jC,u as CC,v as $p,w as wC,x as js,y as Gc,z as Rp,A as jd,B as Np,C as SC,D as IC,E as ec,G as Cd,H as EC,I as AC,J as kC,K as TC,L as PC,M as DC,N as $C,O as RC,P as NC,Q as OC,R as Mr,S as MC,T as FC,U as BC,V as LC,W as Zs,X as Ux,Y as tc,Z as zC,_ as Aa,$ as nc,a0 as UC,a1 as WC,a2 as sc,a3 as qC,a4 as Wx,a5 as Op,a6 as VC,a7 as GC,a8 as _C,a9 as HC,aa as Fr,ab as QC,ac as Mp,ad as YC,ae as KC,af as JC,ag as XC,ah as ZC,ai as mu,aj as ew,ak as tw,al as nw,am as sw,an as hu,ao as oc,ap as Gr,aq as qx,ar as An,as as ka,at as Eo,au as gu,av as ow,aw as rw,ax as iw,ay as Vx,az as aw,aA as cw,aB as Gx,aC as lw,aD as dw,aE as uw,aF as _x,aG as pw,aH as mw,aI as hw,aJ as gw,aK as Hx,aL as fw,aM as xw,aN as fu,aO as bw,aP as xu,aQ as bu,aR as Qx,aS as yw,aT as rc,aU as _r,aV as vw,aW as Yx,aX as jw,aY as Cw,aZ as ww,a_ as Hr,a$ as ic,b0 as Sw,b1 as Bo,b2 as Iw,b3 as Ew,b4 as Fp,b5 as Aw,b6 as Kx,b7 as kw,b8 as Tw,b9 as ac,ba as Pw,bb as Dw,bc as $w,bd as Rw,be as Nw,bf as Ow,bg as Mw,bh as Fw,bi as Bw,bj as wd,bk as Lw,bl as zw}from"./fortawesome-bundle-DmAwtW_I.js";import{m as Ie,A as gt}from"./framer-motion-BahAblW5.js";import{B as U,M as Ce,T as eo,a as Xe,b as Oe,D as yt,I as ie,c as Rt,F as M,d as Ne,s as Be,e as Ge,E as Lt,f as Lo,S as He,A as Pt,g as ge,h as V,C as St,i as gn,j as Je,P as to,k as vn,l as Gt,m as Ke,n as Uw,L as Sn,o as Ww,p as kn,R as Wt,q as rt,r as qw,t as Jx,u as Qs,v as Cs,w as Ye,x as Vw,y as Ta,Q as Gw,z as Zt,G as Bp,H as Xx,J as Lp,U as Sd,K as _w}from"./antd-j42DH-28.js";import{B as Tn,ae as $o,A as Id,af as cc,ag as Pa,ah as zp,a4 as ht,a8 as es,ai as Hw,aj as Zx,ak as yu,j as Qr,al as Qw,am as e0,an as lc,ao as Yw,ap as ts,aq as ns,V as no,M as zo,ar as ss,as as Ed,at as vu,au as ma,k as Yr,av as t0,aw as Is,C as Kw,ax as n0,ay as dc,az as s0,aA as Da,aB as $a,aC as o0,o as Kr,aD as Jw,Q as Xw,aE as uc,aF as r0,w as Jn,aG as i0,aH as Zw,D as eS,aI as ha,aJ as a0,aK as tS,aL as nS,aM as sS,aN as oS,aa as rS,y as c0,q as l0,aO as d0,aP as iS,v as aS,aQ as cS,E as lS,aR as u0,aS as dS,aT as Up,aU as uS}from"./@ant-design-BOJYnYvx.js";import{u as ju}from"./react-popper-DWMYTNqV.js";import{a as Fe,b as _t,e as vt,O as pc,f as so,g as pS,h as Wp}from"./react-router-d3h5byfE.js";import{n as be}from"./nanoid-OxPLOBIU.js";import{L as mc,Z as hc,T as gc,C as fc}from"./yet-another-react-lightbox-CU6vqjhs.js";import{_ as ks,c as mS}from"./@supabase-kpI-vHkG.js";import{H as p0,a as hS}from"./react-helmet-async-mH61wGUr.js";import{l as ga,_ as gS,d as Cu}from"./lodash-Bii6Cmo5.js";import{g as Br,i as fS,p as m0,a as xS}from"./libphonenumber-js-BjFIu9YR.js";import{f as bS}from"./country-flag-icons-ZZ6o7arK.js";import{T as yS,a as vS}from"./react-zoom-pan-pinch-BsIRrnk0.js";import{u as h0,a as Uo,b as jS,Q as CS,c as wS}from"./@tanstack-ku59xrFY.js";import{B as g0}from"./react-barcode-DYUTUow9.js";import SS from"./html2canvas-DadlvMMh.js";import{E as wu}from"./jspdf-DA_NNWqC.js";import{b as Wo}from"./bcryptjs-UwuLHmlE.js";import{A as qo,P as oo}from"./@casl-Dm1p89cb.js";import{l as Vo}from"./react-to-print-F63qNxNA.js";import{P as we}from"./prop-types-DRkc8p4u.js";import{p as f0}from"./print-js-BNOJORLg.js";import{p as x0,a as IS}from"./pdfmake-W4Ssq9oK.js";import{B as jt,L as Jr}from"./react-chartjs-2-BhKEQuOQ.js";import{C as pt,a as It,b as Et,c as on,p as At,P as Xr,d as Zr,e as ei,f as ti}from"./chart.js-B2VU77fl.js";import{N as ES,P as AS}from"./lightweight-charts-BFv_P73W.js";import{s as kS}from"./@sentry-C9RpjZZ5.js";import{E as xc}from"./exceljs-DADyeoF6.js";import{R as TS}from"./react-markdown-D54YYYhm.js";import"./react-resizable-Dks54vAc.js";import{i as Ad}from"./browser-image-compression-BgY3rL5_.js";import{D as mn}from"./draft-js-DAs_DQPn.js";import{g as b0,S as y0}from"./gsap-THuJE7GK.js";import{u as PS}from"./@gsap-BvwWf4K0.js";import{i as v0}from"./i18next-CWBR8qAX.js";import{i as DS,I as $S}from"./react-i18next-BuNVbWF_.js";import"./scheduler-C323NY8X.js";import"./tslib-DMafyLhP.js";import"./idb-BXWtuYvb.js";import"./@remix-run-DFS2GQke.js";import"./use-sync-external-store-Crb5SR0Q.js";import"./immer-C0GRqQ_d.js";import"./redux-Pkr-OV8C.js";import"./@babel-DQaiFHLa.js";import"./redux-thunk-CY0Q9z1Q.js";import"./shallowequal-DAPzeuxg.js";import"./@emotion-CJOp8bw3.js";import"./rc-util-C_kT1Pk-.js";import"./classnames-C28gIRGy.js";import"./rc-resize-observer-CVw_Y2pA.js";import"./resize-observer-polyfill-BlcKtro_.js";import"./rc-pagination-KA8P55Kf.js";import"./rc-picker-DH5JTmAh.js";import"./rc-motion-F1MUgz2i.js";import"./@rc-component-DxyG_Y2B.js";import"./rc-overflow-CaWLhvk3.js";import"./scroll-into-view-if-needed-DzP2pgWD.js";import"./compute-scroll-into-view-DX-5lRff.js";import"./rc-notification-D74cTc8r.js";import"./rc-collapse-BI4JetZt.js";import"./rc-dialog-fBSOMSMf.js";import"./rc-field-form-BUHLZMO7.js";import"./rc-select-DqdyuVBS.js";import"./rc-virtual-list-Qta6jkBc.js";import"./rc-tooltip-CG8TVdPc.js";import"./rc-dropdown-CtvU_cpG.js";import"./rc-menu-DuuJLGul.js";import"./rc-checkbox-BWD1hXIW.js";import"./rc-tabs-Cr99MSui.js";import"./rc-cascader-BLh4hl1a.js";import"./rc-tree-iXRYS6u9.js";import"./rc-segmented-BKWhqiCO.js";import"./rc-input-number-C8RExCFJ.js";import"./rc-input-BrplG3Px.js";import"./rc-slider-Cxg2mE7Z.js";import"./rc-drawer-CImWsfBY.js";import"./rc-image-DZmcFfgd.js";import"./rc-textarea-TypTsaWD.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-mentions-B3qlsLWL.js";import"./rc-progress-CqcvTdp4.js";import"./rc-rate-BgFFP8Cu.js";import"./rc-steps-DaZHkSYD.js";import"./rc-switch-BwrdY8B1.js";import"./rc-table-CTaRmOEq.js";import"./rc-tree-select-BHlP8Nzj.js";import"./copy-to-clipboard-U8AMuClB.js";import"./toggle-selection-DGa8lynz.js";import"./rc-upload-BFAmo5YR.js";import"./json2mq-C8mWzkA0.js";import"./string-convert-Bhuo--sE.js";import"./@popperjs-CMBiYTiD.js";import"./invariant-BDCZZhhA.js";import"./jsbarcode-CCImmBHL.js";import"./fflate-DRMPHaEN.js";import"./@ucast-BZ_ondnv.js";import"./@kurkle-BZxJdD1U.js";import"./fancy-canvas-DqIfKA7H.js";import"./property-information-CLgGhD1-.js";import"./unist-util-visit-SwKB2sUE.js";import"./unist-util-visit-parents-MnEmTlHn.js";import"./unist-util-is-DiTsIWAy.js";import"./hast-util-whitespace-D1ONPEmv.js";import"./space-separated-tokens-DD3iYX1K.js";import"./comma-separated-tokens-xMQ5YY98.js";import"./style-to-object-DB6SD-wt.js";import"./inline-style-parser-D4u_cg7q.js";import"./unified-Be3qCFGf.js";import"./bail-FqpXQuLt.js";import"./is-buffer-DR4WRMs3.js";import"./extend-DyvUZfS1.js";import"./is-plain-obj-C1gvLhAf.js";import"./trough-BLo6HeTa.js";import"./vfile-DXaTyxVO.js";import"./vfile-message-BOGBuebs.js";import"./unist-util-stringify-position-Ch_qCilz.js";import"./remark-parse-CQxuRO-h.js";import"./mdast-util-from-markdown-CLAsVoWb.js";import"./micromark-CTBPIv-_.js";import"./micromark-util-combine-extensions-Bka6Sc1c.js";import"./micromark-util-chunked-DrRIdSP-.js";import"./micromark-factory-space-x2vfxbz5.js";import"./micromark-util-character-Bcm1tP9o.js";import"./micromark-core-commonmark-AH8VCgT7.js";import"./micromark-util-classify-character-Cq7Fg3xE.js";import"./micromark-util-resolve-all-PQCKh0dx.js";import"./decode-named-character-reference-C3-224fz.js";import"./micromark-util-subtokenize-QwsxNXk2.js";import"./micromark-factory-destination-CypD_wgM.js";import"./micromark-factory-label-CRHH4ZHP.js";import"./micromark-factory-title-B7kCBvC9.js";import"./micromark-factory-whitespace-B322EA6O.js";import"./micromark-util-normalize-identifier-C9ANKk3v.js";import"./micromark-util-html-tag-name-DbKNfynz.js";import"./micromark-util-decode-numeric-character-reference-DRnCnno4.js";import"./micromark-util-decode-string-DJl8Y_PO.js";import"./mdast-util-to-string-C_aolqmU.js";import"./remark-rehype-BJ4RwZvz.js";import"./mdast-util-to-hast-Dxh8Xa5R.js";import"./micromark-util-sanitize-uri-nvkIJkgW.js";import"./unist-util-position-KiAvrw8y.js";import"./trim-lines-D8znQY54.js";import"./mdast-util-definitions-CfSXY7bG.js";import"./unist-util-generated-CMz5gPdA.js";import"./react-draggable-tQ-U4Cs0.js";import"./clsx-DZfZ8_xD.js";import"./immutable-DXvhHeRx.js";import"./fbjs-DyKbDm8H.js";import"./ua-parser-js-D66YbI_D.js";import"./setimmediate-Iuu2flFm.js";import"./object-assign-Dw8nQtKq.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const RS={apiKey:"AIzaSyCT-2T9BUy2w0XmdffWWLRvorMWsxpUK2w",authDomain:"ventamaxpos.firebaseapp.com",projectId:"ventamaxpos",storageBucket:"ventamaxpos.appspot.com",messagingSenderId:"451664861927",appId:"1:451664861927:web:fa43a82fe4125a57312042",measurementId:"G-P66Z0ETD2Y"},ni=q1(RS),$=V1(ni,{localCache:G1({tabManager:K1()})}),Ts=$x(ni);_1(ni);const j0=H1(ni),NS=Q1(ni);Y1(NS,{model:"gemini-2.5-flash-preview-04-17"});const OS=async e=>{const n=F($,"products","6dssod");try{await je(n,{ingredientList:Vr(e)})}catch{}},MS=async e=>{const n=F($,"products","6dssod");try{await je(n,{ingredientList:Rx(e)})}catch{}},FS={user:!1,originalBusinessId:null,originalRole:null},C0=Ee({name:"user",initialState:FS,reducers:{login:(e,n)=>{e.user={...e.user,...n.payload}},addUserData:(e,n)=>{e.user&&(e.user={...e.user,...n.payload})},logout:e=>{e.user=null,e.originalBusinessId=null,e.originalRole=null},switchToBusiness:(e,n)=>{e.user&&(e.originalBusinessId||(e.originalBusinessId=e.user.businessID),e.user.businessID=n.payload)},returnToOriginalBusiness:e=>{e.user&&e.originalBusinessId&&(e.user.businessID=e.originalBusinessId,e.originalBusinessId=null)},switchToRole:(e,n)=>{e.user&&(e.originalRole||(e.originalRole=e.user.role),e.user.role=n.payload)},returnToOriginalRole:e=>{e.user&&e.originalRole&&(e.user.role=e.originalRole,e.originalRole=null)}}}),{login:bc,logout:Kn,addUserData:BS,switchToBusiness:qp,returnToOriginalBusiness:kd,switchToRole:Vp,returnToOriginalRole:Gp}=C0.actions,q=e=>e.user.user,Su=e=>!!e.user.originalBusinessId,LS=e=>e.user.originalBusinessId,zS=e=>!!e.user.originalRole,US=e=>e.user.originalRole,WS=C0.reducer,qS={status:!1,userPreference:{view:{imageHidden:!0,rowMode:!1,categoryGrouped:!1}},system:{isConnected:void 0,fullScreen:!1}},w0=Ee({name:"setting",initialState:qS,reducers:{handleImageHidden:e=>{let n=e.userPreference.view.imageHidden;localStorage.setItem("viewProductImageDisabled",JSON.stringify(!n));let s=localStorage.getItem("viewProductImageDisabled");e.userPreference.view.imageHidden=JSON.parse(s)},ReloadImageHiddenSetting:e=>{let n=localStorage.getItem("viewProductImageDisabled");e.userPreference.view.imageHidden=JSON.parse(n);let s=localStorage.getItem("viewProductRowMode");e.userPreference.view.rowMode=JSON.parse(s);let o=localStorage.getItem("viewProductCategoryGrouped");e.userPreference.view.categoryGrouped=JSON.parse(o)},handleRowMode:e=>{let n=e.userPreference.view.rowMode;localStorage.setItem("viewProductRowMode",JSON.stringify(!n));let s=localStorage.getItem("viewProductRowMode");e.userPreference.view.rowMode=JSON.parse(s)},toggleCategoryGrouped:e=>{let n=e.userPreference.view.categoryGrouped;localStorage.setItem("viewProductCategoryGrouped",JSON.stringify(!n));let s=localStorage.getItem("viewProductCategoryGrouped");e.userPreference.view.categoryGrouped=JSON.parse(s)},toggleFullScreen:e=>{let n=e.system.fullScreen;e.system.fullScreen=!n},isConnected:()=>{}}}),{ReloadImageHiddenSetting:VS,toggleFullScreen:GS}=w0.actions,S0=e=>e.setting.userPreference.view.categoryGrouped,_S=e=>e.setting.userPreference.view.imageHidden,HS=e=>e.setting.userPreference.view.rowMode,I0=e=>e.setting.system.fullScreen,QS=w0.reducer,Iu=()=>{const[e,n]=m.useState(navigator.onLine);return m.useEffect(()=>{const s=()=>n(!0),o=()=>n(!1);return window.addEventListener("online",s),window.addEventListener("offline",o),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",o)}},[]),e};function YS(){const e=D(I0);m.useEffect(()=>{e?document.documentElement.requestFullscreen():document.fullscreenElement&&document.exitFullscreen()},[e])}class KS extends Error{constructor(n){super(n),this.name="UserValidationError"}}const yc=e=>{if(!e||!(e!=null&&e.businessID))return new KS("User is not valid")},JS=[{name:"CONSUMIDOR FINAL",type:"B",serie:"02",sequence:"0000000000",increase:1,quantity:2e3},{name:"CREDITO FISCAL",type:"B",serie:"01",sequence:"0000000000",increase:1,quantity:2e3}],_p=(e,n,s)=>{let o=Number(e)+Number(n);return o=o.toString(),o=o.slice(-10),o=o.substring(0,s),o=o.padStart(s,"0"),o},E0=async(e,n)=>{if(!(!e||!(e!=null&&e.businessID)))try{const{businessID:s}=e,o=le($,"businesses",s,"taxReceipts"),r=dt($),i=new Set;for(const a of n)if(a&&a.data){const{serie:c}=a.data,d=F(o,c);r.set(d,{data:{...a.data,id:c}}),i.add(c)}await r.commit(),console.log("Comprobantes fiscales actualizados con éxito.")}catch(s){throw console.error("Error al actualizar los comprobantes fiscales:",s),s}};We.extend(Bx);const Ve={convertDayjsToMillis:e=>e?e.valueOf():null,convertDayjsToTimestamp:e=>e?ue.fromMillis(e.valueOf()):null,convertMillisToTimestamp:e=>e?ue.fromMillis(e):null,convertTimestampToDayjs:e=>e!=null&&e.seconds?We(e.seconds*1e3):null,convertMillisToDayjs:(e,n="DD-MM-YYYY")=>{if(typeof e=="string"&&/^\d+$/.test(e)&&(e=Number(e)),typeof e=="number")return We(e);if(typeof e=="string"){const s=We(e,n);return s.isValid()?s:null}return null},convertMillisToISODate:(e,n="dd/MM/yyyy")=>e?(typeof e=="object"&&e.seconds!==void 0?e=e.seconds*1e3+e.nanoseconds/1e6:typeof e=="string"&&(e=JSON.parse(e)),ce.fromMillis(e).toFormat(n)):null,convertTimestampToMillis:e=>e?e.seconds*1e3+e.nanoseconds/1e6:null,convertMillisToLuxonDate:e=>e?(typeof e=="string"&&(e=JSON.parse(e)),ce.fromMillis(e)):null,convertMillisToLuxonDateTime:e=>e?(typeof e=="string"&&(e=JSON.parse(e)),ce.fromMillis(e)):null,convertMillisToFriendlyDate:e=>{if(!e)return new Date().toLocaleString("en-US",{timeZone:"America/New_York"});typeof e=="object"&&e.seconds!==void 0?e=e.seconds*1e3+e.nanoseconds/1e6:typeof e=="string"&&(e=JSON.parse(e));const n=ce.fromMillis(e);return n.isValid?n.toFormat("dd/MM/yyyy HH:mm"):"Invalid milliseconds"},formatLuxonDateTime:e=>e?(e instanceof ce||(e=Ve.convertMillisToLuxonDate(e)),(e==null?void 0:e.toFormat("dd/MM/yyyy HH:mm"))||""):"",formatLuxonDate:e=>e?(e instanceof ce||(e=Ve.convertMillisToLuxonDate(e)),(e==null?void 0:e.toFormat("dd/MM/yyyy"))||""):"",convertDateToMillis:e=>e instanceof Date?e.valueOf():null},Ra=e=>{if(e==null)return e;if(e&&typeof e=="object"&&e.seconds!==void 0&&e.nanoseconds!==void 0)return Ve.convertTimestampToMillis(e);if(Array.isArray(e))return e.map(n=>Ra(n));if(typeof e=="object"){const n={};for(const s in e)e.hasOwnProperty(s)&&(n[s]=Ra(e[s]));return n}return e},Eu=e=>Array.isArray(e)?e.map(n=>Ra(n)):e,_c=(e,n)=>{const s=e.data.find(o=>o.data.name===n);if(s){const{type:o,serie:r,sequence:i,increase:a,quantity:c}=s.data;s.data.quantity=String(Number(c)-1),s.data.sequence=_p(i,a,10),e.ncfCode=o+r+_p(i,a,10)}},XS={settings:{taxReceiptEnabled:!1},data:[],ncfCode:null,ncfType:"",availableTypes:[]},A0=Ee({name:"taxReceipt",initialState:XS,reducers:{getTaxReceiptData:(e,n)=>{const s=Ra(n.payload);e.data=s,e.availableTypes=s.map(o=>o.data.name)},IncreaseEndConsumer:(e,n)=>{if(e.settings.taxReceiptEnabled){const s=n.payload||"CONSUMIDOR FINAL";_c(e,s)}},IncreaseTaxCredit:(e,n)=>{if(e.settings.taxReceiptEnabled){const s=n.payload||"CREDITO FISCAL";_c(e,s)}},IncreaseSpecificReceipt:(e,n)=>{e.settings.taxReceiptEnabled&&n.payload&&_c(e,n.payload)},toggleTaxReceiptSettings:(e,n)=>{e.settings.taxReceiptEnabled=n.payload},updateTaxCreditInFirebase:e=>{const n=e.data;E0(n)},selectTaxReceiptType:(e,n)=>{e.ncfType=n.payload},clearTaxReceiptData:e=>{e.ncfStatus=!1,e.ncfCode=null}}}),{getTaxReceiptData:k0,clearTaxReceiptData:T0,selectTaxReceiptType:P0,toggleTaxReceiptSettings:Hp}=A0.actions,ZS=A0.reducer,D0=e=>e.taxReceipt.ncfType,os=e=>e.taxReceipt.settings.taxReceiptEnabled,$0=e=>e.taxReceipt,eI="0000000000",tI=async e=>{try{const n=le($,"businesses",e,"taxReceipts"),s=he(n),o=await Me(s),r={};o.forEach(i=>{const a=i.data().data,c=a.serie;r[c]||(r[c]=[]),r[c].push({id:i.id,...a,docRef:i.ref})});for(const i in r){const a=r[i];if(a.length>1){let c=null;const d=a.filter(p=>p.sequence!==eI);d.length>0?c=d.reduce((p,h)=>p.createdAt?h.createdAt?p.createdAt.toMillis()<h.createdAt.toMillis()?p:h:p:h):a.every(p=>p.createdAt)?c=a.reduce((p,h)=>p.createdAt.toMillis()<h.createdAt.toMillis()?p:h):c=a[0];const u=a.filter(p=>p.name===c.name);u.length>1?u.forEach(p=>{p.id!==c.id&&Ot(p.docRef).then(()=>console.log(`Eliminado duplicado (name) con id: ${p.id}`)).catch(h=>console.error("Error eliminando duplicado:",h))}):a.forEach(async p=>{p.id!==c.id&&(await Ot(p.docRef),console.log(`Eliminado duplicado con id: ${p.id} para la serie: ${i}`))})}}}catch(n){console.error("Error al eliminar duplicados:",n)}},nI=()=>{const e=W(),n=D(q);return m.useEffect(()=>{if(!n||!n.businessID)return;const s=le($,"businesses",n.businessID,"taxReceipts"),o=Te(s,async r=>{if(r.empty){try{const c=new Set;(await Me(s)).forEach(u=>{u.data().data&&u.data().data.serie&&c.add(u.data().data.serie)}),await Fo($,async u=>{const p=[],h=[];for(const f of JS)if(!c.has(f.serie)){const x=f.serie,g=F($,"businesses",n.businessID,"taxReceipts",x);p.push({ref:g,item:f});const y=await u.get(g);h.push(y)}yc(n),p.forEach((f,x)=>{h[x].exists()||(console.log("Creando recibo fiscal con serie:",f.item.serie),u.set(f.ref,{data:{...f.item,id:f.item.serie,createdAt:de()}}))})}),console.log("Los recibos fiscales por defecto fueron creados o ya existían.")}catch(c){console.error("Error en la transacción al crear los recibos por defecto:",c)}return}else try{await tI(n.businessID)}catch(c){console.error("Error al eliminar duplicados:",c)}const i=r.docs.map(c=>c.data()),a=Eu(i);e(k0(a))});return()=>{o()}},[n,e]),null},sI=(e,n,s=console.error)=>{if(typeof e!="string"||!e.trim())return console.warn("subscribeToBusinessInfo: businessID inválido"),()=>{};if(typeof n!="function")return console.warn("subscribeToBusinessInfo: onNext no es una función"),()=>{};const o=F($,"businesses",e);return Te(o,i=>{if(!i.exists()){console.info(`Negocio ${e} no encontrado.`),n(null);return}const a=i.get("business")??null;n(a)},i=>{s(i),n(null)})},oI={data:null},R0=Ee({name:"business",initialState:oI,reducers:{setBusiness:(e,n)=>{e.data=n.payload}}}),{setBusiness:Hc}=R0.actions,ft=e=>e.business.data,rI=R0.reducer,iI=()=>{var s;const e=W(),n=(s=D(q))==null?void 0:s.businessID;m.useEffect(()=>{if(!n){e(Hc(null));return}return sI(n,r=>{e(Hc(r))},r=>{console.error("Error al obtener la información del negocio:",r),e(Hc(null))})},[n,e])},kt=(e,n,s,o="mousedown")=>{m.useEffect(()=>{if(n&&e.current&&s){const r=i=>{e.current.contains(i.target)||s()};return document.addEventListener(o,r),()=>{document.removeEventListener(o,r)}}else return},[e,n,s,o])},z={types:{warning:t.jsx(O,{icon:HC}),error:t.jsx(O,{icon:_C}),success:t.jsx(O,{icon:GC}),info:t.jsx(O,{icon:VC})},finances:{money:t.jsx(O,{icon:Op}),fileInvoiceDollar:t.jsx(O,{icon:$p}),card:t.jsx(O,{icon:Wx}),transfer:t.jsx(O,{icon:qC})},forms:{email:t.jsx(O,{icon:sc}),password:t.jsx(O,{icon:WC}),asterisk:t.jsx(O,{icon:UC}),date:t.jsx(O,{icon:nc}),search:t.jsx(O,{icon:jd})},multimedia:{image:t.jsx(O,{icon:Aa})},user:{user:t.jsx(O,{icon:Ea}),userCheck:t.jsx(O,{icon:zC})},input:{password:{show:t.jsx(O,{icon:Gc}),hide:t.jsx(O,{icon:Rp})}},arrows:{arrowLeft:t.jsx(O,{icon:tc}),chevronDown:t.jsx(O,{icon:Do}),chevronUp:t.jsx(O,{icon:Lx}),chevronLeft:t.jsx(O,{icon:Ux}),chevronRight:t.jsx(O,{icon:Zs}),UpRightAndDownLeftFromCenter:t.jsx(O,{icon:LC}),caretUp:t.jsx(O,{icon:mC}),caretDown:t.jsx(O,{icon:pC}),AnglesLeft:t.jsx(O,{icon:BC}),AnglesRight:t.jsx(O,{icon:FC}),replyAll:t.jsx(O,{icon:MC})},sort:{sortAsc:t.jsx(O,{icon:Mr}),sortDesc:t.jsx(O,{icon:OC})},fontStyles:{bold:t.jsx(O,{icon:NC}),italic:t.jsx(O,{icon:RC}),underline:t.jsx(O,{icon:$C}),strikeThrough:t.jsx(O,{icon:DC}),ul:t.jsx(O,{icon:PC}),ol:t.jsx(O,{icon:TC}),quoteLeft:t.jsx(O,{icon:Dp}),heading:t.jsx(O,{icon:kC}),paragraph:t.jsx(O,{icon:AC})},editingActions:{create:t.jsx(O,{icon:js}),complete:t.jsx(O,{icon:Np}),edit:t.jsx(O,{icon:Cd}),save:t.jsx(O,{icon:EC}),cancel:t.jsx(O,{icon:pa}),show:t.jsx(O,{icon:Gc})},operationModes:{filter:t.jsx(O,{icon:Or}),edit:t.jsx(O,{icon:Cd}),add:t.jsx(O,{icon:js}),delete:t.jsx(O,{icon:ec}),logout:t.jsx(O,{icon:IC}),discard:t.jsx(O,{icon:SC}),cancel:t.jsx(O,{icon:pa}),accept:t.jsx(O,{icon:Np}),search:t.jsx(O,{icon:jd}),close:t.jsx(O,{icon:pa}),setting:t.jsx(O,{icon:Vc}),hide:t.jsx(O,{icon:Rp}),more:t.jsx(O,{icon:Gc})},mathOperations:{add:t.jsx(O,{icon:js}),subtract:t.jsx(O,{icon:uC})},menu:{selected:{settings:t.jsx(O,{icon:Vc})},unSelected:{list:t.jsx(O,{icon:XC}),cashReconciliation:t.jsx(O,{icon:wC}),expenses:{category:t.jsx(O,{icon:Mp}),list:t.jsx(O,{icon:JC}),expenses:t.jsx(O,{icon:Op})},accountsReceivable:t.jsx(O,{icon:$p}),home:t.jsx(O,{icon:KC}),sale:t.jsx(O,{icon:CC}),purchase:t.jsx(O,{icon:jC}),order:t.jsx(O,{icon:vC}),inventory:t.jsx(O,{icon:yC}),contacts:t.jsx(O,{icon:YC}),category:t.jsx(O,{icon:Mp}),register:t.jsx(O,{icon:vd}),settings:t.jsx(O,{icon:Vc})}},users:{provider:t.jsx(O,{icon:bC}),client:t.jsx(O,{icon:Ea})},settings:{businessInfo:t.jsx(O,{icon:zx}),taxReceipt:t.jsx(O,{icon:vd}),appInfo:t.jsx(O,{icon:xC}),users:t.jsx(O,{icon:fC})},inventory:{items:t.jsx(O,{icon:QC}),multimediaManager:t.jsx(O,{icon:Aa}),warehouse:t.jsx(O,{icon:Fr})},insurance:{insurance:t.jsx(O,{icon:gC})},quotation:{quote:t.jsx(O,{icon:Dp})},system:{notification:t.jsx(O,{icon:hC})}},{TabPane:aI}=eo,cI=({isOpen:e=!1,toggleOpen:n,columns:s,columnOrder:o,setColumnOrder:r,resetColumnOrder:i})=>{const[a,c]=m.useState([]),d=m.useRef(null);m.useEffect(()=>{if(a.length>0){const b=setTimeout(()=>{c([])},2e3);return()=>clearTimeout(b)}},[a]),m.useEffect(()=>{localStorage.setItem("columnOrder",JSON.stringify(o))},[o]);const u=b=>{const v=o.map(k=>k.accessor===b?{...k,status:"deleted"}:k),C=v.find(k=>k.accessor===b),j=[...v.filter(k=>k.accessor!==b),C];r(j)},p=b=>{const v=o.findIndex(k=>k.accessor===b),C=o[v],{originalPosition:I}=C;let j=o.filter(k=>k.accessor!==b);j.splice(I,0,{...C,status:"active"}),j=j.filter((k,A)=>!(k.accessor===b&&A>I)),r(j)},h=(b,v)=>{if(o[b].reorderable===!1)return;const C=v==="up"?b-1:b+1;if(C<0||C>=o.length||o[C].reorderable===!1)return;const I=[...o],[j]=I.splice(b,1);c([j.accessor]),setTimeout(()=>{I.splice(C,0,j),r(I),setVisibleColumns(I)},1e3),setVisibleColumns(o.filter((k,A)=>A!==b))},f=()=>o.filter(b=>b.status==="deleted"),x=b=>b===0||o[b-1].reorderable===!1,g=b=>b===o.length-1||o[b+1].reorderable===!1;kt(d,e,n);const y=[{key:"1",tab:"Columnas Activas",content:t.jsx(Qp,{children:t.jsx(gt,{children:o.filter(b=>b.status==="active").map((b,v)=>t.jsxs(Yp,{reorderable:b.reorderable===!1,initial:{opacity:0,y:-10},animate:{opacity:1,y:0,backgroundColor:a.includes(b.accessor)?"var(--color2)":"white"},exit:{opacity:0,y:10},transition:{duration:.3},children:[b==null?void 0:b.Header,t.jsx("div",{children:b.reorderable!==!1&&t.jsxs(t.Fragment,{children:[t.jsx(U,{onClick:()=>h(v,"up"),icon:z.arrows.chevronUp,type:"text",disabled:x(v)}),t.jsx(U,{onClick:()=>h(v,"down"),icon:z.arrows.chevronDown,type:"text",disabled:g(v)}),t.jsx(U,{onClick:()=>u(b.accessor),icon:z.operationModes.close,danger:!0})]})})]},b.accessor))})})},{key:"2",tab:"Columnas Ocultas",content:t.jsx(Qp,{children:f().map(b=>t.jsxs(Yp,{children:[t.jsxs("span",{children:[b.Header," (eliminada)"]}),t.jsx(U,{onClick:()=>p(b.accessor),children:"Restaurar"})]},b.accessor))})}];return t.jsxs(Ce,{open:e,title:"Configuración de las columnas",onCancel:n,style:{top:10},footer:null,children:[t.jsx(dI,{children:t.jsx(eo,{defaultActiveKey:"1",children:y.map(b=>t.jsx(aI,{tab:b.tab,children:b.content},b.key))})}),t.jsx("br",{}),t.jsx(Xe.Title,{level:5,children:"Revertir Cambios"}),t.jsx(Xe.Paragraph,{children:"Restablece el orden original de las columnas y reactiva las columnas eliminadas"}),t.jsx(lI,{children:t.jsx(U,{title:"",onClick:i,children:"Restaurar"})})]})},lI=l.div`
display: grid;
grid-template-columns: 1fr;
gap: 1em;
`,dI=l.div`
    display: grid;
    gap: 1em;
`,Qp=l(Ie.ul)`
    list-style: none;
    padding: 0.2em;
    margin: 0;
    width: 100%;
    background-color: #F5F5F5;
    min-height: 300px;
`,Yp=l(Ie.li)`
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 10px;
  background-color: ${e=>e.reorderable?"#f5f4f4 !important":"white "};
  border-bottom: 1px solid #eee;

  &:last-child {
    border-bottom: none;
  }
 div{
    display: flex;
    gap: 0.2em;
    
 }
`,Qc=3,Na=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,""),N0=e=>{const n=a=>a.includes(e),s=a=>a.toString().includes(e),o=(a,c)=>{if(c>Qc)return!1;for(let d=0;d<a.length;d++)if(i(a[d],c+1))return!0;return!1},r=(a,c)=>{if(c>Qc)return!1;for(const d of Object.values(a))if(i(d,c+1))return!0;return!1},i=(a,c=0)=>{if(a==null)return!1;const d={string:()=>n(Na(a.toLowerCase())),number:()=>s(a),object:()=>c>Qc?!1:Array.isArray(a)?o(a,c):a instanceof Date?n(Na(a.toISOString().toLowerCase())):r(a,c),default:()=>!1};return(d[typeof a]||d.default)()};return a=>i(a)},O0=(e,n)=>e?Array.isArray(e)?typeof n!="string"&&n!==void 0&&n!==null?(console.warn("useFilter: The search term must be a string or null/undefined"),!1):!0:(console.warn("useFilter: The first parameter must be an array"),!1):(console.warn("useFilter: The first parameter must be a non-null array"),!1),$n=(e,n)=>{if(!O0(e,n))return e;const s=(n==null?void 0:n.trim())??"";if(!s)return e;const o=Na(s.toLowerCase()),r=N0(o);try{return e.filter(r)}catch(i){return console.warn("useFilter: Error filtering data",i),e}},Au=(e=[],n="")=>{const s=n.trim(),o=Na(s.toLowerCase());return m.useMemo(()=>{if(!O0(e,n)||!s)return e;try{const r=N0(o);return e.filter(r)}catch(r){return console.warn("useFilter: Error in filter operation",r),e}},[e,o])},uI=(e,n,s={key:null,direction:"asc"})=>{const[o,r]=m.useState(s);return{sortedData:[...e].sort((c,d)=>{if(o.key===null||o.direction==="none")return 0;const u=o.key,p=n.find(x=>x.accessor===u),h=p.sortableValue?p.sortableValue(c[u]):c[u],f=p.sortableValue?p.sortableValue(d[u]):d[u];return h<f?o.direction==="asc"?-1:1:h>f?o.direction==="asc"?1:-1:0}),handleSort:(c,d)=>{if(d){let u="asc";o.key===c&&o.direction==="asc"?u="desc":o.key===c&&o.direction==="desc"&&(u="none"),r({key:c,direction:u})}},sortConfig:o}},hi=e=>{e.current&&(e.current.scrollTop=0)},pI=(e,n,s,o=15,r)=>{const[i,a]=m.useState(0);m.useEffect(()=>{a(0)},[e]);const c=Math.ceil(s.length/o),d=i*o,u=d+o;return{currentData:n.slice(d,u),nextPage:()=>{a(y=>Math.min(y+1,c-1)),hi(r)},prevPage:()=>{a(y=>Math.max(y-1,0)),hi(r)},firstPage:()=>{a(0),hi(r)},lastPage:()=>{a(c-1),hi(r)},currentPage:i,pageCount:c}},mI=(e,n)=>!e||!Array.isArray(e)?[]:n?e.filter(s=>Object.keys(n).every(o=>s[o]===n[o])):e,hI=(e,n)=>[...new Set(e.map(o=>o[n]))].map(o=>({label:o,value:o})),gI=(e=[],n=[])=>{if(!e||!Array.isArray(e))throw new Error("initialFilterConfig debe ser un array");if(!n||!Array.isArray(n))throw new Error("data debe ser un array");const[s,o]=m.useState(e);return m.useEffect(()=>{const r=e.map(i=>({...i,options:hI(n,i.accessor)}));JSON.stringify(r)!==JSON.stringify(s)&&o(r)},[n,e]),s},fI=(e,n)=>{const s=e.reduce((c,d)=>(d.defaultValue!==void 0&&(c[d.accessor]=d.defaultValue),c),{}),[o,r]=m.useState(s),i=()=>{r(s)},a=mI(n,o);return[o,r,i,s,a]},xI=({handleSort:e,columnOrder:n,sortConfig:s,isWideScreen:o,isWideLayout:r})=>{const i=n.filter(a=>a.status==="active");return t.jsx(bI,{columns:i,children:t.jsx(Pd,{columns:i,isWideScreen:o,isWideLayout:r,children:i.map((a,c)=>t.jsxs(yI,{align:a.align,fixed:a.fixed,minWidth:a.minWidth,maxWidth:a.maxWidth,onClick:()=>a.sortable?e(a.accessor):null,children:[a.Header,s.key===a.accessor?s.direction==="asc"?t.jsx(gi,{children:z.arrows.caretUp},"up"):s.direction==="desc"?t.jsx(gi,{children:z.arrows.caretDown},"down"):t.jsx(gi,{children:z.mathOperations.subtract},"minus"):a.sortable&&t.jsx(gi,{children:z.mathOperations.subtract},"minus")]},c))})})},bI=l.div`
    display: grid;  
    align-items: center;
    gap: 1em;
    color: var(--Gray7);
    font-size: 14px;
    border-bottom: var(--border-primary);
    border-top: var(--border-primary);
    font-weight: 500;
    background-color: white;
    position: sticky;
    top: 0;
    z-index: 1;
    width: 100%;
`,yI=l.div`
  display: flex;
  align-items: center;
  padding: 0 10px;
  height: 2.75em;
  font-weight: bold;
  gap: 0.6em;
  position: ${e=>e.fixed?"sticky":"relative"};
  ${e=>e.fixed==="left"&&`
    left: 0;
    z-index: 2;
    background-color: #ffffff;
    border-right: 1px solid var(--Gray3);
  `}
  ${e=>e.fixed==="right"&&`
    right: 0;
    z-index: 2;
    background-color: #ffffff;
    border-left: 1px solid var(--Gray3);
  `}
  justify-content: ${e=>e.align||"flex-start"};
  text-align: ${e=>e.align||"left"};
  overflow: hidden;
  white-space: nowrap;
    @media (width <= 1600px) {
  min-width: ${e=>e.minWidth||"100px"};
  max-width: ${e=>e.maxWidth||"1fr"};
    }
  
`,gi=l(Ie.div)`
  display: flex;
  align-items: center;
  color: var(--color);
  font-size: 1.4em;
  min-width: 1em;
  display: flex;
  justify-items: center;
  justify-content: center;
  svg {
    color: inherit;
    font-size: inherit;
  }
`,ke=m.forwardRef(({border:e,color:n="on-gray",title:s,alignText:o="center",size:r="small",startIcon:i,endIcon:a,onClick:c,width:d,height:u,hidden:p,variant:h="contained",disabled:f,borderRadius:x="normal",isActivated:g,isActivatedColors:y,iconOn:b,iconOff:v,iconColor:C,titlePosition:I,type:j="button"},k)=>{const A=P=>{P.stopPropagation(),c()};return t.jsxs(CI,{size:r,color:n,onClick:c&&A,width:d,height:u,variant:h,disabled:f,type:j,borderRadius:x,isActivated:g,titlePosition:I,border:e,iconColor:C,isActivatedColors:y,hidden:p,alignText:o,ref:k,children:[g?b:v,i||null,s||null,a||null]})}),vI=qe`
  display: flex;
  align-items: center;
  justify-content: ${e=>e.alignText||"center"};
  gap: 0.6em;
  font-size: 16px;
  font-weight: 500;
  text-align: ${e=>e.alignText||"center"};
  text-decoration: none;
  text-transform: capitalize;   
  white-space: nowrap;
  border: none;
  outline: none;
  cursor: pointer;

  svg{
    font-size: 1.2em;
    margin: 0;
    display: flex;
    place-items: center;
  }

  transition: border-color 0.25s, background-color 500ms;
  pointer-events: all;

  &:focus, &:focus-visible{
    outline: none;
  }
`,Kp={small:`
    height: 2em;
    padding: 0 0.6em;
    svg {
    font-size: 16px;
    }
  `,medium:`
    height: 2.2em;
    font-size: 16px;
    padding: 0 0.8em;
  `,large:`
    height: 2.4em;
    font-size: 16px;
    padding: 0 0.8em;
  `,icon16:`
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    svg{
      font-size: 16px;
    }
  `,icon24:`
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    svg{
      font-size: 18px;
    }
  `,icon32:`
    width: 32px;
    height: 32px;
    svg{
      font-size: 20px;
    }
  `},jI={normal:`
    border-radius: var(--border-radius);
  `,light:`
    border-radius: var(--border-radius-light);
  `,none:`
    border-radius: 0;
  `,round:`
    border-radius: 100px;
  `},CI=l.button`
  ${vI}
  ${e=>e.size?Kp[e.size]:Kp.medium}
  
  &:hover{
    ${e=>e.isActivated?null:`
      
       opacity: 0.8;
    `}
  }

 
 
  ${e=>e.borderRadius&&jI[e.borderRadius]}
  ${e=>{var n,s,o,r;switch(e.variant){case"contained":return`
        ${((s=(n=e.theme)==null?void 0:n.colors)==null?void 0:s[e.color])&&`
          background-color: ${(r=(o=e.theme)==null?void 0:o.colors)==null?void 0:r[e.color].bg};
          color: ${e.theme.colors[e.color].text};
          backdrop: blur(10px);
          hover{
            background-color: ${e.theme.colors[e.color].bg};
            color: ${e.theme.colors[e.color].text};
          }
          `}
        `;case"outlined":return`
            background-color: transparent;
            color: ${e.theme.colors[e.color].bg};
            border: 1px solid ${e.theme.colors[e.color].bg};
          `;case"text":return`
              background-color: transparent;
              color: ${e.theme.colors[e.color].bg};
            `;case"textContained":return`
              background-color: ${e.theme.colors[e.color].bg};
              color: ${e.theme.colors[e.color].bg};
              border: none;
            `}}}
  ${e=>{switch(e.width){case"w100":return`
        max-width: 100%;
        min-width: 100%;
        width: 100% !important;
        
          `;case"auto":return`
              width: auto;
            `;case"icon32":return`
          min-width: 32px;
          max-width: 32px;
          min-height: 32px;
          max-height: 32px;
          display: grid;
          align-items: center;
          justify-content: center;
          padding: 0;
          margin: 0;
          font-size: 18px;
        `;case"icon24":return`
          min-width: 27px;
          max-width: 27px;
          max-height: 27px;
          min-height: 27px;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 0;
        `}}}
   ${e=>{switch(e.height){case"small":return`
           height: 24px;
           display: flex;
           align-items: center;
           padding: 0 0.4em;

          `;case"medium":return`  
          height: 30px;
          display: flex;
          align-items: center;
          font-size: 16px;
          padding: 0 0.8em;
          `;case"large":return`
          height: 2em;
          display: flex;
          align-items: center;
          font-size: 16px;
          padding: 0 1.2em;
          `}}}
   ${e=>{switch(e.border){case"light":return`
          border: var(--border-primary);

          `}}}
  ${e=>{switch(e.disabled){case!0:return`
           opacity: 0.4;
           cursor: not-allowed;
           pointer-events: none;

          `}}}

  ${e=>{switch(e.isActivatedColors){case"style1":switch(e.isActivated){case!0:return`
              background-color: ${e.theme.colors[e.color].bg};
              color: ${e.theme.colors[e.color].text};
              :hover{
                background-color: ${e.theme.colors[e.color].bg};
                color: ${e.theme.colors[e.color].text};
              }
            `;case!1:return`
              background-color: ${e.theme.colors[e.color].bg};
              color: ${e.theme.colors[e.color].text};
              :hover{
                background-color: ${e.theme.colors[e.color].bg};
                color: ${e.theme.colors[e.color].text};
              }
            `}return`
        
        ${e.isActivated===!0?`
        background-color: #ffffff;
          color: black;
          :hover{
            background-color: #e9e9e9;
            color: black;
          }
        `:`
        background-color: rgba(0, 0, 0, 0.26);
          color: white;
          :hover{
            background-color: #e9e9e94b;
            color: black;
          }
        `}
         
        `;case!1:return`
          background-color: rgba(0, 0, 0, 0.26);
          color: white;
      
        `;case e.isActivated:return`
          background-color: ${e.isActivated};
        `}}}

  @media (max-width: 800px) {
    display: ${e=>e.hidden===!0?"none":"flex"};
  }
`,$t=l.div`
  display: flex;
  gap: 0.4em;
  align-items: center;
`,Jp={h1:qe`
      margin: 0;
      margin-bottom: 4px;
      line-height: 1.2;
      font-weight: 700;
    `,h2:qe`
      margin: 0;
      margin-bottom: 10px; 
      line-height: 1.3;
      font-weight: 700;
    `,h3:qe`
      margin: 0;
      margin-bottom: 10px;
      line-height: 1.4;
      font-weight: 700;
    `,h4:qe`
      margin: 0;
      margin-bottom: 10px;
      line-height: 1.5;
      font-weight: 700;
    `,h5:qe`
      margin: 0 0 0.3rem 0;
      line-height: 1.6;
      font-weight: 700;
    `,h6:qe`
      margin: 0 0.25rem 0;
      line-height: 1.7;
      font-weight: 400;
    `,l1:qe`
      margin: 0;
      line-height: 0.8;
      font-weight: 600;
    `,l2:qe`
      margin: 0;
      line-height: 0.8;
      font-weight: 600;
    `,l3:qe`
      margin: 0;
      line-height: 0.8;
      font-weight: 600;
    `,subtitle1:qe`
      margin: 0.35rem 0;
      line-height: 1.5;
      font-weight: 400;
    `,subtitle2:qe`
      margin: 0.3rem 0;
      line-height: 1.6;
      font-weight: 400;
    `,body1:qe`
      font-size: 1rem;
      margin: 0;
      margin-bottom: 0.625em;
      line-height: 1.5;
      font-weight: 400;
    `,body2:qe`
      font-size: 0 0.9em;
      margin: 0;
      margin-bottom: 0.625em;
      line-height: 1.6;
      font-weight: 400;
    `,caption:qe`
      margin: 0.25rem 0;
      line-height: 1.7;
      font-weight: 300;
    `,overline:qe`
      text-transform: uppercase;
      margin: 0.25rem 0;
      line-height: 1.7;
      font-weight: 300;
    `},Nt={white:"rgb(255, 255, 255)",slate:{100:"rgb(241, 245, 249)",200:"rgb(226, 232, 240)",300:"rgb(203, 213, 225)",400:"rgb(148, 163, 184)",500:"rgb(100, 116, 139)",600:"rgb(71, 85, 105)",700:"rgb(51, 65, 85)",800:"rgb(30, 41, 59)",900:"rgb(15, 23, 42)"},gray:{100:"rgb(243, 244, 246)",200:"rgb(229, 231, 235)",300:"rgb(209, 213, 219)",400:"rgb(156, 163, 175)",500:"rgb(107, 114, 128)",600:"rgb(75, 85, 99)",700:"rgb(55, 65, 81)",800:"rgb(31, 41, 55)",900:"rgb(17, 24, 39)"},red:{100:"rgb(254, 226, 226)",200:"rgb(254, 202, 202)",300:"rgb(252, 165, 165)",400:"rgb(248, 113, 113)",500:"rgb(239, 68, 68)",600:"rgb(220, 38, 38)",700:"rgb(185, 28, 28)",800:"rgb(153, 27, 27)",900:"rgb(127, 29, 29)"},orange:{100:"rgb(255, 237, 213)",200:"rgb(254, 215, 170)",300:"rgb(253, 186, 116)",400:"rgb(251, 146, 60)",500:"rgb(249, 115, 22)",600:"rgb(234, 88, 12)",700:"rgb(194, 65, 12)",800:"rgb(154, 52, 18)",900:"rgb(124, 45, 18)"},amber:{100:"rgb(254, 243, 199)",200:"rgb(253, 230, 138)",300:"rgb(252, 211, 77)",400:"rgb(251, 191, 36)",500:"rgb(245, 158, 11)",600:"rgb(217, 119, 6)",700:"rgb(180, 83, 9)",800:"rgb(146, 64, 14)",900:"rgb(120, 53, 15)"},green:{100:"rgb(220, 252, 231)",200:"rgb(187, 247, 208)",300:"rgb(134, 239, 172)",400:"rgb(74, 222, 128)",500:"rgb(34, 197, 94)",600:"rgb(22, 163, 74)",700:"rgb(21, 128, 61)",800:"rgb(22, 101, 52)",900:"rgb(20, 83, 45)"},sky:{100:"rgb(224, 242, 254)",200:"rgb(186, 230, 253)",300:"rgb(125, 211, 252)",400:"rgb(56, 189, 248)",500:"rgb(14, 165, 233)",600:"rgb(2, 132, 199)",700:"rgb(3, 105, 161)",800:"rgb(7, 89, 133)",900:"rgb(12, 74, 110)"},blue:{50:"rgb(239, 246, 255)",100:"rgb(219, 234, 254)",200:"rgb(191, 219, 254)",300:"rgb(147, 197, 253)",400:"rgb(96, 165, 250)",500:"rgb(59, 130, 246)",600:"rgb(37, 99, 235)",700:"rgb(29, 78, 216)",800:"rgb(30, 64, 175)",900:"rgb(30, 58, 138)"},purple:{100:"rgb(243, 232, 255)",200:"rgb(233, 213, 255)",300:"rgb(216, 180, 254)",400:"rgb(192, 132, 252)",500:"rgb(168, 85, 247)",600:"rgb(147, 51, 234)",700:"rgb(126, 34, 206)",800:"rgb(107, 33, 168)",900:"rgb(88, 28, 135)"}},Fn=(e="primary",n,s="light")=>{if(!n)return;const{white:o}=Nt,r={[`${e}`]:{bg:n[600],text:o,hover:n[600],disabled:n[400]},[`on-${e}`]:{bg:o,text:n[500],hover:n[400],disabled:n[300]},[`${e}-contained`]:{bg:n[200],text:n[800],hover:n[300],disabled:n[100]},[`on-${e}-contained`]:{bg:n[800],text:n[200],hover:n[700],disabled:n[600]}},i={[`${e}`]:{bg:n[300],text:n[900],hover:n[400],disabled:n[200]},[`on-${e}`]:{bg:n[900],text:n[300],hover:n[800],disabled:n[700]},[`${e}-contained`]:{bg:n[800],text:n[200],hover:n[700],disabled:n[600]},[`on-${e}-contained`]:{bg:n[200],text:n[800],hover:n[300],disabled:n[100]}};return s==="dark"?i:r},Td={colors:{...Fn("primary",Nt.blue),...Fn("secondary",Nt.orange),...Fn("tertiary",Nt.purple),...Fn("error",Nt.red),...Fn("warning",Nt.amber),...Fn("info",Nt.sky),...Fn("success",Nt.green),...Fn("slate",Nt.slate),...Fn("gray",Nt.gray)},text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.54)",disabled:"rgba(0, 0, 0, 0.38)",hint:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",bg:{shade:Nt.white,shade2:Nt.blue[100],shade3:Nt.blue[200],color:"rgb(66, 165, 245)",color2:Nt.blue[50],color3:"#67B8DE",color4:Nt.blue[500],light:"#ffffff",card:"#ffffff"},border:{base:"1px solid #ced2d6",highlighted:"2px solid #a0aec0",accent:"2px dashed #718096",light:"#eaeaea"},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},Xp={primary:qe`
      color: #007BFF;
    `,secondary:qe`
      color: #6C757D;
    `,success:qe`
      color: #28A745;
    `,danger:qe`
      color: #DC3545;
    `,warning:qe`
      color: #FFC107;
    `,info:qe`
      color: #17A2B8;
    `,light:qe`
      color: #F8F9FA;
    `,dark:qe`
      color: #353535;
    `,inherit:qe`
      color: inherit;
    `},wI={small:"1.8rem",medium:"1.6rem",large:"2rem"},SI={small:"1.3rem",medium:"1.3rem",large:"2rem"},II={small:"1.1rem",medium:"1.2rem",large:"1.5rem"},EI={small:"0.9rem",medium:"1.1rem",large:"1.2rem"},AI={small:"0.8rem",medium:"0.875rem",large:"1rem"},kI={small:"0.7rem",medium:"0.75rem",large:"0.8rem"},TI={small:"0.9rem",medium:"1rem",large:"1.2rem"},PI={small:"0.8rem",medium:"0.875rem",large:"1rem"},DI={small:"0.9rem",medium:"1rem",large:"1.2rem"},$I={small:"0.8rem",medium:"0.875rem",large:"1rem"},RI={small:"0.7rem",medium:"0.75rem",large:"0.8rem"},NI={small:"0.7rem",medium:"0.75rem",large:"0.8rem"},OI={small:"0.7rem",medium:"0.9rem",large:"0.9rem"},MI={small:"0.7rem",medium:"0.9rem",large:"0.9rem"},FI={small:"0.7rem",medium:"0.9rem",large:"0.9rem"},BI={h1:wI,h2:SI,h3:II,h4:EI,h5:AI,h6:kI,l1:OI,l2:MI,l3:FI,subtitle1:TI,subtitle2:PI,body1:DI,body2:$I,caption:RI,overline:NI},LI={small:"1.8rem",medium:"2.125rem",large:"2.5rem",xlarge:"3rem"},zI={small:"1.3rem",medium:"1.6rem",large:"2rem"},UI={small:"1.1rem",medium:"1.25rem",large:"1.5rem"},WI={small:"0.9rem",medium:"1.1rem",large:"1.2rem"},qI={small:"0.8rem",medium:"0.875rem",large:"1rem"},VI={small:"0.7rem",medium:"0.75rem",large:"0.8rem"},GI={small:"0.9rem",medium:"1rem",large:"1.2rem"},_I={small:"0.8rem",medium:"0.875rem",large:"1rem"},HI={small:"0.9rem",medium:"1rem",large:"1.2rem"},QI={small:"0.8rem",medium:"0.875rem",large:"1rem"},YI={small:"0.7rem",medium:"0.75rem",large:"0.8rem"},KI={small:"0.7rem",medium:"0.75rem",large:"0.8rem"},JI={small:"0.7rem",medium:"0.9rem",large:"0.9rem"},XI={small:"0.7rem",medium:"0.9rem",large:"0.9rem"},ZI={small:"0.7rem",medium:"0.9rem",large:"0.9rem"},eE={h1:LI,h2:zI,h3:UI,h4:WI,h5:qI,h6:VI,l1:JI,l2:XI,l3:ZI,subtitle1:GI,subtitle2:_I,body1:HI,body2:QI,caption:YI,overline:KI},et={app:BI,web:eE},tE=({context:e,variant:n,size:s,generalSize:o,variantToSizeMap:r})=>{var a,c;return((c=(a=r[e])==null?void 0:a[n])==null?void 0:c[s])||o[s]},nE={app:{h1:et.app.h1,h2:et.app.h2,h3:et.app.h3,h4:et.app.h4,h5:et.app.h5,h6:et.app.h6,l1:et.app.l1,l2:et.app.l2,l3:et.app.l3,subtitle1:et.app.subtitle1,subtitle2:et.app.subtitle2,body1:et.app.body1,body2:et.app.body2,caption:et.app.caption,overline:et.app.overline},web:{h1:et.web.h1,h2:et.web.h2,h3:et.web.h3,h4:et.web.h4,h5:et.web.h5,h6:et.web.h6,l1:et.web.l1,l2:et.web.l2,l3:et.web.l3,subtitle1:et.web.subtitle1,subtitle2:et.web.subtitle2,body1:et.web.body1,body2:et.web.body2,caption:et.web.caption,overline:et.web.overline}},sE={small:"0.875rem",medium:"1rem",large:"1.25rem",xlarge:"1.5rem",xxlarge:"2rem"},Zp={small:"500",medium:"600",large:"700",xlarge:"800",xxlarge:"900",true:"bold",false:"normal"},oE=qe`

  font-size: ${({context:e,variant:n,size:s})=>tE({context:e,variant:n,size:s,variantToSizeMap:nE,generalSize:sE})};

  text-align: ${({align:e})=>e||"left"};
  /* margin-bottom: ${({gutterBottom:e})=>e?"1rem":"0"}; */
  ${({disableMargins:e})=>e&&"margin: 0;"}
  /* font-weight: ${({bold:e})=>Zp[String(e)]||"normal"}; */
  ${({bold:e})=>e&&`font-weight: ${Zp[String(e)]} ;`}
  ${({italic:e})=>e&&"font-style: italic;"}
  ${({underline:e})=>e&&"text-decoration: underline;"}
  ${({uppercase:e})=>e&&"text-transform: uppercase;"}
  ${({capitalize:e})=>e&&"text-transform: capitalize;"}
  ${({lowercase:e})=>e&&"text-transform: lowercase;"}
  ${({noWrap:e})=>e&&"white-space: nowrap;"}
  letter-spacing: ${({letterSpacing:e})=>e||"normal"};
  text-transform: ${({textTransform:e})=>e||"none"};
  ${({display:e})=>e&&`display: ${e};`}
`,rE=l.div`

  ${({variant:e})=>Jp[e]||Jp.body1}
  ${oE}
  ${({color:e})=>Xp[e]||Xp.dark}
      
  ${({strikethrough:e})=>e&&"text-decoration: line-through;"}
  ${({textShadow:e})=>e&&`text-shadow: ${e};`}
  ${({as:e})=>e==="a"&&`
    cursor: pointer;
    color: #007bff;
    font-weight: 500;
    text-decoration: underline;
    &:hover {
      text-decoration: none;
    }
  `}
`,iE={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",label:"label",l1:"span",l2:"span",l3:"span",span:"span",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",caption:"span",overline:"span"},Qe=({variant:e="body1",context:n="app",color:s="dark",align:o="left",display:r="block",gutterBottom:i=!1,disableMargins:a=!1,noWrap:c=!1,component:d,className:u,size:p="medium",italic:h=!1,strikethrough:f=!1,textShadow:x=null,children:g,bold:y=!1,underline:b=!1,...v})=>{const C=d||iE[e]||"span";return t.jsx(rE,{as:C,context:n,variant:e,color:s,align:o,display:r,italic:h,gutterBottom:i,disableMargins:a,strikethrough:f,textShadow:x,size:p,noWrap:c,underline:b,className:u,bold:y,...v,children:g})},si=({textVariant:e="body1",containerVariant:n="text",text:s,buttonText:o,handleAction:r,showAfter:i=0,...a})=>{const[c,d]=m.useState(!1),u=p=>{p.preventDefault()};return m.useEffect(()=>{(i||i===0)&&setTimeout(()=>{d(!0)},i)},[]),c&&t.jsx(aE,{onContextMenu:u,children:t.jsx(cE,{children:t.jsxs(lE,{containerVariant:n,children:[t.jsx(Qe,{variant:e,align:"center",children:s}),r&&o&&t.jsx(ke,{title:o,titlePosition:"center",width:"auto",color:"primary",borderRadius:"normal",onClick:r,...a})]})})})},aE=l.div`
  display: grid;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;

  position:absolute;
  top: 0;
  left: 0;
`;l.p`
  text-align: center;
  width: 100%;
  padding: 0 1em;
  max-width: 500px;
`;const cE=l.div`
position: relative;
  display: grid;
  align-items: center;
  margin: 0;
  padding: 10px;
`,lE=l.div`
height: 100%;
width: 100%;
max-width: 500px;
padding: 1em;
margin: 0;

display: grid;
  gap: 2em;
  justify-items: center;
  align-items: center;
  
  
  text-align: center;
  
  ${({containerVariant:e})=>e==="contained"&&`
  border-radius: 10px;
  min-height: 200px;
  background-color: #ffffff;
  box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.75);
  `}


`,dE=l.div`
  position: relative;
  width: 100%;
  height: 100%;
  min-height: ${e=>e.minHeight||"40px"};
`,uE=l.div`
  transition: opacity 0.5s ease-in-out;
  opacity: ${e=>e.fadeOut?0:1};
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2;
`,pE=l.div`
  border: 4px solid rgba(0, 0, 0, 0.1);
  border-top: 4px solid #3498db;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 0.8s linear infinite;

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
`,mE=l.div`
  opacity: ${e=>e.loading?.6:1};
  transition: opacity 0.3s ease-in-out;
  height: 100%;
  display: grid;
`,ku=({loading:e=!1,children:n,minHeight:s,overlay:o=!0})=>{const[r,i]=m.useState(!1),[a,c]=m.useState(!1),d=m.useRef(null);return m.useEffect(()=>{let u;if(e)i(!0),c(!1),d.current=Date.now();else{const h=Date.now()-d.current,f=Math.max(200,Math.min(h,500));c(!0),h>300?requestAnimationFrame(()=>{u=setTimeout(()=>{i(!1)},f)}):i(!1)}return()=>clearTimeout(u)},[e]),t.jsxs(dE,{minHeight:s,children:[r&&o&&t.jsx(uE,{fadeOut:a,children:t.jsx(pE,{})}),t.jsx(mE,{loading:e,children:n})]})},hE={statuses:{completed:{color:"#52c41a",bgColor:"#f6ffed",icon:t.jsx($o,{}),text:"Completado"},pending:{color:"#faad14",bgColor:"#fffbe6",icon:t.jsx(Id,{}),text:"Pendiente"},canceled:{color:"#ff4d4f",bgColor:"#fff2f0",icon:t.jsx(zp,{}),text:"Cancelado"},processing:{color:"#1890ff",bgColor:"#e6f7ff",icon:t.jsx(Pa,{spin:!0}),text:"En Proceso"},default:{color:"#8c8c8c",bgColor:"#fafafa",icon:null,text:"Desconocido"}},actions:{create:{color:"#389e0d",icon:t.jsx(Hw,{}),text:"Crear"},update:{color:"#096dd9",icon:t.jsx(es,{}),text:"Actualizar"},delete:{color:"#cf1322",icon:t.jsx(ht,{}),text:"Eliminar"},default:{color:"#8c8c8c",icon:null,text:"Desconocido"}},dates:{overdue:{color:"#cf1322",bgColor:"#fff1f0",icon:t.jsx(zp,{}),text:"Vencido"},today:{color:"#096dd9",bgColor:"#e6f7ff",icon:t.jsx(Pa,{}),text:"Hoy"},warning:{color:"#d48806",bgColor:"#fff7e6",icon:t.jsx(cc,{}),text:"Próximo"},upcoming:{color:"#389e0d",bgColor:"#f6ffed",icon:t.jsx(Id,{}),text:"Cercano"},onTime:{color:"#389e0d",bgColor:"#f6ffed",icon:t.jsx($o,{}),text:"En tiempo"},invalid:{color:"#8c8c8c",bgColor:"#f5f5f5",icon:t.jsx(Tn,{}),text:"Sin fecha"},default:{color:"#8c8c8c",bgColor:"#f5f5f5",icon:t.jsx(Tn,{}),text:"Desconocido"}}};function M0(e,n){const s=hE[e];return s[n]||s.default}const gE=e=>M0("statuses",e),fE=e=>M0("dates",e),xE=(e,n=["overdue","today","warning","upcoming","onTime"])=>{if(!e)return{status:"invalid",text:"Sin fecha"};const s=We(),r=We(e).diff(s,"day");return n.includes("overdue")&&r<0?{status:"overdue",text:"Vencido"}:n.includes("today")&&r===0?{status:"today",text:"Hoy"}:n.includes("warning")&&r>0&&r<=3?{status:"warning",text:"Próximo"}:n.includes("upcoming")&&r>3&&r<=7?{status:"upcoming",text:"Cercano"}:n.includes("onTime")&&r>7?{status:"onTime",text:"En tiempo"}:{status:"default",text:"Desconocido"}};function Ao({icon:e,onClick:n,tooltip:s,color:o="#8c8c8c",hoverColor:r="#1890ff"}){return t.jsx(Oe,{title:s,children:t.jsx("div",{onClick:n,style:{cursor:"pointer",padding:"6px",borderRadius:"6px",transition:"all 0.3s",color:o,display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},onMouseEnter:i=>{i.currentTarget.style.backgroundColor="#f5f5f5",i.currentTarget.style.color=r},onMouseLeave:i=>{i.currentTarget.style.backgroundColor="transparent",i.currentTarget.style.color=o},children:e})})}const bE=e=>{switch(e.$variant){case"outlined":return qe`
                background-color: transparent;
                border: 1px solid ${e.$color};
                color: ${e.$color};
            `;case"text":return qe`
                background-color: transparent;
                color: ${e.$color};
                padding-left: 0;
                padding-right: 0;

                &:hover {
                    background-color: transparent;
                    transform: none;
                }
            `;case"light":return qe`
                background-color: ${e.$bgColor}40;
                color: ${e.$color};
            `;default:return qe`
                background-color: ${e.$bgColor};
                color: ${e.$color};
            `}},yE=l.div`
    display: inline-flex;
    align-items: center;
    border-radius: 4px;
    font-weight: 500;
    transition: all 0.3s ease;
    cursor: pointer;

    ${e=>{switch(e.$size){case"small":return qe`
                    padding: 2px 8px;
                    font-size: 11px;
                `;case"large":return qe`
                    padding: 6px 16px;
                    font-size: 15px;
                `;default:return qe`
                    padding: 4px 12px;
                    font-size: 13px;
                `}}}

    ${e=>bE(e)}

    &:hover {
        opacity: 0.8;
        transform: translateY(-1px);
    }
`,vE=l.span`
    margin-right: 6px;
`;function F0({color:e="#333",bgColor:n="#f5f5f5",icon:s,text:o,size:r="medium",variant:i="filled"}){return t.jsxs(yE,{$color:e,$bgColor:n,$size:r,$variant:i,children:[s&&t.jsx(vE,{children:s}),o]})}function jE({status:e}){const n=gE(e);return t.jsx(F0,{color:n.color,bgColor:n.bgColor,icon:n.icon,text:n.text})}const fi={bgColor:"#f5f5f5",color:"#666666",icon:t.jsx(O,{icon:nc}),text:"Fecha"},em=l.div`
    padding: ${e=>e.simple?"8px 16px":"1px 8px"};
    border-radius: 6px;
    min-width: 115px;
    background-color: ${e=>e.simple?"#f8f9fa":e.bgColor||"#E3F2FD"};
    display: ${e=>e.simple?"flex":"inline-block"};
    justify-content: ${e=>e.simple?"center":"initial"};
    align-items: ${e=>e.simple?"center":"initial"};
`,CE=l.div`
    display: flex;
    justify-content: ${e=>e.simple?"center":"space-between"};
    align-items: center;
    gap: 4px;
`,tm=l.span`
    color: ${e=>e.simple?"#495057":e.color};
    font-size: ${e=>(e.simple,"14px")};
`,wE=l.div`
    color: ${e=>e.color};
    font-size: 12px;
    font-weight: 500;
`,SE=(e,n)=>m.isValidElement(e)?m.cloneElement(e,{style:{color:n}}):e,B0=({dateTime:e=ce.now(),config:n})=>{const s={bgColor:(n==null?void 0:n.bgColor)??fi.bgColor,color:(n==null?void 0:n.color)??fi.color,icon:(n==null?void 0:n.icon)??fi.icon,text:(n==null?void 0:n.text)??fi.text},o=e!=null&&e.isValid?e.toFormat("dd/MM/yyyy"):ce.now().toFormat("dd/MM/yyyy");return n?t.jsxs(em,{bgColor:s.bgColor,children:[t.jsxs(CE,{children:[t.jsx(tm,{color:s.color,children:o}),SE(s.icon,s.color)]}),t.jsx(wE,{color:s.color,children:s.text})]}):t.jsx(em,{simple:!0,children:t.jsx(tm,{simple:!0,color:"",children:o})})},IE=({timestamp:e})=>{const n=Ve.convertMillisToLuxonDateTime(e);if(!n)return"-";const s=xE(e),o=fE(s.status);return t.jsx(B0,{dateTime:n,config:o})},L0=Ee({name:"note",initialState:{isOpen:!1,note:null},reducers:{setNote:(e,n)=>{const{isOpen:s,note:o}=n.payload;e.isOpen=s,e.note=o},clearNote:e=>{e.note=null,e.isOpen=!1}}}),{setNote:EE,clearNote:AE}=L0.actions,kE=L0.reducer,TE=e=>e.note;function PE({value:e}){const n=W(),s=!!e;return t.jsx(Oe,{title:e||"Sin nota",children:t.jsx(U,{onClick:()=>n(EE({note:e,isOpen:!0})),disabled:!s,children:"ver"})})}const DE={files:[],open:!1},z0=Ee({name:"files",initialState:DE,reducers:{openFileCenter:(e,n)=>{const s=n.payload;s.length?(e.open=!0,e.files=s):(e.open=!1,e.files=[])},closeFileCenter:e=>{e.open=!1,e.files=[]}}}),{openFileCenter:$E,closeFileCenter:RE}=z0.actions,NE=z0.reducer,OE=e=>e.files,Ro=(e,n)=>e?e.length<=n?e:`${e.slice(0,n)}...`:"";function ME({value:e}){const n=W(),s=()=>{n($E(e))},o=e!=null&&e.length?t.jsxs("div",{style:{maxWidth:"300px"},children:[t.jsxs("div",{style:{borderBottom:"1px solid #eee",marginBottom:"8px",paddingBottom:"4px"},children:["Total archivos: ",e.length]}),t.jsx("ol",{style:{margin:0,paddingLeft:"20px"},children:e.map(r=>t.jsx("li",{style:{marginBottom:"4px"},children:Ro(r.name,24)},r.id))})]}):"Sin archivos";return t.jsx(Oe,{title:o,placement:"topLeft",children:t.jsx(U,{onClick:s,disabled:!(e!=null&&e.length),children:"ver"})})}const xi={dollarSign:"$",euroSign:"€",poundSign:"£",rd:"RD$"},ct=e=>{var n=Number(e);if(isNaN(n))return 0;var s=n.toFixed(2),o=s.toString().split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),o.join(".")},Y=(e,n=xi.dollarSign)=>{switch(n){case"rd":return`${xi.rd}${ct(e)}`;case"euro":return`${xi.euroSign}${ct(e)}`;case"pound":return`${xi.poundSign}${ct(e)}`;default:return`${n}${ct(e)}`}},FE=({type:e="text",value:n,cellProps:s={},format:o})=>{const r=()=>{switch(o){case"price":return Y(Number(n));case"percentage":return`${Number(n).toFixed(2)}%`;case"currency":return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(Number(n));default:return n}};switch(e){case"image":return t.jsx(BE,{children:t.jsx(LE,{src:n,alt:"cell-image",...s})});case"number":return t.jsx("span",{children:Number(n).toLocaleString(s.locale||"es-MX")});case"status":return t.jsx(jE,{status:n});case"badge":return t.jsx(F0,{text:r()});case"custom":return s.render?s.render(n):n;case"date":const i=Ve.convertMillisToLuxonDate(n);return t.jsx(B0,{dateTime:i});case"dateStatus":return t.jsx(IE,{timestamp:n});case"note":return t.jsx(PE,{value:n});case"file":return t.jsx(ME,{value:n});default:return t.jsx("span",{children:r()})}},BE=l.div`
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
`,LE=l.img`
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
`,zE=l.div`
  position: relative;
`,nm=(e,n)=>e.cell?e.cell({value:n}):t.jsx(FE,{type:e.type,value:n,cellProps:e.cellProps,format:e.format}),UE=({loading:e=!1,shouldGroup:n,groupedData:s,currentData:o,columnOrder:r,onRowClick:i,emptyText:a,isWideScreen:c,isWideLayout:d})=>{const u=r.filter(f=>f.status==="active"),p=(f,x,g)=>{i&&(x==null?void 0:x.clickable)!==!1&&i(g)},h=t.jsxs(WE,{columns:u,children:[n?Object.entries(s).map(([f,x])=>t.jsxs(m.Fragment,{children:[t.jsx(qE,{children:f}),x.map((g,y)=>t.jsx(Pd,{columns:u,isWideScreen:c,isWideLayout:d,children:u.map((b,v)=>t.jsx(sm,{align:b.align,fixed:b.fixed,clickable:(b==null?void 0:b.clickable)!==!1,columns:u,onClick:C=>p(C,b,g),children:nm(b,g[b.accessor])},v))},y))]},f)):o.map((f,x)=>t.jsx(Pd,{columns:u,isWideScreen:c,isWideLayout:d,children:u.map((g,y)=>t.jsx(sm,{align:g.align,fixed:g.fixed,clickable:(g==null?void 0:g.clickable)!==!1,columns:u,onClick:b=>p(b,g,f),children:nm(g,f[g.accessor])},y))},x)),!o.length&&t.jsx(si,{text:a})]});return t.jsx(zE,{children:t.jsx(ku,{loading:e,overlay:!0,children:h})})},WE=l.div`
 display: grid;
   align-content: flex-start;
   gap: 0.2em 1em;
`,qE=l.div`
  background-color: #f0f0f09e;
  padding: 10px;
  font-weight: bold;
  // Otros estilos que desees agregar
`,sm=l.div`
  display: flex;
  align-items: center;
  padding: 0 10px;
  height: 100%;
  height: 3.4em;
  position: ${e=>e.fixed?"sticky":"relative"};
  ${e=>e.fixed==="left"&&`
    left: 0;
    z-index: 1;
    background-color: white;
    border-right: 1px solid var(--Gray1);
  `}
  ${e=>e.fixed==="right"&&`
    right: 0;
    z-index: 1;
    background-color: white;
    border-left: 1px solid var(--Gray1);
  `}
  justify-content: ${e=>e.align||"flex-start"};
  text-align: ${e=>e.align||"left"};
  ${e=>e.clickable&&`
    cursor: pointer;
  `}
  ${e=>{var n,s;return((n=e==null?void 0:e.columns)==null?void 0:n.minWidth)&&`
    min-width: ${(s=e==null?void 0:e.columns)==null?void 0:s.minWidth};
  `}}
`,VE=({firstPage:e,prevPage:n,nextPage:s,lastPage:o,pageCount:r,currentPage:i})=>{const a=Math.max(1,r),c=Math.max(0,Math.min(i,a-1)),d=c===0,u=c===a-1;return t.jsxs(GE,{children:[t.jsx(bi,{onClick:e,disabled:d,responsive:!0,"aria-label":"Primera página",children:z.arrows.AnglesLeft}),t.jsx(bi,{onClick:n,disabled:d,"aria-label":"Página anterior",children:z.arrows.chevronLeft}),t.jsxs(_E,{children:[c+1," / ",a]}),t.jsx(bi,{onClick:s,disabled:u,"aria-label":"Página siguiente",children:z.arrows.chevronRight}),t.jsx(bi,{onClick:o,disabled:u,responsive:!0,"aria-label":"Última página",children:z.arrows.AnglesRight})]})},GE=l.div`
  display: flex;
  gap: 0.5em;
  justify-self: center;
  justify-content: space-between;
  align-items: center;

  height: 100%;
 
`,_E=l.div`
 

  display: flex;
  justify-content: center;
`,bi=l.button`
 

  cursor: pointer;
  height: 2em;
  width: 2em;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 100px;
  border: none;
  &:hover:not(:disabled) {
    background-color: #e0e0e0;
  }

  &:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }
  ${e=>{switch(e.responsive){case!0:return`
        @media (max-width: 600px){
          display: none;
        }
        `}}}
`,HE=({elementsShown:e,totalElements:n,elementName:s,footerLeftSide:o,currentPage:r,pageCount:i,nextPage:a,prevPage:c,firstPage:d,lastPage:u,footerRightSide:p,toggleReorderMenu:h})=>t.jsxs(QE,{children:[t.jsxs(YE,{children:[t.jsxs(JE,{children:[e," / ",n,s&&t.jsx(XE,{children:s})]}),o||""]}),t.jsx(VE,{currentPage:r,pageCount:i,nextPage:a,prevPage:c,firstPage:d,lastPage:u}),t.jsxs(KE,{children:[p&&p,t.jsx(ke,{title:"columnas",onClick:h,startIcon:z.operationModes.setting})]})]}),QE=l.div`
   padding: 0 1em;
    z-index: 1;
    grid-template-columns: 1fr 1fr 1fr;
    display: grid;
    align-items: center;
    background-color: white;
  height: 3em;
  border-top: var(--border-primary);
`,YE=l.div`
  justify-self: start;
  display: flex;
  gap: 1em;
  align-items: center;
`,KE=l.div`
  justify-self: end;
`,JE=l.div`
  display: flex;
  white-space: nowrap;
  align-items: center;
  border-radius: var(--border-radius);
  gap: 0.5em;
  padding: 0.2em 1em;
  font-weight: 600;
  font-size: 0.9em;
  background-color: #d3d3d3;
`,XE=l.div`
  font-weight: 600;
  font-size: 1em;
  color: var(--color-gray);
  text-transform: capitalize;
  @media (max-width: 1100px) {
    display: none;
  }
`,ZE=(e,n)=>`tableColumnsOrder_${e}_${n}`,U0=(e,n)=>{const s=new Set(e.map(r=>r.accessor)),o=new Set(n.map(r=>r.accessor));return e.length!==n.length||[...s].some(r=>!o.has(r))||[...o].some(r=>!s.has(r))},eA=(e,n,s)=>{const o=e.map(r=>({...r,status:r.status||"active"}));if(!n)return o;try{const r=localStorage.getItem(s);if(!r)return o;const i=JSON.parse(r);if(U0(e,i))return localStorage.removeItem(s),o;const a=tA(i);return nA(e,a)}catch(r){return console.error("Error al cargar la configuración de columnas:",r),o}},tA=e=>e.filter(n=>!(Object.keys(n).length===1&&n.status===!0)),nA=(e,n)=>{const s=n.map(o=>{const r=e.find(i=>i.accessor===o.accessor);return r?{...r,status:o.status}:null}).filter(o=>o!==null);return e.forEach(o=>{n.some(i=>i.accessor===o.accessor)||s.push({...o,status:"active"})}),s},sA=(e=[],n,s)=>{const o=ZE(s,n),r=m.useCallback(()=>eA(e,n,o),[n,e,o]),[i,a]=m.useState(r);m.useEffect(()=>{const d=r();U0(e,i)&&a(d)},[e,r]),m.useEffect(()=>{n&&localStorage.setItem(o,JSON.stringify(i))},[i,o,n]);const c=m.useCallback(()=>{n&&(localStorage.removeItem(o),a(e.map(d=>({...d,status:"active"}))))},[n,e,o]);return[i,a,c]},oA=({label:e,filterOptions:n,onChange:s,onClear:o,format:r,selectedValue:i})=>{const[a,c]=m.useState(!1),d=()=>c(!a),u=f=>{s({target:{value:f}})},p=m.useRef(null);kt(p,a,()=>c(!1));const h=()=>o();return t.jsxs(rA,{ref:p,children:[t.jsxs(iA,{onClick:d,selectedValue:i,children:[e,a?z.arrows.caretUp:z.arrows.caretDown]}),a&&t.jsxs(aA,{children:[t.jsx(cA,{children:n.map((f,x)=>t.jsx(lA,{isSelected:i==f.value,onClick:()=>u(f.value),children:r?r(f.label):f.label}))}),t.jsx(dA,{children:t.jsx("button",{onClick:h,disabled:!i,children:"Limpiar"})})]})]})},rA=l.div`
    background-color: ${e=>e.theme.bg.shave};
    display: flex;
    align-items: center;
    position: relative;
    
`,iA=l.div`
    height: 2.2em;
    border-radius: 8px;
    justify-content: space-between;
    gap:1em;
    border: 2px solid #cccccc;
    display: flex;
    align-items: center;
    background-color: ${e=>e.theme.bg.shade};
    padding: 0 0.4em;
    ${e=>e.selectedValue&&`
        border: 2px solid ${e.theme.bg.color};
        
    `}
`,aA=l.div`
     position: absolute;
    height: 300px;
    display: grid;
    grid-template-rows: 1fr min-content;
    min-width: 300px;
    top: 100%;
    background-color: rgb(242, 242, 242);
    z-index: 100;
    border-radius: 8px;
    border: 1px solid #cccccc;
    box-shadow: 0 0 10px 0 rgba(0,0,0,0.2) ;
    overflow-y: hidden;
    `,cA=l.div`
    top: 100%;
    background-color: rgb(255, 255, 255);
    z-index: 100;
    overflow-y: scroll;
    

`,lA=l.div`
    border-bottom: 1px solid #cccccc;
    height: 2.4em;
    display: flex;
    padding: 0 1em;
    align-items: center;
    :last-child{
        border-bottom: none;
    }
    :hover{
        background-color: #5e5e5e + cc;
    }
   ${e=>e.isSelected===!0&&`
        background-color: #9cb2f0;

    `}
`,dA=l.div`
    display: flex;
    
    height: 2.2em;
    button{
        flex-grow: 1;
        border: none;
        background-color: gray;
        font-weight: 500 ;
        color: white;
        :disabled{
            background-color: #cccccc;
            color: #666666;

        }
    }

`,uA=({filterConfig:e=[],setFilter:n,filter:s,defaultFilter:o,setDefaultFilter:r})=>{const i=c=>{const d={...s};d[c]&&o[c]&&(delete d[c],d[c]=o[c]),d[c]&&!o[c]&&delete d[c],n(d)},a=()=>Object.keys(s).every(c=>s[c]===o[c]);return t.jsxs(hA,{children:[t.jsxs(pA,{children:[t.jsx("span",{children:z.operationModes.filter}),t.jsx("div",{children:"Filtrar por:"})]}),t.jsx(mA,{children:e.length>0&&e.map((c,d)=>t.jsx(oA,{label:c.label,filterOptions:c.options,format:c.format,onChange:u=>n({...s,[c.accessor]:u.target.value}),onClear:()=>i(c.accessor),selectedValue:s[c.accessor]},d))}),t.jsx(ke,{onClick:r,disabled:a(),endIcon:z.operationModes.cancel,title:"Limpiar Filtros"})]})},pA=l.div`
 display: flex;
 gap: 0.5em;
 span > svg{
        font-size: 1.2em;
        color: #696969cc;
 }
  div{
    @media (max-width: 1000px ){
      display: none;
    }
  } 
`,mA=l.div`
  display: flex;
  gap: 0.6em;
  align-items: center;
`,hA=l.div`
  display: flex;
  align-items: center;
  padding: 0 1em;
  gap: 2em;
  height: 2.5em;
`;function Ct(e){const n=ce.local(),s=n.year,o={empty:null,today:n.startOf("day"),yesterday:n.minus({days:1}).startOf("day"),thisWeek:n.startOf("week"),lastWeek:n.minus({weeks:1}).startOf("week"),thisMonth:n.startOf("month"),lastMonth:n.minus({months:1}).startOf("month"),thisYear:n.startOf("year"),lastYear:n.minus({years:1}).startOf("year"),thisQuarter:n.startOf("quarter"),lastQuarter:n.minus({quarters:1}).startOf("quarter"),firstQuarter:ce.local(s,1,1).startOf("day"),secondQuarter:ce.local(s,4,1).startOf("day"),thirdQuarter:ce.local(s,7,1).startOf("day"),fourthQuarter:ce.local(s,10,1).startOf("day"),last30Days:n.minus({days:30}).startOf("day")},r={empty:null,today:n.endOf("day"),yesterday:n.minus({days:1}).endOf("day"),thisWeek:n.endOf("week"),lastWeek:n.minus({weeks:1}).endOf("week"),thisMonth:n.endOf("month"),lastMonth:n.minus({months:1}).endOf("month"),thisYear:n.endOf("year"),lastYear:n.minus({years:1}).endOf("year"),thisQuarter:n.endOf("quarter"),lastQuarter:n.minus({quarters:1}).endOf("quarter"),firstQuarter:ce.local(s,3,ce.local(s,3,1).daysInMonth).endOf("month").endOf("day"),secondQuarter:ce.local(s,6,ce.local(s,6,1).daysInMonth).endOf("month").endOf("day"),thirdQuarter:ce.local(s,9,ce.local(s,9,1).daysInMonth).endOf("month").endOf("day"),fourthQuarter:ce.local(s,12,ce.local(s,12,1).daysInMonth).endOf("month").endOf("day"),last30Days:n.endOf("day")};return!o[e]||!r[e]?(console.warn(`Parámetro de rango de fecha no reconocido: ${e}. Usando 'thisMonth' por defecto.`),{startDate:o.thisMonth.toMillis(),endDate:r.thisMonth.toMillis()}):{startDate:o[e].toMillis(),endDate:r[e].toMillis()}}const gA=()=>m.useMemo(()=>({menuOptions:[{label:"Hoy",...Ct("today"),category:"General"},{label:"Ayer",...Ct("yesterday"),category:"General"},{label:"Esta semana",...Ct("thisWeek"),category:"Semana"},{label:"La semana pasada",...Ct("lastWeek"),category:"Semana"},{label:"Este mes",...Ct("thisMonth"),category:"Mes"},{label:"El mes pasado",...Ct("lastMonth"),category:"Mes"},{label:"Este año",...Ct("thisYear"),category:"Año"},{label:"El año pasado",...Ct("lastYear"),category:"Año"},{label:"Primer trimestre",...Ct("firstQuarter"),category:"Trimestre"},{label:"Segundo trimestre",...Ct("secondQuarter"),category:"Trimestre"},{label:"Tercer trimestre",...Ct("thirdQuarter"),category:"Trimestre"},{label:"Cuarto trimestre",...Ct("fourthQuarter"),category:"Trimestre"}]}),[]);function Ps(){const[e,n]=m.useState(window.innerWidth);return m.useEffect(()=>{const s=()=>{n(window.innerWidth)};return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),e}const Tu=({setDates:e,dates:n})=>{const[s,o]=m.useState(null),[r,i]=m.useState(null),[a,c]=m.useState(null),{styles:d,attributes:u}=ju(s,r,{modifiers:[{name:"arrow"}]}),[p,h]=m.useState(!1),f=m.useRef(null),x=()=>h(!p),g=(P,w,S)=>{e({startDate:P,endDate:w})},{menuOptions:y}=gA(),b=()=>{const{startDate:P,endDate:w}=n,S=y.find(E=>E.startDate===P&&E.endDate===w);return S&&`${S.label||"Personalizado"}`},v=m.useMemo(()=>b(),[n,y]),C=y.reduce((P,w)=>{const S=w.category||"general";return P[S]||(P[S]=[]),P[S].push(w),P},{});kt(f,p,()=>h(!1));const I=Object.keys(C),j=P=>{if(P&&typeof P=="number")return ce.fromMillis(P).toLocaleString(ce.DATE_MED)},k=Ps(),A=(P=[],w=4)=>k<800?Ro(P,w):P.length>400?Ro(P,4):P;return t.jsxs(yA,{ref:f,children:[t.jsx(U,{ref:o,icon:t.jsx(O,{icon:nc}),title:A(v,4)||"Filtrar Fechas",onClick:x,children:A(v,4)||"Filtrar Fechas"}),p&&t.jsxs(vA,{ref:i,style:d.popper,...u.popper,children:[t.jsxs(fA,{children:[t.jsx(Qe,{variant:"h4",disableMargins:!0,children:"Rango Seleccionado"}),t.jsxs(Qe,{disableMargins:!0,children:[v||`${j(n.startDate)} - ${j(n.endDate)}`," "]})]}),t.jsx(xA,{children:t.jsx(bA,{children:I.map(P=>t.jsxs(CA,{children:[t.jsx("h3",{children:P}),t.jsx(wA,{children:C[P].map((w,S)=>t.jsx(jA,{isActive:v===w.label,onClick:()=>g(w.startDate,w.endDate,w.label),children:w.label},S))})]}))})})]}),t.jsx("div",{ref:c,style:d.arrow})]})},fA=l.div`
    background-color: white;
    padding: 0.5em 1em ;
  
`,xA=l.div`
padding: 1em;
overflow-y: auto;
`,bA=l.div`
    display: grid;
    gap: 2em 1em;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
`,yA=l.div`
    
`,vA=l.ul`
    max-width: 800px;
    width: 100%;
    height: calc(100vh - 12em);
    align-content: start;
    overflow-y: scroll;
    display: flex;
    flex-direction: column;
    background-color: #F1F1F1;
    border: 1px solid #ccc;
    border-radius: var(--border-radius);
    padding: 0;
    list-style: none;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.212);
    z-index: 100000;
    transition: opacity 0.2s ease-in-out;
    overflow-y: hidden;
`,jA=l.li`
    list-style: none;
    display: flex;
    align-items: center;
    padding: 0 1em;
    height: 2.6em;
    margin: 0;
    font-weight: 450;
    font-size: 14px;
    border-radius: 6px;
    background-color: ${e=>e.isActive?"#2772e4":"#ffffff"}; 
    color: ${e=>e.isActive?"#ffffff":"#000000"};
    text-transform: capitalize;
    
`,CA=l.div`
    display: grid;
    align-content: start;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    text-align: left;
    gap: 0.5em;
    h3 {
        font-size: 14px;
        font-weight: 600;
        text-transform: uppercase;
    } 
`,wA=l.div`
    display: grid;
    gap: 0.5em;
    text-align: left;
    padding: 0;
    margin: 0;
    @media (max-width: 800px) {
        grid-template-columns: 1fr ;
    }
`,{RangePicker:SA}=yt,IA=()=>{const e=We().startOf("day");return[e.toISOString(),e.endOf("day").toISOString()]},om=()=>[null,null],vc=({setDates:e,dates:n,datesDefault:s,dateOptionsMenu:o=!1})=>{m.useEffect(()=>{s==="today"&&e(IA())},[s]);const r=a=>{e(a?{startDate:a[0].startOf("day").valueOf(),endDate:a[1].endOf("day").valueOf()}:om())},i=()=>{e(om())};return t.jsxs(EA,{children:[t.jsx(rm,{children:t.jsx(SA,{value:n!=null&&n.startDate&&(n!=null&&n.endDate)?[We(n.startDate),We(n.endDate)]:null,format:"DD/MM/YY",onChange:r,style:{width:"200px"}})}),s==="empty"&&t.jsx(rm,{children:t.jsx(ke,{startIcon:t.jsx(O,{icon:ZC}),title:"Limpiar",onClick:i})}),o&&t.jsx(Tu,{setDates:e,dates:n})]})},EA=l.div`
  display: grid;
  width: 100%;
  grid-template-columns:max-content;
  gap: 0.4em;
`,rm=l.div`
  display: flex;
  justify-content: end;
  flex-direction: column;
  gap: 0.2em;
`;function Pu(e=800){const[n,s]=m.useState(window.innerWidth>800);return m.useEffect(()=>{const o=()=>{s(window.innerWidth>e)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),n}const AA=(e,n)=>e.reduce((s,o)=>((s[o[n]]=s[o[n]]||[]).push(o),s),{}),kA=()=>{const[e,n]=m.useState(window.innerWidth>=1600);return m.useEffect(()=>{const s=()=>{n(window.innerWidth>=1600)};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),e},rn=m.memo(({groupBy:e,numberOfElementsPerPage:n=30,loading:s=!1,headerComponent:o,filterUI:r,datePicker:i=!1,footerLeftSide:a,footerRightSide:c,columns:d=[],data:u=[],filterConfig:p=[],searchTerm:h="",elementName:f,tableName:x,dateRange:g,defaultDate:y,setDateRange:b,emptyText:v="No hay datos para mostrar",onRowClick:C,title:I})=>{const j=m.useRef(null),k=D(q),[A,P]=m.useState(!1),[w,S,E]=sA(d,x,k==null?void 0:k.uid),T=()=>{P(!A)},[R,N,G,Q,ae]=fI(p,u),oe=gI(p,u),Z=h?$n(ae,h):ae,{handleSort:J,sortedData:X,sortConfig:me}=uI(Z,d),{currentData:fe,nextPage:se,prevPage:ee,firstPage:K,lastPage:B,currentPage:_,pageCount:L}=pI(u,X,Z,n,j),H=(me.direction==="none"||me.key===null)&&e,ne=H?AA(fe,e):X,pe=u==null?void 0:u.length,ye=fe==null?void 0:fe.length,Pe=Pu(1366),Ue=kA();return t.jsxs(PA,{headerComponent:r||o,datesFilter:b,title:I,children:[I&&t.jsx(DA,{children:I}),r||g?t.jsxs(TA,{children:[r&&t.jsx(uA,{setFilter:N,filterConfig:oe,filter:R,defaultFilter:Q,setDefaultFilter:G}),i&&t.jsx(vc,{dates:g,setDates:b,datesDefault:y})]}):o&&t.jsx("div",{children:o}),t.jsxs($A,{columns:d,children:[t.jsxs(RA,{ref:j,isWideScreen:Pe,children:[t.jsx(xI,{columnOrder:w,handleSort:J,sortConfig:me,isWideScreen:Pe,isWideLayout:Ue}),t.jsx(UE,{columnOrder:w,currentData:fe,emptyText:v,groupedData:ne,onRowClick:C,shouldGroup:H,loading:s,isWideScreen:Pe,isWideLayout:Ue})]}),t.jsx(HE,{currentPage:_,elementName:f,elementsShown:ye,firstPage:K,footerLeftSide:a,footerRightSide:c,lastPage:B,nextPage:se,pageCount:L,prevPage:ee,toggleReorderMenu:T,totalElements:pe}),t.jsx(cI,{resetColumnOrder:E,isOpen:A,toggleOpen:T,columns:d,columnOrder:w,setColumnOrder:S})]})]})}),TA=l.div`
display: flex;
align-items: center;
padding: 0.2em 0.4em;
`,PA=l.div`
  border: var(--border-primary);
  height: 100%;
  display: grid;
  background-color: ${e=>e.theme.bg.shade};
  border-radius: 0.4em;
  overflow: hidden;
  
  /* Auto-fit grid template rows based on content presence */
  grid-template-rows: ${e=>{const n=[];return e.title&&n.push("min-content"),(e.headerComponent||e.datesFilter)&&n.push("min-content"),n.push("1fr"),n.join(" ")}};
`,DA=l.div`
  padding: 0.8em 1em;
  font-size: 1.1em;
  height: min-content;
  font-weight: 600;
  background-color: ${e=>e.theme.bg.primary};
  border-bottom: var(--border-primary);
`,$A=l.div`
  display: grid;
  grid-template-rows: 1fr min-content;
  overflow: hidden;
  position: relative;
  width: 100%;
  isolation: isolate; // Para manejar el z-index de las columnas fijas
`,RA=l.div`
  display: grid;
  width: 100%;
  height: 100%;
  grid-template-rows: min-content 1fr;
  overflow-y: scroll;
  overflow-x: auto;
  background-color: #ffffff;
  position: relative;

  /* Mejora el comportamiento del scroll horizontal */
  &::-webkit-scrollbar {
    height: 8px;
    width: 8px;
  }

  &::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  &::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
  }
`,Pd=l.div`
  display: grid;
  grid-template-columns: ${e=>e.isWideLayout?e.columns.map(n=>n.keepWidth?`minmax(${n.minWidth||"100px"}, ${n.maxWidth||"1fr"})`:"1fr").join(" "):e.columns.map(n=>`minmax(${n.minWidth||"100px"}, ${n.maxWidth||"1fr"})`).join(" ")};
  align-items: center;
  gap: 0.6em;
  position: relative;
  min-width: fit-content;
  width: 100%;
`,NA=[{id:"delayed",name:"Atrasado",color:"#e66767"},{id:"pending",name:"Pendiente",color:"#f5a623"},{id:"requested",name:"Solicitado",color:"#ebdc54"},{id:"delivered",name:"Entregado",color:"#7de08b"},{id:"canceled",name:"Cancelado",color:"#797979"}],Go=[{id:"cash",label:"Contado",icon:mu},{id:"one_week",label:"1 semana",icon:ew},{id:"fifteen_days",label:"15 días",icon:tw},{id:"thirty_days",label:"30 días",icon:nw},{id:"other",label:"Otros",icon:sw}],W0=()=>NA.find(e=>e.id==="pending"),q0=()=>Go.find(e=>e.id==="cash"),V0=e=>e&&Go.find(n=>n.id===e)||null,OA={SALES:"/sales",BILLS:"/bills",PREORDERS:"/preorders"},MA={CASH_RECONCILIATION_LIST:"/cash-reconciliation",CASH_RECONCILIATION_OPENING:"/cash-register-opening",CASH_RECONCILIATION_CLOSURE:"/cash-register-closure/:id",CASH_RECONCILIATION_INVOICE_OVERVIEW:"/cash-register-invoices-overview"},Dd={CHANGELOG_CREATE:"/changelog/create",CHANGELOG_MANAGE:"/changelog/manage",CHANGELOG_LIST:"/changelogs/list"},FA={CREATE_BUSINESS:"/dev/business/create",BUSINESSES:"/dev/businesses",ALL_USERS:"/all-users",CHANGELOG_CREATE:Dd.CHANGELOG_CREATE,CHANGELOG_MANAGE:Dd.CHANGELOG_MANAGE,APP_CONFIG:{ROOT:"/dev/app-config",LOGIN_IMAGE:"/dev/app-config/login-image"},SWITCH_BUSINESS:"/dev/business/switch"},BA={UTILITY:"/utility",UTILITY_REPORT:"/utility/report"},LA={HOME:"/home",WELCOME:"/"},zA={LOGIN:"/login",SIGNUP:"/signup"},Sr="/inventory",Du=`${Sr}/warehouses`,G0=`${Du}/products-stock`,UA=`${G0}/:productId`,_0=`${Du}/warehouse/:warehouseId`,H0=`${_0}/shelf/:shelfId`,Q0=`${H0}/row/:rowId`,WA=`${Q0}/segment/:segmentId`,qA={CREATE_PRODUCT:`${Sr}/create-product`,PRODUCT:`${Sr}/product/:productId`,INVENTORY_ITEMS:"/inventory/items",CATEGORIES:"/inventory/categories",WAREHOUSES:`${Du}`,WAREHOUSE:`${_0}`,SHELF:`${H0}`,ROW:`${Q0}`,SEGMENT:`${WA}`,PRODUCTS_STOCK:G0,PRODUCT_STOCK:`${UA}`,CREATE_WAREHOUSE:`${Sr}/warehouses/create`,EDIT_WAREHOUSE:`${Sr}/warehouses/edit/:id`,INVENTORY_SERVICES:"/inventory/services",PRODUCT_IMAGES_MANAGER:"/inventory/product-images-manager",PRODUCT_OUTFLOW:"/inventory/product_outflow",SERVICE_OUTFLOW:"/inventory/service_outflow"},VA={CLIENTS:"/contact",SUPPLIERS:"/suppliers"},GA={SETTINGS:"/settings",SETTING:"/general-config",USERS:"/users",USERS_LIST:"list",CREATE_USER:"create-user/",UPDATE_USER:"update-user/:id",APP_INFO:"/app-info",BUSINESS_INFO:"/business-info",TAX_RECEIPT:"/tax-receipt",GENERAL_CONFIG_BILLING:"/general-config/billing",GENERAL_CONFIG_BUSINESS:"/general-config/business",GENERAL_CONFIG_TAX_RECEIPT:"/general-config/tax-receipt",GENERAL_CONFIG_USERS:"/general-config/users",GENERAL_CONFIG_APP_INFO:"/general-config/app-info"},_A={PURCHASES:"/purchases",PURCHASES_CREATE:"/purchases/create",PURCHASES_UPDATE:"/purchases/update/:id",PURCHASES_COMPLETE:"/purchases/complete/:id",BACKORDERS:"/backorders"},HA={ORDERS:"/orders",ORDERS_CREATE:"/orders/create",ORDERS_UPDATE:"/orders/update/:id",ORDERS_CONVERT:"/orders/convert-to-purchase/:id"},QA={EXPENSES:"/expenses",EXPENSES_CREATE:"/expenses/new",EXPENSES_UPDATE:"/expenses/update/:id",EXPENSES_LIST:"/expenses/list",EXPENSES_CATEGORY:"/expenses/categories"},YA={ACCOUNT_RECEIVABLE_LIST:"/account-receivable/list",ACCOUNT_RECEIVABLE_INFO:"/account-receivable/info/:id",RECEIVABLE_PAYMENT_RECEIPTS:"/account-receivable/receipts"},KA={INSURANCE_CONFIG:"/insurance/config",INSURANCE_LIST:"/insurance/list",INSURANCE_CREATE:"/insurance/create",INSURANCE_EDIT:"/insurance/edit/:id",INSURANCE_DETAILS:"/insurance/details/:id"},re={UTILITY_TERM:BA,BASIC_TERM:LA,AUTH_TERM:zA,CASH_RECONCILIATION_TERM:MA,EXPENSES_TERM:QA,ACCOUNT_RECEIVABLE:YA,SALES_TERM:OA,INVENTORY_TERM:qA,CONTACT_TERM:VA,SETTING_TERM:GA,PURCHASE_TERM:_A,ORDER_TERM:HA,DEV_VIEW_TERM:FA,CHANGELOG_TERM:Dd,INSURANCE_TERM:KA},jc={...re};function Tt(e,...n){const s=Array.isArray(n[0])?n[0]:n,o=e.match(/\/:([a-zA-Z0-9_]+)/g)||[];if(o.length>s.length){const i=o[s.length];throw new Error(`Missing value for parameter "${i.slice(2)}".`)}let r=0;return e.replace(/\/:[a-zA-Z0-9_]+/g,()=>`/${s[r++]}`)}const Y0=m.createContext(),K0={isOpen:!1,title:"Ingresa un titulo",type:"neutro",message:"Ingresa un mensaje",onConfirm:null,onCancel:null},JA=({children:e})=>{const[n,s]=m.useState(K0);return t.jsx(Y0.Provider,{value:{dialog:n,setDialog:s},children:e})},Ds=()=>{const e=m.useContext(Y0);if(!e)throw new Error("useDialog debe ser usado dentro de un DialogProvider");const{dialog:n,setDialog:s}=e;return{dialog:n,setDialogConfirm:i=>s({...n,...i}),onClose:()=>s(K0)}},XA=async(e,n)=>{if(!e||!e.businessID)return;const s=F($,"businesses",e.businessID,"orders",n);try{const o=await Se(s);if(!o.exists()){console.warn("Order not found");return}const r=o.data(),i=[];r.replenishments&&r.replenishments.forEach(c=>{c.selectedBackOrders&&c.selectedBackOrders.length>0&&c.selectedBackOrders.forEach(d=>i.push(d.id))});const a=dt($);i.forEach(c=>{const d=F($,"businesses",e.businessID,"backOrders",c);a.update(d,{status:"pending",reservedBy:null,reservedAt:null,orderId:null,updatedAt:de(),updatedBy:e.uid})}),a.update(s,{status:"canceled",updatedAt:de(),updatedBy:e.uid}),await a.commit(),console.log(`Order ${n} cancelled successfully, back orders released.`)}catch(o){console.error("Error cancelling order: ",o)}};function ZA({order:e}){const n=Fe(),{setDialogConfirm:s}=Ds(),o=D(q),{ORDERS_CONVERT:r,ORDERS_UPDATE:i}=jc.ORDER_TERM,a=()=>{const u=Tt(r,e.id);n(u)},c=()=>{const u=Tt(i,e.id);n(u)},d=()=>{s({title:"Cancelar pedido",isOpen:!0,type:"error",message:"¿Está seguro que desea cancelar este pedido?",onConfirm:()=>XA(o,e.id)})};return e.status!=="pending"?null:t.jsxs("div",{style:{display:"flex",alignItems:"center",borderRadius:"8px"},children:[t.jsx(Ao,{icon:t.jsx(Zx,{}),tooltip:"Completar compra 2",color:"#555",hoverColor:"#52c41a",onClick:a}),t.jsx(Ao,{icon:t.jsx(es,{}),tooltip:"Editar",color:"#555",hoverColor:"#faad14",onClick:c}),t.jsx(Ao,{icon:t.jsx(ht,{}),tooltip:"Cancelar pedido",color:"#555",hoverColor:"#ff4d4f",onClick:d})]})}const ek=[{Header:"#",accessor:"number",minWidth:"50px",maxWidth:"50px",keepWidth:!0,fixed:"left"},{Header:"Estado",accessor:"status",type:"status",maxWidth:"150px",minWidth:"150px"},{Header:"Proveedor",minWidth:"150px",accessor:"provider"},{Header:"Fecha Pedido",accessor:"createdAt",maxWidth:"140px",minWidth:"140px",type:"date"},{Header:"Fecha Pago",accessor:"paymentDate",maxWidth:"140px",minWidth:"140px",type:"dateStatus"},{Header:"Evidencia",accessor:"fileList",maxWidth:"90px",minWidth:"90px",align:"right",type:"file"},{Header:"Nota",accessor:"note",maxWidth:"70px",minWidth:"70px",keepWidth:!0,type:"note"},{Header:"Items",accessor:"items",align:"right",minWidth:"80px",maxWidth:"80px",type:"badge"},{Header:"Total",accessor:"total",align:"right",minWidth:"120px",maxWidth:"120px",format:"price",type:"badge"},{Header:"Acción",accessor:"action",align:"right",keepWidth:!0,maxWidth:"120px",minWidth:"120px",fixed:"right",cell:({value:e})=>t.jsx(ZA,{order:e})}],$d=e=>e.reduce((n,s)=>{const o=Number(s.baseCost)*Number(s.quantity),r=Number(s.taxPercentage)||0,i=o*r/100,a=Number(s.freight)||0,c=Number(s.otherCosts)||0,d=o+i+a+c;return{totalProducts:n.totalProducts+Number(s.quantity),totalBaseCost:n.totalBaseCost+o,totalShipping:n.totalShipping+a,totalOtherCosts:n.totalOtherCosts+c,totalTax:n.totalTax+i,grandTotal:n.grandTotal+d}},{totalProducts:0,totalBaseCost:0,totalShipping:0,totalOtherCosts:0,totalTax:0,grandTotal:0}),tk=(e,n)=>{if(!e)return null;let s=0;switch(n){case"cash":s=0;break;case"one_week":s=7;break;case"fifteen_days":s=15;break;case"thirty_days":s=30;break;case"other":s=0;break}return ce.fromMillis(e).plus({days:s}).toMillis()},J0=e=>{let n=0;return e&&Array.isArray(e)&&e.forEach(s=>{s.quantity&&typeof s.quantity=="number"&&(n+=s.quantity)}),n},nk=({orders:e=[],loading:n=!0})=>{const s=e.map(o=>{var c;const r=(o==null?void 0:o.createdAt)||null,i=r?tk(r,o==null?void 0:o.condition):null,{grandTotal:a}=$d(o.replenishments);return{number:o==null?void 0:o.numberId,status:o==null?void 0:o.status,provider:(c=o==null?void 0:o.provider)==null?void 0:c.name,condition:o==null?void 0:o.condition,note:o==null?void 0:o.note,createdAt:o==null?void 0:o.createdAt,paymentDate:i,items:J0(o==null?void 0:o.replenishments),deliveryDate:o==null?void 0:o.deliveryDate,fileList:(o==null?void 0:o.attachmentUrls)||[],total:a,action:o}});return t.jsx(rn,{tableName:"Lista de Pedidos Pendientes",columns:ek,data:s,loading:n})},Cc=({value:e,onChange:n,options:s=[],placeholder:o="Seleccionar",allowClear:r=!1,clearText:i,width:a,defaultStyles:c={color:"#666",bgColor:"#ffffff",borderColor:"#d9d9d9",hoverBgColor:"#f5f5f5",selectedBgColor:"#e6f7ff",selectedColor:"#1890ff",icon:null},popperConfig:d={placement:"bottom-start",modifiers:[{name:"offset",options:{offset:[0,8]}},{name:"preventOverflow",options:{boundary:"viewport"}}]}})=>{const[u,p]=m.useState(!1),[h,f]=m.useState(""),x=m.useRef(null),g=m.useRef(null),[y,b]=m.useState(null),{styles:v,attributes:C}=ju(x.current,y,d),I=s.filter(A=>!A||!A.label?!1:A.label.toString().toLowerCase().includes(h.toLowerCase())),j=e?s.find(A=>(A==null?void 0:A.value)===e):{label:o,icon:c.icon,...c};if(!j||!j.label)return console.warn("Selector: Invalid option format detected"),null;kt(g,u,()=>p(!1));const k=(A,P)=>({...{color:P?c.selectedColor:c.color,bgColor:P?c.selectedBgColor:c.bgColor,borderColor:c.borderColor,hoverBgColor:c.hoverBgColor},...A});return t.jsxs(sk,{ref:g,children:[t.jsxs(ok,{ref:x,onClick:()=>p(!u),styles:k(j,!1),$width:a,$hasIcon:!!j.icon,children:[j.icon?t.jsx(O,{icon:j.icon}):null,t.jsx("span",{children:j.label}),t.jsx(rk,{isOpen:u,children:t.jsx(O,{icon:Do})})]}),u&&t.jsxs(ik,{ref:b,style:v.popper,...C.popper,children:[t.jsxs(ak,{children:[t.jsx(ck,{icon:hu}),t.jsx(lk,{type:"text",placeholder:"Buscar...",value:h,onChange:A=>f(A.target.value),autoFocus:!0})]}),r&&t.jsx(im,{onClick:()=>{n(null),p(!1)},styles:{color:e?c.color:"#1890ff",bgColor:e?c.bgColor:"#e6f7ff",borderColor:e?c.borderColor:"#91d5ff"},isSelected:!e,children:t.jsx("span",{children:i||"Mostrar todos"})},"null-option"),I.map(A=>t.jsxs(im,{onClick:()=>{n(A.value),p(!1)},styles:k(A,e===A.value),isSelected:e===A.value,children:[A.icon&&t.jsx(O,{icon:A.icon}),t.jsx("span",{children:A.label})]},A.value))]})]})},sk=l.div`
    position: relative;
`,ok=l.button`
    display: grid;
    grid-template-columns: ${({$hasIcon:e})=>e?"min-content 1fr min-content":"1fr min-content"};
    align-items: center;
    padding: 7px 12px;
    background: ${({styles:e})=>e.bgColor};
    color: ${({styles:e})=>e.color};
    border: 1px solid ${({styles:e})=>e.borderColor};
    border-radius: 6px;
    font-size: 0.9rem;
    cursor: pointer;
    gap: 8px;
    width: ${({$width:e})=>e||"min-content"};
    min-width: 160px;
    
    span {
        white-space: nowrap;
        overflow: hidden;
        text-align: start;
        text-overflow: ellipsis;
    }

    &:hover {
        filter: brightness(0.95);
    }
`,rk=l.span`
    transition: transform 0.2s;
    transform: rotate(${e=>e.isOpen?"180deg":"0deg"});
`,ik=l.ul`
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    padding: 4px;
    min-width: 200px;
    width: max-content;
    z-index: 1000;
    list-style: none;
    margin: 0;
`,im=l.li`
    padding: 8px 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    border-radius: 6px;
    color: ${({styles:e})=>e.color};
    background: ${({isSelected:e,styles:n})=>e?n.bgColor:"white"};

    &:hover {
        background: ${({styles:e})=>e.hoverBgColor||e.bgColor};
    }
`,ak=l.div`
    display: flex;
    align-items: center;
    padding: 8px;
    border-bottom: 1px solid #eee;
    margin-bottom: 4px;
`,ck=l(O)`
    color: #999;
    margin-right: 8px;
`,lk=l.input`
    border: none;
    outline: none;
    width: 100%;
    font-size: 0.9rem;
    
    &::placeholder {
        color: #999;
    }
`,dk=[{value:"completed",label:"Completado",icon:oc,color:"#52c41a",bgColor:"#f6ffed",borderColor:"#b7eb8f"},{value:"pending",label:"Pendiente",icon:Gr,color:"#faad14",bgColor:"#fffbe6",borderColor:"#ffe58f"},{value:"canceled",label:"Cancelado",icon:qx,color:"#ff4d4f",bgColor:"#fff1f0",borderColor:"#ffccc7"},{value:"processing",label:"En Proceso",icon:An,color:"#1890ff",bgColor:"#e6f7ff",borderColor:"#91d5ff"}],uk=({value:e,onChange:n,statusOptions:s=dk,visibleStatus:o=[],placeholder:r="Estado",showAllOption:i=!1,width:a,showAllLabel:c="Mostrar todos"})=>{const d=o.length>0?s.filter(p=>o.includes(p.value)):s,u={color:"#666",bgColor:"#ffffff",borderColor:"#d9d9d9",icon:Gr};return t.jsx(Cc,{value:e,onChange:n,options:d,placeholder:r,showAllOption:i,defaultStyles:u,width:a})},pk=(e={},n={isAscending:!1})=>{const[s,o]=m.useState({filters:e,isAscending:n.isAscending}),r=m.useRef(e);m.useEffect(()=>{JSON.stringify(e)!==JSON.stringify(r.current)&&(o(d=>({...d,filters:e})),r.current=e)},[e]);const i=m.useCallback(d=>{const u=Object.fromEntries(Object.entries(d).filter(([p,h])=>h!==null));o(p=>({...p,filters:u}))},[]),a=m.useCallback(d=>{o(u=>({...u,isAscending:d}))},[]),c=m.useCallback(()=>{o({filters:e,isAscending:n.isAscending})},[e,n.isAscending]);return{state:s,setFilters:i,setSorting:a,resetAll:c}},$u=m.memo(({config:e={},onChange:n,searchTerm:s,onSearchTermChange:o,dataConfig:r={}})=>{var I;const{state:i,setFilters:a,setSorting:c,resetAll:d}=pk(e.defaultValues,e.defaultSort),[u,p]=m.useState(!1);m.useEffect(()=>{n==null||n(i)},[]);const h=m.useCallback(j=>{a(j),n==null||n({...i,filters:j})},[i,n,a]),f=m.useCallback(j=>{c(j),n==null||n({filters:i.filters,isAscending:j})},[i.filters,n,c]),x=m.useCallback(()=>{var j;d(),n==null||n({filters:e.defaultValues||{},isAscending:((j=e.defaultSort)==null?void 0:j.isAscending)??!1})},[e.defaultValues,e.defaultSort,n,d]),g=(j,k)=>{const A={...i.filters,[j]:k};h(A)},y=m.useCallback((j,k)=>{if(j.type==="search")return null;let A=j.options||[];if(r[j.key]){const{data:P,accessor:w}=r[j.key];A=P.map(w)}switch(j.type){case"status":return t.jsx(Yc,{children:t.jsx(uk,{value:i.filters[j.key],onChange:P=>g(j.key,P),visibleStatus:j.visibleStatus,placeholder:j.placeholder,clearText:j.clearText,allowClear:!0,width:k?"100%":void 0})},"status");case"select":return t.jsx(Yc,{children:t.jsx(Cc,{value:i.filters[j.key],onChange:P=>g(j.key,P),options:A,placeholder:j.placeholder,clearText:j.clearText,icon:j.icon,showSearch:j.showSearch,allowClear:!0,width:k?"100%":void 0})},j.key);default:return null}},[i.filters,r]),b=t.jsx(Yc,{children:t.jsx(ie,{placeholder:"Buscar...",value:s,onChange:j=>o(j.target.value),allowClear:!0,style:{width:"200px"}})},"search"),v=m.useMemo(()=>{var j;return(j=e.filters)==null?void 0:j.map(k=>y(k,!1))},[e.filters,y]),C=t.jsxs(t.Fragment,{children:[b,v,e.showSortButton&&t.jsx(am,{children:t.jsx(Oe,{title:i.isAscending?"Ordenar descendente":"Ordenar ascendente",children:t.jsx(U,{onClick:()=>f(!i.isAscending),icon:t.jsx(O,{icon:i.isAscending?ka:Mr}),type:"default"})})}),e.showResetButton&&t.jsx(am,{children:t.jsx(Oe,{title:"Restablecer filtros",children:t.jsx(U,{onClick:x,icon:t.jsx(O,{icon:Eo}),type:"default",danger:!0})})})]});return t.jsxs(mk,{children:[t.jsx(gk,{children:t.jsx(hk,{children:C})}),t.jsxs(fk,{children:[t.jsxs(xk,{children:[t.jsx(ie,{placeholder:"Buscar...",value:s,onChange:j=>o(j.target.value),allowClear:!0,style:{flex:1}}),t.jsx(U,{onClick:()=>p(!0),icon:t.jsx(O,{icon:Eo}),children:"Filtros"})]}),t.jsx(Rt,{title:"Filtros",placement:"bottom",onClose:()=>p(!1),open:u,width:"100%",children:t.jsxs(bk,{children:[(I=e.filters)==null?void 0:I.map(j=>y(j,!0)),t.jsxs(yk,{children:[e.showSortButton&&t.jsx(U,{onClick:()=>f(!i.isAscending),icon:t.jsx(O,{icon:i.isAscending?ka:Mr}),type:"default",children:i.isAscending?"Ordenar descendente":"Ordenar ascendente"}),e.showResetButton&&t.jsx(U,{onClick:x,icon:t.jsx(O,{icon:Eo}),type:"primary",danger:!0,children:"Restablecer filtros"})]})]})})]})]})});$u.displayName="FilterBar";const mk=l.div`
  background-color: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  padding: 0.2rem;
  
  @media (max-width: 768px) {
    border-radius: 0;
    padding: 0.5rem;
    position: sticky;
    top: 0;
    z-index: 100;
  }
`,hk=l.div`
  display: flex;
  gap: 0.3rem;
  flex-wrap: wrap;

  @media (max-width: 768px) {
    gap: 0.5rem;
    
    /* Hacer que los elementos ocupen todo el ancho en móvil */
    & > div {
      flex: 1 1 100%;
      min-width: 100%;
    }

    /* Los botones de ordenar y reset se mantienen en línea */
    & > div:last-child,
    & > div:nth-last-child(2) {
      flex: 0 1 auto;
      min-width: auto;
    }
  }
`,Yc=l.div`
  /* Asegurar que los inputs y selectores tengan el ancho completo en móvil */
  @media (max-width: 768px) {
    .ant-input,
    .ant-select {
      width: 100% !important;
    }
  }
`,am=l.div`
  display: flex;
  gap: 0.3rem;
  align-items: center;

  @media (max-width: 768px) {
    margin-left: auto;
  }
`;l.div`
  display: flex;
  align-items: center;
  gap: 8px;
  
  svg {
    color: #666;
    font-size: 0.9em;
  }
`;l.span`
  background-color: var(--primary);
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.8em;
  font-weight: 500;
`;l.span`
  color: ${e=>e.color};
  font-size: 0.8em;
  display: flex;
  align-items: center;
`;l.div`
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  color: #666;
  border-bottom: 1px solid #f0f0f0;
  
  &:hover {
    background-color: #f5f5f5;
  }
  
  svg {
    font-size: 0.9em;
  }
`;const gk=l.div`
  @media (max-width: 768px) {
    display: none;
  }
`,fk=l.div`
  display: none;
  @media (max-width: 768px) {
    display: block;
  }
`,xk=l.div`
  display: flex;
  gap: 8px;
  background-color: white;
  position: sticky;
  top: 0;
  z-index: 100;
`,bk=l.div`
  display: flex;
  flex-direction: column;
  gap: 16px;

  .ant-select {
    width: 100%;
  }
`,yk=l.div`
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 16px;
  background: white;
  border-top: 1px solid #f0f0f0;
  display: flex;
  gap: 8px;
  justify-content: flex-end;
`,vk=(e,n)=>e!=null&&e.length?[...e].sort((s,o)=>{const r=s.createdAt?new Date(s.createdAt).getTime():0,i=o.createdAt?new Date(o.createdAt).getTime():0;return n?r-i:i-r}):e,jk=(e,n)=>e!=null&&e.length?[...e].sort((s,o)=>{const r=s.createdAt?new Date(s.createdAt).getTime():0,i=o.createdAt?new Date(o.createdAt).getTime():0;return n?r-i:i-r}):e,Ck=(e,n,s)=>{const o=F($,"businesses",e,"orders",n);return Te(o,s)},wk=e=>e instanceof J1,X0=(e,n)=>wk(n)?n:F($,...e,n),Z0=async e=>{try{const n=await Se(e);return n.exists()?n.data():(console.warn("El documento no existe:",e.path),null)}catch(n){return console.error("Error al obtener el documento:",n),null}},Sk=(e,n,s)=>{let r=le($,"businesses",e,"orders");if(n){const i=[];n.status&&i.push(te("status","==",n.status)),n.condition&&i.push(te("condition","==",n.condition)),n.providerId&&i.push(te("provider","==",n.providerId)),i.length>0&&(r=he(r,...i))}return Te(r,s)},Ik=async(e,n)=>{if(!n)return{};const s=X0(["businesses",e,"providers"],n),o=await Z0(s);return(o==null?void 0:o.provider)||{}},Ek=async(e,n)=>{const s=await Ik(n,e==null?void 0:e.provider);return{...e,provider:s}},eb=e=>(["createdAt","updatedAt","deliveryAt","paymentAt","completedAt"].forEach(s=>{e[s]&&typeof e[s].toMillis=="function"&&(e[s]=e[s].toMillis())}),e),Ak=e=>{const n=D(q),[s,o]=m.useState([]),[r,i]=m.useState(!1),a=m.useMemo(()=>s?(e==null?void 0:e.isAscending)!==void 0?jk(s,e.isAscending):s:[],[s,e==null?void 0:e.isAscending]);return m.useEffect(()=>{if(!(n!=null&&n.businessID))return;i(!0);const c=Sk(n.businessID,e==null?void 0:e.filters,async d=>{try{const u=await Promise.all(d.docs.map(async p=>{const h=p.data(),f=eb(h);return Ek(f,n.businessID)}));o(u)}catch(u){console.error("Error fetching orders:",u)}finally{i(!1)}});return()=>{c(),i(!1)}},[n,e==null?void 0:e.filters]),{orders:a,isLoading:r}},tb=e=>{const[n,s]=m.useState(null),[o,r]=m.useState(!1),i=D(q);return m.useEffect(()=>{if(!(i!=null&&i.businessID)||!e)return;r(!0);const a=Ck(i.businessID,e,async c=>{try{if(!c.exists()){s(null);return}const d=c.data(),u=eb(d);s(u)}catch(d){console.error("Error fetching single order:",d),s(null)}finally{r(!1)}});return()=>{a(),r(!1)}},[i,e]),{order:n,isLoading:o}},cm=()=>({filters:[{type:"select",key:"condition",placeholder:"Condiciones",allowClear:!0,icon:mu,options:Go.map(e=>({value:e.id,label:e.label,icon:e.icon}))},{type:"status",key:"status",visibleStatus:["pending","completed","canceled","processing"],placeholder:"Estado"},{type:"select",key:"providerId",placeholder:"Proveedores",icon:gu,showSearch:!0}],defaultValues:{status:"pending",providerId:null,condition:null},defaultSort:{isAscending:!1},showSortButton:!0,showResetButton:!0}),oi=()=>{const[e,n]=m.useState([]),[s,o]=m.useState(!0),r=D(q);return m.useEffect(()=>{if(!r||!(r!=null&&r.businessID)){o(!1);return}const i=le($,"businesses",r.businessID,"providers");(async()=>{o(!0);try{const c=Te(i,d=>{let u=d.docs.map(p=>p.data());n(u),o(!1)});return()=>c()}catch(c){console.error("Error fetching providers:",c),o(!1)}finally{o(!1)}})()},[r]),{providers:e,loading:s}},kk=()=>{const[e,n]=m.useState(""),[s,o]=m.useState(()=>{var f;const h=cm();return{filters:h.defaultValues,isAscending:((f=h.defaultSort)==null?void 0:f.isAscending)??!0}}),{providers:r=[]}=oi(),i=m.useMemo(()=>cm(),[]),a=m.useMemo(()=>({providerId:{data:r,accessor:h=>h?{value:h.provider.id||"",label:h.provider.name||"Sin nombre"}:null}}),[r]),c=m.useCallback(h=>{o(h)},[]),{orders:d,isLoading:u}=Ak(s),p=Au(d,e);return t.jsxs(Tk,{children:[t.jsx(Ze,{sectionName:"Pedidos"}),t.jsxs(Pk,{children:[t.jsx($u,{config:i,onChange:c,searchTerm:e,onSearchTermChange:n,dataConfig:a}),t.jsx(nk,{loading:u,orders:p})]})]})},Tk=l.div`
  width: 100%;
  height: 100vh;
  overflow: hidden;
  background-color: var(--color2);
  display: grid;
  grid-template-rows: min-content 1fr;
`,Pk=l.div`
  padding: 0.5;
  display: grid;
  grid-template-rows: min-content 1fr;
  overflow: hidden;
`,{TextArea:MCe}=ie,{Text:nb}=Xe;l.div`
  display: flex;
  flex-direction: column;
  gap: 16px;
`;l(M)`
  display: flex;
  flex-direction: column;
  gap: 16px;
`;l.div`
  display: flex;
  flex-direction: column;
`;l(nb)`
  margin-bottom: 8px;
  display: block;
`;l.strong`
  color: #ff4d4f;
  margin-left: 4px;
`;l(ie)`
 
`;l(nb)`
  font-size: 15px;
`;const Dk=(e,n,s=!0)=>{const[o,r]=m.useState(!1),[i,a]=m.useState(e||""),c=m.useRef(null);return m.useEffect(()=>{if(!e){r(!1),a("");return}const d=n.current,u=c.current;if(!d||!u)return;const p=()=>{const f=window.getComputedStyle(d),x=d.clientWidth;d.clientHeight,parseInt(f.lineHeight)||parseInt(f.fontSize);const g=document.createElement("span");g.style.visibility="hidden",g.style.position="absolute",g.style.whiteSpace="nowrap",g.style.font=f.font,document.body.appendChild(g);const y=I=>(g.textContent=I,g.offsetWidth<=x);if(y(e)){r(!1),a(e),document.body.removeChild(g);return}let b=0,v=e.length,C="";for(;b<=v;){const I=Math.floor((b+v)/2),j=e.slice(0,I)+"...";y(j)?(C=j,b=I+1):v=I-1}document.body.removeChild(g),r(!0),a(C)};p();const h=new ResizeObserver(p);return h.observe(d),()=>{h.disconnect()}},[e,n,s]),{isTruncated:o,truncatedText:i,textRef:c,showTooltip:o&&s}},$k=l.div`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  width: 100%;
  display: inline-block;
`;function Rk({value:e,useTooltip:n=!0}){const s=m.useRef(null),{truncatedText:o,textRef:r,showTooltip:i}=Dk(e,s,n);return e?t.jsx(Oe,{title:i?e:"",children:t.jsx($k,{ref:s,children:t.jsx("span",{ref:r,children:o})})}):null}function Nk({value:e}){return e?t.jsx(Rk,{value:e}):null}function Ok({purchaseData:e}){const n=Fe(),{PURCHASES_UPDATE:s,PURCHASES_COMPLETE:o}=jc.PURCHASE_TERM,r=()=>{const a=Tt(o,e.id);n(a)},i=()=>{const a=Tt(s,e.id);n(a)};if(e.status==="completed")return null;if(e.status==="pending")return t.jsxs("div",{style:{display:"flex",alignItems:"center",borderRadius:"8px"},children:[t.jsx(Ao,{icon:t.jsx(Zx,{}),tooltip:"Completar compra",color:"#555",hoverColor:"#52c41a",onClick:r}),t.jsx(Ao,{icon:t.jsx(es,{}),tooltip:"Editar",color:"#555",hoverColor:"#faad14",onClick:i}),t.jsx(Ao,{icon:t.jsx(ht,{}),tooltip:"Cancelar compra",color:"#555",hoverColor:"#ff4d4f",onClick:e.onCancel})]})}const Mk=[{Header:"#",accessor:"number",type:"number",maxWidth:"50px",minWidth:"50px",keepWidth:!0,fixed:"left"},{Header:"Estado",accessor:"status",type:"status",maxWidth:"150px",minWidth:"150px"},{Header:"Proveedor",accessor:"provider",minWidth:"150px",cell:({value:e})=>t.jsx(Nk,{value:e})},{Header:"Fecha Delivery",accessor:"deliveryAt",maxWidth:"140px",minWidth:"140px",type:"dateStatus"},{Header:"Fecha Pago",accessor:"paymentAt",minWidth:"140px",maxWidth:"140px",type:"dateStatus"},{Header:"Evidencia",accessor:"fileList",maxWidth:"90px",minWidth:"90px",align:"right",type:"file"},{Header:"Nota",accessor:"note",maxWidth:"70px",minWidth:"70px",keepWidth:!0,type:"note"},{Header:"Items",accessor:"items",align:"right",minWidth:"80px",maxWidth:"80px",type:"badge"},{Header:"Total",accessor:"total",align:"right",minWidth:"150px",maxWidth:"150px",format:"price",type:"badge"},{Header:"Acción",accessor:"action",maxWidth:"120px",minWidth:"120px",keepWidth:!0,align:"right",fixed:"right",cell:({value:e})=>t.jsx(Ok,{purchaseData:e})}],Fk=async(e,n)=>{if(!e||!(e!=null&&e.businessID))return console.warn("Usuario no autenticado"),{success:!1,message:"Usuario no autenticado"};const s=F($,"businesses",e.businessID,"purchases",n);try{const o=await Se(s);if(!o.exists())return console.warn("Compra no encontrada"),{success:!1,message:"Compra no encontrada"};const r=o.data(),i=[];r.replenishments&&r.replenishments.forEach(c=>{c.selectedBackOrders&&c.selectedBackOrders.length>0&&c.selectedBackOrders.forEach(d=>i.push(d.id))});const a=dt($);if(i.forEach(c=>{const d=F($,"businesses",e.businessID,"backOrders",c);a.update(d,{status:"pending",reservedBy:null,reservedAt:null,purchaseId:null,updatedAt:de(),updatedBy:e.uid})}),a.update(s,{status:"canceled",canceledAt:de(),updatedAt:de(),updatedBy:e.uid}),r.orderId){const c=F($,"businesses",e.businessID,"orders",r.orderId);a.update(c,{status:"canceled",canceledAt:de(),updatedAt:de(),updatedBy:e.uid})}return await a.commit(),console.log(`Compra ${n} cancelada exitosamente, back orders liberados y pedido cancelado.`),{success:!0,message:"Compra y pedido cancelados exitosamente"}}catch(o){throw console.error("Error al cancelar la compra:",o),{success:!1,message:"Error al cancelar la compra",error:o}}};function Bk({purchases:e,loadingPurchases:n}){const{setDialogConfirm:s}=Ds(),o=D(q),r=c=>{s({title:"Cancelar compra",isOpen:!0,type:"error",message:"¿Está seguro que desea cancelar esta compra?",onConfirm:async()=>{await Fk(o,c.id)},successMessage:"Compra cancelada exitosamente"})},a=(e||[]).map(c=>{var d;return{state:c==null?void 0:c.state,condition:c==null?void 0:c.condition,number:c==null?void 0:c.numberId,provider:(d=c==null?void 0:c.provider)==null?void 0:d.name,note:c==null?void 0:c.note,deliveryAt:c==null?void 0:c.deliveryAt,status:c==null?void 0:c.status,fileList:(c==null?void 0:c.attachmentUrls)||[],items:J0(c==null?void 0:c.replenishments),paymentAt:c==null?void 0:c.paymentAt,total:((c==null?void 0:c.replenishments)||[]).reduce((u,{subtotal:p})=>u+p,0),action:{...c,onCancel:()=>r(c)},dateGroup:ce.fromMillis(c==null?void 0:c.createdAt).toLocaleString(ce.DATE_FULL)}});return t.jsx(t.Fragment,{children:t.jsx(rn,{tableName:"Lista de Compras",columns:Mk,data:a,loading:n,groupBy:"dateGroup"})})}const Lk={purchases:[]},sb=Ee({name:"purchases",initialState:Lk,reducers:{updatePurchases:(e,n)=>{const s=n.payload;e.purchases=s}}}),{updatePurchases:zk}=sb.actions,ob=e=>e.purchases.purchases,Uk=sb.reducer,Wk={modals:{chartPurchaseModal:{isOpen:!1}}},rb=Ee({name:"purchaseUI",initialState:Wk,reducers:{togglePurchaseChartModal:e=>{e.modals.chartPurchaseModal.isOpen=!e.modals.chartPurchaseModal.isOpen}}}),{togglePurchaseChartModal:ib}=rb.actions,qk=rb.reducer,Vk=e=>e.purchaseUI.modals.chartPurchaseModal;pt.register(It,Et,on,At);const Gk={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Monto de Compras"}},x:{title:{display:!0,text:"Fecha"}}},plugins:{tooltip:{callbacks:{label:function(e){let n=e.dataset.label||"";return n&&(n+=" "+Y(e.parsed.y)),n}}}}},_k=(e,n=!1)=>{const s=new Date(e);return n?s.toLocaleDateString(void 0,{day:"numeric",month:"long",year:"numeric"}):s.toLocaleDateString()},Hk=(e,n=!1)=>e.reduce((s,o)=>{const r=_k(o.data.dates.createdAt,n);return s[r]=s[r]||{total:0},s[r].total+=o.data.total,s},{}),lm=e=>{const[n,s,o]=e.split("/").map(Number);return new Date(o,s-1,n)},Qk=({purchases:e})=>{if(!e||!Array.isArray(e))return null;const n=e.reduce((c,d)=>{const u=d.data.dates.createdAt;return c.min=Math.min(c.min,u),c.max=Math.max(c.max,u),c},{min:1/0,max:-1/0}),o=(n.max-n.min)/(1e3*60*60*24*30)>2,r=m.useMemo(()=>Hk(e,o),[e,o]),i=m.useMemo(()=>{const c=Object.keys(r).sort((u,p)=>lm(p)-lm(u)),d=c.map(u=>r[u].total);return{labels:c,datasets:[{label:"Compras",data:d,backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]}},[r]),a=m.useRef(null);return m.useEffect(()=>()=>{a.current&&a.current instanceof pt&&a.current.destroy()},[]),m.useEffect(()=>()=>{a.current&&a.current instanceof pt&&a.current.destroy()},[]),t.jsxs(Yk,{children:[t.jsx(Qe,{variant:"h3",children:"Compras Totales por Día"}),t.jsx(jt,{ref:a,data:i,options:Gk})]})},Yk=l.div`
    height: 200px;
 
    display: grid;
    gap: 1em;
`;pt.register(It,Et,on,At);const Kk={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Monto de Compras"}},x:{title:{display:!0,text:"Proveedor"}}},plugins:{tooltip:{callbacks:{label:function(e){let n=e.dataset.label||"";return n&&(n+=" "+Y(e.parsed.y)),n}}}}},Jk=e=>e.reduce((n,s)=>{const o=s.data.provider.name;return n[o]=n[o]||{total:0},n[o].total+=s.data.total,n},{}),Xk=({purchases:e})=>{if(!e||!Array.isArray(e))return null;const n=m.useMemo(()=>Jk(e),[e]),s=m.useMemo(()=>{const r=Object.keys(n),i=r.map(a=>n[a].total);return{labels:r,datasets:[{label:"Compras",data:i,backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]}},[n]),o=m.useRef(null);return t.jsxs(Zk,{children:[t.jsx(Qe,{variant:"h3",children:"Compras Totales por Proveedor"}),t.jsx(jt,{ref:o,data:s,options:Kk})]})},Zk=l.div`
    height: 200px;
    display: grid;
    gap: 1em;
`;pt.register(It,Et,on,At);const eT={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Monto de Compras"}},x:{title:{display:!0,text:"Categoría"}}},plugins:{tooltip:{callbacks:{label:function(e){let n=e.dataset.label||"";return n&&(n+=" "+Y(e.parsed.y)),n}}}}},tT=e=>e.reduce((n,s)=>(s.data.replenishments.forEach(o=>{const r=o.category;n[r]=n[r]||{total:0},n[r].total+=o.cost*o.newStock}),n),{}),nT=({purchases:e})=>{if(!e||!Array.isArray(e))return null;const n=m.useMemo(()=>tT(e),[e]),s=m.useMemo(()=>{const r=Object.keys(n),i=r.map(a=>n[a].total);return{labels:r,datasets:[{label:"Compras",data:i,backgroundColor:"rgba(153, 102, 255, 0.2)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1}]}},[n]),o=m.useRef(null);return t.jsxs(sT,{children:[t.jsx(Qe,{variant:"h3",children:"Compras Totales por Categoría"}),t.jsx(jt,{ref:o,data:s,options:eT})]})},sT=l.div`
    height: 200px;
    display: grid;
    gap: 1em;
`,oT=e=>{const n={};let s=0;for(let{data:o}of e){const i=new Date(o.dates.createdAt).toLocaleDateString(void 0,{month:"long",year:"numeric"});n[i]=(n[i]||0)+o.total,s+=o.total}return{monthlyData:n,totalAccumulated:s}},rT=({totalAccumulated:e,options:n})=>{const s={labels:["Total Acumulado"],datasets:[{label:"Total Acumulado",data:[e],backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]};return t.jsx(iT,{children:t.jsx(jt,{data:s,options:n})})},iT=l.div`
    // Tu estilización aquí si es necesaria, por ejemplo:
    width: 100%;
    height: 400px;
`,aT=({monthlyData:e,options:n})=>{const s=Object.keys(e),o=s.map(i=>e[i]),r={labels:s,datasets:[{label:"Total por Mes",data:o,backgroundColor:"rgba(255, 159, 64, 0.2)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:1}]};return t.jsx(cT,{children:t.jsx(jt,{data:r,options:n})})},cT=l.div`
    // Tu estilización aquí si es necesaria, por ejemplo:
    width: 100%;
    height: 400px;
`,Kc={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Monto de Compras"}},x:{title:{display:!0,text:"Mes"}}},plugins:{tooltip:{callbacks:{label:function(e){let n=e.dataset.label||"";return n&&(n+=": "+Y(e.parsed.y)),n}}}}},lT=({purchases:e})=>{if(!e||!Array.isArray(e))return null;const{monthlyData:n,totalAccumulated:s}=m.useMemo(()=>oT(e),[e]),o=m.useMemo(()=>Object.keys(n),[n]),r=Math.max(...Object.values(n)),i=Math.max(s,r),a=m.useMemo(()=>({...Kc,scales:{...Kc.scales,y:{...Kc.scales.y,max:i}}}),[i]);return t.jsxs(dT,{children:[t.jsx(Qe,{variant:"h3",children:"Compras Mensuales y Acumuladas"}),t.jsxs(uT,{children:[t.jsx(rT,{totalAccumulated:s,labels:o,options:a}),t.jsx(aT,{monthlyData:n,options:a})]})]})},dT=l.div`
    height: 400px;
    display: grid;
`,uT=l.div`
  display: grid;
  grid-template-columns: 200px 1fr;
  gap: 1em;
`,pT={open:{opacity:1,zIndex:1},close:{opacity:0,zIndex:-1}},mT={open:{opacity:1,y:0},close:{opacity:0,y:"100vh"}},hT=()=>{const e=W(),n=D(ob),{isOpen:s}=D(Vk),o=()=>e(ib()),r=m.useRef(null);return t.jsx(gt,{children:s&&t.jsx(fT,{variants:pT,initial:"close",animate:s?"open":"close",transition:{duration:.5},exit:"close",children:t.jsxs(gT,{ref:r,variants:mT,initial:"close",animate:s?"open":"close",transition:{duration:.5},exit:"close",children:[t.jsxs(xT,{children:[t.jsx(Qe,{variant:"h2",children:"Reporte de compras"}),t.jsx(ke,{title:"Cerrar",onClick:o})]}),t.jsx(Qk,{purchases:n}),t.jsx(Xk,{purchases:n}),t.jsx(nT,{purchases:n}),t.jsx(lT,{purchases:n})]})},"backdrop")})};l.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1em;
`;const gT=l(Ie.div)`
  width: 98vw;
  display: grid;
  gap: 4em;
  align-content: start;
  height: 100%;
  background-color: #ffffff;
  border: 1px solid #1d1d1d37;
  border-radius: 0.5em;
  overflow-y: scroll;
  padding: 0 1em;
  `,fT=l(Ie.div)`
  width: 100%;
  height: calc(100vh);
  display: grid;
  top: 0;
  justify-content: center;
  position: absolute;
  overflow: hidden;
  z-index: 30;
`,xT=l.div`
  display: grid;
  grid-template-columns: 1fr max-content;
  align-items: center;
  position: sticky;
  top: 0;
  padding: 1em 1em 0 ;
  background: white;
  gap: 1em;
  `,dm=()=>({filters:[{type:"select",key:"condition",placeholder:"Condiciones",allowClear:!0,icon:mu,options:Go.map(e=>({value:e.id,label:e.label,icon:e.icon}))},{type:"status",key:"status",visibleStatus:["pending","completed","canceled","processing"],placeholder:"Estado"},{type:"select",key:"providerId",placeholder:"Proveedores",icon:gu,showSearch:!0}],defaultValues:{status:"pending",providerId:null,condition:null},defaultSort:{isAscending:!1},showSortButton:!0,showResetButton:!0}),bT=(e,n)=>{console.log(e,n),n.forEach(s=>{var r;const o=(r=e[s])==null?void 0:r.seconds;o&&(e[s]=o*1e3)})},yT=(e,n,s)=>{let r=le($,"businesses",e,"purchases");if(n){const i=[];n.status&&i.push(te("status","==",n.status)),n.condition&&i.push(te("condition","==",n.condition)),n.providerId&&i.push(te("provider","==",n.providerId)),i.length>0&&(r=he(r,...i))}return Te(r,s)},vT=async(e,n)=>{if(!n)return{};const s=X0(["businesses",e,"providers"],n),o=await Z0(s);return(o==null?void 0:o.provider)||{}},jT=async(e,n)=>{const s=await vT(n,e==null?void 0:e.provider);return{...e,provider:s}},CT=(e,n,s)=>{const o=F($,"businesses",e,"purchases",n);return Te(o,s)},Oa=e=>{if(!e)return e;const n=["createdAt","updatedAt","deliveryAt","paymentAt","completedAt","expirationDate"];if(Array.isArray(e))return e.map(s=>Oa(s));if(typeof e=="object"){const s={...e};return n.forEach(o=>{s[o]&&typeof s[o].toMillis=="function"&&(s[o]=s[o].toMillis())}),Object.keys(s).forEach(o=>{typeof s[o]=="object"&&s[o]!==null&&(s[o]=Oa(s[o]))}),s}return e},wT=e=>{const n=W(),s=D(ob),o=D(q),r=d=>n(zk(d)),[i,a]=m.useState(!1),c=m.useMemo(()=>s?(e==null?void 0:e.isAscending)!==void 0?vk(s,e.isAscending):s:[],[s,e==null?void 0:e.isAscending]);return m.useEffect(()=>{if(!(o!=null&&o.businessID))return;a(!0);const d=yT(o.businessID,e==null?void 0:e.filters,async u=>{try{const p=await Promise.all(u.docs.map(async h=>{const f=h.data(),x=Oa(f);return jT(x,o.businessID)}));r(p)}catch(p){console.error("Error fetching purchases:",p)}finally{a(!1)}});return()=>{d(),a(!1)}},[o,e.filters]),{purchases:c,isLoading:i}},ST=e=>{const[n,s]=m.useState(null),[o,r]=m.useState(!1),i=D(q);return m.useEffect(()=>{if(!(i!=null&&i.businessID)||!e)return;r(!0);const a=CT(i.businessID,e,async c=>{try{if(!c.exists()){s(null);return}const d=c.data(),u=Oa(d);s(u)}catch(d){console.error("Error fetching single purchase:",d),s(null)}finally{r(!1)}});return()=>{a(),r(!1)}},[i,e]),{purchase:n,isLoading:o}},IT=l(Ce)`
  .ant-modal-content {
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(20px);
  }
`,ET=l(Ie.div)`
  text-align: center;
  padding: 24px 20px;
`,AT=l.div`
  font-size: 48px;
  margin-bottom: 24px;
  color: var(--primary-color, #1677ff);
`,kT=l.div`
  font-size: 20px;
  font-weight: 500;
  margin-bottom: 8px;
`,TT=l.div`
  font-size: 40px;
  font-weight: 600;
  margin: 32px 0;
  font-feature-settings: "tnum";
  color: var(--primary-color, #1677ff);
`,PT=l.div`
  text-align: left;
  background: rgba(0, 0, 0, 0.02);
  border-radius: 12px;
  padding: 16px;
  margin: 16px 0;
  font-size: 14px;
  max-height: 120px;
  overflow-y: auto;

  code {
    background: none;
    color: inherit;
    padding: 0;
  }

  p {
    margin: 0;
    line-height: 1.4;
  }
`,DT=l.div`
  font-size: 13px;
  color: #666;
  margin-top: 8px;
`,$T=l.div`
  display: flex;
  gap: 12px;
  margin-top: 24px;
`,um=l(Ie.button)`
  flex: 1;
  height: 44px;
  border-radius: 22px;
  background: #000;
  color: #fff;
  border: none;
  font-size: 15px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  
  &:hover {
    background: var(--primary-color, #1677ff);
  }

  &.secondary {
    background: #f5f5f5;
    color: #000;
    &:hover {
      background: #e8e8e8;
    }
  }
`;function ab({visible:e,onClose:n,purchase:s}){var a,c,d;const o=Fe(),r=((a=s==null?void 0:s.replenishments)==null?void 0:a.reduce((u,p)=>u+(p.subtotal||0),0))||0;(c=s==null?void 0:s.warehouse)==null||c.id;const i=u=>u!=null&&u.length?u.map(p=>`• ${p.quantity} × ${p.name} · $${p.unitCost}`).join(`
`):"";return t.jsx(IT,{open:e,onCancel:n,footer:null,width:600,centered:!0,closable:!1,children:t.jsxs(ET,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[t.jsx(AT,{children:t.jsx(yu,{})}),t.jsx(kT,{children:"¡Compra Completada!"}),((d=s==null?void 0:s.replenishments)==null?void 0:d.length)>0&&t.jsxs(t.Fragment,{children:[t.jsx(PT,{children:t.jsx(TS,{children:i(s.replenishments)})}),t.jsxs(DT,{children:[s.replenishments.length," productos agregados"]})]}),t.jsxs(TT,{children:["$",r.toLocaleString(void 0,{minimumFractionDigits:2})]}),t.jsxs($T,{children:[t.jsxs(um,{className:"secondary",onClick:n,whileHover:{scale:1.02},whileTap:{scale:.98},children:[t.jsx(Qr,{})," Cerrar"]}),t.jsxs(um,{onClick:()=>{o("/inventory/warehouses/warehouse/:warehouseId"),n()},whileHover:{scale:1.02},whileTap:{scale:.98},children:["Ver Almacén ",t.jsx(Qw,{})]})]})]})})}const RT=()=>{var v,C;const e=_t(),[n,s]=m.useState(((v=e.state)==null?void 0:v.showSummary)||!1),[o,r]=m.useState(((C=e.state)==null?void 0:C.completedPurchase)||null),[i,a]=m.useState(""),[c,d]=m.useState(()=>{var j;const I=dm();return{filters:I.defaultValues,isAscending:((j=I.defaultSort)==null?void 0:j.isAscending)??!0}}),{providers:u=[]}=oi(),p=m.useMemo(()=>({providerId:{data:u,accessor:I=>I?{value:I.provider.id||"",label:I.provider.name||"Sin nombre"}:null}}),[u]),h=m.useMemo(()=>dm(),[]),f=m.useCallback(I=>{d(I)},[]),x=m.useCallback(()=>{s(!1),r(null),window.history.replaceState({},document.title)},[]),{purchases:g,isLoading:y}=wT(c),b=Au(g,i);return t.jsxs(NT,{children:[t.jsx(Ze,{sectionName:"Compras"}),t.jsxs(OT,{children:[t.jsx($u,{config:h,onChange:f,searchTerm:i,onSearchTermChange:a,dataConfig:p}),t.jsx(Bk,{purchases:b,loadingPurchases:y})]}),t.jsx(hT,{}),t.jsx(ab,{visible:n,onClose:x,purchase:o})]})},NT=l.div`
  width: 100%;
  height: 100vh;
  overflow: hidden;
  background-color: var(--color2);
  display: grid;
  grid-template-rows: min-content 1fr;
`,OT=l.div`
  padding: 0.5;
  display: grid;
  grid-template-rows: min-content 1fr;

  overflow: hidden;
  `,MT=l("div")`
  display: flex;
  align-items: center;
  background-color: rgba(0, 0, 0, 0.200);
  padding: 0 0.8em;
  height: 2em;
  width: min-content;
  white-space: nowrap;
  border-radius: 100px;
`,FT=l("span")`
  font-size: 1.2em;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  font-weight: bold;
  color: #f3f3f3;
  
  ${e=>{switch(e.size){case"large":return`
       display: block;
        width: 100%;
        font-weight: 600;
        text-align: center;
        margin: 0 auto;
        text-transform: uppercase;
        letter-spacing: 0.1rem;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
        color: #f3f3f3;
        &:hover {
          color: #f1f1f1;
        } font-size: 1.3em;
        
      `}}}
  
  
`,cb=({size:e})=>t.jsx(MT,{children:t.jsx(FT,{size:e,children:"VENTAMAX"})}),lb=async()=>{const e=localStorage.getItem("sessionToken");e&&await Ot(F($,"sessionTokens",e)),localStorage.removeItem("sessionToken")},BT=()=>{const e=Fe(),n=W(),{onClose:s,setDialogConfirm:o}=Ds(),{SETTING:r}=re.SETTING_TERM,i=()=>e(r),a=()=>{n(Kn()),lb(),e("/",{replace:!0})},c=()=>{o({title:"Cerrar sesión",isOpen:!0,type:"warning",message:"¿Está seguro que desea cerrar sesión?",onConfirm:()=>{a(),s()}})};return t.jsxs(LT,{children:[t.jsx(cb,{}),t.jsxs(zT,{children:[t.jsx(ke,{title:z.operationModes.logout,width:"icon32",onClick:c}),t.jsx(ke,{width:"icon32",title:z.operationModes.setting,onClick:i})]})]})},LT=l.div`

    height: 2.75em;
    color: white;
    background-color: var(--color);
    margin: 0;
    display: grid;
    align-items: center;
    grid-template-columns: 1fr auto;
    padding: 0 1em;
    .UserSection{
        
    }
`,zT=l.div`
    display: flex;
    align-items: center;
    gap: 0.4em;
`,UT=()=>{const[e,n]=m.useState(!1);return D(q),D(ft),{isModalOpen:e,showSessionInfo:()=>{n(!0)},hideSessionInfo:()=>{n(!1)}}},db=({logoUrl:e,businessName:n,userName:s})=>t.jsxs(WT,{children:[t.jsx(qT,{children:e?t.jsx(VT,{src:e,alt:"Logo"}):t.jsx(GT,{children:t.jsx(O,{icon:ow.faBriefcase,size:"lg"})})}),t.jsxs(_T,{children:[t.jsxs(HT,{children:[t.jsx(QT,{children:t.jsx(O,{icon:rw.faUser})}),t.jsx(YT,{children:s})]}),t.jsxs(KT,{children:[t.jsx(JT,{children:t.jsx(O,{icon:iw.faStore,size:"xs"})}),t.jsx(XT,{children:n||"Tu Negocio"})]})]})]});db.propTypes={logoUrl:we.string,businessName:we.string,userName:we.string.isRequired};const WT=l.div`
  display: flex;
  align-items: center;
  background-color: rgb(255, 255, 255);
  border-radius: 100px;
  padding: 0.4em 1.5em 0.4em 1em;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
  width: fit-content;
  min-width: 200px;
  max-width: 100%;
`,qT=l.div`
  width: 50px;
  height: 50px;
  margin-right: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  border-radius: 8px;
  background-color: #ffffff;
  flex-shrink: 0;
`,VT=l.img`
  width: 100%;
  height: 100%;
  object-fit: contain;
  max-width: 100%;
  max-height: 100%;
`,GT=l.div`
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-primary-400, #4299e1);
  width: 100%;
  height: 100%;
`,_T=l.div`
  display: flex;
  flex-direction: column;
  gap: 5px;
  overflow: hidden;
`,HT=l.div`
  display: flex;
  align-items: center;
  gap: 6px;
`,QT=l.div`
  display: flex;
  align-items: center;
  color: var(--color-primary-500, #4299e1);
  flex-shrink: 0;
`,YT=l.span`
  font-size: 1rem;
  font-weight: 600;
  line-height: 1;
  font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  color: var(--color-primary-600, #3182ce);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
`,KT=l.div`
  display: flex;
  align-items: center;
  gap: 5px;
`,JT=l.div`
  display: flex;
  align-items: center;
  color: var(--color-gray-500, #718096);
  flex-shrink: 0;
`,XT=l.span`
  font-size: 0.8rem;
  font-weight: 500;
  font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  color: var(--color-gray-500, #718096);
  margin: 0;
  letter-spacing: -0.3px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;


`,ZT=()=>{var d,u;const e=D(q),n=D(ft),{showSessionInfo:s}=UT(),o=(d=e==null?void 0:e.realName)==null?void 0:d.trim(),r=(u=e==null?void 0:e.username)==null?void 0:u.trim(),i=o||r||"Usuario",a=(n==null?void 0:n.logoUrl)||null,c=(n==null?void 0:n.name)||"Tu Negocio";return t.jsx(eP,{onClick:s,children:t.jsx(db,{logoUrl:a,businessName:c,userName:i})})},eP=l.div`
  cursor: pointer;
  padding: 12px 0px;
  border-radius: 12px;
  transition: all 0.3s ease;
  max-width: 450px;
  

`,tP=async()=>{const e=F($,"app","3Iz5UZWWfF4vCJPlDSy1");return(await Se(e)).data()},nP={copyright:"© 2023 GISYS. Todos los derechos reservados."};function sP(e){if(!e)return"";var n=new Date(e.seconds*1e3),s=("0"+n.getDate()).slice(-2),o=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],r=o[n.getMonth()],i=n.getFullYear();return"Versión "+s+" de "+r+" "+i}const oP=()=>{const e=Fe(),[n,s]=m.useState(),o=()=>{e("/changelogs/list")};return m.useEffect(()=>{(async()=>{const i=await tP();s(i)})()},[]),t.jsx(rP,{children:t.jsxs(iP,{children:[t.jsx(cP,{children:nP.copyright}),t.jsx(aP,{onClick:o,children:sP(n==null?void 0:n.version)})]})})},rP=l.div`
  background-color: #ffffff;
  color: #575757;
  padding: 1em;
  max-width: 100vw;
  width: 100%;
  display: flex;
  justify-content: center;


`,iP=l.div`
    width: 100%;
    max-width: 1200px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 400px));
    justify-content: space-between;
    @media (max-width: 768px) {
      grid-template-columns: 1fr;
   
    }
  
`,aP=l.div`
 text-align: right;
  padding: 0.2em;
  font-size: 14px;
  font-weight: 500;
  color: #575757;
  background-color: #ffffff;
  :hover{
    text-decoration: underline;
    cursor: pointer;
  }
`,cP=l.div`
  text-align: left;
  padding: 0.2em;
  font-size: 14px;
  font-weight: 500;
  color: #575757;
  /* Puedes añadir estilos específicos aquí */
`;function lP(){const{can:e,rules:n}=new qo(oo),{SALES_TERM:s,CONTACT_TERM:o,BASIC_TERM:r,INVENTORY_TERM:i,CASH_RECONCILIATION_TERM:a}=re,{CLIENTS:c}=o,{CASH_RECONCILIATION_CLOSURE:d,CASH_RECONCILIATION_INVOICE_OVERVIEW:u,CASH_RECONCILIATION_LIST:p,CASH_RECONCILIATION_OPENING:h}=a,{SALES:f,BILLS:x}=s,{HOME:g}=r,{INVENTORY_ITEMS:y}=i;return e("manage","Bill"),e("manage","Product"),e("manage","CashCount"),e("manage","User"),e("manage","Business"),e(["read","create","update"],"Client"),e(["read","create","update"],"Provider"),e(["read","create","update"],"Category"),e("access",g),e("access",h),e("access",d),e("access",p),e("access",f),e("access",x),e("access",c),e("access",y),n}function dP(e,n){const{SALES_TERM:s,ACCOUNT_RECEIVABLE:o,CONTACT_TERM:r,BASIC_TERM:i,INVENTORY_TERM:a,CASH_RECONCILIATION_TERM:c}=re,{CLIENTS:d}=r,{ACCOUNT_RECEIVABLE_LIST:u,RECEIVABLE_PAYMENT_RECEIPTS:p,ACCOUNT_RECEIVABLE_INFO:h}=o,{CASH_RECONCILIATION_CLOSURE:f,CASH_RECONCILIATION_INVOICE_OVERVIEW:x,CASH_RECONCILIATION_LIST:g,CASH_RECONCILIATION_OPENING:y}=c,{SALES:b,BILLS:v}=s,{HOME:C}=i,{INVENTORY_ITEMS:I}=a;e("manage","Bill"),e("manage","Product"),e(["read","create","update"],"Client"),e(["read","create","update"],"Provider"),e(["read","create","update"],"Category"),e("manage","CashCount"),e("access",C),e("access",y),e("access",f),e("access",g),e("access",u),e("access",p),e("access",h),e("access",b),e("access",v),e("access",d),e("access",I),e("manage","accountReceivable"),e("read","User"),n("read","PriceList"),n("modify","Price"),n("manage","users"),n("access","admin-panel"),n("delete","Product"),n("manage","business-settings")}function uP(e){const{can:n,cannot:s,rules:o}=new qo(oo);return dP(n,s),o}function pP(e){const{can:n,rules:s}=new qo(oo);return n("manage","Order"),n("manage","Purchase"),n("manage","Product"),n("manage","Provider"),n("manage","Category"),n("manage","Inventory"),n("read","User"),s}function mP(e){const{can:n,cannot:s,rules:o}=new qo(oo);return n("manage","all"),s("developerAccess","all"),o}function hP(e){const{can:n,rules:s}=new qo(oo);return n("manage","all"),cannot("developerAccess","all"),s}function gP(e){const{can:n,cannot:s,rules:o}=new qo(oo);return n("developerAccess","all"),n("manage","all"),o}const Qn={cashier:[{action:"read",subject:"PriceList",label:"Ver Lista de Precios",category:"pricing"},{action:"modify",subject:"Price",label:"Modificar Precios",category:"pricing"}],admin:[],manager:[],buyer:[],general:[]};[...Qn.cashier,...Qn.admin,...Qn.manager,...Qn.buyer,...Qn.general];const Jc=e=>{const n=Qn[e]||[],s=Qn.general||[];return[...n,...s]},ub=async(e,n=null)=>{if(!n)throw new Error("currentUser es requerido para obtener permisos dinámicos");try{const s=F($,"businesses",n.businessID,"userPermissions",e),o=await Se(s);return o.exists()?o.data():{userId:e,businessID:n.businessID,additionalPermissions:[],restrictedPermissions:[],createdAt:null,updatedAt:null,createdBy:null}}catch(s){return console.error("Error al obtener permisos dinámicos:",s),{userId:e,businessID:n.businessID,additionalPermissions:[],restrictedPermissions:[],createdAt:null,updatedAt:null,createdBy:null}}},fP=async(e,n,s)=>{try{const o=F($,"businesses",e.businessID,"userPermissions",n),r=new Date,i=await Se(o),a={userId:n,businessID:e.businessID,additionalPermissions:s.additionalPermissions||[],restrictedPermissions:s.restrictedPermissions||[],updatedAt:de(),updatedBy:e.uid};return i.exists()?await je(o,a):await De(o,{...a,createdAt:r,createdBy:e.uid}),!0}catch(o){throw console.error("Error al establecer permisos dinámicos:",o),o}},xP=e=>{const n=Qn[e]||[],s=Qn.general||[];return{roleName:e,roleSpecificCount:n.length,generalCount:s.length,totalAvailable:n.length+s.length,categories:[...new Set([...n.map(o=>o.category),...s.map(o=>o.category)])].filter(Boolean)}},bP={ownerAbilities:hP,adminAbilities:mP,managerAbilities:lP,cashierAbilities:uP,buyerAbilities:pP};function yP(e){return pb(e)}async function vP(e){const n=pb(e);if(!(e!=null&&e.uid))return n;try{const s=await ub(e.uid,e);return jP(n,s,e)}catch(s){return console.warn("Error loading dynamic permissions, using base only:",s),n}}function pb(e){const{adminAbilities:n,cashierAbilities:s,buyerAbilities:o,managerAbilities:r,ownerAbilities:i}=bP;switch(e.role){case"owner":return i(e);case"admin":return n(e);case"cashier":case"specialCashier1":case"specialCashier2":return s(e);case"buyer":return o(e);case"dev":return gP();case"manager":return r(e);default:return[]}}function jP(e,n,s){let o=Array.isArray(e)?[...e]:e.rules||[];return n.additionalPermissions&&n.additionalPermissions.forEach(r=>{o=o.filter(a=>!(a.action===r.action&&a.subject===r.subject&&a.inverted===!0)),o.some(a=>a.action===r.action&&a.subject===r.subject&&!a.inverted)||o.push({action:r.action,subject:r.subject,inverted:!1})}),n.restrictedPermissions&&n.restrictedPermissions.forEach(r=>{o=o.filter(i=>!(i.action===r.action&&i.subject===r.subject)),o.push({action:r.action,subject:r.subject,inverted:!0})}),o}const fa=Za("abilities/loadUserAbilities",async(e,{rejectWithValue:n})=>{try{return await vP(e)}catch(s){return n(s.message)}}),CP={abilities:[],loading:!1,error:null},wP=Ee({name:"abilities",initialState:CP,reducers:{setAbilities:(e,n)=>{e.abilities=yP(n.payload),e.loading=!1,e.error=null},clearAbilities:e=>{e.abilities=[],e.loading=!1,e.error=null}},extraReducers:e=>{e.addCase(fa.pending,n=>{n.loading=!0,n.error=null}).addCase(fa.fulfilled,(n,s)=>{n.abilities=s.payload,n.loading=!1,n.error=null}).addCase(fa.rejected,(n,s)=>{n.loading=!1,n.error=s.payload})}}),SP=wP.reducer,mb=e=>e.abilities.abilities,hb=e=>e.abilities.loading,IP=e=>e.abilities.error,EP=()=>{const e=D(mb),n=D(hb),s=D(IP);return{abilities:e,loading:n,error:s}},AP=()=>{const e=D(q),n=W();m.useEffect(()=>{e&&n(fa(e))},[e,n])};function rs(){const e=D(mb),n=D(hb);return{abilities:new oo(e||[]),loading:n}}const Xc=e=>({id:e,label:e}),_e=Object.freeze({CREATE:Xc("create"),UPDATE:Xc("update"),DELETE:Xc("delete")}),kP={modalAddClient:{isOpen:!1},modalAddProd:{isOpen:!1},modalUpdateProd:{isOpen:!1,id:"",data:{}},modalCategory:{isOpen:!1},modalAddOrder:{isOpen:!1},modalAddPurchase:{isOpen:!1},modalAddProvider:{isOpen:!1},modalSetCustomPizza:{isOpen:!1},modalToggleClient:{isOpen:!1,mode:"create",addClientToCart:!1,data:null},modalToggleProvider:{isOpen:!1,mode:"create",data:null},modalToggleOrderNote:{isOpen:!1,data:null},modalToggleAddCategory:{isOpen:!1,data:null},modalToggleAddProductOutflow:{isOpen:!1},modalToggleSignUp:{isOpen:!1,data:null,businessID:null},modalConfirmOpenCashReconciliation:{isOpen:!1},modalFileList:{isOpen:!1,fileList:[]},modalDeveloper:{isOpen:!1,activeTab:"console"}},gb=Ee({name:"modal",initialState:kP,reducers:{openModalAddClient:e=>{e.modalAddClient.isOpen=!0},closeModalAddClient:e=>{e.modalAddClient.isOpen=!1},openModalAddProd:e=>{e.modalAddProd.isOpen=!0},closeModalAddProd:e=>{e.modalAddProd.isOpen=!1},openModalUpdateProd:(e,n)=>{e.modalUpdateProd.isOpen=!0,e.modalUpdateProd.prodId=n.payload},closeModalUpdateProd:e=>{e.modalUpdateProd.isOpen=!1,e.modalUpdateProd.prodId="",e.modalUpdateProd.data={}},openModalCategory:e=>{e.modalCategory.isOpen=!0},closeModalCategory:e=>{e.modalCategory.isOpen=!1},openModalAddOrder:e=>{let n=e.modalAddOrder.isOpen;e.modalAddOrder.isOpen=!n},closeModalAddOrder:e=>{e.modalAddOrder.isOpen=!1},toggleAddPurchaseModal:e=>{let n=e.modalAddPurchase.isOpen;e.modalAddPurchase.isOpen=!n},openModalAddProvider:e=>{let n=e.modalAddOrder.isOpen;e.modalAddProvider.isOpen=!n},handleModalSetCustomPizza:e=>{let n=e.modalSetCustomPizza.isOpen;e.modalSetCustomPizza.isOpen=!n},toggleClientModal:(e,n)=>{const{mode:s,addClientToCart:o}=n.payload;let r=e.modalToggleClient.isOpen;if(e.modalToggleClient.isOpen=!r,r===!1&&(e.modalToggleClient.mode=_e.CREATE.id,e.modalToggleClient.data=null),o&&(e.modalToggleClient.addClientToCart=o),s===_e.CREATE.id){e.modalToggleClient.mode=s,e.modalToggleClient.data=null;return}if(s===_e.UPDATE.id){e.modalToggleClient.mode=s,e.modalToggleClient.data=n.payload.data;return}},toggleProviderModal:(e,n)=>{const s=_e.CREATE.id,o=_e.UPDATE.id,r=n.payload.mode;let i=e.modalToggleProvider.isOpen;if(e.modalToggleProvider.isOpen=!i,i===!1&&(e.modalToggleProvider.mode=s,e.modalToggleProvider.data=null),r===s){e.modalToggleProvider.mode=r,e.modalToggleProvider.data=null;return}if(r===o){e.modalToggleProvider.mode=r,e.modalToggleProvider.data=n.payload.data;return}},toggleViewOrdersNotes:(e,n)=>{const{data:s,isOpen:o}=n.payload;if(e.modalToggleOrderNote.isOpen=!o,o===!1){e.modalToggleOrderNote.data=null;return}if(s!==null&&s!==!1&&o===!0){if(e.modalToggleOrderNote.data=s,e.modalToggleOrderNote.isOpen=!0,s==null||s==!1){e.modalToggleOrderNote.isOpen=!1,e.modalToggleOrderNote.data=null;return}return}},toggleAddCategory:(e,n)=>{const{isOpen:s,data:o}=n.payload;e.modalToggleAddCategory.isOpen=s,s==="close"&&(e.modalToggleAddCategory.isOpen=!1),o&&(e.modalToggleAddCategory.data=o),o===null&&(e.modalToggleAddCategory.data=null)},toggleAddProductOutflow:(e,n)=>{const s=e.modalToggleAddProductOutflow.isOpen;e.modalToggleAddProductOutflow.isOpen=!s},toggleSignUpUser:(e,n)=>{var s,o,r,i,a;if((s=n.payload)!=null&&s.data&&(e.modalToggleSignUp.data=n.payload.data),(o=n.payload)!=null&&o.businessID&&(e.modalToggleSignUp.businessID=n.payload.businessID),((r=n.payload)==null?void 0:r.isOpen)===void 0){const c=e.modalToggleSignUp.isOpen;e.modalToggleSignUp.isOpen=!c;return}if(((i=n.payload)==null?void 0:i.isOpen)===!1){e.modalToggleSignUp.isOpen=!1,e.modalToggleSignUp.data=null,e.modalToggleSignUp.businessID=null;return}if(((a=n.payload)==null?void 0:a.isOpen)===!0){e.modalToggleSignUp.isOpen=!0;return}},toggleConfirmOpenCashReconciliation:(e,n)=>{const s=e.modalConfirmOpenCashReconciliation.isOpen;e.modalConfirmOpenCashReconciliation.isOpen=!s},toggleFileListModal:(e,n)=>{const s=n.payload,o=!e.modalFileList.isOpen;e.modalFileList.isOpen=o,o===!1?e.modalFileList.fileList=[]:e.modalFileList.fileList=s.fileList},toggleDeveloperModal:(e,n)=>{const s=n.payload,o=!e.modalDeveloper.isOpen;e.modalDeveloper.isOpen=o,s!=null&&s.activeTab&&(e.modalDeveloper.activeTab=s.activeTab)}}}),{closeModalAddClient:TP,openModalUpdateProd:fb,closeModalUpdateProd:Rd,handleModalSetCustomPizza:Ru,toggleProviderModal:Ys,toggleClientModal:Pn,toggleViewOrdersNotes:PP,toggleAddProductOutflow:wc,toggleSignUpUser:ri,toggleFileListModal:DP,toggleDeveloperModal:yn}=gb.actions,$P=e=>e.modal.modalAddClient.isOpen,RP=e=>e.modal.modalUpdateProd.isOpen,NP=e=>e.modal.modalSetCustomPizza.isOpen,OP=e=>e.modal.modalToggleClient,xb=e=>e.modal.modalToggleProvider,MP=e=>e.modal.modalToggleOrderNote,FP=e=>e.modal.modalToggleAddCategory,BP=e=>e.modal.modalToggleAddProductOutflow,LP=e=>e.modal.modalToggleSignUp,zP=e=>e.modal.modalFileList,bb=e=>e.modal.modalDeveloper,UP=gb.reducer,WP=({card:e})=>{const n=W(),s=r=>{if(e.action)switch(r.preventDefault(),e.action){case"openDeveloperModal":n(yn());break;default:console.warn(`Action not implemented: ${e.action}`)}},o=t.jsxs(t.Fragment,{children:[t.jsx(VP,{children:e.icon}),t.jsx(GP,{children:e.title})]});return e.action?t.jsx(qP,{onClick:s,children:o}):t.jsx(yb,{to:e==null?void 0:e.route,children:o})},yb=l(Xa)`
    border-radius: 8px;
    overflow: hidden;
    background-color: #fff;
    min-height: 3em;
    border: 1px solid #eaeaea;
    width: 100%;
    padding: 0.6em 1em;
    display: grid;
    grid-template-columns: min-content 1fr;
    gap: 0.8em;
    align-items: center;
    text-decoration: none;
    transition: all 0.2s ease-in-out;

    &:hover {
        background-color: #f8f9fa;
        border-color: #0086df;
    }
`,qP=l.div`
    border-radius: 8px;
    overflow: hidden;
    background-color: #fff;
    min-height: 3em;
    border: 1px solid #eaeaea;
    width: 100%;
    padding: 0.6em 1em;
    display: grid;
    grid-template-columns: min-content 1fr;
    gap: 0.8em;
    align-items: center;
    text-decoration: none;
    transition: all 0.2s ease-in-out;
    cursor: pointer;

    &:hover {
        background-color: #f8f9fa;
        border-color: #0086df;
    }
`,VP=l.div`
    font-size: 1.3em;
    width: 1.3em;
    height: 1.3em;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #0086df;
`,GP=l.span`
    color: #2c3e50;
    font-size: 0.95em;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;

    ${yb}:hover & {
        color: #0086df;
    }
`,{Typography:_P}=Ne,pm=({title:e,cardData:n})=>{const s=n.reduce((i,a)=>{const{category:c}=a;return i[c]||(i[c]=[]),i[c].push(a),i},{}),[o,r]=st.useState(!1);return t.jsxs(HP,{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx(JP,{level:4,children:e&&e}),t.jsx(U,{type:"text",icon:o?t.jsx(O,{icon:Do,size:"lg"}):t.jsx(O,{icon:Lx,size:"lg"}),onClick:()=>r(!o),style:{color:"#2c3e50"}})]}),!o&&t.jsx(QP,{children:Object.entries(s).map(([i,a])=>t.jsxs(YP,{children:[t.jsx(XP,{children:i}),t.jsx(KP,{cardsCount:a.length,children:a.map((c,d)=>t.jsx(WP,{card:c},d))})]},i))})]})},HP=l.div`
    display: grid;
    gap: 1em;
    background-color: #fff;
    padding: 1em;
    border-radius: 10px;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
`,QP=l.div`
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1em;
    @media (max-width: 768px) {
        grid-template-columns: 1fr;
    }
`,YP=l.div`
    display: grid;
    gap: 0.2em;
    padding: 0.6em;
    align-content: start;
    border-radius: 8px;
    background-color: #fafafa;
`,KP=l.div`
    display: grid;
    grid-template-columns: ${e=>e.cardsCount===1?"1fr":"repeat(auto-fit, minmax(230px, 1fr))"};
    gap: 0.6em;
`,JP=l(_P.Title)`
    color: #2c3e50 !important;
    margin: 0 !important;
    font-size: 1.1rem !important;
    font-weight: 600 !important;
`,XP=l.span`
    font-size: 1em;
    font-weight: 600;
    color: #34495e;
    padding: 0 0.4em;
`,vb=(e,n=!1)=>{const{abilities:s}=rs();if(!n)return e.filter(r=>s.can("access",r.route));const o=r=>r.filter(i=>s.can("access",i.route));return e.map(r=>{if(r.submenu&&r.submenu.length>0){const i=o(r.submenu);return i.length>0?{...r,submenu:i}:null}else return s.can("access",r.route)?r:null}).filter(r=>r!==null)},ZP=()=>{const{abilities:e}=rs();return e==null?void 0:e.can("developerAccess","all")},jb=e=>e.map((n,s)=>({...n,id:s+1})),e2=jb([{title:"Venta",icon:z.menu.unSelected.sale,route:re.SALES_TERM.SALES,category:"Ventas"},{title:"Facturas",icon:z.menu.unSelected.register,route:re.SALES_TERM.BILLS,category:"Ventas"},{title:"Preventas",icon:t.jsx(O,{icon:Vx}),route:re.SALES_TERM.PREORDERS,category:"Ventas"},{title:"Compras",icon:z.menu.unSelected.purchase,route:re.PURCHASE_TERM.PURCHASES,category:"Operaciones"},{title:"Ordenes",icon:z.menu.unSelected.order,route:re.ORDER_TERM.ORDERS,category:"Operaciones"},{title:"Cuentas por Cobrar",icon:z.menu.unSelected.accountsReceivable,route:re.ACCOUNT_RECEIVABLE.ACCOUNT_RECEIVABLE_LIST,category:"Finanzas"},{title:"Productos",icon:z.menu.unSelected.inventory,route:re.INVENTORY_TERM.INVENTORY_ITEMS,category:"Inventario"},{title:"Almacenes",icon:t.jsx(O,{icon:Fr}),route:re.INVENTORY_TERM.WAREHOUSES,category:"Inventario"},{title:"Clientes",icon:z.users.client,route:re.CONTACT_TERM.CLIENTS,category:"Contactos"},{title:"Proveedores",icon:z.users.provider,route:re.CONTACT_TERM.SUPPLIERS,category:"Contactos"},{title:"Cuadre de Caja",icon:z.menu.unSelected.cashReconciliation,route:re.CASH_RECONCILIATION_TERM.CASH_RECONCILIATION_LIST,category:"Finanzas"}]),t2=jb([{title:"Panel Desarrollador",icon:t.jsx(e0,{}),action:"openDeveloperModal",category:"Desarrollador"},{title:"Cambiar Negocio",icon:z.operationModes.add,route:re.DEV_VIEW_TERM.SWITCH_BUSINESS,category:"Desarrollador"},{title:"Gestionar Negocios",icon:z.operationModes.add,route:re.DEV_VIEW_TERM.BUSINESSES,category:"Desarrollador"},{title:"Gestionar Actualización",icon:z.operationModes.add,route:re.DEV_VIEW_TERM.CHANGELOG_MANAGE,category:"Desarrollador"},{title:"Documentar Actualización",icon:z.operationModes.add,route:re.DEV_VIEW_TERM.CHANGELOG_CREATE,category:"Desarrollador"},{title:"Todos los usuarios",icon:z.operationModes.add,route:re.DEV_VIEW_TERM.ALL_USERS,category:"Desarrollador"},{title:"Configuración de App",icon:z.menu.selected.settings,route:re.DEV_VIEW_TERM.APP_CONFIG.ROOT,category:"Desarrollador"}]),n2=()=>vb(e2),s2=()=>ZP()?t2:[],o2=()=>{D(q);const e=n2(),n=s2(),{abilities:s}=rs();return t.jsxs(r2,{children:[(s==null?void 0:s.can("developerAccess","all"))&&t.jsx(pm,{title:"Funciones de desarrollador",cardData:n}),t.jsx(pm,{title:"Atajos",cardData:e})]})},r2=l.div`
    display: grid;
    gap: 1em;
    max-width: 1440px;
    width: 100%;
    margin: 0 auto;
  
    
    @media (max-width: 768px) {
        gap: 0.8em;
    }
`,i2=()=>t.jsx(t.Fragment,{children:t.jsxs(a2,{children:[t.jsx(BT,{}),t.jsx(c2,{children:t.jsxs(l2,{children:[t.jsx(ZT,{}),t.jsx(o2,{})]})}),t.jsx(oP,{})]})}),a2=l.div`
  height: 100vh;
  width: 100%;
  display: grid;
  grid-template-rows: min-content 1fr min-content;
  background-color: var(--color2);
`,c2=l.div`
  display: grid;
  width: 100%;
  overflow-y: auto;

`,l2=l.div`
  display: grid;
  align-items: start;
  align-content: start;
  margin: 0 auto;
  gap: 1em;
  max-width: 1200px;
  width: 100%;  
  padding: 1em 1em;
  border-radius: var(--border-radius1);
`,{notification:d2}=Ne,u2={status:!1,items:[]},Cb=Ee({name:"category",initialState:u2,reducers:{addItem:(e,n)=>{const{id:s,name:o,type:r}=n.payload,i=e.items.filter(c=>c.type===r);i.every(c=>c.id!==s)&&i.length<12?(e.status=!0,e.items.push({id:s,name:o,type:r})):i.length===12&&d2.error({message:"Error",description:`No puedes agregar más de 12 elementos en la lista de ${r==="category"?"categorías":"ingredientes activos"}`})},deleteAllItems:e=>{e.items=[],e.status=!1},deleteItem:(e,n)=>{const{id:s,type:o}=n.payload,r=e.items.findIndex(i=>i.id===s&&i.type===o);r!==-1&&e.items.splice(r,1),e.items.length===0&&(e.status=!1)}}}),{addItem:mm,deleteAllItems:p2,deleteItem:m2}=Cb.actions,Nu=e=>e.category.items,h2=e=>e.category,g2=e=>e.category.status,f2=pu(Nu,e=>e.filter(n=>n.type==="category")),x2=pu(Nu,e=>e.filter(n=>n.type==="activeIngredient")),b2=Cb.reducer,y2={criterio:localStorage.getItem("filterCriterio")||"nombre",orden:localStorage.getItem("filterOrden")||"asc",inventariable:localStorage.getItem("filterInventariable")||"todos",itbis:localStorage.getItem("filterItbis")||"todos"},wb=Ee({name:"filterProducts",initialState:y2,reducers:{setCriterio:(e,n)=>{localStorage.setItem("filterCriterio",n.payload),e.criterio=n.payload},setOrden:(e,n)=>{localStorage.setItem("filterOrden",n.payload),e.orden=n.payload},setInventariable:(e,n)=>{localStorage.setItem("filterInventariable",n.payload),e.inventariable=n.payload},setItbis:(e,n)=>{localStorage.setItem("filterItbis",n.payload),e.itbis=n.payload}}}),{setCriterio:v2,setOrden:j2,setInventariable:C2,setItbis:w2}=wb.actions,S2=wb.reducer,Sb=e=>e.filterProducts.criterio,Ib=e=>e.filterProducts.orden,Eb=e=>e.filterProducts.inventariable,Ab=e=>e.filterProducts.itbis;function ii(e){return Math.round(e*100)/100}const I2=(e,n=2)=>{const s=Math.pow(10,n);return Math.round((Number(e)+Number.EPSILON)*s)/s};function Ma(e){return!isNaN(parseFloat(e))&&isFinite(e)}function Xn(e,n=!0){if(!n)return 0;const{isSoldByWeight:s,taxPercentage:o}=Rn(e);let i=(s?Ou(e):Mu(e))*(o/100);return ii(i)}function Rn(e,n=!0){var u,p,h,f;const s=((u=e==null?void 0:e.selectedSaleUnit)==null?void 0:u.pricing)||(e==null?void 0:e.pricing)||{},o=((p=e==null?void 0:e.weightDetail)==null?void 0:p.isSoldByWeight)||!1,r=((h=e==null?void 0:e.weightDetail)==null?void 0:h.weight)||1,i=n&&(e==null?void 0:e.amountToBuy)||1,a=s.price||0,c=Number(s.tax)||0,d=((f=e==null?void 0:e.promotion)==null?void 0:f.discount)||0;return{pricing:s,isSoldByWeight:o,weight:r,amountToBuy:i,price:a,taxPercentage:c,discountPercentage:d}}function E2(e,n,s=!0){return s||(n=0),e/(1+n/100)}function kb(e){if(!e)return 0;const{discountPercentage:n,isSoldByWeight:s}=Rn(e),o=s?Ou(e):Mu(e);return ii(o*(n/100))}function tt(e,n=!0,s=!0){if(!e)return 0;const{price:o,isSoldByWeight:r}=Rn(e,s);if(!Ma(o))return 0;const i=r?Ou(e,s):Mu(e,s),a=Xn(e,n),c=kb(e),d=i+a-c;return ii(d)}function Ou(e,n=!0){const{price:s,weight:o}=Rn(e,n);return s*o}function Ks(e){return{...e,amountToBuy:1,weightDetail:{...e.weightDetail,weight:1}}}function Sc(e,n="price",s=!0){const{isSoldByWeight:o,weight:r,pricing:i}=Rn(e);let a=i[n]||0;o&&(a*=r);let c=s&&i.tax/100||0,d=a*c;return ii(a+d)}function Mu(e,n=!0){const{price:s,amountToBuy:o}=Rn(e,n);let i=s*(n?o:1);return e.discount&&e.discount.value>0&&(e.discount.type==="percentage"?i=i*(1-e.discount.value/100):i=Math.max(0,i-e.discount.value)),i}function Fa(e,n=!0){return Sc(e,"listPrice",n)}function hm(e,n=!0){return Sc(e,"price",n)}function Tb(e,n=!0){return Sc(e,"avgPrice",n)}function Pb(e,n=!0){return Sc(e,"minPrice",n)}function Nn(e=[]){return e.reduce((n,s)=>{const{isSoldByWeight:o,weight:r,amountToBuy:i,price:a}=Rn(s);let d=a*(o?r:i);return s.discount&&s.discount.value>0&&(s.discount.type==="percentage"?d=d*(1-s.discount.value/100):d=Math.max(0,d-s.discount.value)),n+d},0)}function $s(e=[],n=!0){return e.reduce((s,o)=>s+Xn(o,n),0)}function A2(e){return e.reduce((n,s)=>n+kb(s),0)}function Fu(e=[]){return e.reduce((n,s)=>{if(!s.discount||s.discount.value<=0)return n;const{price:o,isSoldByWeight:r,weight:i,amountToBuy:a}=Rn(s),d=o*(r?i:a);let u=0;return s.discount.type==="percentage"?u=d*(s.discount.value/100):u=Math.min(s.discount.value,d),n+u},0)}function Bu(e){if(!e.discount||e.discount.value<=0)return 0;const{price:n,isSoldByWeight:s,weight:o,amountToBuy:r}=Rn(e),a=n*(s?o:r);return e.discount.type==="percentage"?a*(e.discount.value/100):Math.min(e.discount.value,a)}function Lu(e){return e.reduce((n,s)=>n+(s==null?void 0:s.amountToBuy)||1,0)}function zu(e,n=0,s=0,o=!0){Ma(s)||(s=0);const r=e.some(h=>h.discount&&h.discount.value>0);let i=Nn(e),a=$s(e,o),c=A2(e),d=i-c,u=r?0:is(d,n),p=d-u+s+a;return ii(p)}const is=(e=0,n=0)=>!Ma(e)||!Ma(n)?0:e*(n/100),k2=(e=[],n)=>e.map(s=>({...s,pricing:{...s.pricing,avgPrice:Tb(s,n),listPrice:Fa(s,n),minPrice:Pb(s,n),price:tt(s,n)}})),Db=(e,n=2)=>{const s=Number(e);return isNaN(s)?0:Number(s.toFixed(n))};function T2(e){const n=e.insurance||{mode:null,value:0};if(!n.value)return 0;const{price:s,isSoldByWeight:o,weight:r,amountToBuy:i}=Rn(e),a=o?r:i;return n.mode==="porcentaje"?s*a*(n.value/100):n.value*a}function P2(e=[]){return e.reduce((n,s)=>n+T2(s),0)}function D2(e,n,s){if(n==="si"?e=ga.filter(e,o=>o.trackInventory===!0):n==="no"&&(e=ga.filter(e,o=>o.trackInventory===!1)),s!=="todos"){const o=parseFloat(s);e=ga.filter(e,r=>r.pricing.tax===o)}return e}function $2(e,n,s){const o=(r,i)=>{if(r==="tax")e.sort((a,c)=>{const d=Xn(a.pricing.price,a.pricing.tax),u=Xn(c.pricing.price,c.pricing.tax);return i==="ascNum"?d===0?1:u===0?-1:d-u:i==="descNum"?d===0?1:u===0?-1:u-d:0});else{const a=r.split(".");e.sort((c,d)=>{let u=c,p=d;if(a.forEach(h=>{u=u[h],p=p[h]}),i==="asc")return u>p?1:-1;if(i==="desc")return u<p?1:-1;if(i==="ascNum")return u-p;if(i==="descNum")return p-u;if(i===!0)return u===!0?-1:1;if(i===!1)return u===!0?1:-1})}};return n==="nombre"&&o("name",s),n==="inventariable"&&o("trackInventory",s),n==="precio"&&o("pricing.price",s),n==="costo"&&o("pricing.cost",s),n==="stock"&&o("stock",s),n==="categoria"&&o("category",s),n==="impuesto"&&o("pricing.tax",s),e}function Rs(e=!1){const[n,s]=m.useState(!0),[o,r]=m.useState([]),[i,a]=m.useState(null),c=D(q),d=D(Sb),u=D(Ib),p=D(Eb),h=D(Ab),f=D(x2),x=D(f2),g=D(g2);return m.useEffect(()=>{if(!(!c||!(c!=null&&c.businessID)))try{s(!0);const y=le($,"businesses",String(c==null?void 0:c.businessID),"products"),b=[],v=x.map(k=>k.name);x.length>0&&g&&b.push(te("category","in",v));const C=f.map(k=>k.name);f.length>0&&b.push(te("activeIngredients","in",C));const I=he(y,...b),j=Te(I,k=>{if(k.empty){r([]),s(!1);return}let A=k.docs.map(P=>{let w=P.data();return w==null||delete w.updatedAt,w==null||delete w.createdAt,w==null||delete w.createdBy,w});A=D2(A,p,h),A=$2(A,d,u),A=A.sort((P,w)=>(P==null?void 0:P.custom)===!0?-1:1),r(A),s(!1)});return()=>{j()}}catch(y){s(!1),a(y),console.error("Ocurrió un error al obtener los productos:",y)}},[c==null?void 0:c.businessID,e,x,f,g,d,u,p,h]),{products:o,error:i,loading:n,setLoading:s}}l.div`
`;l.div`
    overflow: hidden;
    height: 80px;
    width: 80px;
    border-radius: 10px;

    .img{
        display: block;
        height: 100%;
        width: 100%;
        object-fit: cover;

    }
`;const Ic=async(e,n)=>{try{if(!e)throw new Error("No businessID");if(!n)throw new Error("No id");const s=F($,"businesses",e,"clients",n);await Ot(s)}catch(s){console.error("Error deleting document: ",s)}},$b=async(e,n)=>{if(console.log("fbDeleteProduct",e,n),!!(e!=null&&e.businessID))try{const s=F($,"businesses",e.businessID,"products",n);await Ot(s),console.log("Elimianodo")}catch(s){console.log(s)}},R2={deleteProduct:{isOpen:!1,isSuccess:!1,id:null,user:null},deleteClient:{isOpen:!1,isSuccess:!1,id:null}},N2=Ee({name:"alert",initialState:R2,reducers:{handleDeleteProductAlert:(e,n)=>{var i,a;const s=(i=n.payload)==null?void 0:i.id,o=(a=n.payload)==null?void 0:a.user,r=e.deleteProduct.isOpen;e.deleteProduct.isOpen=!r,e.deleteProduct.id=s,e.deleteProduct.user=o},handleDeleteProductAlertSuccess:e=>{const n=e.deleteProduct.id,s=e.deleteProduct.user;$b(n,s)},handleDeleteClientAlert:(e,n)=>{const s=n.payload,o=e.deleteProduct.isOpen;e.deleteProduct.isOpen=!o,e.deleteProduct.id=s},handleDeleteClientAlertSuccess:e=>{const n=e.deleteClient.id;Ic(n)}}}),O2=N2.reducer,No=[0,16,18],M2=e=>{switch(e){case 0:return"Exento";case 16:return"IVA 16%";case 18:return"IVA 18%";default:return"Exento"}},{Card:F2,InputNumber:B2,Form:Zc,Checkbox:L2,Select:gm}=Ne,Uu=[{value:"days",label:"Días"},{value:"weeks",label:"Semanas"},{value:"months",label:"Meses"},{value:"years",label:"Años"}],z2=()=>t.jsxs(F2,{title:"Garantía",size:"small",children:[t.jsx(Zc.Item,{name:["warranty","status"],style:{marginBottom:0},valuePropName:"checked",children:t.jsx(L2,{placeholder:"Garantía",maxLength:60,children:"Aplica garantía"})}),t.jsxs(U2,{children:[t.jsx(Zc.Item,{name:["warranty","quantity"],style:{marginBottom:0},children:t.jsx(B2,{placeholder:"Cantidad",style:{width:"100%"}})}),t.jsx(Zc.Item,{name:["warranty","unit"],style:{marginBottom:0},children:t.jsx(gm,{placeholder:"Unidad",children:Uu.map((e,n)=>t.jsx(gm.Option,{value:e==null?void 0:e.value,children:e==null?void 0:e.label},n))})})]})]}),U2=l.div`
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.4em;
`,W2={day:"día",days:"días",week:"semana",weeks:"semanas",month:"mes",months:"meses",year:"año",years:"años"};function Ec(e,n){let s="";const o=W2[n.toLowerCase()];return o?s=e===1?`1 ${o}`:`${e} ${o}`:s="Unidad no reconocida",s}const Rb=()=>{var e;return{name:"",image:"",category:"",pricing:{cost:0,price:0,listPrice:0,avgPrice:0,minPrice:0,tax:No[0]},promotions:{start:null,end:null,discount:0,isActive:!1},weightDetail:{isSoldByWeight:!1,weightUnit:"lb",weight:0},warranty:{status:!1,unit:((e=Uu[1])==null?void 0:e.value)||"",quantity:1},size:"",type:"",stock:0,totalUnits:null,packSize:1,netContent:"",restrictSaleWithoutStock:!1,activeIngredients:"",amountToBuy:1,createdBy:"unknown",id:"",isVisible:!0,trackInventory:!0,qrcode:"",barcode:"",order:1,hasExpirationDate:!1,selectedSaleUnit:null}},q2={status:!1,product:Rb()},Nb=Ee({name:"updateProduct",initialState:q2,reducers:{ChangeProductData:(e,n)=>{const{status:s,product:o}=n.payload;e.status||(e.status=s),e.product={...e.product,...o}},setProduct:(e,n)=>{const s=n.payload;e.product={...e.product,...s}},ChangeProductImage:(e,n)=>{e.product.image=n.payload},changeProductPrice:(e,n)=>{var s,o,r,i,a,c,d,u,p;console.log("changeProductPrice - Payload received:",n.payload),e.product.pricing={...e.product.pricing,...(s=n==null?void 0:n.payload)==null?void 0:s.pricing},(r=(o=n==null?void 0:n.payload)==null?void 0:o.pricing)!=null&&r.listPrice&&(e.product.pricing.price=(a=(i=n==null?void 0:n.payload)==null?void 0:i.pricing)==null?void 0:a.listPrice),(d=(c=n==null?void 0:n.payload)==null?void 0:c.pricing)!=null&&d.price&&(e.product.pricing.price=(p=(u=n==null?void 0:n.payload)==null?void 0:u.pricing)==null?void 0:p.price),console.log("changeProductPrice - Updated pricing:",e.product.pricing)},toggleSaleUnits:(e,n)=>{const{isSoldInUnits:s}=n.payload;e.product.isSoldInUnits=s,s&&e.product.saleUnits.length===0?(e.product.saleUnits=[{id:be(),unitName:"Caja",quantity:30,pricing:{cost:0,price:0,listPrice:0,listPriceEnable:!0,avgPrice:0,avgPriceEnable:!1,minPrice:0,minPriceEnable:!1,tax:No[0]}},{id:be(),unitName:"Pastilla",quantity:1,pricing:{cost:0,price:0,listPrice:0,listPriceEnable:!0,avgPrice:0,avgPriceEnable:!1,minPrice:0,minPriceEnable:!1,tax:No[0]}}],e.product.selectedSaleUnitId=e.product.saleUnits[0].id):s||(e.product.saleUnits=[],e.product.selectedSaleUnitId=null)},selectSaleUnit:(e,n)=>{const{saleUnitId:s}=n.payload;e.product.saleUnits.some(r=>r.id===s)&&(e.product.selectedSaleUnitId=s)},clearUpdateProductData:e=>{e.product=Rb(),e.status=!1}}}),{ChangeProductData:kr,changeProductPrice:Ob,clearUpdateProductData:Nd,ChangeProductImage:Mb,setProduct:V2}=Nb.actions,On=e=>e.updateProduct,G2=Nb.reducer,Fb=(e,n)=>{const[s,o]=m.useState(e);return m.useEffect(()=>{(()=>{const i=new Image;i.src=e,i.onload=()=>{o(e)},i.onerror=()=>{o(n)}})()},[e,n]),[s]},Js="/assets/noimg-tGtwrv-J.png";function _2({stock:e,trackInventory:n}){return n?t.jsx(fm,{trackInventory:n,stock:e,children:e||0}):t.jsx(fm,{trackInventory:n,children:t.jsx("span",{children:t.jsx(O,{icon:aw})})})}const fm=l.div`
  display: flex;
  align-items: center;
  width: 100%;
  background-color: #f5f5f5;
  height: 2em;
    justify-content: right;
    padding: 0 0.4em;    
    border-radius: var(--border-radius-light);
    ${e=>!e.stock&&`
    white-space: nowrap;

    background-color: #ebebeb !important;
    color: #616161 !important;
    `}
    
    ${e=>{switch(e.trackInventory){case!1:return`
                display: flex;
        `}}}
    ${e=>{switch(!0){case e.stock<10:return`
          justify-content: right;
          background-color: rgb(255, 220, 220);
        `;case e.stock>=10:return`
            justify-content: right;
            background-color: rgb(220, 255, 220);
            `}}}
    ${e=>{switch(!e.trackInventory){case!0:return`
          justify-content: right;
          background-color: transparent !important;
        `}}}
`;l.div`
 background-color: white;
 padding-right: 0.6em;
 padding-right: 0px;
`;l.div`
   display: flex;
   align-items: center;

   justify-content: space-between;
   height: min-content;
`;l.div`
    width: 100%;
    max-height: 2.75em;
    height: 100%;
    position: relative;
    overflow: hidden;
    display: flex;
    border-radius: var(--border-radius-light);
    
`;l.img`
  object-fit: cover;
  object-position: center;
  width: 100%;
  height: 100%;
  ${e=>{switch(e.noFound){case!0:return`
        object-fit: contain;`;default:return""}}}
`;l.div`
    display: grid;
    grid-template-columns: 
    minmax(200px, 1fr) //name
    minmax(100px, 0.4fr)  //cost
    minmax(100px, 0.4fr) //stock
    minmax(100px, 200px); //price
    align-items: center;
    gap: 1em;
    color: var(--Gray7);
    font-size: 14px;

`;l.span`
    color: var(--Gray7);
        margin: 0;
        padding: 0;
        font-weight: 500;
        
    
`;l.div`
    display: flex;
    justify-content: space-between;
`;l.div`
    ${e=>{switch(e.position){case"right":return`
                justify-self: end;
                `;default:return`
                justify-self: start;
                `}}}
`;const H2=e=>{const[n,s]=m.useState(typeof window<"u"?window.innerWidth:0),o=m.useCallback(()=>e.current?e.current.offsetWidth:0,[e]);return m.useEffect(()=>{if(!e.current)return;s(o());const r=()=>{s(o())};let i;const a=()=>{clearTimeout(i),i=setTimeout(r,100)};return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[e]),{width:n}},Wu=()=>{const[e,n]=m.useState([]),s=D(q),o=le($,"businesses",String(s==null?void 0:s.businessID),"categories"),r=he(o,it("category.name","desc"));return m.useEffect(()=>{const i=Te(r,a=>{let c=a.docs.map(d=>d.data());n(c)});return()=>{i()}},[s==null?void 0:s.businessID]),{categories:e}};l(Ie.li)`
//font & text
font-size: 14px;
letter-spacing: 0.2px;
white-space: nowrap;
//box
height: 2.2em;
display: flex;
align-items: center;
padding: 0 0.75em;
gap: 0.5em;
//color & Ground
background-color: ${({theme:e})=>e.bg.color2};
    border-radius: var(--border-radius);
    text-transform: capitalize;
    font-weight: 500;
    color: #585858;
    transition: 300ms ease-in-out;
    :hover{

        background-color: #e7f0fa;
        color: rgb(83, 83, 83);
    }
   
    ${e=>{switch(e.type){case"create":return`
                    background-color: var(--color-success-light);
                    color: var(--color-success-dark);
                    ${!e.selected&&`
                        :hover{
                        background-color: var(--color-success-light);
                        color: var(--color-success-dark);
                    }`}
                    
                    `}}}
 
     ${e=>{switch(e.selected){case!0:return`
                    background-color: ${e.theme.bg.color4};
                    color: white;
                    :hover{
                        background-color: ${e.theme.bg.color4};
                        color: white;
                    }
                   
                `}}}
`;const Q2=async(e,n)=>{if(!e||!e.businessID)return!1;try{n={...n,createdAt:ue.now(),id:be(12)};const s=F($,"businesses",e.businessID,"expensesCategories",n.id);return await De(s,{category:n}),console.log("Category added to expense successfully"),!0}catch(s){return console.error("Error adding category to expense: ",s),!1}},Y2=async(e,n)=>{const{businessID:s}=e;if(!s)return;const o=be(10);n={...n,id:o,createdAt:ue.now()};let r=F($,"businesses",s,"categories",n.id);await De(r,{category:n}).then(()=>{}).catch(i=>{console.error(i)})},Bb=m.createContext(),Lb={isOpen:!1,type:"create",onSubmit:null},zb={name:"",id:""},K2=({children:e})=>{const[n,s]=m.useState(Lb),[o,r]=m.useState(zb);return t.jsx(Bb.Provider,{value:{category:o,setCategory:r,categoryState:n,setCategoryState:s},children:e})},J2={context:"useCategory debe ser usado dentro de un CategoryProvider"},ai=()=>{const e=m.useContext(Bb),n=D(q);if(!e)throw new Error(J2.context);const{categoryState:s,setCategoryState:o,category:r,setCategory:i}=e,a=()=>{o(Lb),i(zb)},c=f=>{if(typeof s.onSubmit=="function")s.onSubmit(n,f),a();else throw new Error("No onSubmit function provided in categoryState.")},d=f=>{o({...s,...f})},u=(f,x,g)=>{d({isOpen:f,type:x,onSubmit:g})};return{category:r,setCategory:i,categoryState:s,setCategoryState:o,onSubmit:c,configureAddProductCategoryModal:()=>u(!0,"create",Y2),configureAddExpenseCategoryModal:()=>u(!0,"create",Q2),configureCategoryModal:d,onClose:a}};l.div`
     background-color: ${e=>e.theme.bg.shade}; 
    width: 100%;
    display: grid;
    grid-template-columns: min-content 1fr min-content;
    align-items: center;
    height: 2.6em;
    padding: 0 1em;
    gap: 0.4em;
    ${e=>{switch(e.themeColor){case"transparent":return`
                    background-color: var(--color2);
                `}}}
`;l.button`
    height: 1.5em;
    width: 1em;
    padding: 0;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3em;
    border: 0;
    color: ${({theme:e})=>e.text.primary};
    background-color: transparent;
    border-radius: var(--border-radius-light);
    outline: 0;
    transition: 500ms background-color ease-in-out;
    :hover{
        background-color: rgba(0, 0, 0, 0.200);
    }
`;l(Ie.ul)`
    border-radius: var(--border-radius-light);
    overflow-x: hidden;
    overflow-x: scroll;
     -webkit-overflow-scrolling: touch;
     scrollbar-width: none; 
     padding: 0;
    display: flex;
    flex-wrap: nowrap;
    gap: 0.6em;
    ::-webkit-scrollbar {
  display: none; /* Oculta la barra de scroll */
}
`;function mt(e,n="string",s=!1){if(isNaN(e))return null;if(n==="number")return s?parseFloat(e.toFixed(2)):e;const o=Math.sign(e)===-1?"-":"",r=Math.abs(e),i=!Number.isInteger(r),a=new Intl.NumberFormat("en-US",{minimumIntegerDigits:1,minimumFractionDigits:i?1:0,maximumFractionDigits:i?2:0}).format(r);return o+(r<10&&r>0,"")+a}function Od(e,n=1440){const o=ce.now().diff(ce.fromMillis(e)),r=Math.floor(o.as("minutes"));if(r<1){const i=Math.floor(o.as("seconds"));return`Hace ${i} segundo${i!==1?"s":""}`}else return r<n?`Hace ${r} minuto${r!==1?"s":""}`:ce.fromMillis(e).toLocaleString(ce.DATETIME_SHORT)}function X2(e){return`${ce.fromMillis(e).toLocaleString(ce.DATETIME_SHORT)}`}const Z2=(e,n="default",s="es")=>e?ce.fromMillis(e).toFormat("dd/MM/yyyy"):null,eD=(e,n)=>{switch(e){case"number":return mt(n);case"date":return X2(n||ce.now().toMillis());case"price":return Y(n);default:return n}},nt=({type:e,value:n,size:s,bold:o,noWrap:r,color:i,transformValue:a=!0,align:c})=>{const d=a?eD(e,n):n;return e==="text"?t.jsx("div",{children:n}):t.jsx(tD,{size:s,bold:o,color:i,noWrap:r,type:e,align:c,children:d})},tD=l.div`
height:min-content;
${({type:e})=>e==="title-large"&&"font-size: 28px; font-weight: 700; line-height: 1.4; color: #222222;"}
${({type:e})=>e==="title"&&"font-size: 22px; font-weight: 600; line-height: 1.4; color: #333333;"}
${({type:e})=>e==="subtitle"&&"font-size: 18px; font-weight: 500; line-height: 1.4; color: #333333;"}
${({type:e})=>e==="paragraph"&&"font-size: 16px; font-weight: 400; line-height: 1.6; letter-spacing: 0.02em; color: #555555;"}

  ${({type:e})=>{switch(e){case"title-table":return"font-size: 18px;font-weight: bold;color: var(--color);";case"subtitle-table":return`
        font-size: 14px;
        font-weight: bold;
        text-transform: capitalize;
        font-family: 'Montserrat', sans-serif;
        `;case"paragraph-table":return`
        font-size: 14px;
        font-weight: 400;
        text-transform: capitalize;
        font-family: 'Azeret Mono', monospace;
        `;default:return""}}}

  ${({size:e})=>e==="xsmall"&&"font-size: 12px;"}
  ${({size:e})=>e==="small"&&"font-size: 14px;"}
  ${({size:e})=>e==="medium"&&"font-size: 16px;"}
  ${({size:e})=>e==="xmedium"&&"font-size: 18px;"}
  ${({size:e})=>e==="large"&&"font-size: 20px;"}
  ${({size:e})=>e==="xlarge"&&"font-size: 22px;"}

  ${({noWrap:e})=>e&&"white-space: nowrap;"}

  ${({bold:e})=>e&&"font-weight: bold;"}
  ${({align:e})=>{switch(e){case"center":return"text-align: center;";case"right":return"text-align: right;";default:return"text-align: left;"}}}
  ${({color:e})=>e&&`color: ${e};`}
  ${({color:e})=>e==="primary-main"&&"color: var(--color-main);"}
  ${({color:e})=>e==="secondary"&&"color: var(--color1);"}
  ${({color:e})=>e==="tertiary"&&"color: var(--color2);"}
  ${({color:e})=>e==="quaternary"&&"color: var(--color3);"}
  ${({color:e})=>e==="gray-dark"&&"color: var(--Gray8);"}
`,nD=({img:e})=>{const n=Iu(),[s]=Fb(e,Js);return t.jsx(sD,{children:t.jsx(oD,{src:n&&s||Js,noFound:!e,alt:"",style:e===s?{objectFit:"cover"}:{objectFit:"contain"}})})},sD=l.div`
    max-height: 3em;
    height: 3em;
    min-width: 2.75em;
    max-width: 2.75em;
    width: 2.75em;
    position: relative;
    overflow: hidden;
    display: flex;
    border-radius: var(--border-radius-light);
    background-color: white;
    
`,oD=l.img`
  object-fit: cover;
  object-position: center;
  width: 100%;
  height: 100%;
  ${e=>{switch(e.noFound){case!0:return`
        object-fit: contain;`;default:return""}}}
`,at=Object.freeze({SEARCH:{id:be(),label:"Buscar Cliente",mode:"search",icon:t.jsx(O,{icon:jd}),showClientList:!0},CREATE:{id:be(),label:"Nombre :",mode:"create",icon:t.jsx(O,{icon:Gx}),showClientList:!1},UPDATE:{id:be(),label:"Cliente",mode:"update",icon:t.jsx(O,{icon:cw}),showClientList:!1}});async function Mt(e,n,s=1,o=null){try{if(!n)throw new Error("No name provided");if(!(e!=null&&e.businessID))throw new Error("No user or businessID provided");if(s<1)throw new Error("Quantity debe ser al menos 1");const r=F($,"businesses",e.businessID,"counters",n);if(o){const i=await o.get(r);let a=0;return i.exists()?(a=i.data().value,o.update(r,{value:a+s})):o.set(r,{value:s}),a+1}else{let i;return await Fo($,async a=>{const c=await a.get(r);let d=0;c.exists()?(d=c.data().value,a.update(r,{value:d+s})):a.set(r,{value:s}),i=d+1}),i}}catch(r){throw console.error("Error al obtener el siguiente ID:",r),r}}const Ub=async(e,n)=>{try{if(!e||!e.businessID)throw new Error("No user or businessID");console.log("cliente",n),n={...n,id:be(8),numberId:await Mt(e,"lastClientId")};const s=F($,"businesses",e.businessID,"clients",n.id);return await De(s,{client:n}),n}catch(s){console.error("Error adding document: ",s)}},Wb=async(e,n)=>{if(console.log("user from fbUpdateClient",n),!e||!e.businessID)return;const s=F($,"businesses",e.businessID,"clients",n.id);try{(await Se(s)).exists()||console.log("No such document!"),await je(s,{client:n})}catch(o){console.error("Error updating document: ",o)}},rD=(e,n)=>{let s=!1;return typeof e!="object"&&typeof n!="object"&&(s=!1),Object.keys(e).length&&Object.keys(n).length?s=JSON.stringify(e)===JSON.stringify(n):s=!1,console.log(s,"from compare"),s};async function xm(e,n){try{const s=be(),o=F($,"businesses",e.businessID,"clientInsurance",s);return await De(o,{id:s,...n}),!0}catch(s){return console.error("Error creating client insurance:",s),!1}}async function bm(e,n){try{const s=F($,"businesses",e.businessID,"clientInsurance",n.id);return await De(s,{...n},{merge:!0}),!0}catch(s){return console.error("Error updating client insurance:",s),!1}}async function qu(e,n){try{if(!(e!=null&&e.businessID)||!n)return null;const s=le($,"businesses",e.businessID,"clientInsurance"),o=he(s,te("clientId","==",n)),r=await Me(o);return r.empty?null:r.docs[0].data()}catch(s){return console.error("Error fetching client insurance:",s),null}}const el={authData:{clientId:null,hasDependent:!1,dependentId:null,insuranceId:null,insuranceType:null,affiliateNumber:"",authNumber:"",doctor:"",specialty:"",indicationDate:null,birthDate:null,prescription:null},loading:!1,error:null,modal:{open:!1,initialValues:null}},xa=Za("insuranceAuth/fetchByClientId",async({user:e,clientId:n},{rejectWithValue:s})=>{try{const o=await qu(e,n);if(o){const{insuranceId:r,insuranceType:i,birthDate:a}=o;return{insuranceId:r,insuranceType:i,birthDate:a}}return null}catch(o){return s(o.message)}}),qb=Ee({name:"insuranceAuth",initialState:el,reducers:{setAuthData:(e,n)=>{e.authData={...e.authData,...n.payload}},updateAuthField:(e,n)=>{const{field:s,value:o}=n.payload;e.authData[s]=o},clearAuthData:e=>{e.authData=el.authData},setLoading:(e,n)=>{e.loading=n.payload},setError:(e,n)=>{e.error=n.payload},openModal:(e,n)=>{var s;e.modal.open=!0,(s=n.payload)!=null&&s.initialValues&&(e.authData={...e.authData,...n.payload.initialValues})},closeModal:(e,{payload:{clearAuthData:n=!1}={}})=>{n&&(e.authData=el.authData),e.modal.open=!1}},extraReducers:e=>{e.addCase(xa.pending,n=>{n.loading=!0,n.error=null}).addCase(xa.fulfilled,(n,s)=>{n.loading=!1,s.payload&&(n.authData={...n.authData,...s.payload})}).addCase(xa.rejected,(n,s)=>{n.loading=!1,n.error=s.payload})}}),{setAuthData:Md,updateAuthField:iD,clearAuthData:Vu,openModal:aD,closeModal:ym}=qb.actions,Ac=e=>e.insuranceAuth.authData,cD=e=>e.insuranceAuth.loading,lD=e=>e.insuranceAuth.modal,dD=qb.reducer,Xs={name:"Generic Client",tel:"",address:"",personalID:"",delivery:{status:!1,value:0},id:"GC-0000"},vm={name:"",tel:"",address:"",personalID:"",delivery:{status:!1,value:0},id:""},uD={mode:at.SEARCH.id,labelClientMode:at.SEARCH.label,searchTerm:"",client:Xs,copyClient:null,isOpen:!1},Vb=Ee({name:"clientCart",initialState:uD,reducers:{setClient:(e,n)=>{e.client={...e.client,...n.payload}},setClientMode:(e,n)=>{const{SEARCH:s,CREATE:o,UPDATE:r}=at;switch(e.mode=n.payload,!0){case e.mode===s.id:e.labelClientMode=s.label,e.showClientList=s.showClientList,e.isOpen=!1;break;case e.mode===o.id:e.labelClientMode=o.label,e.client=vm,e.showClientList=o.showClientList,e.isOpen=!0;break;case e.mode===r.id:e.labelClientMode=r.label,e.showClientList=r.showClientList,e.isOpen=!1;break;default:e.labelClientMode=s.label,e.showClientList=s.showClientList}},setClientSearchTerm:(e,n)=>{e.searchTerm=n.payload},addClient:(e,n)=>{e.client={...n.payload},e.mode=at.UPDATE.id,e.copyClient={...n.payload}},setIsOpen:(e,n)=>{n.payload===void 0?e.isOpen=!e.isOpen:e.isOpen=n.payload},deleteClient:e=>{e.client=vm,e.isOpen=!1,e.mode=at.SEARCH.id,e.labelClientMode=at.SEARCH.label},handleClient:(e,n)=>{var o,r,i,a;const{user:s}=n.payload;if(!e.client.id){e.client=Xs;return}if((e==null?void 0:e.copyClient)!==null&&((o=e==null?void 0:e.copyClient)==null?void 0:o.id)===((r=e==null?void 0:e.client)==null?void 0:r.id)&&!rD(e==null?void 0:e.client,e==null?void 0:e.copyClient)){Wb(s,e.client);return}if(!((i=e==null?void 0:e.client)!=null&&i.id)&&((a=e==null?void 0:e.client)==null?void 0:a.name.length)>0&&e.client.name!=="Cliente Genérico"){Ub(s,e.client);return}}}}),{setClient:Ba,setClientMode:Gb,setIsOpen:ko,setClientSearchTerm:pD,deleteClient:Gu,addClient:_b}=Vb.actions,Ht=e=>e.clientCart.client,Hb=e=>e.clientCart.mode,mD=e=>e.clientCart.isOpen,Qb=e=>e.clientCart.searchTerm,hD=Vb.reducer,Fd={status:!1,value:""},gD=[{method:"cash",value:0,status:!0},{method:"card",value:0,reference:"",status:!1},{method:"transfer",value:0,reference:"",status:!1}],tl={permission:{openCashReconciliation:!1},settings:{taxReceipt:{enabled:!1},printInvoice:!0,isInvoicePanelOpen:!1,billing:{billingMode:"direct",isLoading:!1,isError:null}},isOpen:!1,showCxcAutoRemovalNotification:!1,data:{isAddedToReceivables:!1,id:"",seller:{},client:Xs,products:[],change:{value:0},delivery:Fd,discount:{value:0},dueDate:null,hasDueDate:!1,paymentMethod:gD,NCF:null,totalShoppingItems:{value:0},totalPurchaseWithoutTaxes:{value:0},totalTaxes:{value:0},payment:{value:0},totalPurchase:{value:0},sourceOfPurchase:"Presencial",status:"completed",preorderDetails:{preorderNumber:null,createdAt:null},history:[],insuranceEnabled:!1,totalInsurance:{value:0},invoiceComment:""}},jm=(e,n=void 0)=>{try{if(!e||!e.data||!e.settings||!e.settings.taxReceipt){console.warn("updateAllTotals: Invalid state structure");return}const{settings:{taxReceipt:{enabled:s}},data:{products:o=[],discount:r={},delivery:i={},paymentMethod:a=[],totalPurchase:c,totalInsurance:d,totalTaxes:u,totalShoppingItems:p,totalPurchaseWithoutTaxes:h,payment:f,change:x}}=e,g=Number(r.value)||0,y=Number(i.value)||0,b=zu(o,g,y,s),v=P2(o),C=b-v,I=a.reduce((k,A)=>A&&A.status?k+(Number(A.value)||0):k,0),j=n!==void 0?Number(n):I;c&&(c.value=C),d&&Object.assign(d,{value:v}),u&&(u.value=$s(o,s)),p&&(p.value=Lu(o)),h&&(h.value=Nn(o)),f&&(f.value=j),x&&(x.value=j-C)}catch(s){console.error("Error in updateAllTotals:",s)}},xt=Ee({name:"factura",initialState:tl,reducers:{toggleCart:e=>{const n=e.isOpen;e.isOpen=!n},loadCart:(e,n)=>{const s=n.payload;s!=null&&s.id&&(e.data=s)},setClient:(e,n)=>{var o;const s=n.payload;s!=null&&s.id&&(e.data.client=s),((o=s==null?void 0:s.delivery)==null?void 0:o.status)===!0?e.data.delivery=s==null?void 0:s.delivery:e.data.delivery=Fd},setDefaultClient:e=>{e.data.client=Xs,e.data.delivery=Fd,e.data.isAddedToReceivables=!1},setPaymentAmount:(e,n)=>{const s=n.payload;if(e.settings.isPreOrderEnabled&&e.data.status==="preorder"&&!e.data.isPreOrder)throw new Error("Debe marcar la factura como preorden antes de proceder al pago.");const r=e.data.paymentMethod.find(i=>i.status===!0);r&&(e.data.payment.value=Number(s),r.value=Number(s))},changePaymentValue:(e,n)=>{const s=n.payload;e.data.payment.value=Number(s)},updateProductFields:(e,n)=>{const{id:s,data:o}=n.payload,r=e.data.products.find(i=>i.id===s||i.cid===s);r&&Object.assign(r,o)},addTaxReceiptInState:(e,n)=>{e.data.NCF=n.payload},setTaxReceiptEnabled:(e,n)=>{const s=n.payload;e.settings.taxReceipt.enabled=s},toggleInvoicePanelOpen:e=>{e.settings.isInvoicePanelOpen=!e.settings.isInvoicePanelOpen},setCartId:e=>{e.data.id||(e.data.id=be())},addPaymentMethod:(e,n)=>{const s=n.payload;e.data.paymentMethod=s},setPaymentMethod:(e,n)=>{try{const s=n.payload;s.value!==void 0&&(s.value=Math.max(0,Number(s.value)||0));const o=e.data.paymentMethod.findIndex(r=>r.method===s.method);o!==-1&&(e.data.paymentMethod[o]=s)}catch(s){console.error("Error in setPaymentMethod:",s)}},toggleReceivableStatus:(e,n)=>{const s=n.payload;s===void 0?e.data.isAddedToReceivables=!e.data.isAddedToReceivables:e.data.isAddedToReceivables=s},changeProductPrice:(e,n)=>{const{id:s,pricing:o,saleUnit:r,price:i}=n.payload,a=e.data.products.find(c=>c.id===s);a&&(r?a.selectedSaleUnit=r:o&&(a.pricing=o,a.pricing.price=a.pricing.listPrice,a.selectedSaleUnit=null),i&&a.selectedSaleUnit?a.selectedSaleUnit.pricing.price=i:i&&(a.pricing.price=i))},changePaymentMethod:e=>{e.data.paymentMethod.findIndex(s=>s.status===!0)},addPaymentMethodAutoValue:e=>{const n=e.data.totalPurchase.value;e.data.payment.value=n},addProduct:(e,n)=>{var i,a;const s=n.payload,o=e.data.products.find(c=>c.id===s.id),r=e.data.products;if(o)if((i=o==null?void 0:o.weightDetail)!=null&&i.isSoldByWeight){const c={...s,cid:be(8)};e.data.products=[...r,c]}else o.productStockId=s.productStockId,o.batchId=s.batchId,o.stock=s.stock,o.amountToBuy+=1;else{const c={...s,cid:(a=o==null?void 0:o.weightDetail)!=null&&a.isSoldByWeight?be(8):s.id,insurance:s.insurance||{mode:null,value:0}};e.data.products=[...r,c]}},deleteProduct:(e,n)=>{const s=e.data.products.find(o=>o.cid===n.payload);s&&e.data.products.splice(e.data.products.indexOf(s),1),e.data.products.length===0&&(e.data.id=null,e.data.products=[])},onChangeValueAmountToProduct:(e,n)=>{const{id:s,value:o}=n.payload,r=e.data.products.find(i=>i.id===s);r&&(r.amountToBuy=Number(o))},addAmountToProduct:(e,n)=>{const{id:s}=n.payload,o=e.data.products.find(r=>r.id===s);o&&(o.amountToBuy=o.amountToBuy+1)},diminishAmountToProduct:(e,n)=>{const{id:s}=n.payload,o=e.data.products.find(r=>r.id===s);o&&(o.amountToBuy-=1,o.amountToBuy===0&&e.data.products.splice(e.data.products.indexOf(o),1))},setCashPaymentToTotal:e=>{const n=e.data.totalPurchase.value;e.data.paymentMethod=e.data.paymentMethod.map(s=>({...s,value:s.method==="cash"?n:0,status:s.method==="cash"})),e.data.payment.value=n,e.data.change.value=0},resetCart:e=>({...tl,settings:{...tl.settings,...e.settings,billing:{...e.settings.billing}}}),changeProductWeight:(e,n)=>{const{id:s,weight:o}=n.payload,r=e.data.products.find(i=>i.cid===s);r&&(r.weightDetail.weight=o)},totalPurchaseWithoutTaxes:e=>{const s=e.data.products.reduce((o,r)=>o+r.cost.total,0);e.data.totalPurchaseWithoutTaxes.value=I2(s)},addDiscount:(e,n)=>{const s=n.payload;e.data.discount.value=Number(s)},addSourceOfPurchase:(e,n)=>{const s=n.payload;e.data.sourceOfPurchase=s},togglePrintInvoice:e=>{e.settings.printInvoice=!e.settings.printInvoice},toggleInvoicePanel:e=>{e.settings.isInvoicePanelOpen=!e.settings.isInvoicePanelOpen},setBillingSettings:(e,n)=>{const{billingMode:s,isError:o,isLoading:r}=n.payload;e.settings.billing.billingMode=s,e.settings.billing={...e.settings.billing,...n.payload},e.settings.billing.isLoading=r,e.settings.billing.isError=o},updateProductInsurance:(e,n)=>{const{id:s,mode:o,value:r}=n.payload,i=e.data.products.find(a=>a.id===s||a.cid===s);i&&(i.insurance={mode:o,value:r})},updateInsuranceStatus:(e,n)=>{e.data.insuranceEnabled=n.payload,n.payload||e.data.products.forEach(s=>{s.insurance&&(s.insurance={mode:null,value:0})})},recalcTotals:(e,n)=>{var o,r;const s=n.payload!==void 0&&n.payload!==null?Number(n.payload):void 0;if(jm(e,s),e.data.isAddedToReceivables){const i=((o=e.data.totalPurchase)==null?void 0:o.value)||0;(((r=e.data.payment)==null?void 0:r.value)||0)>=i&&i>0&&(e.data.isAddedToReceivables=!1,e.showCxcAutoRemovalNotification=!0)}},addInvoiceComment:(e,n)=>{e.data.invoiceComment=n.payload},deleteInvoiceComment:e=>{e.data.invoiceComment=""},clearCxcAutoRemovalNotification:e=>{e.showCxcAutoRemovalNotification=!1},updateProductDiscount:(e,n)=>{const{id:s,discount:o}=n.payload,r=e.data.products.find(i=>i.id===s||i.cid===s);r&&(r.discount=o,jm(e))}}}),{addAmountToProduct:fD,setCartId:Yb,setClient:xD,addDiscount:Cm,addProduct:Yn,resetCart:Kb,changeProductPrice:Jb,changeProductWeight:bD,setCashPaymentToTotal:yD,deleteProduct:_u,setPaymentMethod:Ws,toggleReceivableStatus:Hu,diminishAmountToProduct:vD,onChangeValueAmountToProduct:jD,setChange:CD,loadCart:wD,toggleInvoicePanelOpen:Qu,totalPurchase:SD,totalShoppingItems:wm,setTaxReceiptEnabled:Sm,updateProductFields:Im,totalTaxes:ID,toggleCart:kc,togglePrintInvoice:ED,toggleInvoicePanel:AD,setDefaultClient:kD,setBillingSettings:Em,updateProductInsurance:nl,recalcTotals:Tr,updateInsuranceStatus:sl,addInvoiceComment:TD,deleteInvoiceComment:PD,updateProductDiscount:Am,clearCxcAutoRemovalNotification:DD}=xt.actions,Xb=e=>e.cart.data.products,$D=e=>e.cart.data.totalShoppingItems.value,RD=e=>e.cart.isOpen,as=e=>e.cart.data,Zb=e=>e.cart.data.invoiceComment,zt=e=>e.cart.settings,ND=e=>e.cart.showCxcAutoRemovalNotification,Tc=e=>e.cart,ey=e=>e.cart.data.insuranceEnabled,OD=e=>e.cart.data.products.filter(n=>n.discount&&n.discount.value>0),MD=e=>{var o;const n=e.cart.data.products,s=((o=e.taxReceipt)==null?void 0:o.enabled)??!0;return n.reduce((r,i)=>{var a,c;if(i.discount&&i.discount.value>0){const d=((a=i.pricing)==null?void 0:a.price)||i.price||0,u=Number((c=i.pricing)==null?void 0:c.tax)||0,p=i.amountToBuy||1,f=(s?d*(1+u/100):d)*p;let x=0;return i.discount.type==="percentage"?x=f*(i.discount.value/100):x=i.discount.value,r+x}return r},0)},FD=xt.reducer,Yu=iC(),BD=[xt.actions.addProduct,xt.actions.deleteProduct,xt.actions.addAmountToProduct,xt.actions.diminishAmountToProduct,xt.actions.onChangeValueAmountToProduct,xt.actions.changeProductPrice,xt.actions.changeProductWeight,xt.actions.addDiscount,xt.actions.setPaymentMethod,xt.actions.updateProductFields,xt.actions.updateProductInsurance,xt.actions.updateInsuranceStatus,xt.actions.setClient,xt.actions.loadCart,xt.actions.resetCart];Yu.startListening({matcher:aC(...BD),effect:async(e,n)=>{n.dispatch(Tr())}});Yu.startListening({actionCreator:xt.actions.setPaymentAmount,effect:async(e,n)=>{n.dispatch(Tr(Number(e.payload)))}});const LD={search:""},zD=Ee({name:"search",initialState:LD,reducers:{setSearchData:(e,n)=>e.search=n.payload}}),UD=zD.reducer,WD={product:{},ingredient:[],ingredientList:"",totalIngredients:{value:0},totalProductPrice:0},ty=Ee({name:"customProduct",initialState:WD,reducers:{addProduct:(e,n)=>{e.product=n.payload},addIngredient:(e,n)=>{e.ingredient.find(({id:o})=>o===n.payload.id)||e.ingredient.push(n.payload)},deleteIngredient:(e,n)=>{const s=e.ingredient.find(({id:o})=>o===n.payload.id);s&&e.ingredient.splice(e.ingredient.indexOf(s),1)},gettingIngredientList:(e,n)=>{let s=[];e.ingredient.map(o=>s=[...s,o.name]),e.ingredientList=s.toString()},totalPurchase:e=>{const n=e.ingredient.reduce((s,o)=>s+Number(o.cost),0);e.totalIngredients.value=n},formatData:e=>{e.ingredient=[],e.ingredientList="",e.totalIngredients={value:0},e.totalProductPrice=0}}}),{addIngredient:qD,gettingIngredientList:km,totalPurchase:Tm,deleteIngredient:VD,formatData:GD}=ty.actions,_D=ty.reducer,ny=e=>e.customProduct.totalIngredients.value,HD=e=>e.customProduct.ingredient,QD=e=>e.customProduct.ingredientList,YD={product:{productName:"",productImage:"",productImageURL:"",category:"",cost:{unit:"",total:""},price:{unit:0,total:0},tax:{unit:0,ref:"",value:"",total:0},stock:0,netContent:0,amountToBuy:{unit:1,total:1},id:""}},KD=Ee({name:"addProduct",initialState:YD,reducers:{addProductData:(e,n)=>{e.product.productImage=n.payload.productImage},priceTotal:e=>{e.product.cost.total!==""&&e.product.tax.unit!==""&&(e.product.price.total=e.product.cost.total*e.product.tax.value+e.product.cost.total)}}}),JD=KD.reducer;var Px;const sy={condition:(Px=q0())==null?void 0:Px.id,numberId:"",id:"",createdAt:"",deletedAt:"",completedAt:"",deliveryAt:ce.now().toISO(),paymentAt:"",note:"",provider:null,replenishments:[],status:W0().id,attachmentUrls:[],receiptImgUrl:"",total:0},ba={id:"",name:"",quantity:0,purchaseQuantity:0,selectedBackOrders:[],unitMeasurement:"",baseCost:0,unitCost:0,subtotal:0},XD={productSelected:ba,order:sy},oy=Ee({name:"addOrder",initialState:XD,reducers:{getOrderData:(e,n)=>{const s=n.payload;e.order=s||null},setProductSelected:(e,n)=>{const s=n.payload;e.productSelected={...e.productSelected,...s}},SelectProduct:(e,n)=>{var i;const s=n.payload;let o={id:s.id,name:s.name,quantity:0,baseCost:((i=s.pricing)==null?void 0:i.cost)||0};const r=e.order.replenishments.find(a=>a.id===o.id);r&&(o={...o,...r},Be.info({message:`Edición del producto: ${s.name}`,description:"Al agregar este producto, la cantidad y el costo por unidad serán actualizados con los valores ingresados.",duration:0})),e.productSelected=o},AddProductToOrder:e=>{const n=e.order.replenishments.find(s=>s.id===e.productSelected.id);if(n){const s=e.order.replenishments.indexOf(n);e.order.replenishments[s]=e.productSelected}else e.order.replenishments.push(e.productSelected);e.productSelected=ba},setOrder:(e,n)=>{const{dates:s,...o}=n.payload;e.order={...e.order,...o}},getInitialCost:(e,n)=>{const{initialCost:s}=n.payload;e.productSelected.initialCost=s},cleanOrder:e=>{e.productSelected=ba,e.order=sy,e.mode="add"},updateProduct:(e,n)=>{const{value:s}=n.payload,o=e.order.replenishments.findIndex(p=>p.id===s.id);if(o===-1)return;const r=e.order.replenishments[o],i=s.selectedBackOrders!==void 0?s.selectedBackOrders:r.selectedBackOrders||[],a=i.reduce((p,h)=>p+h.quantity,0),c=s.purchaseQuantity!==void 0?s.purchaseQuantity:s.quantity!==void 0?s.quantity+a:r.purchaseQuantity,d=s.quantity!==void 0?s.quantity:Math.max(0,c-a),u={...r,...s,purchaseQuantity:c,quantity:d,selectedBackOrders:i};e.order.replenishments[o]={...u,unitCost:ry(u),subtotal:ZD(u)}},addAttachmentToOrder:(e,n)=>{e.order.attachmentUrls=[...e.order.attachmentUrls,n.payload]},clearProductSelected:e=>{e.productSelected=ba},deleteReceiptImageFromOrder:e=>{e.order.receiptUrl=""},deleteProductFromOrder:(e,n)=>{const{id:s}=n.payload;e.order.replenishments=e.order.replenishments.filter(o=>o.id!==s)},setSelectedBackOrders:(e,n)=>{const{selectedBackOrders:s,purchaseQuantity:o}=n.payload,r=s.reduce((i,a)=>i+a.quantity,0);e.productSelected={...e.productSelected,selectedBackOrders:s,purchaseQuantity:o,quantity:Math.max(0,o-r)}},setPurchaseQuantity:(e,n)=>{const s=n.payload,o=e.productSelected.selectedBackOrders.reduce((r,i)=>r+i.quantity,0);e.productSelected={...e.productSelected,purchaseQuantity:s,quantity:Math.max(0,s-o)}},clearSelectedBackOrders:e=>{e.productSelected={...e.productSelected,selectedBackOrders:[],purchaseQuantity:e.productSelected.quantity,quantity:e.productSelected.quantity}}}}),ry=e=>{const n=Number(e.baseCost)||0,s=n*(Number(e.taxPercentage)||0)/100,o=Number(e.freight)||0,r=Number(e.otherCosts)||0;return n+s+o+r},ZD=e=>{const n=Number(e.purchaseQuantity||e.quantity)||0,s=ry(e);return n*s},{setOrder:fs,cleanOrder:ol,SelectProduct:Pm,updateProduct:e$,deleteProductFromOrder:t$,clearProductSelected:n$,AddProductToOrder:s$,setProductSelected:o$,setSelectedBackOrders:r$,clearSelectedBackOrders:rl}=oy.actions,i$=e=>e.addOrder.productSelected,iy=e=>e.addOrder.order,a$=e=>e.addOrder,c$=oy.reducer,l$={img:null,url:null,loading:!1,status:0},d$=Ee({name:"uploadImg",initialState:l$,reducers:{SaveImg:(e,n)=>{const{img:s,url:o}=n.payload;s&&(e.img=s),o&&(e.url=o)},clearImg:e=>{e.img=null,e.url=null},UploadProgress:(e,n)=>{const{progress:s}=n.payload;e.status=s||0},UploadImgLoading:(e,n)=>{e.loading=n.payload}}}),u$=e=>e.uploadImg.url,p$=e=>e.uploadImg.loading,m$=e=>e.uploadImg.status,h$=d$.reducer,g$=localStorage.getItem("theme")||"light",f$=Ee({name:"theme",initialState:{mode:g$},reducers:{toggleTheme:e=>{e.mode=e.mode==="light"?"dark":"light",localStorage.setItem("theme",e.mode)},setTheme:(e,n)=>{e.mode=n.payload,e.mode==="dark"?localStorage.setItem("theme","light"):localStorage.setItem("theme","dark")}}}),x$=f$.reducer,b$=e=>e.theme.mode,y$={currentNotification:{title:"",message:"",visible:!1,type:null}},ay=Ee({name:"notification",initialState:y$,reducers:{addNotification:(e,n)=>{const{message:s,title:o,type:r}=n.payload;e.currentNotification={message:s,title:o,type:r,visible:!0}},removeNotification:e=>{e.currentNotification={title:"",message:"",visible:!1,type:null}}}}),{addNotification:Bd,removeNotification:v$}=ay.actions,j$=ay.reducer,cy=e=>e.notification.currentNotification,C$={isOpen:!1},ly=Ee({name:"notificationCenter",initialState:C$,reducers:{openNotificationCenter:(e,n)=>{e.isOpen=!0},closeNotificationCenter:e=>{e.isOpen=!1}}}),{openNotificationCenter:dy,closeNotificationCenter:w$}=ly.actions,S$=e=>e.notificationCenter,I$=ly.reducer,E$={isOpen:!1},uy=Ee({name:"nav",initialState:E$,reducers:{toggleOpenMenu:(e,n)=>{let s=n.payload||!e.isOpen;e.isOpen=s},closeMenu:e=>{e.isOpen=!1}}}),{toggleOpenMenu:py}=uy.actions,A$=uy.reducer,k$={APP_MODE:{TEST_MODE:!1},THEME_MODE:{DARK:"dark",LIGHT:"light"}},T$=Object.freeze({OPERATION_MODES:_e,...k$}),my=Ee({name:"appMode",initialState:{mode:!1,notificationMode:T$.APP_MODE.TEST_MODE},reducers:{toggleMode:e=>{const n=e.mode;e.mode=!n}}}),{toggleMode:Ld}=my.actions,Ku=e=>e.app.mode,P$=my.reducer,D$={show:!1,message:""},hy=Ee({name:"loader",initialState:D$,reducers:{toggleLoader:(e,n)=>{const{show:s,message:o}=n.payload;e.show=s,e.message=o||""}}}),{toggleLoader:yi}=hy.actions,$$=hy.reducer,R$=e=>e.loader.show,N$=e=>e.loader.message,O$={show:!1,url:""},gy=Ee({name:"imageViewer",initialState:O$,reducers:{toggleImageViewer:(e,n)=>{const{show:s,url:o}=n.payload;e.show=s,e.url=o||""},clearImageViewer:e=>{}}}),{toggleImageViewer:Ju}=gy.actions,M$=gy.reducer,F$=e=>e.imageViewer.show,B$=e=>e.imageViewer.url,L$={id:"",type:"",productName:"",category:"",amountToBuy:{unit:1,total:1},price:{unit:0,total:0},mitad:{first:"",second:""}},z$={productName:"",cost:{unit:0,total:0},id:"",price:{unit:0,total:0},amountToBuy:{unit:1,total:1},tax:{ref:"Exento",value:0,unit:0,total:0},size:""},U$={a:"",b:""},W$=Ee({name:"customPizza",initialState:{products:[],pizzaSlices:[],sizeList:[],isComplete:!0,product:L$,productSelected:U$,totalIngredientPrice:0,ingredientListNameSelected:"",newProduct:z$},reducers:{setProducts:(e,n)=>{e.products=n.payload},setIsComplete:(e,n)=>{e.isComplete=n.payload},setProduct:(e,n)=>{e.product=n.payload},setProductSelected:(e,n)=>{e.productSelected=n.payload},setTotalIngredientPrice:(e,n)=>{e.totalIngredientPrice=n.payload},setIngredientListNameSelected:(e,n)=>{e.ingredientListNameSelected=n.payload},setNewProduct:(e,n)=>{e.newProduct=n.payload}}}),q$=W$.reducer,fy=[],zd={id:null,product:null,motive:"",quantityRemoved:0,observations:"",status:!1},V$={productList:fy},G$={mode:_e.CREATE.label,productSelected:zd,data:{productList:fy}},xy=Ee({name:"productOutflow",initialState:G$,reducers:{selectProduct:(e,n)=>{var o;const s=n.payload;e.productSelected={...e.productSelected||{},...s||{},id:((o=e.productSelected)==null?void 0:o.id)||be(10)}},addProductToProductOutflow:(e,n)=>{let s=n.payload;s={...s},e.data.productList=[...e.data.productList,s],e.productSelected=zd},updateProductFromProductOutflow:(e,n)=>{const{id:s,data:o}=n.payload,r=e.data.productList.map(i=>i.id===s?{...i,...o}:i);e.data.productList=r},deleteProductFromProductOutflow:(e,n)=>{const{id:s}=n.payload,o=e.data.productList.filter(r=>r.id!==s);o&&(e.data.productList=o)},setProductOutflowData:(e,n)=>{const{data:s}=n.payload;return{...e,productSelected:s.productSelected,data:{...e.data,...s.data},mode:s.mode}},deleteData:e=>{e.mode=_e.CREATE.label,e.productSelected=zd,e.data=V$}}}),{selectProduct:vi,addProductToProductOutflow:_$,deleteProductFromProductOutflow:H$,deleteData:Q$,updateProductFromProductOutflow:Y$,setProductOutflowData:by}=xy.actions,Xu=e=>e.productOutflow,yy=e=>e.productOutflow.productSelected,K$=e=>e.productOutflow.data.productList,J$=xy.reducer,X$=[{ref:"1",value:1,quantity:null},{ref:"5",value:5,quantity:null},{ref:"10",value:10,quantity:null},{ref:"25",value:25,quantity:null},{ref:"50",value:50,quantity:null},{ref:"100",value:100,quantity:null},{ref:"200",value:200,quantity:null},{ref:"500",value:500,quantity:null},{ref:"1000",value:1e3,quantity:null},{ref:"2000",value:2e3,quantity:null}],La={initialized:!1,employee:null,approvalEmployee:null,date:null,banknotes:X$,banknotesTotal:0,banknotesAmount:0,comments:null},Z$={state:null,opening:La,closing:La,sales:[],totalCard:0,totalTransfer:0,totalCharged:0,totalDiscrepancy:0,totalRegister:0,totalSystem:0},vy=Ee({name:"cashCountManagement",initialState:Z$,reducers:{updateCashCountTotals:(e,n)=>{const{totalCard:s,totalTransfer:o,totalCharged:r,totalDiscrepancy:i,totalRegister:a,totalSystem:c}=n.payload;e.totalCard=s||0,e.totalTransfer=o||0,e.totalCharged=r||0,e.totalDiscrepancy=i||0,e.totalRegister=a||0,e.totalSystem=c||0},setCashCountOpeningBanknotes:(e,n)=>{e.opening.banknotes=n.payload,e.opening.banknotesAmount=Dm(e.opening.banknotes),e.opening.banknotesTotal=e.opening.banknotes.reduce((s,o)=>s+o.value*o.quantity,0)},setCashCountOpeningEmployee:(e,n)=>{e.opening.employee=n.payload},setCashCountOpeningDate:(e,n)=>{e.opening.date=n.payload},setCashCountOpeningComments:(e,n)=>{e.opening.comments=n.payload},setCashCountOpening:(e,n)=>{e.opening=n.payload},setCashCountClosingBanknotes:(e,n)=>{e.closing.banknotes=n.payload,e.closing.banknotesAmount=Dm(e.closing.banknotes),e.closing.banknotesTotal=e.closing.banknotes.reduce((s,o)=>s+o.value*o.quantity,0)},setCashCountClosingComments:(e,n)=>{e.closing.comments=n.payload},addPropertiesToCashCount:(e,n)=>{const s=n.payload;return{...e,...s}},setCashCountSales:(e,n)=>{e.sales=n.payload},setClosingCashTotalAndDiscrepancy:(e,n)=>{e.closing.totals=n.payload},setCashCount:(e,n)=>n.payload,clearCashCount:e=>{e.opening=La,e.closing=La,e.totalCard=0,e.totalTransfer=0,e.totalCharged=0,e.totalDiscrepancy=0,e.totalRegister=0,e.totalSystem=0,e.updatedAt=null,e.createdAt=null,e.sales=[],e.state=null,e.id=null,e.incrementNumber=null}}});function Dm(e){let n=e.reduce((s,o)=>s+o.quantity,0);return Number(n)}const{addPropertiesToCashCount:eR,setCashCountOpeningBanknotes:jy,setCashCountOpeningComments:tR,setCashCountClosingBanknotes:nR,setCashCountClosingComments:$m,updateCashCountTotals:sR,setCashCount:oR,clearCashCount:Pc}=vy.actions,rR=vy.reducer,_o=e=>e.cashCountManagement,iR={currentDialog:{isOpen:!1,title:"[title]",description:"[Description]",onConfirm:null,btnSubmitName:null,btnCancelName:null}},Cy=Ee({name:"userNotification",initialState:iR,reducers:{setUserNotification:(e,n)=>{e.currentDialog=n.payload},closeUserNotification:e=>{const n={isOpen:!1,title:"Titulo",description:"Descripcion",onConfirm:null};e.currentDialog=n}}}),{setUserNotification:za,closeUserNotification:Zu}=Cy.actions,aR=Cy.reducer,cR=e=>e.userNotification.currentDialog,wy=Ee({name:"userRegistration",initialState:{user:{name:"",password:"",role:"",id:"",businessID:void 0,createAt:""},errors:{},status:"idle",errorMessage:""},reducers:{updateUser:(e,n)=>{e.user={...e.user,...n.payload}},setManagementUser:(e,n)=>{e.user={...n.payload}},setErrors:(e,n)=>{e.errors=n.payload},clear:e=>{e.user={name:"",password:"",role:"",id:"",businessID:void 0,createAt:""},e.errors={}}}}),{updateUser:lR}=wy.actions,dR=wy.reducer;let uR={cashReconciliation:{state:"closed",cashCount:{}}};const Sy=Ee({name:"cashCountState",initialState:uR,reducers:{setCashReconciliation:(e,n)=>{n.payload&&typeof n.payload=="object"?e.cashReconciliation=n.payload:e.cashReconciliation=null},clearCashReconciliation:e=>{e.cashReconciliation={state:"closed",cashCount:{}}}}}),{setCashReconciliation:Rm,clearCashReconciliation:pR}=Sy.actions,mR=Sy.reducer,hR=e=>e.cashCountState.cashReconciliation,Lr=e=>Math.round(e*100)/100,il=(e,n)=>{const s={...e,pricing:{...e==null?void 0:e.pricing}};return s.amountToBuy=n,s},Yo=e=>{let n=zu(e),s=$s(e);return{totalPurchase:Lr(n),totalTaxes:Lr(s)}},Ko=e=>Lu(e),Jo=(e,n)=>{const s=e*(n/100);return Lr(e-s)},Xo=(e,n)=>Lr(n-e),al=e=>{const n=Nn(e);return Lr(n)},Ud={id:"",sourceOfPurchase:"",paymentMethod:[{name:"",status:!1,method:"",value:0},{method:"",status:!1,name:"",value:0},{method:"",name:"",status:!1,value:0}],client:{},NCF:"",totalPurchaseWithoutTaxes:{value:0},totalTaxes:{value:0},delivery:{value:"",status:!1},date:0,change:{value:0},products:[],payment:{value:0},totalPurchase:{value:0},payWith:{value:0},totalShoppingItems:{value:0},discount:{value:0}},gR={invoice:Ud,modal:{isOpen:!1,mode:"add"}},Iy=Ee({name:"invoiceForm",initialState:gR,reducers:{addInvoice(e,n){const{mode:s,invoice:o}=n.payload,r=o.products.map(u=>il(u,u.amountToBuy)),{totalPurchase:i,totalTaxes:a}=Yo(r),c=Ko(o.products),d=al(o.products);if(e.invoice={...o,products:r,totalPurchase:{value:i},totalTaxes:{value:a},totalShoppingItems:{value:c},totalPurchaseWithoutTaxes:{value:d}},o.discount&&o.discount.value&&(e.invoice.totalPurchase.value=Jo(e.invoice.totalPurchase.value,o.discount.value)),o.payment&&o.payment.value){const u={...e.invoice.change};u.value=Xo(e.invoice.totalPurchase.value,o.payment.value),e.invoice.change=u}e.modal.mode=s||"add",e.modal.isOpen=!0},addProductInvoiceForm(e,n){const{product:s}=n.payload;if(!s)return;const o=s.id;if(!o)return;const r=e.invoice.products.findIndex(c=>c.id===o);r!==-1?e.invoice.products[r]=il(e.invoice.products[r],e.invoice.products[r].amountToBuy.total+1):e.invoice.products=[...e.invoice.products,s];const{totalPurchase:i,totalTaxes:a}=Yo(e.invoice.products);e.invoice.totalPurchase.value=i,e.invoice.totalTaxes.value=a,e.invoice.totalShoppingItems.value=Ko(e.invoice.products),e.invoice.discount.value&&(e.invoice.totalPurchase.value=Jo(e.invoice.totalPurchase.value,e.invoice.discount.value)),e.invoice.payment.value&&(e.invoice.change.value=Xo(e.invoice.totalPurchase.value,e.invoice.payment.value))},cancelInvoice:(e,n)=>{const{cancelationReason:s,user:o}=n.payload;e.invoice.cancel={reason:s,cancelledAt:ce.now().toMillis(),user:o}},changeValueInvoiceForm(e,n){const{invoice:s}=n.payload;e.invoice={...e.invoice,...s};const{totalPurchase:o,totalTaxes:r}=Yo(e.invoice.products);e.invoice.totalPurchase.value=o,e.invoice.totalTaxes.value=r,e.invoice.totalShoppingItems.value=Ko(e.invoice.products),e.invoice.totalPurchaseWithoutTaxes.value=al(e.invoice.products),e.invoice.discount&&e.invoice.discount.value&&(e.invoice.totalPurchase.value=Jo(e.invoice.totalPurchase.value,e.invoice.discount.value)),e.invoice.payment&&e.invoice.payment.value&&(e.invoice.change.value=Xo(e.invoice.totalPurchase.value,e.invoice.payment.value))},changeClientInvoiceForm(e,n){const{client:s}=n.payload;e.invoice.client={...e.invoice.client,...s}},deleteProductInvoiceForm(e,n){const{product:s}=n.payload;if(!s)return;const o=e.invoice.products.findIndex(a=>a.id===s.id);if(o===-1)return;e.invoice.products.splice(o,1);const{totalPurchase:r,totalTaxes:i}=Yo(e.invoice.products);e.invoice.totalPurchase.value=r,e.invoice.totalTaxes.value=i,e.invoice.totalShoppingItems.value=Ko(e.invoice.products),e.invoice.totalPurchaseWithoutTaxes.value=al(e.invoice.products),e.invoice.discount.value&&(e.invoice.totalPurchase.value=Jo(e.invoice.totalPurchase.value,e.invoice.discount.value)),e.invoice.change.value=Xo(e.invoice.totalPurchase.value,e.invoice.payment.value)},changeAmountToBuyProduct(e,n){const{product:s,type:o,amount:r}=n.payload;if(!s)return;const i=e.invoice.products.findIndex(u=>u.id===s.id);if(i===-1)return;let a=e.invoice.products[i].amountToBuy;switch(o){case"add":a+=1;break;case"subtract":a=Math.max(1,a-1);break;case"change":a=Math.max(1,r);break}e.invoice.products[i]=il(e.invoice.products[i],a);const{totalPurchase:c,totalTaxes:d}=Yo(e.invoice.products);e.invoice.totalPurchase.value=c,e.invoice.totalTaxes.value=d,e.invoice.totalShoppingItems.value=Ko(e.invoice.products),e.invoice.discount.value&&(e.invoice.totalPurchase.value=Jo(e.invoice.totalPurchase.value,e.invoice.discount.value)),e.invoice.change.value=Xo(e.invoice.totalPurchase.value,e.invoice.payment.value)},closeInvoiceForm(e,n){var s;(s=n==null?void 0:n.payload)!=null&&s.clear,e.modal.isOpen=!1,e.invoice=Ud,e.modal.mode="add"},clearInvoice(e){e.invoice=Ud,e.modal.mode="add",e.modal.isOpen=!1}}}),{addInvoice:fR,addProductInvoiceForm:xR,closeInvoiceForm:Wd,deleteProductInvoiceForm:bR,changeValueInvoiceForm:Nm,changeAmountToBuyProduct:cl,changeClientInvoiceForm:Ey}=Iy.actions,yR=e=>e.invoiceForm,vR=Iy.reducer,jR={isVisible:!1,product:null,weight:1,product:null,onAdd:null,totalPrice:0},CR=Ee({name:"productWeightEntryModalSlice",initialState:jR,reducers:{openModal:(e,n)=>{e.isVisible=!0,e.product=n.payload.product,e.weight=1,e.totalPrice=n.payload.product.pricePerUnit*1},closeModal:e=>{e.isVisible=!1,e.product=null,e.weight=1,e.totalPrice=0},setWeight:(e,n)=>{e.weight=n.payload,e.totalPrice=e.product.pricePerUnit*n.payload}}}),wR=CR.reducer,ll={mode:"add",expense:{description:"",amount:0,dates:{expenseDate:Date.now(),createdAt:""},receiptImageUrl:"",category:"",categoryId:""}},Ay=Ee({name:"expenseManagement",initialState:ll,reducers:{setExpense:(e,{payload:n})=>{e.expense={...e.expense,...n,dates:{...e.expense.dates,...n.dates},invoice:{...e.expense.invoice,...n.invoice},payment:{...e.expense.payment,...n.payment},attachments:n.attachments??e.expense.attachments}},resetExpense:e=>{e.expense=ll.expense,e.mode=ll.mode},setExpenseMode:(e,n)=>{e.mode=n.payload}}}),{setExpense:Ua,resetExpense:ky,setExpenseMode:SR}=Ay.actions,IR=Ay.reducer,ER=e=>e.expenseManagement,AR={expenses:[]},Ty=Ee({name:"expensesList",initialState:AR,reducers:{setExpenseList:(e,n)=>{e.expenses=n.payload}}}),{setExpenseList:kR}=Ty.actions,TR=Ty.reducer,Py=e=>e.expensesList.expenses,PR={modals:{chartExpenseModal:{isOpen:!1},expenseFormModal:{isOpen:!1}}},Dy=Ee({name:"expenseUI",initialState:PR,reducers:{toggleExpenseChartModal:e=>{e.modals.chartExpenseModal.isOpen=!e.modals.chartExpenseModal.isOpen},toggleExpenseFormModal:e=>{e.modals.expenseFormModal.isOpen=!e.modals.expenseFormModal.isOpen},openExpenseFormModal:e=>{e.modals.expenseFormModal.isOpen=!0},closeExpenseFormModal:e=>{e.modals.expenseFormModal.isOpen=!1}}}),{toggleExpenseChartModal:$y,openExpenseFormModal:Ry,closeExpenseFormModal:DR}=Dy.actions,$R=Dy.reducer,RR=e=>e.expenseUI.modals.chartExpenseModal,NR=e=>e.expenseUI.modals.expenseFormModal,OR=Object.freeze(Object.defineProperty({__proto__:null,expenseManagement:IR,expenseUI:$R,expensesList:TR},Symbol.toStringTag,{value:"Module"}));var Dx;const qd={id:null,numberId:"",replenishments:[],condition:(Dx=q0())==null?void 0:Dx.id,note:"",orderId:"",invoiceNumber:"",proofOfPurchase:"",completedAt:null,deliveryAt:ce.now().toISO(),paymentAt:ce.now().toISO(),createdAt:null,updatedAt:null,deletedAt:null,status:W0().id,attachmentUrls:[],provider:null},ya={id:"",name:"",expirationDate:null,quantity:0,purchaseQuantity:0,selectedBackOrders:[],unitMeasurement:"",baseCost:0,taxPercentage:0,freight:0,otherCosts:0,unitCost:0,subtotal:0},MR={mode:"create",productSelected:ya,purchase:qd},Ny=Ee({name:"addPurchase",initialState:MR,reducers:{setAddPurchaseMode:(e,n)=>{e.mode=n.payload},getOrderData:(e,n)=>{const s=n.payload;e.purchase=s||qd},setProductSelected:(e,n)=>{const s=n.payload;e.productSelected={...e.productSelected,...s}},SelectProduct:(e,n)=>{var i;const s=n.payload;let o={id:s.id,name:s.name,expirationDate:"",quantity:0,purchaseQuantity:0,selectedBackOrders:[],unitMeasurement:"",baseCost:((i=s.pricing)==null?void 0:i.cost)||0,taxPercentage:0,freight:0,otherCosts:0,unitCost:0,subtotal:0};const r=e.purchase.replenishments.find(a=>a.id===o.id);r&&(o={...o,...r},Be.info({message:`Edición del producto: ${s.name}`,description:"Al agregar este producto, la cantidad y el costo por unidad serán actualizados con los valores ingresados.",duration:0})),o.unitCost=Vd(o),o.subtotal=Om(o),e.productSelected=o},AddProductToPurchase:e=>{const n=e.purchase.replenishments.find(o=>o.id===e.productSelected.id),s={...e.productSelected};if(n){const o=e.purchase.replenishments.indexOf(n);e.purchase.replenishments[o]=s}else e.purchase.replenishments.push(s);e.productSelected=ya},updateStock:(e,n)=>{const{stock:s}=n.payload;e.productSelected.product.stock=s},setPurchase:(e,n)=>{const{dates:s,...o}=n.payload;e.purchase={...e.purchase,...o}},getInitialCost:(e,n)=>{const{initialCost:s}=n.payload;e.productSelected.initialCost=s},cleanPurchase:e=>{e.productSelected=ya,e.purchase=qd,e.mode="add"},updateProduct:(e,n)=>{const{value:s}=n.payload,o=e.purchase.replenishments.findIndex(f=>f.id===s.id);if(o===-1)return;const r=e.purchase.replenishments[o],i=s.selectedBackOrders!==void 0?s.selectedBackOrders:r.selectedBackOrders||[],a=i.reduce((f,x)=>f+x.quantity,0),c=s.purchaseQuantity!==void 0?s.purchaseQuantity:s.quantity!==void 0?s.quantity+a:r.purchaseQuantity,d=s.quantity!==void 0?s.quantity:Math.max(0,c-a),u={...r,...s,purchaseQuantity:c,quantity:d,selectedBackOrders:i},p=Vd(u),h=Om(u);e.purchase.replenishments[o]={...u,unitCost:p,subtotal:h}},addAttachmentToPurchase:(e,n)=>{e.purchase.attachmentUrls=[...e.purchase.attachmentUrls,n.payload]},clearProductSelected:e=>{e.productSelected=ya},deleteReceiptImageFromPurchase:e=>{e.purchase.receiptUrl=""},deleteProductFromPurchase:(e,n)=>{const{id:s}=n.payload;e.purchase.replenishments=e.purchase.replenishments.filter(o=>o.id!==s)},setSelectedBackOrders:(e,n)=>{const{selectedBackOrders:s,purchaseQuantity:o}=n.payload,r=s.reduce((i,a)=>i+a.quantity,0);e.productSelected={...e.productSelected,selectedBackOrders:s,purchaseQuantity:o,quantity:Math.max(0,o-r)}},setPurchaseQuantity:(e,n)=>{const s=n.payload,o=e.productSelected.selectedBackOrders.reduce((r,i)=>r+i.quantity,0);e.productSelected={...e.productSelected,purchaseQuantity:s,quantity:Math.max(0,s-o)}},clearSelectedBackOrders:e=>{e.productSelected={...e.productSelected,selectedBackOrders:[],purchaseQuantity:e.productSelected.quantity,quantity:e.productSelected.quantity}}}}),Vd=e=>{const n=Number(e.baseCost)||0,s=n*(Number(e.taxPercentage)||0)/100,o=Number(e.freight)||0,r=Number(e.otherCosts)||0;return n+s+o+r},Om=e=>{console.log(e);const n=Number(e.purchaseQuantity||e.quantity)||0,s=Vd(e);return n*s},{setPurchase:dn,getOrderData:FR,updateProduct:BR,cleanPurchase:wo,SelectProduct:Mm,setProductSelected:LR,clearProductSelected:zR,AddProductToPurchase:UR,deleteProductFromPurchase:WR,setSelectedBackOrders:qR,setPurchaseQuantity:VR,clearSelectedBackOrders:dl}=Ny.actions,GR=e=>e.addPurchase.productSelected,Oy=e=>e.addPurchase.purchase,_R=e=>e.addPurchase,HR=Ny.reducer,QR=Object.freeze(Object.defineProperty({__proto__:null,addPurchase:HR,purchaseUI:qk,purchases:Uk},Symbol.toStringTag,{value:"Module"})),My=Ee({name:"barcodePrintModal",initialState:{isOpen:!1,product:null},reducers:{toggleBarcodeModal:(e,n)=>{const s=n.payload;s?(e.isOpen=!0,e.product=s):(e.isOpen=!1,e.product=null)}}}),{toggleBarcodeModal:Gd}=My.actions,YR=My.reducer,KR=e=>e.barcodePrintModal,JR={items:[],statusFilter:"all",sortKey:"fecha",sortOrder:"asc"},XR=Ee({name:"invoices",initialState:JR,reducers:{setInvoices(e,n){e.items=n.payload},filterInvoicesByStatus(e,n){e.statusFilter=n.payload},sortInvoices(e,n){const{sortKey:s,sortOrder:o}=n.payload;e.sortKey=s,e.sortOrder=o}}}),ZR=XR.reducer,eN={data:null,isOpen:!1},Fy=Ee({name:"invoicePreview",initialState:eN,reducers:{openInvoicePreviewModal:(e,n)=>{e.data=n.payload,e.isOpen=!0},closeInvoicePreviewModal:e=>{e.data=null,e.isOpen=!1}}}),{openInvoicePreviewModal:tN,closeInvoicePreviewModal:nN}=Fy.actions,sN=e=>e.invoicePreview,oN=Fy.reducer,By={id:"",invoiceId:"",clientId:"",paymentFrequency:"monthly",totalInstallments:1,installmentAmount:0,paymentDate:null,lastPaymentDate:null,lastPayment:0,totalReceivable:0,currentBalance:0,arBalance:0,isClosed:!1,isActive:!0,createdAt:ce.now().toMillis(),updatedAt:ce.now().toMillis(),createdBy:"",updatedBy:"",comments:""};async function rN(e,n){try{if(!n)throw new Error("No tienes permisos para acceder a esta cuenta por cobrar.");const s=F(le($,"businesses",n,"accountsReceivable"),e),o=await Se(s);if(!o.exists())throw new Error("Cuenta por cobrar no encontrada.");const r=o.data(),i=F(le($,"businesses",n,"clients"),r.clientId),a=await Se(i),c=a.exists()?a.data():null,d=F(le($,"businesses",n,"invoices"),r.invoiceId),u=await Se(d),p=u.exists()?u.data():null,h=he(le($,"businesses",n,"accountsReceivableInstallments"),te("arId","==",e)),f=await Me(h),x=[],g=[];f.forEach(A=>{const P={id:A.id,...A.data()};x.push(P),g.push(A.id)});let y=[];if(g.length>0){const A=[];for(let w=0;w<g.length;w+=10){const S=g.slice(w,w+10);A.push(S)}for(const w of A){const S=he(le($,"businesses",n,"accountsReceivableInstallmentPayments"),te("installmentId","in",w));(await Me(S)).forEach(T=>{y.push({id:T.id,...T.data()})})}}const b=y.map(A=>A.paymentId),v=[...new Set(b)],C=[];if(v.length>0){const A=[];for(let w=0;w<v.length;w+=10){const S=v.slice(w,w+10);A.push(S)}for(const w of A){const S=he(le($,"businesses",n,"accountsReceivablePayments"),te("__name__","in",w));(await Me(S)).forEach(T=>{C.push({id:T.id,...T.data()})})}}const I={};C.forEach(A=>{I[A.id]=A}),y=y.map(A=>({...A,paymentDetails:I[A.paymentId]||null}));const j=x.map(A=>({...A,payments:y.filter(P=>P.installmentId===A.id)}));return{accountReceivable:{id:e,...r},client:c,invoice:p,installments:j}}catch(s){throw console.error("Error al obtener los detalles de la cuenta por cobrar:",s),s}}const iN=(e,n,s=.01)=>e===null||n===null?e!==n:typeof e=="number"&&typeof n=="number"?Math.abs(e-n)>s:e!==n,Ly=(e,n,s=.01)=>{if(!e||typeof e!="object"||!n||typeof n!="object"||Object.keys(n).length===0)return;let o=!1;return Object.keys(n).forEach(r=>{iN(e[r],n[r],s)&&(e[r]=n[r],o=!0)}),o},aN={ar:By,arDetailsModal:{isOpen:!1,arId:""},info:{ar:{},client:{},invoice:{},payments:[],installments:[],paymentInstallment:[]},loading:!1,error:null},va=Za("accountsReceivable/fetchDetails",async({arId:e,businessID:n},{rejectWithValue:s})=>{try{return await rN(e,n)}catch(o){return s(o.message)}}),zy=Ee({name:"accountsReceivable",initialState:aN,reducers:{setAR(e,n){Ly(e.ar,n.payload)||(e.ar.updatedAt=ce.now().toMillis())},setAccountReceivableInfo(e,n){const{ar:s,payments:o,installments:r,paymentInstallments:i}=n.payload;s&&(e.info.ar=s),o&&(e.info.payments=o),r&&(e.info.installments=r),i&&(e.info.paymentInstallment=i)},toggleARInfoModal(e){const n=e.arDetailsModal.isOpen;e.arDetailsModal.isOpen=!n,n||(e.arDetailsModal.arId="")},setARDetailsModal(e,n){e.arDetailsModal.isOpen=n.payload.isOpen,e.arDetailsModal.arId=n.payload.arId},resetAR(e){e.ar=By,e.info={ar:{},client:{},invoice:{},payments:[],installments:[],paymentInstallment:[]},e.loading=!1,e.error=null}},extraReducers:e=>{e.addCase(va.pending,n=>{n.loading=!0,n.error=null}).addCase(va.fulfilled,(n,s)=>{n.loading=!1;const{accountReceivable:o,client:r,invoice:i,installments:a}=s.payload,c=(a==null?void 0:a.reduce((d,u)=>u.payments&&Array.isArray(u.payments)?[...d,...u.payments.map(p=>({...p,installmentNumber:u.installmentNumber,installmentDate:u.installmentDate}))]:d,[]))||[];n.ar={...n.ar,...o},n.info={ar:o||{},client:(r==null?void 0:r.client)||{},invoice:(i==null?void 0:i.data)||{},installments:a||[],payments:c,paymentInstallment:[]}}).addCase(va.rejected,(n,s)=>{n.loading=!1,n.error=s.payload||"Error al obtener los detalles de la cuenta por cobrar."})}}),{setAR:qn,setARDetailsModal:Uy,resetAR:Dc}=zy.actions,cN=zy.reducer,ci=e=>e.accountsReceivable.ar,lN=e=>e.accountsReceivable.info,dN=e=>e.accountsReceivable.loading,uN=e=>e.accountsReceivable.error,pN=e=>e.accountsReceivable.arDetailsModal,mN=async(e,n)=>{try{const s=le($,"businesses",e.businessID,"accountsReceivableInstallments"),o=he(s,te("arId","==",n),te("isActive","==",!0),it("installmentDate","asc"),uu(1)),r=await Me(o);if(r.empty)return null;const i=r.docs[0].data();return i==null?void 0:i.installmentBalance}catch(s){throw console.error("Error getting last installment amount by AR ID:",s),s}},Wy={paymentScope:"balance",paymentOption:"installment",clientId:"",arId:"",paymentMethods:[{method:"cash",value:0,status:!0},{method:"card",value:0,reference:"",status:!1},{method:"transfer",value:0,reference:"",status:!1}],comments:"",totalAmount:0,totalPaid:0,printReceipt:!0},hN={isOpen:!1,paymentDetails:{...Wy},error:null,isValid:!0,methodErrors:{},extra:null,installment:null},_d=Za("accountsReceivablePayment/fetchLastInstallmentAmount",async({user:e,arId:n},{rejectWithValue:s})=>{try{const o=await mN(e,n);return{arId:n,lastInstallmentAmount:o}}catch(o){return s(o.message)}}),qy=Ee({name:"accountsReceivablePayment",initialState:hN,reducers:{openPaymentModal:e=>{e.isOpen=!0},closePaymentModal:e=>{e.isOpen=!1,e.paymentDetails={...Wy},e.error=null,e.isValid=!0,e.methodErrors={},e.extra=null},setPaymentDetails:(e,n)=>{e.paymentDetails={...e.paymentDetails,...n.payload}},setPaymentOption:(e,n)=>{const{paymentOption:s}=n.payload;e.paymentDetails.paymentOption=s,e.paymentDetails.paymentScope==="account"&&e.paymentDetails.paymentOption==="installment"?e.paymentDetails.totalAmount=e.extra.installmentAmount:e.paymentDetails.paymentScope==="account"&&(e.paymentDetails.totalAmount=e.extra.arBalance)},setAccountPayment:(e,n)=>{const{isOpen:s,paymentDetails:o,error:r,isValid:i,methodErrors:a,extra:c}=n.payload;s!==void 0&&(e.isOpen=s),o!==void 0&&(e.paymentDetails={...e.paymentDetails,...o}),c!==void 0&&(e.extra=c),r!==void 0&&(e.error=r),i!==void 0&&(e.isValid=i),a!==void 0&&(e.methodErrors=a),e.paymentDetails.paymentScope==="account"&&e.paymentDetails.paymentOption==="installment"?e.paymentDetails.totalAmount=e.extra.installmentAmount:e.paymentDetails.totalAmount=o.totalAmount},updatePaymentMethod:(e,n)=>{const{method:s,key:o,value:r}=n.payload,i=e.paymentDetails.paymentMethods.findIndex(a=>a.method===s);if(i!==-1){const a=e.paymentDetails.paymentMethods[i];o==="reference"&&s==="cash"||(a[o]=r),e.paymentDetails.totalPaid=e.paymentDetails.paymentMethods.reduce((c,d)=>d.status?c+d.value:c,0)}},setError:(e,n)=>{e.error=n.payload},setIsValid:(e,n)=>{e.isValid=n.payload},setMethodError:(e,n)=>{const{method:s,key:o,error:r}=n.payload;e.methodErrors[`${s}_${o}`]=r},clearMethodErrors:(e,n)=>{const{method:s}=n.payload;delete e.methodErrors[`${s}_value`],delete e.methodErrors[`${s}_reference`]}},extraReducers:e=>{e.addCase(_d.fulfilled,(n,s)=>{const{arId:o,lastInstallmentAmount:r}=s.payload;n.paymentDetails.arId===o&&(n.extra={...n.extra,installmentAmount:r},n.paymentDetails.paymentOption==="installment"&&(n.paymentDetails.totalAmount=r))}).addCase(_d.rejected,(n,s)=>{n.error=s.payload})}}),{closePaymentModal:ji,setPaymentDetails:Fm,setAccountPayment:$c,setPaymentOption:gN,updatePaymentMethod:Ci,setMethodError:fN,clearMethodErrors:xN}=qy.actions,bN=qy.reducer,Vy=e=>e.accountsReceivablePayment,yN={currentView:"warehouse",selectedWarehouse:null,selectedShelf:null,selectedRowShelf:null,selectedSegment:null,breadcrumbs:[{title:"Warehouse",key:"warehouse",data:null}]},Gy=Ee({name:"warehouse",initialState:yN,reducers:{navigateWarehouse:(e,n)=>{const{view:s,data:o}=n.payload;switch(e.currentView=s,s){case"warehouse":e.breadcrumbs=[{title:o.name,key:"warehouse"}];break;case"shelf":e.breadcrumbs[1]={title:o.name,key:"shelf"},e.breadcrumbs=e.breadcrumbs.slice(0,2);break;case"rowShelf":e.breadcrumbs[2]={title:o.name,key:"rowShelf"},e.breadcrumbs=e.breadcrumbs.slice(0,3);break;case"segment":e.breadcrumbs[3]={title:o.name,key:"segment"},e.breadcrumbs=e.breadcrumbs.slice(0,4);break;default:e.breadcrumbs=[{title:"Warehouse",key:"warehouse"}]}s==="warehouse"&&(e.selectedWarehouse=o,e.selectedShelf=null,e.selectedRowShelf=null,e.selectedSegment=null),s==="shelf"&&(e.selectedShelf=o,e.selectedRowShelf=null,e.selectedSegment=null),s==="rowShelf"&&(e.selectedRowShelf=o,e.selectedSegment=null),s==="segment"&&(e.selectedSegment=o)},back:e=>{const n={segment:"rowShelf",rowShelf:"shelf",shelf:"warehouse"};e.currentView=n[e.currentView]||"warehouse",e.breadcrumbs.pop(),e.currentView==="warehouse"?(e.selectedShelf=null,e.selectedRowShelf=null,e.selectedSegment=null):e.currentView==="shelf"?(e.selectedRowShelf=null,e.selectedSegment=null):e.currentView==="rowShelf"&&(e.selectedSegment=null)},navigateToBreadcrumb:(e,n)=>{const s=n.payload;switch(e.breadcrumbs=e.breadcrumbs.slice(0,s+1),s){case 0:e.selectedShelf=null,e.selectedRowShelf=null,e.selectedSegment=null,e.currentView="warehouse";break;case 1:e.selectedRowShelf=null,e.selectedSegment=null,e.currentView="shelf";break;case 2:e.selectedSegment=null,e.currentView="rowShelf";break;case 3:e.currentView="segment";break;default:e.selectedWarehouse=null,e.selectedShelf=null,e.selectedRowShelf=null,e.selectedSegment=null,e.currentView="warehouse"}}}}),{navigateWarehouse:wi,navigateToBreadcrumb:vN}=Gy.actions,jN=Gy.reducer,li=e=>e.warehouse,Zo={isOpen:!1,formData:{id:"",batchId:"",location:{},productId:"",productName:"",stock:0},loading:!1,error:null},_y=Ee({name:"productStock",initialState:Zo,reducers:{openProductStock:(e,n)=>{e.isOpen=!0,n.payload?e.formData={...Zo.formData,...n.payload}:e.formData=Zo.formData},closeProductStock:e=>{e.isOpen=!1,e.formData=Zo.formData},setProductStockLoading:(e,n)=>{e.loading=n.payload},setProductStockError:(e,n)=>{e.error=n.payload},setProductStockClear:e=>{e.formData=Zo.formData,e.error=null,e.loading=!1},updateProductStockFormData:(e,n)=>{e.formData={...e.formData,...n.payload}}}}),{openProductStock:CN,closeProductStock:wN,setProductStockClear:SN,updateProductStockFormData:er}=_y.actions,IN=_y.reducer,EN=e=>e.productStock,Si={isOpen:!1,formData:{id:"",name:"",shortName:"",description:"",owner:"",location:"",address:"",dimension:{length:0,width:0,height:0},capacity:0},loading:!1,error:null},Hy=Ee({name:"warehouseModal",initialState:Si,reducers:{openWarehouseForm:(e,n)=>{e.isOpen=!0,n.payload?e.formData=n.payload:e.formData=Si.formData},closeWarehouseForm:e=>{e.isOpen=!1,e.formData=Si.formData},setWarehouseLoading:(e,n)=>{e.loading=n.payload},setWarehouseError:(e,n)=>{e.error=n.payload},clearWarehouseForm:e=>{e.formData=Si.formData,e.error=null,e.loading=!1},updateWarehouseFormData:(e,n)=>{e.formData={...e.formData,...n.payload}}}}),{openWarehouseForm:Hd,closeWarehouseForm:Bm,setWarehouseLoading:Lm,setWarehouseError:AN}=Hy.actions,kN=Hy.reducer,TN=e=>e.warehouseModal,Ii={isOpen:!1,formData:{id:"",name:"",shortName:"",description:"",rowCapacity:0},path:[],loading:!1,error:null},Qy=Ee({name:"shelfModal",initialState:Ii,reducers:{openShelfForm:(e,n)=>{e.isOpen=!0;const s=n.payload.data;e.path=n.payload.path||[],s?e.formData=s:e.formData=Ii.formData},closeShelfForm:e=>{e.isOpen=!1,e.formData=Ii.formData,e.path=[]},setShelfLoading:(e,n)=>{e.loading=n.payload},setShelfError:(e,n)=>{e.error=n.payload},clearShelfForm:e=>{e.formData=Ii.formData,e.error=null,e.loading=!1},updateShelfFormData:(e,n)=>{e.formData={...e.formData,...n.payload}}}}),{openShelfForm:zm,closeShelfForm:PN,clearShelfForm:DN,updateShelfFormData:$N}=Qy.actions,RN=Qy.reducer,NN=e=>e.shelfModal,Ei={isOpen:!1,formData:{id:"",name:"",shortName:"",description:"",capacity:0},path:[],loading:!1,error:null},Yy=Ee({name:"rowShelfModal",initialState:Ei,reducers:{openRowShelfForm:(e,n)=>{e.isOpen=!0;const s=n.payload.data;e.path=n.payload.path||[],s?e.formData=s:e.formData=Ei.formData},closeRowShelfForm:e=>{e.isOpen=!1,e.formData=Ei.formData,e.path=[]},setRowShelfLoading:(e,n)=>{e.loading=n.payload},setRowShelfError:(e,n)=>{e.error=n.payload},clearRowShelfForm:e=>{e.formData=Ei.formData,e.error=null,e.loading=!1},updateRowShelfFormData:(e,n)=>{e.formData={...e.formData,...n.payload}}}}),{openRowShelfForm:Um,closeRowShelfForm:ON,clearRowShelfForm:MN,updateRowShelfFormData:FN}=Yy.actions,BN=Yy.reducer,LN=e=>e.rowShelfModal,Ai={isOpen:!1,formData:{id:"",name:"",shortName:"",description:"",rowShelfId:"",capacity:0,createdAt:null,createdBy:"",updatedAt:null,updatedBy:"",deletedAt:null,deletedBy:""},path:[],loading:!1,error:null},Ky=Ee({name:"segmentModal",initialState:Ai,reducers:{openSegmentForm:(e,n)=>{e.isOpen=!0;const s=n.payload.data;e.path=n.payload.path||[],s?e.formData=s:e.formData=Ai.formData},closeSegmentForm:e=>{e.isOpen=!1,e.formData=Ai.formData,e.path=[]},setSegmentLoading:(e,n)=>{e.loading=n.payload},setSegmentError:(e,n)=>{e.error=n.payload},clearSegmentForm:e=>{e.formData=Ai.formData,e.error=null,e.loading=!1},updateSegmentFormData:(e,n)=>{e.formData={...e.formData,...n.payload}}}}),{openSegmentForm:Wm,closeSegmentForm:zN,clearSegmentForm:UN,updateSegmentFormData:WN}=Ky.actions,qN=Ky.reducer,VN=e=>e.segmentModal,qm={inventory:[],product:null,productId:null,filter:"",orderBy:null,orderAscending:!0,isOpen:!1},Jy=Ee({name:"productExpirySelector",initialState:qm,reducers:{setFilter:(e,n)=>{e.filter=n.payload},openProductExpirySelector:(e,n)=>{e.isOpen=!0,e.product=n.payload,e.productId=n.payload.id},setOrderBy:(e,n)=>{e.orderBy===n.payload?e.orderAscending=!e.orderAscending:(e.orderBy=n.payload,e.orderAscending=!0)},setProductExpiryState:(e,n)=>({...e,...n.payload}),updateInventory:(e,n)=>{e.inventory=n.payload},setModalOpen:(e,n)=>{e.isOpen=n.payload},clearProductExpirySelector:e=>qm}}),{clearProductExpirySelector:Xy,setModalOpen:GN}=Jy.actions,_N=Jy.reducer,HN=e=>e.productExpirySelector.inventory,QN=e=>e.productExpirySelector.filter,YN=e=>e.productExpirySelector.orderBy,KN=e=>e.productExpirySelector.orderAscending,JN=e=>e.productExpirySelector.product,XN=e=>e.productExpirySelector.productId,ZN=e=>e.productExpirySelector.isOpen;pu([HN,QN,YN,KN],(e,n,s,o)=>{const r=e.filter(i=>Object.values(i).some(a=>a==null?void 0:a.toString().toLowerCase().includes(n.toLowerCase())));return s?r.sort((i,a)=>i[s]<a[s]?o?-1:1:i[s]>a[s]?o?1:-1:0):r});const eO={activeIngredients:[],activeIngredientModal:{isOpen:!1,initialValues:null}},Zy=Ee({name:"activeIngredients",initialState:eO,reducers:{openModal:(e,n)=>{e.activeIngredientModal.isOpen=!0,e.activeIngredientModal.initialValues=n.payload.initialValues||null},closeModal:e=>{e.activeIngredientModal.isOpen=!1,e.activeIngredientModal.initialValues=null},addIngredient:(e,n)=>{e.activeIngredients.push(n.payload)},removeIngredient:(e,n)=>{e.activeIngredients=e.activeIngredients.filter(s=>s.id!==n.payload)},updateIngredient:(e,n)=>{const s=e.activeIngredients.findIndex(o=>o.id===n.payload.id);s!==-1&&(e.activeIngredients[s]=n.payload)}}}),{openModal:tO,closeModal:Vm}=Zy.actions,nO=Zy.reducer,sO=e=>e.activeIngredients.activeIngredientModal,ul={isOpen:!1,productId:"",productStockSelected:"",product:{},selectedProductStock:null},ev=Ee({name:"productStockSimple",initialState:ul,reducers:{openProductStockSimple:(e,n)=>{e.isOpen=!0,n.payload?(e.productId=n.payload.id,e.product=n.payload):e.productId=ul.productId},closeProductStockSimple:e=>{e.isOpen=!1,e.productId=ul.productId},updateProductId:(e,n)=>{e.productId=n.payload},setSelectedProductStock:(e,n)=>{e.selectedProductStock=n.payload}}}),{openProductStockSimple:tv,closeProductStockSimple:Gm}=ev.actions,oO=ev.reducer,rO=e=>e.productStockSimple,iO={isOpen:!1,productStockId:null,batchId:null,actionType:"productStock"},nv=Ee({name:"deleteProductStock",initialState:iO,reducers:{openDeleteModal:(e,n)=>{e.isOpen=!0,e.productStockId=n.payload.productStockId,e.batchId=n.payload.batchId,e.actionType=n.payload.actionType},closeDeleteModal:e=>{e.isOpen=!1,e.productStockId=null,e.batchId=null},changeActionType:(e,n)=>{e.actionType=n.payload}}}),{openDeleteModal:Qd,closeDeleteModal:aO,changeActionType:cO}=nv.actions,sv=e=>e.deleteProductStock,lO=nv.reducer,dO={selectedInsurance:!1,insuranceData:{recurrence:!1,validity:!1,authNumber:""}},ov=Ee({name:"insurance",initialState:dO,reducers:{setInsuranceStatus:(e,n)=>{e.selectedInsurance=n.payload},toggleInsurance:(e,n)=>{e.selectedInsurance=n.payload??!e.selectedInsurance},updateInsuranceData:(e,n)=>{e.insuranceData={...e.insuranceData,...n.payload}}}}),{updateInsuranceData:ja}=ov.actions,ep=e=>e.insurance.insuranceData,uO=ov.reducer,pO={isOpen:!1,initialValues:null},rv=Ee({name:"insuranceConfigModal",initialState:pO,reducers:{openInsuranceConfigModal:(e,n)=>{e.isOpen=!0,e.initialValues=n.payload},closeInsuranceConfigModal:e=>{e.isOpen=!1,e.initialValues=null}}}),{openInsuranceConfigModal:iv,closeInsuranceConfigModal:_m}=rv.actions,mO=rv.reducer,hO=e=>e.insuranceConfigModal,tp={id:"",invoiceId:"",clientId:"",paymentFrequency:"monthly",totalInstallments:1,installmentAmount:0,paymentDate:ce.now().toMillis(),lastPaymentDate:null,lastPayment:0,totalReceivable:0,currentBalance:0,arBalance:0,isClosed:!1,isActive:!0,createdAt:ce.now().toMillis(),updatedAt:ce.now().toMillis(),createdBy:"",updatedBy:"",comments:"",type:"insurance"},gO={insuranceAR:{...tp},error:null,loading:!1},av=Ee({name:"insuranceAccountsReceivable",initialState:gO,reducers:{setInsuranceAR(e,n){Ly(e.insuranceAR,n.payload)||(e.insuranceAR.updatedAt=ce.now().toMillis()),e.error=null},resetInsuranceAR(e){e.insuranceAR={...tp},e.error=null,e.loading=!1},setError(e,n){e.error=n.payload},setLoading(e,n){e.loading=n.payload}}}),{setInsuranceAR:gs}=av.actions,cv=e=>{var n;return((n=e==null?void 0:e.insuranceAccountsReceivable)==null?void 0:n.insuranceAR)||tp},fO=av.reducer,xO={history:[],maxLength:20,skipKey:null},lv=Ee({name:"navigation",initialState:xO,reducers:{pushHistory:(e,n)=>{const s=n.payload,o=e.history[e.history.length-1];(!o||s.key!==o.key||s.pathname!==o.pathname)&&(e.history.push(s),e.history.length>e.maxLength&&(e.history=e.history.slice(e.history.length-e.maxLength)))},setNavigationOptions:(e,n)=>{n.payload.maxLength!==void 0&&(e.maxLength=n.payload.maxLength),n.payload.skipKey!==void 0&&(e.skipKey=n.payload.skipKey)}}}),{pushHistory:bO}=lv.actions,yO=e=>n=>{const s=n.navigation.history;if(s.length<2)return null;for(let o=s.length-2;o>=0;o--){const r=s[o];if(!r.pathname.startsWith(e))return r}return null},vO=lv.reducer,dv=cC({reducer:{app:P$,nav:A$,loader:$$,alert:O2,navigation:vO,user:WS,business:rI,abilities:SP,usersManagement:dR,modal:UP,theme:x$,setting:QS,notification:j$,notificationCenter:I$,userNotification:aR,imageViewer:M$,uploadImg:h$,note:kE,search:UD,category:b2,addProduct:JD,updateProduct:G2,filterProducts:S2,customProduct:_D,customPizza:q$,productOutflow:J$,activeIngredients:nO,cart:FD,clientCart:hD,addOrder:c$,cashCountManagement:rR,cashCountState:mR,accountsReceivable:cN,accountsReceivablePayment:bN,insuranceAccountsReceivable:fO,...OR,...QR,invoiceForm:vR,invoices:ZR,invoicePreview:oN,taxReceipt:ZS,warehouse:jN,warehouseModal:kN,shelfModal:RN,rowShelfModal:BN,segmentModal:qN,productStock:IN,productExpirySelector:_N,productStockSimple:oO,deleteProductStock:lO,barcodePrintModal:YR,productWeightEntryModalSlice:wR,files:NE,insurance:uO,insuranceConfigModal:mO,insuranceAuth:dD},middleware:e=>e().prepend(Yu.middleware),devTools:!1}),jO=({item:e={},isFavorite:n=!1,searchTerm:s="",color:o="#f2f2f2",selected:r=!1,onClick:i=()=>{},toggleFavorite:a})=>{const[c,d]=m.useState(!1),[u,p]=m.useState(!1),h=()=>d(!0),f=()=>d(!1),x=g=>s?g.split(new RegExp(`(${s})`,"gi")).map((b,v)=>b.toLowerCase()===s.toLowerCase()?t.jsx("mark",{children:b},v):b):g;return t.jsxs(CO,{selected:r,onMouseEnter:h,color:o,onMouseLeave:f,onClick:()=>i(e),children:[t.jsx(wO,{children:x(e==null?void 0:e.name)}),a&&t.jsx(SO,{onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),onClick:g=>{g.stopPropagation(),a(e)},children:t.jsx(O,{icon:n||u?lw:dw})})]})},CO=l.div`
    display: grid;
    grid-template-columns: 1fr min-content min-content;
    justify-content: space-between;
    padding: 0em 0.4em;
    border-radius: 0.4em;
    cursor: pointer;
    border: 2px solid transparent;
    background-color: ${({color:e})=>e};  // Usamos el color dinámico
    :hover {
        background-color: ${({color:e})=>e};  // Mantén el hover del mismo color
    }
    ${e=>e.selected&&`
        border: 2px solid var(--color1);
        background-color: var(--color2);
    `}
    
`;l.span`
    height: 1.2em;
    width: 1.2em;
    display: flex;
    align-items: center;
`;const wO=l.span`
    padding: 0.4em 0.4em;
    height: 100%;
`,SO=l.span`
    /* estilos para la estrella favorita */
    height: 100%;
    display: flex;
    align-items: center;
    margin-left: 10px;
    cursor: pointer;
    svg{
        color: #ffd900;
        font-size: 1.2em;
    }
`,{Input:IO,Typography:pl,Button:Hm}=Ne,EO=m.forwardRef(({setOpen:e,sectionsConfig:n={},deleteAllItems:s=()=>{}},o)=>{const[r,i]=m.useState(""),a=c=>$n(c,r);return t.jsx(AO,{ref:o,children:t.jsxs(kO,{children:[t.jsxs(RO,{children:[t.jsx(IO,{placeholder:"Buscar Categoría",value:r,allowClear:!0,style:{maxWidth:"300px"},addonBefore:z.operationModes.search,onChange:c=>i(c.target.value)}),t.jsx(Hm,{onClick:()=>e(!1),icon:z.operationModes.cancel,type:"text",size:"small"})]}),t.jsxs($O,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"0.4em 0.4em "},children:[t.jsx(Hm,{onClick:s,children:"Deselecionar todo"}),t.jsxs(pl.Text,{type:"secondary",children:[Object.values(n).reduce((c,d)=>c+d.items.length,0)," categorías"]})]}),t.jsxs(PO,{children:[Object.keys(n).map(c=>{const{title:d,items:u,onSelect:p,onToggleFavorite:h,color:f}=n[c],x=a(u);return x.length>0&&t.jsxs(DO,{children:[t.jsx(pl.Title,{level:5,children:d}),t.jsx(TO,{children:x.sort((g,y)=>{const b=g.name||"",v=y.name||"";return b.localeCompare(v)}).map(g=>t.jsx(jO,{item:g,selected:g.selected,isFavorite:g.isFavorite,color:f,toggleFavorite:h?()=>h(g):void 0,onClick:()=>p(g)},g.id))})]},c)}),Object.keys(n).every(c=>a(n[c].items).length===0)&&t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsx(pl.Text,{type:"secondary",style:{padding:"1em"},children:"No se encontraron resultados, intenta con otra búsqueda o agrega una nueva categoría"})})]})]})]})})}),AO=l.div`
 
    position: absolute;
    top: 100%;
    left: 0;
    border-radius: 10px;
    border: 1px solid #ccc;
    z-index: 1000;
    overflow: hidden;
    width: 100%;
    background-color: white;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    `,kO=l.div`
    display: grid;
    grid-template-rows: min-content 1fr;
    
    top: 100%;
    left: 0;
    height: calc(100vh - 9em);
`,TO=l.div`
    /* estilos para las categorías */
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 0.4em;
`,PO=l.div`
    /* estilos para el contenedor de las categorías */
    display: grid;
    gap: 2em;
    padding: 0 0.4em;
    align-content: start;
    overflow-y: auto;
    height: calc(100vh - 9em);
`,DO=l.div`
    /* estilos para las categorías */
    display: grid;
    gap: 0.4em;
    padding: 0 0.4em;
    
`,$O=l.div`
    /* estilos para el cuerpo del menú desplegable */
   
    display: grid;
    align-content: start;

    overflow-y: auto;
    gap: 0.6em;
    padding-bottom: 1em;
`,RO=l.div`
    /* estilos para el header */
    padding: 0.4em ;
    display: grid;
    grid-template-columns: 1fr min-content;

    align-items: center;
    font-weight: bold;
    border-bottom: 1px solid #ccc;
`,NO=e=>{const{width:n}=H2(e);return{toStart:()=>{e.current&&e.current.scrollLeft>0&&e.current.scrollTo({top:0,left:0,behavior:"smooth"})},toEnd:()=>{e.current&&e.current.scrollLeft<e.current.scrollWidth-e.current.clientWidth&&e.current.scrollTo({top:0,left:e.current.scrollWidth,behavior:"smooth"})},toRight:()=>{const a=n/3;e.current&&e.current.scrollBy({top:0,left:a,behavior:"smooth"})},toLeft:()=>{const a=n/3;e.current&&e.current.scrollBy({top:0,left:-a,behavior:"smooth"})}}},Qm={category:"#fff7c9",activeIngredient:"rgb(211, 255, 210)",default:"#F0F0F0"},OO=m.forwardRef(({open:e,setOpen:n,items:s=[]},o)=>{const r=m.useRef(null),{toEnd:i,toLeft:a,toRight:c,toStart:d}=NO(r);return(s==null?void 0:s.length)===0?t.jsx(Ym,{children:t.jsx(U,{icon:z.editingActions.create,onClick:()=>n(!e),children:"Seleccionar categoría"})}):t.jsxs(Ym,{children:[t.jsx(U,{icon:z.editingActions.create,onClick:()=>n(!e)}),t.jsx(U,{icon:z.arrows.chevronLeft,onClick:a,onDoubleClick:d}),t.jsx(FO,{ref:r,children:(s==null?void 0:s.length)===0?t.jsx(t.Fragment,{children:"No elementos"}):s.map(u=>t.jsx(MO,{item:u},u.id))}),t.jsx(U,{onClick:c,onDoubleClick:i,icon:z.arrows.chevronRight})]})}),Ym=l.div`
  height: 2.6em;
  align-items: center;
  padding: 0.2em 0.4em;
  width: 100%;
  gap: 0.4em;
  display: grid;
  grid-template-columns: min-content min-content 1fr min-content;
  background-color: #ffffff;

`,MO=({item:e})=>{const n=W(),s=()=>{n(m2(e))};return t.jsxs(BO,{type:e.type,children:[e.name,t.jsx(LO,{onClick:s,children:z.editingActions.cancel})]})},FO=l.div`
  /* estilos para la lista de categorías */ 
  display: flex;
  gap: 0.4em;
  align-items: center;
  height: 100%;
  overflow-x: auto;
  border-radius: 0.4em;
  white-space: nowrap;
  ::-webkit-scrollbar {
    display: none;
  }
`,BO=l.div`
    /* estilos para cada categoría */
    padding: 0 0.6em ;
    height: 2.2em;
    display: flex;
    gap: 1em;
    white-space: nowrap;
    align-items: center;
    background-color: ${({type:e})=>Qm[e]||Qm.default};
    border-radius: 0.4em;
    justify-content: space-between;
`,LO=l.span`
  /* estilos para el icono de eliminar */
  cursor: pointer;
  color: var(--Black5);
  font-size: 1em;
  height: 1.2em;
  width: 1.2em;
  display: flex;
  align-items: center;
  justify-content: center;
  :hover{
    color: var(--Black5);
    background-color: var(--White5);
    border-radius: 0.4em;
  }

`,zO=(e=[],n=[])=>e.filter(s=>n.includes(s.category.id)),UO=(e,n)=>{const{businessID:s,uid:o}=e;if(!s||!o)return console.error("No se han proporcionado los datos necesarios para establecer el listener"),null;const r=F($,"businesses",s,"users",o,"productCategories","favorite");return Te(r,a=>{if(a.exists()){const c=a.data().favoriteCategories;n(c)}else n([])},a=>{console.error("Error al escuchar las categorías favoritas: ",a)})},WO=()=>{const e=D(q),[n,s]=m.useState([]);return m.useEffect(()=>{let o=null;return e&&e.businessID&&e.uid&&(o=UO(e,s)),()=>{typeof o=="function"&&o()}},[e]),{favoriteCategories:n}},uv=()=>{const[e,n]=m.useState([]),[s,o]=m.useState(!1),[r,i]=m.useState(null),a=D(q);return m.useEffect(()=>{let c;return(async()=>{try{if(!a)return;o(!0),c=await qO(a,n),o(!1)}catch(u){i(u)}})(),()=>{c&&c()}},[a]),{data:e,loading:s,error:r}},qO=async(e,n)=>{const s=le($,`businesses/${e.businessID}/activeIngredients`);return Te(s,r=>{const i=r.docs.map(a=>a.data());n(i)})},VO=async(e,n)=>{try{const s={...n,id:be(),createdAt:ue.now(),updatedAt:ue.now()},o=F($,`businesses/${e.businessID}/activeIngredients/${s.id}`);await De(o,s),console.log("Ingrediente activo añadido con éxito:",s.id)}catch(s){console.error("Error al agregar el ingrediente activo:",s)}},GO=async(e,n)=>{try{const s=F($,`businesses/${e.businessID}/activeIngredients/${n.id}`);await je(s,{...n,updatedAt:ue.now()}),console.log("Ingrediente activo actualizado:",n.id)}catch(s){console.error("Error al actualizar el ingrediente activo:",s)}},_O=async(e,n)=>{const{businessID:s,uid:o}=e,r=n==null?void 0:n.id;if(!s||!o||!r)return;const i=F($,"businesses",s,"users",o,"productCategories","favorite");try{const a=await Se(i);a.exists()?(a.data().favoriteCategories||[]).includes(r)?await je(i,{favoriteCategories:Rx(r),updatedAt:de()}):await je(i,{favoriteCategories:Vr(r),updatedAt:de()}):await De(i,{favoriteCategories:[r],createdAt:de(),updatedAt:de()})}catch(a){console.error("Error al alternar categoría favorita: ",a)}},HO=({})=>{const e=W(),n=D(q),{categories:s}=Wu(),o=WO(),r=D(Nu),i=zO(s,o.favoriteCategories),{data:a}=uv(),{items:c}=D(h2),d=async S=>{await _O(n,S)},[u,p]=m.useState(!1),h=m.useRef(null);kt(h,u==!0,()=>p(!1));function f(S){return S.map(E=>{const{name:T,id:R}=E.category;return{id:R,name:T,isFavorite:!1,selected:!1}})}function x(S,E){return S.map(T=>{const R=E.some(N=>N.id===T.id);return{...T,isFavorite:R}})}function g(S,E){const T=f(S),R=f(E),N=x(T,R),G=[],Q=[];return N.forEach(ae=>{ae.isFavorite?G.push(ae):Q.push(ae)}),{favorites:G,normals:Q}}function y(S,E){return S.map(T=>{const R=E.some(N=>N.id===T.id);return{...T,selected:R}})}const{favorites:b,normals:v}=g(s,i),C=y(b,r),I=y(v,r),j=y(a,r),k=()=>e(p2()),A=S=>e(mm({...S,type:"category"})),P=S=>e(mm({...S,type:"activeIngredient"})),w={favoriteCategories:{title:"Categorías Favoritas",items:C,color:"#fff7c9",onSelect:A,onToggleFavorite:d},categories:{title:"Categorías",items:I,color:"#fff7c9",onSelect:A,onToggleFavorite:d},activeIngredients:{title:"Principio Activo",color:"#d3ffd2",items:j,onSelect:S=>P(S)}};return t.jsxs(QO,{ref:h,children:[t.jsx(OO,{open:u,setOpen:p,items:c}),u&&t.jsx(EO,{ref:h,setOpen:p,sectionsConfig:w,deleteAllItems:k})]})},QO=l.div`
    position: relative;
  /* estilos para el contenedor principal */
`,pv=()=>t.jsx(HO,{}),{Button:YO,Dropdown:KO}=Ne,JO=({products:e,searchTerm:n})=>{const s=W(),o=D(q),r=D(os),{setDialogConfirm:i}=Ds(),a=m.useCallback(p=>{var f,x;let h=(f=p==null?void 0:p.product)!=null&&f.id?(x=p==null?void 0:p.product)==null?void 0:x.id:p==null?void 0:p.id;i({title:"Eliminar producto",isOpen:!0,type:"error",message:"¿Está seguro que desea eliminar este producto?",onConfirm:async()=>{const g=q(dv.getState());await $b(g,h)}})},[o]),c=p=>{s(fb()),s(kr({product:p,status:_e.UPDATE.label}))},d=[{Header:"Nombre",accessor:"name",reorderable:!1,minWidth:"300px",maxWidth:"1fr",sortable:!0,sortableValue:p=>p.name,cell:({value:p})=>t.jsxs(XO,{children:[t.jsx(nD,{img:p.img}),t.jsx("span",{children:p.name})]})},{Header:"Stock",accessor:"stock",align:"right",sortable:!0,sortableValue:p=>p.stock,minWidth:"80px",maxWidth:"140px",cell:({value:p})=>t.jsx(_2,{stock:mt(p.stock),trackInventory:p.trackInventory})},{Header:"Costo",align:"right",sortable:!0,accessor:"cost",minWidth:"120px",maxWidth:"0.4fr",cell:({value:p})=>t.jsx("div",{children:Y(p)})},{Header:"Impuesto",sortable:!0,align:"right",minWidth:"120px",maxWidth:"0.4fr",accessor:"tax",cell:({value:p})=>t.jsx("div",{children:Y(p)})},{Header:"Precio",sortable:!0,accessor:"price",minWidth:"120px",maxWidth:"0.4fr",align:"right",cell:({value:p})=>{var g,y;const h=tt(p,r),f=(g=p==null?void 0:p.weightDetail)==null?void 0:g.weightUnit;return((y=p==null?void 0:p.weightDetail)==null?void 0:y.isSoldByWeight)?t.jsxs("div",{children:[Y(h)," / ",f]}):Y(h)}},{Header:"Facturable",accessor:"isVisible",minWidth:"100px",maxWidth:"100px",align:"center",cell:({value:p})=>t.jsx("div",{children:p===!1&&z.operationModes.hide})},{Header:"Acción",accessor:"action",reorderable:!1,minWidth:"100px",maxWidth:"100px",align:"right",clickable:!1,cell:({value:p})=>{const h={items:[{label:"Editar",key:1,icon:t.jsx(es,{}),onClick:()=>c(p)},{label:"Imprimir Barcode",key:2,icon:t.jsx(Yw,{}),onClick:()=>s(Gd(p))},{label:"Eliminar",key:3,icon:t.jsx(ht,{}),danger:!0,onClick:()=>a(p)}]};return t.jsx($t,{children:t.jsx(KO,{menu:h,children:t.jsx(YO,{icon:t.jsx(lc,{})})})})}}],u=e.map(p=>{var h;return{id:p.id,image:p.image,name:{name:p.name,img:p.image},stock:{stock:p.stock,trackInventory:p.trackInventory},trackInventory:p.trackInventory,cost:(h=p==null?void 0:p.pricing)==null?void 0:h.cost,price:p,tax:Xn(p),isVisible:p==null?void 0:p.isVisible,action:p,category:p.category}});return t.jsx(rn,{data:u,columns:d,searchTerm:n,headerComponent:t.jsx(pv,{}),tableName:"inventory_items_table",elementName:"productos",onRowClick:p=>c(p.action),groupBy:"category"})},XO=l.div`
  display: flex;
  align-items: center;
  height: 100%;                     
  gap: 1.2em;
`;l.div`
  position: absolute;
  left: 10px;

`;l.div`
  position: relative;
  margin: 0 auto;
 
  background-color: white;
  overflow-y: auto;
  
  height: 100%;
  width: 100%;
  display: grid;
  grid-template-rows: min-content min-content 1fr min-content; /* nuevo estilo */
`;l.div`
position: sticky;
top: 0;
z-index: 2;

`;l.div`
  display: grid;
  align-items: flex-start;
  align-content: flex-start;
  height: 100%;
  gap: 0.4em;
  width: 100%;
  color: rgb(70, 70, 70);
`;l.div`
  display: grid;
  align-items: center;
  height: 3em;
  width: 100%;
  gap: 1vw;
  grid-template-columns: 
  minmax(80px, 0.1fr) //Image
  minmax(200px, 1fr) //Name
  minmax(70px, 0.4fr) //cost
  minmax(70px, 0.4fr) //stock
  minmax(70px, 0.5fr) //precio
  minmax(70px, 0.5fr) //precio
  minmax(100px, 0.1fr); //acción
  @media (max-width: 800px){
    gap: 0;
  }
 
  ${e=>{switch(e.type){case"header":return`    
          background-color: var(--White);
          border-top: var(--border-primary);
          border-bottom: var(--border-primary);
          
          position: sticky;
          top: 2.60em;
          z-index: 1;
        `}}}
`;l.div`
  padding: 0 0.6em;
  height: 100%;
  width: 100%;
  display: flex;
  align-items: center;
  overflow: hidden;
  ${e=>{switch(e.position){case"right":return`
          justify-content: right;
        `}}}
  ${e=>{switch(e.size){case"limit":return`
          width: 100%;
          
          display: -webkit-box;
          -webkit-line-clamp: 1;
          -webkit-box-orient: vertical;  
          //white-space: nowrap;
          text-overflow: ellipsis;
          overflow: hidden;
          `}}}
`;l.div`
  display: flex;
  justify-content: center;
  align-items: center;
 border-top: var(--border-primary);
  height: 3em;
  position: sticky;
  background-color: white;
  bottom: 0;
  z-index: 1;
`;const Km=()=>{W();const[e,n]=m.useState(""),{products:s}=Rs();return t.jsxs(ZO,{children:[t.jsx(Ze,{displayName:"Productos",searchData:e,setSearchData:n}),t.jsx(JO,{products:s,searchTerm:e})]})},ZO=l.div`
   display: grid;
    position: relative;
    grid-template-columns: auto;
    background-color: var(--White);
    grid-template-rows:  min-content 1fr;

    height: calc(100vh );
   overflow: hidden;
`,eM=({isOpen:e,item:n,MenuItemsLink:s,showSubMenu:o})=>{const i=(n.submenu||[]).reduce((a,c)=>((a[c.group]=a[c.group]||[]).push(c),a),{});return t.jsxs(nM,{isOpen:e,children:[t.jsxs(sM,{children:[t.jsx(ke,{startIcon:t.jsx(O,{icon:tc}),title:"atrás",variant:"contained",onClick:o}),t.jsx("span",{children:n.title})]}),t.jsx(tM,{children:e?Object.keys(i).map(a=>t.jsx(Sv,{children:t.jsx(Iv,{children:i[a].map((c,d)=>t.jsx(mv,{item:c},d))})},a)):null})]})};l.h3`
    /* Estilos para el título del grupo */
`;const tM=l.div`
    /* position: relative; */
    background-color: var(--color2);
    padding: 0.8em;
    display: grid;
    align-content: start;
    gap: 0.6em;
`,nM=l.div`
    
    background-color: rgb(255, 255, 255);
    width: 100%;

    display: grid;
    grid-template-rows: min-content 1fr;
  
    position: absolute;
    z-index: 1;
    top: 2.75em;
    left: 0;
    max-width: 500px;
    height: calc(100% - 2.75em);
    transform: translateX(-100%);
    transition: 200ms transform ease-in-out;
    color: rgb(80, 80, 80);
    ${e=>{switch(e.isOpen){case!0:return`
                transform: translateX(0px);
                z-index: 9999;
                `}}}
`,sM=l.div`
    display: grid;
    grid-template-columns: 1fr 1fr;
      justify-content: space-between;
      align-items: center;
      padding: 0 1.5em;
      height: 3.8em;   
      margin: 0;
      span {
         font-size: 16px;
         line-height: 18px;
         font-weight: 500;
         text-align: center;
         text-align: end;
      }
      button {
         color: rgb(66, 165, 245);
         justify-self: flex-start;
      }
`,mv=({item:e,Items:n})=>{var p;const[s,o]=m.useState(!1),r=_t(),i=vt({path:(e==null?void 0:e.route)||"",end:!0}),a=h=>{const f=r.pathname;return f===h||f.startsWith(h+"/")},c=(p=e==null?void 0:e.submenu)==null?void 0:p.some(h=>a(h.route));m.useEffect(()=>{c&&o(!0)},[c]);const d=()=>{o(!s)},u=e!=null&&e.route?Jm:oM;return t.jsxs(m.Fragment,{children:[t.jsxs(u,{onClick:e.submenu?d:null,to:(e==null?void 0:e.route)||"#",className:i?"active":"",children:[t.jsxs(rM,{children:[t.jsx(iM,{color:e.color,children:e.icon}),t.jsx("span",{children:e.title})]}),e.tag&&t.jsx(Ge,{color:e.tag.color,style:{fontSize:16},children:e.tag.text}),e.submenu&&s?e.submenuIconOpen:e.submenu?e.submenuIconClose:null]}),s&&t.jsx(eM,{showSubMenu:d,isOpen:s,item:e,MenuItemsLink:Jm})]})},hv=qe`
  display: flex;
  justify-content: space-between;
  padding: 0 0.8em;
  height: 2.8em;
  align-items: center;
  font-weight: 450;
  color: var(--Gray6);
  margin: 0em;
  border-bottom: var(--border-primary);
  :last-child{
    border-bottom: none;
  }
  :hover{
    color: ${e=>e.theme.bg.color};
    transition: background-color 400ms ease;
    svg{
      color: ${e=>e.theme.bg.color};
    }
  }
  svg{
    color: var(--Gray6);
  }
`,Jm=l(nC).attrs({end:!0})`
  ${hv}

  &.active {
    color: white;
    font-weight: 600;
    background-color: ${e=>e.theme.bg.color};
    border-radius: 0.4em;

    svg {
      color: white;
    }
  }
`,oM=l.div`
  ${hv}
`,rM=l.div`
  display: flex;
  gap: 1rem;
  align-items: center;
  overflow: hidden;
  max-width: 80%;
  
  span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,iM=l.div`
  width: 1.2em;
  display: flex;
  align-items: center;
  justify-content: center;
  `,{Tag:aM}=Ne,cM=()=>{const e=W(),n=Fe(),{onClose:s,setDialogConfirm:o}=Ds(),r=D(ft),i=D(q),a=()=>{e(Kn()),lb(),n("/",{replace:!0})},c=()=>{o({title:"Cerrar sesión",isOpen:!0,type:"warning",message:"¿Está seguro que desea cerrar sesión?",onConfirm:()=>{a(),s()}})},d=u=>u!=null&&u.displayName&&u.displayName.trim()!==""?u.displayName:u==null?void 0:u.username;return t.jsxs(lM,{children:[t.jsxs(uM,{children:[t.jsxs(mM,{children:[t.jsx(dM,{children:t.jsx(O,{icon:Ea})}),t.jsx(pM,{children:t.jsxs("span",{children:[d(i)," "]})})]}),t.jsx(gM,{children:t.jsx(ke,{startIcon:z.operationModes.logout,color:"gray-contained",title:"Salir",size:"medium",borderRadius:"normal",onClick:c})})]}),t.jsx(hM,{color:"blue",children:i===null?null:t.jsxs("span",{children:[r==null?void 0:r.name," "]})})]})},lM=l.div`

  display: grid;
  gap: 0.6em;
    padding: 0.8em 1em;
    overflow: hidden;
  
`,dM=l.div`
  background-color: var(--color2);
  max-height: 2em; 
  max-width: 2em;
  height: 2em; 
  width: 2em;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--border-radius-light);
  color: #555555;

`,uM=l.div`
 display: flex;
 gap: 0.4em;
 justify-content: space-between;
`,pM=l.div`
  font-weight: 600;
  color: #636262;
  text-transform: capitalize;
`,mM=l.div` 
  display: flex;
  align-items: center;
  gap: 0.5em;

`,hM=l(aM)`  
white-space: nowrap;
width: 100%;
overflow: hidden;
text-overflow: ellipsis;
font-size: 14px;
padding: 0.4em 0.8em;
border-radius: var(--border-radius);
  
  span {
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,gM=l.div`
  display: flex;
  align-items: center;
  gap: 1em;
  
  justify-content: center;
`,{HOME:fM}=re.BASIC_TERM,xM=[{title:"Inicio",icon:z.menu.unSelected.home,route:fM,group:"basic"}],bM=async(e,n)=>{if(!e||!(e!=null&&e.businessID))return;const{businessID:s}=e,o=F($,"businesses",s,"categories",n);try{await Ot(o)}catch(r){console.error(r)}},yM=async(e,n)=>{if(!n||!(n!=null&&n.businessID))return console.log("no tienes permisos para realizar esta acción");const{businessID:s}=n,o=F($,"businesses",String(s),"categories",e.id);try{je(o,{category:e}),console.log("listo, todo bien")}catch{console.log("todo mal")}},vM=async(e,n)=>{if(!e||!(e!=null&&e.businessID))throw new Error("no se encontró el id del negocio");if(!n)throw new Error("no se encontró el id de la categoría");const s=F($,"businesses",e.businessID,"expensesCategories",n);try{await Ot(s)}catch(o){throw console.log(o),new Error(o)}},jM=async(e,n)=>{if(console.log(n),!e||!e.businessID)return!1;try{n={...n,createdAt:ue.fromMillis(n.createdAt)};const s=F($,"businesses",e.businessID,"expensesCategories",n.id);return await je(s,{category:n}),console.log("Category update successfully"),!0}catch(s){return console.error("Error updating category: ",s),!1}},CM=({cat:e,Row:n,Col:s})=>{W();const o=D(q),[r,i]=m.useState(null),[a,c]=m.useState({...e}),[d,u]=m.useState(!1),p=m.useRef(null),h=m.useRef(null),f=()=>{u(!1),i(null)};m.useEffect(()=>{c({...e})},[e]);const x=()=>{i("EDIT"),u(!0),p.current.focus(),p.current.select()},g=v=>{i("DELETE"),u(!0)},y=()=>{switch(r){case"DELETE":vM(o,e.id);break;case"EDIT":jM(o,a);break}i(null),u(!1)},b=()=>{c({name:e.name,id:e.id}),i(null),u(!1)};return kt(h,d,f),t.jsxs(n,{ref:h,children:[t.jsx(wM,{ref:p,type:"text",value:a.name,onChange:v=>c({...a,name:v.target.value}),readOnly:!d}),t.jsx(s,{children:d?t.jsxs($t,{children:[t.jsx(ke,{borderRadius:"normal",title:z.operationModes.cancel,width:"icon32",color:"gray-dark",onClick:b,tooltipDescription:"Cancelar",tooltipPlacement:"top"}),t.jsx(ke,{borderRadius:"normal",title:z.operationModes.accept,width:"icon32",color:"gray-dark",onClick:y})]}):t.jsxs($t,{children:[t.jsx(ke,{borderRadius:"normal",title:z.operationModes.edit,width:"icon32",color:"gray-dark",onClick:x}),t.jsx(ke,{borderRadius:"normal",title:z.operationModes.delete,width:"icon32",color:"gray-dark",onClick:()=>g(e.id)})]})})]})};l.div`
`;const wM=l.input`
margin-left: 1em;
border: none;
height: 2em;

:focus{
  outline: 2px solid rgba(0, 0, 0, 0.200);
}
${e=>{switch(e.readOnly){case!0:return`
        background-color: #ffffff;
        :focus{
          user-select: none;
          outline: none;
          pointer-events: none;
        }
        ::selection{
          background-color: transparent;
          color: inherit;
        }
        
        `}}}
  
    `,gv=()=>{const e=D(q),[n,s]=m.useState([]);return m.useEffect(()=>{if(!e||!(e!=null&&e.businessID))return;const o=le($,"businesses",e.businessID,"expensesCategories");(async()=>{const i=Te(o,a=>{const c=a.docs.map(d=>{const u=d.data();return console.log(u),{category:{...u.category,createdAt:(u==null?void 0:u.category.createdAt.seconds)*1e3}}});s(c)});return()=>i()})()},[e]),{categories:n}},SM=({searchTerm:e})=>{const{categories:n}=gv(),s=$n(n,e);return t.jsx(IM,{children:t.jsxs(EM,{children:[t.jsx(TM,{children:t.jsx("h3",{children:"Categoría de Gastos"})}),t.jsx(AM,{children:t.jsx(kM,{children:s.length>0?s.map(({category:o},r)=>t.jsx(CM,{Row:PM,Col:DM,cat:o},r)):null})})]})})},IM=l.div`
    width: 100%;
    padding: 0 1em;
    display: flex;
    justify-content: center;
    overflow: hidden;
     padding: 1em;
`,EM=l.header`
    justify-self: center;
    border: 1px solid rgba(0, 0, 0, 0.100);
    border-radius: 10px;
    position: relative;
    overflow: hidden;
    //max-height: 400px;
    width: 100%;
    max-width: 1000px;
    
    display: grid;
    grid-template-rows: min-content 1fr; 
    background-color: #ffffff;
    @media (max-width: 800px){
      max-height: 100%;
      
  }
`,AM=l.div`
  position: relative;
  width: 100%;
  overflow: hidden;
  display: grid;
  grid-template-rows: min-content 1fr; 
  
  `,kM=l.div`

  display: grid;
  align-content: start;
  grid-template-columns:  repeat(auto-fill, minmax(250px, 1fr));
  overflow-y: auto;
  color: var(--Gray10);
  font-size: 15px;

`,TM=l.div`
  display: grid;
  align-items: center;
  justify-content: center;
  background: #3f3f3f;
  height: 2em;
  h3{
    margin: 0;
    color: white;
    font-weight: 500;
  }
  text-align: center;
`,PM=l.div`
  display: grid;
  align-items: center;
  height: 3em;
  gap: 0.6em;
  grid-template-columns: 
  minmax(100px, 1fr) //Nombre
  minmax(100px, min-content); // accion
  border-right: 1px solid rgba(16, 16, 16, 0.200);
  border-bottom: 1px solid rgba(16, 16, 16, 0.200);


  @media (max-width: 800px){
    gap: 0;
  }
  ${e=>{switch(e.container){case"first":return`
        @media (max-width: 800px){
        display: grid;
        grid-template-columns: min-content 1fr;
        span{
          display: block;
          transform: rotate(90deg);
          width: 
        }
      }
      
      `}}}
    ${e=>{switch(e.border){case"border-bottom":return`
              border-bottom: 1px solid rgba(0, 0, 0, 0.200);
              &:last-child{
                border-bottom: none;
              }
              `}}}
  ${e=>{switch(e.color){case"header":return`
        background-color: #9c0e0e;
        `;case"item":return`
        background-color: #ebebeb;
        `}}}
  ${e=>{switch(e.fill){case"fill":return`
          padding-right: 16px;
          height: 2em;
          background-color: var(--White1);
        `}}}
`,DM=l.div`
  padding: 0 0.6em;
  ${e=>{switch(e.position){case"right":return`
          text-align: right;
        `}}}
  ${e=>{switch(e.size){case"limit":return`
          width: 100%;
          
          display: -webkit-box;
          -webkit-line-clamp: 1;
          -webkit-box-orient: vertical;  
          //white-space: nowrap;
          text-overflow: ellipsis;
          overflow: hidden;
          `}}}
`,$M=()=>{const[e,n]=m.useState("");return t.jsxs(m.Fragment,{children:[t.jsx(Ze,{sectionName:"Cat. Gastos",searchData:e,setSearchData:n}),t.jsx(RM,{children:t.jsx(SM,{searchTerm:e})})]})},RM=l.div`
    width: 100vw;
    height: calc(100vh - 2.75em);
    background-color: var(--color2);
    display: grid;
    grid-template-rows: 1fr;
    overflow: hidden;
   
    
`,NM=l.div`
  max-height: 300px;
  overflow-y: auto;
`,OM=l.div`
  display: flex;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #f0f0f0;
  
  &:hover {
    background-color: #f5f5f5;
  }
`,MM=l.div`
  flex: 1;
  margin-left: 10px;
`;l.span`
  color: #888;
  font-size: 12px;
  margin-left: 10px;
`;const FM=l.button`
  background: none;
  border: none;
  color: #ff4d4f;
  cursor: pointer;
  padding: 5px;
  
  &:hover {
    color: #cf1322;
  }
`,Xm=l(Ge)`
  margin-left: 8px;
  font-size: 11px;
`,BM=l.div`
  margin-bottom: 16px;
`,LM=l.button`
  background: none;
  border: none;
  color: #1890ff;
  cursor: pointer;
  padding: 5px;
  margin-right: 8px;
  
  &:hover {
    color: #40a9ff;
  }
`,zM=l.h4`
  margin: 12px 0;
  color: #666;
  font-weight: 500;
`,UM=l.span`
  margin-right: 8px;
  font-size: 16px;
  display: flex;
  align-items: center;
`,fv=({files:e=[],removeFile:n,handlePreview:s})=>{const o=d=>({receipts:"green",invoices:"blue",others:"orange"})[d==null?void 0:d.toLowerCase()]||"default",r=d=>{const u=d.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif"].includes(u)},i=d=>d.split(".").pop().toLowerCase()==="pdf",a=m.useMemo(()=>{const d={receipts:{title:"Recibos",files:[]},invoices:{title:"Facturas",files:[]},others:{title:"Otros Documentos",files:[]}};return e==null||e.forEach(u=>{var f;const p=((f=u.type)==null?void 0:f.toLowerCase())||"others";(d[p]||d.others).files.push(u)}),Object.entries(d).filter(([u,p])=>p.files.length>0)},[e]),c=d=>t.jsxs(OM,{children:[t.jsx(UM,{children:r(d.name)?t.jsx(ts,{style:{color:"#52c41a"}}):i(d.name)?t.jsx(ns,{style:{color:"#ff4d4f"}}):t.jsx(no,{})}),t.jsxs(MM,{children:[t.jsx(Oe,{title:d.name,children:d.name}),t.jsx(Xm,{color:o(d.type),children:d.type}),t.jsx(Xm,{color:d.url?"purple":"blue",children:d.url?"Remoto":"Local"})]}),t.jsxs("div",{children:[(r(d.name)||i(d.name))&&t.jsx(LM,{onClick:()=>s(d),children:t.jsx(zo,{})}),n&&t.jsx(FM,{onClick:()=>n(d.id||d.url),children:t.jsx(ht,{})})]})]},d.id||d.url);return e!=null&&e.length?t.jsx(NM,{children:a.map(([d,u])=>t.jsxs(BM,{children:[t.jsx(zM,{children:u.title}),u.files.map(c)]},d))}):t.jsx(Lt,{description:"No hay archivos adjuntos"})};fv.defaultProps={files:[],removeFile:()=>{},handlePreview:()=>{}};const WM=sn`
  from { opacity: 0; }
  to { opacity: 1; }
`,qM=sn`
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
`,VM=l.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  visibility: ${e=>e.isDragging?"visible":"hidden"};
  opacity: ${e=>e.isDragging?1:0};
  transition: all 0.3s ease-in-out;
  animation: ${WM} 0.3s ease-in-out;
`,GM=l.div`
  background: rgba(255, 255, 255, 0.95);
  padding: 48px 64px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  transform: scale(${e=>e.isDragging?"1.02":"1"});
  transition: transform 0.2s ease-in-out;

  .icon-wrapper {
    animation: ${qM} 2s infinite ease-in-out;
    margin-bottom: 20px;
  }

  h3 {
    margin: 16px 0;
    color: #1890ff;
    font-size: 24px;
    font-weight: 600;
  }

  p {
    color: #666;
    font-size: 16px;
    margin: 8px 0;
  }
`,_M=e=>{switch(e.toLowerCase()){case"imagen":return t.jsx(ts,{style:{fontSize:56,color:"#1890ff"}});case"pdf":return t.jsx(ns,{style:{fontSize:56,color:"#1890ff"}});default:return t.jsx(ss,{style:{fontSize:56,color:"#1890ff"}})}},HM=({isDragging:e,onDrop:n,onDragOver:s,onDragLeave:o,fileType:r})=>t.jsx(VM,{isDragging:e,onDrop:n,onDragOver:s,onDragLeave:o,children:t.jsxs(GM,{isDragging:e,children:[t.jsx("div",{className:"icon-wrapper",children:_M(r)}),t.jsx("h3",{children:"Arrastra y suelta tus archivos aquí"}),t.jsxs("p",{children:["Suelta los archivos para agregarlos como ",r]})]})}),QM=l.div`
  max-width: 100%;
  height: 100%;
`,YM=l.div`
  height: 100%;
  margin: 0;
  padding: 0;
  width: 100%;
  
  embed {
    width: 100%;
    height: 100%;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 4px;
  }
`,Zm=l.div`
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
`,eh=l.div`
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
`,KM=({previewFile:e,previewVisible:n,setPreviewVisible:s,setPreviewFile:o})=>{const[r,i]=m.useState(!1),[a,c]=m.useState(null),[d,u]=m.useState(0),p=m.useCallback(()=>{i(!1),u(0)},[]),h=m.useCallback(()=>{d<2?(u(x=>x+1),setTimeout(()=>i(!0),1e3)):(i(!1),c("No se pudo cargar el PDF. Por favor, verifique su conexión o intente abrirlo en una nueva pestaña."))},[d]),f=()=>{if(!e)return null;const x=e.name.split(".").pop().toLowerCase(),g=e.url||e.preview||e.file&&URL.createObjectURL(e.file);return["jpg","jpeg","png","gif"].includes(x)?t.jsxs(t.Fragment,{children:[t.jsx(eh,{role:"status","aria-live":"polite",children:r?"Cargando imagen...":a||"Imagen cargada"}),t.jsx(Lo,{src:g,alt:e.name,style:{maxWidth:"100%",height:"auto"},placeholder:t.jsx(Zm,{children:t.jsx(He,{size:"large",tip:"Cargando imagen..."})}),onError:()=>c("No se pudo cargar la imagen. Verifique su conexión o permisos de acceso.")})]}):x==="pdf"?t.jsxs(YM,{children:[t.jsx(eh,{role:"status","aria-live":"polite",children:r?"Cargando PDF...":a||"PDF cargado"}),r&&t.jsx(Zm,{children:t.jsx(He,{size:"large",tip:`Cargando PDF${d>0?` (intento ${d+1}/3)`:""}`})}),t.jsx("embed",{src:`${g}#toolbar=1&navpanes=1&scrollbar=1&zoom=100`,type:"application/pdf",style:{display:r?"none":"block"},onLoad:p,onError:h}),a&&t.jsx(Pt,{message:"Error al cargar el PDF",description:t.jsxs(t.Fragment,{children:[a,t.jsx("br",{}),t.jsx("a",{href:g,target:"_blank",rel:"noopener noreferrer",children:"Abrir en nueva pestaña"})]}),type:"error",showIcon:!0,style:{margin:"20px"}})]}):t.jsx("p",{children:"No hay vista previa disponible para este tipo de archivo"})};return m.useEffect(()=>{let x;return e&&(i(!0),c(null),e.file instanceof File&&(x=URL.createObjectURL(e.file))),()=>{x&&URL.revokeObjectURL(x),c(null),i(!1)}},[e]),t.jsx(Rt,{open:n,onClose:()=>{s(!1),o(null),u(0)},width:window.innerWidth<=768?"100%":"80%",height:"100%",title:e==null?void 0:e.name,placement:window.innerWidth<=768?"right":"bottom",footer:null,styles:{content:{height:"100%",padding:0,margin:0},body:{padding:"0",margin:"0",height:"100%",overflow:"hidden"}},children:t.jsx(QM,{children:f()})})},JM=({lightboxOpen:e,setLightboxOpen:n,lightboxIndex:s,setLightboxIndex:o,getImageFiles:r})=>t.jsx(mc,{open:e,close:()=>n(!1),index:s,slides:r(),plugins:[hc,gc,fc],carousel:{spacing:0,padding:0,imageFit:"contain"},zoom:{wheelZoomDistanceFactor:100,pinchZoomDistanceFactor:100,scrollToZoom:!0},thumbnails:{position:"bottom",width:120,height:80,gap:2,padding:5},captions:{showToggle:!0,descriptionTextAlign:"left"}}),XM=l.button`
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border: 1px solid #d9d9d9;
  border-radius: 6px;
  background: white;
  cursor: pointer;
  transition: all 0.3s;

  &:hover {
    border-color: #1890ff;
    color: #1890ff;
  }
`,ZM=({onFileInput:e})=>t.jsxs(t.Fragment,{children:[t.jsxs(XM,{onClick:()=>document.getElementById("fileInput").click(),children:[t.jsx(ss,{}),"Cargar"]}),t.jsx("input",{id:"fileInput",type:"file",multiple:!0,onChange:e,style:{display:"none"}})]}),{Option:e5}=ge,t5=[{value:"receipts",label:"Recibos"},{value:"invoices",label:"Facturas"},{value:"others",label:"Otros"}],n5=({fileType:e,setFileType:n,handleFileInput:s})=>s?t.jsxs("div",{style:{display:"flex",gap:"10px"},children:[t.jsx(M.Item,{label:"Tipo",children:t.jsx(ge,{value:e,style:{width:120},onChange:o=>n(o),children:t5.map(o=>t.jsx(e5,{value:o.value,children:o.label},o.value))})}),t.jsx(M.Item,{label:"Adjuntar Evidencia",children:t.jsx(ZM,{onFileInput:s})})]}):null;function nn(e){if(!(e instanceof File))throw new Error("The provided parameter is not a File object.");return URL.createObjectURL(e)}function Rc(e){e&&URL.revokeObjectURL(e)}function Vt(e){if(!e)return!1;const n=e.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif"].includes(n)}function di(e){return e?e.split(".").pop().toLowerCase()==="pdf":!1}function s5(e){if(typeof e=="string"&&e.includes("firebasestorage.googleapis.com")){const s=decodeURIComponent(e).match(/[^\/]+\.([^?]+)(?=\?|$)/i);return s?s[1].toLowerCase():""}return e.split(".").pop().toLowerCase()}function Nc(e){const n=s5(e);return Vt(`.${n}`)?"image":di(`.${n}`)?"pdf":"other"}const o5=({files:e=[],attachmentUrls:n=[],onAddFiles:s=null,onRemoveFiles:o=null,showFileList:r=!0})=>{const[i,a]=m.useState("receipts"),[c,d]=m.useState(!1),[u,p]=m.useState(null),[h,f]=m.useState(!1),[x,g]=m.useState(!1),[y,b]=m.useState(0);m.useEffect(()=>{const w=E=>{E.preventDefault(),d(!0)},S=E=>{E.preventDefault(),E.relatedTarget===null&&d(!1)};return window.addEventListener("dragenter",w),window.addEventListener("dragleave",S),()=>{window.removeEventListener("dragenter",w),window.removeEventListener("dragleave",S)}},[]);const v=w=>{w.preventDefault(),d(!1);const S=Array.from(w.dataTransfer.files);I(S)},C=w=>{const S=Array.from(w.target.files);I(S)},I=w=>{const S=w.map(E=>({file:E,type:i,id:Math.random().toString(36).substr(2,9),name:E.name,isLocal:!0}));s(S),V.success(`${w.length} archivo(s) agregado(s)`)},j=w=>{o(w)},k=m.useCallback(()=>{const w=[];return e.forEach(S=>{Vt(S.name)&&w.push({src:nn(S.file),title:S.name,description:`Tipo: ${S.type}`})}),n.filter(S=>{var E;return(E=S.url)==null?void 0:E.includes("firebasestorage.googleapis.com")}).forEach(S=>{Vt(S.name)&&w.push({src:S.url,title:S.name,description:`Tipo: ${S.type}`})}),w},[e,n]),A=m.useMemo(()=>{const w=(e||[]).map(E=>({...E,isLocal:!0,preview:E.file?nn(E.file):null})),S=(n||[]).filter(E=>{var T;return(T=E.url)==null?void 0:T.includes("firebasestorage.googleapis.com")}).map(E=>({id:E.id||Math.random().toString(36).substr(2,9),name:E.name||"Archivo sin nombre",type:E.type||Nc(E.url),url:E.url,isLocal:!1}));return[...w,...S]},[e,n]);m.useEffect(()=>()=>{A.filter(w=>w.isLocal&&w.preview).forEach(w=>{Rc(w.preview)})},[A]);const P=m.useCallback(w=>{if(!w)return;const S=Vt(w.name),E=di(w.name);if(S){const R=k().findIndex(N=>N.title===w.name&&N.src===(w.url||w.file&&nn(w.file)));b(Math.max(0,R)),g(!0)}else E&&(p(w),f(!0))},[k]);return t.jsxs("div",{children:[s&&t.jsx(n5,{fileType:i,setFileType:a,handleFileInput:C}),r&&t.jsx(fv,{files:A,removeFile:o?j:null,handlePreview:P}),t.jsx(KM,{previewFile:u,previewVisible:h,setPreviewVisible:f,setPreviewFile:p}),t.jsx(JM,{lightboxOpen:x,setLightboxOpen:g,lightboxIndex:y,setLightboxIndex:b,getImageFiles:k}),t.jsx(HM,{isDragging:c,onDrop:v,onDragOver:w=>w.preventDefault(),onDragLeave:w=>{w.preventDefault(),w.relatedTarget===null&&d(!1)},fileType:i})]})},r5=e=>{var s;let n={};return e.description||(n.description="Descripción es requerida"),e.amount||(n.amount="Importe es requerido"),e.categoryId||(n.category="Categoría es requerida"),(s=e.dates)!=null&&s.expenseDate||(n.dates={expenseDate:"Fecha de gasto es requerida"}),n},xv=(e,n=[],s=null)=>{if(!e)throw new Error("Invalid file");if(n.length&&!n.includes(e.type))throw new Error(`Unsupported type: ${e.type}`);if(s&&e.size>s)throw new Error(`File too large: ${e.size} bytes`)},bv=(e,n,s,o,r=!0)=>{const i=r?o.replace(/[^a-z0-9.]/gi,"_").toLowerCase():o;return In(e,`businesses/${n}/${s}/${be()}${i}`)},yv=async(e,n,s,o=()=>{},r=()=>{})=>{const i=Nx(e,n,s);return new Promise((a,c)=>{const d=i.on("state_changed",u=>{o(u,n),r(u)},u=>c(u),async()=>{try{const u=await Ss(e);a({url:u,location:"remote",name:n.name,mimeType:n.type,size:n.size,uploadedAt:Date.now()})}catch(u){c(u)}});i.catch(u=>{d(),c(u)})})},vv=e=>{if(!e||typeof e!="string")throw new Error("Invalid section name");if(!/^[a-zA-Z0-9-_]+$/.test(e))throw new Error("Section name contains invalid characters")},jv=async(e,n,s,o={})=>{const{allowedTypes:r=[],maxSizeInBytes:i=null,onProgress:a=()=>{},customMetadata:c={},normalizeFileName:d=!0}=o;if(!e.businessID)throw new Error("No businessID provided");vv(n),xv(s,r,i);const u=bv(Ts,e.businessID,n,s.name,d),p={contentType:s.type,...c};return await yv(u,s,p,a)},ui=async(e,n,s,o={})=>{const{fileProperty:r=null,allowedTypes:i=[],maxSizeInBytes:a=null,onProgress:c=()=>{},updateGlobalProgress:d=()=>{},customMetadata:u={},normalizeFileName:p=!0,handleErrorsIndividually:h=!1,addTimestamp:f=!1}=o;if(!e.businessID)throw new Error("No businessID provided");if(!Array.isArray(s)||s.length===0)throw new Error("Files must be a non-empty array");const x=s.reduce((b,v)=>{const C=r?v[r]:v;return b+((C==null?void 0:C.size)||0)},0);let g=0;return(await Promise.allSettled(s.map(async b=>{const v=r?b[r]:b;try{xv(v,i,a),vv(n);const C=bv(Ts,e.businessID,n,v.name,p),I={contentType:v.type,...u},j=await yv(C,v,I,c,k=>{g+=k.bytesTransferred,d({totalBytes:x,totalBytesTransferred:g,progress:g/x*100})});return f?{...j,timestamp:Date.now()}:j}catch(C){if(h)return{error:C.message,fileName:v.name};throw C}}))).map(b=>b.status==="fulfilled"?b.value:b.reason)},Yd=e=>{if(e instanceof ue)return e;if(typeof e=="number")return ue.fromMillis(e);if(e&&typeof e.valueOf=="function")return ue.fromMillis(e.valueOf());throw new Error("Formato de fecha no soportado: "+e)},ki=e=>{var n;return((n=e==null?void 0:e.toMillis)==null?void 0:n.call(e))??null},np=e=>{if(e===null||typeof e!="object"||Array.isArray(e))return e;const n={};for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&!(e[s]===void 0||e[s]===""||s===""))if(typeof e[s]=="object"&&e[s]!==null){const o=np(e[s]);(Object.keys(o).length>0||Array.isArray(e[s]))&&(n[s]=o)}else n[s]=e[s];return n},i5=async(e,n,s,o)=>{try{if(n({isOpen:!0,message:"Iniciando proceso de registro de gasto..."}),!e.businessID)throw new Error("No businessID provided");const r=await Mt(e,"lastExpensesId");let i={...s,dates:{...s.dates,expenseDate:Yd(s.dates.expenseDate),createdAt:ue.now()},status:"active",numberId:r,id:be()};if(n({isOpen:!0,message:"Subiendo imagen del recibo al servidor..."}),o&&o.length>0){const u=o.map(h=>jv(e,"expensesReceiptImg",h.file)),p=await Promise.all(u);i.attachments=o.map((h,f)=>({id:h.id,name:h.name,type:h.type,url:p[f]}))}n({isOpen:!0,message:"Sanitizando y registrando detalles del gasto..."});const a=np(i),c={...a,createdBy:e.uid},d=F($,"businesses",e.businessID,"expenses",a.id);return await De(d,{expense:c}),n({isOpen:!1,message:""}),!0}catch(r){throw console.error("Error adding expense: ",r),n({isOpen:!1,message:""}),r}},a5=async e=>{const n=In(Ts,e);try{await Ss(n),await Po(n),console.log(`deleted ${e}`)}catch(s){console.log(`Error deleting image: ${s}`)}},c5=async(e,n,s,o,r=[])=>{try{if(n({isOpen:!0,message:"Iniciando actualización del gasto..."}),!e.businessID)throw new Error("No businessID provided");if(r.length>0){n({isOpen:!0,message:"Eliminando archivos adjuntos..."});for(const d of r){const u=d.url;u&&await a5(u)}}let i={...s,dates:{...s.dates,expenseDate:Yd(s.dates.expenseDate??Date.now()),createdAt:Yd(s.dates.createdAt??Date.now()),updatedAt:ue.now()}};if(o&&o.length>0){n({isOpen:!0,message:"Procesando archivos adjuntos..."}),console.log("Processing file attachments:",o);const d=o.map(f=>jv(e,"expensesReceiptImg",f.file)),u=await Promise.all(d);console.log("Uploaded URLs:",u);const p=i.attachments||[],h=o.map((f,x)=>({id:f.id,name:f.name,type:f.type,url:u[x]}));i.attachments=[...p,...h]}n({isOpen:!0,message:"Sanitizando y actualizando gasto..."});const a=np(i);console.log("Expense antes de sanitizar:",i),console.log("Expense sanitizado:",a);const c=F($,"businesses",e.businessID,"expenses",a.id);return await je(c,{expense:a}),n({isOpen:!1,message:""}),!0}catch(i){throw console.error("Error updating expense:",i),n({isOpen:!1,message:""}),new Error("Error updating expense: "+i)}},l5=(e,n)=>{const[s,o]=m.useState([]);return m.useEffect(()=>{if(!e||!n)return;const r=le($,"businesses",e,"cashCounts"),i=he(r,te("cashCount.state","==","open")),a=Te(i,async c=>{const d=await Promise.all(c.docs.map(async u=>{var v,C,I;const p=u.data(),{id:h,incrementNumber:f,opening:x}=p.cashCount||{};if(!h)return null;const y=((v=x==null?void 0:x.date)!=null&&v.toDate?x.date.toDate():new Date(x.date)).toLocaleDateString("es-ES");let b="Usuario desconocido";if((C=x==null?void 0:x.employee)!=null&&C.path)try{const j=await Se(F($,x.employee.path));if(j.exists()){const k=j.data();b=k.name||((I=k.user)==null?void 0:I.name)||b}}catch{}return{label:`Cuadre #${f||"N/A"} - ${y} - ${b}`,value:h}}));o(d.filter(Boolean))});return()=>a()},[e,n]),s};function d5(e){var w,S;const n=D(q),{isOpen:s}=D(NR),{expense:o,mode:r}=D(ER),i=r==="add",[a,c]=m.useState({}),[d,u]=m.useState({isOpen:!1,message:""}),[p,h]=m.useState([]),[f,x]=m.useState([]),[g,y]=m.useState([]),b=l5(n==null?void 0:n.businessID,s),v=["credit_card","check","bank_transfer"].includes((w=o==null?void 0:o.payment)==null?void 0:w.method),C=((S=o==null?void 0:o.payment)==null?void 0:S.method)==="open_cash";m.useEffect(()=>{var T;if(!((T=o==null?void 0:o.attachments)!=null&&T.length)){x([]);return}const E=o.attachments.filter(R=>R.url).map(R=>({...R,url:typeof R.url=="string"?R.url:R.url.url}));x(E)},[o==null?void 0:o.attachments]);const I=m.useCallback((E,T,R)=>{const N=R===""?null:R;e(Ua(E?{[E]:{...o[E],[T]:N}}:{[T]:N}))},[e,o]),j=m.useCallback(()=>{e(ky()),e(DR()),c({}),h([]),x([]),y([])},[e]),k=m.useCallback(async()=>{const E=r5(o);if(Object.keys(E).length>0){c(E);return}try{i?await i5(n,u,{...o,attachments:f},p):await c5(n,u,{...o,attachments:f},p,g),j()}catch(T){console.error("Error saving expense:",T),V.error("Error al guardar el gasto. Inténtelo de nuevo más tarde.")}},[o,p,i,j,g,f,n]),A=m.useCallback(E=>{h(T=>[...T,...E])},[]),P=m.useCallback(E=>{if(p.some(T=>T.id===E))h(T=>T.filter(R=>R.id!==E));else{const T=f.find(R=>R.id===E);T&&T.url.includes("firebasestorage.googleapis.com")&&y(N=>[...N,T]),x(R=>R.filter(N=>N.id!==E))}},[p,f]);return{user:n,expense:o,isAddMode:i,isOpen:s,errors:a,loading:d,files:p,attachmentUrls:f,openCashRegisters:b,showBank:v,showCashRegister:C,updateField:I,handleReset:j,handleSubmit:k,handleAddFiles:A,handleRemoveFiles:P}}const sp=({useRedux:e=!0,show:n,message:s,theme:o="dark"})=>{const r=D(R$),i=D(N$),a=e?r:n,c=e?i:s;return a?t.jsx(p5,{show:a,theme:o,children:t.jsxs(m5,{children:[t.jsx(h5,{theme:o}),c&&t.jsx(g5,{theme:o,children:c})]})}):null},Wa=e=>{const n={dark:{backgroundColor:"rgba(0, 0, 0, 0.39)",spinnerBorder:"4px solid rgba(255, 255, 255, 0.3)",spinnerTopColor:"#fff",textColor:"#fff"},light:{backgroundColor:"rgba(255, 255, 255, 0.719)",spinnerBorder:"4px solid rgba(0, 0, 0, 0.3)",spinnerTopColor:"#000",textColor:"#000"}};return n[e]||n.dark},u5=sn`
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
`,p5=l.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: ${({theme:e})=>Wa(e).backgroundColor};
  z-index: 999;
`,m5=l.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1em;
`,h5=l.div`
  border: ${({theme:e})=>Wa(e).spinnerBorder};
  border-top-color: ${({theme:e})=>Wa(e).spinnerTopColor};
  border-radius: 50%;
  width: 44px;
  height: 44px;
  animation: ${u5} 0.8s linear infinite;
`,g5=l.p`
  font-size: 20px;
  font-family: 'Lato', sans-serif;
  text-align: center;
  letter-spacing: 0.5px;
  font-weight: bold;
  color: ${({theme:e})=>Wa(e).textColor};
`;We.extend(Bx);We.locale("es");const f5=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
`,x5=[{value:"open_cash",label:"Efectivo de Caja Abierta"},{value:"cash",label:"Efectivo"},{value:"credit_card",label:"Tarjeta de Crédito"},{value:"check",label:"Cheque"},{value:"bank_transfer",label:"Transferencia"}],Cv=()=>{var I,j,k,A,P,w,S;const e=W(),{categories:n}=gv(),{configureAddExpenseCategoryModal:s}=ai(),{expense:o,isAddMode:r,isOpen:i,errors:a,loading:c,files:d,attachmentUrls:u,openCashRegisters:p,showBank:h,showCashRegister:f,updateField:x,handleReset:g,handleSubmit:y,handleAddFiles:b,handleRemoveFiles:v}=d5(e),C=m.useMemo(()=>n.filter(({category:E})=>E==null?void 0:E.name).map(({category:E})=>({label:E==null?void 0:E.name,value:E==null?void 0:E.id})),[n]);return t.jsxs(Ce,{title:r?"Registro de Gastos":"Actualizar Gasto",open:i,onCancel:g,footer:[t.jsx(U,{type:"default",onClick:g,icon:t.jsx("i",{className:"fas fa-times"}),children:"Cancelar"},"cancel"),t.jsxs(U,{type:"primary",onClick:y,icon:t.jsx("i",{className:"fas fa-save"}),children:[r?"Guardar Gasto":"Actualizar Gasto","                "]},"submit")],style:{top:10},width:600,destroyOnHidden:!0,centered:!0,maskClosable:!1,children:[t.jsx(sp,{useRedux:!1,show:c.isOpen,message:c.message,theme:"light"}),t.jsxs(M,{layout:"vertical",children:[t.jsx(M.Item,{label:"Descripción",required:!0,validateStatus:a.description?"error":"",help:a.description,children:t.jsx(ie.TextArea,{id:"description",value:o.description,placeholder:"Describa el motivo del gasto",autoSize:{minRows:1,maxRows:4},onChange:E=>x("","description",E.target.value),allowClear:!0})}),t.jsx(M.Item,{label:"Categoría",required:!0,validateStatus:a.category?"error":"",help:a.category,children:t.jsxs(f5,{children:[t.jsx(ge,{placeholder:"Seleccione una categoría",showSearch:!0,optionFilterProp:"label",options:C,value:o==null?void 0:o.categoryId,onChange:E=>{const T=C.find(R=>R.value===E);T&&(x("","categoryId",E),x("","category",T.label))}}),t.jsx(U,{type:"primary",icon:z.operationModes.add,title:"Añadir nueva categoría",onClick:s})]})}),t.jsx(M.Item,{label:"Fecha de Gasto",required:!0,validateStatus:(I=a.dates)!=null&&I.expenseDate?"error":"",help:(j=a.dates)==null?void 0:j.expenseDate,children:t.jsx(yt,{format:"DD/MM/YYYY",placeholder:"Seleccione fecha",value:o.dates.expenseDate?We(o.dates.expenseDate):We(),onChange:E=>x("dates","expenseDate",E.valueOf())})}),t.jsx(M.Item,{label:"Importe",required:!0,validateStatus:a.amount?"error":"",help:a.amount,children:t.jsx(ie,{id:"amount",type:"number",value:o.amount||"",style:{width:"200px"},prefix:"$",placeholder:"0.00",allowClear:!0,onChange:E=>x("","amount",Number(E.target.value))})}),t.jsx(M.Item,{label:"NCF (Número de Comprobante Fiscal)",children:t.jsx(ie,{value:((k=o.invoice)==null?void 0:k.ncf)||"",placeholder:"Ingrese el NCF",onChange:E=>x("invoice","ncf",E.target.value),allowClear:!0})}),t.jsx(M.Item,{label:"Método de Pago",children:t.jsx(ge,{placeholder:"Seleccione el método de pago",options:x5,value:((A=o.payment)==null?void 0:A.method)||void 0,onChange:E=>x("payment","method",E),style:{width:"100%"}})}),h&&t.jsx(M.Item,{label:"Banco",children:t.jsx(ie,{value:((P=o.payment)==null?void 0:P.bank)||"",placeholder:"Ingrese el banco",onChange:E=>x("payment","bank",E.target.value),allowClear:!0})}),f&&t.jsx(M.Item,{label:"Cuadre de Caja",children:t.jsx(ge,{placeholder:"Seleccione el cuadre de caja",options:p,value:((w=o.payment)==null?void 0:w.cashRegister)||void 0,onChange:E=>x("payment","cashRegister",E),style:{width:"100%"},notFoundContent:"No hay cuadres de caja abiertos"})}),t.jsx(M.Item,{label:"Comentario",rules:[{required:!1,message:"Ingrese un comentario"}],children:t.jsx(ie.TextArea,{value:((S=o.payment)==null?void 0:S.comment)||"",placeholder:"Ingrese comentarios adicionales",autoSize:{minRows:2,maxRows:4},onChange:E=>x("payment","comment",E.target.value),allowClear:!0})}),t.jsx(M.Item,{label:"Archivos Adjuntos",children:t.jsx(o5,{files:d,attachmentUrls:u,onAddFiles:b,onRemoveFiles:v,showFileList:!0})})]})]})},b5=({onUpdate:e,onDelete:n=async()=>{}})=>{const s=W(),{dialog:o,setDialogConfirm:r,onClose:i}=Ds(),a=async()=>{r({...o,isOpen:!0,title:"Confirmación de Eliminación",type:"error",message:"¿Está seguro que desea eliminar este elemento?",onCancel:()=>i(),onConfirm:async()=>{await n().then(()=>{i(),s(addNotification({type:"success",title:"Elemento Eliminado",message:"El elemento ha sido eliminado con éxito."}))})}})};return t.jsxs($t,{children:[t.jsx(U,{icon:z.operationModes.edit,onClick:e}),t.jsx(U,{icon:z.operationModes.delete,onClick:a,danger:!0})]})},y5=async(e,n)=>{try{if(!e||!(e!=null&&e.businessID))throw new Error("No user or id provided");if(!n||!n.id)throw new Error("No expense or expense id provided");const s=F($,"businesses",e.businessID,"expenses",n.id);await je(s,{"expense.dates.deletedAt":ue.now(),"expense.dates.updatedAt":ue.now(),"expense.status":"deleted"})}catch(s){throw new Error(`Error deleting expense: ${s}`)}},v5=e=>{const n=new Date(e*1e3),s=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${s}-${o}-${r}`},j5=e=>e.reduce((n,{expense:s})=>{const o=v5(s.dates.expenseDate);return n[o]=(n[o]||0)+s.amount,n},{}),C5=({expenses:e})=>{const n=m.useRef(null),s=m.useRef(null),o=m.useRef(null),r=m.useMemo(()=>j5(e),[e]),i=m.useMemo(()=>Object.entries(r).map(([a,c])=>({time:a,value:c})),[r]);return m.useEffect(()=>{if(n.current)return s.current=ES(n.current,{layout:{background:{color:"white"},textColor:"black"},rightPriceScale:{visible:!1},timeScale:{timeVisible:!0,secondsVisible:!1},grid:{vertLines:{visible:!1},horzLines:{visible:!1}}}),o.current=s.current.addSeries(AS,{color:"rgba(41, 98, 255, 0.5)",priceFormat:{type:"volume"},overlay:!1,scaleMargins:{top:.2,bottom:.1}}),o.current.setData(i),s.current.timeScale().fitContent(),()=>{s.current&&(s.current.remove(),s.current=null)}},[i]),t.jsxs(w5,{children:[t.jsx(Qe,{variant:"h3",children:"Gastos Totales por Día"}),t.jsx(S5,{ref:n})]})},w5=l.div`
  display: flex;
  flex-direction: column;
  gap: 0.5em;
`,S5=l.div`
  width: 100%;
  height: 200px;
`,I5={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Monto de Gastos"}},x:{title:{display:!0,text:"Categoría"}}},plugins:{tooltip:{callbacks:{label:function(e){let n=e.dataset.label||"";return n&&(n+=": "+Y(e.parsed.y)),n}}}}},E5=e=>e.reduce((n,{expense:s})=>{const o=s.category;return n[o]=(n[o]||0)+s.amount,n},{}),A5=({expenses:e})=>{if(!e||!Array.isArray(e))return null;const n=m.useMemo(()=>E5(e),[e]),s=m.useMemo(()=>{const o=Object.keys(n),r=o.map(i=>n[i]);return{labels:o,datasets:[{label:"Gastos",data:r,backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]}},[n]);return t.jsxs(k5,{children:[t.jsx(Qe,{variant:"h3",children:"Gastos Totales por Categoría"}),t.jsx(jt,{data:s,options:I5})]})},k5=l.div`
    height: 200px;
    display: grid;
    gap: 1em;
`;l.div`
  height: 300px;
  position: relative;
`;const T5=e=>{const n={};let s=0;for(let{expense:o}of e){const i=new Date(o.dates.expenseDate).toLocaleDateString(void 0,{month:"long",year:"numeric"});n[i]=(n[i]||0)+o.amount,s+=o.amount}return{monthlyData:n,totalAccumulated:s}},P5=({totalAccumulated:e,options:n})=>{const s={labels:["Total Acumulado"],datasets:[{label:"Total Acumulado",data:[e],backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]};return t.jsx(D5,{children:t.jsx(jt,{data:s,options:n})})},D5=l.div``,$5=({monthlyData:e,options:n})=>{const s=Object.keys(e),o=s.map(i=>e[i]),r={labels:s,datasets:[{label:"Total por Mes",data:o,backgroundColor:"rgba(54, 162, 235, 0.2)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]};return t.jsx(R5,{children:t.jsx(jt,{data:r,options:n})})},R5=l.div``,ml={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Monto de Gastos"}},x:{title:{display:!0,text:"Mes"}}},plugins:{tooltip:{callbacks:{label:function(e){let n=e.dataset.label||"";return n&&(n+=": "+Y(e.parsed.y)),n}}}}},N5=({expenses:e})=>{if(!e||!Array.isArray(e))return null;const{monthlyData:n,totalAccumulated:s}=m.useMemo(()=>T5(e),[e]),o=m.useMemo(()=>Object.keys(n),[n]),r=Math.max(...Object.values(n)),i=Math.max(s,r),a=m.useMemo(()=>({...ml,scales:{...ml.scales,y:{...ml.scales.y,max:i}}}),[i]);return t.jsxs(O5,{children:[t.jsx(Qe,{variant:"h3",children:"Gastos Mensuales y Acumulados"}),t.jsxs(M5,{children:[t.jsx(P5,{totalAccumulated:s,labels:o,options:a}),t.jsx($5,{monthlyData:n,options:a})]})]})},O5=l.div`
    height: 400px;
    display: grid;
`,M5=l.div`
  display: grid;
  grid-template-columns: 200px 1fr;
  gap: 1em;
`,F5=()=>{const e=W(),{isOpen:n}=D(RR),s=()=>e($y()),o=D(Py),r=m.useRef(null),i={open:{opacity:1,zIndex:1},close:{opacity:0,zIndex:-1}},a={open:{opacity:1,y:0},close:{opacity:0,y:"100vh"}};return t.jsx(gt,{children:n&&t.jsx(L5,{variants:i,initial:"close",animate:n?"open":"close",transition:{duration:.5},exit:"close",children:t.jsxs(B5,{ref:r,variants:a,initial:"close",animate:n?"open":"close",transition:{duration:.5},exit:"close",children:[t.jsxs(z5,{children:[t.jsx(Qe,{variant:"h2",children:"Reporte de Gastos"}),t.jsx(ke,{title:"Cerrar",onClick:s})]}),t.jsx(C5,{expenses:o}),t.jsx(A5,{expenses:o}),t.jsx(N5,{expenses:o})]})},"backdrop")})};l.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1em;
`;const B5=l(Ie.div)`
  width: 98vw;
  display: grid;
  gap: 4em;
  height: 100%;
  background-color: #ffffff;
  border: 1px solid #1d1d1d37;
  border-radius: 0.5em;
  overflow-y: scroll;
  padding: 0 1em;
  `,L5=l(Ie.div)`
  width: 100%;
  height: calc(100vh);
  display: grid;
  top: 0;
  justify-content: center;
  position: absolute;
  overflow: hidden;
  z-index: 30;
`,z5=l.div`
  display: grid;
  grid-template-columns: 1fr max-content;
  align-items: center;
  position: sticky;
  top: 0;
  padding: 1em 1em 0 ;
  background: white;
  gap: 1em;
  `,U5=[{value:"completed",label:"Completado",icon:oc,color:"#52c41a",bgColor:"#f6ffed",borderColor:"#b7eb8f"},{value:"pending",label:"Pendiente",icon:Gr,color:"#faad14",bgColor:"#fffbe6",borderColor:"#ffe58f"},{value:"canceled",label:"Cancelado",icon:qx,color:"#ff4d4f",bgColor:"#fff1f0",borderColor:"#ffccc7"},{value:"processing",label:"En Proceso",icon:An,color:"#1890ff",bgColor:"#e6f7ff",borderColor:"#91d5ff"}],W5=({value:e,onChange:n,statusOptions:s=U5,visibleStatus:o=[],placeholder:r="Estado",showAllOption:i=!1,width:a,showAllLabel:c="Mostrar todos"})=>{const d=o.length>0?s.filter(p=>o.includes(p.value)):s,u={color:"#666",bgColor:"#ffffff",borderColor:"#d9d9d9",icon:Gr};return t.jsx(Cc,{value:e,onChange:n,options:d,placeholder:r,showAllOption:i,defaultStyles:u,width:a})},q5=(e={},n={isAscending:!1})=>{const[s,o]=m.useState({filters:e,isAscending:n.isAscending}),r=m.useRef(e);m.useEffect(()=>{JSON.stringify(e)!==JSON.stringify(r.current)&&(o(d=>({...d,filters:e})),r.current=e)},[e]);const i=m.useCallback(d=>{const u=Object.fromEntries(Object.entries(d).filter(([p,h])=>h!==null));o(p=>({...p,filters:u}))},[]),a=m.useCallback(d=>{o(u=>({...u,isAscending:d}))},[]),c=m.useCallback(()=>{o({filters:e,isAscending:n.isAscending})},[e,n.isAscending]);return{state:s,setFilters:i,setSorting:a,resetAll:c}},{RangePicker:V5}=yt,op=m.memo(({config:e={},onChange:n,searchTerm:s,onSearchTermChange:o,dataConfig:r={}})=>{var I;const{state:i,setFilters:a,setSorting:c,resetAll:d}=q5(e.defaultValues,e.defaultSort),[u,p]=m.useState(!1);m.useEffect(()=>{n==null||n(i)},[]);const h=m.useCallback(j=>{a(j),n==null||n({...i,filters:j})},[i,n,a]),f=m.useCallback(j=>{c(j),n==null||n({filters:i.filters,isAscending:j})},[i.filters,n,c]),x=m.useCallback(()=>{var j;d(),n==null||n({filters:e.defaultValues||{},isAscending:((j=e.defaultSort)==null?void 0:j.isAscending)??!1})},[e.defaultValues,e.defaultSort,n,d]),g=(j,k)=>{const A={...i.filters,[j]:k};h(A)},y=m.useCallback((j,k)=>{var P,w;if(j.type==="search")return null;let A=j.options||[];if(r[j.key]){const{data:S,accessor:E}=r[j.key];A=S?S.map(E):[]}switch(j.type){case"status":return t.jsx(Ti,{children:t.jsx(W5,{value:i.filters[j.key],onChange:S=>g(j.key,S),visibleStatus:j.visibleStatus,placeholder:j.placeholder,clearText:j.clearText,allowClear:!0,width:k?"100%":void 0})},"status");case"select":return t.jsx(Ti,{children:t.jsx(Cc,{value:i.filters[j.key],onChange:S=>g(j.key,S),options:A,placeholder:j.placeholder,clearText:j.clearText,icon:j.icon,showSearch:j.showSearch,allowClear:!0,width:k?"100%":void 0})},j.key);case"dateRange":return t.jsx(Ti,{children:t.jsx(V5,{style:{width:k?"100%":"auto"},format:"DD/MM/YYYY",value:(P=i.filters[j.key])!=null&&P.startDate&&((w=i.filters[j.key])!=null&&w.endDate)?[We(i.filters[j.key].startDate),We(i.filters[j.key].endDate)]:null,onChange:(S,E)=>{S&&S.length===2?g(j.key,{startDate:S[0].startOf("day").valueOf(),endDate:S[1].endOf("day").valueOf()}):g(j.key,null)},placeholder:j.placeholder?[j.placeholder," "]:["Fecha Inicio","Fecha Fin"]})},j.key);default:return null}},[i.filters,r]),b=t.jsx(Ti,{children:t.jsx(ie,{placeholder:"Buscar...",value:s,onChange:j=>o(j.target.value),allowClear:!0,style:{width:"200px"}})},"search"),v=m.useMemo(()=>{var j;return(j=e.filters)==null?void 0:j.map(k=>y(k,!1))},[e.filters,y]),C=t.jsxs(t.Fragment,{children:[o&&b,v,e.showSortButton&&t.jsx(th,{children:t.jsx(Oe,{title:i.isAscending?"Ordenar descendente":"Ordenar ascendente",children:t.jsx(U,{onClick:()=>f(!i.isAscending),icon:t.jsx(O,{icon:i.isAscending?ka:Mr}),type:"default"})})}),e.showResetButton&&t.jsx(th,{children:t.jsx(Oe,{title:"Restablecer filtros",children:t.jsx(U,{onClick:x,icon:t.jsx(O,{icon:Eo}),type:"default",danger:!0})})})]});return t.jsxs(G5,{children:[t.jsx(H5,{children:t.jsx(_5,{children:C})}),t.jsxs(Q5,{children:[t.jsxs(Y5,{children:[t.jsx(ie,{placeholder:"Buscar...",value:s,onChange:j=>o(j.target.value),allowClear:!0,style:{flex:1}}),t.jsx(U,{onClick:()=>p(!0),icon:t.jsx(O,{icon:Eo}),children:"Filtros"})]}),t.jsx(Rt,{title:"Filtros",placement:"bottom",onClose:()=>p(!1),open:u,width:"100%",children:t.jsxs(K5,{children:[(I=e.filters)==null?void 0:I.map(j=>y(j,!0)),t.jsxs(J5,{children:[e.showSortButton&&t.jsx(U,{onClick:()=>f(!i.isAscending),icon:t.jsx(O,{icon:i.isAscending?ka:Mr}),type:"default",children:i.isAscending?"Ordenar descendente":"Ordenar ascendente"}),e.showResetButton&&t.jsx(U,{onClick:x,icon:t.jsx(O,{icon:Eo}),type:"primary",danger:!0,children:"Restablecer filtros"})]})]})})]})]})});op.displayName="FilterBar";const G5=l.div`
  background-color: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  padding: 0.2rem;
  
  @media (max-width: 768px) {
    border-radius: 0;
    padding: 0.5rem;
    position: sticky;
    top: 0;
    z-index: 100;
  }
`,_5=l.div`
  display: flex;
  gap: 0.3rem;
  flex-wrap: wrap;

  @media (max-width: 768px) {
    gap: 0.5rem;
    
    /* Hacer que los elementos ocupen todo el ancho en móvil */
    & > div {
      flex: 1 1 100%;
      min-width: 100%;
    }

    /* Los botones de ordenar y reset se mantienen en línea */
    & > div:last-child,
    & > div:nth-last-child(2) {
      flex: 0 1 auto;
      min-width: auto;
    }
  }
`,Ti=l.div`
  /* Asegurar que los inputs y selectores tengan el ancho completo en móvil */
  @media (max-width: 768px) {
    .ant-input,
    .ant-select,
    .ant-picker { /* Ensure DatePicker also takes full width on mobile */
      width: 100% !important;
    }
  }
`,th=l.div`
  display: flex;
  gap: 0.3rem;
  align-items: center;

  @media (max-width: 768px) {
    margin-left: auto;
  }
`;l.div`
  display: flex;
  align-items: center;
  gap: 8px;
  
  svg {
    color: #666;
    font-size: 0.9em;
  }
`;l.span`
  background-color: var(--primary);
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.8em;
  font-weight: 500;
`;l.span`
  color: ${e=>e.color};
  font-size: 0.8em;
  display: flex;
  align-items: center;
`;l.div`
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  color: #666;
  border-bottom: 1px solid #f0f0f0;
  
  &:hover {
    background-color: #f5f5f5;
  }
  
  svg {
    font-size: 0.9em;
  }
`;const H5=l.div`
  @media (max-width: 768px) {
    display: none;
  }
`,Q5=l.div`
  display: none;
  @media (max-width: 768px) {
    display: block;
  }
`,Y5=l.div`
  display: flex;
  gap: 8px;
  background-color: white;
  position: sticky;
  top: 0;
  z-index: 100;
`,K5=l.div`
  display: flex;
  flex-direction: column;
  gap: 16px;

  .ant-select,
  .ant-picker { /* Ensure DatePicker also takes full width in mobile drawer */
    width: 100%;
  }
`,J5=l.div`
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 16px;
  background: white;
  border-top: 1px solid #f0f0f0;
  display: flex;
  gap: 8px;
  justify-content: flex-end;
`,nh=e=>{if(e!=null){if(typeof e=="number")return e;if(typeof e=="string"){const n=parseInt(e.split(".")[0],10);return Number.isNaN(n)?new Date(e).getTime():n}return typeof(e==null?void 0:e.toMillis)=="function"?e.toMillis():typeof(e==null?void 0:e.valueOf)=="function"?e.valueOf():typeof(e==null?void 0:e.seconds)=="number"?e.seconds*1e3:new Date(e).getTime()}},wv=e=>{const n=W(),s=D(q),[o,r]=m.useState(!1),[i,a]=m.useState(null),c=D(Py),d=u=>n(kR(u));return m.useEffect(()=>{if(!(s!=null&&s.businessID))return;const u=nh(e==null?void 0:e.startDate),p=nh(e==null?void 0:e.endDate),h=le($,"businesses",s.businessID,"expenses"),f=u&&p?he(h,te("expense.dates.expenseDate",">=",u),te("expense.dates.expenseDate","<=",p)):he(h);r(!0),(()=>{const g=Te(f,async y=>{const b=y.docs.map(v=>{var I;const C=(I=v.data())==null?void 0:I.expense;return{expense:{...C,dates:{...C.dates,createdAt:C.dates.createdAt?C.dates.createdAt.seconds*1e3:null,expenseDate:C.dates.expenseDate?C.dates.expenseDate.seconds*1e3:null}}}});r(!1),d(b),a(null)},y=>{console.error("Error fetching expenses: ",y),a(y),r(!1)});return()=>g()})()},[s,e]),{expenses:c,loading:o,error:i}},X5=({})=>{const e=D(q),n=W(),[s,o]=m.useState(""),[r,i]=m.useState({startDate:null,endDate:null}),{expenses:a}=wv(r),[c,d]=m.useState(!1),u=()=>d(!c),[p,h]=m.useState({}),f=m.useCallback(C=>{if(h(C.filters),C.filters.dateRange)try{const I=C.filters.dateRange.startDate?typeof C.filters.dateRange.startDate=="number"?C.filters.dateRange.startDate:new Date(C.filters.dateRange.startDate).getTime():null,j=C.filters.dateRange.endDate?typeof C.filters.dateRange.endDate=="number"?C.filters.dateRange.endDate:new Date(C.filters.dateRange.endDate).getTime():null;(I!==(r==null?void 0:r.startDate)||j!==(r==null?void 0:r.endDate))&&i({startDate:I,endDate:j})}catch(I){console.error("Error processing date range:",I)}},[i,r]),g=[...new Set(a.map(({expense:C})=>C.category))].filter(Boolean).map(C=>({label:C,value:C})),y={filters:[{key:"category",type:"select",placeholder:"Categoría",options:g},{key:"status",type:"status",placeholder:"Estado",visibleStatus:["active","canceled","completed","pending"]}],showSortButton:!0,showResetButton:!0,defaultValues:{dateRange:r!=null&&r.startDate&&(r!=null&&r.endDate)?{startDate:r.startDate,endDate:r.endDate}:null,status:"active"},defaultSort:{isAscending:!1}},b=a.map(({expense:C})=>{var j,k;let I=null;if(((j=C.attachments)==null?void 0:j.length)>0){const A=C.attachments[0];A.url&&typeof A.url=="object"&&A.url.url?I=A.url.url:typeof A.url=="string"&&(I=A.url)}else C.receiptImageUrl&&(I=C.receiptImageUrl);return{number:C.numberId,category:C.category,description:C.description,dateExpense:(k=C==null?void 0:C.dates)==null?void 0:k.expenseDate,amount:C.amount,receiptImg:I,attachments:C.attachments||[],action:C,status:C.status,createdAt:C.dates.createdAt,dateGroup:ce.fromMillis(C.dates.createdAt).toLocaleString(ce.DATE_FULL)}}).filter(C=>{if(p.category&&C.category!==p.category||p.status&&C.status!==p.status)return!1;if(s&&s.trim()!==""){const I=s.toLowerCase();if(!(C.category&&C.category.toLowerCase().includes(I)||C.description&&C.description.toLowerCase().includes(I)||String(C.number).includes(I)||String(C.amount).includes(I)))return!1}return!0}).sort((C,I)=>I.number-C.number),v=[{Header:"#",accessor:"number",minWidth:"50px",maxWidth:"50px",reorderable:!1,sortable:!0},{Header:"Descripción",accessor:"description",minWidth:"60px",maxWidth:"1fr",cell:({value:C})=>Ro(C,18)},{Header:"Categoría",accessor:"category",minWidth:"50px",maxWidth:"1fr"},{Header:"Fecha de Gasto",accessor:"dateExpense",minWidth:"50px",maxWidth:"1fr",cell:({value:C})=>Z2(C)},{Header:"Importe",accessor:"amount",minWidth:"50px",maxWidth:"1fr",cell:({value:C})=>Y(C)},{Header:"Recibo",accessor:"receiptImg",minWidth:"70px",maxWidth:"70px",cell:({value:C,row:I})=>{const j=()=>{C?n(Ju({show:!0,url:C})):V.warning("Este gasto no tiene imágenes adjuntas")};return t.jsx(ke,{title:"Ver",onClick:j})}},{Header:"Acción",accessor:"action",minWidth:"80px",maxWidth:"70px",align:"right",reorderable:!1,cell:({value:C})=>{const I=async()=>{n(Ua(C)),n(SR("update")),n(Ry())},j=async()=>{await y5(e,C)};return t.jsx(b5,{onUpdate:I,onDelete:j})}}];return t.jsxs(Z5,{children:[t.jsx(op,{config:y,onChange:f,searchTerm:s,onSearchTermChange:o?C=>o(C):void 0,dataConfig:{category:{data:g,accessor:C=>C}}}),t.jsx(rn,{columns:v,data:b,elementName:"Gasto",groupBy:"dateGroup",defaultDate:"today",datesKeyConfig:"dateGroup"}),t.jsx(F5,{expenses:a,isOpen:c,onOpen:u})]})},Z5=l.div`
    height: 100%;
    width: 100%;
    background-color: white;
    display: flex;
    flex-direction: column;
    overflow: hidden;
`,eF=()=>t.jsxs(tF,{children:[t.jsx(Ze,{sectionName:"Gastos"}),t.jsx(X5,{}),t.jsx(Cv,{})]}),tF=l.div`
  display: flex;
  flex-direction: column;
  overflow: hidden;
  width: 100%;
  height: 100vh;
`,{EXPENSES_LIST:nF,EXPENSES_CREATE:sF,EXPENSES_CATEGORY:oF}=re.EXPENSES_TERM,rF=[{path:nF,element:t.jsx(eF,{})},{path:sF,element:t.jsx(Cv,{})},{path:oF,element:t.jsx($M,{})}],{SALES:iF,BILLS:aF,PREORDERS:cF}=re.SALES_TERM,lF=[{title:"Venta",icon:z.menu.unSelected.sale,route:iF,group:"sales"},{title:"Pre-ventas",icon:t.jsx(O,{icon:Vx}),route:cF,group:"sales",key:"preorders",condition:({billingMode:e})=>e==="deferred"},{title:"Facturas",icon:z.menu.unSelected.register,route:aF,group:"sales"}],{PURCHASES:dF,PURCHASES_CREATE:FCe}=re.PURCHASE_TERM,{ORDERS:uF,ORDERS_CREATE:BCe}=re.ORDER_TERM,{EXPENSES_LIST:pF,EXPENSES_CATEGORY:mF}=re.EXPENSES_TERM,{CASH_RECONCILIATION_LIST:hF}=re.CASH_RECONCILIATION_TERM,sh=z.arrows.chevronRight,oh=z.arrows.chevronLeft,gF=[{title:"Compras y Pedidos",icon:z.menu.unSelected.purchase,submenuIconOpen:oh,submenuIconClose:sh,group:"inventory",submenu:[{title:"Pedidos",icon:t.jsx(O,{icon:uw}),route:uF,group:"purchases"},{title:"Compras",route:dF,icon:t.jsx(O,{icon:_x}),group:"purchases"}]},{title:"Gastos del Negocio",icon:z.menu.unSelected.expenses.expenses,submenuIconOpen:oh,submenuIconClose:sh,group:"financialManagement",submenu:[{title:"Lista de Gastos",route:pF,icon:z.menu.unSelected.expenses.list},{title:"Categoría de Gastos",route:mF,icon:z.menu.unSelected.expenses.category}]},{title:"Cuadre de caja",icon:z.menu.unSelected.cashReconciliation,route:hF,group:"financialManagement"}],{CATEGORIES:fF,INVENTORY_ITEMS:xF,INVENTORY_SERVICES:LCe,PRODUCT_IMAGES_MANAGER:bF,PRODUCT_OUTFLOW:zCe,WAREHOUSE:yF,SERVICE_OUTFLOW:UCe}=re.INVENTORY_TERM,vF=z.arrows.chevronRight,jF=z.arrows.chevronLeft,CF=[{title:"Inventario",icon:z.menu.unSelected.inventory,submenuIconOpen:jF,submenuIconClose:vF,group:"inventory",submenu:[{title:"Administrar Productos",route:xF,icon:z.inventory.items,group:"inventoryItems"},{title:"Almacenes",route:yF,icon:z.inventory.warehouse,group:"inventoryItems"},{title:"Categoría",icon:z.menu.unSelected.category,route:fF,group:"inventoryItems"},{title:"Administrador de Imágenes",route:bF,icon:z.inventory.multimediaManager,group:"inventoryItems"}]}],{SETTING:wF}=re.SETTING_TERM,SF=[{title:"Configuración",icon:z.menu.unSelected.settings,route:wF,group:"admin"}],{CLIENTS:IF,SUPPLIERS:EF}=re.CONTACT_TERM,AF=z.arrows.chevronRight,kF=z.arrows.chevronLeft,TF=[{title:"Contacto",icon:z.menu.unSelected.contacts,submenuIconOpen:kF,submenuIconClose:AF,path:!1,group:"contacts",submenu:[{title:"Clientes",route:IF,icon:z.users.client,group:"clients"},{title:"Proveedores",route:EF,icon:z.users.provider,group:"suppliers"}]}],{CHANGELOG_LIST:PF}=re.CHANGELOG_TERM,DF=[{title:"Actualizaciones",icon:t.jsx(O,{icon:pw}),route:PF,group:"admin"}],{UTILITY_REPORT:$F}=re.UTILITY_TERM,RF=[{title:"Utilidad",icon:z.menu.unSelected.sale,route:$F,group:"utility"}],{RECEIVABLE_PAYMENT_RECEIPTS:NF,ACCOUNT_RECEIVABLE_LIST:OF}=re.ACCOUNT_RECEIVABLE,MF=z.arrows.chevronRight,FF=z.arrows.chevronLeft,BF=[{title:"Cuentas por Cobrar",icon:z.finances.fileInvoiceDollar,submenuIconOpen:FF,submenuIconClose:MF,group:"accountsReceivable",submenu:[{title:"Listado",route:OF,icon:z.menu.unSelected.list,group:"accountsReceivableList"},{title:"Recibos de pagos",route:NF,icon:z.menu.unSelected.register,group:"accountsReceivableReceipts"}]}],{INSURANCE_CONFIG:LF}=re.INSURANCE_TERM,zF=[{title:"Configuración de Seguro",icon:z.insurance.insurance,route:LF,group:"insurance",key:"insurance",condition:({businessType:e})=>e==="pharmacy"}],UF=()=>{const e=[...xM,...lF,...zF,...CF,...BF,...gF,...RF,...TF,...SF,...DF];return vb(e,!0)},WF={open:{x:0,transition:{type:"spring",stiffness:450,damping:50,restDelta:2}},closed:{x:"-100%",transition:{type:"spring",stiffness:450,damping:50,restDelta:2}}},qF=({isOpen:e,handleOpenMenu:n})=>{var x;const s=W(),o=D(q),{billing:{billingMode:r}}=D(zt),i=((x=o==null?void 0:o.business)==null?void 0:x.businessType)||null,a=UF(),{SETTINGS:c}=re.SETTING_TERM,d=Fe(),p=a.reduce((g,y)=>{let b=!0;if(y.key&&y.condition&&(b=y.condition({billingMode:r,businessType:i})),!b)return g;const v={...y};if(y.submenu){const C=y.submenu.filter(I=>I.key&&I.condition?I.condition({billingMode:r}):!0);C.length>0?v.submenu=C:delete v.submenu}return g.push(v),g},[]).reduce((g,y)=>(g[y.group]||(g[y.group]=[]),g[y.group].push(y),g),{}),h=()=>{d(c)},f=()=>{s(dy("taxReceipt")),n()};return t.jsx(VF,{variants:WF,initial:"closed",animate:e?"open":"closed",children:t.jsxs(_F,{children:[t.jsxs(YF,{children:[t.jsxs("div",{children:[t.jsx(KF,{}),t.jsx(cb,{})]}),t.jsxs(GF,{children:[t.jsx(ke,{startIcon:z.system.notification,color:"info",size:"icon32",borderRadius:"normal",onClick:f}),t.jsx(ke,{startIcon:z.operationModes.setting,color:"info",size:"icon32",borderRadius:"normal",onClick:h})]})]}),t.jsx(cM,{user:o}),t.jsx(HF,{children:t.jsx(QF,{children:Object.keys(p).map(g=>t.jsx(Sv,{children:t.jsx(Iv,{children:p[g].map((y,b)=>t.jsx(mv,{item:y},b))})},g))})})]})})},VF=l(Ie.div)`
    position: fixed;
    z-index: 9900;
    top: 0;
    left: 0;

    /*Box */
    max-width: 400px;
    width: 100%;
    height: 100vh;

    border-radius: 10px;
    border-bottom-left-radius: 0;
    border-top-left-radius: 0;

    overflow: hidden;
    transform: translateX(-100%); 
    transition: transform 400ms ease;
    background-color: ${e=>e.theme.bg.shade};  
    border-right: 1px solid rgb(0, 0, 0, 0.1);
    box-shadow: 5px 0 5px rgba(0, 0, 0, 0.1), 10px 0 5px rgba(0, 0, 0, 0.05);
`,GF=l.div`
    display: flex;
    gap: 0.4em;
`,_F=l.div`
    /*Box */
    width: 100%;
    height: 100%;
    overflow-y: auto;
    overflow-x: hidden;
    display: grid;
    grid-template-rows: min-content min-content 1fr;
    @media (max-width: 600px) {
            max-width: 500px;
            resize: none;
    }
   
`,HF=l.div`
    /* position: relative; */
    background-color: ${e=>e.theme.bg.color2}; 
    padding: 0.8em;
    overflow-y: auto;
`,QF=l.ul`
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(270px, 1fr));
    padding: 0;
    gap: 0.6em;

    `,Sv=l.div`
    overflow: hidden;
`,Iv=l.div`
    background-color: ${e=>e.theme.bg.shade};
    border-radius: var(--border-radius);
    padding: 0.2em;
    border: 1px solid rgb(0, 0, 0, 0.1);
    overflow: hidden;
  
`,YF=l.div`
   height: 2.75em;
    width: 100%;
    padding: 1em 1em 1em;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: ${e=>e.theme.bg.color}; 
    position: sticky;
    top: 0;

    div{
        display: flex;
        align-items: center;
    }
     
`,KF=l.div`
    height: 2.75em;
    width:3em;
    background-color: ${e=>e.theme.bg.color}; 
    `,JF=({onClick:e,zIndex:n,isOpen:s})=>{const o=W(),r=()=>o(py());return t.jsx(XF,{isOpen:s,onClick:e||r,zIndex:n,children:t.jsx(ZF,{isOpen:s})})},XF=l.div`
:root {
   --menu-items: rgb(241, 241, 241);
   //btnMenuItem
   --btnMenuItem-bg-color: var(--menu-items);
   --btnMenuItem-width: 1.6em;
   --btnMenuItem-height: 2px;

}
      justify-self: start;
  max-height: 2em;
  min-width: 2em;
  min-height: 2em;
  max-width: 2em;
  width: 2em;
  height: 2em;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: rgba(0, 0, 0, 0.2);
  border-radius: var(--border-radius);
  cursor: pointer;

  z-index: ${e=>e.isOpen?1e4:0};
  transition-delay: ${e=>!e.isOpen&&"1s"};

`,ZF=l.div`
  position: relative;
  z-index: 10;
  width: 1.2em;
  height: 2px;
  background-color: var(--menu-items);
  transition: all 1s ease-in-out;
 

  &:after {
    content: '';
    position: absolute;
    z-index: 10;
    width: 1.2em;
    height: 2px;
    background-color: var(--menu-items);
    margin-top: 6px;
    transition: all 0.4s ease-in-out;
  }

  &::before {
    content: '';
    position: absolute;
    z-index: 10;
    width: 1.2em;
    height: 2px;
    background-color: var(--menu-items);
    margin-top: -6px;
    transition: all 0.4s ease-in-out;
  }
  ${e=>{switch(e.isOpen){case!0:return`
        position: relative;
         width: 1.2em;
         height: 2px;
         background-color: transparent;
         transition: all 0.2s ease-in-out;
        &::after {
            content: '';
            position: absolute;
            width: 1.2em;
            height: 2px;
            background-color: var(--menu-items);
            margin-top: 0;
            transform: rotate(-45deg);
            transition: all 0.4s ease-in-out;


         }

         &::before {
            content: '';
            position: absolute;
            width: 1.2em;
            height: 2px;
            background-color: var(--menu-items);
            margin-top: 0;
            transform: rotate(45deg);
            transition: all 0.4s ease-in-out;
         }
        `}}}
  
  
`,eB=()=>t.jsx(tB,{children:t.jsx(Ze,{sectionName:"Cuadre de Caja"})}),tB=l.div`

`,nB=e=>e?{open:"Abierto",closing:"Cerrando Cuadre",closed:"Cerrado",pending:"Pendiente"}[e]||"":"Pendiente",Ev=({state:e})=>{const n=nB(e);return t.jsx(sB,{state:e,children:n})},sB=l.div`
padding: 0.2em 0.4em;
border-radius: 100px;
white-space: nowrap;
width: min-content;
    ${e=>{switch(e.state){case"open":return`
          background-color: var(--color-success-light);
          color: var(--color-success-dark);
        `;case"closing":return`
            background-color: var(--color-warning-light);
            color: var(--color-warning-dark);
          `;case"closed":return`
          background-color: var(--color-danger-light);
          color: var(--color-danger-dark);
          `}}}
`;function Ca(e){if(e==null)return 0;if(typeof e=="string"){const s=parseFloat(e.replace(",","."));return isNaN(s)?0:s}const n=Number(e);return isNaN(n)?0:n}const Av=e=>Array.isArray(e)?e:[],oB=e=>Av(e).length===0,rh=(e=[])=>e.reduce((n,{value:s=0,quantity:o=0})=>n+s*o,0),rB=(e=[])=>Av(e).filter(n=>{var s;return((s=n==null?void 0:n.payment)==null?void 0:s.method)==="open_cash"}).reduce((n,s)=>n+Ca(s==null?void 0:s.amount),0),iB=e=>e.reduce((n,{data:s})=>{const{paymentMethod:o=[],totalPurchase:r={}}=s;return n.charged+=Ca(r==null?void 0:r.value),o.forEach(i=>{i.status&&(i.method==="card"&&(n.card+=Ca(i.value)),i.method==="transfer"&&(n.transfer+=Ca(i.value)))}),n},{card:0,transfer:0,charged:0}),rp=(e,n=[],s=[])=>{if(!e)return null;const{opening:o={},closing:r={}}=e,i=rh(o.banknotes),a=rh(r.banknotes),c=rB(s),{card:d,transfer:u,charged:p}=iB(n),h=a+d+u,f=p+i-c,x=h-f;return{totalCard:d,totalTransfer:u,totalRegister:h,totalSystem:f,totalDiscrepancy:x,totalCharged:p,totalExpenses:c}},aB=()=>[{accessor:"incrementNumber",Header:"#",align:"left",maxWidth:"0.1fr",minWidth:"60px"},{accessor:"status",Header:"Estado",align:"left",maxWidth:"0.3fr",minWidth:"120px",cell:({value:n})=>t.jsx(Ev,{state:n})},{accessor:"date",Header:"Fecha Estado",align:"left",maxWidth:"0.4fr",minWidth:"160px",cell:({value:n})=>Ve.convertMillisToFriendlyDate(n)},{accessor:"user",Header:"Usuario",align:"left",maxWidth:"0.4fr",minWidth:"120px"},{accessor:"total",Header:"Total",align:"right",maxWidth:"0.4fr",minWidth:"150px",cell:({value:n})=>(n==null?void 0:n.state)==="open"||(n==null?void 0:n.state)==="closing"?t.jsx(Ge,{style:{fontSize:"16px",padding:"5px 10px"},children:"Pendiente"}):n.totalSystem?Y(n.totalSystem):"Total"},{accessor:"discrepancy",Header:"Resultado",align:"right",maxWidth:"0.4fr",minWidth:"100px",cell:({value:n})=>{const s=(n==null?void 0:n.state)==="open"||(n==null?void 0:n.state)==="closing";let o="success";if(s)return t.jsx(Ge,{style:{fontSize:"16px",padding:"5px 10px"},children:"Pendiente"});switch(!0){case n.totalDiscrepancy<0:o="error";break;case n.totalDiscrepancy>0:o="warning";break;default:o="success";break}return t.jsx(Ge,{color:o,style:{fontSize:"16px",padding:"5px 10px"},children:Y(n.totalDiscrepancy)??"Sobrante"})}}];async function ys(e){if(!e)return null;try{const n=(await Se(e)).data();if(!n||!n.user)throw new Error("Documento de empleado no encontrado o mal formado");const s=n.user;return{id:s.id,name:s.name}}catch(n){return console.error("Error al obtener datos del empleado:",n),null}}const cB=({startDate:e=null,endDate:n=null,status:s,sortField:o="cashCount.createdAt",userRef:r=null,sortAsc:i=!0}={})=>{const a=[];return e&&a.push(te(o,">=",e)),n&&a.push(te(o,"<=",n)),s&&a.push(te("cashCount.state","==",s)),r&&a.push(te("cashCount.opening.employee","==",r)),a.push(it(o,i?"asc":"desc")),a},lB=async e=>{const[n,s,o,r]=await Promise.all([ys(e.opening.employee),ys(e.opening.approvalEmployee),ys(e.closing.employee),ys(e.closing.approvalEmployee)]);return e.opening.date&&(e.opening.date=ki(e.opening.date)),{...e,updatedAt:ki(e.updatedAt),createdAt:ki(e.createdAt),opening:{...e.opening,employee:n,approvalEmployee:s},closing:{...e.closing,date:ki(e.closing.date),employee:o,approvalEmployee:r},sales:[]}},ih=e=>e?ce.fromMillis(e).toJSDate():null,dB=(e,n,s,o,r)=>{if(!(e!=null&&e.businessID))return()=>{};const i=le($,"businesses",e.businessID,"cashCounts"),a=ih(s==null?void 0:s.startDate),c=ih(s==null?void 0:s.endDate),d=o.filters.user?F($,"users",o.filters.user):null,u=cB({startDate:a,endDate:c,status:o.filters.status,userRef:d,sortAsc:o.isAscending}),p=he(i,...u);return Te(p,async f=>{if(f.empty){n([]);return}const x=f.docs.map(async y=>lB(y.data().cashCount)),g=await Promise.all(x);if(r&&r.trim()!==""){const y=r.toLowerCase(),b=g.filter(v=>{var C,I,j,k,A;return((C=v.incrementNumber)==null?void 0:C.toString().toLowerCase().includes(y))||((k=(j=(I=v.opening)==null?void 0:I.employee)==null?void 0:j.name)==null?void 0:k.toLowerCase().includes(y))||((A=v.state)==null?void 0:A.toLowerCase().includes(y))});n(b)}else n(g)},f=>{console.error("Error listening to cash counts:",f),n([])})},kv=(e,n,s)=>{if(!(e!=null&&e.businessID))return;const o=le($,"users"),r=he(o,te("user.businessID","==",e.businessID),it("user.createAt","desc"));return Te(r,a=>{const c=a.docs.map((d,u)=>({...d.data(),number:u+1}));n(c)},a=>{console.error("Error fetching users: ",a)})};function uB(){const e=D(q),[n,s]=m.useState([]),[o,r]=m.useState(!0),[i,a]=m.useState(null);return m.useEffect(()=>{if(kS([]),a(null),r(!0),!(e!=null&&e.businessID)){r(!1);return}let c;try{c=kv(e,d=>{s(d),r(!1)})}catch(d){a(d),r(!1)}},[e]),{users:n,loading:o,error:i}}const pB=()=>{const[e,n]=m.useState({startDate:null,endDate:null}),[s,o]=m.useState(""),[r,i]=m.useState([]),[a,c]=m.useState(!0),d=D(q),u=W(),p=Fe(),{users:h}=uB(),f={defaultValues:{status:"open",user:null,createdAtDateRange:null},defaultSort:{isAscending:!1},filters:[{key:"status",type:"select",placeholder:"Estado",clearText:"Limpiar estado"},{key:"user",type:"select",placeholder:"Usuario",clearText:"Limpiar usuario",showSearch:!0,icon:null}],showSortButton:!0,showResetButton:!0},[x,g]=m.useState({filters:f.defaultValues,isAscending:f.defaultSort.isAscending}),y=I=>{let j={...I,opening:{...I.opening,date:JSON.stringify(I.opening.date)}};u(oR(j)),p(`/cash-register-closure/${j==null?void 0:j.id}`)};m.useEffect(()=>{var A;c(!0);const I=(A=x.filters)==null?void 0:A.createdAtDateRange,j=(I==null?void 0:I.startDate)??null,k=(I==null?void 0:I.endDate)??null;(j!==e.startDate||k!==e.endDate)&&n({startDate:j,endDate:k});try{dB(d,i,e,x,s)}catch(P){console.error("Error in date range:",P),i([])}finally{c(!1)}},[d,e,x,s]);const b=r.map(I=>({incrementNumber:I==null?void 0:I.incrementNumber,status:I==null?void 0:I.state,date:I!=null&&I.updatedAt?I==null?void 0:I.updatedAt:null,user:I==null?void 0:I.opening.employee.name,total:I,discrepancy:I,action:I})),v=aB(),C={user:{data:h,accessor:({user:I})=>{var j;return{label:(j=I.realName)!=null&&j.trim()?I.realName:I.name,value:I.id}}},status:{data:[{label:"Abierto",value:"open"},{label:"Cerrando Cuadre",value:"closing"},{label:"Cerrado",value:"closed"}],accessor:I=>({label:I.label,value:I.value})}};return t.jsxs(mB,{children:[t.jsx(op,{config:f,dataConfig:C,onChange:I=>{g(I)}}),t.jsx(rn,{columns:v,data:b,elementName:"cuadre de caja",tableName:"cash_reconciliation_table",onRowClick:I=>y(I.action),loading:a})]})},mB=l.div`
  display: flex;
  flex-direction: column;
  `,Tv=()=>{const e=W();return m.useEffect(()=>{e(Pc())},[]),t.jsxs(hB,{children:[t.jsx(eB,{}),t.jsx(pB,{})]})},hB=l.div`
    height: 100vh;
    width: 100%;
    display: grid;
    grid-template-rows: min-content 1fr;
    background-color: var(--color2);
    overflow-y: hidden;
`,gB=({side:e="left"})=>{W();const n=Fe(),{CREATE_BUSINESS:s,BUSINESSES:o}=re.DEV_VIEW_TERM,r=()=>n(s);return vt(o)?t.jsx(fB,{children:e==="right"&&t.jsx(U,{onClick:r,icon:z.operationModes.add,children:"Negocio"})}):null},fB=l.div``,xB=({side:e="left",searchData:n,setSearchData:s})=>{const o=vt("/cash-reconciliation"),r=Fe(),i=W(),{state:a,cashCount:c}=D(hR);D(q);const d=()=>{if(a==="open"){i(za({isOpen:!0,title:"Operación no permitida: Caja actualmente abierta",description:"No se puede iniciar un nuevo proceso de cuadre de caja mientras haya uno en curso. Por favor, cierre la caja actual antes de intentar abrir una nueva.",onConfirm:null}));return}if(a==="closing"){i(za({isOpen:!0,title:"Operación no permitida: Cierre de caja en proceso",description:"No se puede iniciar un nuevo proceso de cuadre de caja mientras uno anterior esté en proceso de cierre. Por favor, espere a que el proceso de cierre actual se complete antes de intentar abrir una nueva caja.",onConfirm:null}));return}r("/cash-register-opening")};return o?t.jsx(bB,{children:e==="right"&&t.jsx(Oe,{title:"Crear cuadre de caja",placement:"bottomRight",children:t.jsx(U,{onClick:d,icon:z.operationModes.add,children:"Cuadre"})})}):null},bB=l.div`

`,yB=({side:e="left",searchData:n,setSearchData:s})=>{const{CLIENTS:o}=re.CONTACT_TERM,r=vt(o),i=W(),a=_e.CREATE.id,c=()=>i(Pn({mode:a,data:null}));return r?t.jsx(vB,{children:e==="right"&&t.jsx($t,{children:t.jsx(ke,{borderRadius:"normal",startIcon:z.mathOperations.add,title:"Nuevo Cliente",onClick:c})})}):null},vB=l.div`

`,ip=()=>{const e=W(),{product:n}=D(On),s=()=>{e(fb()),e(kr({product:n,status:_e.CREATE.label}))};return t.jsx(ke,{startIcon:z.operationModes.add,title:"Producto",onClick:s})},jB=({side:e="left"})=>{const{ORDERS_CREATE:n}=re.ORDER_TERM,s=vt(n);return Fe(),W(),D(q),_e.CREATE.id,s?t.jsx(CB,{children:e==="right"&&t.jsx($t,{children:t.jsx(ip,{})})}):null},CB=l.div`

`,wB=({side:e="left",searchData:n,setSearchData:s})=>{const{PURCHASES_CREATE:o}=re.PURCHASE_TERM,r=vt(o);return Fe(),W(),D(q),_e.CREATE.id,r?t.jsx(SB,{children:e==="right"&&t.jsx($t,{children:t.jsx(ip,{})})}):null},SB=l.div`

`,IB={date:z.forms.date,password:z.forms.password,email:z.forms.email,search:z.forms.search},EB=(e,n)=>(n!=="number"||(e=e.trim(),e=e.replace(/^0+(?!\.)/,""),e=e.replace(/(\.\d*?[1-9])0+$/,"$1"),e=e.replace(/\.$/,"")),e),AB=(e,n)=>{if(n==="number"){if(Number.isInteger(e))return e;let s=e.toString();s=s.replace(/(\.\d*?[1-9])0+$/,"$1"),e=Number(s)}return e},Dt=({focusWhen:e,autoFocus:n,id:s="",icon:o,label:r,labelVariant:i,marginBottom:a,size:c,search:d,onClear:u,validate:p,errorMessage:h,bgColor:f,clearButton:x=!1,value:g,type:y="text",buttons:b=[],buttonsAlignment:v="end",buttonsStyle:C,...I})=>{const j=m.useRef(null),[k,A]=m.useState(!1),P=IB[y]||null,w=o||P,S=b&&b.length>0;m.useEffect(()=>{j.current&&n&&j.current.focus()},[n]),m.useEffect(()=>{j.current&&e&&j.current.focus()},[e]);const E=()=>{u&&g&&u()},T=()=>{A(N=>!N)},R=m.useCallback(N=>typeof N=="string"?EB(N,y)||"":typeof N=="number"?AB(N,y)||"":N,[y]);return t.jsxs(TB,{marginBottom:a,children:[t.jsxs(PB,{children:[r&&t.jsx(BB,{htmlFor:s,labelVariant:i,children:r}),I.required&&t.jsx(kB,{children:z.forms.asterisk})]}),t.jsxs(DB,{children:[t.jsxs(OB,{size:c,bgColor:f,search:d,validate:p,hasButtons:S,...I,children:[w&&t.jsx(ah,{children:w}),t.jsx(MB,{ref:j,id:s,...I,type:k?"text":y,autoComplete:"off",value:R(g),onInvalid:N=>{N.preventDefault(),N.target.setCustomValidity("Por favor, complete este campo.")}}),g&&u?t.jsx(ah,{onClick:E,style:{cursor:"pointer",marginLeft:"8px",position:"relative",zIndex:"100",color:`${g?"#999":"transparent"}`},children:z.operationModes.close}):null,y==="password"?t.jsx(RB,{onClick:T,children:k?z.input.password.hide:z.input.password.show}):null]}),S&&t.jsx(NB,{alignment:v,style:C,size:c,children:b.map((N,G)=>t.jsxs(FB,{onClick:N.onClick,disabled:N.disabled,color:N.color||"primary",className:N.className,style:N.style,isFirst:G===0,isLast:G===b.length-1,size:c,children:[N.icon&&t.jsx($B,{children:N.icon}),t.jsx("span",{children:N.name})]},`btn-${G}`))})]}),p===!1&&h&&t.jsx(LB,{children:Array.isArray(h)?h.map((N,G)=>t.jsx(ch,{show:!0,children:N},G)):t.jsx(ch,{show:!0,children:h})})]})},kB=l.span`
  color: red;
  svg {
    font-size: 0.8em;
  }
  padding-left: 8px;
`,TB=l.div`
  position: relative;
  ${e=>e.marginBottom&&`
    margin-bottom: 1em;
  `}
`,PB=l.div`
  display: flex;
`,DB=l.div`
  display: flex;
  width: 100%;
`,ah=l.div`
  display: flex;
  align-items: center;
  justify-content: center;
  height: 2em;
  width: 1.6em;
  svg {
    font-size: 18px;
    color: #999;
  }
`,$B=l.span`
  display: flex;
  align-items: center;
  margin-right: 6px;
`,RB=l.div`
  display: flex;
  width: 2em;
  justify-content: center;
  align-items: center;
  cursor: pointer;
`,NB=l.div`
  display: flex;
  align-items: ${e=>{switch(e.alignment){case"start":return"flex-start";case"stretch":return"stretch";case"end":default:return"flex-end"}}};
  
  /* ${e=>{switch(e.size){case"small":return"height: 2.4em;";case"medium":return"height: 2.6em;";case"large":return"height: 2.2em;";default:return"height: 2.3em;"}}} */
`,OB=l.div.attrs(()=>({tabIndex:0}))`
  display: flex;
  align-items: center;
  gap: 4px;
  color: rgb(51, 51, 51);
  border: 1px solid #ccc;
  border-radius: ${e=>e.hasButtons?"4px 0 0 4px":"4px"};
  
  &:focus-within {
    ${e=>e.disabled||e.readOnly?null:`
    outline: 2px solid #6b93ff;
    `}
  }
  
  padding: 0 2px;
  height: 2em;
  width: 100%;
  max-width: ${e=>e.search?"280px":null};
  position: relative;
  background: ${e=>e.bgColor||"white"};
  transition: all 0.3s ease, width 0.300ms linear;

  /* Para Chrome, Safari y Opera */
  input[type="number"]::-webkit-inner-spin-button, 
  input[type="number"]::-webkit-outer-spin-button { 
    -webkit-appearance: none;
    margin: 0;
  }

  input[type="date"] {
    width: min-content !important;
  }

  border: ${e=>e.validate===!0?"1px solid #00c853":e.validate===!1?"1px solid #ff3547":"1px solid #ccc"};
  
  ${e=>e.disabled&&`
    background-color: #f8f8f8;
    color: #999;
  `}
  
  ${e=>{switch(e.themeColor){case"success":return`
          color: var(--color-success-dark);
          background-color: var(--color-success-light);
          font-weight: 600;
        `;case"danger":return`
          color: var(--color-danger-dark);
          background-color: var(--color-danger-light);
          font-weight: 600;
        `;default:return""}}}
  
  ${e=>{switch(e.size){case"small":return`   
          height: 2.4em;
          font-size: 12px;  
        `;case"medium":return`
          height: 2.6em;
          font-size: 14px;
        `;case"large":return`
          height: 2.2em;
          font-size: 16px;
        `;default:return`
          height: 2.3em;
          font-size: 14px;
          padding: 0 8px;
        `}}}
`,MB=l.input`
  border: none;
  outline: none;
  flex: 1;
  padding: 0 4px;
  font-size: 16px;
  height: 100%;
  color: inherit;
  font-weight: inherit;
  width: 100%;
  
  :read-only {
    background-color: #f8f8f8;
  }
  
  ::-webkit-calendar-picker-indicator {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
    z-index: 1;
  }
  
  &::placeholder {
    color: #999;
  }
  
  background-color: transparent;
  
  ${e=>e.disabled&&`
    background-color: transparent;
  `}
`,FB=l.button`
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 12px;
  border: none;
  cursor: pointer;
  white-space: nowrap;
  font-weight: 500;
  transition: background-color 0.2s ease, color 0.2s ease;
  height: 100%;
  
  /* Bordes redondeados según posición */
  border-radius: ${e=>e.isFirst&&e.isLast?"0 4px 4px 0":e.isFirst?"0":e.isLast?"0 4px 4px 0":"0"};
  
  /* Separación entre botones */
  border-left: ${e=>e.isFirst?"none":"1px solid rgba(0,0,0,0.1)"};
  
  /* Tamaño del texto según el tamaño del input */
  ${e=>{switch(e.size){case"small":return"font-size: 12px;";case"medium":return"font-size: 14px;";case"large":return"font-size: 16px;";default:return"font-size: 14px;"}}}
  
  /* Estilos según el color */
  ${e=>{switch(e.color){case"primary":return`
          background: #2196f3;
          color: white;
          &:hover:not(:disabled) { background: #1976d2; }
          &:disabled { background: #bbdefb; cursor: not-allowed; }
        `;case"secondary":return`
          background: #757575;
          color: white;
          &:hover:not(:disabled) { background: #616161; }
          &:disabled { background: #bdbdbd; cursor: not-allowed; }
        `;case"success":return`
          background: #4caf50;
          color: white;
          &:hover:not(:disabled) { background: #388e3c; }
          &:disabled { background: #a5d6a7; cursor: not-allowed; }
        `;case"danger":return`
          background: #f44336;
          color: white;
          &:hover:not(:disabled) { background: #d32f2f; }
          &:disabled { background: #ef9a9a; cursor: not-allowed; }
        `;case"warning":return`
          background: #ff9800;
          color: white;
          &:hover:not(:disabled) { background: #f57c00; }
          &:disabled { background: #ffe0b2; cursor: not-allowed; }
        `;case"info":return`
          background: #00bcd4;
          color: white;
          &:hover:not(:disabled) { background: #0097a7; }
          &:disabled { background: #b2ebf2; cursor: not-allowed; }
        `;case"light":return`
          background: #f5f5f5;
          color: #333;
          &:hover:not(:disabled) { background: #e0e0e0; }
          &:disabled { background: #fafafa; color: #999; cursor: not-allowed; }
        `;case"dark":return`
          background: #212121;
          color: white;
          &:hover:not(:disabled) { background: #000; }
          &:disabled { background: #757575; cursor: not-allowed; }
        `;default:return`
          background: #f5f5f5;
          color: #333;
          &:hover:not(:disabled) { background: #e0e0e0; }
          &:disabled { background: #fafafa; color: #999; cursor: not-allowed; }
        `}}}
`,BB=l.label`
  font-size: 13px;
  color: var(--Gray5);
  margin-bottom: 4px;
  
  ${e=>{switch(e.labelVariant){case"primary":return`
          font-size: 11px;
          color: var(--Gray5);
          position: absolute;
          z-index: 1;
          background-color: white;
          padding: 0 4px;
          top: -5px;
          line-height: 1;
          height: min-content;
          color: #353535;
          font-weight: 600;
          ::after {
            content: ' :';
          }
        `;case"label1":return`
          font-size: 14px;
          color: var(--Gray5);
          margin-bottom: 4px;
        `;case"label2":return`
          font-size: 16px;
          color: black;
          margin-bottom: 10px;
          display: block;
        `;case"label3":return`
          font-size: 12px;
          line-height: 12px;
          display: flex;
          font-weight: 500;
          color: black;
          min-width: 2em;
          height: 1em;
          padding: 0em 0em 0em 0.4em;
          align-items: end;
        `;default:return`
          font-size: 13px;
          color: var(--Gray5);
          margin-bottom: 4px;
        `}}}
`,LB=l.ul`
  display: grid;
  gap: 2px;
  margin-top: 4px;
  padding: 0;
  margin-bottom: 4px;
  list-style-type: circle !important;
  list-style-position: inside !important;
  background-color: var(--color-danger-light);
  border-radius: var(--border-radius-light);
`,ch=l.li`
  color: #ff3547;
  font-size: 14px;
  margin-left: 8px;
  display: ${e=>e.show?"inline":"hidden"};
  
  ::before {
    content: '• ';
    font-size: large;
    color: #ff3547;
    font-weight: bold;
    height: 100%;
  }
`;l(Dt)`

`;const zB=({side:e="left",searchData:n,setSearchData:s})=>{D(q),W();const{EXPENSES_CATEGORY:o}=re.EXPENSES_TERM,r=vt(o),{configureAddExpenseCategoryModal:i}=ai();return r&&t.jsx(UB,{children:e==="right"&&t.jsx(WB,{children:t.jsx(ke,{title:"Categoría",startIcon:z.operationModes.add,onClick:i})})})},UB=l.div`

`,WB=l.div`
  display: flex;
  align-items: center;
  gap: 0.4em;
 
`,qB=({side:e="left",searchData:n,setSearchData:s})=>{Fe();const{EXPENSES_LIST:o,EXPENSES_CREATE:r}=re.EXPENSES_TERM,i=vt(o),a=W(),c=()=>{a(ky()),a(Ua({mode:"add"})),a(Ry())},d=()=>{a($y())};return i&&t.jsx(VB,{children:e==="right"&&t.jsxs(GB,{children:[t.jsx(ke,{title:"Ver Reporte",onClick:d}),"                            ",t.jsx(ke,{title:"Gasto",startIcon:z.operationModes.add,onClick:c})]})})},VB=l.div`

`,GB=l.div`
  display: flex;
  align-items: center;
  gap: 0.4em;
 
`,_B=({side:e="left"})=>{const n=W(),o=_t().pathname,r={users:{leftSide:()=>null,rightSide:()=>t.jsx(U,{onClick:()=>n(ri({isOpen:!0})),icon:z.operationModes.add,children:"Usuario"})},billing:{leftSide:()=>null,rightSide:()=>null},business:{leftSide:()=>null,rightSide:()=>null},"tax-receipt":{leftSide:()=>null,rightSide:()=>null},"app-info":{leftSide:()=>null,rightSide:()=>null}},a=o.includes("users")?"users":o.includes("business")?"business":o.includes("tax-receipt")?"tax-receipt":o.includes("app-info")?"app-info":"billing",c=()=>{const d=r[a];return d?e==="left"?d.leftSide():d.rightSide():null};return t.jsx(HB,{children:c()})},HB=l.div`
  display: flex;
  align-items: center;
  gap: 12px;
`,QB=async(e,n)=>{const s=En(),o=le($,"businesses",e.businessID,"warehouses"),r=F(o,s);try{return await De(r,{...n,id:s,createdAt:de(),number:await Mt(e,"lastWarehouseId"),createdBy:e.uid,updatedAt:de(),updatedBy:e.uid}),n}catch(i){throw console.error("Error al crear el almacén:",i),i}},YB=(e,n)=>{const s=le($,"businesses",e.businessID,"warehouses");return Te(s,o=>{const r=o.docs.map(i=>i.data()).filter(i=>i.isDeleted!==!0);n(r)},o=>console.error("Error al obtener documentos en tiempo real:",o))},KB=async(e,n,s)=>{const o=F($,"businesses",e.businessID,"warehouses",n);try{return await je(o,{...s,updatedAt:de(),updatedBy:e.uid}),s}catch(r){throw console.error("Error al actualizar el almacén:",r),r}},JB=async(e,n)=>{const s=F($,"businesses",e.businessID,"warehouses",n);try{return await je(s,{isDeleted:!0,deletedAt:de(),deletedBy:e.uid}),n}catch(o){throw console.error("Error al borrar el almacén:",o),o}},Oc=async e=>{const n=le($,"businesses",e.businessID,"warehouses"),s=he(n,te("defaultWarehouse","==",!0));try{const o=await Me(s);if(o.empty){const r=En(),i=F(n,r),a={id:r,name:"Almacen Virtual",description:"Almacén por defecto para compras",shortName:"Virtual",number:await Mt(e,"lastWarehouseId"),owner:e.uid,location:"default",address:"default address",dimension:{length:0,width:0,height:0},capacity:0,defaultWarehouse:!0,createdAt:de(),createdBy:e.uid,updatedAt:de(),updatedBy:e.uid};return await De(i,a),a}else return o.docs[0].data()}catch(o){throw console.error("Error al crear el almacén por defecto:",o),o}},ap=()=>{const e=D(q),[n,s]=m.useState(null),[o,r]=m.useState(!0),[i,a]=m.useState(null);return m.useEffect(()=>{e&&(async()=>{try{r(!0);const d=await Oc(e);s(d)}catch(d){a(d)}finally{r(!1)}})()},[e]),{defaultWarehouse:n,loading:o,error:i}},{Button:XB,Input:ao,InputNumber:Pi,Form:Jt,Spin:ZB,Modal:e4}=Ne,t4=l.p`
  color: #888;
  margin-bottom: 20px;
`,n4=l(Jt)`
  display: flex;
  flex-direction: column;
`,s4=l(XB)`
  width: 100%;
  background-color: #1890ff;
  color: white;
  &:hover {
    background-color: #40a9ff;
  }
`;function Pv(){const e=W(),n=D(q),{isOpen:s,formData:o,loading:r,error:i}=D(TN),[a]=Jt.useForm();m.useEffect(()=>{s&&(o?a.setFieldsValue({...o,dimension:o.dimension||{length:0,width:0,height:0},capacity:o.capacity||0}):a.resetFields())},[s,o,a]);const c=async()=>{var d,u,p;try{await a.validateFields();let h=a.getFieldsValue();h={name:h.name||"",shortName:h.shortName||"",description:h.description||"",owner:h.owner||"",location:h.location||"",address:h.address||"",dimension:{length:((d=h.dimension)==null?void 0:d.length)||0,width:((u=h.dimension)==null?void 0:u.width)||0,height:((p=h.dimension)==null?void 0:p.height)||0},capacity:h.capacity||0},e(Lm(!0)),o&&o.id?await KB(n,o.id,h):await QB(n,h),e(Bm()),V.success(`Almacén ${o?"actualizado":"creado"} correctamente`)}catch(h){V.error("Ocurrió un error al procesar la solicitud."),e(AN(h.message)),console.error("Ocurrió un error al procesar la solicitud.",h)}finally{e(Lm(!1))}};return t.jsx(e4,{title:o&&o.id?"Actualizar Información del Almacén":"Información del Almacén",open:s,onCancel:()=>e(Bm()),footer:null,children:t.jsxs(ZB,{size:"large",spinning:r,tip:o&&o.id?"Actualizando almacén...":"Creando almacén...",children:[t.jsx(t4,{children:o&&o.id?"Actualiza los detalles del almacén":"Introduce los detalles del nuevo almacén"}),t.jsxs(n4,{form:a,onFinish:c,layout:"vertical",children:[t.jsx(Jt.Item,{label:"Nombre",name:"name",rules:[{required:!0,message:"Por favor ingresa el nombre"}],children:t.jsx(ao,{})}),t.jsx(Jt.Item,{label:"Nombre Corto",rules:[{required:!0,message:"Por favor ingresa el nombre corto"}],name:"shortName",children:t.jsx(ao,{})}),t.jsx(Jt.Item,{label:"Descripción",name:"description",children:t.jsx(ao.TextArea,{rows:3})}),t.jsx(Jt.Item,{label:"Propietario",name:"owner",children:t.jsx(ao,{})}),t.jsx(Jt.Item,{label:"Ubicación",name:"location",rules:[{required:!0,message:"Por favor ingresa la ubicación"}],children:t.jsx(ao,{})}),t.jsx(Jt.Item,{label:"Dirección",name:"address",children:t.jsx(ao,{})}),t.jsxs(o4,{children:[t.jsx(Jt.Item,{label:"Longitud",name:["dimension","length"],children:t.jsx(Pi,{style:{width:"100%"},min:0,placeholder:"Longitud"})}),t.jsx(Jt.Item,{label:"Ancho",name:["dimension","width"],children:t.jsx(Pi,{style:{width:"100%"},min:0,placeholder:"Ancho"})}),t.jsx(Jt.Item,{label:"Altura",name:["dimension","height"],children:t.jsx(Pi,{style:{width:"100%"},min:0,placeholder:"Altura"})})]}),t.jsx(Jt.Item,{label:"Capacidad (m³)",name:"capacity",children:t.jsx(Pi,{min:0})}),t.jsx(s4,{type:"primary",htmlType:"submit",children:o&&o.id?"Actualizar":"Enviar"})]})]})})}const o4=l.div`
  display: grid;
  gap: 0.6em;
  grid-template-columns: repeat(3, 1fr);
  input[type="number"] {
    width: 100% !important;
    max-width: none !important;
  }
`,r4=({side:e="left"})=>{const[n,s]=m.useState(!1),o=W(),{pathname:r}=_t(),{INSURANCE_CREATE:i,INSURANCE_CONFIG:a}=re.INSURANCE_TERM,c=vt(a),d=()=>{o(iv(null))};return c&&t.jsx(m.Fragment,{children:t.jsx(i4,{children:e==="right"&&t.jsx(a4,{children:t.jsx(ke,{tooltipDescription:"Agregar almacén",tooltipPlacement:"bottom-end",startIcon:z.operationModes.add,borderRadius:"normal",title:"Seguro",onClick:d})})})})},i4=l.div`

`,a4=l.div`
  display: flex;
  align-items: center;
  gap: 0.4em;
 
`,Hs=({textAlign:e,children:n})=>t.jsx(c4,{textAlign:e,children:n}),c4=l.div`
  width: 100%;
    display: flex;
    justify-content: ${e=>e.textAlign};
  `,ws=({cols:e,space:n,children:s})=>t.jsx(d4,{cols:e,space:n,children:s}),l4={true:"padding: 0.4em 0;",false:""},lh={3:"grid-template-columns: 1fr 0.8fr 0.8fr;",default:"grid-template-columns: 1fr;"},d4=l.div`
   display: grid;
  align-items: center;
  gap: 0.4em;
  ${({space:e})=>l4[e]}
  ${({cols:e})=>lh[e]||lh.default}
  `,u4=({data:e})=>{const{products:n,NCF:s}=e,{taxReceipt:o}=D(zt),r=({name:i,measurement:a,footer:c})=>`${i}${a?` Medida: [${a}]`:""}${c?` Pie: [${c}]`:""}`;return t.jsx(p4,{children:t.jsx(m4,{children:(n==null?void 0:n.length)>0?n==null?void 0:n.map((i,a)=>{var c,d,u,p,h,f;return t.jsxs(h4,{children:[t.jsxs(ws,{cols:"3",children:[t.jsx(Hs,{children:(c=i==null?void 0:i.weightDetail)!=null&&c.isSoldByWeight?t.jsxs("div",{children:[(d=i==null?void 0:i.weightDetail)==null?void 0:d.weight," ",(u=i==null?void 0:i.weightDetail)==null?void 0:u.weightUnit," X ",Y(tt(Ks(i),o==null?void 0:o.enabled))]}):t.jsxs("div",{children:[(i==null?void 0:i.amountToBuy)||0," x ",ct(tt(Ks(i),o==null?void 0:o.enabled))]})}),t.jsx(Hs,{textAlign:"right",children:ct(Xn(i,s))}),t.jsx(Hs,{textAlign:"right",children:ct(tt(i,s))})]}),t.jsx(ws,{children:t.jsxs(g4,{children:[r(i)," "]})}),((p=i==null?void 0:i.warranty)==null?void 0:p.status)&&t.jsxs(ws,{children:[Ec((h=i==null?void 0:i.warranty)==null?void 0:h.quantity,(f=i==null?void 0:i.warranty)==null?void 0:f.unit)," de Garantía"]})]},a)}):null})})},p4=l.div`
 
`,m4=l.div`
      display: block;
    border: none;
    padding: 0;
    list-style: none;
    line-height: 22px;
`,h4=l.div`
    width: 100%;

    &:nth-child(1n) {
            border-bottom: 1px dashed black;
        }

        &:last-child {
            border-bottom: none;
        }
`,g4=l.div`
        width: 100%;
        grid-column: 1 / 4;
        line-height: 1.4pc;
        text-transform: capitalize;
     
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        //white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
`;function f4(e,n,s){if(!e||!n||n==="GC-0000")return s(0),()=>{};const o=le($,`businesses/${e}/accountsReceivable`),r=he(o,te("clientId","==",n));try{return Te(r,a=>{if(a.empty){s(0);return}let c=0;a.forEach(d=>{const u=d.data();c+=Number(u.arBalance)||0}),s(c)})}catch(i){return console.error("Error getting documents: ",i),s(0),()=>{}}}function Ho(e,n,s=null){const[o,r]=m.useState(0),i=m.useCallback(a=>{r(c=>c===a?c:(s&&typeof s=="function"&&s(a),a))},[s]);return m.useEffect(()=>{if(!e||!n||n==="GC-0000"){r(0),s&&s(0);return}const a=f4(e,n,i);return()=>a()},[e,n,i]),o}const x4=l.div`
    width: 100%;
    margin: 0;
    padding: 3mm; 
    line-height: 20px;
    width: 100vw;
    font-size: 11px;
    text-transform: uppercase;
    font-family: 'Lato', sans-serif;
    pointer-events: none;
    p {
        line-height: 16px;
    }
    @media print {
        margin: 0;
        
        pointer-events: auto;
    }
`,b4=l.div`
    display: ${({ignoreHidden:e})=>!e&&"none"};
`;l.p`
    font-size: 18px;
    font-weight: 600;
    padding: 0.2em 0;
    text-align: center;
    margin: 0;
`;function Xt({label:e,value:n,align:s="left",textTransform:o="",justifyContent:r=""}){return t.jsxs(y4,{textTransform:o,justifyContent:r,children:[e&&t.jsxs(Mc,{align:s,children:[e," ",n&&": "]}),n&&t.jsx("span",{children:n})]})}const y4=l.div`
    display: flex;
    gap: 12px;
    text-transform: ${e=>e.textTransform};
    justify-content: ${e=>e.justifyContent};
`,Oo=l.p`
    display: flex;
    font-weight: 600;
    line-height: 12px;
    padding: 0;
    margin: 0;
    white-space: nowrap;
    
    justify-content: ${({align:e})=>e};
`,Mc=l.p`
    margin: 0;
    padding: 0.2em 0;
    text-transform: uppercase;
    ${({align:e})=>{switch(e){case"center":return"text-align: center;";case"right":return"text-align: right;";default:return"text-align: left;"}}}
`;l.div`
    border: none;
    border-top: 1px dashed black;
`;const Mo=l.div`
    margin-bottom: 0.8em;
    ${({size:e})=>{switch(e){case"small":return"margin-bottom: 0.2em;";case"medium":return"margin-bottom: 0.8em;";case"large":return"margin-bottom: 1.6em;";default:return"margin-bottom: 0.8em;"}}}
`,qa={Container:x4,HiddenPrintWrapper:b4},v4=({data:e})=>{var h,f,x,g,y,b,v,C,I,j;const[n,s]=m.useState(0),o=D(q),r=o==null?void 0:o.businessID,i=(h=e==null?void 0:e.client)==null?void 0:h.id,a=Nn((e==null?void 0:e.products)||[])+$s((e==null?void 0:e.products)||[]),c=is(a,((f=e==null?void 0:e.discount)==null?void 0:f.value)||0),d=k=>Y(k,"");Ho(r,i,s);const u={cash:"Efectivo",card:"Tarjeta",transfer:"Tranferencia"},p=[{label:"ENVIO",value1:null,value2:d((x=e==null?void 0:e.delivery)==null?void 0:x.value),condition:(g=e==null?void 0:e.delivery)==null?void 0:g.status},{label:"SUBTOTAL",value2:d(a),condition:!0},{label:"DESCUENTO",value2:d(c),condition:c>0},...((y=e==null?void 0:e.paymentMethod)==null?void 0:y.filter(k=>(k==null?void 0:k.status)===!0).map(k=>({label:u[k==null?void 0:k.method],value2:d(k==null?void 0:k.value),condition:!0})))||[],{subtitle:"TOTAL",value1:d((b=e==null?void 0:e.totalTaxes)==null?void 0:b.value),value2:d((v=e==null?void 0:e.totalPurchase)==null?void 0:v.value),condition:!0,spacingEnd:!0,spacingStart:!0},{label:((C=e==null?void 0:e.change)==null?void 0:C.value)>=0?"CAMBIO":"FALTANTE",value2:d((I=e==null?void 0:e.change)==null?void 0:I.value),condition:!0},{label:"BALANCE ACTUAL",value2:d(n),condition:((j=e==null?void 0:e.change)==null?void 0:j.value)<0}];return t.jsx(C4,{children:p.map((k,A)=>t.jsx(j4,{row:k},A))})},j4=({row:{subtitle:e,label:n,value1:s,value2:o,condition:r,textAlign:i,spacingEnd:a,spacingStart:c,line:d}})=>t.jsxs(m.Fragment,{children:[c&&t.jsx(Mo,{}),r&&t.jsxs(ws,{cols:"3",children:[e&&t.jsxs(Es,{children:[e," : "]}),n&&t.jsxs(Mc,{children:[n," : "]}),t.jsx(Hs,{textAlign:i||"right",children:s}),e?t.jsx(Oo,{align:i||"right",children:o}):t.jsx(Hs,{textAlign:i||"right",children:o})]}),a&&t.jsx(Mo,{}),d&&t.jsx(vs,{})]}),C4=l.div`
padding-top: 0.6em;
`,Dn=(e="",n=null)=>{var c;e.replace(/[^\d+]/g,"");const s=e.split(/[,;.\s]+/).filter(d=>d.replace(/\D/g,"").length>0),o=(c=s[0])==null?void 0:c.replace(/\D/g,"").length,r=s.every(d=>d.replace(/\D/g,"").length===o);if(s.length>1&&!r)return s.join(" / ");const i=d=>{var p;const u=d.replace(/\D/g,"");if(u.length>10&&d.startsWith("+")){const h=(p=d.match(/\+(\d+)/))==null?void 0:p[1],f=u.slice(h.length);return`+${h} (${f.substring(0,3)}) ${f.substring(3,6)}-${f.substring(6)}`}return u.length===10?`(${u.substring(0,3)}) ${u.substring(3,6)}-${u.substring(6)}`:u.length===11?`+${u[0]} (${u.substring(1,4)}) ${u.substring(4,7)}-${u.substring(7)}`:d},a=s.map(i);return a.length>1?a.join(" / "):a[0]||e},Dv=({data:e,Space:n})=>{var r,i,a,c,d,u,p,h;let s=D(ft)||"";const o=e!=null&&e.date?Ve.convertMillisToISODate(Ve.convertTimestampToMillis(e.date),"dd/MM/yyyy HH:mm"):ce.now().toFormat("dd/MM/yyyy HH:mm");return t.jsxs(w4,{children:[t.jsx(S4,{children:s==null?void 0:s.name}),t.jsx(Xt,{align:"center",label:s==null?void 0:s.address,justifyContent:"center"}),t.jsx(Xt,{align:"center",label:Dn(s==null?void 0:s.tel),justifyContent:"center"}),t.jsx(Mo,{size:"large"}),t.jsx(Xt,{label:"Fecha",value:o}),(e==null?void 0:e.NCF)&&t.jsx(Xt,{label:"NCF",value:e==null?void 0:e.NCF}),t.jsx(Mo,{}),(e==null?void 0:e.client)&&t.jsxs("div",{children:[t.jsx(Xt,{label:"CLIENTE",value:((i=(r=e==null?void 0:e.client)==null?void 0:r.name)==null?void 0:i.toUpperCase())||"CLIENTE GENERICO"}),((a=e==null?void 0:e.client)==null?void 0:a.personalID)&&t.jsx(Xt,{label:"CEDULA/RNC",value:(c=e==null?void 0:e.client)==null?void 0:c.personalID}),((d=e==null?void 0:e.client)==null?void 0:d.tel)&&t.jsx(Xt,{label:"TEL",value:Dn((u=e==null?void 0:e.client)==null?void 0:u.tel)}),((p=e==null?void 0:e.client)==null?void 0:p.address)&&t.jsx(Xt,{label:"DIR",value:(h=e==null?void 0:e.client)==null?void 0:h.address})]})]})},w4=l.div`
    margin-top: 1em;
    margin-bottom: 0.6em;
`,S4=l.p`
    font-size: 16px;
    font-weight: 600;
    padding: 0.2em 0;
    text-align: center;
    margin: 0;
    
`;l.div`
    display: flex;
    gap: 12px;
`;const I4=({data:e})=>{var s;if((s=e==null?void 0:e.products)==null?void 0:s.some(o=>{var r;return(r=o==null?void 0:o.warranty)==null?void 0:r.status}))return t.jsxs(E4,{children:[t.jsxs("div",{children:[t.jsx(dh,{}),t.jsx(uh,{children:"Despachado por"})]}),t.jsxs("div",{children:[t.jsx(dh,{}),t.jsx(uh,{children:"Recibido por"})]})]})},E4=l.div`
  display: grid;
  gap: 2em;
  padding: 0 0.4em;
  margin-top: 2.5em;
`,dh=l.div`
  width: 100%;
  border-bottom: 1px solid black;
  padding: 0 10px;
`,uh=l.span`
  font-size: 14px;
  color: #333;
`,A4=({message:e})=>e?t.jsx(k4,{children:t.jsx(T4,{children:e})}):null,k4=l.div`
  /* display: flex;
  justify-content: center;
  align-items: center; */
  text-align: center;
  margin-top: 1em;
`,T4=l.p`
  font-size: 12px;
  line-height: 1.6;
  color: #333;
  margin: 0;
`,P4=st.forwardRef(({data:e,ignoreHidden:n},s)=>{var a,c;const o=D(ft)||"";function r(d){if(!d)return{type:"Desconocido",description:"RECIBO  DE PAGO"};const u=/(B0\d)/,p=d.match(u),h={B01:{type:"Crédito Fiscal",description:"FACTURA PARA CREDITO FISCAL"},B02:{type:"Consumidor Final",description:"FACTURA PARA CONUMIDOR FINAL"}};return p&&p[0]&&h[p[0]]?h[p[0]]:{type:"Desconocido",description:"RECIBO DE PAGO"}}const i=(a=r(e==null?void 0:e.NCF))==null?void 0:a.description;return e?t.jsx(qa.HiddenPrintWrapper,{ignoreHidden:n,children:t.jsxs(qa.Container,{ref:s,children:[t.jsx(Dv,{data:e,Space:ph,SubTitle:Es,P:tr}),t.jsx(ph,{}),t.jsx(vs,{}),t.jsx(ws,{space:!0,children:t.jsxs(Es,{align:"center",children:[" ",i]})}),t.jsx(vs,{}),t.jsxs(ws,{cols:"3",space:!0,children:[t.jsx(tr,{children:"DESCRIPCION"}),t.jsx(tr,{align:"right",children:"ITBIS"}),t.jsx(tr,{align:"right",children:"VALOR"})]}),t.jsx(vs,{}),t.jsx(u4,{data:e}),t.jsx(vs,{}),t.jsx(v4,{P:tr,data:e}),t.jsx(I4,{data:e}),t.jsx(A4,{message:(c=o==null?void 0:o.invoice)==null?void 0:c.invoiceMessage})]})}):null}),Es=l.p`
    font-weight: 600;
    line-height: 12px;
    padding: 0 0;
    margin: 0;
    white-space: nowrap;
    
    ${e=>{switch(e.align){case"center":return"text-align: center;";case"right":return"text-align: right;";default:return"text-align: left;"}}}
`,tr=l.p`
   
    margin: 0;
    padding: 0.2em 0;
    text-transform: uppercase;
    ${e=>{switch(e.align){case"center":return"text-align: center;";case"right":return"text-align: right;";default:return"text-align: left;"}}}
   
`,vs=l.div`
    border: none;
    border-top: 1px dashed black;
`,ph=l.div`
 margin-bottom: 0.6em;
 ${e=>{switch(e.size){case"small":return"margin-bottom: 0.2em;";case"medium":return"margin-bottom: 0.8em;";case"large":return"margin-bottom: 1.6em;";default:return"margin-bottom: 0.8em;"}}}

`,mh=[{valor:"asc",etiqueta:"Ascendente"},{valor:"desc",etiqueta:"Descendente"}],Di=[{valor:"ascNum",etiqueta:"Ascendente"},{valor:"descNum",etiqueta:"Descendente"}],D4=[{valor:!0,etiqueta:"Sí"},{valor:!1,etiqueta:"No"}],hh={nombre:mh,stock:Di,inventariable:D4,categoria:mh,costo:Di,precio:Di,impuesto:Di},$4=[{valor:"nombre",etiqueta:"Nombre del Producto"},{valor:"stock",etiqueta:"Stock"},{valor:"inventariable",etiqueta:"Inventariable"},{valor:"categoria",etiqueta:"Categoría"},{valor:"costo",etiqueta:"Costo"},{valor:"precio",etiqueta:"Precio"},{valor:"impuesto",etiqueta:"Impuesto"}],R4=[{valor:"todos",etiqueta:"Todos"},{valor:"si",etiqueta:"Sí"},{valor:"no",etiqueta:"No"}],N4=[{valor:"todos",etiqueta:"Todos"},{valor:"0.18",etiqueta:"18%"},{valor:"0.16",etiqueta:"16%"},{valor:"0",etiqueta:"Exento"}],O4=({onClose:e})=>t.jsxs(M4,{children:[t.jsx(nt,{value:"Filtrar y Ordenar Productos",type:"title",size:"medium"}),t.jsx(ke,{title:z.operationModes.close,onClick:e})]}),M4=l.div`
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding:  0.4em;
`;l.div``;const{Radio:$i,Space:gh}=Ne,F4=({Group:e,Label:n})=>{const s=D(Eb),o=D(Ab),r=W(),i=c=>{r(w2(c))},a=c=>{r(C2(c))};return t.jsxs(B4,{children:[t.jsxs(fh,{children:[t.jsx(Es,{children:"Inventariable:"}),t.jsx($i.Group,{onChange:c=>a(c.target.value),value:s,style:{width:"100%"},buttonStyle:"solid",children:t.jsx(gh,{direction:"vertical",style:{width:"100%"},children:R4.map((c,d)=>t.jsx($i.Button,{style:{width:"100%"},value:c.valor,children:c.etiqueta},d))})})]}),t.jsxs(fh,{children:[t.jsx(Es,{children:"ITBIS:"}),t.jsx($i.Group,{onChange:c=>i(c.target.value),value:o,style:{width:"100%"},buttonStyle:"solid",children:t.jsx(gh,{direction:"vertical",style:{width:"100%"},children:N4.map((c,d)=>t.jsx($i.Button,{style:{width:"100%"},value:c.valor,children:c.etiqueta},d))})})]})]})},B4=l.div`
    display: grid;
    gap: 1.8em;
    overflow: hidden;
    
`,fh=l.div`
    display: grid;
    gap: 0.5em;
    width: 100%;
    align-items: center;
`,{Radio:Ri,Space:L4}=Ne,z4=({Label:e,Group:n})=>{var u;const[s,o]=m.useState(!1),r=W(),i=D(Sb),a=D(Ib),c=p=>{r(v2(p)),o(!0)},d=p=>{r(j2(p))};return m.useEffect(()=>{s&&(d({nombre:"asc",categoria:"asc",stock:"ascNum",impuesto:"ascNum",costo:"ascNum",precio:"ascNum",inventariable:!0}[i]),o(!1))},[i,s]),t.jsxs(U4,{children:[t.jsxs(xh,{children:[t.jsx(Es,{children:"Ordenar por:"}),t.jsx(Ri.Group,{onChange:p=>c(p.target.value),value:i,style:{width:"100%"},buttonStyle:"solid",children:t.jsx(L4,{direction:"vertical",style:{width:"100%"},children:$4.map((p,h)=>t.jsx(Ri.Button,{style:{width:"100%"},value:p.valor,children:p.etiqueta},h))})})]}),t.jsxs(xh,{children:[t.jsx(Es,{children:"Orden:"}),t.jsx(Ri.Group,{buttonStyle:"solid",onChange:p=>d(p.target.value),value:a,style:{width:"100%"},children:((u=hh[i||"asc"])==null?void 0:u.length)>0&&hh[i||"asc"].map((p,h)=>t.jsx(Ri.Button,{value:p.valor,children:p.etiqueta},h))})]})]})},U4=l.div`
    display: grid;
    gap: 1.8em;
    overflow: hidden;
    
`,xh=l.div`
    display: grid;
    gap: 0.5em;
    width: 100%;
    align-items: center;
`,W4=({})=>{const[e,n]=m.useState("ordenar");return t.jsxs(q4,{children:[t.jsxs(V4,{children:[t.jsx(Es,{children:"Opciones:"}),t.jsxs(hl,{fillBtn:!0,children:[t.jsxs(Ni,{selected:e==="ordenar",displayInput:"hidden",onClick:()=>n("ordenar"),children:[t.jsx("input",{type:"radio",value:"ordenar",checked:e==="ordenar",onChange:()=>n("ordenar")}),"Ordenar"]}),t.jsxs(Ni,{selected:e==="filtrar",displayInput:"hidden",onClick:()=>n("filtrar"),children:[t.jsx("input",{type:"radio",value:"filtrar",checked:e==="filtrar",onChange:()=>n("filtrar")}),"Filtrar"]})]})]}),t.jsxs(G4,{children:[e==="ordenar"&&t.jsx(z4,{Label:Ni,Group:hl}),e==="filtrar"&&t.jsx(F4,{Label:Ni,Group:hl})]})]})},q4=l.div`
    display: grid;
    grid-template-rows: min-content 1fr;
    gap: 0.6em;
    overflow: hidden;
`,V4=l.div`
    padding: 0.4em;
`,hl=l.div`
  background-color: var(--color2);
  border-radius: var(--border-radius);
  padding: 0.6em;
  display: flex;
  flex-direction: ${e=>e.column?"column":"row"};
  gap: 0.4em;
  ${e=>{if(e.fillBtn)return`
        padding: 0.2em;
            label{
                flex:1;
                justify-content: center; // Agrega esta línea
                text-align: center;
            }
        `;if(e.column||e.row)return`
            label{
                width:100%;
            }
        `}}
 
  ${e=>{switch(e.themeColor){case"primary":return`
                background-color: var(--color);
                color: var(--White);
                
            `;case"neutral":return`
                background-color: var(--color-neutral-light);
                color: var(--color-neutral-dark);
                
            `}}}
`,G4=l.div`
    overflow-y: scroll;
    height: 100%;
    padding: 1em 0.4em;
    border-top: 1px solid #ccc;
`,Ni=l.label`
    margin-right: 10px;
    display: flex;
    align-items: center;
    gap:1em;
    height: 2em;
    padding: 0 0.6em;
    background-color: ${e=>e.selected?"var(--color1)":"transparent"};
    border-radius: var(--border-radius);
    ${e=>{if(e.displayInput==="hidden")return`
            input{
                display:none;
            }
        `}}
    ${e=>{switch(e.themeColor){case"primary":return`
                background-color: var(--color1);
                color: var(--White);
            `;case"neutral":return`
                background-color: ${e.selected?"var(--color-neutral-dark)":"var(--color-neutral-light)"}};
                color: ${e.selected?"var(--White)":"var(--color-neutral-dark)"}; // Corrección aquí
            `}}}
`,zr=({icon:e,onClick:n})=>t.jsx(_4,{onClick:n,children:e}),_4=l.button`
    border: none;
    color: white;
    width: 2em;
    height: 2em;
    padding: 0;
    display: grid;
    justify-items: center;
    justify-content: center;
    align-items: center;
    border-radius: var(--border-radius);
    background-color: rgba(0, 0, 0, 0.2);
    cursor: pointer;
    svg {
        font-size: 1.2em;
    }
`,$v=()=>{W();const[e,n]=m.useState(!1),s=m.useRef(null),o=()=>{n(!e)},r={hidden:{x:"110%"},visible:{x:0,transition:{type:"spring",stiffness:120,mass:.4,damping:8,when:"beforeChildren",staggerChildren:.4}}};return kt(s,e,o),t.jsxs(H4,{children:[t.jsx(zr,{icon:z.operationModes.filter,onClick:o}),t.jsxs(Q4,{variants:r,ref:s,initial:"hidden",animate:e?"visible":"hidden",exit:"hidden",children:[t.jsx(O4,{onClose:o}),t.jsx(W4,{})]})]})},H4=l.div``,Q4=l(Ie.div)`
  position: fixed;
  top: 10px;
  z-index: 100;
  max-width: 400px;
  width: 100%;
  height: 100%;
  max-height: 90vh;
  right: 10px;
  background-color: white;
  border: 1px solid #ccc;

  border-radius: 5px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.20);
  display: grid;
  grid-template-rows: min-content 1fr;
 
  gap:1em;
  overflow: hidden;
`,Y4=({option:e,closeMenu:n})=>{const s=()=>{e!=null&&e.disabled||(e!=null&&e.action&&e.action(),e!=null&&e.closeWhenAction&&n())};return t.jsxs(K4,{onClick:s,isActive:e==null?void 0:e.isActive,disabled:e==null?void 0:e.disabled,children:[t.jsx(J4,{children:(e==null?void 0:e.icon)&&t.jsx(Z4,{disabled:e==null?void 0:e.disabled,children:e==null?void 0:e.icon})}),t.jsxs(X4,{children:[t.jsx(eL,{disabled:e==null?void 0:e.disabled,children:e==null?void 0:e.text}),(e==null?void 0:e.description)&&t.jsx(tL,{disabled:e==null?void 0:e.disabled,children:e==null?void 0:e.description})]})]})},K4=l.div`
  width: 100%;
  align-items: center;
  padding: 0.6em 1em;
  border-bottom: var(--border-primary);
  display: flex;
  cursor: ${e=>e.disabled?"not-allowed":"pointer"};
  opacity: ${e=>e.disabled?.5:1};

  :last-child {
    border-bottom: none;
  }

  &:hover {
    background-color: ${e=>e.disabled?"transparent":"#f2f2f2"};
  }

  ${e=>(e==null?void 0:e.isActive)&&!(e!=null&&e.disabled)&&`
      background-color: ${e.theme.colors.primary.bg};
      color: ${e.theme.colors.primary.text};
    `}
`,J4=l.div`
  display: flex;
  gap: 1em;
  align-items: center;
  height: 2em;
`,X4=l.div`
  display: flex;
  flex-direction: column;
  gap: 0em;
  padding-left: 1em;
`,Z4=l.div`
  width: 2.4em;
  display: grid;
  justify-content: center;
  opacity: ${e=>e.disabled?.5:1};
  svg {
    color: ${e=>e.disabled?"#999":"#3f3f3f"};
    font-size: 1.4em;
  }
`,eL=l.div`
  font-size: 14px;
  font-weight: 600;
  color: ${e=>e.disabled?"#999":"inherit"};
`,tL=l.div`
  font-size: 12px;
  line-height: 1.3;
  color: ${e=>e.disabled?"#999":"#5f5f5f"};
  margin-top: 0.2em;
`,cp=({title:e="Opciones",options:n=[],customButton:s,...o})=>{const[r,i]=m.useState(!1),a=m.useRef(null),[c,d]=m.useState(null),[u,p]=m.useState(null),{styles:h,attributes:f}=ju(c,u,{modifiers:[{name:"arrow"}]}),x=()=>{i(!r)},g=()=>{i(!1)};return kt(a,r,x),t.jsxs("div",{ref:a,children:[s?st.cloneElement(s,{onClick:x,ref:d}):t.jsx(ke,{ref:d,title:e,onClick:x,...o}),r&&t.jsx(nL,{ref:p,style:h.popper,...f.popper,children:n.map((y,b)=>t.jsx(Y4,{option:y,closeMenu:g},b))})]})},nL=l.div`
  width: 100%;
  padding: 0.2em;
  min-width: 350px;
  max-width: 400px;
  background-color: white;
  border-radius: 5px;
  box-shadow: 0 0 5px rgba(0, 0, 0, .3);

  z-index: 555;
  overflow: hidden;
`,sL=async(e,n)=>{try{const s=new xc.Workbook,o=s.addWorksheet("Plantilla");if(o.addRow(e),console.log("Columnas agregadas:",e),!o.columns||o.columns.length===0){console.error("No se han agregado columnas al archivo."),console.error(`Columnas: ${o.columns}`);return}o.columns.forEach(d=>{d.width=Math.max(...d.values.map(u=>u.toString().length))+2});const r=await s.xlsx.writeBuffer(),i=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=window.URL.createObjectURL(i),c=document.createElement("a");c.href=a,c.download=n,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(a),console.log(`Archivo de plantilla creado: ${n}`)}catch(s){throw console.error("Error al crear la plantilla:",s),s}},oL=({data:e,headerMapping:n,language:s="es"})=>{if(!(n!=null&&n[s]))return[];const o=n[s];return e.map(r=>{const i={};return Object.entries(o).forEach(([a,c])=>{let d=r[a];typeof d=="string"&&(d=d.trim()),rL(i,c,d)}),i})};function rL(e,n,s){const o=n.split(".");let r=e;for(let i=0;i<o.length-1;i++){const a=o[i];r[a]=r[a]||{},r=r[a]}r[o[o.length-1]]=s}const iL=async e=>{const n=new xc.Workbook;await n.xlsx.load(e);const s=n.worksheets[0],o=[];return s.eachRow({includeEmpty:!1},(r,i)=>{const a=r.values.slice(1);if(i===1)o.push(a);else{const c={};o[0].forEach((d,u)=>{c[d]=a[u]}),o.push(c)}}),o.shift(),o},lp={en:{"QR Code":"qrcode",Category:"category",Weight:"weightDetail.weight","Is Sold By Weight":"weightDetail.isSoldByWeight","Weight Unit":"weightDetail.weightUnit","Net Content":"netContent",Size:"size",Name:"name",Measurement:"measurement","Promotion End":"promotions.end","Promotion Active":"promotions.isActive",Discount:"promotions.discount","Promotion Start":"promotions.start",Image:"image","Is Visible":"isVisible",Order:"order",Footer:"footer",Type:"type",Tax:"pricing.tax","List Price":"pricing.listPrice","Average Price":"pricing.avgPrice",Price:"pricing.price",Cost:"pricing.cost","Minimum Price":"pricing.minPrice",Status:"status",Stock:"stock","Warranty Status":"warranty.status","Warranty Quantity":"warranty.quantity","Warranty Unit":"warranty.unit","Amount to Buy":"amountToBuy","Track Inventory":"trackInventory",Barcode:"barcode","Active Ingredients":"activeIngredients"},es:{"Código QR":"qrcode",Categoría:"category",Peso:"weightDetail.weight","Se Vende por Peso":"weightDetail.isSoldByWeight","Unidad de Peso":"weightDetail.weightUnit","Contenido Neto":"netContent",Tamaño:"size",Nombre:"name",Medición:"measurement","Fin de Promoción":"promotions.end","Promoción Activa":"promotions.isActive",Descuento:"promotions.discount","Inicio de Promoción":"promotions.start",Imagen:"image","Es Visible":"isVisible",Orden:"order","Pie de Página":"footer",Tipo:"type",Impuesto:"pricing.tax","Precio de Lista":"pricing.listPrice","Precio Promedio":"pricing.avgPrice",Precio:"pricing.price",Costo:"pricing.cost","Precio Mínimo":"pricing.minPrice",Stock:"stock","Garantía Activa":"warranty.status","Cantidad de Garantía":"warranty.quantity","Unidad de Garantía":"warranty.unit","Cantidad a Comprar":"amountToBuy","Rastreo de Inventario":"trackInventory","Código de Barras":"barcode","Principio Activo":"activeIngredients"}},bh=[{field:"name",transform:e=>e||""},{field:"image",transform:e=>e||""},{field:"category",transform:e=>e||""},{field:"pricing.cost",transform:e=>{if(e==null||e==="")return 0;const n=typeof e=="string"?e.replace(/[$€£¥₩₹₽]/g,"").replace(/\s/g,""):e,s=parseFloat(n);return isNaN(s)?0:s}},{field:"pricing.price",transform:e=>{if(e==null||e==="")return 0;const n=typeof e=="string"?e.replace(/[$€£¥₩₹₽]/g,"").replace(/\s/g,""):e,s=parseFloat(n);return isNaN(s)?0:s}},{field:"pricing.listPrice",transform:e=>{if(e==null||e==="")return 0;const n=typeof e=="string"?e.replace(/[$€£¥₩₹₽]/g,"").replace(/\s/g,""):e,s=parseFloat(n);return isNaN(s)?0:s}},{field:"pricing.avgPrice",transform:e=>{if(e==null||e==="")return 0;const n=typeof e=="string"?e.replace(/[$€£¥₩₹₽]/g,"").replace(/\s/g,""):e,s=parseFloat(n);return isNaN(s)?0:s}},{field:"pricing.minPrice",transform:e=>{if(e==null||e==="")return 0;const n=typeof e=="string"?e.replace(/[$€£¥₩₹₽]/g,"").replace(/\s/g,""):e,s=parseFloat(n);return isNaN(s)?0:s}},{field:"pricing.tax",transform:e=>{if(e==null||e==="")return"0";const n=typeof e=="string"?parseFloat(e):e;return isNaN(n)?0:`${n<1?n*100:n}`}},{field:"promotions.start",transform:e=>e||null},{field:"promotions.end",transform:e=>e||null},{field:"promotions.discount",transform:e=>{if(e==null||e==="")return 0;const n=typeof e=="string"?e.replace(/[$€£¥₩₹₽%]/g,"").replace(/\s/g,""):e,s=parseFloat(n);return isNaN(s)?0:s}},{field:"promotions.isActive",transform:e=>{var n;return["sí","yes"].includes((n=e==null?void 0:e.toString())==null?void 0:n.toLowerCase())||!1}},{field:"weightDetail.isSoldByWeight",transform:e=>{var n;return["sí","yes"].includes((n=e==null?void 0:e.toString())==null?void 0:n.toLowerCase())||!1}},{field:"weightDetail.weight",transform:e=>{if(e==null||e==="")return 0;const n=typeof e=="string"?e.replace(/[$€£¥₩₹₽]/g,"").replace(/\s/g,""):e,s=parseFloat(n);return isNaN(s)?0:s}},{field:"weightDetail.weightUnit",transform:e=>e||"lb"},{field:"warranty.status",transform:e=>{var n;return["sí","yes"].includes((n=e==null?void 0:e.toString())==null?void 0:n.toLowerCase())||!1}},{field:"warranty.quantity",transform:e=>parseInt(e)||1},{field:"warranty.unit",transform:e=>e||Uu[1].value},{field:"size",transform:e=>e||""},{field:"type",transform:e=>e||""},{field:"stock",transform:e=>parseInt(e)||0},{field:"netContent",transform:e=>e||""},{field:"amountToBuy",transform:e=>parseFloat(e)||1},{field:"createdBy",transform:e=>e||"unknown"},{field:"id",transform:e=>e||""},{field:"order",transform:e=>parseInt(e)||1},{field:"isVisible",transform:e=>{var n;return["sí","yes"].includes((n=e==null?void 0:e.toString())==null?void 0:n.toLowerCase())||!0}},{field:"footer",transform:e=>e||""},{field:"measurement",transform:e=>e||""},{field:"trackInventory",transform:e=>{var n;return["sí","yes"].includes((n=e==null?void 0:e.toString())==null?void 0:n.toLowerCase())||!0}},{field:"qrcode",transform:e=>e||""},{field:"barcode",transform:e=>e||""},{field:"activeIngredients",transform:e=>e||""}],aL=({dataMapped:e,transformConfig:n=[]})=>{const s=n.reduce((o,{field:r,transform:i,source:a})=>{var c;return typeof i=="function"&&(o[r]={transforms:((c=o[r])==null?void 0:c.transforms)||[],source:a},o[r].transforms.push(i)),o},{});return e.map(o=>{const r={...o};return Object.entries(s).forEach(([i,{transforms:a,source:c}])=>{let d;c?d=yh(o,c):d=yh(o,i),typeof d=="string"&&(d=d.trim());try{d=a.reduce((u,p)=>p(u,o),d)}catch(u){console.error(`Error transforming value for ${i}:`,u)}cL(r,i,d)}),r})};function yh(e,n){return n.split(".").reduce((s,o)=>s?s[o]:void 0,e)}function cL(e,n,s){const o=n.split(".");let r=e;for(let i=0;i<o.length-1;i++){const a=o[i];r[a]=r[a]||{},r=r[a]}r[o[o.length-1]]=s}const lL=["Categoría","Nombre","Precio de Lista","Costo","Stock","Código de Barras"],dL=["Category","Name","List Price","Cost","Stock","Barcode"],uL={Identificación:["Código QR"],Precios:["Precio Promedio","Precio Mínimo","Impuesto"],Características:["Tamaño","Peso","Se Vende por Peso","Unidad de Peso","Contenido Neto","Medición","Principio Activo"],Visualización:["Imagen","Es Visible","Orden","Pie de Página","Tipo"],Promociones:["Promoción Activa","Inicio de Promoción","Fin de Promoción","Descuento"],Inventario:["Rastreo de Inventario","Cantidad a Comprar"],Garantía:["Garantía Activa","Cantidad de Garantía","Unidad de Garantía"]},pL={Identification:["QR Code"],Pricing:["Average Price","Minimum Price","Tax"],Characteristics:["Size","Weight","Is Sold By Weight","Weight Unit","Net Content","Measurement","Active Ingredients"],Display:["Image","Is Visible","Order","Footer","Type"],Promotions:["Promotion Active","Promotion Start","Promotion End","Discount"],Inventory:["Track Inventory","Amount to Buy"],Warranty:["Warranty Status","Warranty Quantity","Warranty Unit"]},mL={es:lL,en:dL},hL={es:uL,en:pL},Rv=(e,n="es")=>{const s=e[n],o=mL[n],r=hL[n];if(!s)return{essential:[],optionalGroups:{}};const i=Object.keys(s).filter(u=>o.includes(u)),a={};Object.entries(r).forEach(([u,p])=>{a[u]=p.filter(h=>Object.keys(s).includes(h))});const c=Object.values(r).flat(),d=Object.keys(s).filter(u=>!o.includes(u)&&!c.includes(u));if(d.length>0){const u=n==="es"?"Otros":"Others";a[u]=d}return{essential:i,optionalGroups:a}},gL=(e,n="es",s=[])=>{const{essential:o}=Rv(e,n);return[...o,...s]},fL=async(e,n="en")=>{if(!e){console.error("No file selected.");return}try{const s=await e.arrayBuffer(),o=await iL(s);console.log("Datos originales leídos:",o.sort((c,d)=>c.Impuesto-d.Impuesto));const i=oL({data:o,headerMapping:lp,transformConfig:bh,language:n});return aL({dataMapped:i,transformConfig:bh})}catch(s){throw console.error("Error al importar datos de productos:",s),s}},xL=async(e="es",n=[])=>{try{const s=gL(lp,e,n);console.log("Columnas seleccionadas:",s);const o=`Plantilla_Productos_${e}.xlsx`;await sL(s,o)}catch(s){throw console.error("Error al crear la plantilla de productos:",s),s}},{Title:vh,Text:jh}=Xe,bL=({essentialFields:e,optionalGroups:n,onFieldsChange:s,language:o="es"})=>{const r=Object.values(n).flat(),[i,a]=m.useState([]),[c,d]=m.useState(!1),[u,p]=m.useState(!1);m.useEffect(()=>{s(i)},[i,s]);const h=x=>{a(x),d(!!x.length&&x.length<r.length),p(x.length===r.length)},f=x=>{a(x.target.checked?[...r]:[]),d(!1),p(x.target.checked)};return t.jsxs(yL,{children:[t.jsxs("div",{children:[t.jsx(vh,{level:5,children:"Campos esenciales"}),t.jsx(jh,{type:"secondary",children:"Los siguientes campos siempre se incluirán en la plantilla:"}),t.jsx(vL,{children:e.map(x=>t.jsx(jL,{children:x},x))})]}),t.jsx(gn,{}),t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(vh,{level:5,children:"Campos opcionales"}),t.jsx(St,{indeterminate:c,onChange:f,checked:u,children:"Seleccionar todos"})]}),t.jsx(jh,{type:"secondary",children:"Selecciona los campos adicionales que deseas incluir:"}),t.jsx(CL,{options:r.map(x=>({label:x,value:x})),value:i,onChange:h})]})]})},yL=l.div`
  margin: 20px 0;
`,vL=l.div`
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 10px 0;
`,jL=l.div`
  background-color: #f0f0f0;
  border-radius: 4px;
  padding: 4px 8px;
  font-size: 0.9em;
`,CL=l(St.Group)`
  display: flex;
  flex-direction: column;
  margin-top: 10px;
  max-height: 300px;
  overflow-y: auto;
  padding: 10px 0;
  
  .ant-checkbox-wrapper {
    margin: 5px 0;
  }
`,{Button:nr,Upload:gl,Modal:wL,message:Bn,Tabs:SL}=Ne;function IL({open:e,onClose:n,onImport:s,onCreateTemplate:o}){const[r,i]=m.useState([]),[a,c]=m.useState(!1),[d,u]=m.useState("import"),[p,h]=m.useState([]),[f]=m.useState("es"),{essential:x,optionalGroups:g}=Rv(lp,f),y=async()=>{if(r.length>0&&r[0].originFileObj){c(!0);try{await s(r[0].originFileObj),i([]),n(),Bn.success("Datos importados exitosamente")}catch(A){console.error("Error al importar datos:",A),Bn.error("Hubo un problema al importar los datos. Por favor, verifica el archivo e intenta de nuevo.")}finally{c(!1)}}else Bn.error("Por favor, selecciona un archivo válido para importar.")},b=async()=>{try{await o(f,p),Bn.success("Plantilla creada exitosamente.")}catch(A){console.error("Error al crear la plantilla:",A),Bn.error("Hubo un problema al crear la plantilla.")}},v=A=>{h(A)},C=({file:A,fileList:P})=>{i(P),A.status==="done"?Bn.success(`${A.name} se ha seleccionado correctamente.`):A.status==="error"&&Bn.error(`${A.name} no se pudo seleccionar.`)};m.useEffect(()=>{e||i([])},[e]);const I=A=>{if(["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","application/x-excel","application/x-msexcel","application/excel","application/spreadsheet","text/csv","application/csv","text/x-csv","application/x-csv","text/comma-separated-values","text/x-comma-separated-values"].includes(A.type))return!0;const w=["xlsx","xls","csv"],S=A.name.split(".").pop().toLowerCase();return w.includes(S)},j={onRemove:()=>{i([])},beforeUpload:A=>I(A)?A.size/1024/1024<10?!1:(Bn.error("El archivo debe ser menor a 10MB."),gl.LIST_IGNORE):(Bn.error("Solo se permiten archivos Excel (.xlsx, .xls) o CSV."),gl.LIST_IGNORE),fileList:r},k=[{key:"import",label:"Importar Datos",children:t.jsxs(Ch,{children:[t.jsx("p",{children:"Selecciona un archivo Excel (.xlsx, .xls) para importar datos al sistema."}),t.jsx("p",{children:"Asegúrate de que los datos estén organizados de acuerdo a la plantilla de importación."}),t.jsx(gl,{...j,onChange:C,maxCount:1,children:t.jsx(nr,{icon:t.jsx(Ed,{}),children:"Elegir archivo"})})]})},{key:"template",label:"Crear Plantilla",children:t.jsxs(Ch,{children:[t.jsx("p",{children:"Crea una plantilla personalizada seleccionando los campos que necesitas."}),t.jsx("p",{children:"Los campos esenciales siempre se incluirán en la plantilla."}),t.jsx(bL,{essentialFields:x,optionalGroups:g,onFieldsChange:v,language:f}),t.jsx(nr,{type:"primary",onClick:b,icon:t.jsx(vu,{}),children:"Crear Plantilla"})]})}];return t.jsx(EL,{title:"Importar Datos",open:e,onCancel:n,footer:d==="import"?[t.jsx(nr,{onClick:n,children:"Cancelar"},"cancel"),t.jsxs(nr,{type:"primary",onClick:y,disabled:r.length===0||a,loading:a,children:[t.jsx(Ed,{}),a?"Importando...":"Importar"]},"import")]:[t.jsx(nr,{onClick:n,children:"Cerrar"},"cancel")],children:t.jsx(AL,{children:t.jsx(SL,{activeKey:d,onChange:u,items:k})})})}const EL=l(wL)`
  .ant-modal-footer {
    display: flex;
    justify-content: space-between;
  }
`,AL=l.div`
  min-height: 15em;
`,Ch=l.div`
  margin-bottom: 2em;
  p {
    margin-bottom: 1em;
  }
`;var Ur=(e=>(e.Active="active",e.Inactive="inactive",e.Expired="expired",e.Pending="pending",e))(Ur||{}),ro=(e=>(e.Entry="in",e.Exit="out",e))(ro||{}),Zn=(e=>(e.Sale="sale",e.Purchase="purchase",e.Adjustment="adjustment",e.Return="return",e.InitialStock="initial_stock",e.Damaged="damaged",e.Expired="expired",e.Lost="lost",e.Transfer="transfer",e.BackOrder="backorder",e))(Zn||{});class kL{constructor(){this.stats={totalProducts:0,processedProducts:0,updatedProducts:0,newProducts:0,newCategories:0,newIngredients:0,updatedIngredients:0,batchOperations:0}}updateProgress(n,s=1){this.stats[n]+=s,this.logProgress()}logProgress(){const{processedProducts:n,totalProducts:s}=this.stats;if(s>0){const o=Math.round(n/s*100);console.log(`Progreso: ${o}% (${n}/${s})`)}}getSummary(){const{totalProducts:n,processedProducts:s,updatedProducts:o,newProducts:r,newCategories:i,newIngredients:a,updatedIngredients:c,batchOperations:d}=this.stats;return`
Resumen de importación:
----------------------
Total productos procesados: ${s}/${n}
Productos actualizados: ${o}
Productos nuevos: ${r}
Categorías nuevas: ${i}
Ingredientes activos nuevos: ${a}
Ingredientes activos actualizados: ${c}
Total operaciones en batch: ${d}
    `}}function TL(e){var n;return(!((n=e.pricing)!=null&&n.price)||e.pricing.price<=0)&&(e.pricing?e.pricing.price=e.pricing.listPrice||0:e.pricing={price:0,listPrice:0}),e}async function fl(e){const n=await Me(e),s=new Map;return n.docs.forEach(o=>{var a;const r=o.data(),i=(a=r.name)==null?void 0:a.toLowerCase();i&&s.set(i,{docSnapshot:o,data:r})}),s}async function PL(e,n,s){const o=new Map,r=e.filter(i=>i.id&&i.name&&!s.has(i.name.toLowerCase()));return await Promise.all(r.map(async i=>{const a=F(n,i.id),c=await Se(a);o.set(i.id,c)})),o}async function DL(e,n){console.log("== Iniciando fixDuplicatedNameBarcode ==");try{const s=le($,"businesses",e.businessID,"products"),o=new Map;for(const h of n){const f=typeof h.name=="string"?h.name.trim().toLowerCase():"_sin_nombre_",x=typeof h.barcode=="string"?h.barcode.trim().toLowerCase():h.barcode?String(h.barcode).toLowerCase():"_sin_barcode_";o.has(f)||o.set(f,new Set),o.get(f).add(x)}console.log("Obteniendo documentos de productos para verificar duplicados...");const r=await Me(s);if(r.empty){console.log("No hay productos en la BD, no hay duplicados por corregir.");return}const i=new Map;r.forEach(h=>{const f=h.data(),x=h.id,g=typeof f.name=="string"?f.name.trim().toLowerCase():"_sin_nombre_",y=typeof f.barcode=="string"?f.barcode.trim().toLowerCase():f.barcode?String(f.barcode).toLowerCase():"_sin_barcode_";i.has(g)||i.set(g,new Map);const b=i.get(g);b.has(y)||b.set(y,[]),b.get(y).push({docId:x,data:f})}),console.log(`Procesando ${i.size} nombres únicos para buscar duplicados...`);let a=dt($),c=0;const d=450;let u=0;const p=async()=>{if(c!==0){try{await a.commit(),console.log(`Lote de ${c} correcciones guardado`)}catch(h){throw console.error("Error al guardar lote de correcciones:",h),h}a=dt($),c=0}};for(const[h,f]of i)for(const[x,g]of f){if(g.length<=1)continue;console.log(`Conflicto: ${g.length} docs con name="${h}" y barcode="${x}"`),u++;const[,...y]=g,b=[...o.get(h)||[]].filter(C=>C!==x);console.log(`  Barcodes alternativos disponibles: ${b.length}`);let v=0;for(const C of y){let I=b[v++]??null;if(!I){console.log(`    -> No hay barcode alternativo. Documento "${C.docId}" sigue duplicado.`);continue}const j=F(s,C.docId);a.update(j,{barcode:I,updatedAt:de()}),c++,console.log(`    -> Reasignado doc "${C.docId}" al barcode="${I}"`),c>=d&&await p()}}if(c>0){console.log(`Guardando lote final de ${c} correcciones...`);try{await a.commit(),console.log("Lote final guardado exitosamente")}catch(h){throw console.error("Error al guardar lote final de correcciones:",h),h}}console.log(`== Fin de fixDuplicatedNameBarcode. Conflictos detectados: ${u} ==`)}catch(s){throw console.error("ERROR EN fixDuplicatedNameBarcode:",s),console.error("Stack trace:",s.stack),new Error(`Error al corregir duplicados: ${s.message}`)}}function $L(e,n,s,o){var a,c,d;let r=0;TL(n);const i=(a=n.name)==null?void 0:a.toLowerCase();if(i){if(o.existingProductsByName.has(i)){const{docSnapshot:b,data:v}=o.existingProductsByName.get(i),C=b.ref,I={...n,image:v.image};e.update(C,I),r++,console.log(`Producto actualizado (update) y se mantuvo 'image': ${n.name}`),o.progress.updateProgress("updatedProducts")}else{let b;if(n.id){b=F(o.productsCollection,n.id);const v=o.preloadedDocs.get(n.id);if(!v||!v.exists())e.set(b,n),r++;else{const C=v.data(),I={...n,image:C.image};e.update(b,I),r++,console.log(`Producto actualizado con id: ${n.id}`)}}else b=F(o.productsCollection),n.id=b.id,e.set(b,n),r++;o.progress.updateProgress("newProducts")}const u={createdAt:de(),createdBy:o.user.uid,updatedAt:de(),updatedBy:o.user.uid,deletedAt:null,deletedBy:null,isDeleted:!1},p={...u,id:be(10),productId:n.id,productName:n.name,numberId:s,status:Ur.Active,receivedDate:de(),providerId:null,quantity:n.stock||0,initialQuantity:n.stock||0},h=F($,"businesses",o.user.businessID,"batches",p.id);e.set(h,p),r++;const f={...u,id:be(10),batchId:p.id,productName:n.name,batchNumberId:s,location:((c=o.defaultWarehouse)==null?void 0:c.id)||null,expirationDate:null,productId:n.id,status:Ur.Active,quantity:n.stock||0,initialQuantity:n.stock||0},x=F($,"businesses",o.user.businessID,"productsStock",f.id);e.set(x,f),r++;const g={...u,id:be(10),batchId:p.id,productName:n.name,batchNumberId:s,destinationLocation:((d=o.defaultWarehouse)==null?void 0:d.id)||null,sourceLocation:null,productId:n.id,quantity:n.stock||0,movementType:ro.Entry,movementReason:Zn.InitialStock},y=F($,"businesses",o.user.businessID,"movements",g.id);if(e.set(y,g),r++,n.category){const b=n.category.toLowerCase();if(!o.existingCategoriesByName.has(b)){const v=F(o.categoriesCollection),C={id:v.id,name:n.category,createdAt:de()};e.set(v,C),r++,o.existingCategoriesByName.set(b,{docSnapshot:v,data:C}),console.log(`Categoría agregada: ${n.category}`),o.progress.updateProgress("newCategories")}}if(n.activeIngredients&&Array.isArray(n.activeIngredients))for(const b of n.activeIngredients){const v=b.toLowerCase();if(o.existingActiveIngredientsByName.has(v)){const{docSnapshot:C}=o.existingActiveIngredientsByName.get(v);e.update(C.ref,{updatedAt:de()}),r++,console.log(`Ingrediente activo actualizado: ${b}`),o.progress.updateProgress("updatedIngredients")}else{const C=F(o.activeIngredientsCollection),I={id:C.id,name:b,createdAt:de(),updatedAt:de()};e.set(C,I),r++,o.existingActiveIngredientsByName.set(v,{docSnapshot:C,data:I}),console.log(`Ingrediente activo agregado: ${b}`),o.progress.updateProgress("newIngredients")}}}else console.log("Producto omitido: no se proporcionó nombre.");return o.progress.updateProgress("batchOperations",r),o.progress.updateProgress("processedProducts"),r}const RL=async(e,n,s=1e4,o)=>{const r=new kL,i=500,c=n.slice(0,Math.min(s,1e4));r.stats.totalProducts=c.length,console.log(`Iniciando procesamiento de ${r.stats.totalProducts} productos`),console.log(`Primeros 10 productos: ${c.slice(0,100).map(f=>f.name).join(", ")}`),await DL(e,c);const d=le($,"businesses",e.businessID,"products"),u=le($,"businesses",e.businessID,"categories"),p=le($,"businesses",e.businessID,"activeIngredients"),h=await Oc(e);try{console.log("Cargando productos existentes...");const f=await fl(d);console.log(`${f.size} productos existentes encontrados`),console.log("Cargando categorías existentes...");const x=await fl(u);console.log(`${x.size} categorías existentes encontradas`),console.log("Cargando ingredientes activos existentes...");const g=await fl(p);console.log(`${g.size} ingredientes activos encontrados`);const y=await PL(c,d,f),b=await Mt(e,"batches",c.length),v=Array.from({length:c.length},(A,P)=>b+P),C=[];let I=dt($),j=0;const k={productsCollection:d,categoriesCollection:u,activeIngredientsCollection:p,defaultWarehouse:h,user:e,existingProductsByName:f,existingCategoriesByName:x,existingActiveIngredientsByName:g,preloadedDocs:y,progress:r};if(o){const A=r.updateProgress.bind(r);r.updateProgress=(P,w=1)=>{A(P,w),o(r)}}for(let A=0;A<c.length;A++){const P=c[A],w=v[A];j+=$L(I,P,w,k),j>=i&&(C.push(I.commit()),I=dt($),j=0)}j>0&&C.push(I.commit()),await Promise.all(C),console.log(r.getSummary()),console.log("Todos los productos, categorías e ingredientes activos fueron subidos exitosamente.")}catch(f){console.error("Error al subir los productos, categorías e ingredientes activos:",f),console.log("Estado al momento del error:",r.getSummary())}},NL=e=>{const n=new xc.Workbook,s=n.addWorksheet("Productos");s.columns=[{header:"Nombre del producto",key:"name"},{header:"Categoría",key:"category"},{header:"Tamaño",key:"size"},{header:"Contenido neto",key:"netContent"},{header:"Stock",key:"stock"},{header:"Impuesto",key:"tax"},{header:"Facturable",key:"isVisible"},{header:"Inventariable",key:"trackInventory"},{header:"Codigo de barras",key:"barcode"},{header:"Costo",key:"cost"},{header:"Precio de lista",key:"listPrice"},{header:"Precio mínimo",key:"minimumPrice"},{header:"Precio medio",key:"averagePrice"}],e.sort((r,i)=>r.name<i.name?-1:r.name>i.name?1:0);const o=e.map(r=>{var i,a,c;return[r.name,r.category,r.size,r.netContent,r.stock,r.pricing.tax,r.isVisible?"Sí":"No",r.trackInventory?"Sí":"No",r.barcode,Y(r.pricing.cost),Y((i=r.pricing)==null?void 0:i.listPrice),Y((a=r.pricing)==null?void 0:a.minPrice),Y((c=r.pricing)==null?void 0:c.avgPrice)]});s.addRows(o),s.getRow(1).font={bold:!0},s.columns.forEach(r=>{let i=10;r.eachCell({includeEmpty:!0},a=>{const c=a.value?String(a.value).length:10;c>i&&(i=c)}),r.width=i+2}),n.xlsx.writeBuffer().then(r=>{const i=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=URL.createObjectURL(i),c=document.createElement("a");c.href=a,c.download="productos.xlsx",c.click()})},OL=async(e,n)=>{const s=le($,"businesses",e.businessID,"activeIngredients");try{const o=await Me(s),r=new Map;o.docs.forEach(d=>{var h;const u=d.data(),p=(h=u.name)==null?void 0:h.toLowerCase();p&&r.set(p,{docSnapshot:d,data:u})});const i=dt($);let a=0;const c=new Set;n.forEach(d=>{d.activeIngredients&&d.activeIngredients.split(",").map(p=>p.trim()).forEach(p=>c.add(p))});for(const d of c){const u=d.toLowerCase();if(r.has(u)){const{docSnapshot:p}=r.get(u);i.update(p.ref,{updatedAt:de()}),a++}else{const p=F(s),h={id:p.id,name:d,createdAt:de(),updatedAt:de()};i.set(p,h),a++}}a>0&&await i.commit()}catch(o){console.error("Error al procesar los ingredientes activos:",o)}},ML=({visible:e,progress:n})=>{const{totalProducts:s,processedProducts:o,updatedProducts:r,newProducts:i,newCategories:a,newIngredients:c,updatedIngredients:d}=n,u=s>0?Math.round(o/s*100):0;return t.jsx(Ce,{title:"Progreso de Importación",open:e,footer:null,closable:!1,width:600,children:t.jsxs(FL,{children:[t.jsx(to,{percent:u,status:u===100?"success":"active",strokeWidth:15}),t.jsxs(BL,{children:[t.jsx(co,{children:t.jsx(vn,{title:"Productos Procesados",value:o,suffix:`/ ${s}`})}),t.jsxs(LL,{children:[t.jsx(co,{children:t.jsx(vn,{title:"Productos Actualizados",value:r})}),t.jsx(co,{children:t.jsx(vn,{title:"Productos Nuevos",value:i})}),t.jsx(co,{children:t.jsx(vn,{title:"Categorías Nuevas",value:a})}),t.jsx(co,{children:t.jsx(vn,{title:"Ingredientes Nuevos",value:c})}),t.jsx(co,{children:t.jsx(vn,{title:"Ingredientes Actualizados",value:d})})]})]})]})})},FL=l.div`
  padding: 20px 0;
`,BL=l.div`
  margin-top: 20px;
`,LL=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
  margin-top: 16px;
`,co=l(Je)`
  text-align: center;
  &.ant-card {
    background: #f8f9fa;
    border-radius: 8px;
  }
`,zL=({side:e="left"})=>{const{INVENTORY_ITEMS:n}=re.INVENTORY_TERM,s=vt(n),[o,r]=m.useState(!1),i=D(os),{products:a}=Rs(),c=D(q),[d,u]=m.useState({totalProducts:0,processedProducts:0,updatedProducts:0,newProducts:0,newCategories:0,newIngredients:0,updatedIngredients:0}),[p,h]=m.useState(!1),f=async b=>{try{h(!0);const v=await fL(b,"es");await OL(c,v),await RL(c,v,1e4,C=>{u(C.stats)}),V.success("Archivo importado correctamente.")}catch{V.error("Hubo un problema al importar el archivo.")}finally{setTimeout(()=>h(!1),2e3)}},x=async(b="es",v=[])=>{try{await xL(b,v),V.success("Plantilla creada exitosamente.")}catch(C){console.error("Error al crear la plantilla:",C),V.error("Hubo un problema al crear la plantilla.")}},g=()=>{const b={0:"Exento",16:"16%",18:"18%"},C=k2(a,i).map(I=>({...I,pricing:{...I.pricing,tax:i&&I.pricing.tax?b[I.pricing.tax]:"Exento"}}));NL(C)},y=[{text:"Importar Productos",description:"Productos en lista.",icon:t.jsx(O,{icon:mw}),action:()=>r(!0),closeWhenAction:!0},{text:"Exportar Productos",description:"Exporta productos a un archivo Excel.",icon:t.jsx(O,{icon:hw}),action:g,closeWhenAction:!0}];return s&&t.jsx(UL,{children:e==="right"&&t.jsxs(m.Fragment,{children:[t.jsxs($t,{children:[t.jsx(cp,{title:"Herramientas",options:y,borderRadius:"normal"}),t.jsx(ip,{}),t.jsx($v,{})]}),t.jsx(IL,{open:o,onClose:()=>r(!1),onImport:f,onCreateTemplate:x}),t.jsx(ML,{visible:p,progress:d})]})})},UL=l.div`
`,WL=({description:e=null,Children:n,placement:s})=>{const[o,r]=m.useState(!1);return t.jsxs(qL,{onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[n,o&&t.jsx(VL,{placement:s,children:e})]})},qL=l.div`
  width: min-content;
  position: relative;
    
`,VL=l.div`
  background-color: rgba(0, 0, 0, 0.87);
  color: white;
  padding: 0 8px;
  border-radius: var(--border-radius-light);
  position: absolute;
  width: auto;
  white-space: nowrap;
  z-index: 20000000000000;
  font-size: 12px;
  transform: scale(1);
  
  ${e=>{switch(e.placement){case"top-start":return`
          top: 100%;
          left: 0;
         
        `;case"top":return`
        left: 50%;
        transform: translateX(-50%);
        top: -100%;
        `;case"top-end":return`
          top: 100%;
          right: 0;
      `;case"left-start":return`
          
        `;case"left":return`
          left: -100%;
          top: 50%;
          transform: translateY(-50%);
        `;case"left-end":return`
        left: -100%;
          top: 0px;
        
        `;case"right-start":return`
          
        `;case"right":return`
        right: -100%;
          top: 50%;
          transform: translateY(-50%);
        `;case"right-end":return`
          
        `;case"bottom-start":return`
        bottom: -100%;
        left: 0;
        `;case"bottom":return`
        left: 50%;
        transform: translateX(-50%);
        bottom: -100%;
          
        `;case"bottom-end":return`
        bottom: -100%;
        right: 0;
        `}}}
  ${e=>{switch(e.isVisible){case!1:return`
          transform: scale(0);
        `}}}
`,{Button:GL}=Ne,_L=({side:e="left"})=>{const{ORDERS:n,ORDERS_CREATE:s}=re.ORDER_TERM,o=vt(n),r=Fe(),i=()=>r(s);return o?t.jsx(HL,{children:e==="right"&&t.jsx(WL,{description:"Realizar Comprar",Children:t.jsx(GL,{icon:z.operationModes.add,onClick:i,children:"Pedido"})})}):null},HL=l.div`

`,QL=({side:e="left"})=>{const n=Fe(),{PREORDERS:s,BILLS:o,SALES:r}=re.SALES_TERM,i=vt(s),a=()=>n(o),c=()=>n(r);return i&&t.jsx(YL,{children:e==="right"&&t.jsxs(KL,{children:[t.jsx(ke,{title:"Ventas",endIcon:z.arrows.chevronRight,onClick:c}),t.jsx(ke,{title:"Facturas",endIcon:z.arrows.chevronRight,onClick:a})]})})},YL=l.div`

`,KL=l.div`
  display: flex;
  align-items: center;
  gap: 0.4em;
 
`,JL=({side:e="left"})=>{const{configureAddProductCategoryModal:n}=ai(),{CATEGORIES:s}=re.INVENTORY_TERM;return vt(s)&&t.jsx(XL,{children:e==="right"&&t.jsx(ZL,{children:t.jsx(ke,{title:"Categoría",startIcon:z.operationModes.add,onClick:n})})})},XL=l.div`

`,ZL=l.div`
  display: flex;
  align-items: center;
  gap: 0.4em;
 
`,e6=({side:e="left"})=>{const{PURCHASES:n,PURCHASES_CREATE:s}=re.PURCHASE_TERM,o=vt(n),r=Fe(),i=W(),a=()=>i(ib()),c=()=>r(s);return o?t.jsx(t6,{children:e==="right"&&t.jsxs(mi,{children:[t.jsx(U,{onClick:a,children:"Reporte"}),t.jsx(U,{icon:t.jsx(O,{icon:js}),onClick:c,children:"Comprar"})]})}):null},t6=l.div`

`,Va=async(e,n,s,o=null)=>{try{console.log("🚀 Iniciando generación de Excel...");const r=new xc.Workbook,i=r.addWorksheet(n),a=Object.keys(e[0]);i.columns=a.map(h=>({header:h,key:h})),e.forEach(h=>{i.addRow(h)}),o&&typeof o=="function"?(console.log("🎨 Aplicando estilos profesionales..."),o(i,e,a),console.log("✅ Estilos aplicados exitosamente")):console.log("⚠️ No se proporcionó callback o no es una función"),console.log("📄 Generando archivo Excel...");const c=await r.xlsx.writeBuffer();console.log("💾 Iniciando descarga...");const d=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=URL.createObjectURL(d),p=document.createElement("a");return p.href=u,p.download=s,p.click(),setTimeout(()=>URL.revokeObjectURL(u),100),console.log("✅ Excel exportado exitosamente"),{success:!0}}catch(r){throw console.error("❌ Error al exportar Excel:",r),r}},Nv=e=>new Date(e.seconds*1e3).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),n6=e=>{var n;return(e==null?void 0:e.data)??((n=e==null?void 0:e.ver)==null?void 0:n.data)??e??{}},Cn=e=>{const n=Number(e);return isNaN(n)?0:n},s6=e=>{if(!e||e==="N/A")return"N/A";const n={cash:"Efectivo",card:"Tarjeta",transfer:"Transferencia",efectivo:"Efectivo",tarjeta:"Tarjeta",transferencia:"Transferencia",credit:"Crédito",debit:"Débito",credito:"Crédito",debito:"Débito"},s=e.toLowerCase().trim();return n[s]?n[s]:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},o6=(e=[])=>{const n=(e.find(s=>s.status)||{}).method??"N/A";return s6(n)},r6=(e=[],n)=>{if((n==null?void 0:n.value)!=null)return Cn(n.value);const s=e.find(o=>o.status);return s?Cn(s.value):0},i6=e=>{const{date:n,id:s,NCF:o,client:r={},totalShoppingItems:i={},totalTaxes:a={},paymentMethod:c,payment:d,change:u={},delivery:p={},totalPurchase:h={}}=e;return{Fecha:Nv(n),Comprobante:o??"N/A","Nombre Cliente":r.name||"Cliente Genérico","Teléfono Cliente":r.tel||"N/A","Dirección Cliente":r.address||"N/A","RNC/Cédula":r.personalID||"N/A","Cantidad de Productos":Cn(i.value),"Total ITBIS":Cn(a.value),"Método de Pago":o6(c),Pagado:r6(c,d),Delivery:Cn(p.value),Cambio:Cn(u.value),Total:Cn(h.value)}},a6=e=>{const n=[];return e.forEach(s=>{const o=n6(s),{products:r=[],client:i={},NCF:a,date:c,id:d,totalPurchase:u={}}=o;r.forEach(p=>{var h;n.push({Fecha:Nv(c),Comprobante:a,Cliente:i.name||"Cliente Genérico",Producto:p.name,Categoría:p.category,Tipo:p.type,Precio:Cn((h=p.pricing)==null?void 0:h.price),"Cantidad Facturada":Cn(p.amountToBuy),Total:Cn(u.value)})})}),n},Ga=({type:e,data:n})=>{switch(e){case"Resumen":return i6(n);case"Detailed":return a6(n);default:return[]}},lt={headerBg:"FFF5F5F5",headerText:"FF333333",totalsBg:"FFEEEEEE",totalsText:"FF333333",alternateRow:"FFFAFAFA",border:"FFCCCCCC"},wa=e=>{let n="";for(;e>0;){const s=(e-1)%26;n=String.fromCharCode(65+s)+n,e=Math.floor((e-1)/26)}return n},c6=(e,n="")=>{let s=(n==null?void 0:n.length)??0;return e.forEach(o=>{s=Math.max(s,String(o).length)}),s+l6(e)},l6=e=>{const n=e.some(o=>typeof o=="number"),s=e.some(o=>String(o).length>20);return n?4:s?2:3},d6=e=>e.every(n=>String(n).length<=5)?6:e.some(n=>typeof n=="number")?10:8,u6=e=>{const n=e.some(r=>String(r).length>50),s=e.some(r=>typeof r=="number"),o=e.reduce((r,i)=>r+String(i).length,0)/e.length;return n?60:s?18:o>30?40:o>15?25:20},wh=(e,n)=>{const s=e.getRow(1);s.height=35,s.font={bold:!0,color:{argb:lt.headerText},size:12},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:lt.headerBg}},s.alignment={vertical:"middle",horizontal:"center"},s.eachCell(o=>{o.border={top:{style:"medium",color:{argb:lt.border}},left:{style:"thin",color:{argb:lt.border}},bottom:{style:"medium",color:{argb:lt.border}},right:{style:"thin",color:{argb:lt.border}}}});for(let o=2;o<=n+1;o++){const r=e.getRow(o);o%2===0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:lt.alternateRow}}),r.eachCell(i=>{i.border={top:{style:"thin",color:{argb:lt.border}},left:{style:"thin",color:{argb:lt.border}},bottom:{style:"thin",color:{argb:lt.border}},right:{style:"thin",color:{argb:lt.border}}}})}e.columns.forEach((o,r)=>{const i=r+1,a=o.header??"",c=[];e.getColumn(i).eachCell({includeEmpty:!1},d=>{d.text&&c.push(d.text)}),o.width=c.length?Math.max(d6(c),Math.min(c6(c,a),u6(c))):12}),e.views=[{state:"frozen",ySplit:1}],e.autoFilter={from:"A1",to:`${wa(e.columns.length)}1`}},Sh=(e,n,s)=>{s.forEach(o=>{const r=n.indexOf(o)+1;if(r>0){const i=e.getColumn(r);i.numFmt="$#,##0.00",i.alignment={horizontal:"right"}}})},Ih=(e,n,s)=>{s.forEach(o=>{const r=n.indexOf(o)+1;if(r>0){const i=e.getColumn(r);i.numFmt="#,##0",i.alignment={horizontal:"right"}}})},Eh=(e,n,s,o,r="TOTALES",i=lt.totalsBg)=>{const a={};let c=!1;s.forEach(p=>{o.includes(p)?a[p]=n.reduce((h,f)=>h+(Number(f[p])||0),0):!c&&/Fecha|Cliente|Nombre Cliente/i.test(p)?(a[p]=r,c=!0):a[p]=""}),e.addRow({});const d=e.addRow(a).number,u=e.getRow(d);u.font={bold:!0,color:{argb:lt.totalsText},size:11},u.fill={type:"pattern",pattern:"solid",fgColor:{argb:i}},u.height=30,u.eachCell(p=>{p.border={top:{style:"medium",color:{argb:lt.border}},left:{style:"thin",color:{argb:lt.border}},bottom:{style:"medium",color:{argb:lt.border}},right:{style:"thin",color:{argb:lt.border}}}})},p6=e=>{switch(e){case"Resumen":return(n,s,o)=>{wh(n,s.length),Sh(n,o,["Total ITBIS","Pagado","Delivery","Cambio","Total"]),Ih(n,o,["Cantidad de Productos"]),Eh(n,s,o,["Cantidad de Productos","Total ITBIS","Pagado","Delivery","Cambio","Total"])};case"Detailed":return(n,s,o)=>{wh(n,s.length),Sh(n,o,["Precio","Total"]),Ih(n,o,["Cantidad Facturada"]),Eh(n,s,o,["Precio","Cantidad Facturada","Total"])};default:return null}},m6=(e,n,s="VentaMax")=>{e.spliceRows(1,0,[],[],[]);const o=e.columns.length,r=wa(o),i=e.getRow(1);i.getCell(1).value=n,i.font={bold:!0,size:16,color:{argb:lt.headerText}},i.alignment={horizontal:"center",vertical:"middle"},i.height=40,e.mergeCells(`A1:${r}1`);const a=e.getRow(2);a.getCell(1).value=s,a.getCell(1).font={bold:!0,size:11,color:{argb:lt.totalsText}},a.getCell(1).alignment={horizontal:"left",vertical:"middle"};const c=Math.ceil(o/2),d=wa(c);a.getCell(c).value=`Generado: ${new Date().toLocaleDateString("es-DO")}`,a.getCell(c).font={size:11,color:{argb:lt.totalsText}},a.getCell(c).alignment={horizontal:"right",vertical:"middle"},c>2&&e.mergeCells(`A2:${wa(c-1)}2`),o>c&&e.mergeCells(`${d}2:${r}2`),a.height=25,e.autoFilter={from:"A4",to:`${r}4`},e.views=[{state:"frozen",ySplit:4}]},_a=(e,n)=>{const s=p6(e);return(o,r,i)=>{if(m6(o,n),s){s(o,r,i);const a=o.getRow(4);a.height=35,a.font={bold:!0,color:{argb:lt.headerText},size:12},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:lt.headerBg}},a.alignment={vertical:"middle",horizontal:"center"}}}},h6=({side:e="left",data:n,searchData:s,setSearchData:o})=>{const[r,i]=m.useState(!1),{BILLS:a}=re.SALES_TERM,c=vt(a),d=n,u=ce.now().toFormat("ddMMyyyy"),p=()=>d.map(g=>Ga({data:g.data,type:"Resumen"})),h=()=>Ga({data:d,type:"Detailed"}),f=async g=>{if(d.length===0){V.error("No hay Facturas para exportar");return}i(!0);try{const y=(async()=>{switch(g){case"Resumen":const v=_a("Resumen","REPORTE DE FACTURACIÓN - RESUMEN");return await Va(p(),"Resumen de Facturas",`resumen_facturas_${u}.xlsx`,v),"El reporte resumen se ha generado correctamente";case"Detailed":const C=_a("Detailed","REPORTE DE FACTURACIÓN - DETALLE POR PRODUCTO");return await Va(h(),"Detalle de Facturas",`detalle_facturas_${u}.xlsx`,C),"El reporte detallado se ha generado correctamente";default:return"Exportación completada"}})(),[b]=await Promise.all([y,new Promise(v=>setTimeout(v,1e3))]);V.success(b)}catch(y){console.error("Error al exportar:",y),V.error("Hubo un problema al generar el archivo Excel. Inténtelo nuevamente.")}finally{i(!1)}},x=[{text:r?"Generando resumen...":"Resumen de Factura",description:"Obtén un resumen consolidado que incluye información general del cliente, totales y métodos de pago.",icon:r?t.jsx(Ah,{icon:An}):t.jsx(O,{icon:gw}),action:()=>f("Resumen"),disabled:r},{text:r?"Generando detalle...":"Detalle de Factura",description:"Accede a un desglose detallado con información de cada producto vendido, categorías, precios y cantidades.",icon:r?t.jsx(Ah,{icon:An}):t.jsx(O,{icon:Hx}),action:()=>f("Detailed"),disabled:r}];return c?t.jsx(g6,{children:e==="right"&&t.jsx(cp,{title:"Exportar excel",options:x})}):null},g6=l.div`
  
`,Ah=l(O)`
    animation: spin 1s linear infinite;
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
`,f6=({side:e="left"})=>{const n=W(),{abilities:s}=rs(),o=()=>n(ri({isOpen:!0})),r=vt("/users/list"),i=s.can("create","User")||s.can("manage","User");return r&&i?t.jsx(x6,{children:e==="right"&&t.jsx(U,{onClick:o,icon:z.operationModes.add,children:"Usuario"})}):null},x6=l.div``;function b6(){const e=Fe();return{home:()=>e(re.BASIC_TERM.HOME),welcome:()=>e(re.BASIC_TERM.WELCOME),login:()=>e(re.AUTH_TERM.LOGIN),signup:()=>e(re.AUTH_TERM.SIGNUP),sales:()=>e(re.SALES_TERM.SALES),bills:()=>e(re.SALES_TERM.BILLS),preorders:()=>e(re.SALES_TERM.PREORDERS),settings:()=>e(re.SETTING_TERM.SETTINGS),setting:()=>e(re.SETTING_TERM.SETTING),users:()=>e(re.SETTING_TERM.USERS),appInfo:()=>e(re.SETTING_TERM.APP_INFO),businessInfo:()=>e(re.SETTING_TERM.BUSINESS_INFO),taxReceipt:()=>e(re.SETTING_TERM.TAX_RECEIPT),createProduct:()=>e(re.INVENTORY_TERM.CREATE_PRODUCT),product:s=>e(Tt(re.INVENTORY_TERM.PRODUCT,s)),inventoryItems:()=>e(re.INVENTORY_TERM.INVENTORY_ITEMS),categories:()=>e(re.INVENTORY_TERM.CATEGORIES),warehouses:()=>e(re.INVENTORY_TERM.WAREHOUSES),warehouse:s=>e(Tt(re.INVENTORY_TERM.WAREHOUSE,s)),accountReceivableList:()=>e(re.ACCOUNT_RECEIVABLE.ACCOUNT_RECEIVABLE_LIST),accountReceivableInfo:s=>e(Tt(re.ACCOUNT_RECEIVABLE.ACCOUNT_RECEIVABLE_INFO,s)),receivablePaymentReceipts:()=>e(re.ACCOUNT_RECEIVABLE.RECEIVABLE_PAYMENT_RECEIPTS),purchases:()=>e(re.PURCHASE_TERM.PURCHASES),purchasesCreate:()=>e(re.PURCHASE_TERM.PURCHASES_CREATE),purchasesUpdate:s=>e(Tt(re.PURCHASE_TERM.PURCHASES_UPDATE,s)),purchasesComplete:s=>e(Tt(re.PURCHASE_TERM.PURCHASES_COMPLETE,s)),backorders:()=>e(re.PURCHASE_TERM.BACKORDERS),insuranceConfig:()=>e(re.INSURANCE_TERM.INSURANCE_CONFIG),insuranceList:()=>e(re.INSURANCE_TERM.INSURANCE_LIST),insuranceCreate:()=>e(re.INSURANCE_TERM.INSURANCE_CREATE),insuranceEdit:s=>e(Tt(re.INSURANCE_TERM.INSURANCE_EDIT,s)),insuranceDetails:s=>e(Tt(re.INSURANCE_TERM.INSURANCE_DETAILS,s))}}const y6=({side:e="left"})=>{const n=b6(),s=W();_t(),D(_S),D(HS),D(S0);const o=D(I0),{SALES:r}=re.SALES_TERM,i=vt(r),a=()=>s(GS()),c=()=>{n.setting()};return localStorage.getItem("theme"),i&&t.jsx(v6,{children:e==="right"&&t.jsxs(j6,{children:[t.jsx(zr,{tooltipDescription:o?"Salir de Pantalla Completa":"Pantalla Completa",tooltipPlacement:"bottom-end",icon:o?t.jsx(O,{icon:fw}):t.jsx(O,{icon:xw}),onClick:()=>a()}),t.jsx($v,{}),t.jsx(zr,{icon:z.operationModes.setting,onClick:c})]})})},v6=l.div`

`,j6=l.div`
  display: flex;
  align-items: center;
  gap: 0.4em;
 
`,C6=({side:e="left"})=>{const[n,s]=m.useState(!1),o=W(),{pathname:r}=_t(),{WAREHOUSES:i,WAREHOUSE:a,SHELF:c,ROW:d,SEGMENT:u}=re.INVENTORY_TERM,p=[i,a,c,d,u],h=g=>new RegExp(`^${g.replace(/:\w+/g,"[^/]+")}$`).test(r),f=p.some(h),x=()=>{o(Hd())};return f&&t.jsx(m.Fragment,{children:t.jsx(w6,{children:e==="right"&&t.jsx(S6,{children:t.jsx(ke,{tooltipDescription:"Agregar almacén",tooltipPlacement:"bottom-end",startIcon:z.operationModes.add,borderRadius:"normal",title:"Almacén",onClick:x})})})})},w6=l.div`

`,S6=l.div`
  display: flex;
  align-items: center;
  gap: 0.4em;
 
`;function Ha({title:e,value:n,valueType:s="none",description:o,color:r=!1}){const i=()=>typeof r=="boolean"&&r===!0?n>=0?"success-contained":"error-contained":typeof r=="string"?r:"",a=c=>{switch(s){case"number":return mt(c);case"percent":return`${c}%`;case"price":return Y(c)}return c};return t.jsxs(I6,{color:i(),children:[t.jsx(A6,{children:e}),t.jsx(E6,{children:a(n)}),o&&t.jsx(k6,{children:o})]})}const I6=l.div`
    background-color:  var(--White2);
    display: grid;
    padding: 0.3em 0.6em;
    justify-content: center;

    text-align: center; 
    border-radius: 0.4em;
    /* color: ${e=>e.color==="success-contained"||e.color==="error-contained"?"red":e.color==="default"?"var(--Black)":e.color}; */
    color: ${e=>{var n,s;return((s=(n=e==null?void 0:e.theme)==null?void 0:n.colors[e==null?void 0:e.color])==null?void 0:s.text)??""}};
    background-color: ${e=>{var n,s;return((s=(n=e==null?void 0:e.theme)==null?void 0:n.colors[e==null?void 0:e.color])==null?void 0:s.bg)??""}};

`,E6=l.h2`
    font-size: 1.4em;
    margin: 0;
`,A6=l.span`
    font-size: 1em;
    font-weight: 500;
    margin: 0;
`,k6=l.span`
    font-size: 0.9em;
    margin: 0;
`,Pr=({showcases:e})=>t.jsx(T6,{children:e.map((n,s)=>t.jsx(Ha,{title:n.title,valueType:n.valueType,value:n.value,description:n.description,color:n.color},s))}),T6=l.div`
  display: grid;
  gap: 1em;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
`,Ut=e=>new Intl.NumberFormat("es-DO",{style:"currency",currency:"DOP",minimumFractionDigits:2}).format(e||0),P6=e=>new Intl.NumberFormat("es-DO",{style:"percent",minimumFractionDigits:0,maximumFractionDigits:0}).format(e/100||0),{Text:kh}=Xe,{Option:D6}=ge,$6=({insuranceFilter:e,insuranceOptions:n,onInsuranceFilterChange:s,onDateRangeChange:o})=>t.jsxs(R6,{children:[t.jsxs(Th,{children:[t.jsx(kh,{strong:!0,style:{marginRight:"8px"},children:"Aseguradora:"}),t.jsx(ge,{style:{width:"200px"},value:e,onChange:s,placeholder:"Seleccionar aseguradora",children:n.map(r=>t.jsx(D6,{value:r.id,children:r.name},r.id))})]}),t.jsxs(Th,{children:[t.jsx(kh,{strong:!0,style:{marginRight:"8px"},children:"Fecha:"}),t.jsx(yt.RangePicker,{style:{width:"280px"},onChange:o,format:"DD/MM/YYYY"})]})]}),R6=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
`,Th=l.div`
  display: flex;
  align-items: center;
`,{Text:Ph}=Xe,N6=({accounts:e,allSelected:n,someSelected:s,selectedAccounts:o,onSelectAll:r,onSelectAccount:i,formatDate:a,formatCurrency:c,insuranceFilter:d})=>{const u=[{title:t.jsx(St,{onChange:r,checked:n,indeterminate:s&&!n,disabled:d==="none"}),dataIndex:"select",key:"select",width:"5%",render:(h,f)=>t.jsx(St,{checked:o.includes(f.ver.account.id),onChange:x=>i(x,f.ver.account.id)})},{title:"Factura",dataIndex:"invoiceNumber",key:"invoiceNumber",width:"10%"},{title:"Cliente",dataIndex:"client",key:"client",width:"25%",render:h=>t.jsx(Ph,{ellipsis:!0,children:h})},{title:"Fecha",dataIndex:"date",key:"date",width:"15%",render:h=>a(h)},{title:"Balance",dataIndex:"balance",key:"balance",width:"15%",render:h=>c(h)},{title:"NCF",dataIndex:"ncf",key:"ncf",width:"20%"}];if(d==="none")return t.jsx(M6,{children:t.jsx(Lt,{description:"Seleccione una aseguradora para ver las cuentas por cobrar",image:Lt.PRESENTED_IMAGE_SIMPLE})});const p=e.map(h=>{var f,x,g,y,b,v,C,I,j,k,A,P,w,S,E,T,R,N,G,Q,ae,oe,Z;return{...h,invoiceNumber:h.invoiceNumber||((y=(g=(x=(f=h.ver)==null?void 0:f.account)==null?void 0:x.invoice)==null?void 0:g.data)==null?void 0:y.numberID)||"N/A",client:h.client||((C=(v=(b=h.ver)==null?void 0:b.account)==null?void 0:v.client)==null?void 0:C.name)||"Cliente sin nombre",date:h.date||((P=(A=(k=(j=(I=h.ver)==null?void 0:I.account)==null?void 0:j.invoice)==null?void 0:k.data)==null?void 0:A.date)==null?void 0:P.seconds)*1e3||((E=(S=(w=h.ver)==null?void 0:w.account)==null?void 0:S.createdAt)==null?void 0:E.seconds)*1e3,balance:h.balance||0,insurance:h.insurance||((G=(N=(R=(T=h.ver)==null?void 0:T.account)==null?void 0:R.account)==null?void 0:N.insurance)==null?void 0:G.name)||"N/A",ncf:h.ncf||((Z=(oe=(ae=(Q=h.ver)==null?void 0:Q.account)==null?void 0:ae.invoice)==null?void 0:oe.data)==null?void 0:Z.NCF)||"N/A"}});return t.jsx(O6,{columns:u,dataSource:p,rowKey:h=>h.ver.account.id,pagination:{pageSize:5,showTotal:()=>t.jsx(F6,{children:t.jsxs(Ph,{strong:!0,children:["seleccionadas ",o.length,"/",e.length]})})},size:"small",scroll:{y:250},locale:{emptyText:"No hay cuentas disponibles con el filtro actual"}})},O6=l(Gt)`
  /* Estilo minimalista, usando configuración por defecto de Ant Design */
`,M6=l.div`
  display: flex;
  justify-content: center;
  align-items: center;
  height: 250px;
  background-color: #fafafa;
  border-radius: 4px;
  border: 1px solid #f0f0f0;
`,F6=l.div`
  display: flex;
  align-items: center;
  gap: 4px;
`,{Title:B6}=Xe,L6=({paymentMethods:e,methodErrors:n,updatePaymentMethod:s,printReceipt:o,setPrintReceipt:r})=>{const i=m.useRef({}),a=d=>{switch(d){case"cash":return"Efectivo";case"card":return"Tarjeta";case"transfer":return"Transferencia";default:return d}};m.useEffect(()=>{const d=e.find(u=>u.status);d&&i.current[d.method]&&setTimeout(()=>{i.current[d.method].focus(),i.current[d.method].select()},100)},[]);const c=(d,u)=>{if(u&&(!d.value||d.value===0))if(e.filter(h=>h.status).length===0){const h=document.querySelector('input[name="amount"]'),f=h?parseFloat(h.value||0):0;s(d.method,"value",f)}else s(d.method,"value",0);s(d.method,"status",u),u&&i.current[d.method]&&setTimeout(()=>{i.current[d.method].focus(),i.current[d.method].select()},0)};return t.jsxs(z6,{children:[t.jsx(B6,{level:5,children:"Información del Pago"}),e.map(d=>t.jsxs(U6,{children:[t.jsx(M.Item,{name:d.method,validateStatus:d.status&&n[`${d.method}_value`]?"error":"",help:d.status?n[`${d.method}_value`]:null,children:t.jsxs("div",{className:"payment-method-row",children:[t.jsx(St,{checked:d.status,onChange:u=>c(d,u.target.checked),children:a(d.method)}),t.jsx(Ke,{style:{width:"100%"},min:0,step:.01,formatter:u=>`$ ${u}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:u=>u.replace(/\$\s?|(,*)/g,""),value:d.value,disabled:!d.status,onChange:u=>s(d.method,"value",parseFloat(u||0)),ref:u=>{u&&(i.current[d.method]=u)}})]})}),d.method!=="cash"&&t.jsx(M.Item,{name:`${d.method}Reference`,label:"Referencia",validateStatus:d.status&&n[`${d.method}_reference`]?"error":"",help:d.status?n[`${d.method}_reference`]:null,children:t.jsx(ie,{placeholder:"Referencia",value:d.reference,disabled:!d.status,onChange:u=>s(d.method,"reference",u.target.value)})})]},d.method)),t.jsx(M.Item,{name:"comments",label:"Comentarios",children:t.jsx(ie.TextArea,{rows:2,placeholder:"Comentarios sobre el pago (opcional)"})}),t.jsx(M.Item,{children:t.jsx(St,{checked:o,onChange:d=>r(d.target.checked),children:"Imprimir recibo de pago"})})]})},z6=l.div`
  margin: 16px 0;
`,U6=l.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.4em;
  
  .payment-method-row {
    display: flex;
    flex-direction: column;
    gap: 8px;
  
  }
`,W6=st.forwardRef(({receipt:e,formatDate:n,formatCurrency:s},o)=>{var r;return e?t.jsxs("div",{ref:o,style:{padding:"20px"},children:[t.jsx("h2",{style:{textAlign:"center"},children:"Recibo de Pago de Aseguradora"}),t.jsxs("p",{children:[t.jsx("strong",{children:"Fecha:"})," ",n((r=e.createdAt)!=null&&r.toMillis?e.createdAt.toMillis():e.date)]}),t.jsxs("p",{children:[t.jsx("strong",{children:"ID de Pago:"})," ",e.paymentId||e.receiptId]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Aseguradora:"})," ",e.insurance]}),t.jsx("h3",{children:"Cuentas pagadas:"}),t.jsx("ul",{children:Array.isArray(e.accounts)&&e.accounts.map((i,a)=>t.jsxs("li",{children:[t.jsxs("div",{children:["Cuenta: ",i.arNumber||i.id]}),i.arId&&t.jsxs("div",{children:["ID: ",i.arId]}),i.invoiceNumber&&t.jsxs("div",{children:["Factura: ",i.invoiceNumber]}),t.jsxs("div",{children:["Total Pagado: ",s(i.totalPaid||i.balance||0)]}),t.jsxs("div",{children:["Balance Restante: ",s(i.arBalance||0)]}),Array.isArray(i.paidInstallments)&&i.paidInstallments.length>0&&t.jsxs("div",{children:[t.jsx("h4",{children:"Cuotas pagadas:"}),t.jsx("ul",{children:i.paidInstallments.map((c,d)=>t.jsxs("li",{children:["Cuota #",c.number," - Monto: ",s(c.amount||0)]},d))})]})]},a))}),t.jsxs("p",{children:[t.jsx("strong",{children:"Total:"})," ",s(e.totalAmount||e.total||0)]}),t.jsx("h3",{children:"Métodos de pago:"}),t.jsx("ul",{children:Array.isArray(e.paymentMethod||e.paymentMethods)&&(e.paymentMethod||e.paymentMethods).map((i,a)=>t.jsxs("li",{children:[i.method==="cash"?"Efectivo":i.method==="card"?"Tarjeta":"Transferencia",":",s(i.value||0),i.reference?` - Ref: ${i.reference}`:""]},a))}),typeof e.change=="number"&&e.change>0&&t.jsxs("p",{children:[t.jsx("strong",{children:"Cambio/Devuelta:"})," ",s(e.change)]})]}):null}),Qo={id:"",paymentMethods:[{method:"cash",value:0,status:!0},{method:"card",value:0,reference:"",status:!1},{method:"transfer",value:0,reference:"",status:!1}],totalPaid:0,createdAt:new Date,updatedAt:new Date,comments:"",createdUserId:"",updatedUserId:"",isActive:!0},Fc={id:"",installmentId:"",paymentId:"",createdAt:new Date,updatedAt:new Date,paymentAmount:0,createdBy:"",updatedBy:"",isActive:!0},io=async(e,n)=>{try{const s=F($,"businesses",e,"invoices",n),o=await Se(s);return o.exists()?o.data():null}catch(s){return console.error("Error obteniendo factura:",s),null}};async function Ov(e,n){try{if(console.log("fbGetClient - Recibiendo clientId:",n),console.log("fbGetClient - Tipo de clientId:",typeof n),console.log("fbGetClient - user.businessID:",e.businessID),!n||typeof n!="string"||n.trim()==="")return console.error("fbGetClient - clientId inválido:",n),null;const s=F($,"businesses",e.businessID,"clients",n);console.log("fbGetClient - clientRef creado correctamente");const o=await Se(s);return o.exists()?o.data().client:null}catch(s){throw console.error("Error fetching the client:",s),s}}async function dp({user:e,clientId:n,paymentReceipt:s}){let o=null;if(n&&typeof n=="string"&&n.trim()!=="")try{o=await Ov(e,n)}catch(a){console.warn("No se pudo obtener el cliente:",a)}else console.warn("clientId no válido, omitiendo la obtención del cliente");const r={id:be(),client:o,user:{id:e.uid,displayName:e.displayName},createdBy:e.uid,updatedBy:e.uid,createdAt:ue.now(),updatedAt:ue.now(),...s},i=F($,"businesses",e.businessID,"accountsReceivablePaymentReceipt",r.id);return await De(i,r),r}const ls=1e-10,ds=e=>e===void 0||isNaN(e)?0:parseFloat(parseFloat(e).toFixed(2)),q6=async(e,n,s)=>{var o,r;try{const{accounts:i,paymentDetails:a,insuranceId:c,clientId:d}=n,{totalPaid:u,paymentMethods:p,comments:h}=a;if(!(e!=null&&e.businessID))throw new Error("ID de negocio del usuario no disponible");if(!i||i.length===0)throw new Error("No hay cuentas seleccionadas para el pago");if(!u||isNaN(parseFloat(u))||parseFloat(u)<=0)throw new Error("El monto total pagado debe ser mayor a cero");const f=be(),x=dt($),g=F($,"businesses",e.businessID,"accountsReceivablePayments",f),y={...Qo,id:f,paymentMethods:p.filter(w=>w.status),totalPaid:parseFloat(u),createdAt:ue.now(),updatedAt:ue.now(),comments:h,createdUserId:e==null?void 0:e.uid,updatedUserId:e==null?void 0:e.uid,isActive:!0,isInsurancePayment:!0,insuranceId:c,clientId:d};x.set(g,y);let b=d,v=null;if(console.log("Procesando datos de cliente para las cuentas seleccionadas..."),i&&i.length>0)for(let w=0;w<i.length;w++){const S=i[w];if(console.log(`Procesando cuenta ${w+1}:`,S==null?void 0:S.id),S.accountData&&S.accountData.client&&S.accountData.client.id){const E=S.accountData.client.id;console.log(`ID de cliente encontrado en cuenta ${w+1}:`,E),b=E,v=S.accountData.client}}console.log("Cliente final seleccionado:",b);const C={receiptId:be(),paymentId:f,clientId:b,insuranceId:c,businessId:e.businessID,createdAt:ue.now(),createdBy:e.uid,accounts:[],totalAmount:parseFloat(u),paymentMethod:p.filter(w=>w.status),change:0},I=[];let j=parseFloat(u);for(const w of i){if(j<=ls)break;const S=F($,"businesses",e.businessID,"accountsReceivable",w.id),E=await Se(S);if(!E.exists()){console.warn(`La cuenta ${w.id} no existe, omitiendo...`);continue}const T=E.data(),R=le($,"businesses",e.businessID,"accountsReceivableInstallments"),N=he(R,te("arId","==",w.id),te("isActive","==",!0)),G=await Me(N);if(G.empty){console.warn(`La cuenta ${w.id} no tiene cuotas activas, omitiendo...`);continue}const Q=G.docs.map(oe=>({id:oe.id,...oe.data()}));Q.sort((oe,Z)=>oe.installmentDate?Z.installmentDate?oe.installmentDate.toMillis?oe.installmentDate.toMillis()-Z.installmentDate.toMillis():oe.installmentDate-Z.installmentDate:-1:1);let ae=null;if(T.invoiceId){const oe=await io(e.businessID,T.invoiceId);oe&&(ae=oe.data)}I.push({accountData:T,accountRef:S,installments:Q,invoiceData:ae,invoiceRef:ae?F($,"businesses",e.businessID,"invoices",T.invoiceId):null})}j=parseFloat(u);for(const{accountData:w,accountRef:S,installments:E,invoiceData:T,invoiceRef:R}of I){if(j<=ls)break;let N=0;const G=[],Q=[],ae=[];for(const oe of E){if(j<=ls)break;const Z=Math.min(j,parseFloat(oe.installmentBalance||0)),J=ds(parseFloat(oe.installmentBalance||0)-Z),X=F($,"businesses",e.businessID,"accountsReceivableInstallments",oe.id);x.update(X,{installmentBalance:J,isActive:J>ls});const me=F(le($,"businesses",e.businessID,"accountsReceivableInstallmentPayments"));x.set(me,{...Fc,id:be(),installmentId:oe.id,paymentId:f,createdAt:ue.now(),updatedAt:ue.now(),paymentAmount:ds(Z),createdBy:e.uid,updatedBy:e.uid,isActive:!0,clientId:d,arId:w.id,insuranceId:c}),G.push({number:oe.installmentNumber,id:oe.id,amount:ds(Z),status:J<=ls?"paid":"partial",remainingBalance:J}),j=ds(j-Z),N=ds(N+Z)}if(N>0){const oe=ds(parseFloat(w.arBalance||0)-N),Z=[...w.paidInstallments||[],...G.filter(J=>J.status==="paid").map(J=>J.id)];if(x.update(S,{arBalance:oe,lastPaymentDate:ue.now(),lastPayment:N,isActive:oe>ls,isClosed:oe<=ls,paidInstallments:Z}),R&&T){const J=T.totalPaid||0,X=ds(J+N),me=ds(T.totalAmount-X);x.update(R,{totalPaid:X,balanceDue:me,status:me<=ls})}C.accounts.push({arNumber:w.numberId,arId:w.id,invoiceNumber:T==null?void 0:T.numberID,invoiceId:T==null?void 0:T.id,paidInstallments:G,remainingInstallments:w.totalInstallments-Z.length,totalInstallments:w.totalInstallments,totalPaid:N,arBalance:oe,insuranceName:(o=w==null?void 0:w.insurance)==null?void 0:o.name,insuranceId:(r=w==null?void 0:w.insurance)==null?void 0:r.insuranceId})}}C.change=j>0?j:0;const k=F($,"businesses",e.businessID,"paymentReceipts",C.receiptId);x.set(k,C),await x.commit();let A={user:e,paymentReceipt:C};b&&typeof b=="string"&&b.trim()!==""?(console.log("Usando clientId válido para el recibo:",b),A.clientId=b):console.log("No se pudo obtener un clientId válido para el recibo");const P=await dp(A);return s&&s(P),P}catch(i){throw console.error("Error procesando pagos múltiples:",i),i}},V6=({visible:e,onCancel:n,accounts:s=[]})=>{const[o,r]=m.useState([]),[i]=M.useForm(),a=D(q),c=m.useRef(),[d,u]=m.useState(!1),[p,h]=m.useState(!1),[f,x]=m.useState(null),[g,y]=m.useState("none"),[b,v]=m.useState([]),[C,I]=m.useState("cash"),[j,k]=m.useState([{method:"cash",value:0,status:!0},{method:"card",value:0,reference:"",status:!1},{method:"transfer",value:0,reference:"",status:!1}]),[A,P]=m.useState(0),[w,S]=m.useState(!0),[E,T]=m.useState({}),[R,N]=m.useState(0),G=ve=>Ut(ve),Q=ve=>ve?Ve.convertMillisToFriendlyDate(ve).split(" ")[0]:"N/A";m.useEffect(()=>{const ve=s.filter(xe=>{var Ae,Re,$e,Le;return(Le=($e=(Re=(Ae=xe.ver)==null?void 0:Ae.account)==null?void 0:Re.account)==null?void 0:$e.insurance)==null?void 0:Le.name}).map(xe=>({name:xe.ver.account.account.insurance.name,id:xe.ver.account.account.insurance.insuranceId})).reduce((xe,Ae)=>(xe.some(Re=>Re.id===Ae.id)||xe.push(Ae),xe),[]);if(ve.sort((xe,Ae)=>xe.name.localeCompare(Ae.name)),v(ve),ve.length>0){const xe=ve[0].id;y(xe);const Ae=s.filter(Re=>{var $e,Le,Qt,Mn;return((Mn=(Qt=(Le=($e=Re.ver)==null?void 0:$e.account)==null?void 0:Le.account)==null?void 0:Qt.insurance)==null?void 0:Mn.insuranceId)===xe});if(Ae.length>0){const Re=Ae.map($e=>$e.ver.account.id);r(Re)}}},[s]),m.useEffect(()=>{const ve=o.reduce((xe,Ae)=>{const Re=s.find($e=>$e.ver.account.id===Ae);return xe+((Re==null?void 0:Re.balance)||0)},0);i.setFieldsValue({amount:ve}),ae("cash","value",ve)},[o,s,i]),m.useEffect(()=>{const ve=j.reduce((xe,Ae)=>Ae.status?xe+(parseFloat(Ae.value)||0):xe,0);P(ve)},[j]);const ae=(ve,xe,Ae)=>{if(xe==="value")if(Ae===""||Ae===null||Ae===void 0)k(Re=>Re.map($e=>$e.method===ve?{...$e,value:"",status:$e.status}:$e));else if(ve==="cash"&&!isNaN(parseFloat(Ae))){const Re=parseFloat(Ae).toFixed(2);k($e=>$e.map(Le=>Le.method==="cash"?{...Le,value:parseFloat(Re),status:!0}:Le))}else k(Re=>Re.map($e=>$e.method===ve?{...$e,[xe]:Ae}:$e));else k(Re=>Re.map($e=>$e.method===ve?{...$e,[xe]:Ae}:$e));(xe==="status"||xe==="value")&&oe(ve,xe,Ae)},oe=(ve,xe,Ae)=>{const Re={...E};Object.keys(Re).forEach(Le=>{Le.startsWith(`${ve}_`)&&delete Re[Le]});const $e=j.find(Le=>Le.method===ve);if((xe==="status"&&Ae===!0||$e.status)&&((xe==="value"&&(!Ae||parseFloat(Ae)<=0)||xe!=="value"&&$e.value<=0)&&(Re[`${ve}_value`]="El valor debe ser mayor a cero"),ve!=="cash")){const Le=xe==="reference"?Ae:$e.reference;(!Le||Le.trim()==="")&&(Re[`${ve}_reference`]="La referencia es obligatoria")}return T(Re),Object.keys(Re).length===0},Z=()=>{let ve=!0;const xe={};if(o.length===0)return V.error("Debe seleccionar al menos una cuenta para pagar"),!1;const Ae=i.getFieldValue("amount");if(!Ae||Ae<=0)return V.error("El monto total debe ser mayor a cero"),!1;if(j.filter(Le=>Le.status).length===0)return V.error("Debe seleccionar al menos un método de pago"),!1;for(const Le of j)Le.status&&((!Le.value||Le.value<=0)&&(xe[`${Le.method}_value`]="El valor debe ser mayor a cero",ve=!1),Le.method!=="cash"&&(!Le.reference||Le.reference.trim()==="")&&(xe[`${Le.method}_reference`]="La referencia es obligatoria",ve=!1));return A<Ae&&Math.abs(A-Ae)>=.001?(V.error("El monto pagado debe ser igual o mayor al monto total"),!1):(T(xe),ve)},J=()=>g==="none"?[]:g==="all"?s:s.filter(ve=>{var xe,Ae,Re,$e;return(($e=(Re=(Ae=(xe=ve.ver)==null?void 0:xe.account)==null?void 0:Ae.account)==null?void 0:Re.insurance)==null?void 0:$e.insuranceId)===g}),X=(ve,xe)=>{ve.target.checked?r([...o,xe]):r(o.filter(Ae=>Ae!==xe))},me=()=>{const ve=J();return ve.length===0?!1:ve.every(xe=>o.includes(xe.ver.account.id))},fe=()=>J().some(xe=>o.includes(xe.ver.account.id)),se=ve=>{const xe=J();if(ve.target.checked){const Ae=xe.map($e=>$e.ver.account.id),Re=o.filter($e=>!xe.some(Le=>Le.ver.account.id===$e));r([...Re,...Ae])}else{const Ae=xe.map(Re=>Re.ver.account.id);r(o.filter(Re=>!Ae.includes(Re)))}},ee=ve=>{y(ve);const xe=s.filter(Ae=>{var Re,$e,Le,Qt;return((Qt=(Le=($e=(Re=Ae.ver)==null?void 0:Re.account)==null?void 0:$e.account)==null?void 0:Le.insurance)==null?void 0:Qt.insuranceId)===ve});if(xe.length>0){const Ae=xe.map(Re=>Re.ver.account.id);r(Ae)}else r([])},K=ve=>{},B=Vo.useReactToPrint({content:()=>c.current,onAfterPrint:()=>{Be.success({message:"Pago Procesado",description:"Pago de Aseguradora Registrado con éxito",duration:4}),L()}}),_=async()=>{var ve,xe;try{if(await i.validateFields(),!Z())return;u(!0);const Ae=i.getFieldsValue(),Re={accounts:o.map($e=>{const Le=s.find(Qt=>{var Mn,Pp;return((Pp=(Mn=Qt.ver)==null?void 0:Mn.account)==null?void 0:Pp.id)===$e});return Le?{id:Le.ver.account.id,balance:Le.balance||Le.ver.account.arBalance||Le.ver.account.balance||0,accountData:Le.ver.account}:(console.warn(`No se encontró la cuenta con ID: ${$e}`),null)}).filter(Boolean),paymentDetails:{totalAmount:i.getFieldValue("amount"),totalPaid:A,paymentMethods:j.filter($e=>$e.status),comments:Ae.comments||"",printReceipt:w,paymentScope:"insurance",paymentOption:"balance"},insuranceId:g,date:new Date().getTime(),clientId:((xe=(ve=s[0])==null?void 0:ve.client)==null?void 0:xe.id)||"",user:a};try{const $e=await q6(a,Re,x);h(!0),w?setTimeout(()=>B(),1e3):(Be.success({message:"Pago Procesado",description:"Pago de Aseguradora Registrado con éxito",duration:4}),L())}catch($e){console.error("Error al procesar pagos múltiples:",$e),Be.error({message:"Error en el procesamiento",description:$e.message||"No se pudo procesar el pago múltiple",duration:4})}finally{u(!1)}}catch(Ae){console.error("Error al procesar el pago:",Ae),Be.error({message:"Error en el pago",description:Ae.message||"No se pudo procesar el pago",duration:4}),u(!1)}},L=()=>{r([]),y("none"),k([{method:"cash",value:0,status:!0},{method:"card",value:0,reference:"",status:!1},{method:"transfer",value:0,reference:"",status:!1}]),P(0),S(!0),T({}),h(!1),i.resetFields(),n()},H=i.getFieldValue("amount")||0,ne=.001;let pe=A-H;Math.abs(pe)<ne&&(pe=0);const ye=J(),Pe=[{title:"Seleccionar Cuentas",content:t.jsxs(G6,{children:[t.jsx($6,{insuranceFilter:g,insuranceOptions:b,onInsuranceFilterChange:ee,onDateRangeChange:K}),t.jsx(N6,{accounts:ye,allSelected:me(),someSelected:fe(),selectedAccounts:o,onSelectAll:se,onSelectAccount:X,formatDate:Q,formatCurrency:G,insuranceFilter:g})]})},{title:"Procesar Pago",content:t.jsxs(t.Fragment,{children:[t.jsx(Pr,{showcases:[{title:"Total a pagar",valueType:"price",description:"Total de las cuentas seleccionadas",value:H}]}),t.jsx(L6,{paymentMethods:j,methodErrors:E,updatePaymentMethod:ae,printReceipt:w,setPrintReceipt:S}),t.jsx(Pr,{showcases:[{title:"Total pagado",valueType:"price",value:A},{title:pe>=0?"Devuelta":"Faltante",valueType:"price",value:pe,description:"Debe pagar completamente el monto total",color:pe<0?"error":void 0}]})]})}],Ue=()=>{if(o.length===0){V.error("Debe seleccionar al menos una cuenta para continuar");return}N(R+1)},ut=()=>{N(R-1)};return t.jsx(Ce,{title:"Pago Múltiple de Aseguradora",open:e,onCancel:L,width:800,style:{top:10},footer:[t.jsx(U,{onClick:L,children:"Cancelar"},"back"),R>0&&t.jsx(U,{onClick:ut,children:"Anterior"},"previous"),R<Pe.length-1?t.jsx(U,{type:"primary",onClick:Ue,disabled:o.length===0,children:"Siguiente"},"next"):t.jsx(U,{type:"primary",onClick:_,loading:d,disabled:p||o.length===0,children:"Procesar Pago"},"submit")],destroyOnHidden:!0,children:t.jsxs(M,{form:i,layout:"vertical",initialValues:{amount:0},children:[t.jsx(Uw,{current:R,items:Pe.map(ve=>({title:ve.title})),style:{marginBottom:24}}),t.jsx("div",{children:Pe[R].content}),t.jsx("div",{style:{display:"none"},children:t.jsx(W6,{receipt:f,formatDate:Q,formatCurrency:G,ref:c})})]})})},G6=l.div`
  margin-bottom: 16px;
`,Mv=(e,n=null)=>{const[s,o]=m.useState([]);return m.useEffect(()=>{if(!e||!e.businessID){o([]);return}const r=le($,"businesses",e.businessID,"accountsReceivable");let i=[te("isActive","==",!0),it("createdAt","desc")];n&&n.startDate&&n.endDate&&i.push(te("createdAt",">=",new Date(n.startDate)),te("createdAt","<=",new Date(n.endDate)));const a=he(r,...i),c={},d={},u=Te(a,async p=>{let h=[];for(const f of p.docs){const x=f.data(),g=x.clientId,y=x.invoiceId,b=c[g]?Promise.resolve(c[g]):Ov(e,g),v=d[y]?Promise.resolve(d[y]):io(e.businessID,y),[C,I]=await Promise.all([b,v]);c[g]=C,d[y]=I,h.push({id:x.id,lastPaymentDate:x.lastPaymentDate,balance:x.arBalance,initialAmountAr:x.totalReceivable,createdAt:x.createdAt,account:x,client:C||{id:g,error:!0},invoice:I||{id:y,error:!0}})}o(f=>JSON.stringify(f)===JSON.stringify(h)?f:h)});return()=>u()},[e,n]),s},_6=({side:e="left",searchData:n,setSearchData:s})=>{const o=vt("/account-receivable/list"),[r,i]=m.useState(!1),[a,c]=m.useState([]),d=D(q),[u,p]=m.useState(Ct("last30Days")),h=Mv(d,u);m.useEffect(()=>{if(h){const y=h.map(b=>{var A,P,w,S,E,T,R,N,G;const v=(A=b==null?void 0:b.invoice)==null?void 0:A.data,C=(b==null?void 0:b.client)||{},j=((v==null?void 0:v.paymentMethod)||[]).reduce((Q,ae)=>ae.status?Q+ae.value:Q,0),k=b!=null&&b.createdAt?Ve.convertTimestampToMillis(b.createdAt):null;return{ncf:(v==null?void 0:v.NCF)||"N/A",invoiceNumber:(v==null?void 0:v.numberID)||"N/A",client:(C==null?void 0:C.name)||"Cliente Genérico",rnc:C==null?void 0:C.personalID,insurance:((P=v==null?void 0:v.insurance)==null?void 0:P.name)||((S=(w=b==null?void 0:b.account)==null?void 0:w.insurance)==null?void 0:S.name)||"N/A",hasInsurance:!!((E=v==null?void 0:v.insurance)!=null&&E.name||(R=(T=b==null?void 0:b.account)==null?void 0:T.insurance)!=null&&R.name),date:k,initialAmount:(b==null?void 0:b.initialAmountAr)||0,totalPaid:j,balance:(b==null?void 0:b.balance)||0,total:((N=v==null?void 0:v.totalPurchase)==null?void 0:N.value)||0,ver:{account:b},actions:{account:b},type:((G=b==null?void 0:b.account)==null?void 0:G.type)||"normal"}}).filter(b=>b.type==="insurance"||b.hasInsurance);c(y)}},[h]);const f=()=>{i(!0)},x=()=>{i(!1)};return o?t.jsx(H6,{children:e==="right"&&t.jsxs(t.Fragment,{children:[t.jsx(ke,{onClick:f,title:"Pago múltiple de aseguradoras",borderRadius:"light",icon:t.jsx(ma,{})}),t.jsx(V6,{visible:r,onCancel:x,accounts:a})]})}):null},H6=l.div`
    display: flex;
    align-items: center;
`,Q6=[{id:"ventaMenuToolBar",component:y6},{id:"inventoryMenuToolBar",component:zL},{id:"usersAdminToolBar",component:f6},{id:"cashReconciliationToolBar",component:xB},{id:"accountReceivableToolBar",component:_6},{id:"purchaseToolBar",component:e6},{id:"orderToolBar",component:_L},{id:"createOrderToolBar",component:jB},{id:"createPurchaseToolBar",component:wB},{id:"billToolBar",component:h6},{id:"productsCategoriesToolBar",component:JL},{id:"expensesCategoriesToolBar",component:zB},{id:"expensesListToolBar",component:qB},{id:"clientControlToolBar",component:yB},{id:"warehouseToolBar",component:C6},{id:"preorderToolBar",component:QL},{id:"businessManagementToolBar",component:gB},{id:"insuranceConfigToolBar",component:r4},{id:"generalConfigToolBar",component:_B}],Dh=e=>Q6.map(n=>({...n,id:`${n.id}${e}`,side:e})),Y6={leftSide:Dh("left"),rightSide:Dh("right")},K6=({data:e,searchData:n,setSearchData:s})=>{const o=r=>Y6[r].map(i=>{const a=i.component;return t.jsx(a,{side:i.side,data:e,searchData:n,setSearchData:s},i.id)});return t.jsxs(J6,{children:[t.jsx(X6,{children:o("leftSide")}),t.jsx(Z6,{children:o("rightSide")})]})},J6=l.div`
    display: flex;
    gap: 1em;
    align-items: center;
    justify-content: space-between;
`,X6=l.div``,Z6=l.div``,e8=({onClick:e=null})=>{var o;const n=Fe(),s=()=>{typeof e=="function"?e():n(-1)};return t.jsx(zr,{onClick:s,icon:(o=z==null?void 0:z.arrows)==null?void 0:o.chevronLeft})},t8=({handleCloseMenu:e})=>{const n=W(),s=()=>{n(dy("taxReceipt")),e()};return t.jsx(zr,{onClick:s,icon:z.system.notification})},Ze=({data:e,sectionName:n,sectionNameIcon:s,borderRadius:o,setSearchData:r,searchData:i,displayName:a="",showBackButton:c=!0,showNotificationButton:d=!1,onBackClick:u})=>{const p=W(),h=m.useRef(null),[f,x]=m.useState(!1),g=()=>{x(!f)};m.useEffect(()=>{p(py(f))},[f]);const y=()=>{x(!1)};return kt(h,!f,y),t.jsxs(m.Fragment,{children:[t.jsx(n8,{isOpen:!!f,onClick:y}),t.jsxs(s8,{borderRadius:o,ref:h,isOpen:!!f,children:[t.jsxs(o8,{children:[t.jsx(JF,{isOpen:f,onClick:g}),c&&t.jsx(e8,{onClick:u}),d&&t.jsx(t8,{handleCloseMenu:y}),n&&t.jsxs(r8,{children:[s,n]}),r&&t.jsx(ie,{prefix:z.operationModes.search,placeholder:`Buscar ${a||n||""}...`,value:i,onChange:b=>r(b.target.value),allowClear:!0,style:{width:"100%",maxWidth:300}})]}),t.jsx(K6,{data:e,setSearchData:r,searchData:i}),t.jsx(qF,{isOpen:f,handleOpenMenu:g})]})]})},n8=l.div`
  height: calc(100vh);
  width: 100%;
  position: absolute;
  left: 0;
  right: 0;
  backdrop-filter: blur(0px);
    z-index: 10;
    pointer-events: none;
    transition: all 1s  ease;
   ${e=>{switch(e.isOpen){case!0:return`
        z-index: 1000;
        display: block;
        pointer-events: visible;
        backdrop-filter: blur(2px);
        webkit-backdrop-filter: blur(6px);
        background-color: rgba(0, 0, 0, 0.100);
        `}}}
`,s8=l.div`

  user-select: none;
  background-color: ${e=>e.theme.bg.color}; 
  
  width: 100%;
  height: 2.75em;
  display: flex;
  align-items: center;
  align-content: center;
  padding: 0 1em;
  gap: 1em;
  // z-index: 9;
  ${e=>{switch(e.isOpen){case!0:return`
          //z-index: 9;
        `;case!1:return`
       // z-index: 10;
        transition-property: z-index;
        transition-delay: 400ms;
      `}}}
   ${e=>{switch(e.borderRadius){case"bottom-right":return`
         border-bottom-right-radius: var(--border-radius-light);
         @media (max-width: 800px){
          border-bottom-right-radius: 0px;
         padding-right: 1em;
        }   
        `}}}
`,o8=l.div`
  display: grid;
  grid-template-columns: auto auto auto auto;
  width: 100%;
  align-items: center;
  gap: 0.4em;
  justify-content: start;

 
`;l.div`
  height: 100%;
  display: flex;
  align-items: center;
  transition: opacity 1s linear;
  ${e=>{switch(e.menuIsOpen){case!0:return`  
        opacity: 0; 
        `}}}
  
    
`;const r8=l.div`
  display: flex;
  align-items: center;
  font-weight: 600;
  font-size: 1.1em;
  color: white;
  height: 1.8em;
  max-width: 250px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  gap: 0.4em;
  border-radius: 6px;
  background-color: rgba(0, 0, 0, 0.200);
  padding: 0 0.4em;
`,i8=({title:e,startIcon:n,endIcon:s,id:o,fn:r})=>{const i=D(m$),a=D(p$),c=D(u$),[d,u]=m.useState(0),[p,h]=m.useState(e),[f,x]=m.useState(n),[g,y]=m.useState(s),b=W(),v=async C=>{r(C.target.files[0])};return m.useEffect(()=>{u(i)},[i]),m.useEffect(()=>{d===0&&a===!0&&(b(yi({show:!0,message:"0"})),h(e)),d>0&&d<100&&(b(yi({show:!0,message:`cargando... ${d.toFixed(1)}%`})),h("cargando..."),x(t.jsx(O,{icon:An,spin:!0})),s=null),d===100&&(n=null,x(null),h("Listo"),b(yi({show:!0,message:"Listo"})),setTimeout(()=>{b(yi({show:!1,message:""})),h("Cambiar"),b(Ju({show:!0,url:c}))},2500))},[d,c]),t.jsxs(a8,{spin:d>0&&d<100,children:[t.jsx(c8,{progressStatus:d}),t.jsxs("label",{htmlFor:o,children:[f,p,g,t.jsx("input",{type:"file",name:"",id:o,onChange:C=>v(C),accept:"/imagen/*a"})]})]})},a8=l.div`
    overflow: hidden;
    height: 2em;
    border: 1px solid rgba(0, 0, 0, 0.226);
    position: relative;
    border-radius: 4px;
    transition: width 600ms ease-in-out;
    input{
        display: none;
    }
    label{
        padding: 0 0.6em;
        display: flex;
        height: 100%;
        gap: 0.6em;
        align-items: center;
        svg{
            font-size: 1.2em;
        }
    }
    ${e=>{switch(e.spin){case!0:return`
                label{
                    pointer-events: none;
                    :hover{
                        cursor: not-allowed;
                    }
                    svg{
                        transform: rotate(360deg);
                        animation: spin 2s linear infinite;
                        @keyframes spin {
                            0% {
                                transform: rotate(0deg);
                            }
                            100% {
                                transform: rotate(360deg);
                            }
                        }
                    }
                }
                `}}}
`,c8=l.div`
position: absolute;
    height: 100%;
    background-color: rgba(66, 164, 245, 0.555);
    width: ${e=>e.progressStatus}%;
    transition: width 600ms ease-in-out;
    pointer-events: none;
`,Fv=async(e,n)=>{if(!e||!(e!=null&&e.businessID))return;const s=le($,"businesses",e.businessID,"productsImages");Te(s,o=>{const r=[];o.forEach(i=>{r.push(i.data())}),n(r)})},Bv=async(e,n)=>{if(!e||!(e!=null&&e.businessID))return;let s=be(10);const o=F($,"businesses",e.businessID,"productsImages",s);try{await De(o,{id:s,url:n})}catch(r){console.log(r)}},$h=async(e,n)=>{if(!e||!(e!=null&&e.businessID))return;const s=F($,"businesses",e==null?void 0:e.businessID,"productsImages",n);try{await Ot(s),console.log(n)}catch(o){console.log(o)}},Lv=(e,n)=>{const s=In(Ts,n.url);Ss(s).then(()=>{Po(s).then(()=>{console.log(`deleted ${n}`),$h(e,n.id)}).catch(o=>{console.log(`Error deleting image: ${o}`)})}).catch(o=>{console.log(`Image does not exist, deleting document: ${o}`),$h(e,n.id)})},zv=(e,n,s)=>new Promise((o,r)=>{if(!e||!(e!=null&&e.businessID)){console.error("Invalid user or businessID"),r("Invalid user or businessID");return}const i=In(Ts,`businesses/${e.businessID}/productsImages/${be()}.jpg`),a=Nx(i,n);a.on("state_changed",c=>{const d=c.bytesTransferred/c.totalBytes*100;console.log("Upload is "+d+"% done"),s&&s(d)},c=>{console.error(c),r(c)},()=>{Ss(a.snapshot.ref).then(c=>{console.log("File available at",c),o(c)}).catch(c=>{console.error(c),r(c)})})}),l8=()=>{const[e,n]=m.useState([]),[s,o]=m.useState(null),r=D(q);m.useEffect(()=>{Fv(r,n)},[r]);const i=()=>{zv(r,s).then(a=>{Bv(r,a),o(null)})};return t.jsxs(d8,{children:[t.jsx(Ze,{sectionName:"Productos",sectionNameIcon:z.multimedia.image}),t.jsxs(u8,{children:[t.jsx("h2",{children:"Multimedia Manager"}),t.jsxs($t,{children:[s?t.jsx(ke,{title:t.jsx(IoMdClose,{}),borderRadius:"normal",width:"icon32",onClick:()=>o(null),bgcolor:"error"}):null,t.jsx(i8,{title:"Imagen",fn:()=>handleUploadImg(),setFile:o,file:s,startIcon:t.jsx(MdOutlineFileUpload,{}),id:"addImg"}),t.jsx(ke,{title:"subir",borderRadius:"normal",onClick:i,bgcolor:"primary",disabled:!s})]})]}),t.jsx(p8,{children:t.jsx(m8,{children:e.length>0?e.map((a,c)=>t.jsxs(h8,{children:[t.jsx("div",{className:"head",children:t.jsx(ke,{title:t.jsx(IoMdTrash,{}),borderRadius:"normal",width:"icon24",bgcolor:"error",onClick:()=>Lv(r,a)})}),t.jsx("img",{src:a.url,alt:"",onClick:()=>useDeleteImgFBStorage(a)})]},c)):null})})]})},d8=l.div`
  height: 100vh;
  display: grid;
  grid-template-rows: min-content min-content 1fr;
  grid-template-columns: 1fr;
`,u8=l.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 2.5em;
  padding: 0 1.3em;
  h2{
    font-size: 1.2em;
    margin: 0;
  }
`,p8=l.div`
  background-color: var(--icolor4);
  display: grid;

`,m8=l.div`
  display: grid;
  justify-content: center;
  justify-items: center;
  width: 100%;
  padding: 1em;
  overflow: hidden;
  grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
  grid-auto-rows:  130px;
  gap: 0.1em;
  
`,h8=l.div`
  background-color: white;
  border-radius: 8px;
  overflow: hidden;
  padding: 0.2em;
  width: 100%;
    position: relative;
  .head{
      padding: 0  0.2em 0.2em;
      width: auto;
      border-bottom-left-radius: 10px;
      position: absolute;
      right: 0;
      background-color: white;
      display: flex;
      justify-content: flex-end;
      //box-shadow: 2px 10px 10px rgba(0, 0, 0, 0.200);
    }
    img{
      object-fit: cover;
      border-radius: 4px;

      width: 100%;
      height: 100%;
    }
  
`,g8=l.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  background-color: #f8f8f8;
`,f8=l.div`
  font-size: 6rem;
  color: #ff8c00;
  margin-bottom: 2rem;
`,x8=l.h1`
  font-size: 3rem;
  font-weight: 700;
  margin: 0;
  color: #333;
  text-align: center;
`,b8=l.p`
  font-size: 1.5rem;
  margin: 1rem 0 3.4rem;
  color: #555;
  text-align: center;
`,y8=l(Xa)`
  font-size: 1.2rem;
  background-color: var(--color);
  color: #fff;
  border: none;
  padding: 0.4em 1.6rem;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  &:hover {
    background-color:var(--color);
    transform: translateY(-2px);
  }
`,v8=()=>{const{HOME:e}=re.BASIC_TERM;return t.jsxs(g8,{children:[t.jsx(f8,{children:t.jsx(O,{icon:fu})}),t.jsx(x8,{children:"¡Vaya!"}),t.jsx(b8,{children:"No pudimos encontrar la página que estás buscando."}),t.jsx(y8,{to:e,children:"Volver al inicio"})]})},Uv=e=>{const[n,s]=m.useState(!0),[o,r]=m.useState([]),i=D(q);return m.useEffect(()=>{(async()=>{try{yc(i);const{businessID:c,uid:d,role:u}=i,p=new Date(e.startDate),h=new Date(e.endDate),f=new Date("2024-01-21T14:41:00"),x=le($,"businesses",c,"invoices");let g;new Date>=f?u==="admin"||u==="owner"||u==="dev"?g=he(x,te("data.date",">=",p),te("data.date","<=",h),it("data.date","desc")):g=he(x,te("data.date",">=",p),te("data.date","<=",h),te("data.userID","==",d),it("data.date","desc")):g=he(x,te("data.date",">=",p),te("data.date","<=",h),it("data.date","desc"));const y=Te(g,b=>{if(b.empty){r([]),s(!1);return}const v=b.docs.map(C=>C.data()).filter(C=>C.data.status!=="cancelled");r(v),s(!1)});return()=>{y()}}catch(c){console.error("Error fetching invoices:",c),s(!1)}})()},[e,i]),{invoices:o,loading:n}};pt.register(It,Et,on,At);const j8={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Monto de Ventas"}},x:{title:{display:!0,text:"Fecha"}}},plugins:{tooltip:{callbacks:{label:function(e){let n=e.dataset.label||"";return n&&(n+=" "+Y(e.parsed.y)),n}}}}},C8=(e,n=!1)=>{const s=new Date(e*1e3);return n?s.toLocaleDateString(void 0,{day:"numeric",month:"long",year:"numeric"}):s.toLocaleDateString()},w8=(e,n=!1)=>e.reduce((s,o)=>{var a,c,d,u;const r=C8(o.data.date.seconds,n);s[r]=s[r]||{total:0,taxes:0,invoices:0,products:0,discounts:0,cash:0,card:0,transfer:0},s[r].total+=o.data.totalPurchase.value,s[r].invoices+=1,s[r].products+=o.data.totalShoppingItems.value,s[r].discounts+=(c=(a=o==null?void 0:o.data)==null?void 0:a.discount)==null?void 0:c.value;const i=(u=(d=o.data)==null?void 0:d.payment)==null?void 0:u.value;return o.data.paymentMethod.forEach(p=>{if(p.status)switch(p.method){case"cash":s[r].cash+=i;break;case"card":s[r].card+=i;break;case"transfer":s[r].transfer+=i;break}}),s},{}),S8=({sales:e})=>{if(!e||!Array.isArray(e))return null;const n=e.reduce((c,d)=>{const u=d.data.date.seconds*1e3;return c.min=Math.min(c.min,u),c.max=Math.max(c.max,u),c},{min:1/0,max:-1/0}),o=(n.max-n.min)/(1e3*60*60*24*30)>2,r=m.useMemo(()=>w8(e,o),[e,o]),i=m.useMemo(()=>{const c=Object.keys(r);c.map(h=>r[h].total);const d=c.map(h=>r[h].cash),u=c.map(h=>r[h].card),p=c.map(h=>r[h].transfer);return{labels:c,datasets:[{label:"Efectivo",data:d,backgroundColor:"rgba(255, 206, 86, 0.2)",borderColor:"rgba(255, 206, 86, 1)",borderWidth:1,stack:"Stack 1"},{label:"Tarjeta",data:u,backgroundColor:"rgba(54, 162, 235, 0.2)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1,stack:"Stack 1"},{label:"Transferencia",data:p,backgroundColor:"rgba(153, 102, 255, 0.2)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1,stack:"Stack 1"}]}},[r]),a=m.useRef(null);return m.useEffect(()=>()=>{a.current&&a.current instanceof pt&&a.current.destroy()},[]),m.useEffect(()=>()=>{a.current&&a.current instanceof pt&&a.current.destroy()},[]),t.jsxs(I8,{children:[t.jsx(Qe,{variant:"h3",children:"Ventas Totales por Día y Método de Pago"}),t.jsx(jt,{ref:a,data:i,options:j8})]})},I8=l.div`
    height: 200px;
 
    display: grid;
    gap: 1em;
`;pt.register(It,Et,on,At);const E8={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Ventas ($) "}},x:{title:{display:!0,text:"Categoría de Producto"}}},plugins:{tooltip:{callbacks:{label:function(e){let n=e.dataset.label||"";return n&&(n+=" "+Y(e.parsed.y)),n}}}}},A8=e=>e.reduce((n,s)=>(s.data.products.forEach(o=>{var c,d;const r=o==null?void 0:o.category,i=(c=o==null?void 0:o.pricing)==null?void 0:c.price,a=(d=o==null?void 0:o.pricing)==null?void 0:d.tax;o==null||o.amountToBuy,n[r]=(n[r]||0)+tt(i,a,0)}),n),{}),k8=({sales:e})=>{if(!e||!Array.isArray(e))return null;const n=m.useMemo(()=>A8(e),[e]),s=m.useMemo(()=>{const o=Object.keys(n),r=o.map(i=>n[i]);return{labels:o,datasets:[{label:"Ventas ",data:r,backgroundColor:"rgba(54, 162, 235, 0.2)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]}},[n]);return t.jsxs(T8,{children:[t.jsx(Qe,{variant:"h3",children:"Ventas por Categoría de Producto"}),t.jsx(jt,{data:s,options:E8})]})},T8=l.div`
    height: 200px;
  
    display: grid;
    gap: 1em;
`;pt.register(It,Et,on,At);const P8={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Ítems Vendidos"}},x:{title:{display:!0,text:"Categoría de Producto"}}}},D8=e=>e.reduce((n,s)=>(s.data.products.forEach(o=>{const r=o.category;n[r]=(n[r]||0)+o.amountToBuy.total}),n),{}),$8=({sales:e})=>{if(!e||!Array.isArray(e))return null;const n=m.useMemo(()=>D8(e),[e]),s=m.useMemo(()=>{const o=Object.keys(n),r=o.map(i=>n[i]);return{labels:o,datasets:[{label:"Ítems Vendidos",data:r,backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]}},[n]);return t.jsxs(R8,{children:[t.jsx(Qe,{variant:"h3",children:"Ítems Vendidos por Categoría"}),t.jsx(jt,{data:s,options:P8})]})},R8=l.div`
  height: 200px;
`;pt.register(It,Et,on,At);const N8=e=>{switch(e){case"card":return"Tarjeta";case"cash":return"Efectivo";case"transfer":return"Transferencia";default:return e}},O8={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Ventas ($)"}},x:{title:{display:!0,text:"Método de Pago"}}}},M8=e=>e.reduce((n,s)=>(s.data.paymentMethod.forEach(o=>{if(o.status){const r=N8(o.method);n[r]=(n[r]||0)+o.value}}),n),{}),F8=({sales:e})=>{if(!e||!Array.isArray(e))return null;const n=m.useMemo(()=>M8(e),[e]),s=m.useMemo(()=>{const o=Object.keys(n),r=o.map(i=>n[i]);return{labels:o,datasets:[{label:"Ventas ($)",data:r,backgroundColor:"rgba(54, 162, 235, 0.2)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]}},[n]);return t.jsxs(B8,{children:[t.jsx(Qe,{variant:"h3",children:"Ventas por Método de Pago"}),t.jsx(jt,{data:s,options:O8})]})},B8=l.div`
    height: 200px;
    display: grid;
    gap: 1em;
`;pt.register(It,Et,on,At);const L8={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Ventas ($)"}},x:{title:{display:!0,text:"Fecha"}}}},z8=(e,n=!1)=>{const s=new Date(e*1e3);return n?s.toLocaleDateString(void 0,{year:"numeric",month:"long"}):s.toLocaleDateString()},U8=(e,n=!1)=>e.reduce((s,o)=>{const r=z8(o.data.date.seconds,n);return s[r]=s[r]||{taxed:0,untaxed:0},s[r].taxed+=o.data.totalTaxes.value,s[r].untaxed+=o.data.totalPurchaseWithoutTaxes.value,s},{}),W8=({sales:e})=>{if(!e||!Array.isArray(e))return null;const n=e.reduce((a,c)=>{const d=c.data.date.seconds*1e3;return a.min=Math.min(a.min,d),a.max=Math.max(a.max,d),a},{min:1/0,max:-1/0}),o=(n.max-n.min)/(1e3*60*60*24*30)>2,r=m.useMemo(()=>U8(e,o),[e,o]),i=m.useMemo(()=>{const a=Object.keys(r),c=a.map(u=>r[u].taxed),d=a.map(u=>r[u].untaxed);return{labels:a,datasets:[{label:"Ventas Gravadas ",data:c,backgroundColor:"rgba(255, 206, 86, 0.2)",borderColor:"rgba(255, 206, 86, 1)",borderWidth:1,stack:"Stack 1"},{label:"Ventas No Gravadas ",data:d,backgroundColor:"rgba(54, 162, 235, 0.2)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1,stack:"Stack 1"}]}},[r]);return t.jsxs(q8,{children:[t.jsx(Qe,{variant:"h3",children:"Ventas Gravadas vs No Gravadas"}),t.jsx(jt,{data:i,options:L8})]})},q8=l.div`
    height: 200px;
    display: grid;
    gap: 1em;
`;pt.register(It,Et,on,At);const V8={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Número de Ventas"}},x:{title:{display:!0,text:"Tipo de Compra"}}}},G8=e=>e.reduce((n,s)=>{const o=s.data.sourceOfPurchase;return n[o]=(n[o]||0)+1,n},{}),_8=({sales:e})=>{if(!e||!Array.isArray(e))return null;const n=m.useMemo(()=>G8(e),[e]),s=m.useMemo(()=>{const o=Object.keys(n),r=o.map(i=>n[i]);return{labels:o,datasets:[{label:"Número de Ventas",data:r,backgroundColor:"rgba(54, 162, 235, 0.2)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]}},[n]);return t.jsxs(H8,{children:[t.jsx(Qe,{variant:"h3",children:"Ventas por Tipo de Compra"}),t.jsx(jt,{data:s,options:V8})]})},H8=l.div`
    height: 200px;
    display: grid;
    gap: 1em;
`;pt.register(It,Et,on,At);const Q8={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Descuentos ($)"}},x:{title:{display:!0,text:"Fecha"}}}},Y8=(e,n=!1)=>{const s=new Date(e*1e3);return n?s.toLocaleDateString(void 0,{year:"numeric",month:"long"}):s.toLocaleDateString()},K8=(e,n=!1)=>e.reduce((s,o)=>{var i,a;const r=Y8(o.data.date.seconds,n);return s[r]=(s[r]||0)+((a=(i=o==null?void 0:o.data)==null?void 0:i.discount)==null?void 0:a.value),s},{}),J8=({sales:e})=>{if(!e||!Array.isArray(e))return null;const n=e.reduce((a,c)=>{const d=c.data.date.seconds*1e3;return a.min=Math.min(a.min,d),a.max=Math.max(a.max,d),a},{min:1/0,max:-1/0}),o=(n.max-n.min)/(1e3*60*60*24*30)>2,r=m.useMemo(()=>K8(e,o),[e,o]),i=m.useMemo(()=>{const a=Object.keys(r),c=a.map(d=>r[d]);return{labels:a,datasets:[{label:"Descuentos ($)",data:c,backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]}},[r]);return t.jsxs(X8,{children:[t.jsx(Qe,{variant:"h3",children:"Descuentos Otorgados"}),t.jsx(jt,{data:i,options:Q8})]})},X8=l.div`
    height: 200px;
    display: grid;
    gap: 1em;
`;pt.register(It,Et,on,At);const Z8={responsive:!0,maintainAspectRatio:!1,scales:{y:{title:{display:!0,text:"Ventas ($)"}},x:{title:{display:!0,text:"Cliente"}}}},e3=e=>e.reduce((n,s)=>{if(s&&s.data&&s.data.client&&typeof s.data.client.name=="string"){const o=s.data.client.name.toLowerCase();(o.includes("generico")||o.includes("genérico")||o.includes("generic client"))&&(n.Generico=(n.Generico||0)+s.data.totalPurchase.value)}else console.warn("Sale data or client name is undefined or not a string:",s);return n},{}),t3=({sales:e})=>{if(!e||!Array.isArray(e))return null;const n=m.useMemo(()=>e3(e),[e]),s=m.useMemo(()=>{const o=Object.keys(n),r=o.map(i=>n[i]);return{labels:o,datasets:[{label:"Ventas ($)",data:r,backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]}},[n]);return t.jsxs(n3,{children:[t.jsx(Qe,{variant:"h4",children:"Ventas Genéricas"}),t.jsx(jt,{data:s,options:Z8})]})},n3=l.div`
  height: 200px;
  display: grid;
  gap: 1em;
`;pt.register(It,Et,on,At);const s3={responsive:!0,maintainAspectRatio:!1,scales:{y:{title:{display:!0,text:"Ventas ($)"}},x:{title:{display:!0,text:"Cliente"}}}},o3=e=>e.reduce((n,s)=>{const o=s.data.client.name;return n[o]=(n[o]||0)+s.data.totalPurchase.value,n},{}),r3=e=>{const n=o3(e);return Object.entries(n).filter(([o])=>!/generico|generic|genérico/i.test(o)).sort(([,o],[,r])=>r-o).slice(0,10).reduce((o,[r,i])=>(o[r]=i,o),{})},i3=({sales:e})=>{if(!e||!Array.isArray(e))return null;const n=m.useMemo(()=>r3(e),[e]),s=m.useMemo(()=>{const o=Object.keys(n),r=o.map(i=>n[i]);return{labels:o,datasets:[{label:"Ventas ($)",data:r,backgroundColor:"rgba(54, 162, 235, 0.2)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]}},[n]);return t.jsxs(a3,{children:[t.jsx(Qe,{variant:"h4",children:"Clientes Destacados"}),t.jsx(jt,{data:s,options:s3})]})},a3=l.div`
      height: 200px;
      display: grid;
      gap: 1em;
  `,c3=({sales:e})=>!e||!Array.isArray(e)?null:t.jsxs(l3,{children:[t.jsx(Qe,{variant:"h2",children:"Ventas Totales por Cliente"}),t.jsxs(d3,{children:[t.jsx(t3,{sales:e}),t.jsx(i3,{sales:e})]})]}),l3=l.div`
    
    display: grid;
    align-items: start;
    align-content: start;
    
    gap: 1em;
`,d3=l.div`
  display: grid;
  grid-template-columns: 200px 1fr;
  align-items: end;
  gap: 1em;
`,{Table:Ls,Typography:u3,Divider:p3}=Ne,m3=e=>{const n=e.reduce((s,o)=>{const r=o.data.client.name;s[r]||(s[r]={key:o.data.client.id,cliente:r,items:0,total:0,facturas:[]});const i=s[r];return i.items+=o.data.totalShoppingItems.value,i.total+=o.data.totalPurchase.value,i.facturas.push({numberID:o.data.numberID,fecha:We.unix(o.data.date.seconds).format("DD/MM/YYYY"),productos:o.data.products.map(a=>{const c=a.pricing.tax,d=a.pricing.price,u=a.amountToBuy;return{nombre:a.name,precio:tt(d,c),cantidad:u,subtotal:tt(d,c,0)}})}),s},{});return Object.values(n)},h3=e=>{const n=[{title:"Factura",dataIndex:"numberID",key:"numberID"},{title:"Fecha",dataIndex:"fecha",key:"fecha"},{title:"Producto",dataIndex:"nombre",key:"nombre"},{title:"Precio",dataIndex:"precio",key:"precio",render:o=>Y(o)},{title:"Cantidad",dataIndex:"cantidad",key:"cantidad",render:o=>mt(o)},{title:"SubTotal",dataIndex:"subtotal",key:"subtotal",render:o=>Y(o)}],s=e.flatMap(o=>o.productos.map((r,i)=>({key:`${o.numberID}-${i}`,numberID:o.numberID,fecha:o.fecha,...r})));return t.jsx(Ls,{columns:n,dataSource:s,pagination:!1})},g3=({sales:e})=>{const n=m3(e),[s,o]=m.useState(20),[r,i]=m.useState(1);n.reduce((u,p)=>u+p.items,0),n.reduce((u,p)=>u+p.total,0);const a=n.length,c=[{title:"Cliente",dataIndex:"cliente",key:"cliente"},{title:"Items",dataIndex:"items",key:"items",align:"right",render:u=>`${mt(u)}`},{title:"Total",dataIndex:"total",key:"total",align:"right",render:u=>`${Y(u)}`}],d=(u,p)=>{i(u),o(p)};return t.jsxs("div",{children:[t.jsx(p3,{orientation:"left",orientationMargin:!1,children:t.jsxs("div",{style:{display:"flex",gap:"1em",alignItems:"center",marginBottom:"20px"},children:[t.jsx(u3.Title,{level:4,style:{margin:0},children:"Reporte de venta por cliente"}),t.jsx(Ge,{color:"orange",children:"Beta"})]})}),t.jsx(Ls,{className:"components-table-demo-nested",columns:c,size:"small",scroll:{x:200},pagination:{current:r,pageSize:s,showSizeChanger:!0,pageSizeOptions:["10","20","50"],onChange:d},expandable:{expandedRowRender:u=>h3(u.facturas)},dataSource:n,summary:u=>{let p=0,h=0;return u.forEach(({items:f,total:x})=>{p+=f,h+=x}),t.jsxs(Ls.Summary.Row,{children:[t.jsx(Ls.Summary.Cell,{index:0}),t.jsx(Ls.Summary.Cell,{index:1,children:t.jsxs("div",{style:{fontWeight:700},children:["Total Clientes: ",a]})}),t.jsx(Ls.Summary.Cell,{index:2,children:t.jsx("div",{style:{fontWeight:700,textAlign:"right"},children:p})}),t.jsx(Ls.Summary.Cell,{index:3,children:t.jsx("div",{style:{fontWeight:700,textAlign:"right"},children:Y(h)})})]})}})]})},f3=({sales:e,isOpen:n,onOpen:s})=>{if(!n)return null;const o=m.useRef(null),r={open:{opacity:1,zIndex:1},close:{opacity:0,zIndex:-1}},i={open:{opacity:1,y:0},close:{opacity:0,y:"100vh"}};return kt(o,n,s),t.jsx(gt,{children:t.jsx(y3,{variants:r,initial:"close",animate:n?"open":"close",transition:{duration:.5},exit:"close",children:t.jsxs(b3,{ref:o,variants:i,initial:"close",animate:n?"open":"close",transition:{duration:.5},exit:"close",children:[t.jsxs(v3,{children:[t.jsx(Qe,{variant:"h2",children:"Reporte de ventas"}),t.jsx(ke,{title:"Cerrar",onClick:s})]}),t.jsx(S8,{sales:e}),t.jsx(g3,{sales:e}),t.jsxs(x3,{children:[t.jsx(F8,{sales:e}),t.jsx(_8,{sales:e})]}),t.jsx(W8,{sales:e}),t.jsx(k8,{sales:e}),t.jsx($8,{sales:e}),t.jsx(J8,{sales:e}),t.jsx(c3,{sales:e})]})},"backdrop")})},x3=l.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1em;
`,b3=l(Ie.div)`
  width: 100vw;
  display: grid;
  gap: 4em;
  height: 100%;
  background-color: #ffffff;
  border: 1px solid #1d1d1d37;
  border-radius: 0.5em;
  overflow-y: scroll;
  padding: 1em;
 
  `,y3=l(Ie.div)`
  width: 100%;
  height: calc(100vh);
  display: grid;
  justify-content: center;
  position: absolute;
  overflow: hidden;
  top: 0;
  z-index: 3000000000000000000;
`,v3=l.div`
  display: grid;
  grid-template-columns: 1fr max-content;
  align-items: center;
  gap: 1em;
  `,j3=({data:e})=>{const n=e==null?void 0:e.numberID,s=(e==null?void 0:e.client)||{},o=e==null?void 0:e.date,r=i=>i?new Date(i*1e3).toLocaleString():new Date().toLocaleString();return t.jsxs(C3,{children:[t.jsxs(I3,{children:["# ",n]}),t.jsx(w3,{children:s==null?void 0:s.name}),t.jsxs(S3,{children:[" ",r(o==null?void 0:o.seconds)]})]})},C3=l.div`
  display: grid;
  grid-template-columns: min-content 1fr min-content;
  gap: 1.4em;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
    padding-bottom: 8px;
  border-bottom: 1px solid #cfcfcf;
`,w3=l.h4`
  margin: 0;
  font-weight: normal;
`,S3=l.div`
  white-space: nowrap;
  margin: 0;
  text-align: right;
  justify-self: end;
  align-self: center;
`,I3=l.h4`
  margin: 0;
  white-space: nowrap;
`;function E3(e){const n=e.payment.value,s=e.totalPurchase.value;return n===s}function A3(e){const n=[];return e.paymentMethod.forEach(s=>{s.status&&n.push(s.method)}),n.join(", ")||""}function k3(e){const n={cash:"Efectivo",card:"TC",transfer:"Transf"};return e.map(o=>n[o.toLowerCase()]||o).join(", ")}function T3(e){return console.log(e),e.reduce((n,s)=>n+s.data.totalPurchase.value,0)}function P3(e){return e.length}const Bc=e=>e.payment.value-e.totalPurchase.value,Ns=({label:e,value:n,align:s,abbreviate:o})=>{const r=Ps();return t.jsxs(D3,{align:s,children:[t.jsxs("p",{children:[r>800&&o?e:o||e," ",(e||o)&&": "]}),t.jsx("p",{children:n})]})},D3=l.div`
    display: flex;
    flex-wrap: wrap;
    gap: 0.8em;
    p {
        margin: 0;
        &:nth-child(1) {
        font-weight: 600;
    }
    }

    :not(:first-child):not(:last-child) {
        justify-content: center;
    }
    :first-child {
        justify-content: flex-start;
    }
    :last-child {
        justify-content: flex-end;
    }
   
    /* ${({align:e})=>e==="right"&&`
         
        justify-content: flex-end;
        
    `}
    ${({align:e})=>e==="center"&&`
         
         justify-content: center;
         
     `} */
    @media (max-width: 500px) {
        
        display: grid;
       
    }
    @media (max-width: 600px) {

        grid-template-columns: 1fr;
        margin: 0;
        gap: 0em;
    }
`,$3=({data:e})=>{const n=e==null?void 0:e.delivery,s=e==null?void 0:e.totalPurchaseWithoutTaxes,o=e==null?void 0:e.discount,r=e==null?void 0:e.totalTaxes,i=e==null?void 0:e.totalPurchase,c=A3(e).split(", "),d=e==null?void 0:e.totalShoppingItems,u=k3(c);return t.jsxs(R3,{children:[t.jsxs(N3,{children:[t.jsx(Ns,{label:"Subtotal",value:Y(s==null?void 0:s.value)}),t.jsx(Ns,{abbreviate:"Desc",label:"Descuento",value:`${o==null?void 0:o.value}%`,align:"center"}),t.jsx(Ns,{abbreviate:"Deliv",label:"Delivery",value:Y(n.value),align:"center"}),t.jsx(Ns,{label:"Itbis",value:Y(r==null?void 0:r.value),align:"right"})]}),t.jsxs(O3,{children:[t.jsx(Ns,{label:"Items",value:d==null?void 0:d.value}),t.jsx(Ns,{value:u}),t.jsx(Ns,{value:t.jsx(M3,{children:Y(i==null?void 0:i.value)})})]})]})},R3=l.div`
height: min-content;
`,N3=l.div`
display: grid;
gap: 1rem;
grid-template-columns: repeat(4, minmax(min-content, 1fr));
`,O3=l.div`
display: grid;
grid-template-columns: 1fr 1fr 1fr;
`,M3=l.div`
font-weight: 700;
`,F3=({data:e})=>{const n=m.useRef(null),s=E3(e),o=Ps(),r=W(),i=Vo.useReactToPrint({content:()=>n.current}),a=()=>{var u,p;const d={...e,date:Ve.convertTimestampToMillis(e.date),payWith:(u=e==null?void 0:e.paymentMethod.find(h=>h.status===!0))==null?void 0:u.value,updateAt:Ve.convertTimestampToMillis(e==null?void 0:e.updateAt),cancel:e!=null&&e.cancel?{...e.cancel,cancelledAt:Ve.convertTimestampToMillis((p=e==null?void 0:e.cancel)==null?void 0:p.cancelledAt)}:null};r(fR({invoice:d}))},c=()=>{r(tN(e))};return t.jsx(t.Fragment,{children:t.jsxs(B3,{children:[t.jsx(P4,{ref:n,data:e}),t.jsxs(L3,{children:[t.jsx(ke,{startIcon:z.operationModes.edit,title:o>600&&"Editar",onClick:a}),t.jsx(ke,{type:"primary",startIcon:t.jsx(O,{icon:bw}),title:o>600&&"Imprimir",onClick:i}),t.jsx(ke,{startIcon:z.operationModes.more,title:o>600&&"Ver más",onClick:c})]}),t.jsx(z3,{color:s?"green":"red",children:s?"Contado":"Crédito"})]})})};l(U)`

  border-color: #52c41a;
  color: #52c41a;
  &:hover,
  &:focus {
     // Un verde ligeramente más claro para el hover y focus
    border-color: #73d13d !important;
    color: #73d13d !important;
  }
`;const B3=l.div`
display: grid;
gap: 1em;
overflow: hidden;
position: relative;
grid-template-columns: 1fr min-content;
`,L3=l.div`
display: grid;
gap: 0.6em;
grid-template-columns: repeat(3, min-content);
`,z3=l(Ge)`
    font-size: 1em;
    padding: 0.2em 0.4em;
    border-radius: 0.2em;
    font-weight: 500;
    text-transform: capitalize;
    text-align: center;
    `,U3=({data:e})=>t.jsxs(W3,{children:[t.jsx(j3,{data:e}),t.jsx($3,{data:e}),t.jsx(F3,{data:e})]}),W3=l.div`
  background: #ffffff;
  border-radius: 8px;
  padding: 0.4em ;
  font-family: 'Arial', sans-serif;
  border: 1px solid #e0e0e0;
`,q3=({invoices:e,searchTerm:n})=>{var c;const s=m.useRef(null),o=$n(e,n).map(d=>d.data),r=o.length,i=h0({count:r,getScrollElement:()=>s.current,estimateSize:()=>45}),a=i.getVirtualItems();return t.jsx("div",{ref:s,style:{overflowY:"auto",contain:"strict",padding:"0.4em 0.4em 1.4em"},children:t.jsx("div",{style:{height:i.getTotalSize(),width:"100%"},children:t.jsx("div",{style:{transform:`translateY(${((c=a[0])==null?void 0:c.start)??0}px)`,display:"grid",gap:"0.4em"},children:a.map(d=>t.jsx("div",{"data-index":d.index,ref:i.measureElement,children:t.jsx(U3,{data:o[d.index]})},d.key))})})})},{Select:V3,Form:G3,Button:Rh}=Ne,Wv=({invoices:e,datesSelected:n,setDatesSelected:s,onReportSaleOpen:o,processedInvoices:r,setProcessedInvoices:i})=>{const[a,c]=m.useState("defaultCriteria"),[d,u]=m.useState("asc"),p=()=>{u(d==="asc"?"desc":"asc")},h=v=>{c(v)};m.useEffect(()=>{g()},[a,d]);const f=[{value:"defaultCriteria",label:"Por defecto"},{value:"data.date.seconds",label:"Fecha"},{value:"data.numberID",label:"Numero"},{value:"data.client.name",label:"Cliente"},{value:"data.totalPurchase.value",label:"Total"}],x=(v,C,I)=>C==="defaultCriteria"?v:v.sort((j,k)=>{let A=C.split(".").reduce((w,S)=>w[S]?w[S]:"",j),P=C.split(".").reduce((w,S)=>w[S]?w[S]:"",k);return!isNaN(parseFloat(A))&&!isNaN(parseFloat(P))?(A=parseFloat(A),P=parseFloat(P),I==="asc"?A-P:P-A):I==="asc"?A.localeCompare(P):P.localeCompare(A)}),g=()=>{const v=x([...r],a,d);i(v)},y=v=>{s(v)},b=Ps();return t.jsxs(_3,{children:[t.jsxs(Q3,{children:[t.jsx(vc,{inputMovilWidth:!0,setDates:s,dates:n}),t.jsx(Tu,{setDates:y,dates:n})]}),t.jsxs(H3,{children:[t.jsxs(Y3,{children:[t.jsx(G3.Item,{label:"Ordenar: ",style:{marginBottom:0},children:t.jsx(V3,{defaultValue:"defaultCriteria",style:{width:120},onChange:h,options:f})}),t.jsx(Rh,{startIcon:d==="asc"?z.sort.sortAsc:z.sort.sortDesc,onClick:p,disabled:a==="defaultCriteria"})]}),b>900&&t.jsx(Rh,{onClick:o,children:"Gráfico de ventas"}),b<900&&t.jsxs(K3,{children:[t.jsx(Nh,{children:Y(T3(e))}),t.jsxs(Nh,{children:["#",P3(e)]})]})]})]})},_3=l.div`
    width: 100%;
    display: flex;
    background-color: var(--White);
    width: 100%;
    display: flex;
    align-items: end;
    border-bottom: 1px solid var(--Gray);
    padding: 0.4em 1em;
    margin: 0 auto;
    gap: 1em;
   
    select{
        padding: 0.1em 0.2em;
    }
    @media (max-width: 900px) {
        gap: 0.8em;
        row-gap: 0.4em;
        display: grid;
    }
`,H3=l.div`
  display: flex;
  flex-wrap: wrap;
  gap: 1em;
  
  @media (max-width: 900px) {
    gap: 0.2em;
    order: 1;
    justify-content: space-between;

  }
`,Nh=l.div`
    font-size: 1em;
    font-weight: 550;
    min-height: 2em;
    display: flex;
    align-items: center;
    white-space: nowrap;
    @media (max-width: 800px) {
        font-size: 1em;
    }
`,Q3=l.div`
    display: grid;
    gap: 1em;
    align-items: end;
    align-content: end;
    grid-template-columns: min-content min-content min-content;
    @media (max-width: 800px) {
        row-gap: 0;
        column-gap: 1em;
    }
`,Y3=l.div`
    display: flex;
    gap: 1em;
    align-items: center;
    @media (max-width: 800px) {
        gap: 0.2em;
    }
`,K3=l.div`
    display: flex;
    gap: 1em;
    align-items: center;
    
`,J3=m.lazy(()=>ks(()=>import("./SaleReportTable-BqR42KvU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166]))),X3=()=>{W(),D(q);const[e,n]=m.useState(!1),[s,o]=m.useState(Ct("today")),[r,i]=m.useState(""),{invoices:a}=Uv(s),[c,d]=m.useState(a),u=()=>n(!e);m.useEffect(()=>{d([...a])},[a]);const p=Ps();return t.jsxs(m.Fragment,{children:[t.jsxs(Z3,{animate:{x:0},transition:{type:"spring",stiffness:0},children:[t.jsx(Ze,{displayName:"Facturas",data:a,searchData:r,setSearchData:i}),t.jsx(Wv,{invoices:a,processedInvoices:c,setProcessedInvoices:d,datesSelected:s,setDatesSelected:o,onReportSaleOpen:u}),"        ",p>900?t.jsx(m.Suspense,{fallback:t.jsx("div",{style:{padding:"2em",textAlign:"center"},children:"Cargando..."}),children:t.jsx(J3,{bills:c,searchTerm:r})}):t.jsx(q3,{invoices:c,searchTerm:r})]}),t.jsx(f3,{isOpen:e,onOpen:u,sales:a})]})},Z3=l(Ie.div)`
  max-height: calc(100vh);
  height: 100vh;
  overflow: hidden;
  display: grid;
  background-color: var(--color2);
  grid-template-rows: min-content min-content 1fr;
  box-sizing: border-box;
`,ez=(e,n)=>{let s="";m.useEffect(()=>{const o=r=>{r.target.tagName==="INPUT"||r.target.tagName==="TEXTAREA"||(r.key==="Enter"?(n(e,s),s=""):s+=r.key)};return document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}},[e])},{Title:tz,Text:Oh}=Xe,nz=({visible:e,onClose:n})=>{const s=W();D(q);const o=D(Su),r=()=>{s(kd()),n()};return o?t.jsx(Ce,{title:null,open:e,onCancel:n,footer:null,centered:!0,width:400,styles:{body:{padding:"24px"}},children:t.jsxs(sz,{children:[t.jsx(oz,{children:t.jsx(O,{icon:xu,size:"3x",color:"#ff6b35"})}),t.jsx(tz,{level:4,style:{textAlign:"center",marginBottom:"8px"},children:"Estás visitando otro negocio"}),t.jsx(Oh,{type:"secondary",style:{textAlign:"center",display:"block",marginBottom:"24px"},children:"Actualmente estás navegando como invitado. ¿Deseas regresar a tu negocio?"}),t.jsxs(rz,{children:[t.jsx(O,{icon:bu,style:{marginRight:"8px",color:"#00d084"}}),t.jsx(Oh,{strong:!0,children:"Mi Negocio"})]}),t.jsx(iz,{children:t.jsx(U,{type:"primary",size:"large",icon:t.jsx(O,{icon:tc,style:{marginRight:"8px"}}),onClick:r,style:{background:"#00d084",borderColor:"#00d084",display:"flex",alignItems:"center"},children:"Regresar"})})]})}):null},sz=l.div`
  text-align: center;
`,oz=l.div`
  margin-bottom: 16px;
`,rz=l.div`
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 208, 132, 0.1);
  padding: 12px 16px;
  border-radius: 8px;
  margin-bottom: 24px;
`,iz=l.div`
  display: flex;
  justify-content: center;
  gap: 12px;
`,az=()=>{const e=D(Su),[n,s]=m.useState(!1),o=D(q),r=e?{text:"VISITANDO",icon:xu,color:"#ff6b35",bgColor:"rgba(255, 107, 53, 0.15)"}:{text:"MI NEGOCIO",icon:bu,color:"#00d084",bgColor:"rgba(0, 208, 132, 0.15)"},i=()=>{e&&s(!0)};return o.role!=="dev"?null:t.jsxs(t.Fragment,{children:[t.jsxs(cz,{$color:r.color,$bgColor:r.bgColor,$isClickable:e,title:e?"Haz clic para regresar a tu negocio":"Estás en tu negocio",onClick:i,children:[t.jsx(O,{icon:r.icon,size:"sm"}),t.jsx(lz,{children:r.text})]}),t.jsx(nz,{visible:n,onClose:()=>s(!1)})]})},cz=l.div`
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.4rem 0.6rem;
  border-radius: 14px;
  background: ${e=>e.$bgColor};
  color: ${e=>e.$color};
  font-weight: 600;
  font-size: 1rem;
  transition: all 0.2s ease;
  cursor: ${e=>e.$isClickable?"pointer":"default"};
  
  ${e=>e.$isClickable&&`
    &:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      filter: brightness(1.1);
    }
  `}
`,lz=l.span`
  font-weight: 700;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.3px;
`,dz=({digit:e})=>t.jsx(uz,{initial:{opacity:0,y:-6},animate:{opacity:1,y:0},transition:{duration:.5},children:e},e),uz=l(Ie.span)`
  font-weight: 600;

  display: flex;
  align-items: center;
`,Kd=({value:e})=>{const n=String(e).split("");return t.jsx(pz,{children:n.map((s,o)=>t.jsx(dz,{digit:s},o))})},pz=l.div`
    display: flex;
    padding: 0 0.4em;
  `,mz=({products:e})=>{const n=D($D),s=(e==null?void 0:e.length)||0;return t.jsxs(hz,{title:"Productos seleccionados",children:[t.jsx(O,{icon:Qx,size:"sm"}),t.jsxs(gz,{children:[n?t.jsxs(t.Fragment,{children:[t.jsx(Kd,{value:`${mt(n)}`}),t.jsx(fz,{children:"/"})]}):null,t.jsx(Kd,{value:mt(s)})]})]})},hz=l.div`
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.4rem 0.6rem;
  border-radius: 14px;
  background: var(--Gray8);
  color: white;
  font-weight: 600;
  font-size: 0.75rem;
  cursor: pointer;
  transition: all 0.2s ease;
  
  &:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
`,gz=l.div`
  display: flex;
  align-items: center;
`,fz=l.span`
  font-weight: 600;
  margin: 0 0.25rem;
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.7rem;
`,xz=({products:e})=>t.jsxs(bz,{as:Ie.div,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:[t.jsx(az,{}),t.jsx(mz,{products:e})]}),bz=l.div`
  position: absolute;
  bottom: 0.5rem;
  right: 0.9rem;
  z-index: 100;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  backdrop-filter: blur(8px);
  background: rgba(255, 255, 255, 0.95);
  border-radius: 22px;
  padding: 0.4rem 0.4rem;
  
  box-shadow: 
    0 3px 8px rgba(0, 0, 0, 0.12),
    0 1px 3px rgba(0, 0, 0, 0.08);
  border: 1px solid rgba(95, 95, 95, 0.3);
  font-size: 1rem;
`,xl={default:{textColor:"var(--color)",amountColor:"#757575",outlineSelected:"2.9px solid var(--color)"},lowStock:{textColor:"#fb8c00",amountColor:"#fb8c00",outlineSelected:"2.9px solid #fb8c00"},strict:{textColor:"#43a047",amountColor:"#43a047",outlineSelected:"2.9px solid #43a047"}},up=({isOutOfStock:e,isLowStock:n,hasStrictStock:s,isSelected:o})=>e?{textColor:o?"#ef5350":"#9e9e9e",amountColor:o?"#ef5350":"#9e9e9e",outlineSelected:o?"2.9px solid #ef5350":"none"}:n?xl.lowStock:s?xl.strict:xl.default,yz=e=>e.isSelected?up(e).outlineSelected:"none",vz=e=>up(e).amountColor,jz=e=>up(e).textColor,Cz=()=>"#f5f5f5",wz=async(e,{sourceLocation:n,destinationLocation:s,productId:o,productName:r,quantity:i,movementType:a,movementReason:c,batchId:d,notes:u},p=null)=>{const h=be(),f=F($,"businesses",e.businessID,"movements",h),x={id:h,createdAt:de(),createdBy:e.uid,productId:o,productName:r,batchId:d,sourceLocation:n,destinationLocation:s,movementType:a,movementReason:c,quantity:i,notes:u,isDeleted:!1};return p?p.set(f,x):await De(f,x),h},Sz=async({user:e,productId:n,batchId:s,productName:o,quantityToMove:r,sourceLocation:i,destinationLocation:a})=>{const d=(await Ya(e,{productId:n,batchId:s,location:i}))[0];if(!d||d.stock<r)throw new Error("Stock insuficiente en ubicación origen");const u={...d,quantity:d.quantity-r};u.quantity===0?await Sa(e,{...u,status:"inactive"}):await Sa(e,u),await wz(e,{sourceLocation:i,destinationLocation:a,productId:d.productId,productName:d.productName,quantity:r,movementType:ro.Exit,movementReason:Zn.Transfer,batchId:s,notes:""});const h=(await Ya(e,{productId:n,batchId:s,location:a}))[0];if(h){const f=h.quantity+r;await Sa(e,{...h,quantity:f,status:f>0?"active":"inactive"})}else{const f={...d,location:a,quantity:r,isDeleted:!1,productId:n,productName:o};await pp(e,f)}return{success:!0}},Mh=async(e,n)=>{if(!n)return"N/A";try{const[s,o,r,i]=n.split("/");if(i){const a=await Se(F($,"businesses",e.businessID,"segments",i));if(a.exists())return a.data().name}if(r){const a=await Se(F($,"businesses",e.businessID,"rows",r));if(a.exists())return a.data().name}if(o){const a=await Se(F($,"businesses",e.businessID,"shelves",o));if(a.exists())return a.data().name}if(s){const a=await Se(F($,"businesses",e.businessID,"warehouses",s));if(a.exists())return a.data().name}return"Ubicación no encontrada"}catch(s){return console.error("Error getting location name:",s),"Error al obtener ubicación"}},Iz=(e,n,s)=>{const[o,r]=m.useState([]),[i,a]=m.useState(!0);return m.useEffect(()=>{if(!e||!n){r([]),a(!1);return}a(!0);const c=le($,"businesses",e.businessID,"movements"),d=he(c,X1(Z1(te("sourceLocation","==",n),te("destinationLocation","==",n)),te("isDeleted","==",!1)),it("createdAt","desc")),u=Te(d,async p=>{const h=p.docs.map(async x=>{const g=x.data();console.log("Checking movement:",g),console.log("Current Location:",s),console.log("Source Location:",g.sourceLocation),console.log("Destination Location:",g.destinationLocation);let y;s===g.sourceLocation&&s===g.destinationLocation?y="unknown":s===g.sourceLocation&&s!==g.destinationLocation?y="out":s===g.destinationLocation&&s!==g.sourceLocation?y="in":y="unknown",console.log("Movement Type:",y);const[b,v]=await Promise.all([Mh(e,g.sourceLocation),Mh(e,g.destinationLocation)]);return{...g,id:x.id,movementType:y,sourceLocationName:b,destinationLocationName:v}}),f=await Promise.all(h);r(f),a(!1)});return()=>u()},[e,n,s]),{data:o,loading:i}},qv=e=>le($,"businesses",e,"batches"),Ez=async(e,n)=>{const s=be();try{const o=qv(e.businessID),r=F(o,s),i={...n,id:s,isDeleted:!1,createdAt:de(),createdBy:e.uid,status:"active",updatedAt:de(),updatedBy:e.uid};return await De(r,i),i}catch(o){throw console.error("Error al añadir el batch:",o),o}},Qa=async(e,n)=>{try{if(!n)return null;const s=F($,"businesses",e.businessID,"batches",n),o=await Se(s);return o.exists()?o.data():null}catch(s){throw console.error("Error al obtener el batch por ID:",s),s}},Vv=(e,n=null,s)=>{try{const o=qv(e.businessID);let r;return n?r=he(o,te("productId","==",n)):r=he(o,te("isDeleted","==",!1)),Te(r,a=>{const c=a.docs.map(d=>({id:d.id,...d.data()}));s(c)},a=>{console.error("Error al escuchar documentos en tiempo real:",a)})}catch(o){throw console.error("Error al escuchar documentos en tiempo real:",o),o}};async function Az(e,n,s){const o=he(le($,"businesses",e,"productsStock"),te("isDeleted","==",!1),te("status","==","active"),te("batchId","==",n),te("productId","==",s),te("quantity",">",0)),r=await Me(o);let i=0;r.forEach(c=>{const d=c.data();i+=d.quantity||0});const a=F($,"businesses",e,"batches",n);i<=0&&await je(a,{quantity:0,status:"inactive",updatedAt:de()})}const kz=async({user:e,batchId:n,movement:s})=>{try{const o=F($,"businesses",e.businessID,"batches",n),r=await Se(o);if(!r.exists())throw new Error("Lote no encontrado");const i=r.data(),a=await Tz({user:e,batchId:n,movement:s});return await je(o,{isDeleted:!0,deletedAt:de(),deletedBy:e.uid}),{...i,deletionDetails:a}}catch(o){throw console.error("Error al marcar el batch como eliminado:",o),o}},pi=e=>e?le($,"businesses",e,"productsStock"):(console.warn("businessID is empty. Skipping collection reference."),null),pp=async(e,n)=>{const s=En();try{const o=pi(e.businessID);if(!o)return;const r=F(o,s),{warehouse:i,shelf:a,row:c,segment:d}=n.location,u=[i,a,c,d].filter(Boolean).join("/");return await De(r,{...n,id:s,createdAt:de(),createdBy:e.uid,updatedAt:de(),updatedBy:e.uid,isDeleted:!1,deletedAt:null,deletedBy:null}),n}catch(o){throw console.error("Error al añadir el documento: ",o),o}},Sa=async(e,n)=>{try{const s=F($,"businesses",e.businessID,"productsStock",n.id);return await je(s,{...n,updatedAt:de(),updatedBy:e.uid}),{data:n}}catch(s){throw console.error("Error al actualizar el documento: ",s),s}},Tz=async({user:e,batchId:n,movement:s})=>{try{const o=await Ya(e,{batchId:n}),r=o.map(a=>Gv({user:e,productStockId:a.id,movement:{...s,quantity:a.quantity,notes:`${s.notes||""} - Eliminación por batch ${n}`}})),i=await Promise.all(r);return{batchId:n,deletedItems:i.length,quantity:o.reduce((a,c)=>a+c.quantity,0)}}catch(o){throw console.error(`Error eliminando productStocks del batch ${n}:`,o),o}},Gv=async({user:e,productStockId:n,movement:s={}})=>{if(!(e!=null&&e.businessID)||!n)throw new Error("Missing required parameters: user.businessID or productStockId");try{const{businessID:o,uid:r}=e,i=F($,"businesses",o,"productsStock",n),a=await Se(i);if(!a.exists())throw new Error("Stock record not found");const c=a.data(),{batchId:d,productId:u,location:p,productName:h,batchNumberId:f,quantity:x}=c;if(!d||!u)throw new Error("Invalid stock record - missing batch or product reference");const g=F($,"businesses",o,"batches",d),y=F($,"businesses",o,"products",u);if(!(await Se(g)).exists())throw new Error("Associated batch not found");const v=(s==null?void 0:s.quantity)||x,C=le($,"businesses",o,"productsStock"),I=he(C,te("batchId","==",d),te("isDeleted","==",!1)),k=(await Me(I)).size<=1;await je(y,{stock:fn(-v)}),await je(g,{quantity:fn(-v)}),await je(i,{isDeleted:!0,quantity:0,deletedAt:de(),deletedBy:r}),k&&(await je(g,{isDeleted:!0,deletedAt:de(),deletedBy:r}),await je(y,{stock:0}));const A=En(),P=F($,"businesses",o,"movements",A);return await De(P,{id:A,sourceLocation:p||"",destinationLocation:"deleted",productId:u,productName:h||"",quantity:v,movementType:ro.Exit,movementReason:(s==null?void 0:s.reason)??Zn.Adjustment,batchId:d,batchNumberId:f||"",notes:(s==null?void 0:s.notes)||"Eliminación de stock",createdAt:de(),createdBy:r,isDeleted:!1}),n}catch(o){throw console.error("Error al marcar el documento como eliminado: ",o),o}},Pz=(e,n,s)=>{const o=()=>{};if(!e||!n||!s)return console.warn("Missing required parameters in listenAllProductStock"),o;try{const r=pi(e.businessID);if(!r)return console.warn("No collection reference available"),o;const i=he(r,te("productId","==",n),te("status","==","active"),te("isDeleted","==",!1));return Te(i,a=>{const c=a.docs.map(d=>d.data());s(c)},a=>{console.error("Error al escuchar documentos en tiempo real:",a),s([])})}catch(r){return console.error("Error al configurar listener:",r),o}},Jd=(e,n,s)=>{const o=()=>{};if(!e||!n||!s)return console.warn("Missing required parameters in listenAllProductStockByLocation"),o;try{const r=pi(e.businessID);if(!r)return console.warn("No collection reference available"),o;const i=he(r,te("location","==",n),te("isDeleted","==",!1),te("status","==","active"));return Te(i,a=>{const c=a.docs.map(d=>d.data());s(c)},a=>{console.error("Error al escuchar documentos en tiempo real:",a),s([])})}catch(r){return console.error("Error al configurar listener:",r),o}},_v=(e=null)=>{const n=D(q),[s,o]=m.useState([]),[r,i]=m.useState(!0);return m.useEffect(()=>{if(!e||!n){o([]),i(!1);return}i(!0);const a=Jd(n,e,c=>{o(c),i(!1)});return()=>a()},[n,e]),{data:s,loading:r}},mp=(e=null)=>{const n=D(q),s=m.useMemo(()=>n,[n]),[o,r]=m.useState([]),[i,a]=m.useState(!0);return m.useEffect(()=>{if(!e||!s){r([]),a(!1);return}a(!0);const c=Pz(s,e,d=>{r(u=>JSON.stringify(u)!==JSON.stringify(d)?d:u),a(!1)});return()=>c()},[s,e]),{data:o,loading:i}},Ya=async(e,{productId:n,batchId:s,location:o}={})=>{console.log("businessId: ",e.businessID),console.log("productId: ",n),console.log("batchId: ",s),console.log("location: ",o);const r=pi(e.businessID);if(!r)return[];const i=[te("isDeleted","==",!1)];n&&i.push(te("productId","==",n)),s&&i.push(te("batchId","==",s)),o&&i.push(te("location","==",o));const a=he(r,...i);return(await Me(a)).docs.map(d=>d.data())},Dz=async(e,{productId:n}={})=>{console.log("Fetching stock for productId:",n);const s=pi(e.businessID);if(!s)return[];const o=he(s,te("isDeleted","==",!1),te("productId","==",n),te("status","==","active")),i=(await Me(o)).docs.map(a=>a.data());return console.log("Fetched product stock:",i),i},Hv=async(e,n)=>{if(!n)return null;try{const s=F($,"businesses",e.businessID,"productsStock",n),o=await Se(s);return o.exists()?o.data():null}catch(s){throw console.error("Error al obtener producto en stock por ID:",s),s}},$z=()=>{const e=W(),n=D(q);return{checkProductStock:m.useCallback(async o=>{console.log("Checking stock for product ID:",o.id);try{const r=await Dz(n,{productId:o.id});return console.log("Fetched stock data:",r),r.length>1&&e(tv(o)),r}catch(r){return console.error("Error checking product stock:",r),!1}},[e,n])}},Rz=20,Fh=e=>e==null?void 0:e.restrictSaleWithoutStock,Nz=(e,n)=>!e||!n?!1:((n==null?void 0:n.amountToBuy)??0)>=((n==null?void 0:n.stock)??0),Oz=e=>(e==null?void 0:e.stock)<=0,Mz=e=>{if(!e)return!1;const n=(e.stock??0)-(e.amountToBuy??0);return n<Rz&&n>0},Fz=e=>{const n=D(Xb),s=m.useMemo(()=>Array.isArray(n)?typeof e!="string"&&typeof e!="number"?(console.error("Expected a string or number as the product ID"),null):n.find(o=>o.id===e)||null:(console.error("Expected an array from SelectProduct selector"),null),[n,e]);return m.useEffect(()=>{},[s]),{status:!!s,product:s}},Bz=(e,n)=>{if(!e&&!n)return{isLowStock:!1,isOutOfStock:!1};const s=e??n,o=!!e,r=m.useMemo(()=>Fh(s)?Mz(s):!1,[s]),i=m.useMemo(()=>Fh(s)?Nz(o,s)||Oz(s):!1,[s,o]);return{isLowStock:r,isOutOfStock:i}},Lz=(e,n)=>{const s=W(),[o,r]=m.useState({imageHidden:!1,weightEntryModalOpen:!1,isImageLoaded:!1}),i=m.useRef(!1),a=m.useRef(!1),c=m.useRef(!1),{status:d,product:u}=Fz(e.id),{isLowStock:p,isOutOfStock:h}=Bz(u,e),{checkProductStock:f}=$z(),x=m.useMemo(()=>tt(e,n),[e,n]),[g,y]=m.useState(!1),b=m.useCallback(async()=>{var C,I;try{if(y(!0),h){Be.warning({message:"Alerta de Stock Agotado",description:`El stock de ${e.name} está agotado`});return}if(p&&!d&&!i.current&&(Be.warning({message:"Alerta de Stock Bajo",description:`El stock de ${e.name} está por debajo de 20 unidades`}),i.current=!0),e.stock===5&&!a.current&&(Be.info({message:"Stock Crítico",description:`Solo quedan 5 unidades de ${e.name}`}),a.current=!0),(!(e!=null&&e.stock)||e.stock<=0)&&!(e!=null&&e.restrictSaleWithoutStock)&&!c.current&&(c.current=!0),u!=null&&u.productStockId&&(u!=null&&u.batchId)){s(Yn(u));return}if(!(e!=null&&e.stock)||e.stock<=0){if((C=e==null?void 0:e.weightDetail)!=null&&C.isSoldByWeight){r(k=>({...k,weightEntryModalOpen:!0}));return}s(Yn({...e,productStockId:null,batchId:null}));return}const j=await f(e);if(j.length===0&&(e!=null&&e.restrictSaleWithoutStock)){Be.info({message:"Stock no disponible",description:`Para vender ${e.name} necesitas tener stock disponible.`});return}if(j.length>1){s(tv(e));return}if(j.length===1){const[k]=j;s(Yn({...e,productStockId:k.id,batchId:k.batchId}));return}if((I=e==null?void 0:e.weightDetail)!=null&&I.isSoldByWeight){r(k=>({...k,weightEntryModalOpen:!0}));return}s(Yn({...e,productStockId:null,batchId:null}))}catch(j){Be.error({message:"Error",description:"No se pudo agregar el producto al carrito"}),console.error("Error adding product:",j)}finally{y(!1)}},[e,h,p,u,s,f]),v=m.useCallback(C=>{C&&C.stopPropagation(),s(_u(e.id))},[s,e.id]);return{productState:o,setProductState:r,isProductInCart:d,productInCart:u,isLowStock:p,isOutOfStock:h,price:x,handleGetThisProduct:b,deleteProductFromCart:v,isFirebaseLoading:g}},zz={hidden:{scale:.95,opacity:0},visible:{scale:1,opacity:1,transition:{duration:.3}}},Uz=l.div`
  position: absolute;
  transform: translateX(-90px) scale(0);
  transition: transform 0.6s ease-in-out 0.02s;

  .ant-spin {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
  }

  ${({imageHiddenRef:e})=>!e&&`
      position: relative;
      transform: translateX(0px) scale(1);
      transition: transform 1s ease-in-out 0.02s;
  `}
`,Wz=l.div`
  height: 80px;
  width: 80px;
  overflow: hidden;
  position: relative;
  padding: 4px;
  transition: transform 0.4s ease-in-out;

  img {
    height: 100%;
    width: 100%;
    object-fit: cover;
    object-position: center;
    border-radius: 7px;
  }
`,qz=l.div`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2;
  border-radius: var(--border-radius);
`,Vz=st.memo(({product:e,productState:n,setProductState:s,isFirebaseLoading:o})=>{const r=Iu(),[i]=Fb(e==null?void 0:e.image,Js);return t.jsxs(Uz,{imageHiddenRef:n.imageHidden,children:[t.jsxs(Wz,{imageHiddenRef:n.imageHidden,children:[!n.isImageLoaded&&t.jsx(He,{}),t.jsx("img",{src:r&&i||Js,alt:e.name,onLoad:()=>s(a=>({...a,isImageLoaded:!0})),style:{visibility:n.isImageLoaded?"visible":"hidden"}})]}),o&&t.jsx(qz,{children:t.jsx(He,{indicator:t.jsx(Yr,{style:{fontSize:24},spin:!0})})})]})}),Gz=l.div`
  display: flex;
  justify-content: space-between;
  padding: 0.1em 0.4em 0;
  font-size: 14px;
  font-weight: 600;
  color: var(--Gray6);
  letter-spacing: 0.4px;
`,_z=l.div`
  color: #2c3e50;
  width: 100%;
  font-size: 13px;
  line-height: 1.1;
  padding: 0.4em 0.4em 0;
  display: -webkit-box;
  font-weight: 600;
  letter-spacing: 0.2px;
  overflow: hidden;
  hyphens: auto;
`;function hp({product:e,isProductInCart:n,deleteProductFromCart:s}){return t.jsxs(Gz,{children:[t.jsx(_z,{children:Ro(e.name,40)}),n&&t.jsx(ke,{startIcon:z.operationModes.discard,width:"icon24",color:"on-error",borderRadius:"normal",onClick:s})]})}hp.propTypes={product:we.shape({name:we.string.isRequired}).isRequired,isProductInCart:we.bool,deleteProductFromCart:we.func};hp.displayName="ProductHeader";const Hz=m.memo(hp),Qz=l.div`
  position: absolute;
  ${({position:e})=>e==="top"?"top: 0;":"bottom: 0;"}
  left: 0;
  width: 90px;
  text-align: center;
  line-height: 1.2em;
  border-top-right-radius: 7px;
  padding: ${({position:e})=>e==="top"?"0.2em 0.4em 0.6em":"0.6em 0.4em 0.2em"};
  background: ${({variant:e,isSelected:n})=>{switch(e){case"outOfStock":return n?"linear-gradient(180deg, rgba(239, 83, 80, 0), #ef5350 50%)":"linear-gradient(180deg, rgba(158, 158, 158, 0), #9e9e9e 50%)";case"lowStock":return"linear-gradient(180deg, rgba(251, 140, 0, 0), #fb8c00 50%)";default:return"linear-gradient(180deg, rgba(158, 158, 158, 0), #9e9e9e 50%)"}}};
  transform: translateX(0) scale(1);
  transition: all 300ms ease-in-out;
  color: #ffffff;
  font-size: 14px;
  font-weight: 500;
  z-index: 1;
`,Bh=({message:e,position:n="top",isSelected:s=!1,show:o=!1,variant:r="outOfStock"})=>o?t.jsx(Qz,{position:n,isSelected:s,variant:r,children:e}):null,Yz=l.div`
  padding: 0 0.4em;
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  pointer-events: none;
  transition: 0.8s border-radius ease-in-out;
  border-top-left-radius: ${({imageHiddenRef:e})=>e===!1?"10px":"0"};
`,Lh=l.div`
  display: flex;
  align-items: center;
  gap: 1em;
`,Kz=l.div`
  padding: 0 0.4em;
  height: 1.6em;
  width: min-content;
  border-radius: 4px;
  display: flex;
  align-items: center;
  white-space: nowrap;
  transition: background-color 0.4s ease-in-out, color 0.4s ease-in-out;

  background-color: ${e=>Cz()};
  color: ${e=>vz(e)};

  font-size: 15px;
  font-weight: 600;
  letter-spacing: 0.2px;
`,zh=l.div`
  display: block;
  height: 100%;
  font-weight: 550;
  font-size: 16px;
  transition: color 0.4s ease-in-out;

  color: ${e=>jz(e)};
`,Jz=({productState:e,productInCart:n,product:s,price:o,isProductInCart:r,isLowStock:i,isOutOfStock:a})=>{var u;const c=a||i,d=(n==null?void 0:n.stock)??s.stock;return t.jsxs(Yz,{imageHiddenRef:e.imageHidden,children:[t.jsx(Lh,{children:t.jsxs(Kz,{isDisabled:c,isOutOfStock:a,isLowStock:i,isSelected:r,hasStrictStock:s.restrictSaleWithoutStock,children:[r&&`${mt(n.amountToBuy)} / `,d===0?"-":mt(d)]})}),t.jsx(Lh,{children:(u=s.weightDetail)!=null&&u.isSoldByWeight?t.jsxs(zh,{isDisabled:c,isOutOfStock:a,isLowStock:i,isSelected:r,hasStrictStock:s.restrictSaleWithoutStock,children:[Y(o)," / ",s.weightDetail.weightUnit]}):t.jsx(zh,{isDisabled:c,isOutOfStock:a,isLowStock:i,isSelected:r,hasStrictStock:s.restrictSaleWithoutStock,children:Y(o)})})]})},Xz=l(Ie.li)`
  box-shadow: 2px 2px 10px 2px rgba(0, 0, 0, 0.02);
  width: 100%;
  border-radius: var(--border-radius);
  display: flex;
  gap: 6px;
  overflow: hidden;
  background-color: #ffffff;
  position: relative;
  transition: outline 0.4s ease-in-out;
  height: ${({imageHiddenRef:e})=>e?"60px":"80px"};
  
  /* El outline sólo depende de si está seleccionado o no */
  outline: ${e=>yz(e)};

  &:hover {
    img {
      filter: brightness(105%);
      transition: 0.3s filter ease-in-out;
    }
  }
`,Zz=l.div`
  display: grid;
  width: 100%;
  grid-template-rows: 1fr min-content;
`,eU=m.memo(({product:e})=>{const n=D(os),{productState:s,setProductState:o,isProductInCart:r,productInCart:i,isLowStock:a,isOutOfStock:c,price:d,handleGetThisProduct:u,deleteProductFromCart:p,isFirebaseLoading:h}=Lz(e,n),f=c||a;return t.jsx(m.Fragment,{children:t.jsxs(Xz,{variants:zz,initial:"hidden",animate:"visible",onClick:u,imageHiddenRef:s.imageHidden,isSelected:r,isDisabled:f,isOutOfStock:c,isLowStock:a,hasStrictStock:e==null?void 0:e.restrictSaleWithoutStock,children:[t.jsx(Vz,{productState:s,setProductState:o,product:e,isFirebaseLoading:h}),t.jsx(Bh,{message:"Sin stock",position:"bottom",isSelected:r,show:c,variant:"outOfStock"}),t.jsx(Bh,{message:"Stock bajo",position:"bottom",isSelected:r,show:a&&!c,variant:"lowStock"}),t.jsxs(Zz,{children:[t.jsx(Hz,{product:e,isProductInCart:r,deleteProductFromCart:p}),t.jsx(Jz,{productState:s,productInCart:i,product:e,price:d,isProductInCart:r,isLowStock:a,isOutOfStock:c})]})]})})}),tU=({product:e})=>{const n=W(),s=()=>{n(Ru())};return t.jsxs(nU,{onClick:()=>s(),imageHiddenRef:!1,children:[t.jsx(sU,{imageHiddenRef:!1,children:t.jsx("div",{children:t.jsx(O,{icon:yw})})}),t.jsx(oU,{children:t.jsx(rU,{children:t.jsx(iU,{children:e.name})})})]})},nU=l.div`
  
    border-radius: 6px;
    border: 4px solid rgb(250, 234, 89);
    background-color: rgb(250, 234, 89);
    overflow: hidden;
    display: grid;
    gap: 10px;
    grid-template-columns: min-content 1fr;
    transition: 400ms all ease-in-out;
   
    ${e=>{switch(e.imageHiddenRef){case!0:return`
                    height: 60px;
                `;case!1:return`
                    height: 80px;
                `}}}
   
${e=>{switch(e.container){case"row":return`
                grid-template-columns: min-content 1fr;
                height: 80px;
                overflow: hidden;
                `;default:return`
          `}}}
`,sU=l.div`
    overflow: hidden;
    display: flex;
    height: 100%;
    width: 80px;
    border-radius: 6px;
   // background-color: green;
    padding: 4px;
    transition: all 400ms ease-in-out;
    ${e=>{switch(e.imageHiddenRef){case!1:return`
                
                
                div{
                    display:flex;
                    justify-content: center;
                    align-items: center;
                    border-radius: 6px;
                    height: 100%;
                    width: 100%;
                    background-color: #f3f3f3b2;
                    svg{
                        font-size: 2em;
                        color: #000000b2;

                    }
                }
                
                `;case!0:return`
                    height: 60px;
                    display:flex;
                     justify-content: center;
                    align-items: center;
                    svg{
                        width: 60px;
                        font-size: 2em;
                    }
                    
                `}}}
    span{
        display: flex;
        justify-content: center;
        align-items: center;
        height: 80px;
        width: 80px;
        font-weight: 700;
        height: 100%;
        color: rgba(0, 0, 0, 0.200);
        background-color: var(--White3);
        border-radius: 7px;
    }
;
    ${e=>{switch(e.type){case"row":return`
                height: 100px;
                width: 100px;
                `;case"normal":return`
                `;default:return`
          `}}}
    
`,oU=l.div`
     height: 100%;
    width: 100%;
    padding: 4px 0;
    position: relative;
    transition: 4000ms all ease-in-out;
    `,rU=l.div`
   
`,iU=l.div`
    color: var(--Gray6);
    width: 100%;
    font-size: 13.5px;
    line-height: 1pc;
    padding: 0 1em;
    padding-top: 0.4em;
    padding-right: 2em;
    display: -webkit-box;
    font-weight: 600;
    letter-spacing: 0.2px;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;  
    //white-space: nowrap;
    text-transform: capitalize;
    text-overflow: ellipsis;
    overflow: hidden;
`,aU=l.div`
  display: grid;
  grid-template-columns: ${({columns:e})=>`repeat(${e}, 1fr)`};
  gap: 0.4em;
  position: absolute;
  top: ${({top:e})=>`${e}px`};
  left: 0;
  width: 100%;
  height: ${({height:e})=>`${e}px`};
`,Qv=m.memo(({columns:e,top:n,height:s,products:o,virtualRow:r})=>{const i=m.useMemo(()=>Array.from({length:e}),[e]);return t.jsx(aU,{columns:e,top:n,height:s,children:i.map((a,c)=>{const d=r.index*e+c,u=o[d];return u?u.custom?t.jsx(tU,{product:u},u.id):t.jsx(eU,{product:u},u.id):null})})});Qv.propTypes={columns:we.number.isRequired,top:we.number.isRequired,height:we.number.isRequired,products:we.array.isRequired,virtualRow:we.object.isRequired};const Uh={600:1,900:2,1100:3,1500:4,1800:5,2100:6,2400:7,2700:8},cU=e=>{const n=Object.keys(Uh).find(s=>s>e);return Uh[n]||1},lU=({products:e,productsLoading:n})=>{const s=m.useRef(),[o,r]=m.useState(4),i=Fe(),a=m.useCallback(()=>{s.current&&r(cU(s.current.clientWidth))},[]),c=m.useCallback(ga.debounce(a,250),[]);m.useEffect(()=>(a(),window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c),c.cancel()}),[]);const d=e.length,u=88,p=h0({count:Math.ceil(d/o),getScrollElement:()=>s.current,estimateSize:()=>u}),h=()=>{const{INVENTORY_ITEMS:f}=re.INVENTORY_TERM;i(f)};return t.jsxs(dU,{ref:s,children:[n?t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%"},children:t.jsx(He,{spinning:n,size:"large"})}):t.jsx(uU,{totalSize:p.getTotalSize(),children:p.getVirtualItems().map(f=>t.jsx(Qv,{columns:o,top:f.start,height:u,products:e,virtualRow:f},f.key))}),e.length===0&&!n&&t.jsx(si,{text:"No hay Productos",buttonText:"Gestionar Productos",handleAction:h})]})},dU=l.div`
    height:  calc(100vh - 8.41em);
    @media ( width > 800px){
      height: calc(100vh - 5.3em);
    }
    padding: 0.4em;
    gap: 0.4em;
    border: 1px solid #ccc;
    border-radius: 4px;
    overflow: auto;
    width: 100%;
    position: relative;
    background-color: var(--color2);
  `,uU=l.div`
    height: ${({totalSize:e})=>`${e}px`};
    width: 100%;
    position: relative;
  `;function pU({products:e,productsLoading:n}){return t.jsxs(mU,{children:[t.jsx(pv,{}),t.jsx(lU,{products:e,productsLoading:n}),t.jsx(xz,{products:e})]})}const mU=l.div`
  height: 100%;
  background-color: ${e=>e.theme.bg.color2}; 
  overflow: hidden;
  border-radius: var(--border-radius-light);
  display: grid;
  grid-template-rows: min-content 1fr;
  border-top-left-radius: 0;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
  
  position: relative;
`,hU=e=>e.slice(2,7),gU=e=>e.slice(-6),fU=e=>{const n=parseInt(e.slice(0,2),10),s=parseInt(e.slice(2),10);let o=n+s/1e4;return parseFloat(o.toFixed(3))},xU=()=>{const s=D(Tc).data.totalPurchase.value;return t.jsx(bU,{children:t.jsx(Ha,{title:"Total a cobrar",valueType:"price",value:s})})},bU=l.div`
    background-color: var(--White2);
    display: grid;
`,{Input:yU,Form:Yv,Checkbox:vU,InputNumber:Wh,message:qh,notification:jU}=Ne,CU=()=>{const e=W(),n=m.useRef(null),s=D(Tc),o=D(ND),r=s.data,i=r.paymentMethod,a=r.totalPurchase.value,c={cash:{label:"Efectivo",icon:z.finances.money},card:{label:"Tarjeta",icon:z.finances.card},transfer:{label:"Transferencia",icon:z.finances.transfer}};m.useEffect(()=>{n.current&&document.activeElement!==n.current&&i.some(h=>h.method==="cash"&&h.status)&&(n.current.focus(),n.current.select())},[]),m.useEffect(()=>{if(i.reduce((f,x)=>x.status?f+(Number(x.value)||0):f,0)===0&&a>0){const f=i.find(x=>x.method==="cash"&&x.status);f&&f.value===0&&e(Ws({...f,value:a}))}},[a]),m.useEffect(()=>{if(r.isAddedToReceivables&&!i.some(f=>f.status)){const f=i.find(x=>x.method==="cash")||i[0];f&&(e(Ws({...f,status:!0,value:0})),e(Tr()))}},[r.isAddedToReceivables,i,e]);const d=(h,f)=>{let x=h.value;if(f&&(!x||x===0)){const y=i.reduce((v,C)=>C.status&&C.method!==h.method?v+(Number(C.value)||0):v,0),b=a-y;x=b>0?b:0}const g=r.isAddedToReceivables;if(!f&&g&&i.filter(b=>b.status).length===1){qh.warning("Debe seleccionar al menos un método de pago");return}e(Ws({...h,status:f,value:f?x:0})),e(Tr())},u=(h,f)=>{const x=Math.max(0,Number(f)||0);f<0&&qh.warning("No se permiten montos negativos en los métodos de pago"),e(Ws({...h,value:x})),e(Tr())},p=(h,f)=>{e(Ws({...h,reference:f}))};return m.useEffect(()=>{o&&(jU.success({message:"Cuenta por Cobrar Actualizada",description:"La venta se removió automáticamente de Cuentas por Cobrar porque el pago cubre el total de la compra.",duration:6,placement:"topRight"}),e(DD()))},[o,e]),t.jsx(wU,{children:t.jsx(Yv,{layout:"vertical",children:t.jsx(IU,{children:i.map(h=>t.jsxs(SU,{children:[t.jsx(vU,{checked:h.status,onChange:f=>d(h,f.target.checked)}),t.jsxs(Vh,{placeholder:"Método de pago",label:c[h.method].label,children:["                                        ",h.method==="cash"?t.jsx(Wh,{addonBefore:c[h.method].icon,placeholder:"$$$",value:h.value,disabled:!h.status,onChange:f=>u(h,f),ref:n,min:0,precision:2,step:.01,style:{width:"100%"}}):t.jsx(Wh,{addonBefore:c[h.method].icon,placeholder:"$$$",value:h.value,disabled:!h.status,onChange:f=>u(h,f),min:0,precision:2,step:.01,style:{width:"100%"}})]}),h.reference!==void 0&&t.jsx(Vh,{placeholder:"Método de pago",label:"Referencia",children:t.jsx(yU,{placeholder:"Referencia",disabled:!h.status,onChange:f=>p(h,f.target.value)})})]},h.method))})})})},wU=l.div`
    padding: 0em 0em;
   
`,SU=l.div`
    display: grid;  
    grid-template-columns: min-content 0.8fr 1fr;
    gap: 0.6em;
`,IU=l.div`

    display: grid;
    gap: 1em;
`,Vh=l(Yv.Item)`
            .ant-form-item-label {
                padding: 0;
            }
                margin: 0 ;
            svg{
                font-size: 1.2em;
                color: #414141;
            }
`,EU=()=>{var i,a;const n=D(Tc).data,s=(i=n==null?void 0:n.payment)==null?void 0:i.value,o=(a=n==null?void 0:n.change)==null?void 0:a.value,r=o<0;return t.jsxs(AU,{children:[t.jsx(Ha,{title:"Total Pagado",valueType:"price",value:s}),t.jsx(Ha,{title:r?"Faltante":"Devuelta",valueType:"price",value:o,color:!0})]})},AU=l.div`
 
    display: grid;
    gap: 1em;
    grid-template-columns: 1fr 1fr;
`,Dr=({textAlign:e,children:n})=>t.jsx(kU,{textAlign:e,children:n}),kU=l.div`
  width: 100%;
    display: flex;
    justify-content: ${e=>e.textAlign};
  `,_n=({cols:e,space:n,children:s})=>t.jsx(PU,{cols:e,space:n,children:s}),TU={true:"padding: 0.4em 0;",false:""},Gh={3:"grid-template-columns: 1fr 0.8fr 0.8fr;",default:"grid-template-columns: 1fr;"},PU=l.div`
   display: grid;
  align-items: center;
  gap: 0.4em;
  ${({space:e})=>TU[e]}
  ${({cols:e})=>Gh[e]||Gh.default}
  `,cs=()=>{const e=D(ft),n=D(ey);return(e==null?void 0:e.businessType)==="pharmacy"&&n},DU=({data:e})=>{const{products:n,NCF:s}=e,{taxReceipt:o}=D(zt),r=e.insuranceEnabled,i=({name:a,measurement:c,footer:d})=>`${a}${c?` Medida: [${c}]`:""}${d?` Pie: [${d}]`:""}`;return t.jsx($U,{children:t.jsx(RU,{children:(n==null?void 0:n.length)>0?n==null?void 0:n.map((a,c)=>{var d,u,p,h,f,x,g,y;return t.jsxs(NU,{children:[t.jsxs(_n,{cols:"3",children:[t.jsx(Dr,{children:(d=a==null?void 0:a.weightDetail)!=null&&d.isSoldByWeight?t.jsxs("div",{children:[(u=a==null?void 0:a.weightDetail)==null?void 0:u.weight," ",(p=a==null?void 0:a.weightDetail)==null?void 0:p.weightUnit," X ",Y(tt(Ks(a),o==null?void 0:o.enabled))]}):t.jsxs("div",{children:[(a==null?void 0:a.amountToBuy)||0," x ",ct(tt(Ks(a),o==null?void 0:o.enabled))]})}),t.jsx(Dr,{textAlign:"right",children:ct(Xn(a,s))}),t.jsx(Dr,{textAlign:"right",children:ct(tt(a,s))})]}),t.jsx(_n,{children:t.jsxs(OU,{children:[i(a)," "]})}),((h=a==null?void 0:a.warranty)==null?void 0:h.status)&&t.jsxs(_n,{children:[Ec((f=a==null?void 0:a.warranty)==null?void 0:f.quantity,(x=a==null?void 0:a.warranty)==null?void 0:x.unit)," de Garantía"]}),r&&((g=a==null?void 0:a.insurance)==null?void 0:g.mode)&&t.jsx(_n,{children:t.jsxs(MU,{children:["Cobertura de seguro: ",a.insurance.mode," - ",Y(a.insurance.value)]})}),(a==null?void 0:a.discount)&&((y=a==null?void 0:a.discount)==null?void 0:y.value)>0&&t.jsx(_n,{children:t.jsxs(BU,{children:["Descuento: -",Y(Bu(a)),"(",a.discount.type==="percentage"?`${a.discount.value}%`:"Monto fijo",")"]})}),(a==null?void 0:a.comment)&&t.jsx(_n,{children:t.jsx(FU,{children:a.comment})})]},c)}):null})})},$U=l.div`
 
`,RU=l.div`
      display: block;
    border: none;
    padding: 0;
    list-style: none;
    line-height: 22px;
`,NU=l.div`
    width: 100%;

    &:nth-child(1n) {
            border-bottom: 1px dashed black;
        }

        &:last-child {
            border-bottom: none;
        }
`,OU=l.div`
        width: 100%;
        grid-column: 1 / 4;
        line-height: 1.4pc;
        text-transform: capitalize;
     
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        //white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
`,MU=l.div`
    font-size: 1em;
    font-style: italic;
`,FU=l.div`
    font-size: 0.9em;
    font-style: italic;
    color: #444;
    word-wrap: break-word;
    white-space: pre-wrap;
    padding-left: 8px;
    border-left: 1px dotted #888;
    margin: 2px 0;
`,BU=l.div`
    font-size: 0.9em;
    font-weight: 600;
    color: #52c41a;
    padding-left: 8px;
    border-left: 2px solid #52c41a;
    margin: 2px 0;
`,LU=l.div`
    width: 100%;
    margin: 0;
    padding: 3mm; 
    line-height: 20px;
    font-size: 11px;
    background-color: white;
    text-transform: uppercase;
    font-family: 'Lato', sans-serif;
    pointer-events: none;
    p {
        line-height: 16px;
    }
    @media print {
        margin: 0;
        
        pointer-events: auto;
    }
`,zU=l.div`
    display: ${({ignoreHidden:e})=>!e&&"none"};
`;l.p`
    font-size: 18px;
    font-weight: 600;
    padding: 0.2em 0;
    text-align: center;
    margin: 0;
`;function us({label:e,value:n,align:s="left",textTransform:o="",justifyContent:r=""}){return t.jsxs(UU,{textTransform:o,justifyContent:r,children:[e&&t.jsxs(Kv,{align:s,children:[e," ",n&&": "]}),n&&t.jsx("span",{children:n})]})}const UU=l.div`
    display: flex;
    gap: 12px;
    text-transform: ${e=>e.textTransform};
    justify-content: ${e=>e.justifyContent};
`,WU=l.p`
    display: flex;
    font-weight: 600;
    line-height: 12px;
    padding: 0;
    margin: 0;
    white-space: nowrap;
    
    justify-content: ${({align:e})=>e};
`,Kv=l.p`
    margin: 0;
    padding: 0.2em 0;
    text-transform: uppercase;
    ${({align:e})=>{switch(e){case"center":return"text-align: center;";case"right":return"text-align: right;";default:return"text-align: left;"}}}
`;l.div`
    border: none;
    border-top: 1px dashed black;
`;const Ka=l.div`
    margin-bottom: 0.8em;
    ${({size:e})=>{switch(e){case"small":return"margin-bottom: 0.2em;";case"medium":return"margin-bottom: 0.8em;";case"large":return"margin-bottom: 1.6em;";default:return"margin-bottom: 0.8em;"}}}
`,_h={Container:LU,HiddenPrintWrapper:zU},qU=({data:e})=>{var g,y,b,v,C,I,j,k,A,P,w,S;const[n,s]=m.useState(0),o=D(q),r=D(ey),i=o==null?void 0:o.businessID,a=(g=e==null?void 0:e.client)==null?void 0:g.id,c=Nn((e==null?void 0:e.products)||[])+$s((e==null?void 0:e.products)||[]),d=is(c,((y=e==null?void 0:e.discount)==null?void 0:y.value)||0),u=Fu((e==null?void 0:e.products)||[]),p=u>0,h=E=>Y(E,"");Ho(i,a,s);const f={cash:"Efectivo",card:"Tarjeta",transfer:"Transferencia"},x=[{label:"ENVÍO",value1:null,value2:h((b=e==null?void 0:e.delivery)==null?void 0:b.value),condition:(v=e==null?void 0:e.delivery)==null?void 0:v.status},{label:"SUBTOTAL",value2:h(c),condition:!0},{label:"DESCUENTO GENERAL",value2:h(d),condition:!p&&d>0},{label:"DESCUENTOS PRODUCTOS",value2:h(u),condition:p},{label:"COBERTURA SEGURO",value2:h(((C=e==null?void 0:e.totalInsurance)==null?void 0:C.value)||0),condition:r&&((I=e==null?void 0:e.totalInsurance)==null?void 0:I.value)>0},...((j=e==null?void 0:e.paymentMethod)==null?void 0:j.filter(E=>(E==null?void 0:E.status)===!0).map(E=>({label:f[E==null?void 0:E.method],value2:h(E==null?void 0:E.value),condition:!0})))||[],{subtitle:"TOTAL",value1:h((k=e==null?void 0:e.totalTaxes)==null?void 0:k.value),value2:h((A=e==null?void 0:e.totalPurchase)==null?void 0:A.value),condition:!0,spacingEnd:!0,spacingStart:!0},{label:((P=e==null?void 0:e.change)==null?void 0:P.value)>=0?"CAMBIO":"FALTANTE",value2:h((w=e==null?void 0:e.change)==null?void 0:w.value),condition:!0},{label:"BALANCE ACTUAL",value2:h(n),condition:((S=e==null?void 0:e.change)==null?void 0:S.value)<0}];return t.jsx(GU,{children:x.map((E,T)=>t.jsx(VU,{row:E},T))})},VU=({row:{subtitle:e,label:n,value1:s,value2:o,condition:r,textAlign:i,spacingEnd:a,spacingStart:c,line:d}})=>t.jsxs(m.Fragment,{children:[c&&t.jsx(Ka,{}),r&&t.jsxs(_n,{cols:"3",children:[e&&t.jsxs(Xd,{children:[e," : "]}),n&&t.jsxs(Kv,{children:[n," : "]}),t.jsx(Dr,{textAlign:i||"right",children:s}),e?t.jsx(WU,{align:i||"right",children:o}):t.jsx(Dr,{textAlign:i||"right",children:o})]}),a&&t.jsx(Ka,{}),d&&t.jsx(Ir,{})]}),GU=l.div`
padding-top: 0.6em;
`,_U=({data:e,Space:n})=>{var i,a,c,d,u,p,h,f;let s=D(ft)||"";const o=(s==null?void 0:s.logoUrl)||(s==null?void 0:s.logo)||null,r=e!=null&&e.date?Ve.convertMillisToISODate(Ve.convertTimestampToMillis(e.date),"dd/MM/yyyy HH:mm"):ce.now().toFormat("dd/MM/yyyy HH:mm");return t.jsxs(HU,{children:[o&&t.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"20px",width:"100%",maxHeight:"100px",overflow:"hidden"},children:t.jsx("div",{style:{width:"150px",height:"auto"},children:t.jsx("img",{src:o,alt:"Logo",style:{width:"100%",height:"100%",objectFit:"contain"}})})}),t.jsx(QU,{children:s==null?void 0:s.name}),t.jsx(us,{align:"center",label:s==null?void 0:s.address,justifyContent:"center"}),t.jsx(us,{align:"center",label:Dn(s==null?void 0:s.tel),justifyContent:"center"}),t.jsx(Ka,{size:"large"}),t.jsx(us,{label:"Fecha",value:r}),(e==null?void 0:e.NCF)&&t.jsx(us,{label:"NCF",value:e==null?void 0:e.NCF}),t.jsx(Ka,{}),(e==null?void 0:e.client)&&t.jsxs("div",{children:[t.jsx(us,{label:"CLIENTE",value:((a=(i=e==null?void 0:e.client)==null?void 0:i.name)==null?void 0:a.toUpperCase())||"CLIENTE GENERICO"}),((c=e==null?void 0:e.client)==null?void 0:c.personalID)&&t.jsx(us,{label:"CEDULA/RNC",value:(d=e==null?void 0:e.client)==null?void 0:d.personalID}),((u=e==null?void 0:e.client)==null?void 0:u.tel)&&t.jsx(us,{label:"TEL",value:Dn((p=e==null?void 0:e.client)==null?void 0:p.tel)}),((h=e==null?void 0:e.client)==null?void 0:h.address)&&t.jsx(us,{label:"DIR",value:(f=e==null?void 0:e.client)==null?void 0:f.address})]})]})},HU=l.div`
    margin-top: 1em;
    margin-bottom: 0.6em;
`,QU=l.p`
    font-size: 16px;
    font-weight: 600;
    padding: 0.2em 0;
    text-align: center;
    margin: 0;
    
`;l.div`
    display: flex;
    gap: 12px;
`;const YU=({data:e})=>{var s;if((s=e==null?void 0:e.products)==null?void 0:s.some(o=>{var r;return(r=o==null?void 0:o.warranty)==null?void 0:r.status}))return t.jsxs(KU,{children:[t.jsxs("div",{children:[t.jsx(Hh,{}),t.jsx(Qh,{children:"Despachado por"})]}),t.jsxs("div",{children:[t.jsx(Hh,{}),t.jsx(Qh,{children:"Recibido por"})]})]})},KU=l.div`
  display: grid;
  gap: 2em;
  padding: 0 0.4em;
  margin-top: 2.5em;
`,Hh=l.div`
  width: 100%;
  border-bottom: 1px solid black;
  padding: 0 10px;
`,Qh=l.span`
  font-size: 14px;
  color: #333;
`,JU=({message:e})=>e?t.jsx(XU,{children:t.jsx(ZU,{children:e})}):null,XU=l.div`
  /* display: flex;
  justify-content: center;
  align-items: center; */
  text-align: center;
  margin-top: 1em;
`,ZU=l.p`
  font-size: 12px;
  line-height: 1.6;
  color: #333;
  margin: 0;
`,Yh=st.forwardRef(({data:e,ignoreHidden:n},s)=>{var u,p;const o=D(ft)||"",r=e==null?void 0:e.insuranceEnabled,i=D(ep),a=D(Zb);function c(h){if(!h)return{type:"Desconocido",description:"RECIBO  DE PAGO"};const f=/(B0\d)/,x=h.match(f),g={B01:{type:"Crédito Fiscal",description:"FACTURA PARA CREDITO FISCAL"},B02:{type:"Consumidor Final",description:"FACTURA PARA CONUMIDOR FINAL"}};return x&&x[0]&&g[x[0]]?g[x[0]]:{type:"Desconocido",description:"RECIBO DE PAGO"}}const d=(u=c(e==null?void 0:e.NCF))==null?void 0:u.description;return e?t.jsx(_h.HiddenPrintWrapper,{ignoreHidden:n,children:t.jsxs(_h.Container,{ref:s,children:[t.jsx(_U,{data:e,Space:Kh,SubTitle:Xd,P:Ln}),t.jsx(Kh,{}),t.jsx(Ir,{}),t.jsx(_n,{space:!0,children:t.jsxs(Xd,{align:"center",children:[" ",d]})}),t.jsx(Ir,{}),t.jsxs(_n,{cols:"3",space:!0,children:[t.jsx(Ln,{children:"DESCRIPCION"}),t.jsx(Ln,{align:"right",children:"ITBIS"}),t.jsx(Ln,{align:"right",children:"VALOR"})]}),t.jsx(Ir,{}),t.jsx(DU,{data:e}),t.jsx(Ir,{}),t.jsx(qU,{P:Ln,data:e}),r&&t.jsxs(e9,{children:[t.jsx(Ln,{align:"center",children:"Cobertura de Seguro Aplicada"}),i.authNumber&&t.jsxs(Ln,{align:"center",children:["No. Autorización: ",i.authNumber]})]}),a&&t.jsxs(t9,{children:[t.jsx(Ln,{align:"center",className:"comment-title",children:"Comentario de Factura:"}),t.jsx(Ln,{align:"center",className:"comment-text",children:a})]}),t.jsx(YU,{data:e}),t.jsx(JU,{message:(p=o==null?void 0:o.invoice)==null?void 0:p.invoiceMessage})]})}):null}),Xd=l.p`
    font-weight: 600;
    line-height: 12px;
    padding: 0 0;
    margin: 0;
    white-space: nowrap;
    
    ${e=>{switch(e.align){case"center":return"text-align: center;";case"right":return"text-align: right;";default:return"text-align: left;"}}}
`,Ln=l.p`
   
    margin: 0;
    padding: 0.2em 0;
    text-transform: uppercase;
    ${e=>{switch(e.align){case"center":return"text-align: center;";case"right":return"text-align: right;";default:return"text-align: left;"}}}
   
`,Ir=l.div`
    border: none;
    border-top: 1px dashed black;
`,Kh=l.div`
 margin-bottom: 0.6em;
 ${e=>{switch(e.size){case"small":return"margin-bottom: 0.2em;";case"medium":return"margin-bottom: 0.8em;";case"large":return"margin-bottom: 1.6em;";default:return"margin-bottom: 0.8em;"}}}

`,e9=l.div`
    margin: 0.5em 0;
    padding: 0.5em 0;
    border-top: 1px dashed black;
    border-bottom: 1px dashed black;
`,t9=l.div`
    margin: 0.5em 0;
    padding: 0.5em 0;
    border-top: 1px dashed black;
    border-bottom: 1px dashed black;
    
    .comment-title {
        font-weight: 600;
    }
    
    .comment-text {
        font-style: italic;
        word-wrap: break-word;
        white-space: pre-wrap;
    }
`,n9=e=>e?e.startsWith("B01")?{title:"FACTURA DE CRÉDITO FISCAL",label:"NCF"}:e.startsWith("B02")?{title:"FACTURA DE CONSUMO",label:"NCF"}:{title:"COMPROBANTE FISCAL",label:"NCF"}:{title:"RECIBO DE PAGO",label:"Número de Recibo"},bl=e=>e&&e.seconds?new Date(e.seconds*1e3).toLocaleDateString():"";function s9({business:e,data:n}){var o,r,i,a,c,d;const s=n9(n==null?void 0:n.NCF);return t.jsxs(o9,{children:[(e==null?void 0:e.logoUrl)&&t.jsx(d9,{children:t.jsx("img",{src:e.logoUrl,alt:"Company Logo"})}),t.jsxs(i9,{children:[t.jsxs(Jv,{children:[t.jsx(c9,{children:(e==null?void 0:e.name)||"Ventamax Dev"}),t.jsx("p",{children:e==null?void 0:e.address}),(e==null?void 0:e.tel)&&t.jsxs("p",{children:[t.jsx(O,{icon:rc})," ",e==null?void 0:e.tel]}),(e==null?void 0:e.email)&&t.jsxs("p",{children:[t.jsx(O,{icon:sc})," ",e==null?void 0:e.email]}),(e==null?void 0:e.rnc)&&t.jsxs("p",{children:[" RNC: ",e==null?void 0:e.rnc]})]}),t.jsxs(Jh,{children:[t.jsx(r9,{children:s.title}),t.jsxs("p",{children:["Fecha: ",bl(n==null?void 0:n.date)]}),t.jsxs("p",{children:["Factura ",(n==null?void 0:n.type)==="preorder"?"Pedido":n==null?void 0:n.type," #"," ",n==null?void 0:n.numberID]}),((o=n==null?void 0:n.preorderDetails)==null?void 0:o.date)&&t.jsxs("p",{children:["Fecha de pedido: ",bl((r=n==null?void 0:n.preorderDetails)==null?void 0:r.date)]}),(n==null?void 0:n.dueDate)&&t.jsxs("p",{children:["Fecha que vence: ",bl(n==null?void 0:n.dueDate)]}),(n==null?void 0:n.NCF)&&t.jsx(l9,{children:t.jsxs("p",{children:["NCF: ",n==null?void 0:n.NCF]})})]})]}),t.jsxs(a9,{children:[t.jsxs("div",{style:{display:"flex",gap:"1em"},children:[t.jsxs("span",{children:[((i=n==null?void 0:n.client)==null?void 0:i.name)&&t.jsxs("p",{children:[t.jsx("strong",{children:"Cliente:"})," ",n.client.name]}),((a=n==null?void 0:n.client)==null?void 0:a.address)&&t.jsxs("p",{children:["Dirección: ",n.client.address]})]}),t.jsxs("span",{children:[((c=n==null?void 0:n.client)==null?void 0:c.tel)&&t.jsxs("p",{children:["Tel: ",n.client.tel]}),((d=n==null?void 0:n.client)==null?void 0:d.personalID)&&t.jsxs("p",{children:["RNC: ",n.client.personalID]})]})]}),t.jsx(Jh,{children:(n==null?void 0:n.comprobante)&&t.jsxs("p",{children:[s.label,": ",n.comprobante]})})]})]})}const o9=l.div`
    margin: 1em;
`,r9=l.h1`
  font-size: 1.1rem;
  margin-bottom: 1rem;
`,i9=l.div`
  display: flex;
  justify-content: space-between;
  margin-bottom: 0em;
`,Jv=l.div`
  line-height: 1.2;
  font-size: 14px;
  p {
    margin: 0.5em 0;
  }
`,a9=l(Jv)`
  display: grid;
  grid-template-columns: 1fr 1fr;
`,c9=l.h2`
  font-weight: bold;
  font-size: 1.25rem;
`,Jh=l.div`
  display: grid;
  justify-content: end;
  text-align: right;
  font-size: 14px;
`,l9=l.div`

  font-size: 14px;
  text-align: right;
`,d9=l.div`
  max-width: 200px;
  height: 40px;
  margin-bottom: 1em;

  img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: left center;
  }
`,u9=[{title:"CANT.",dataIndex:"amountToBuy",key:"quantity"},{title:"CODIGO",dataIndex:"barcode",key:"code"},{title:"DESCRIPCION",dataIndex:"name",key:"description"},{title:"PRECIO",dataIndex:"pricing",key:"price",align:"right",render:e=>e.price.toFixed(2)},{title:"ITBIS",dataIndex:"pricing",key:"itbis",align:"right",render:e=>(e.price*Number(e.tax)/100).toFixed(2)},{title:"TOTAL",key:"total",align:"right",render:(e,n)=>{const s=n.pricing.price,o=s*Number(n.pricing.tax)/100;return((s+o)*n.amountToBuy).toFixed(2)}}];function p9({data:e}){return t.jsx(h9,{children:t.jsx(m9,{children:t.jsx(Gt,{size:"small",columns:u9,dataSource:(e==null?void 0:e.products)||[],rowKey:n=>n.id,pagination:!1})})})}const m9=l.div`
  margin-top: 16px;
  @media print {
    margin-top: 0;
    
  }
`,h9=l.div`
  padding: 0 2em;
  /* border: 1px solid green; */
`,g9={cash:"Efectivo",transfer:"Transferencia",card:"Tarjeta"};function f9({business:e,data:n}){var i,a,c,d,u,p,h,f,x,g;const s=Nn((n==null?void 0:n.products)||[]),o=is(s,((i=n==null?void 0:n.discount)==null?void 0:i.value)||0),r={subtotal:Y(((a=n==null?void 0:n.totalPurchaseWithoutTaxes)==null?void 0:a.value)||0),discount:`-${Y(o||0)}`,tax:Y(((c=n==null?void 0:n.totalTaxes)==null?void 0:c.value)||0),delivery:Y(((d=n==null?void 0:n.delivery)==null?void 0:d.value)||0),total:Y(((u=n==null?void 0:n.totalPurchase)==null?void 0:u.value)||0)};return t.jsx(v9,{children:t.jsxs(S9,{children:[t.jsxs(y9,{children:[t.jsxs(x9,{children:[t.jsx(Xh,{label:"Despachado Por:"}),t.jsx(Xh,{label:"Recibido Conforme:"})]}),t.jsxs(b9,{children:[t.jsxs("div",{children:[((p=n==null?void 0:n.seller)==null?void 0:p.name)&&t.jsxs("p",{children:["Vendedor: ",n.seller.name]}),((h=n==null?void 0:n.paymentMethod)==null?void 0:h.length)>0&&t.jsxs(C9,{children:[t.jsx(w9,{children:"Métodos de Pago:"}),n.paymentMethod.map((y,b)=>(y==null?void 0:y.status)&&t.jsxs("p",{style:{margin:0},children:[g9[y.method.toLowerCase()]||y.method,":  ",Y(y.value||0),y.reference&&` - Ref: ${y.reference}`]},b))]})]}),t.jsx("div",{children:t.jsx("p",{children:(n==null?void 0:n.copyType)||"COPIA"})})]})]}),t.jsxs(j9,{children:[t.jsxs(sr,{children:[t.jsx("span",{children:"Sub-Total:"}),t.jsx("span",{className:"value",children:r.subtotal})]}),t.jsxs(sr,{children:[t.jsx("span",{children:"ITBIS:"}),t.jsx("span",{className:"value",children:r.tax})]}),(f=n==null?void 0:n.discount)!=null&&f.value?t.jsxs(sr,{children:[t.jsxs("span",{children:["Descuento (%",(x=n==null?void 0:n.discount)==null?void 0:x.value,"):"]}),t.jsx("span",{className:"value",children:r.discount})]}):null,((g=n==null?void 0:n.delivery)==null?void 0:g.status)&&t.jsxs(sr,{children:[t.jsx("span",{children:"Delivery :"}),t.jsxs("span",{className:"value",children:[" ",r.delivery]})]}),t.jsxs(sr,{className:"bold",children:[t.jsx("span",{children:"Total:"}),t.jsx("span",{className:"value",children:r.total})]})]})]})})}const Xh=({label:e})=>t.jsx("p",{style:{padding:"0.2em",width:"100%",marginTop:"1em",marginBottom:"0.2em",fontWeight:"500",color:"#1d1d1d",borderTop:"1px solid #1f1f1f"},children:e}),x9=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  column-gap: 2em;

`,b9=l.div`
    display: grid;
    grid-template-columns: 1fr 0.4fr;
    `,y9=l.div`
    display: grid;
  `,v9=l.div`
display: grid;
gap: 2em;
padding: 0 1em 1em 1em;
padding-top: 32px;
font-size: 0.875rem;
/* border: 1px solid red; */
`,j9=l.div`
/* display: grid; */

`,C9=l.div`
  /* margin-top: 1em; */
  font-size: 14px;
`,sr=l.div`
display: grid;
grid-template-columns: 1fr 1fr;
font-size: 14px;
gap: 1em;

span {
  white-space: nowrap;
}

&.bold {
  font-weight: bold;
}

.value {
  text-align: right;
}
`,w9=l.p`
  font-weight: bold;
  font-size: 14px;
`,S9=l.div`
    display: grid;
    grid-template-columns: 1fr 0.6fr;
    column-gap: 1em;
    align-items: end;
    `,I9=l.div`
position: relative;
  width: 100%;
  margin: 0;
  padding: 16px;

  @media print {
    padding: 0;
  }
`,E9=l.table`
  width: 100%;
  height: 100%;

  border-collapse: collapse;
`,A9=l.div`
  @media print {
    height: 310px; // 250px
    
  }

`,k9=l.div`
  height: 180px; // Adjust based on your footer height
`,T9=l.div`

  padding: 16px;
  /* background: #ffffff; */
  
  @media print {
    z-index: 10000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
`,P9=l.div`

  bottom: 0;
  left: 0;
  right: 0;
  padding: 16px;
  /* background: #ffffff; */
  z-index: 10000;

  @media print {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
  }
`,D9=st.forwardRef(({data:e,ignoreHidden:n},s)=>{const o=D(ft)||{};return e?t.jsx(I9,{style:{display:n?"block":"none"},children:t.jsxs(E9,{ref:s,children:[t.jsx(T9,{children:t.jsx(s9,{business:o,data:e})}),t.jsx("thead",{children:t.jsx("tr",{children:t.jsx("td",{children:t.jsx(A9,{})})})}),t.jsx("tbody",{children:t.jsx("tr",{children:t.jsx("td",{children:t.jsx(p9,{data:e})})})}),t.jsx("tfoot",{children:t.jsx("tr",{children:t.jsx("td",{children:t.jsx(k9,{})})})}),t.jsx(P9,{children:t.jsx(f9,{business:o,data:e})})]})}):null}),$9=e=>e?e.startsWith("B01")?{title:"FACTURA DE CRÉDITO FISCAL",label:"NCF"}:e.startsWith("B02")?{title:"FACTURA DE CONSUMO",label:"NCF"}:{title:"COMPROBANTE FISCAL",label:"NCF"}:{title:"RECIBO DE PAGO",label:"Número de Recibo"},yl=e=>e&&e.seconds?new Date(e.seconds*1e3).toLocaleDateString():"";function R9({business:e,data:n}){var o,r,i,a,c,d;const s=$9(n==null?void 0:n.NCF);return t.jsxs(N9,{children:[(e==null?void 0:e.logoUrl)&&t.jsx(z9,{children:t.jsx("img",{src:e.logoUrl,alt:"Company Logo"})}),t.jsxs(M9,{children:[t.jsxs(Xv,{children:[t.jsx(B9,{children:(e==null?void 0:e.name)||"Ventamax Dev"}),t.jsx("p",{children:e==null?void 0:e.address}),(e==null?void 0:e.tel)&&t.jsxs("p",{children:[t.jsx(O,{icon:rc})," ",e==null?void 0:e.tel]}),(e==null?void 0:e.email)&&t.jsxs("p",{children:[t.jsx(O,{icon:sc})," ",e==null?void 0:e.email]}),(e==null?void 0:e.rnc)&&t.jsxs("p",{children:[" RNC: ",e==null?void 0:e.rnc]})]}),t.jsxs(Zh,{children:[t.jsx(O9,{children:s.title}),t.jsxs("p",{children:["Fecha: ",yl(n==null?void 0:n.date)]}),t.jsxs("p",{children:["Factura ",(n==null?void 0:n.type)==="preorder"?"Pedido":n==null?void 0:n.type," #"," ",n==null?void 0:n.numberID]}),((o=n==null?void 0:n.preorderDetails)==null?void 0:o.date)&&t.jsxs("p",{children:["Fecha de pedido: ",yl((r=n==null?void 0:n.preorderDetails)==null?void 0:r.date)]}),(n==null?void 0:n.dueDate)&&t.jsxs("p",{children:["Fecha que vence: ",yl(n==null?void 0:n.dueDate)]}),(n==null?void 0:n.NCF)&&t.jsx(L9,{children:t.jsxs("p",{children:["NCF: ",n==null?void 0:n.NCF]})})]})]}),t.jsxs(F9,{children:[t.jsxs("div",{style:{display:"flex",gap:"1em"},children:[t.jsxs("span",{children:[((i=n==null?void 0:n.client)==null?void 0:i.name)&&t.jsxs("p",{children:[t.jsx("strong",{children:"Cliente:"})," ",n.client.name]}),((a=n==null?void 0:n.client)==null?void 0:a.address)&&t.jsxs("p",{children:["Dirección: ",n.client.address]})]}),t.jsxs("span",{children:[((c=n==null?void 0:n.client)==null?void 0:c.tel)&&t.jsxs("p",{children:["Tel: ",n.client.tel]}),((d=n==null?void 0:n.client)==null?void 0:d.personalID)&&t.jsxs("p",{children:["RNC: ",n.client.personalID]})]})]}),t.jsx(Zh,{children:(n==null?void 0:n.comprobante)&&t.jsxs("p",{children:[s.label,": ",n.comprobante]})})]})]})}const N9=l.div`
    margin: 1em;
`,O9=l.h1`
  font-size: 1.1rem;
  margin-bottom: 1rem;
`,M9=l.div`
  display: flex;
  justify-content: space-between;
  margin-bottom: 0em;
`,Xv=l.div`
  line-height: 1.2;
  font-size: 14px;
  p {
    margin: 0.5em 0;
  }
`,F9=l(Xv)`
  display: grid;
  grid-template-columns: 1fr 1fr;
`,B9=l.h2`
  font-weight: bold;
  font-size: 1.25rem;
`,Zh=l.div`
  display: grid;
  justify-content: end;
  text-align: right;
  font-size: 14px;
`,L9=l.div`

  font-size: 14px;
  text-align: right;
`,z9=l.div`
  max-width: 200px;
  height: 40px;
  margin-bottom: 1em;

  img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: left center;
  }
`,U9=[{title:"CANT.",dataIndex:"amountToBuy",key:"quantity"},{title:"CODIGO",dataIndex:"barcode",key:"code"},{title:"DESCRIPCION",dataIndex:"name",key:"description"},{title:"PRECIO",dataIndex:"pricing",key:"price",align:"right",render:e=>e.price.toFixed(2)},{title:"ITBIS",dataIndex:"pricing",key:"itbis",align:"right",render:e=>(e.price*Number(e.tax)/100).toFixed(2)},{title:"TOTAL",key:"total",align:"right",render:(e,n)=>{const s=n.pricing.price,o=s*Number(n.pricing.tax)/100;return((s+o)*n.amountToBuy).toFixed(2)}}];function W9({data:e}){return t.jsx(V9,{children:t.jsx(q9,{children:t.jsx(Gt,{size:"small",columns:U9,dataSource:(e==null?void 0:e.products)||[],pagination:!1})})})}const q9=l.div`
  margin-top: 16px;
  @media print {
    margin-top: 0;
    
  }
`,V9=l.div`
  padding: 0 2em;
  /* border: 1px solid green; */
`,G9={cash:"Efectivo",transfer:"Transferencia",card:"Tarjeta"};function _9({business:e,data:n}){var i,a,c,d,u,p,h,f,x,g;const s=Nn((n==null?void 0:n.products)||[]),o=is(s,((i=n==null?void 0:n.discount)==null?void 0:i.value)||0),r={subtotal:Y(((a=n==null?void 0:n.totalPurchaseWithoutTaxes)==null?void 0:a.value)||0),discount:`-${Y(o||0)}`,tax:Y(((c=n==null?void 0:n.totalTaxes)==null?void 0:c.value)||0),delivery:Y(((d=n==null?void 0:n.delivery)==null?void 0:d.value)||0),total:Y(((u=n==null?void 0:n.totalPurchase)==null?void 0:u.value)||0)};return t.jsx(K9,{children:t.jsxs(eW,{children:[t.jsxs(Y9,{children:[t.jsxs(H9,{children:[t.jsx(eg,{label:"Despachado Por:"}),t.jsx(eg,{label:"Recibido Conforme:"})]}),t.jsxs(Q9,{children:[t.jsxs("div",{children:[((p=n==null?void 0:n.seller)==null?void 0:p.name)&&t.jsxs("p",{children:["Vendedor: ",n.seller.name]}),((h=n==null?void 0:n.paymentMethod)==null?void 0:h.length)>0&&t.jsxs(X9,{children:[t.jsx(Z9,{children:"Métodos de Pago:"}),n.paymentMethod.map((y,b)=>(y==null?void 0:y.status)&&t.jsxs("p",{style:{margin:0},children:[G9[y.method.toLowerCase()]||y.method,":  ",Y(y.value||0),y.reference&&` - Ref: ${y.reference}`]},b))]})]}),t.jsx("div",{children:t.jsx("p",{children:(n==null?void 0:n.copyType)||"COPIA"})})]})]}),t.jsxs(J9,{children:[t.jsxs(or,{children:[t.jsx("span",{children:"Sub-Total:"}),t.jsx("span",{className:"value",children:r.subtotal})]}),t.jsxs(or,{children:[t.jsx("span",{children:"ITBIS:"}),t.jsx("span",{className:"value",children:r.tax})]}),(f=n==null?void 0:n.discount)!=null&&f.value?t.jsxs(or,{children:[t.jsxs("span",{children:["Descuento (%",(x=n==null?void 0:n.discount)==null?void 0:x.value,"):"]}),t.jsx("span",{className:"value",children:r.discount})]}):null,((g=n==null?void 0:n.delivery)==null?void 0:g.status)&&t.jsxs(or,{children:[t.jsx("span",{children:"Delivery :"}),t.jsxs("span",{className:"value",children:[" ",r.delivery]})]}),t.jsxs(or,{className:"bold",children:[t.jsx("span",{children:"Total:"}),t.jsx("span",{className:"value",children:r.total})]})]})]})})}const eg=({label:e})=>t.jsx("p",{style:{padding:"0.2em",width:"100%",marginTop:"1em",marginBottom:"0.2em",fontWeight:"500",color:"#1d1d1d",borderTop:"1px solid #1f1f1f"},children:e}),H9=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  column-gap: 2em;

`,Q9=l.div`
    display: grid;
    grid-template-columns: 1fr 0.4fr;
    `,Y9=l.div`
    display: grid;
  `,K9=l.div`
display: grid;
gap: 2em;
padding: 0 1em 1em 1em;
padding-top: 32px;
font-size: 0.875rem;
/* border: 1px solid red; */
`,J9=l.div`
/* display: grid; */

`,X9=l.div`
  /* margin-top: 1em; */
  font-size: 14px;
`,or=l.div`
display: grid;
grid-template-columns: 1fr 1fr;
font-size: 14px;
gap: 1em;

span {
  white-space: nowrap;
}

&.bold {
  font-weight: bold;
}

.value {
  text-align: right;
}
`,Z9=l.p`
  font-weight: bold;
  font-size: 14px;
`,eW=l.div`
    display: grid;
    grid-template-columns: 1fr 0.6fr;
    column-gap: 1em;
    align-items: end;
    `,lo=e=>`$${Number(e).toFixed(2)}`,tW=(e,n)=>e*n/100,nW={cash:"Efectivo",transfer:"Transferencia",card:"Tarjeta"};function sW({business:e,data:n}){const s=new wu,o=14,r=s.internal.pageSize.getWidth(),i=s.internal.pageSize.getHeight(),a=50,c=50,d=()=>{var j;s.setFontSize(16),s.text((e==null?void 0:e.name)||"Empresa",o,20),s.setFontSize(12);let x=28;e!=null&&e.address&&(s.text(e.address,o,x),x+=6),e!=null&&e.tel&&(s.text(`Tel: ${e.tel}`,o,x),x+=6),e!=null&&e.email&&(s.text(`Email: ${e.email}`,o,x),x+=6),e!=null&&e.rnc&&(s.text(`RNC: ${e.rnc}`,o,x),x+=6);const g=r-80;let y=20;const b=k=>k?k.startsWith("B01")?{title:"FACTURA DE CRÉDITO FISCAL",label:"NCF"}:k.startsWith("B02")?{title:"FACTURA DE CONSUMO",label:"NCF"}:{title:"COMPROBANTE FISCAL",label:"NCF"}:{title:"RECIBO DE PAGO",label:"Número de Recibo"},v=k=>k&&k.seconds?new Date(k.seconds*1e3).toLocaleDateString():"",C=b(n==null?void 0:n.NCF);s.setFontSize(12),s.text(C.title,g,y),y+=6,s.text(`Fecha: ${v(n==null?void 0:n.date)}`,g,y),y+=6;const I=(n==null?void 0:n.type)==="preorder"?"Pedido":n==null?void 0:n.type;s.text(`Factura ${I} # ${n==null?void 0:n.numberID}`,g,y),y+=6,(j=n==null?void 0:n.preorderDetails)!=null&&j.date&&(s.text(`Fecha de pedido: ${v(n.preorderDetails.date)}`,g,y),y+=6),n!=null&&n.dueDate&&(s.text(`Fecha que vence: ${v(n.dueDate)}`,g,y),y+=6),n!=null&&n.NCF&&(s.text(`NCF: ${n.NCF}`,g,y),y+=6)},u=()=>{var E,T,R,N,G,Q,ae;const g=i-c-10;s.setLineWidth(.5),s.line(o,g-5,r-o,g-5);let y=o,b=g;const v=70;s.setFontSize(10),s.line(y,b,y+v,b),s.text("Despachado Por:",y,b+5),b+=20,s.line(y,b,y+v,b),s.text("Recibido Conforme:",y,b+5);let C=g;(E=n==null?void 0:n.seller)!=null&&E.name&&s.text(`Vendedor: ${n.seller.name}`,y,C-10),n!=null&&n.paymentMethod&&n.paymentMethod.length>0&&(s.setFont(void 0,"bold"),s.text("Métodos de Pago:",y,C),s.setFont(void 0,"normal"),C+=6,n.paymentMethod.forEach(oe=>{if(oe!=null&&oe.status){let J=`${nW[oe.method.toLowerCase()]||oe.method}: ${lo(oe.value||0)}`;oe.reference&&(J+=` - Ref: ${oe.reference}`),s.text(J,y,C),C+=6}}));const I=o+(r-2*o)/2;s.text((n==null?void 0:n.copyType)||"COPIA",I,g-10);const j=((T=n==null?void 0:n.totalPurchaseWithoutTaxes)==null?void 0:T.value)||0,k=((R=n==null?void 0:n.discount)==null?void 0:R.value)||0,A=tW(j,k),P={subtotal:lo(j),discount:`-${lo(A)}`,tax:lo(((N=n==null?void 0:n.totalTaxes)==null?void 0:N.value)||0),delivery:lo(((G=n==null?void 0:n.delivery)==null?void 0:G.value)||0),total:lo(((Q=n==null?void 0:n.totalPurchase)==null?void 0:Q.value)||0)};let w=g;const S=6;s.setFontSize(12),s.text("Sub-Total:",I,w),s.text(P.subtotal,r-o,w,{align:"right"}),w+=S,s.text("ITBIS:",I,w),s.text(P.tax,r-o,w,{align:"right"}),w+=S,k&&(s.text(`Descuento (%${k}):`,I,w),s.text(P.discount,r-o,w,{align:"right"}),w+=S),(ae=n==null?void 0:n.delivery)!=null&&ae.status&&(s.text("Delivery:",I,w),s.text(P.delivery,r-o,w,{align:"right"}),w+=S),s.setFont(void 0,"bold"),s.text("Total:",I,w),s.text(P.total,r-o,w,{align:"right"}),s.setFont(void 0,"normal")},p=["CANT.","CODIGO","DESCRIPCION","PRECIO","ITBIS","TOTAL"],h=[];n==null||n.products.forEach(x=>{const g=x.pricing.price,y=g*Number(x.pricing.tax)/100,b=((g+y)*x.amountToBuy).toFixed(2),v=[x.amountToBuy,x.barcode,x.name,g.toFixed(2),y.toFixed(2),b];for(let C=0;C<10;C++)h.push(v)});const f=a+10;s.autoTable({head:[p],body:h,startY:f,margin:{top:a,bottom:c},didDrawPage:function(){d(),u()}}),s.save("factura.pdf")}const oW=l.div`
position: relative;
  width: 100%;
  margin: 0;
  padding: 16px;

  @media print {
    padding: 0;
  }
`,rW=l.table`
  width: 100%;
  height: 100%;

  border-collapse: collapse;
`,iW=l.div`
  @media print {
    height: 310px; // 250px
    
  }

`,aW=l.div`
  height: 180px; // Adjust based on your footer height
`,cW=l.div`

  padding: 16px;
  /* background: #ffffff; */
  
  @media print {
    z-index: 10000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
`,lW=l.div`

  bottom: 0;
  left: 0;
  right: 0;
  padding: 16px;
  /* background: #ffffff; */
  z-index: 10000;

  @media print {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
  }
`,dW=st.forwardRef(({data:e,ignoreHidden:n},s)=>{const o=D(ft)||{},r=()=>{sW({business:o,data:e})};return e?t.jsxs(oW,{style:{display:n?"block":"none"},children:[t.jsx("button",{onClick:r,children:"Generar PDF"}),t.jsxs(rW,{ref:s,children:[t.jsx(cW,{children:t.jsx(R9,{business:o,data:e})}),t.jsx("thead",{children:t.jsx("tr",{children:t.jsx("td",{children:t.jsx(iW,{})})})}),t.jsx("tbody",{children:t.jsx("tr",{children:t.jsx("td",{children:t.jsx(W9,{data:e})})})}),t.jsx("tfoot",{children:t.jsx("tr",{children:t.jsx("td",{children:t.jsx(aW,{})})})}),t.jsx(lW,{children:t.jsx(_9,{business:o,data:e})})]})]}):null}),tn=40,hn=(e,n=tn)=>{if(e.length<=n)return e;const s=n,o=e.slice(0,s),r=e.slice(s);return o+`
`+hn(r,n)},vl=(e,n=tn)=>hn(e,n).split(`
`).map(o=>Zv(o,n)).join(`
`),Zv=(e,n=tn)=>{const s=Math.floor((n-e.length)/2);return" ".repeat(s)+e},Wr=(e=tn)=>"-".repeat(e),Ft=(e,n,s="left")=>{let o=e.toString();if(o.length>n)return hn(o,n);if(s==="left")return o.padEnd(n," ");if(s==="right")return o.padStart(n," ");if(s==="center"){const r=Math.floor((n-o.length)/2);return" ".repeat(r)+o+" ".repeat(n-o.length-r)}},uW=e=>e.name+(e.measurement?` Medida: [${e.measurement}]`:"")+(e.footer?` Pie: [${e.footer}]`:""),pW=e=>{if(!e)return{type:"Desconocido",description:"RECIBO DE PAGO"};const n=/(B0\d)/,s=e.match(n),o={B01:{type:"Crédito Fiscal",description:"FACTURA PARA CREDITO FISCAL"},B02:{type:"Consumidor Final",description:"FACTURA PARA CONSUMIDOR FINAL"}};return s&&s[0]&&o[s[0]]?o[s[0]]:{type:"Desconocido",description:"RECIBO DE PAGO"}},mW=(e,n)=>{let s="";return s+=vl(e.name||"Nombre del Negocio")+`
`,s+=vl(e.address||"Dirección del Negocio")+`
`,s+=vl(n(e.tel)||"Teléfono")+`
`,s+=Wr()+`
`,s},hW=(e,n)=>{let s="";if(s+="Fecha: "+n+`
`,e!=null&&e.NCF){const o=pW(e.NCF);s+="NCF: "+e.NCF+`
`,s+=Zv(o.description)+`
`}return s+=Wr()+`
`,s},gW=(e,n)=>{var d;if(!e)return"";let s="";const o="CLIENTE: ",r=((d=e.name)==null?void 0:d.toUpperCase())||"CLIENTE GENERICO",i=tn-o.length,c=hn(r,i).split(`
`);s+=o+c[0]+`
`;for(let u=1;u<c.length;u++)s+=" ".repeat(o.length)+c[u]+`
`;if(e.personalID&&(s+="CEDULA/RNC: "+e.personalID+`
`),e.tel&&(s+="TEL: "+n(e.tel)+`
`),e.address){const u="DIR: ",p=tn-u.length,f=hn(e.address,p).split(`
`);s+=u+f[0]+`
`;for(let x=1;x<f.length;x++)s+=" ".repeat(u.length)+f[x]+`
`}return s+=Wr()+`
`,s},fW=(e,n,s,o,r,i,a)=>{let c="";if(c+=Ft("CANT/PRICE",13,"center")+Ft("ITBIS",10,"right")+Ft("TOTAL",17,"right")+`
`,c+=Wr()+`
`,Array.isArray(e)&&e.length>0)e.forEach(d=>{var x,g,y;let u="";(x=d==null?void 0:d.weightDetail)!=null&&x.isSoldByWeight?u=`${d.weightDetail.weight} ${d.weightDetail.weightUnit}x${ct(o(r(d),n==null?void 0:n.enabled))}`:u=`${d.amountToBuy||0} x ${ct(o(r(d),n==null?void 0:n.enabled))}`;const p=Ft(u,13,"left"),h=Ft(ct(s(d,a)).toString(),10,"right"),f=Ft(ct(o(d,a)).toString(),17,"right");if(c+=p+h+f+`
`,c+=hn(uW(d),tn)+`
`,d!=null&&d.discount&&((g=d==null?void 0:d.discount)==null?void 0:g.value)>0){const b=Bu(d),v=d.discount.type==="percentage"?`${d.discount.value}%`:"Monto fijo";c+=hn(`Descuento: -${i(b)} (${v})`,tn)+`
`}if((y=d==null?void 0:d.warranty)!=null&&y.status){const b=Ec(d.warranty.quantity,d.warranty.unit)+" de Garantía";c+=hn(b,tn)+`
`}});else{const d=Ft("1.0 x 530.00",13,"left"),u=Ft("80.85",10,"right"),p=Ft("530.00",17,"right");c+=d+u+p+`
`,c+=hn("FUNDA DE CEMENTO DOMICEN",tn)+`
`}return c+=Wr()+`
`,c},xW=(e,n,s,o,r)=>{var y,b,v,C,I,j,k,A;let i="";const a=P=>{const w=Ft((P.label||"")+":",20,"left"),S=Ft(P.value2||"",20,"right");return w+S},c=P=>{const w=Ft((P.subtitle||"")+":",14,"left"),S=Ft(P.value1||"",13,"right"),E=Ft(P.value2||"",13,"right");return w+S+E},d=P=>ct(P),u=s((e==null?void 0:e.products)||[]),p=r(u,((y=e==null?void 0:e.discount)==null?void 0:y.value)||0),h=Fu((e==null?void 0:e.products)||[]),f=h>0,x={cash:"Efectivo",card:"Tarjeta",transfer:"Transferencia"};return[{label:"ENVÍO",value2:d((b=e==null?void 0:e.delivery)==null?void 0:b.value),condition:(v=e==null?void 0:e.delivery)==null?void 0:v.status},{label:"SUBTOTAL",value2:d(u),condition:!0},{label:"DESCUENTO GENERAL",value2:d(p),condition:!f&&p>0},{label:"DESCUENTOS PRODUCTOS",value2:d(h),condition:f},{label:"ITBIS",value2:d(o((e==null?void 0:e.products)||[])),condition:!0},...(((C=e==null?void 0:e.paymentMethod)==null?void 0:C.filter(P=>(P==null?void 0:P.status)===!0))||[]).map(P=>({label:x[P==null?void 0:P.method],value2:d(P==null?void 0:P.value),condition:!0})),{subtitle:"TOTAL",value2:d((I=e==null?void 0:e.totalPurchase)==null?void 0:I.value),condition:!0},{label:((j=e==null?void 0:e.change)==null?void 0:j.value)>=0?"CAMBIO":"FALTANTE",value2:d((k=e==null?void 0:e.change)==null?void 0:k.value),condition:!0},{label:"BALANCE ACTUAL",value2:d((e==null?void 0:e.pendingBalance)||0),condition:((A=e==null?void 0:e.change)==null?void 0:A.value)<0}].forEach(P=>{P.condition&&(P.subtitle?i+=c(P)+`
`:i+=a(P)+`
`)}),i+=`
`,i},bW=()=>{let e="";return e+=hn("Gracias por su compra, regrese pronto.",tn)+`
`,e+=hn("   Lo Esperamos.",tn),e},yW=st.forwardRef(({data:e,ignoreHidden:n},s)=>{const o=D(ft)||{},{taxReceipt:r}=D(zt)||{},i=Dn,a=e!=null&&e.date?Ve.convertMillisToISODate(Ve.convertTimestampToMillis(e.date),"dd/MM/yyyy HH:mm"):ce.now().toFormat("dd/MM/yyyy HH:mm"),c=mW(o,i)+hW(e,a)+gW(e==null?void 0:e.client,i)+fW(e==null?void 0:e.products,r,Xn,tt,Ks,ct,e==null?void 0:e.NCF)+xW(e,ct,Nn,$s,is)+bW();return t.jsx(vW,{ignoreHidden:n,children:t.jsx("pre",{ref:s,children:c})})}),vW=l.div`
  display: ${({ignoreHidden:e})=>!e&&"none"};
`,jW=l.div`
  ${e=>e.template==="template2"&&`
    font-size: 12px;
    
    table {
      font-size: 10px;
    }
    
    h1, h2, h3 {
      font-size: 14px;
    }
  `}
  
  ${e=>e.template==="template1"&&`
    font-size: 14px;
    
    table {
      font-size: 12px;
    }
  `}
`,ej=st.forwardRef(({data:e,template:n="template1",ignoreHidden:s},o)=>{const{billing:{billingMode:r,invoiceType:i}}=D(zt),a=()=>{switch(i==null?void 0:i.toLowerCase()){case"template1":return t.jsx(Yh,{ref:o,data:e,ignoreHidden:s});case"template2":return t.jsx(D9,{ref:o,data:e,ignoreHidden:s});case"template3":return t.jsx(dW,{ref:o,data:e,ignoreHidden:s});case"template4":return t.jsx(yW,{ref:o,data:e,ignoreHidden:s});default:return t.jsx(Yh,{ref:o,data:e,ignoreHidden:s})}};return t.jsx(jW,{template:n,children:a()})}),CW=async e=>{try{const n={...e,id:be(),createdAt:de()},s=F($,"businesses",n.id);return await De(s,{business:n}),n.id}catch(n){throw console.error("Error creating business info:",n),n}},wW=async(e,n)=>{if(!e||!e.businessID)return;const s=F($,"businesses",e.businessID);try{(await Se(s)).exists()&&await je(s,{business:{...n}})}catch{}},SW=async(e,n)=>{var i;if(!e||!e.businessID)return;const s=$x(),o=F($,"businesses",e.businessID),r="logo";try{const c=(await Se(o)).data();if((i=c==null?void 0:c.business)!=null&&i.logoUrl){const p=In(s,c.business.logoUrl);try{await Po(p)}catch{}}const d=In(s,`businesses/${e.businessID}/${r}/${n.name}`);await Ox(d,n);const u=await Ss(d);return await je(o,{"business.logoUrl":u}),u}catch(a){throw console.error("Error updating business logo:",a),a}},en=async(e,n)=>{if(e!=null&&e.businessID)try{const s=F($,"businesses",e.businessID,"settings","billing");(await Se(s)).exists()?await je(s,n):await De(s,n)}catch(s){console.error("Error al actualizar la configuración de facturación:",s)}},{Option:IW}=ge,EW=[{id:"template1",name:"Plantilla Compacta 1",description:"Diseño compacto ideal para impresoras térmicas"},{id:"template4",name:"Plantilla Compacta 2",description:"Diseño compacto ideal para impresoras de impacto (matriciales) de formato reducido"},{id:"template2",name:"Plantilla Carta",description:"Diseño profesional para formato carta"}],AW=({onSave:e,onPreview:n,template:s,hidePreviewButton:o})=>{const r=D(q),i=async a=>{try{await en(r,{invoiceType:a}),e&&e(a),V.success("Plantilla de factura actualizada")}catch{V.error("Error al actualizar la plantilla")}};return t.jsx("div",{children:t.jsx(M,{layout:"vertical",children:t.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"flex-end"},children:t.jsx(M.Item,{label:"Seleccionar Plantilla de Factura",style:{flex:1},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1em"},children:[t.jsx(ge,{value:s,onChange:i,style:{width:"100%"},children:EW.map(a=>t.jsx(IW,{value:a.id,children:a.name},a.id))}),!o&&t.jsx(U,{size:"small",type:"primary",onClick:n,children:"Vista Previa"})]})})})})})},Ia={template1:{format:"THERMAL",width:"80mm",height:"auto",padding:"0mm"},template2:{format:"A4",width:"210mm",height:"297mm",padding:"0mm"},template4:{format:"80mm",width:"80mm",height:"auto",padding:"0mm"}},kW=l.div`
  width: ${e=>{var n;return(n=Ia[e.template])==null?void 0:n.width}};
  height: ${e=>{var n;return(n=Ia[e.template])==null?void 0:n.height}};
  padding: ${e=>{var n;return(n=Ia[e.template])==null?void 0:n.padding}};
  background: white;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  margin: 20px auto;
  
  @media print {
    box-shadow: none;
    margin: 0;
  }
`,TW=l.div`
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  background: #f0f0f0;
  padding: 0px;
  min-height: 50vh;
  
`;function tj({previewInModal:e=!0,hidePreviewButton:n=!1}){const{billing:{invoiceType:s}}=D(zt),[o,r]=m.useState("template1"),i=m.useRef(),[a,c]=m.useState(!1);m.useEffect(()=>{!s||!Ia[s]?r("template1"):r(s)},[s]);const d=f=>{r(f)},u=Vo.useReactToPrint({content:()=>i.current}),p=()=>{console.log("handlePreview called"),c(!0)},h=f=>t.jsx(TW,{template:o,children:t.jsx(kW,{template:o,children:t.jsx(ej,{ref:f,template:o,data:{},ignoreHidden:!0})})});return t.jsxs("div",{style:{display:"flex",gap:"8px",flexDirection:"column"},children:[t.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"flex-end"},children:t.jsx(AW,{onSave:d,template:o,onPreview:p,hidePreviewButton:n})}),t.jsx(Ce,{title:"Previsualización de Factura",open:a,onCancel:()=>c(!1),width:"1000px",style:{top:20},destroyOnHidden:!0,footer:[t.jsx(U,{onClick:u,type:"primary",children:"Imprimir"},"print"),t.jsx(U,{onClick:()=>c(!1),children:"Cerrar"},"close")],children:t.jsx("div",{style:{position:"relative",width:"100%",backgroundColor:"red"},children:h(i)})}),!e&&h(i)]})}const{Switch:PW}=Ne,DW=()=>{const e=D(zt),n=W(),{printInvoice:s}=e,o=()=>n(ED());return t.jsxs($W,{children:[t.jsx(tj,{previewInModal:!0,hidePreviewButton:!0}),t.jsxs(RW,{children:[t.jsx(PW,{checked:s,onChange:o}),t.jsx("span",{children:"Imprimir Factura "})]})]})},$W=l.div`
  
    
    padding: 0.6em 0.8em;

`,RW=l.span`
    margin-right: 1em;
    display: flex;
    gap: 1em;
`;async function nj(e,n){const s=le($,`businesses/${e}/accountsReceivable`),o=he(s,te("clientId","==",n),te("isActive","==",!0));try{const r=await Me(o);if(r.empty)return 0;let i=0;return r.forEach(()=>{i++}),i}catch(r){throw console.error("Error getting documents: ",r),new Error("Error getting documents")}}const sj=(e,n)=>{var f,x,g,y,b,v,C;const s=D(q),o=m.useMemo(()=>Bc(e),[e]);e==null||e.client;const r=(f=e==null?void 0:e.client)==null?void 0:f.id,{currentBalance:i}=D(ci),a=r==="GC-0000"||r===null,c=o<0,{data:d=0}=Uo({queryKey:["activeARCount",s.businessID,r],queryFn:()=>nj(s.businessID,r),enabled:!!((x=n==null?void 0:n.invoice)!=null&&x.status&&r&&s.businessID),staleTime:6e4}),u=!((g=n==null?void 0:n.invoice)!=null&&g.status)||d<(((y=n==null?void 0:n.invoice)==null?void 0:y.value)||0),p=(b=n==null?void 0:n.creditLimit)!=null&&b.status&&i!==null?i+-o:0,h=!((v=n==null?void 0:n.creditLimit)!=null&&v.status)||p<=((C=n==null?void 0:n.creditLimit)==null?void 0:C.value);return{isGenericClient:a,isChangeNegative:c,isWithinCreditLimit:h,isWithinInvoiceCount:u,activeAccountsReceivableCount:d,creditLimitValue:p,clientId:r}},tg=({creditLimit:e=null,setIsOpen:n,isOpen:s})=>{const o=W(),r=D(as);D(q),m.useMemo(()=>Bc(r),[r]);const i=r==null?void 0:r.client;console.log("client: ",i);const{isGenericClient:a,isChangeNegative:c,isWithinCreditLimit:d,isWithinInvoiceCount:u,clientId:p}=sj(r,e),h=r==null?void 0:r.isAddedToReceivables,f=h&&d,{currentBalance:x}=D(ci);console.log("MarkAsReceivableButton - Debug Info:",{isOpen:s,isChangeNegative:c,isAddedToReceivables:h,receivableStatus:f,isWithinCreditLimit:d,clientId:p}),m.useEffect(()=>{(!r.isAddedToReceivables||!e)&&o(Dc())},[r==null?void 0:r.isAddedToReceivables,e]);const g=m.useMemo(()=>{var C,I;return((C=e==null?void 0:e.creditLimit)==null?void 0:C.status)&&((I=e==null?void 0:e.invoice)==null?void 0:I.status)},[e]);function y(){var I,j;if(!((I=e==null?void 0:e.creditLimit)!=null&&I.status)||!((j=e==null?void 0:e.invoice)!=null&&j.status)){Be.error({message:"Error",description:"Los límites de crédito o las facturas no son válidos"});return}const C=r.id;if(a){Be.error({message:"Error",description:"No se puede agregar a CXC a un cliente genérico"});return}if(!p&&!C){Be.error({message:"Error",description:"No se puede agregar a CXC sin cliente o factura"});return}c&&o(Hu()),o(qn({clientId:p,invoiceId:C})),n(!0)}const b=a||!d||!u||!g,v=()=>a?"Selecciona un cliente específico":d?u?g?"":"Configura los límites de crédito":"Límite de facturas alcanzado":"Límite de crédito excedido";return t.jsx(m.Fragment,{children:c&&!f&&t.jsxs(NW,{children:[t.jsx(U,{style:{width:"100%"},onClick:y,spellCheck:!0,disabled:b,title:b?v():"",type:"primary",children:"Agregar a CXC"}),b&&t.jsx("div",{style:{fontSize:"12px",color:"#8c8c8c",textAlign:"center",marginTop:"4px",fontStyle:"italic"},children:v()})]})})},NW=l.div`
    display: grid;
    gap: 0.4em;
`;function oj(e,n){return n>0?Number(e)/Number(n):0}function OW(e){return console.log("active balance cuentas ",e),e.filter(n=>n.isActive&&n.arBalance>0).reduce((n,s)=>n+s.arBalance,0)}const MW=e=>(console.log(e),e.map(n=>{const s=ce.fromSeconds(n.createdAt.seconds).toFormat("dd/MM/yyyy");let o;n.paymentFrequency==="monthly"?o="Mensual":n.paymentFrequency==="weekly"?o="Semanal":o=n.paymentFrequency;const r=n.arBalance,i=n.totalInstallments,a=n.isActive;return{...n,date:s,frequency:o,balance:r,installments:i,isActive:a}})),FW={balance:"Pago a balance",account:"Pago a cuenta"},BW={installment:{name:"installment",text:"Cuota"},accountBalance:{name:"balance",text:"Balance de cuenta"},accountPayment:{name:"partial",text:"Abono a cuenta"}};function rj(e="monthly",n=1,s=null,o=!1){const[r,i]=m.useState([]),[a,c]=m.useState(null);return m.useLayoutEffect(()=>{if(n<1||n>36){i([]),c(null);return}const d=o||!s?ce.now().startOf("day"):ce.fromMillis(s).startOf("day"),u=[];for(let p=0;p<n;p++){let h;e==="weekly"?h=d.plus({days:7*(p+1)}):e==="annual"?h=d.plus({years:p+1}):h=d.plus({months:p+1}),u.push(h.toMillis())}i(u),c(u[0]||null)},[e,n,s,o]),{paymentDates:r,nextPaymentDate:a}}const ij=e=>{switch(e){case"monthly":return 36;case"weekly":return 104;default:return 36}},LW=({paymentDates:e,nextPaymentDate:n,frequency:s,installments:o})=>{const[r,i]=m.useState(!1),[a,c]=m.useState("list"),d=()=>{i(!0)},u=()=>{i(!1)},p=()=>{c(a==="list"?"calendar":"list")},h=e.map((g,y)=>({key:y,date:ce.fromMillis(g).toFormat("dd/MM/yyyy"),dateObj:ce.fromMillis(g),isNext:g===n})),f=g=>{const y=g.valueOf(),b=h.filter(v=>v.dateObj.startOf("day").toMillis()===ce.fromMillis(y).startOf("day").toMillis());if(b.length>0){const v=b.some(C=>C.isNext);return t.jsx(kn,{status:v?"processing":"success",text:v?"Próximo pago":`Pago #${b[0].key+1}`})}return null},x=()=>{switch(s){case"monthly":return"mensual";case"weekly":return"semanal";case"annual":return"anual";default:return""}};return t.jsxs(t.Fragment,{children:[t.jsx(zW,{type:"primary",icon:t.jsx(Tn,{}),onClick:d,children:"Ver fechas de pago"}),t.jsx(Ce,{title:`Plan de pagos ${x()} (${o} cuotas)`,open:r,onCancel:u,footer:[t.jsx(U,{onClick:p,children:a==="list"?"Ver calendario":"Ver lista"},"viewToggle"),t.jsx(U,{type:"primary",onClick:u,children:"Cerrar"},"close")],width:a==="calendar"?800:500,children:a==="list"?t.jsx(Sn,{dataSource:h,renderItem:(g,y)=>t.jsx(Sn.Item,{children:t.jsxs(UW,{isNext:g.isNext,children:[t.jsxs("span",{className:"payment-number",children:["Pago #",y+1]}),t.jsx("span",{className:"payment-date",children:g.date}),g.isNext&&t.jsx(WW,{children:"Próximo pago"})]})})}):t.jsx(Ww,{dateCellRender:f})})]})},zW=l(U)`
    margin-top: 10px;
    width: 100%;
`,UW=l.div`
    display: flex;
    width: 100%;
    justify-content: space-between;
    align-items: center;
    padding: 5px 10px;
    background-color: ${e=>e.isNext?"#e6f7ff":"transparent"};
    border-radius: 4px;

    .payment-number {
        font-weight: ${e=>e.isNext?"bold":"normal"};
    }

    .payment-date {
        color: #555;
    }
`,WW=l.span`
    background-color: #1890ff;
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 12px;
`,{Option:ng}=ge,{TextArea:qW}=ie,uo=e=>e<0?-e:e,sg=({isOpen:e,closePanel:n,form:s,creditLimit:o,activeAccountsReceivableCount:r,isWithinCreditLimit:i,isWithinInvoiceCount:a,isChangeNegative:c,receivableStatus:d})=>{var _;const u=W(),p=D(q),[h,f]=m.useState(!1),[x,g]=m.useState(!1),[y,b]=m.useState(ce.now().startOf("day").toMillis()),v=m.useCallback(()=>{s&&s.resetFields(),f(!1),g(!1),n()},[s,n]),{paymentFrequency:C,totalInstallments:I,installmentAmount:j,currentBalance:k,paymentDate:A,totalReceivable:P,comments:w}=D(ci),S=D(as),E=D(Ht),T=m.useMemo(()=>Bc(S),[S]),R=d&&c,N=ij(C),G=m.useMemo(()=>uo(T)+k,[T,k]),Q=!E.id||E.id==="GC-0000";console.log("ReceivableManagementPanel - Debug Info:",{isOpen:e,receivableStatus:d,isChangeNegative:c,isReceivable:R,isInvalidClient:Q,clientId:E==null?void 0:E.id});const ae=m.useCallback(L=>u(qn({paymentDate:L})),[u]),oe=m.useCallback(L=>{const H=ce.now().startOf("day").toMillis();b(H),f(!1),g(!0),u(qn({...L,paymentDate:null})),console.log("Base date updated:",new Date(H).toLocaleDateString(),L)},[u]),Z=m.useCallback(L=>{if(L){const H=L.valueOf();H!==A&&(console.log("Date manually changed:",L.format("DD/MM/YYYY")),f(!0),g(!1),ae(H))}else console.log("Date cleared by user"),f(!1),ae(null),b(ce.now().startOf("day").toMillis()),g(!0)},[A,ae]),J=m.useCallback(L=>{const H=Number(L)||1;H!==I?(console.log("Installments changed:",I,"->",H),oe({totalInstallments:H})):u(qn({totalInstallments:H}))},[u,I,oe]),X=m.useCallback(L=>{L!==C?(console.log("Frequency changed:",C,"->",L),oe({paymentFrequency:L})):u(qn({paymentFrequency:L}))},[u,C,oe]),me=m.useCallback(L=>u(qn({installmentAmount:uo(Db(L))})),[u]),fe=m.useCallback(L=>u(qn({comments:L})),[u]),se=m.useCallback(L=>u(qn({currentBalance:L})),[u]),ee=m.useCallback(L=>u(qn({totalReceivable:L})),[u]),{paymentDates:K,nextPaymentDate:B}=rj(C,I,h?A:y,x);return Ho(p==null?void 0:p.businessID,E==null?void 0:E.id,se),m.useEffect(()=>{(!h||x)&&(!A||x)&&C&&I>0&&B?B!==A?(console.log(`Auto-setting Payment Date (Forced: ${x}):`,new Date(B).toLocaleDateString(),`(Base: ${new Date(y).toLocaleDateString()})`),ae(B),f(!1),x&&g(!1)):x&&(g(!1),console.log("Force recalculate flag reset (date matched).")):x&&(g(!1),console.log("Force recalculate flag reset (conditions not met)."))},[B,C,I,A,h,x,y,ae]),m.useEffect(()=>{const L=oj(T,I),H=uo(T);me(L),ee(H)},[T,I,me,ee]),m.useEffect(()=>{d&&((E==null?void 0:E.id)==="GC-0000"||!(E!=null&&E.id))&&R&&u(Hu(!1))},[E==null?void 0:E.id,R,d,u]),m.useEffect(()=>{!d&&!R&&(f(!1),g(!1),b(ce.now().startOf("day").toMillis()),u(Dc()),e&&n())},[d,R,e,n,u]),m.useEffect(()=>{e&&s&&s.setFieldsValue({paymentFrequency:C||"monthly",totalInstallments:I||1,paymentDate:A?Ve.convertMillisToDayjs(A):null,comments:w||""})},[e,s,C,I,A,w]),m.useEffect(()=>{s&&A&&s.setFieldsValue({paymentDate:Ve.convertMillisToDayjs(A)})},[s,A]),m.useEffect(()=>{s&&s.setFieldsValue({paymentFrequency:C,totalInstallments:I})},[s,C,I]),m.useEffect(()=>{if(!y){const L=ce.now().startOf("day").toMillis();b(L),console.log("Initializing base calculation date:",new Date(L).toLocaleDateString())}},[y]),Q?(console.log("Modal no renderizado: cliente inválido"),null):t.jsx(Ce,{title:"Gestión de Cuentas por Cobrar",open:e,onCancel:v,footer:null,destroyOnClose:!0,width:600,children:t.jsxs(VW,{children:[t.jsxs(jl,{children:[t.jsx(po,{children:"Balance pendiente"}),t.jsx(po,{children:Y(uo(k))})]}),t.jsxs(M,{layout:"vertical",form:s,children:[t.jsxs(og,{children:[t.jsx(rr,{label:"Frecuencia de Pago",name:"paymentFrequency",rules:[{required:!0,message:"Seleccione una frecuencia de pago"}],children:t.jsxs(ge,{value:C,style:{width:"100%"},onChange:X,children:[t.jsx(ng,{value:"monthly",children:"Mensual"}),t.jsx(ng,{value:"weekly",children:"Semanal"})]})}),t.jsx(rr,{label:"Cuotas",name:"totalInstallments",rules:[{required:!0,message:"Seleccione el número de cuotas"},{type:"number",min:1,max:N,message:`Cuotas entre 1 y ${N}`}],children:t.jsx(Ke,{value:I,onChange:J,style:{width:"100%"}})})]}),t.jsxs(og,{children:[t.jsx(rr,{label:"Fecha de Primer Pago",name:"paymentDate",rules:[{required:!0,message:"Seleccione una fecha de pago"}],children:t.jsx(yt,{format:"DD/MM/YYYY",style:{width:"100%"},value:A?Ve.convertMillisToDayjs(A):null,onChange:Z,disabledDate:L=>L&&L<Ve.convertMillisToDayjs(Date.now()).startOf("day")})}),t.jsx(rr,{label:"Monto por Cuota",children:t.jsx("div",{style:{fontWeight:600},children:t.jsx("span",{children:Y(j)})})})]}),t.jsx(rr,{label:"Comentarios",name:"comments",children:t.jsx(qW,{rows:3,value:w,onChange:L=>fe(L.target.value)})}),K.length>0&&I>0&&t.jsx(LW,{paymentDates:K,nextPaymentDate:B,frequency:C,installments:I})]}),t.jsxs(GW,{children:[t.jsxs(jl,{children:[t.jsx(po,{children:"Total a Crédito."}),t.jsx(po,{children:Y(uo(T))})]}),t.jsxs(jl,{children:[t.jsx(po,{children:"Balance General"}),t.jsxs(po,{children:[Y(uo(G))," / ",Y(((_=o==null?void 0:o.creditLimit)==null?void 0:_.value)||0)]})]})]})]})})},VW=l.div`
  padding: 6px 12px;
  background: #f4f4f4;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
`,jl=l.div`
  padding: 0.2em 0;
  display: flex;
  justify-content: space-between;
`,GW=l.div`
  :nth-child(n) {
    div {
      border-bottom: 1px solid #ccc;
      :last-child {
        border-bottom: 0;
      }
    }
  }
`,po=l.span`
  color: #333;
  font-weight: 600;
  font-size: 1.1em;
  display: block;
  margin-bottom: 5px;
`,rr=l(M.Item)`
  margin-bottom: 15px;
`,og=l.div`
  display: grid;
  gap: 1em;
  grid-template-columns: 1fr 0.8fr;
`,{Option:rg}=ge,{TextArea:_W}=ie,HW=({form:e})=>{var P;const n=W(),s=D(as),o=D(Ht),r=D(cv),{paymentFrequency:i,totalInstallments:a,installmentAmount:c,totalReceivable:d,paymentDate:u,comments:p}=r,h=((P=s==null?void 0:s.totalInsurance)==null?void 0:P.value)||0,f={hidden:{opacity:0,scaleY:.1,height:0,transition:{duration:.3}},visible:{opacity:1,scaleY:1,height:"auto",transition:{duration:.5}}},x=ij(i),g=w=>w<0?w*-1:w,y=m.useMemo(()=>!a||a<=0?0:oj(h,a),[a,h]),{nextPaymentDate:b}=rj(i,a),v=w=>n(gs({paymentFrequency:w})),C=w=>n(gs({totalInstallments:Number(w)||1})),I=w=>n(gs({installmentAmount:g(Db(w))})),j=w=>n(gs({totalReceivable:w})),k=w=>n(gs({paymentDate:w})),A=w=>n(gs({comments:w}));return m.useEffect(()=>{h>0&&a>0&&Math.abs(y-c)>.01&&I(y)},[y]),m.useEffect(()=>{h>0&&Math.abs(h-d)>.01&&j(h)},[h]),m.useEffect(()=>{o!=null&&o.id&&o.id!==r.clientId&&n(gs({clientId:o.id}))},[o==null?void 0:o.id,r.clientId,n]),m.useEffect(()=>{b&&b!==u&&k(b)},[b]),m.useEffect(()=>{if(e){const w={insurancePaymentFrequency:i,insuranceTotalInstallments:a,insuranceInstallmentAmount:c,insuranceType:"medical",insuranceTotalReceivable:d,insuranceComments:p,insurancePaymentDate:Ve.convertMillisToDayjs(u)};e.setFieldsValue(w)}},[e,i,a,c,d,p,u]),!h||h<=0?null:t.jsx(gt,{children:t.jsxs(QW,{initial:"hidden",animate:"visible",exit:"hidden",variants:f,children:[t.jsx(ig,{children:t.jsx(Cl,{children:"Configuración de Seguro Médico"})}),t.jsxs(M,{layout:"vertical",form:e,children:[t.jsxs(ag,{children:[t.jsx(mo,{label:"Frecuencia de Pago",name:"insurancePaymentFrequency",initialValue:i,rules:[{required:!0,message:"Por favor seleccione una frecuencia de pago"}],children:t.jsxs(ge,{style:{width:"100%"},onChange:v,children:[t.jsx(rg,{value:"monthly",children:"Mensual"}),t.jsx(rg,{value:"weekly",children:"Semanal"})]})}),t.jsx(mo,{label:"Cuotas",name:"insuranceTotalInstallments",initialValue:a,rules:[{required:!0,message:"Por favor seleccione el número de cuotas"},{type:"number",min:1,max:x,message:`El número de cuotas debe estar entre 1 y ${x}`}],children:t.jsx(Ke,{onChange:C,style:{width:"100%"}})})]}),t.jsxs(ag,{children:[t.jsx(mo,{label:"Fecha de Pago",name:"insurancePaymentDate",rules:[{required:!0,message:"Por favor seleccione una fecha de pago"}],children:t.jsx(yt,{format:"DD/MM/YYYY",style:{width:"100%"},onChange:w=>k(w?w.valueOf():null)})}),t.jsx(mo,{label:"Monto por Cuota",name:"insuranceInstallmentAmount",children:t.jsx("div",{style:{textAlign:"",fontWeight:600},children:t.jsx("span",{children:Y(c)})})})]}),t.jsx(mo,{label:"Comentarios",name:"insuranceComments",children:t.jsx(_W,{rows:3,onChange:w=>A(w.target.value)})}),t.jsx(mo,{label:"Tipo de Seguro",name:"insuranceType",initialValue:"medical",hidden:!0,children:t.jsx(ie,{type:"hidden"})})]}),t.jsx(YW,{children:t.jsxs(ig,{children:[t.jsx(Cl,{children:"Total Cobertura de Seguro"}),t.jsx(Cl,{children:Y(h)})]})})]},"insurance-management-panel")})},QW=l(Ie.div)`
  padding: 6px 12px;
  background: #f4f4f4;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
`,ig=l.div`
  padding: 0.2em 0;
  display: flex;
  justify-content: space-between;
`,YW=l.div`
    :nth-child(n){
        div{
            border-bottom: 1px solid #ccc;
            :last-child{
                border-bottom: 0;
            }
        }
    }
`,Cl=l.span`
    color: #333;
    font-weight: 600;
    font-size: 1.1em;
    display: block;
    margin-bottom: 5px;
`,mo=l(M.Item)`
  margin-bottom: 15px;
`,ag=l.div`
    display: grid;
    gap: 1em;
    grid-template-columns: 1fr 0.8fr;
`,{TextArea:KW}=ie,{confirm:JW}=Ce,XW=()=>{const e=W(),n=D(Zb)||"",[s,o]=m.useState(!1),[r,i]=m.useState(n),a=()=>{i(n),o(!0)},c=()=>o(!1),d=()=>{e(TD(r.trim())),o(!1)},u=()=>{JW({title:"¿Eliminar comentario?",icon:t.jsx(Is,{}),content:"¿Estás seguro que deseas eliminar este comentario de la factura?",okText:"Sí, eliminar",cancelText:"Cancelar",okButtonProps:{danger:!0},onOk:()=>{e(PD()),i(""),o(!1)}})};return t.jsxs(t.Fragment,{children:[t.jsx(ZW,{children:t.jsx(Je,{title:"Comentario",extra:t.jsx(U,{type:"link",onClick:a,children:n?"Editar":"Agregar"}),size:"small",children:n?t.jsx(sq,{children:n}):t.jsx(oq,{children:"No hay comentario para esta factura"})})}),t.jsx(rq,{open:s,onCancel:c,centered:!0,closeIcon:null,footer:null,width:600,children:t.jsxs(iq,{children:[t.jsxs(eq,{children:[t.jsx(tq,{children:"Comentario para la Factura"}),t.jsx(nq,{onClick:c,"aria-label":"Cerrar",children:t.jsx(Qr,{})})]}),t.jsxs(aq,{children:[t.jsxs(cq,{children:[t.jsx(KW,{value:r,onChange:p=>i(p.target.value),placeholder:"Agregar un comentario a la factura...",autoSize:{minRows:5,maxRows:14},maxLength:600}),t.jsxs(lq,{children:[r.length,"/600"]})]}),t.jsxs(dq,{children:[t.jsx(uq,{children:"Herramientas del comentario"}),t.jsx(pq,{children:r&&t.jsx(Oe,{title:"Eliminar comentario",children:t.jsx(mq,{onClick:u,danger:!0,icon:t.jsx(ht,{})})})})]})]}),t.jsx(hq,{children:t.jsx(gq,{children:t.jsx(fq,{onClick:d,type:"primary",icon:t.jsx(t0,{}),children:"Guardar"})})})]})})]})},ZW=l.div`
  width: 100%;
  margin-bottom: 1em;
`,eq=l.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  background: #fafafa;
  border-bottom: 1px solid #f0f0f0;
`,tq=l.h3`
  margin: 0;
  font-size: 16px;
  font-weight: 500;
  color: #1f2937;
`,nq=l.button`
  background: none;
  border: none;
  color: #6b7280;
  cursor: pointer;
  padding: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;

  &:hover {
    color: #111827;
  }
`,sq=l.p`
  margin: 0;
  font-size: 14px;
  color: #334155;
`,oq=l.p`
  margin: 0;
  font-style: italic;
  color: #94a3b8;
`,rq=l(Ce)`
  .ant-modal-content {
    padding: 0;
    /* border-radius: 16px;  // se comenta para poder sobrescribir desde Ant */
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  }
`,iq=l.div`
  display: flex;
  flex-direction: column;
  background: #fff;
`,aq=l.div`
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
`,cq=l.div`
  position: relative;
  background: #f8fafc;
  border-radius: 12px;
  padding: 4px;

  .ant-input {
    background: transparent;
    font-size: 14px;
    color: #334155;

    &::placeholder {
      color: #94a3b8;
    }
  }
`,lq=l.span`
  position: absolute;
  bottom: 8px;
  right: 12px;
  font-size: 11px;
  color: #94a3b8;
`,dq=l.div`
  background: #f8fafc;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  padding: 8px 1.4em;
`,uq=l.span`
  font-size: 12px;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: block;
  margin-bottom: 8px;
`,pq=l.div`
  display: flex;
  gap: 8px;
  align-items: center;
`,mq=l(U)`
  &.ant-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    padding: 0;
    border-radius: 50%;

    &[disabled] {
      background: #f1f5f9;
      border-color: transparent;

      .anticon {
        color: #94a3b8;
      }
    }

    &.ant-btn-dangerous {
      background: #fef2f2;

      &:hover {
        background: #fee2e2;
      }
    }

    .anticon {
      font-size: 16px;
    }
  }
`,hq=l.div`
  padding: 16px 20px;
  border-top: 1px solid #f0f0f0;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
`,gq=l.div`
  display: flex;
  gap: 8px;
`,fq=l(U)`
  border-radius: 4px;
`,xq=(e,n,s,o)=>{const{data:r=0}=Uo({queryKey:["activeARCount",o,s],queryFn:()=>nj(o,s),enabled:!!o&&!!s&&s!=="GC-0000",refetchOnWindowFocus:!1});return m.useMemo(()=>{var h,f,x,g;if(!e||!e.creditLimit)return{activeAccountsReceivableCount:r,isWithinCreditLimit:!1,isWithinInvoiceCount:!1,creditLimitValue:0,change:n};const i=((h=e.creditLimit)==null?void 0:h.value)||0,a=((f=e.invoice)==null?void 0:f.value)||0,c=e.currentBalance||0,d=n<0?Math.abs(n):0,u=!((x=e.creditLimit)!=null&&x.status)||c+d<=i,p=!((g=e.invoice)!=null&&g.status)||(r||0)<a;return{activeAccountsReceivableCount:r,isWithinCreditLimit:u,isWithinInvoiceCount:p,creditLimitValue:c+d,change:n}},[e,n,r])},bq=(e,n)=>{const[s,o]=m.useState(null),[r,i]=m.useState(!0),[a,c]=m.useState(null),d=m.useCallback(()=>{o(null),i(!0),c(null)},[]);return m.useEffect(()=>{if(!(e!=null&&e.businessID)||!n){d(),i(!1);return}i(!0),c(null);const u=F($,"businesses",e.businessID,"creditLimit",n),p=Te(u,h=>{i(!1),h.exists()?o(h.data()):o(null),c(null)},h=>{i(!1),c(h),o(null),console.error("Error listening to credit limit:",h)});return()=>{p()}},[e==null?void 0:e.businessID,n,d]),{creditLimit:s,isLoading:r,error:a}},yq=({isGenericClient:e,isInvoiceLimitExceeded:n,isCreditLimitExceeded:s,creditLimit:o,activeAccountsReceivableCount:r,clientId:i,invoiceId:a,hasAccountReceivablePermission:c,isChangeNegative:d,abilitiesLoading:u,currentBalance:p,creditLimitValue:h})=>{var I,j,k,A,P;const f=W(),x=D(Ht),g=()=>f(Pn({mode:_e.UPDATE.id,data:x,addClientToCart:!0})),y=[];if(!c&&d&&!u&&y.push({status:"error",icon:t.jsx(n0,{}),title:"Acceso Restringido",message:"No se puede facturar ventas con cambio negativo sin permisos de CxC",priority:0}),e&&d&&y.push({status:"error",icon:t.jsx(dc,{}),title:"Cliente genérico detectado",message:"Selecciona un cliente específico para continuar",priority:1}),!i&&!a&&y.push({status:"error",icon:t.jsx(Is,{}),title:"Información incompleta",message:"Se requiere cliente para CxC",priority:2}),!e&&!((I=o==null?void 0:o.creditLimit)!=null&&I.status)&&!((j=o==null?void 0:o.invoice)!=null&&j.status)&&y.push({status:"warning",icon:t.jsx(cc,{}),title:"Configuración pendiente",message:"Define límites de crédito y facturas",action:!0,priority:3}),s){p!=null&&p.toFixed(2);const w=h!=null?h.toFixed(2):"0.00",S=((k=o==null?void 0:o.creditLimit)==null?void 0:k.value)||0;y.push({status:"warning",icon:t.jsx(s0,{}),title:"Límite de crédito excedido",message:`Nuevo balance: $${w} (límite: $${S})`,action:!0,priority:4})}if(n&&y.push({status:"warning",icon:t.jsx(Kw,{}),title:"Límite de facturas alcanzado",message:`${r+1} / ${(A=o==null?void 0:o.invoice)==null?void 0:A.value} facturas (incluyendo esta)`,action:!0,priority:5}),y.length===0)return null;y.sort((w,S)=>w.priority-S.priority);const b=w=>{switch(w){case"error":return{color:"#ff4d4f",backgroundColor:"#fff2f0",borderColor:"#ffccc7"};case"warning":return{color:"#faad14",backgroundColor:"#fffbe6",borderColor:"#ffe58f"};case"success":return{color:"#52c41a",backgroundColor:"#f6ffed",borderColor:"#b7eb8f"};default:return{color:"#1890ff",backgroundColor:"#e6f7ff",borderColor:"#91d5ff"}}},v=((P=y[0])==null?void 0:P.status)||"info",C=b(v);return t.jsxs("div",{style:{backgroundColor:"#fafafa",border:"1px solid #f0f0f0",borderRadius:"8px",padding:"16px",width:"100%",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",paddingBottom:"8px",borderBottom:"1px solid #f0f0f0"},children:[t.jsx("div",{style:{width:"6px",height:"20px",backgroundColor:C.color,borderRadius:"3px"}}),t.jsx("span",{style:{fontSize:"14px",fontWeight:"600",color:"#262626"},children:"Validación CxC"}),t.jsxs("div",{style:{marginLeft:"auto",fontSize:"11px",color:"#8c8c8c",textTransform:"uppercase",letterSpacing:"0.5px"},children:[y.length," ",y.length===1?"item":"items"]})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:y.map((w,S)=>{const E=b(w.status);return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"10px 12px",backgroundColor:E.backgroundColor,border:`1px solid ${E.borderColor}`,borderRadius:"6px",transition:"all 0.2s ease"},children:[t.jsx("div",{style:{color:E.color,fontSize:"16px",flexShrink:0},children:w.icon}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:"#262626",marginBottom:"2px"},children:w.title}),t.jsx("div",{style:{fontSize:"12px",color:"#595959",lineHeight:"1.3"},children:w.message})]}),t.jsx("div",{style:{fontSize:"10px",fontWeight:"500",color:E.color,backgroundColor:"rgba(255,255,255,0.8)",padding:"2px 6px",borderRadius:"10px",textTransform:"uppercase",letterSpacing:"0.3px",flexShrink:0},children:w.status})]},S)})}),y.some(w=>w.action)&&t.jsx("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:"1px solid #f0f0f0",display:"flex",justifyContent:"flex-end"},children:t.jsx(U,{type:"primary",size:"small",onClick:g,style:{height:"32px",fontSize:"12px",fontWeight:"500",borderRadius:"6px"},children:"Configurar límites"})})]})},vq=({isGenericClient:e,clientId:n,invoiceId:s,isWithinCreditLimit:o,isWithinInvoiceCount:r,activeAccountsReceivableCount:i,creditLimit:a,currentBalance:c,creditLimitValue:d,hasAccountReceivablePermission:u,isChangeNegative:p,abilitiesLoading:h})=>{var g,y;const f=((g=a==null?void 0:a.creditLimit)==null?void 0:g.status)&&!o,x=((y=a==null?void 0:a.invoice)==null?void 0:y.status)&&!r;return t.jsx("div",{children:t.jsx(yq,{isGenericClient:e,isInvoiceLimitExceeded:x,isCreditLimitExceeded:f,activeAccountsReceivableCount:i,creditLimit:a,clientId:n,invoiceId:s,hasAccountReceivablePermission:u,isChangeNegative:p,abilitiesLoading:h,currentBalance:c,creditLimitValue:d})})},wl=e=>e<0?-e:e,cg=({receivableStatus:e,isChangeNegative:n,onOpenConfig:s,creditLimit:o})=>{const r=W(),{paymentFrequency:i,totalInstallments:a,installmentAmount:c,currentBalance:d,paymentDate:u,totalReceivable:p}=D(ci),h=D(as),f=m.useMemo(()=>Bc(h),[h]);if(m.useMemo(()=>wl(f)+d,[f,d]),!e||!n)return null;const x=()=>{n&&r(Hu()),r(Dc()),Be.success({message:"Éxito",description:"Removido de Cuentas por Cobrar"})},g=()=>{s&&s()},y=v=>v==="monthly"?"Mensual":"Semanal",b=()=>u?Ve.convertMillisToDayjs(u).format("DD/MM/YYYY"):"No configurado";return t.jsxs(jq,{children:[t.jsxs(Cq,{children:[t.jsx(wq,{children:"Resumen CXC"}),t.jsx(Sq,{children:"Activo"})]}),t.jsxs(Iq,{children:[t.jsxs(lg,{children:[t.jsxs(Oi,{children:[t.jsx(ir,{children:t.jsx(Da,{})}),t.jsxs(ar,{children:[t.jsx(cr,{children:"Total a Crédito"}),t.jsx(lr,{children:Y(wl(f))})]})]}),t.jsxs(Oi,{children:[t.jsx(ir,{children:t.jsx($a,{})}),t.jsxs(ar,{children:[t.jsx(cr,{children:"Cuotas"}),t.jsxs(lr,{children:[a||1," ",y(i)]})]})]})]}),t.jsxs(lg,{children:[t.jsxs(Oi,{children:[t.jsx(ir,{children:t.jsx(Da,{})}),t.jsxs(ar,{children:[t.jsx(cr,{children:"Monto/Cuota"}),t.jsx(lr,{children:Y(c||0)})]})]}),t.jsxs(Oi,{children:[t.jsx(ir,{children:t.jsx(Tn,{})}),t.jsxs(ar,{children:[t.jsx(cr,{children:"Primer Pago"}),t.jsx(lr,{children:b()})]})]})]}),d>0&&t.jsxs(Eq,{children:[t.jsx(ir,{children:t.jsx(Id,{})}),t.jsxs(ar,{children:[t.jsx(cr,{children:"Balance Pendiente"}),t.jsx(lr,{highlighted:!0,children:Y(wl(d))})]})]}),t.jsxs(Aq,{children:[t.jsx(U,{type:"default",icon:t.jsx(o0,{}),onClick:g,style:{flex:1},children:"Configurar"}),t.jsx(U,{type:"default",danger:!0,icon:t.jsx(ht,{}),onClick:x,children:"Quitar"})]})]})]})},jq=l.div`
  background-color: white;
  border: 1px solid #dee2e6;
  border-radius: 12px;
  padding: 16px;
  margin-top: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;


`,Cq=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid #e9ecef;
`,wq=l.h4`
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  color: #495057;
  letter-spacing: 0.3px;
`,Sq=l.span`
  background: #d4edda;
  color: #155724;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
`,Iq=l.div`
  display: flex;
  flex-direction: column;
  gap: 8px;
`,lg=l.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
`,Eq=l.div`
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  background: #fff3cd;
  border-radius: 8px;
  border-left: 3px solid #ffc107;
`,Aq=l.div`
  display: flex;
  gap: 8px;
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid #e9ecef;
`,Oi=l.div`
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
`,ir=l.div`
  color: #6c757d;
  font-size: 14px;
  flex-shrink: 0;
`,ar=l.div`
  display: flex;
  flex-direction: column;
  min-width: 0;
  flex: 1;
`,cr=l.span`
  font-size: 10px;
  color: #6c757d;
  text-transform: uppercase;
  font-weight: 500;
  letter-spacing: 0.5px;
  margin-bottom: 2px;
`,lr=l.span`
  font-size: 12px;
  font-weight: 600;
  color: ${e=>e.highlighted?"#856404":"#212529"};
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
`,aj=({hasAccountReceivablePermission:e,creditLimit:n,change:s,form:o,receivableStatus:r,abilitiesLoading:i})=>{const[a,c]=m.useState(!1),d=()=>c(!1),u=D(as),{isGenericClient:p,isChangeNegative:h,isWithinCreditLimit:f,isWithinInvoiceCount:x,activeAccountsReceivableCount:g,creditLimitValue:y,clientId:b}=sj(u,n);return h&&!i?t.jsxs(m.Fragment,{children:[t.jsx(vq,{isGenericClient:p,clientId:b,invoiceId:null,isWithinCreditLimit:f,isWithinInvoiceCount:x,activeAccountsReceivableCount:g,creditLimit:n,creditLimitValue:y,hasAccountReceivablePermission:e,isChangeNegative:h,abilitiesLoading:i}),"        ",e&&t.jsxs(m.Fragment,{children:[t.jsx(tg,{isOpen:a,setIsOpen:c,creditLimit:n,activeAccountsReceivableCount:g,isWithinCreditLimit:f,isWithinInvoiceCount:x,creditLimitValue:y,change:s,clientId:b}),t.jsx(cg,{receivableStatus:r,isChangeNegative:h,onOpenConfig:()=>c(!0),creditLimit:n}),t.jsx(sg,{form:o,activeAccountsReceivableCount:g,isWithinCreditLimit:f,isWithinInvoiceCount:x,creditLimit:n,isChangeNegative:h,receivableStatus:r,isOpen:a,closePanel:d})]})]}):e?t.jsxs(m.Fragment,{children:[t.jsx(tg,{isOpen:a,setIsOpen:c,creditLimit:n,activeAccountsReceivableCount:g,isWithinCreditLimit:f,isWithinInvoiceCount:x,creditLimitValue:y,change:s,clientId:b}),t.jsx(cg,{receivableStatus:r,isChangeNegative:h,onOpenConfig:()=>c(!0),creditLimit:n}),t.jsx(sg,{isOpen:a,closePanel:d,form:o,activeAccountsReceivableCount:g,isWithinCreditLimit:f,isWithinInvoiceCount:x,creditLimit:n,isChangeNegative:h,receivableStatus:r})]}):null};aj.propTypes={hasAccountReceivablePermission:we.bool.isRequired,activeAccountsReceivableCount:we.number.isRequired,creditLimit:we.any,isWithinCreditLimit:we.bool.isRequired,isWithinInvoiceCount:we.bool.isRequired,creditLimitValue:we.number.isRequired,change:we.number.isRequired,clientId:we.oneOfType([we.string,we.number]).isRequired,form:we.any,isChangeNegative:we.bool.isRequired,receivableStatus:we.bool,abilitiesLoading:we.bool.isRequired};const kq=({form:e})=>{var j,k;const n=D(q),s=D(Ht),o=D(as),r=s.id,i=cs(),{abilities:a,loading:c}=rs(),{creditLimit:d,error:u,isLoading:p}=bq(n,r),{activeAccountsReceivableCount:h,isWithinCreditLimit:f,isWithinInvoiceCount:x,creditLimitValue:g,change:y}=xq(d,o.change.value,r,n.businessID);console.log("Body.jsx useCreditLimitCheck Debug:",{activeAccountsReceivableCount:h,invoiceLimit:(j=d==null?void 0:d.invoice)==null?void 0:j.value,invoiceStatus:(k=d==null?void 0:d.invoice)==null?void 0:k.status,isWithinInvoiceCount:x,creditLimit:d});const v=(o==null?void 0:o.isAddedToReceivables)&&f,C=o.change.value<0,I=a.can("manage","accountReceivable");return p?t.jsx("div",{children:"Loading..."}):u?t.jsx("div",{children:"Error loading credit limit"}):t.jsx(M,{form:e,layout:"vertical",children:t.jsxs(Tq,{children:[t.jsx(xU,{}),t.jsx(CU,{}),t.jsx(EU,{}),t.jsx(aj,{hasAccountReceivablePermission:I,activeAccountsReceivableCount:h,creditLimit:d,isWithinCreditLimit:f,isWithinInvoiceCount:x,creditLimitValue:g,change:y,clientId:r,form:e,isChangeNegative:C,receivableStatus:v,abilitiesLoading:c}),i&&t.jsx(HW,{form:e}),t.jsx(XW,{}),t.jsx(DW,{})]})})},Tq=l.div`
        display: grid;
        gap: 1.4em;
    `;function Pq(e){return e.products.length>0}function Dq(e){return e.products.every(n=>n.amountToBuy>0)}function $r(e,n){return e?Pq(e)?Dq(e)?{isValid:!0,message:"The invoice cart is ready for the billing process."}:{isValid:!1,message:"Some products in the invoice cart have invalid quantities. Please ensure all products have quantities greater than zero."}:{isValid:!1,message:"The invoice cart is empty. Please add products before proceeding to checkout."}:{isValid:!1,message:"The invoice cart is empty. Please provide the cart"}}const $q=(e,n)=>{n.isExistingOpenCR&&e(setUserNotification({isOpen:!0,title:"Reconciliación de efectivo",description:"Ya existe una reconciliación de efectivo abierta, ¿desea continuar?",onConfirm:()=>{history.push("/cash-reconciliation")}}))},Rq=(e,n)=>{const s=()=>{n(Zu())};return(()=>{s(),e("/cash-register-opening",{state:{from:"factura"}})})()},Zd={REDIRECT_CR_OPENING:"redirectCROpening",CHECK_IS_OPEN:"handleExistingOpenCR"},Nq={CASH_RECONCILIATION:Zd},Oq=(e,n,s,o)=>{switch(e){case Zd.REDIRECT_CR_OPENING:return Rq(n,s);case Zd.CHECK_IS_OPEN:return $q(s,o);default:return s(Zu())}};class gp{constructor(n){this.dispatch=n}handleConfirm(){}}class Sl extends gp{handleConfirm(){this.dispatch(za({isOpen:!0,title:"No hay un cuadre de caja abierto",description:"Parece que no hay un cuadre de caja en progreso en este momento. ¿Te gustaría iniciar uno nuevo?",onConfirm:Nq.CASH_RECONCILIATION.REDIRECT_CR_OPENING}))}}class Mq extends gp{handleConfirm(){this.dispatch(za({isOpen:!0,title:"Cuadre de caja en curso",description:"Actualmente hay un cuadre de caja en proceso de cierre. No puedes facturar hasta que este proceso se complete o se cancele.",onConfirm:null}))}}function Fq(e,n){switch(e){case"closed":return new Sl(n);case"closing":return new Mq(n);case"open":return new gp(n);case"none":return new Sl(n);default:return new Sl(n)}}async function cj(e,n=null){try{return n?await n.get(e):await Me(e)}catch(s){throw console.error("Error al leer datos de Firestore: ",s),s}}async function lj(e,n=null){try{return n?await n.get(e):await Se(e)}catch(s){throw console.error("Error al leer datos de Firestore: ",s),s}}const Bq=(...e)=>F($,...e);async function dj(e,n,s=null){try{return s?await s.set(e,n):await De(e,n)}catch(o){throw console.error("Error al escribir datos en Firestore: ",o),o}}async function uj(e,n,s=null){try{return s?await s.update(e,n):await je(e,n)}catch(o){throw console.error("Error al actualizar datos en Firestore: ",o),o}}function Lq(){const[e,n]=m.useState(!1),[s,o]=m.useState(null),r=D(q);return W(),m.useEffect(()=>{if(!r||!(r!=null&&r.businessID))return;const i=le($,"businesses",r==null?void 0:r.businessID,"cashCounts"),a=he(i,te("cashCount.state","in",["open","closing"])),c=Te(a,d=>{const u=d.docs.some(x=>x.data().cashCount.state==="open"),p=d.empty,h=d.docs.some(x=>x.data().cashCount.state==="closing"),f=d.docs.some(x=>x.data().cashCount.opening.employee.id===r.uid);if(p){n("none");return}n(u&&f?"open":h&&f?"closing":"closed")},d=>{console.error("Error en la suscripción a Firestore: ",d)});return()=>c()},[r]),{status:e,cashCount:s}}async function zq(e){try{if(!e||!e.businessID||!e.uid)throw new Error("Datos del usuario incompletos");const n=F($,"users",e.uid),s=le($,"businesses",e.businessID,"cashCounts"),o=he(s,te("cashCount.state","in",["open","closing"]),te("cashCount.opening.employee","==",n)),r=await cj(o);if(r.empty)return{state:"none",cashCount:null};const i=d=>d.data().cashCount.state==="open",a=d=>d.data().cashCount.state==="closing",c=r.docs.find(d=>i(d)||a(d));return c?i(c)?{state:"open",cashCount:c.data().cashCount}:a(c)?{state:"closing",cashCount:c.data().cashCount}:{state:"closed",cashCount:null}:{state:"closed",cashCount:null}}catch(n){throw console.error("Error al consultar Firestore: ",n),n}}const Uq=e=>e==="B"?8:10,Wq=({type:e,serie:n,sequence:s,sequenceLength:o})=>e+n+String(s).padStart(o,"0"),qq=async(e,n)=>{try{const s=le($,"businesses",e.businessID,"taxReceipts"),o=he(s,te("data.name","==",n)),r=await Me(o);if(r.empty)return console.log("No matching documents found"),null;const i=r.docs[0],a=i.ref,d=i.data().data||{},u=typeof d.sequence=="number"?d.sequence:parseInt(d.sequence,10)||0,p=typeof d.sequenceLength=="number"?d.sequenceLength:Uq(d.type),h=d.increase||1,f=u+h,x=typeof d.quantity=="number"?d.quantity-h:void 0,g={"data.sequence":f,"data.sequenceLength":p};x!==void 0&&(g["data.quantity"]=x);const y={type:d.type,serie:d.serie,sequence:f,sequenceLength:p},b=Wq(y);return await je(a,g),b}catch(s){return console.error("Error updating Tax Receipt: ",s),null}};function Mi(e){return e!=null&&(typeof e=="object"||Array.isArray(e))}function pj({object1:e,object2:n,currentDepth:s=0,maxDepth:o=2,strictTypeCheck:r=!0}){if(s>o||r&&e===n||!r&&dg(e,n))return!0;if(!Mi(e)||!Mi(n))return!1;const i=Object.keys(e),a=Object.keys(n);if(i.length!==a.length)return!1;for(const c of i)if(Object.hasOwn(n,c)){const d=e[c],u=n[c],p=Mi(d)&&Mi(u);if(p&&!pj({object1:d,object2:u,currentDepth:s+1,maxDepth:o,strictTypeCheck:r})||!p&&(r?d!==u:!dg(d,u)))return!1}else return!1;return!0}function dg(e,n){return typeof e=="number"&&typeof n=="number"?e===n:String(e)===String(n)}async function Vq(e,n,s=null){try{if(!e||!e.businessID)throw new Error("No user or businessID");if(!n||!n.id)return;if(n.id==="GC-0000")return n;const o=n.id,r=F($,"businesses",e.businessID,"clients",o),i=await lj(r),a=i.exists(),c=i.data(),d=pj({object1:c,object2:n});return a?d||await uj(r,{client:n},s):await dj(r,{client:n},s),n}catch(o){console.error("Error adding document: ",o)}}function Gq(e,n){const s=[];for(let o=0;o<e.length;o+=n)s.push(e.slice(o,o+n));return s}async function _q(e,n){const s=[],o=[];for(const r of e){const i=r.commit();if(o.push(i),n<=e.length){const a=i.then(()=>s.splice(s.indexOf(a),1));s.push(a),s.length>=n&&await Promise.race(s)}}return Promise.all(o)}async function Hq(e,n,s){try{yc(n);const{businessID:o}=n,r=500,i=5,a=Gq(e,Math.floor(r/3)),c=[];for(const d of a){const u=dt($);for(const p of d){const h=be(),f=Number(p==null?void 0:p.amountToBuy);let x=null,g=null,y=f;if(p!=null&&p.trackInventory){const C=p==null?void 0:p.productStockId,I=p==null?void 0:p.batchId;let j=0;if(C&&I){x=await Hv(n,C),x&&(j=x.quantity||0),g=await Qa(n,I);let k=-f;y=0,j<f&&(k=-j,y=f-j);const A=fn(k),P=j+k,w=F($,"businesses",o,"products",p.id);u.update(w,{stock:A});const S=F($,"businesses",o,"batches",I),E=F($,"businesses",o,"productsStock",C);u.update(S,{quantity:A}),P<=0?u.update(E,{quantity:0,status:"inactive",updatedAt:de(),updatedBy:n.uid}):u.update(E,{quantity:A}),await Az(o,I,p.id)}if(y>0){const k=be(),A=F($,"businesses",o,"backOrders",k),P={id:k,productId:p.id,productStockId:C||null,saleId:s.id,initialQuantity:y,pendingQuantity:y,status:"pending",createdAt:de(),updatedAt:de()};await De(A,P)}}const b=F($,"businesses",o,"movements",h),v={id:h,saleId:s.id,createdAt:de(),createdBy:n.uid,updatedAt:de(),updatedBy:n.uid,batchId:(p==null?void 0:p.batchId)||null,batchNumberId:g?g.numberId:null,productId:p.id,productName:p.name,sourceLocation:x?x.location:null,destinationLocation:null,quantity:f,movementType:ro.Exit,movementReason:Zn.Sale,isDeleted:!1};await De(b,v)}c.push(u)}await _q(c,i)}catch(o){throw console.error("Error al actualizar el stock de los productos:",o),new Error("No se pudo actualizar el stock de los productos")}}const Qq=async(e,n,s=null)=>{if(!e||!(e!=null&&e.businessID)||!(e!=null&&e.uid))return;const o=le($,"businesses",e==null?void 0:e.businessID,"cashCounts"),r=he(o,te("cashCount.state","==","open"));try{const i=await cj(r,s);if(i.empty)return;let a;for(const d of i.docs){const u=d.data();if((await lj(u.cashCount.opening.employee,s)).data().user.id===(e==null?void 0:e.uid)){a=d;break}}if(!a){console.error("No se encontró un cuadre de caja abierto para el cajero actual: ",error);return}const{cashCount:c}=a.data();if(c.sales.push(n),await uj(a.ref,{cashCount:c},s),c.id)return c.id;console.error("Error al encontrar el id del cuadre: ",error)}catch(i){console.error("Error al añadir la factura al cuadre: ",i)}},Yq=async(e,n)=>{if(!(!n||!n.businessID))try{const s=F($,"users",n.uid),o=await Mt(n,"lastInvoiceId");let r={...e,id:(e==null?void 0:e.id)||be(),date:de(),numberID:o,userID:n.uid,user:s};const i=F($,"businesses",n.businessID,"invoices",r.id);return await dj(i,{data:r}),await Qq(n,i),(await io(n.businessID,r.id)).data}catch(s){console.log(s)}};async function mj({user:e,accountsReceivable:n}){try{if(!(e!=null&&e.businessID)||!n)return;const s=be(),o=F($,"businesses",e.businessID,"accountsReceivable",s),r={...n,arBalance:n==null?void 0:n.totalReceivable,numberId:await Mt(e,"lastAccountReceivableId"),id:s,createdBy:e==null?void 0:e.uid,updatedBy:e==null?void 0:e.uid},i={...r,createdAt:ue.fromMillis(r==null?void 0:r.createdAt),updatedAt:ue.fromMillis(r==null?void 0:r.updatedAt),paymentDate:ue.fromMillis(r==null?void 0:r.paymentDate),lastPaymentDate:null};return await De(o,i),r}catch(s){throw s}}const Kq=(e,n,s=null)=>{const i=s?typeof s=="number"?ce.fromMillis(s).startOf("day"):s.startOf("day"):ce.now().startOf("day");if(n>=3e3)return{paymentDates:[],nextPaymentDate:null};const c=(h=>{switch(h){case"monthly":return{months:1};case"weekly":return{weeks:1};case"biweekly":return{weeks:2};case"annual":return{years:1};case"quarterly":return{months:3};case"daily":return{days:1};default:return{days:0}}})(e),d=[];for(let h=0;h<n;h++)d.push(i.plus({...c,[Object.keys(c)[0]]:h+1}).toMillis());const u=ce.now().startOf("day").toMillis(),p=d.find(h=>h>=u)||null;return{paymentDates:d,nextPaymentDate:p}},Fi=e=>Math.round(e*100)/100;function Jq({ar:e,user:n}){const{totalInstallments:s,totalReceivable:o,paymentFrequency:r}=e,{paymentDates:i}=Kq(r,s),a=o/s,c=Fi(a),d=Fi(c*s),u=Fi(o-d),p=[];return i.forEach((h,f)=>{let x=c;f===s-1&&(x=Fi(c+u)),p.push({id:be(),arId:e.id,createdAt:ce.now().toMillis(),updatedAt:ce.now().toMillis(),installmentDate:h,installmentAmount:x,installmentNumber:f+1,installmentBalance:x,createdBy:n==null?void 0:n.uid,updatedBy:n==null?void 0:n.uid,isActive:!0})}),p}function Xq(e){return e.map(n=>({...n,createdAt:ue.fromMillis(n.createdAt),updatedAt:ue.fromMillis(n.updatedAt),installmentDate:ue.fromMillis(n.installmentDate)}))}async function hj({user:e,ar:n}){try{if(!(e!=null&&e.businessID))throw new Error("User business ID is missing");if(!n)throw new Error("Accounts receivable data is missing");const s=Jq({user:e,ar:n}),o=Xq(s),r=le($,"businesses",e.businessID,"accountsReceivableInstallments"),i=dt($);o.forEach(a=>{const c=F(r,a.id);i.set(c,a)}),await i.commit()}catch(s){throw console.error("Error adding installments for accounts receivable:",s),s}}async function Zq(e,n){var s;try{if(!((s=n==null?void 0:n.preorderDetails)!=null&&s.isOrWasPreorder))throw new Error("Preorder details are missing or invalid.");const o=F($,"users",e==null?void 0:e.uid),r=await Mt(e,"lastInvoiceId"),i={type:"invoice",status:"completed",date:ue.now(),userID:e.uid},a={...n,status:"completed",date:de(),numberID:r,userID:e.uid,user:o,history:Vr(i)},c=F($,"businesses",e==null?void 0:e.businessID,"invoices",a==null?void 0:a.id);return await je(c,{data:a}),a}catch(o){console.error("Error al generar la factura:",o)}}const eV=async({ref:e,insuranceData:n})=>await je(e,n),tV=async({user:e,ref:n,insuranceData:s})=>{await De(n,{...s,createdAt:de(),createdBy:e.uid})},nV=async(e,n)=>{try{if(!e.businessID)throw new Error("No business ID found");const s=n.id||En(),o=F($,"businesses",e.businessID,"insuranceConfig",s);return n.id?await eV({ref:o,insuranceData:n}):await tV({user:e,ref:o,insuranceData:{id:s,...n}}),s}catch(s){throw console.error("Error saving insurance:",s),s}},sV=async(e,n)=>{if(!e.businessID)throw new Error("No se encontró un ID de negocio");if(!n)throw new Error("No se encontró un ID de seguro");try{const s=F($,"businesses",e.businessID,"insuranceConfig",n),o=await Se(s);if(o.exists())return o.data();throw new Error("No se encontró el documento de seguro")}catch(s){throw console.error("Error al obtener el seguro:",s),s}};async function oV(e,n,s){if(!e.businessID)throw new Error("No se encontró un ID de negocio");try{const o=le($,"businesses",e.businessID,"insuranceConfig");return Te(o,r=>{const i=r.docs.map(a=>a.data());n(i)},r=>{console.error("Error al escuchar la configuración de seguros:",r),s&&s(r)})}catch(o){return console.error("Error al configurar el listener:",o),s&&s(o),()=>{}}}const gj=()=>{const[e,n]=m.useState([]),[s,o]=m.useState(!0),[r,i]=m.useState(null),a=D(q);return m.useEffect(()=>{if(!(a!=null&&a.businessID))return o(!1),()=>{};let c;try{c=oV(a,d=>{n(d),o(!1)},d=>{i(d),o(!1)})}catch(d){return console.error("Error al iniciar el listener:",d),i(d),o(!1),()=>{}}return()=>{typeof c=="function"&&c()}},[a]),{data:e,loading:s,error:r}},fj=()=>le($,"insuranceAuths"),ug=e=>e?e instanceof ue?e:e instanceof Date?ue.fromDate(e):typeof e=="string"?ue.fromDate(new Date(e)):e.$d?ue.fromDate(e.$d):null:null,rV=async(e,n,s)=>{try{const o=fj();if(!o)return console.warn("No se pudo agregar autorización: datos de usuario no disponibles"),null;const r={...n,birthDate:ug(n.birthDate),indicationDate:ug(n.indicationDate)},{insuranceId:i,authNumber:a}=n||{};if((await iV(i,a)).length>0)throw new Error("Ya existe una autorización con el mismo número para esta aseguradora");const d=be(),u=F(o,d);return await De(u,{businessId:e.businessID,id:d,userId:e.uid,clientId:s,...r,createdBy:e.uid,createdAt:de(),status:"active",updatedAt:de(),deleted:!1}),console.log(`New authorization created for client: ${s}, auth ID: ${d}`),d}catch(o){throw console.error("Error adding/updating insurance authorization:",o),o}},iV=async(e,n)=>{const s=fj(),o=he(s,te("authNumber","==",n),te("insuranceId","==",e),te("deleted","==",!1)),r=await Me(o);return r.empty?[]:r.docs.map(i=>i.data())};async function aV({user:e,cart:n,client:s,accountsReceivable:o,insuranceAR:r,insuranceAuth:i,ncfType:a,taxReceiptEnabled:c=!1,setLoading:d=()=>{},dispatch:u,dueDate:p=null,insuranceEnabled:h=!1,isTestMode:f=!1}){var x;try{if(d({status:!0,message:"Procesando factura..."}),lV(n),f)return d({status:!0,message:"Procesando factura en modo prueba..."}),await bV({user:e,cart:n,client:s,accountsReceivable:o,insuranceAR:r,insuranceAuth:i,ncfType:a,taxReceiptEnabled:c,dueDate:p,insuranceEnabled:h});const{cashCount:g}=await dV({user:e,dispatch:u});if(!g)throw new Error("No se puede procesar la factura sin cuadre de caja");const[y,b]=await Promise.all([uV({user:e,taxReceiptEnabled:c,ncfType:a,client:s}),pV({user:e,client:s})]),v=(x=n==null?void 0:n.preorderDetails)!=null&&x.isOrWasPreorder?await xV({user:e,cart:n,cashCount:g,ncfCode:y}):await hV({user:e,cart:n,clientData:b,ncfCode:y,cashCount:g,dueDate:p});if(await mV({user:e,products:n.products,invoice:v}),n!=null&&n.isAddedToReceivables&&(o!=null&&o.totalInstallments)&&await gV({user:e,accountsReceivable:o,invoice:v}),h&&(r!=null&&r.totalInstallments)){const C={...r,clientId:s.id,invoiceId:v.id},I=await rV(e,i,b.clientId);await fV({user:e,arData:C,invoice:v,insuranceAuth:i,authDataId:I})}return{invoice:v}}catch(g){throw g}}function cV({cart:e,dueDate:n}){if(!n)return e;const s=ue.fromMillis(n);return{...e,dueDate:s,hasDueDate:!0}}function lV(e){const{isValid:n,message:s}=$r(e);if(!n)throw new Error(s)}async function dV({user:e,dispatch:n,transaction:s}){try{const{state:o,cashCount:r}=await zq(e,s);if(o==="open")return{cashCount:r};if(["closed","closing","none"].includes(o))return Fq(o,n).handleConfirm(),{cashCount:null}}catch(o){throw new Error(`Error al validar cuadre de caja: ${o.message}`)}}async function uV({user:e,taxReceiptEnabled:n,ncfType:s}){if(!e||!n)return null;try{return await qq(e,s)}catch(o){throw console.error(`Error processing tax receipt for type ${s}:`,o.message),new Error("Failed to process tax receipt")}}async function pV({user:e,client:n}){if(!n)return{client:Xs};if(!n.id)return{client:Xs};try{return await Vq(e,n),{clientId:n.id,client:n}}catch(s){throw new Error(`Error al actualizar los datos del cliente: ${s.message}`)}}async function mV({user:e,products:n,invoice:s}){await Hq(n,e,s)}async function hV({user:e,cart:n,cashCount:s,ncfCode:o,clientData:r,dueDate:i}){try{const c={...i?cV({cart:n,dueDate:i}):n,NCF:o,client:r.client,cashCountId:s.id};return await Yq(c,e)||c}catch(a){throw new Error(`Error al generar la factura final: ${a.message}`)}}async function gV({user:e,accountsReceivable:n,invoice:s}){try{if(!(s!=null&&s.isAddedToReceivables))return;if(!(n!=null&&n.totalInstallments))throw new Error("Installments data is missing");const o=await mj({user:e,accountsReceivable:n});await hj({user:e,ar:o})}catch(o){throw new Error(`Error al gestionar cuentas por cobrar: ${o.message}`)}}async function fV({user:e,arData:n,invoice:s,insuranceAuth:o,authDataId:r}){var i;try{if(console.log("------------------------------------------------insuranceAR Object:",JSON.stringify(n)),console.log("insuranceAuth Object:",JSON.stringify(o)),!(n!=null&&n.totalInstallments))throw new Error("Datos de cuotas de seguro faltantes");const{insuranceName:a}=await sV(e,o.insuranceId),c={...n,invoiceId:s.id,clientId:(i=s==null?void 0:s.client)==null?void 0:i.id,paymentFrequency:n.paymentFrequency||"monthly",totalInstallments:n.totalInstallments||1,installmentAmount:n.installmentAmount||0,totalReceivable:n.totalReceivable||0,currentBalance:n.currentBalance||n.totalReceivable||0,createdAt:n.createdAt||ce.now().toMillis(),updatedAt:n.updatedAt||ce.now().toMillis(),paymentDate:n.paymentDate,isActive:n.isActive!==void 0?n.isActive:!0,isClosed:n.isClosed!==void 0?n.isClosed:!1,type:"insurance",insurance:{authId:r,name:a,insuranceId:o.insuranceId,authNumber:o.authNumber},comments:n.comments||""};console.log("Normalized AR Object:",JSON.stringify(c,null,2));const d=await mj({user:e,accountsReceivable:c});await hj({user:e,ar:d}),console.log("ar created: ------------------- ",d)}catch(a){throw console.error("Error en manageInsuranceReceivableAccounts:",a),new Error(`Error al gestionar cuentas por cobrar de seguro: ${a.message}`)}}async function xV({user:e,cart:n,cashCount:s,ncfCode:o}){var r;try{if(!((r=n==null?void 0:n.preorderDetails)!=null&&r.isOrWasPreorder)||!(n!=null&&n.status)=="pending")throw new Error("Invalid preorder data");const i={...n,NCF:o,cashCountId:s.id};return await Zq(e,i),i}catch(i){throw console.error(i),i}}async function bV({user:e,cart:n,client:s,accountsReceivable:o,insuranceAR:r,insuranceAuth:i,ncfType:a,taxReceiptEnabled:c,dueDate:d,insuranceEnabled:u}){try{console.log("🧪 Procesando factura en MODO PRUEBA - No se guardará en base de datos");const p=c?`TEST-${a}-${Date.now()}`:null,h=s||{id:"test-client-id",name:"Cliente de Prueba",...Xs},f={id:`TEST-INVOICE-${Date.now()}`,...n,NCF:p,client:h,cashCountId:"test-cash-count-id",createdAt:new Date().toISOString(),testMode:!0,status:"test-preview",timestamp:Date.now()};return d&&(f.dueDate=new Date(d),f.hasDueDate=!0),await new Promise(x=>setTimeout(x,1e3)),console.log("✅ Factura de prueba generada exitosamente:",f),{invoice:f}}catch(p){throw console.error("❌ Error en modo de prueba:",p),new Error(`Error en modo de prueba: ${p.message}`)}}Mx(j0,"handleInvoiceRequest");function yV(){const[e,n]=m.useState(!1),[s,o]=m.useState(null),r=W();return{loading:e,error:s,processInvoice:async({user:a,cart:c,client:d,accountsReceivable:u=[],insuranceAR:p=null,insuranceAuth:h=null,ncfType:f=null,taxReceiptEnabled:x=!1,dueDate:g=null,insuranceEnabled:y=!1})=>{n(!0),o(null),console.log("-------",{user:a,cart:c,client:d,accountsReceivable:u,insuranceAR:p,insuranceAuth:h,ncfType:f,taxReceiptEnabled:x,dueDate:g,insuranceEnabled:y}),n(!1)}}}const ot={title:{fontSize:14,lineHeight:1.15,marginBottom:6},headerInfo:{fontSize:10,lineHeight:1.15,marginVertical:1},default:{fontSize:10,lineHeight:1.15},totalsValue:{fontSize:10,lineHeight:1.15,marginVertical:1}},Bt={pageWidth:531,logoAllocatedHeight:80,logoMargin:4,separatorMargin:10,clientBlockMargin:9,headerMargin:12,footerSignatureHeight:25,paymentMethodSpacing:4,headerColumnWidth:521/2};function xs(e,n=10,s=1.15,o=Bt.pageWidth){if(!e)return 0;const r=n*.6,i=Math.floor(o/r);return Math.ceil(e.length/i)*n*s}function vV(e,n){var d,u,p,h,f,x,g;let s=Bt.headerMargin;e.logoUrl&&(s+=Bt.logoAllocatedHeight+Bt.logoMargin);let o=0;e.name&&(o+=xs(e.name,ot.title.fontSize,ot.title.lineHeight,Bt.headerColumnWidth)+ot.title.marginBottom),[e.address,e.tel?`Tel: ${e.tel}`:null,e.email,e.rnc?`RNC: ${e.rnc}`:null].filter(Boolean).forEach(y=>{o+=xs(y,ot.headerInfo.fontSize,ot.headerInfo.lineHeight,Bt.headerColumnWidth)+ot.headerInfo.marginVertical*2});let i=0;const a=wV(n.NCF||n.comprobante);if(i+=xs(a,ot.title.fontSize,ot.title.lineHeight,Bt.headerColumnWidth)+ot.title.marginBottom,[`Fecha: ${Il(n.date)}`,`${SV(n.NCF||n.comprobante)}: ${n.NCF||n.comprobante||"-"}`,`No: ${n.numberID||"-"}`,n.type==="preorder"&&((d=n.preorderDetails)!=null&&d.date)?`Fecha de Pedido: ${Il(n.preorderDetails.date)}`:null,n.dueDate?`Vence: ${Il(n.dueDate)}`:null].filter(Boolean).forEach(y=>{i+=xs(y,ot.headerInfo.fontSize,ot.headerInfo.lineHeight,Bt.headerColumnWidth)+ot.headerInfo.marginVertical*2}),s+=Math.max(o,i),s+=Bt.separatorMargin,CV(n)){let y=0;[`Cliente: ${n.client.name}`,(p=(u=n.client)==null?void 0:u.address)!=null&&p.trim()?`Dirección: ${n.client.address.trim()}`:null,(f=(h=n.client)==null?void 0:h.tel)!=null&&f.trim()?`Tel: ${n.client.tel.trim()}`:null,(g=(x=n.client)==null?void 0:x.personalID)!=null&&g.trim()?`RNC cliente: ${n.client.personalID.trim()}`:null].filter(Boolean).forEach(v=>{y+=xs(v,ot.headerInfo.fontSize)+ot.headerInfo.marginVertical*2}),s+=y+Bt.clientBlockMargin}return Math.ceil(s)}function jV(e,n){var i,a,c,d,u,p;let s=0;s+=Bt.footerSignatureHeight*2;const o=((i=n.paymentMethod)==null?void 0:i.filter(h=>h==null?void 0:h.status))||[];o.length>0&&(s+=ot.default.fontSize*ot.default.lineHeight+Bt.paymentMethodSpacing,o.forEach(h=>{const f=IV(h);s+=xs(f,ot.default.fontSize)+ot.default.lineHeight}));let r=2;return(a=n.discount)!=null&&a.value&&(r+=1),(c=n.delivery)!=null&&c.status&&(r+=1),r+=1,s+=r*(ot.totalsValue.fontSize*ot.totalsValue.lineHeight+ot.totalsValue.marginVertical*2),(d=n.invoiceComment)!=null&&d.trim()&&(s+=xs(n.invoiceComment.trim(),ot.default.fontSize,ot.default.lineHeight,Bt.pageWidth)+8),(p=(u=e==null?void 0:e.invoice)==null?void 0:u.invoiceMessage)!=null&&p.trim()&&(s+=xs(e.invoice.invoiceMessage.trim(),ot.default.fontSize,ot.default.lineHeight,Bt.pageWidth)+4),s+=20,Math.ceil(s)}function CV(e){var s,o;const n=((o=(s=e.client)==null?void 0:s.name)==null?void 0:o.trim())||"";return n&&n.toLowerCase()!=="generic client"}function wV(e){return e?e.startsWith("B01")?"FACTURA DE CRÉDITO FISCAL":e.startsWith("B02")?"FACTURA DE CONSUMO":"COMPROBANTE FISCAL":"RECIBO DE PAGO"}function SV(e){return e?"NCF":"Número de Recibo"}function Il(e){if(!e)return"-";if(e.seconds){const n=e.seconds*1e3+Math.floor(e.nanoseconds/1e6);return new Date(n).toLocaleDateString("es-DO")}return new Date(e).toLocaleDateString("es-DO")}function IV(e){var i;const s={cash:"Efectivo",transfer:"Transferencia",card:"Tarjeta",credit:"Crédito"}[(i=e.method)==null?void 0:i.toLowerCase()]||e.method,o=Number(e.value||0).toFixed(2),r=e.reference?` - Ref: ${e.reference}`:"";return`${s}: ${o}${r}`}function un(e){return Number(e).toFixed(2)}function El(e){const n=e instanceof Date?e.getTime():typeof e.toMillis=="function"?e.toMillis():e!=null&&e.seconds?e.seconds*1e3:Number(e);return isNaN(n)?"":ce.fromMillis(n).toFormat("dd/MM/yyyy")}function EV(e){return e.products.reduce((s,o)=>s+o.pricing.price*o.amountToBuy,0)*(e.discount.value/100)}function xj(e){var r;if(!e.discount||e.discount.value<=0)return 0;const n=+((r=e.pricing)==null?void 0:r.price)||0,s=+e.amountToBuy||1,o=n*s;return e.discount.type==="percentage"?o*(e.discount.value/100):Math.min(e.discount.value,o)}function AV(e){return e.reduce((n,s)=>n+xj(s),0)}function kV(e){return e.some(n=>n.discount&&n.discount.value>0)}function TV(e){var a,c,d,u,p,h,f,x;const n=((c=(a=e.client)==null?void 0:a.name)==null?void 0:c.trim())||"",s=!n||n.toLowerCase()==="generic client",r=[{text:[{text:"Cliente:  ",bold:!0},{text:s?"Cliente Genérico":n,color:"#111"}],style:"headerInfo"},...!s&&((u=(d=e.client)==null?void 0:d.address)!=null&&u.trim())?[{text:[{text:"Dirección:  ",bold:!0},{text:e.client.address.trim(),color:"#111"}],style:"headerInfo"}]:[]],i=[...!s&&((h=(p=e.client)==null?void 0:p.tel)!=null&&h.trim())?[{text:[{text:"Tel:  ",bold:!0},{text:e.client.tel.trim(),color:"#111"}],style:"headerInfo",noWrap:!0}]:[],...!s&&((x=(f=e.client)==null?void 0:f.personalID)!=null&&x.trim())?[{text:[{text:"RNC cliente:  ",bold:!0},{text:e.client.personalID.trim(),color:"#111"}],style:"headerInfo",noWrap:!0}]:[]];return!r.length&&!i.length?null:{columns:[{width:"*",stack:r},{width:"auto",stack:i}]}}function PV(e){return e?e.startsWith("B01")?{title:"FACTURA DE CRÉDITO FISCAL",label:"NCF"}:e.startsWith("B02")?{title:"FACTURA DE CONSUMO",label:"NCF"}:{title:"COMPROBANTE FISCAL",label:"NCF"}:{title:"RECIBO DE PAGO",label:"Número de Recibo"}}function DV(e,n,s){return()=>{var u;const o=TV(n),{title:r,label:i}=PV(n.NCF||n.comprobante),a=[{text:e.name,style:"title"},e.address&&{text:e.address,style:"headerInfo"},e.tel&&{text:`Tel: ${e.tel}`,style:"headerInfo"},e.email&&{text:e.email,style:"headerInfo"},e.rnc&&{text:`RNC: ${e.rnc}`,style:"headerInfo",bold:!0}].filter(Boolean);n.date.seconds*1e3+Math.floor(n.date.nanoseconds/1e6);const c=[{text:r,style:"title",alignment:"right"},{text:`Fecha: ${El(n.date)}`,style:"headerInfo",alignment:"right"},{text:`${i}: ${n.NCF||n.comprobante||"-"}`,style:"headerInfo",alignment:"right",bold:!0},{text:`No: ${n.numberID||"-"}`,style:"headerInfo",alignment:"right",bold:!0},n.type==="preorder"&&((u=n.preorderDetails)==null?void 0:u.date)&&{text:`Fecha de Pedido: ${El(n.preorderDetails.date)}`,style:"headerInfo",alignment:"right"},n.dueDate&&{text:`Vence: ${El(n.dueDate)}`,style:"headerInfo",alignment:"right",bold:!0}].filter(Boolean),d=[];return s.logo&&d.push([{image:"logo",width:120,margin:[0,0,0,8],colSpan:2,width:200,height:80,fit:[200,80]},{}]),d.push([{columns:[{width:"*",stack:a},{width:"auto",stack:c}],colSpan:2},{}]),d.push([{canvas:[{type:"line",x1:0,y1:0,x2:530,y2:0,lineWidth:.3,lineColor:"#cccccc"}],colSpan:2,margin:[0,4,0,6]},{}]),o&&d.push([{columns:[{width:"*",stack:o.columns[0].stack},{width:"auto",stack:o.columns[1].stack}],columnGap:10,colSpan:2,margin:[0,3,0,6]},{}]),{margin:[32,12,32,0],table:{widths:["*","*"],body:d},layout:"noBorders"}}}function $V(e){const s=[["CANT","CODIGO","DESCRIPCIÓN","PRECIO","ITBIS","TOTAL"].map(o=>({text:o,style:"tableHeader",fillColor:"#4a4a4a",alignment:"center",noWrap:!0})),...e.products.flatMap(o=>{var p,h;const r=+((p=o.pricing)==null?void 0:p.price)||0,i=+((h=o.pricing)==null?void 0:h.tax)||0,a=r*(i/100),c=(r+a)*(+o.amountToBuy||0),d=[{text:o.amountToBuy,alignment:"center"},o.barcode||"-",o.name,{text:un(r),alignment:"right"},{text:un(a),alignment:"right"},{text:un(c),alignment:"right"}],u=[];if(o.discount&&o.discount.value>0){const f=xj(o),x=o.discount.type==="percentage"?`${o.discount.value}%`:"Monto fijo";u.push([{text:`Descuento: -${un(f)} (${x})`,colSpan:6,color:"#52c41a",bold:!0,margin:[0,1,0,1]},{},{},{},{},{}])}return o.comment&&u.push([{text:o.comment,colSpan:6,margin:[0,1,0,3],preserveLeadingSpaces:!0},{},{},{},{},{}]),[d,...u]})];return[{margin:[0,12,0,0],table:{headerRows:1,widths:[40,55,"*",55,55,55],body:s},layout:{hLineColor:()=>"#e0e0e0",vLineColor:()=>"#e0e0e0",hLineWidth:()=>.5,vLineWidth:()=>.5}}]}const RV={cash:"Efectivo",transfer:"Transferencia",card:"Tarjeta"};function pg(e,n){return{stack:[{canvas:[{type:"line",x1:0,y1:0,x2:130,y2:0,lineWidth:1}],margin:[0,0,0,6]},{text:e||"",bold:!0,margin:[0,0,0,10]},n&&{text:n,alignment:"center",margin:[0,4,0,0]}].filter(Boolean)}}function NV(e,n){var c,d,u;const s=(c=n.paymentMethod)!=null&&c.filter(p=>p==null?void 0:p.status).length?[{text:"Métodos de Pago:",bold:!0,margin:[0,0,0,4]},{ul:n.paymentMethod.filter(p=>p==null?void 0:p.status).map(p=>{var h;return{text:`${RV[(h=p.method)==null?void 0:h.toLowerCase()]||p.method}: `+un(p.value||0)+(p.reference?` - Ref: ${p.reference}`:""),margin:[0,0,0,0]}})}]:[],o=AV(n.products||[]),r=kV(n.products||[]),i=r?0:EV(n),a=[["Sub-Total:",{text:un(n.totalPurchaseWithoutTaxes.value),style:"totalsValue",margin:[0,0]}],["ITBIS:",{text:un(n.totalTaxes.value),style:"totalsValue",margin:[0,0]}],!r&&((d=n.discount)==null?void 0:d.value)&&["Descuento General:",{text:`-${un(i)}`,style:"totalsValue",margin:[0,0]}],r&&["Descuentos Productos:",{text:`-${un(o)}`,style:"totalsValue",margin:[0,0]}],((u=n.delivery)==null?void 0:u.status)&&["Delivery:",{text:un(n.delivery.value),style:"totalsValue",margin:[0,0]}],[{text:"Total:",bold:!0,margin:[0,4,0,2]},{text:un(n.totalPurchase.value),style:"totalsValue",bold:!0,margin:[0,4,0,2]}]].filter(Boolean);return()=>{var p;return{margin:[32,0,32,0],stack:[{columnGap:25,columns:[{width:"*",stack:[pg("Despachado Por:"),...s]},{width:"*",stack:[pg("Recibido Conforme:",n.copyType||"COPIA")]},{width:"*",margin:[0,2,0,0],table:{widths:["*","*"],body:a},layout:"noBorders"}]},...n.invoiceComment?[{text:n.invoiceComment,margin:[0,8,0,0]}]:[],...(p=e==null?void 0:e.invoice)!=null&&p.invoiceMessage?[{text:e.invoice.invoiceMessage,margin:[0,4,0,0]}]:[]]}}}x0.vfs=IS.vfs;const OV=async(e,n)=>{const s={};if(e.logoUrl)try{s.logo=e.logoUrl}catch(a){console.warn("❌ Logo download failed:",a.message)}const o=vV(e,n),r=jV(e,n),i={images:s,pageSize:"A4",pageMargins:[32,o,32,r],defaultStyle:{font:"Roboto",fontSize:10,lineHeight:1.15},styles:{title:{fontSize:14,bold:!0,margin:[0,0,0,6]},headerInfo:{fontSize:11,margin:[0,1,0,1]},tableHeader:{bold:!0,fontSize:11,color:"white"},separator:{canvas:[{type:"line",x1:0,y1:0,x2:515,y2:0,lineWidth:1,lineColor:"#e0e0e0"}]},totalsLabel:{bold:!0},totalsValue:{bold:!0,alignment:"right"}},header:DV(e,n,s),content:$V(n),footer:NV(e,n)};try{return await new Promise((c,d)=>x0.createPdf(i).getBase64(c,d))}catch(a){throw console.error("❌ PDF creation failed:",a),a}};async function MV(e,n,s){try{const o=Mx(j0,"quotationPdf"),{data:r}=await o({business:e,data:n});f0({printable:r,type:"pdf",base64:!0,showModal:!0,onPrintDialogClose:s})}catch(o){console.error("PDF generation failed",o.message),console.error(o.stack)}}async function FV(e,n,s){try{console.log("business",e),console.log("data",n),console.log("🔄 Intentando generar PDF...");const o=await OV(e,n);f0({printable:o,type:"pdf",base64:!0,showModal:!0,onPrintDialogClose:s})}catch(o){console.error("❌ PDF generation with logo failed:",o.message),console.error(o.stack)}}const bj={mask:{backdropFilter:"blur(2px)",display:"grid",overflow:"hidden"},content:{padding:0,width:"100%",height:"100%",margin:0,overflowY:"hidden",display:"grid"},body:{margin:0,padding:"1em",overflowY:"auto"}},BV=(e,n)=>n?We().add(e.months||0,"month").add(e.weeks||0,"week").add(e.days||0,"day"):null,So=({dispatch:e,viewport:n,closeInvoicePanel:s=!0})=>{e!==void 0&&(n!==void 0&&n<=800&&e(kc()),s&&e(AD()),e(Kb()),e(T0()),e(Gu()),e(Vu()))},yj=()=>{var fe,se;const e=W(),[n]=M.useForm(),[s,o]=m.useState({}),[r,i]=m.useState(!1);yV();const[a,c]=m.useState({status:!1,message:""}),d=Ps(),u=()=>e(Qu()),p=D(as),h=D(zt),f=h.isInvoicePanelOpen,x=h.printInvoice,{duePeriod:g,hasDueDate:y}=h==null?void 0:h.billing,b=m.useRef(),v=D(q),C=D(Ht),I=D(D0),j=D(ci),{settings:{taxReceiptEnabled:k}}=D($0);(fe=p==null?void 0:p.payment)==null||fe.value;const A=p==null?void 0:p.isAddedToReceivables,P=D(ft)||{},w=cs(),E=((p==null?void 0:p.paymentMethod)||[]).some(ee=>ee.status),R=((se=p==null?void 0:p.change)==null?void 0:se.value)<0,N=D(cv),G=D(Ac)||null,Q=h.billing.invoiceType,ae=D(Ku),oe=()=>{o({}),So({dispatch:e,viewport:d}),Be.success({message:"Venta Procesada",description:"La venta ha sido procesada con éxito",duration:4}),c({status:!1,message:""}),i(!0)},Z=Vo.useReactToPrint({content:()=>b.current,onAfterPrint:()=>oe()}),J=()=>{Ce.confirm({title:"¿Cancelar Venta?",content:"Si cancelas, se perderán los datos de la venta actual.",okText:"Cerrar y Volver",zIndex:999999999999,okType:"danger",cancelText:"Atrás",onOk(){V.success("Venta cancelada",2.5),So({dispatch:e,viewport:d})},onCancel(){V.info("Continuando con la venta",2.5)}})},X=async ee=>{if(Q==="template2")try{console.log("🚀 Starting PDF generation for template2"),console.log("📊 Business data:",P),console.log("📋 Invoice data:",ee),await FV(P,ee,oe)}catch(K){Be.error({message:"Error al imprimir",description:`No se pudo generar el PDF: ${K.message}`,duration:4}),console.error("❌ PDF generation failed:",K),console.error("❌ Error stack:",K.stack)}else setTimeout(()=>Z(),1e3)};async function me(){var ee,K,B;try{c({status:!0,message:""}),p!=null&&p.isAddedToReceivables&&await n.validateFields();const _=BV(g,y),L=(B=(K=(ee=p==null?void 0:p.products)==null?void 0:ee.filter(ne=>ne.comment))==null?void 0:K.map(ne=>`${ne.name}: ${ne.comment}`))==null?void 0:B.join("; "),{invoice:H}=await aV({cart:p,user:v,client:C,accountsReceivable:j,taxReceiptEnabled:k,ncfType:I,setLoading:c,dispatch:e,dueDate:_==null?void 0:_.valueOf(),insuranceEnabled:w,insuranceAR:N,insuranceAuth:G,invoiceComment:L,isTestMode:ae});x&&(o(H),await X(H)),x||(o({}),oe())}catch(_){Be.error({message:"Error de Proceso",description:_.message,duration:4}),c({status:!1,message:""}),i(!1),console.error("Error processing invoice:",_)}}return m.useEffect(()=>{n.setFieldsValue({frequency:"monthly",totalInstallments:1,paymentDate:Ve.convertMillisToDayjs(Date.now())})},[]),m.useEffect(()=>{n.setFieldsValue({...j,paymentDate:Ve.convertMillisToDayjs(j==null?void 0:j.paymentDate)})},[j]),m.useEffect(()=>{f||i(!1)},[f]),m.useEffect(()=>{var ee;if(f){const K=(p==null?void 0:p.paymentMethod)||[],B=K.some(L=>L.status),_=((ee=p==null?void 0:p.totalPurchase)==null?void 0:ee.value)||0;if(B){const L=K.reduce((H,ne)=>ne.status?H+(Number(ne.value)||0):H,0);if(!A&&L===0&&_>0){const H=K.find(ne=>ne.method==="cash");H&&e(Ws({...H,status:!0,value:_}))}}else{const L=K.find(H=>H.method==="cash")||K[0];L&&e(Ws({...L,status:!0,value:A?0:_}))}}},[f]),t.jsxs(vj,{style:{top:10},open:f,title:"Pago de Factura",onCancel:u,styles:bj,footer:[t.jsx(U,{type:"default",danger:!0,disabled:a.status||r,onClick:J,children:"Cancelar"},"cancel"),t.jsx(U,{type:"default",disabled:a.status||r,onClick:u,children:"Cerrar"},"close"),t.jsx(U,{type:"primary",loading:a.status,disabled:r||!E||R&&!A,onClick:me,children:"Facturar"},"submit")],children:[t.jsx(ej,{ref:b,data:s}),t.jsx(He,{spinning:a.status,children:t.jsx(kq,{form:n})})]})},vj=l(Ce)`
    .ant-modal-content{
    }
    .ant-modal-header{
        padding: 1em 1em 0;
    }
    .ant-modal-body{
        padding: 1em ;
        /* overflow-y: scroll;    */
    }
    .ant-modal-footer{
        padding: 0 1em 1em;
    }
    padding: 0;

`,LV=async(e,n)=>{if(!n)return"N/A";try{const[s,o,r,i]=n.split("/");let a="",c="",d="",u="";if(s){const h=await Se(F($,"businesses",e.businessID,"warehouses",s));h.exists()&&(a=h.data().name)}if(o){const h=await Se(F($,"businesses",e.businessID,"shelves",o));h.exists()&&(c=h.data().name)}if(r){const h=await Se(F($,"businesses",e.businessID,"rows",r));h.exists()&&(d=h.data().name)}if(i){const h=await Se(F($,"businesses",e.businessID,"segments",i));h.exists()&&(u=h.data().name)}const p=[a,c,d,u].filter(Boolean);return p.length?p.join(" / "):"Ubicación no encontrada"}catch(s){return console.error("Error getting location name:",s),"Error al obtener ubicación"}},Al=new Map,jj=()=>{const e=D(q),[n,s]=m.useState({}),o=m.useCallback(async i=>{if(!i)return"N/A";if(Al.has(i))return Al.get(i);try{const a=await LV(e,i);return Al.set(i,a),a}catch(a){return console.error("Error fetching location name:",a),"Error"}},[e]),r=m.useCallback(async i=>{if(!n[i]){const a=await o(i);s(c=>({...c,[i]:a}))}},[o,n]);return{locationNames:n,fetchLocationName:r}};l.div`
  .batch-select-button {
    background: linear-gradient(145deg, #2563eb, #1d4ed8);
    border: none;
    padding: 10px 20px;
    border-radius: 12px;
    color: white;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);

    &:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 8px -1px rgba(0, 0, 0, 0.15);
    }
  }
`;const zV=l(Ce)`
  .ant-modal-content {
    border-radius: 16px;
    overflow: hidden;
  }



  .search-container {
    margin-bottom: 16px;
  }
`,UV=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 12px;
  padding: 12px 0;
  max-height: 60vh;
  overflow-y: auto;
  
  &::-webkit-scrollbar {
    width: 8px;
  }
  
  &::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
  }
  
  &::-webkit-scrollbar-thumb {
    background: #94a3b8;
    border-radius: 4px;
  }
`,WV=l.span`
  background: #f1f5f9;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 0.8rem;
  color: #475569;
  margin-bottom: 4px;
  display: inline-block;
  
  &:hover {
    background: #e2e8f0;
  }
`,qV=l.div`
  position: relative;
  background: white;
  border-radius: 12px;
  padding: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 2px solid ${e=>e.selected?"#2563eb":"#e2e8f0"};
  box-shadow: ${e=>e.selected?"0 4px 12px rgba(37, 99, 235, 0.15)":"0 2px 8px rgba(0, 0, 0, 0.05)"};
  display: flex;
  flex-direction: column;
  gap: 4px;

  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
  }

  .card-header {
    /* padding-bottom: 2px; */
    /* border-bottom: 1px solid #e2e8f0; */
  }

  .card-content {
    display: grid;
    grid-template-columns: 1.2fr 0.8fr;
    gap: 12px;
  }

  .locations-column {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .info-column {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding-left: 12px;
    border-left: 1px solid #e2e8f0;
  }

  .batch-number {
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .info-row {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
    color: #64748b;

    .icon {
      min-width: 16px;
      color: #94a3b8;
    }

    .text {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }

  .quantity {
    color: #2563eb;
    font-weight: 500;
  }

  .check-icon {
    color: #2563eb;
    opacity: ${e=>e.selected?1:0};
    transform: ${e=>e.selected?"scale(1)":"scale(0.5)"};
    transition: all 0.2s ease;
    font-size: 18px;
  }
`;function VV(){const e=W(),{isOpen:n,productId:s,product:o}=D(rO),[r,i]=m.useState(null),[a,c]=m.useState(""),{products:d}=D(as),{data:u,loading:p}=mp(s),{locationNames:h,fetchLocationName:f}=jj(),x=u.filter(v=>v.batchNumberId.toString().toLowerCase().includes(a.toLowerCase())||v.location.toLowerCase().includes(a.toLowerCase()));m.useEffect(()=>{[...new Set(x.map(C=>C.location).filter(Boolean))].forEach(C=>{h[C]||f(C)})},[x,h,f]),m.useEffect(()=>{d.length===0&&i(null)},[d.length]);function g(v){return v?h[v]||"Cargando...":""}const y=v=>{i(r===v?null:v)},b=()=>{if(r){const v=u.find(C=>C.id===r);e(Yn({...o,productStockId:v==null?void 0:v.id,batchId:v==null?void 0:v.batchId,stock:v.quantity})),e(Gm())}};return t.jsxs(zV,{open:n,onCancel:()=>e(Gm()),title:"Seleccionar Ubicación del Producto",width:800,style:{top:10},footer:t.jsx(U,{type:"primary",onClick:b,disabled:!r,style:{background:"#2563eb",borderRadius:"8px",height:"40px"},children:"Confirmar"}),children:[t.jsx("div",{className:"search-container",children:t.jsx(ie,{placeholder:"Buscar por número de lote o ubicación...",prefix:t.jsx(Kr,{}),value:a,onChange:v=>c(v.target.value),style:{borderRadius:"8px"}})}),p?t.jsx("div",{style:{textAlign:"center",padding:"20px"},children:t.jsx(He,{})}):x.length>0?t.jsx(UV,{children:x.map(v=>t.jsxs(qV,{selected:r===v.id,onClick:()=>y(v.id),children:[t.jsx("div",{className:"card-header",children:t.jsxs("div",{className:"batch-number",children:["Lote #",v.batchNumberId,t.jsx($o,{className:"check-icon"})]})}),t.jsxs("div",{className:"card-content",children:[t.jsx("div",{className:"locations-column",children:t.jsx(WV,{children:g(v.location)})}),t.jsxs("div",{className:"info-column",children:[t.jsx("div",{className:"info-row quantity",children:t.jsxs("span",{className:"text",children:[v.quantity," / ",v.initialQuantity," unidades"]})}),t.jsxs("div",{className:"info-row",children:[t.jsx(Tn,{className:"icon"}),t.jsx("span",{className:"text",children:v.expirationDate?new Date(v.expirationDate.seconds*1e3).toLocaleDateString():"N/A"})]})]})]})]},v.id))}):t.jsx(Lt,{description:"No se encontraron lotes",style:{margin:"40px 0"}})]})}const GV=(e,n)=>{const[s,o]=m.useState(e);return m.useEffect(()=>{if(String(n).trim()===""){o(e);return}const r=new RegExp(n,"i"),i=e.filter(a=>r.test(a.name));o(i.slice(0,3))},[n,e]),s},_V=(e,n)=>{if(!n)return e;const s=n.toLowerCase();return e.filter(o=>eu(o,s))},eu=(e,n)=>Object.values(e).some(s=>typeof s=="string"||typeof s=="number"?s.toString().toLowerCase().includes(n):Array.isArray(s)?s.some(o=>eu(o,n)):typeof s=="object"&&s!==null?eu(s,n):!1),HV=({isOpen:e})=>{const[n,s]=m.useState([]),[o,r]=m.useState(!1),i=D(q),a=m.useRef(null);return m.useEffect(()=>{if(a.current&&(a.current(),a.current=null),!e||!(i!=null&&i.businessID)){s([]),r(!1);return}r(!0);const c=le($,"businesses",i.businessID,"clients"),d=he(c,it("client.name","asc"));return a.current=Te(d,u=>{const p=u.docs.map(h=>h.data());s(p),r(!1)},u=>{console.error("Firestore listener error:",u),r(!1)}),()=>{a.current&&a.current()}},[e,i==null?void 0:i.businessID]),{clients:n,loading:o}},QV=m.lazy(()=>ks(()=>import("./ClientSelectionModal-gClGm238.js"),__vite__mapDeps([167,1,2,3,4,6,7,8,74])).then(e=>({default:e.ClientSelectionModal}))),YV=m.lazy(()=>ks(()=>import("./ClientSelectionToolbar-pHIqA2JJ.js"),__vite__mapDeps([168,1,2,3,4,9,10,6,7,8,19,20,21,22,12,13,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66])).then(e=>({default:e.ClientSelectionToolbar}))),KV=m.lazy(()=>ks(()=>import("./ClientListContainer-BWn2UYBo.js"),__vite__mapDeps([169,1,2,3,4,6,7,8,19,20,21,22,12,13,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,16,17,18,67,68,69,14,15,70,71,72,73,5,9,10,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,11,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166])).then(e=>({default:e.ClientListContainer}))),JV=m.lazy(()=>ks(()=>import("./ClientPaginationBar-DMyZBPQ6.js"),__vite__mapDeps([170,1,2,3,4,6,7,8,19,20,21,22,12,13,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66])).then(e=>({default:e.ClientPaginationBar}))),XV=()=>{const e=W(),n=D(mD),s=D(q);D(Hb);const o=D(Ht),r=D(Qb),{clients:i,loading:a}=HV({isOpen:n}),[c,d]=m.useState("all"),[u,p]=m.useState(1),[h,f]=m.useState(20),x=S=>{const E=S.reduce((T,{client:R})=>{var G;const N=(G=R.name)==null?void 0:G.toLowerCase();return N&&(T[N]=(T[N]||0)+1),T},{});return S.filter(({client:T})=>T.name&&E[T.name.toLowerCase()]>1)},g=S=>S.filter(({client:E})=>!E.name),y=m.useMemo(()=>_V(i,r),[i,r]),b=m.useMemo(()=>x(i),[i]),v=m.useMemo(()=>g(i),[i]),C=m.useMemo(()=>c==="duplicates"?b:c==="noName"?v:y,[c,b,v,y]),I=m.useMemo(()=>C.slice((u-1)*h,u*h),[C,u,h]),j=S=>d(S.key),k=()=>{e(ko(!1)),e(Pn({mode:_e.CREATE.id,data:null,addClientToCart:!0}))},A=S=>{e(ko(!1)),e(Gb(at.UPDATE.id)),e(Pn({mode:_e.UPDATE.id,data:S,addClientToCart:!0}))},P=async S=>{await Ic(s==null?void 0:s.businessID,S)},w=()=>{e(ko(!1))};return t.jsx(m.Suspense,{children:t.jsxs(QV,{isOpen:n,onClose:w,children:[t.jsx(YV,{filter:c,filteredClientsToShow:C,handleMenuClick:j,openAddClientModal:k,onClose:w}),t.jsx(KV,{paginatedClients:I,loading:a,selectedClient:o,openUpdateClientModal:A,handleDeleteClient:P,onClose:w,searchTerm:r}),t.jsx(JV,{filteredClients:y,clients:i,currentPage:u,pageSize:h,filteredClientsToShow:C,setCurrentPage:p,setPageSize:f})]})})},ZV=()=>{const[e,n]=m.useState("");D(q),D(S0);const{products:s,loading:o}=Rs(),r=Ps(),i=W();ez(s,(u,p)=>{var x;if(u.length<=0){Be.error({message:"Error al escanear",description:"Error al cargar los productos, por favor intente de nuevo.",placement:"top"});return}const h=u.find(g=>(g==null?void 0:g.barcode)===p||(g==null?void 0:g.barcode)===hU(p));if(!h){Be.error({message:"Producto no encontrado",description:`El producto con el código de barras ${p} no existe.`,placement:"top"});return}const f=((x=h==null?void 0:h.weightDetail)==null?void 0:x.isSoldByWeight)||!1;if(p.startsWith("20")&&p.length===13&&f){const g=gU(p),y=fU(g),b={...h,weightDetail:{...h.weightDetail,weight:y}};Be.success({message:"Producto agregado",description:`${b.name} ${b.weightDetail.weight}`,placement:"top",duration:3}),i(Yn(b))}else i(Yn(h))});const d=Au(s,e).filter(u=>u.isVisible!==!1);return m.useEffect(()=>{(()=>{r<=800&&i(kc()),i(Kb()),i(T0()),i(Gu())})()},[]),t.jsxs(t.Fragment,{children:[t.jsx(XV,{}),t.jsxs(eG,{animate:{x:0},transition:{type:"spring",stiffness:0},children:[t.jsxs(tG,{children:[t.jsx(Ze,{displayName:"Productos",borderRadius:"bottom-right",searchData:e,setSearchData:n}),t.jsx(pU,{productsLoading:o,products:d}),t.jsx(lae,{})]}),t.jsx(aX,{}),t.jsx(yj,{}),t.jsx(VV,{})]})]})},eG=l(Ie.div)`
  height: 100vh;
  display: grid;
  overflow-y: hidden;
  grid-template-columns: 1fr min-content;
  background-color: ${e=>e.theme.bg.shade}; 
  gap: 0.4em;
  @media(max-width: 800px) {
    grid-template-columns: 1fr;
    gap: 0;
}
  `,tG=l.div`
    display: grid;
    overflow: hidden;
    grid-template-rows: min-content min-content;
    @media(max-width: 800px) {
      position: relative;
      grid-template-rows: min-content min-content 1fr;
}
`,mi=({children:e,position:n})=>t.jsx(nG,{position:n,children:e}),nG=l.div`
    display: flex;
    align-items: center;
    gap: 0.4em;
    ${e=>{switch(e.position){case"right":return`
            align-items: end;
          `}}}
`,sG="Ventamax",oG="./ventamax.svg",rG="Punto de venta inteligente",iG="2.0",aG={title:"Sistema de Facturación Profesional",description:"Ventamax es el software de punto de venta perfecto para administrar tu negocio de manera eficiente y efectiva. Con Ventamax, puedes manejar las compras y ventas desde un solo lugar, lo que te permite tener un control más completo de tus operaciones diarias.",subtitle:"Eleva tu negocio al siguiente nivel con herramientas avanzadas, análisis profundos y soporte especializado."},cG=[{id:"inventory",title:"Gestión de Inventario",description:"Control completo de tu inventario con alertas de stock y reportes detallados",icon:"ShopOutlined",color:"#52c41a"},{id:"sales",title:"Ventas Inteligentes",description:"Procesamiento rápido de ventas con múltiples métodos de pago",icon:"DollarOutlined",color:"#1890ff"},{id:"reports",title:"Reportes Avanzados",description:"Análisis detallados de tus operaciones y tendencias de venta",icon:"BarChartOutlined",color:"#722ed1"},{id:"customers",title:"Gestión de Clientes",description:"Base de datos completa de clientes con historial de compras",icon:"TeamOutlined",color:"#fa8c16"},{id:"security",title:"Seguridad Total",description:"Protección de datos con encriptación y respaldos automáticos",icon:"SafetyOutlined",color:"#f5222d"},{id:"support",title:"Soporte 24/7",description:"Asistencia técnica disponible cuando la necesites",icon:"CustomerServiceOutlined",color:"#13c2c2"}],lG=["Incrementa tus ventas hasta 30%","Reduce errores de inventario","Ahorra tiempo en reportes","Mejora la experiencia del cliente"],dG=[{id:1,name:"María González",business:"Farmacia Central",comment:"Ventamax transformó completamente mi negocio. Ahora tengo control total.",rating:5},{id:2,name:"Carlos Rodríguez",business:"Supermercado El Ahorro",comment:"La mejor inversión que he hecho para mi empresa.",rating:5}],uG={primary:"Iniciar sesión",secondary:"Solicitar demo",trial:"Prueba gratuita 30 días"},pG={phone:"+1 (809) 555-0123",email:"soporte@ventamax.com",website:"https://ventamax.com"},mG={facebook:"https://facebook.com/ventamax",instagram:"https://instagram.com/ventamax",twitter:"https://twitter.com/ventamax",linkedin:"https://linkedin.com/company/ventamax"},hG={webName:sG,logo:oG,tagline:rG,version:iG,section:aG,features:cG,benefits:lG,testimonials:dG,cta:uG,contact:pG,social:mG},gG=()=>{const{LOGIN:e,SIGNUP:n}=re.AUTH_TERM,s=Fe(),o=i=>{s(i)},r={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0,transition:{duration:.5,ease:"easeOut"}}};return t.jsxs(fG,{as:Ie.div,variants:r,initial:"hidden",animate:"visible",children:[t.jsx(mg,{children:t.jsx(xG,{children:hG.webName})}),t.jsx(mg,{children:t.jsx(mi,{children:t.jsx(U,{type:"primary",size:"large",onClick:()=>o(e),children:"Iniciar sesión"})})}),"        "]})},fG=l.div`
  display: flex;
  align-items: center;
  height: 2.2em;
  width: 100%;
  gap: 1em;
  font-size: 25px;
  padding: 0 1em;
  justify-content: space-between;
  background: linear-gradient(135deg, var(--color, #1890ff) 0%, #40a9ff 100%);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  position: sticky;
  top: 0;
  z-index: 100;
  
  @media (max-width: 768px) {
    padding: 0 1em;
    font-size: 20px;
    height: 60px;
  }
`,mg=l.div`
  display: flex;
  color: white;
  align-items: center;
  gap: 12px;
`,xG=l.div`
  font-size: 1.1em;
  font-weight: 700;
  margin: 0;
  color: white;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  
  @media (max-width: 768px) {
    font-size: 1.2em;
  }
    @media (max-width: 480px) {
    font-size: 1em;
  }
`,bG=()=>{const e={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5,delay:.3}}};return t.jsx(yG,{as:Ie.footer,variants:e,initial:"hidden",animate:"visible",children:t.jsxs(vG,{children:[t.jsx(Wt,{gutter:[32,32],justify:"space-between",children:t.jsx(rt,{xs:24,sm:12,md:6,children:t.jsxs(jG,{children:[t.jsx(CG,{children:"Ventamax"}),t.jsx(wG,{children:"Sistema completo de punto de venta diseñado para optimizar la gestión de tu negocio con tecnología de vanguardia."})]})})}),t.jsx(gn,{style:{borderColor:"#e1e5e9",margin:"32px 0 24px"}}),t.jsx(SG,{children:t.jsxs(Wt,{justify:"space-between",align:"middle",children:[t.jsx(rt,{xs:24,md:12,children:t.jsxs(IG,{children:["© ",new Date().getFullYear()," Ventamax - Todos los derechos reservados"]})}),t.jsx(rt,{xs:24,md:12,children:t.jsxs(EG,{children:["Desarrollado con ",t.jsx(Jw,{style:{color:"#ff4d4f",margin:"0 4px"}})," por Gisys"]})})]})})]})})},yG=l.footer`
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-top: 1px solid #dee2e6;
  padding: 60px 0 20px;
  margin-top: auto;
  position: relative;
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #1890ff, #722ed1, #eb2f96);
  }
`,vG=l.div`
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px;
`,jG=l.div`
  margin-bottom: 24px;
`,CG=l.h4`
  color: var(--color-primary, #1890ff);
  margin-bottom: 16px;
  font-weight: 600;
  font-size: 18px;
  position: relative;
  
  &::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 30px;
    height: 2px;
    background: linear-gradient(90deg, #1890ff, #722ed1);
    border-radius: 1px;
  }
`,wG=l.p`
  color: #666;
  margin: 8px 0;
  font-size: 14px;
  line-height: 1.6;
  
  &:last-child {
    margin-bottom: 0;
  }
`;l.div`
  display: flex;
  flex-direction: column;
  gap: 8px;
`;l.a`
  color: #666;
  font-size: 14px;
  text-decoration: none;
  transition: all 0.3s ease;
  display: inline-block;
  
  &:hover {
    color: #1890ff;
    text-decoration: none;
    transform: translateX(4px);
  }
`;l.div`
  display: flex;
  gap: 12px;
  margin-top: 16px;
`;l.a`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #fff, #f8f9fa);
  border-radius: 50%;
  color: #666;
  font-size: 18px;
  text-decoration: none;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  
  &:hover {
    color: #1890ff;
    background: linear-gradient(135deg, #e6f7ff, #bae7ff);
    box-shadow: 0 4px 16px rgba(24, 144, 255, 0.2);
    transform: translateY(-2px);
  }
`;l.div`
  display: flex;
  align-items: center;
  margin-bottom: 12px;
  gap: 12px;
`;l.div`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, #e6f7ff, #bae7ff);
  border-radius: 50%;
  color: #1890ff;
  font-size: 14px;
`;l.span`
  color: #666;
  font-size: 14px;
  line-height: 1.5;
`;l.div`
  margin-top: 20px;
  padding: 16px;
  background: linear-gradient(135deg, #fff, #f8f9fa);
  border-radius: 8px;
  border: 1px solid #e8e8e8;
`;l(U)`
  width: 100%;
  border-radius: 6px;
  font-weight: 500;
  
  &:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
  }
`;const SG=l.div`
  text-align: center;
  
  @media (min-width: 768px) {
    text-align: left;
  }
`,IG=l.span`
  color: #999;
  font-size: 13px;
  
  @media (max-width: 767px) {
    display: block;
    margin-bottom: 8px;
  }
`,EG=l.span`
  color: #999;
  font-size: 13px;
  display: flex;
  align-items: center;
  justify-content: center;
  
  @media (min-width: 768px) {
    justify-content: flex-end;
  }
`;let AG=class extends st.Component{constructor(s){super(s);qc(this,"handleReload",()=>{window.location.reload()});qc(this,"handleGoHome",()=>{window.location.href="/"});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0}}componentDidCatch(s,o){console.error("Error caught by ErrorBoundary:",s,o),this.setState({error:s,errorInfo:o})}render(){return this.state.hasError?t.jsxs(kG,{as:Ie.div,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:[t.jsx(TG,{status:"error",title:"¡Ups! Algo salió mal",subTitle:"Ha ocurrido un error inesperado. Por favor, intenta recargar la página o contacta al soporte técnico si el problema persiste.",extra:[t.jsx(U,{type:"primary",icon:t.jsx(Xw,{}),onClick:this.handleReload,size:"large",children:"Recargar Página"},"reload"),t.jsx(U,{icon:t.jsx(uc,{}),onClick:this.handleGoHome,size:"large",children:"Ir al Inicio"},"home")]}),!1]}):this.props.children}};const kG=l.div`
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
  padding: 20px;
`,TG=l(qw)`
  background: white;
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  padding: 40px;
  max-width: 600px;
  width: 100%;
  
  .ant-result-title {
    color: #ff4d4f;
    font-weight: 600;
  }
  
  .ant-result-subtitle {
    color: #666;
    font-size: 16px;
    line-height: 1.6;
  }
  
  .ant-result-extra {
    margin-top: 24px;
    
    .ant-btn {
      margin: 0 8px;
      border-radius: 6px;
      font-weight: 500;
      
      &:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
    }
  }
`;l.div`
  position: absolute;
  bottom: 20px;
  left: 20px;
  right: 20px;
  background: #f8f8f8;
  border-radius: 8px;
  padding: 16px;
  border: 1px solid #e8e8e8;
  max-height: 200px;
  overflow-y: auto;
`;l.div`
  margin: 8px 0;
  font-size: 12px;
  color: #666;
  font-family: 'Courier New', monospace;
  
  strong {
    color: #333;
  }
`;const PG=st.lazy(()=>ks(()=>import("./Body-BP4WU2vx.js"),__vite__mapDeps([171,80,2,3,4,1,6,7,8,68,69,74,19,20,21,22,12,13,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,9,10,16,17,18,67,14,15,70,71,72,73,5,75,76,77,78,79,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,11,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166]))),DG=()=>{const e=D(q),{HOME:n}=re.BASIC_TERM,s=Fe();m.useEffect(()=>{e&&s(n)},[e,n,s]);const o={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{duration:.6,ease:"easeOut"}},exit:{opacity:0,y:-20,transition:{duration:.3}}};return t.jsxs(t.Fragment,{children:[t.jsxs(p0,{children:[t.jsx("title",{children:"Ventamax - Sistema de Punto de Venta"}),t.jsx("meta",{name:"description",content:"Ventamax es un sistema completo de punto de venta diseñado para llevar tu negocio al siguiente nivel con herramientas avanzadas y fácil de usar."}),t.jsx("meta",{name:"keywords",content:"punto de venta, facturación, inventario, ventas, negocio"}),t.jsx("meta",{property:"og:title",content:"Ventamax - Sistema de Punto de Venta"}),t.jsx("meta",{property:"og:description",content:"Sistema completo de punto de venta para tu negocio"}),t.jsx("meta",{property:"og:type",content:"website"}),t.jsx("link",{rel:"canonical",href:window.location.href})]}),t.jsxs(gt,{mode:"wait",children:["        ",t.jsx($G,{as:Ie.div,variants:o,initial:"initial",animate:"animate",exit:"exit",children:t.jsxs(AG,{children:[t.jsx(gG,{}),t.jsx(RG,{children:t.jsx(m.Suspense,{fallback:t.jsx(NG,{children:t.jsx(He,{size:"large",tip:"Cargando..."})}),children:t.jsx(PG,{})})}),t.jsx(bG,{})]})})]})]})},$G=l.div`
  min-height: 100vh;
  width: 100%;
  display: flex;
  flex-direction: column;
  margin: 0;
  background-color: #ffffff;
  color: #333;
  
  @media (max-width: 768px) {
    min-height: 100vh;
  }
 
  a {
    color: var(--color-primary, #1890ff);
    font-size: 1.5rem;
    margin-bottom: 1rem;
    transition: color 0.3s ease;
    
    &:hover {
      color: var(--color-primary-hover, #40a9ff);
    }
  }
`,RG=l.main`
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0; /* Permite que el contenido se comprima si es necesario */
`,NG=l.div`
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 400px;
  flex-direction: column;
  gap: 16px;
  
  .ant-spin-text {
    color: var(--color-text-secondary, #666);
    font-size: 16px;
  }
`,OG=({fn:e})=>{W();const n=()=>{e()};return t.jsx(m.Fragment,{children:t.jsx(MG,{onClick:n,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",children:t.jsx("path",{d:"M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"})})})})},MG=l.div`
    width: 32px;
    height: 32px;
   
    display: grid;
    justify-content: center;
    align-items: center;      
    border-radius: 100px;
    background-color: white; 
    border: 1px solid rgba(0, 0, 0, 0.307);
    svg{
        width: 1.5em;
        fill: rgba(31, 31, 31, 0.72);
       
    }
`,Cj=async(e,n)=>{if(!e&&!(e!=null&&e.businessID))return;const s=F($,"businesses",e.businessID,"products","6dssod");Te(s,o=>{const r=o.data();n(r)})},FG=({fn:e})=>t.jsx(m.Fragment,{children:t.jsx(Xj,{title:"Eliminar",children:t.jsx(BG,{onClick:e,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",children:t.jsx("path",{d:"M135.2 17.7C140.6 6.8 151.7 0 163.8 0H284.2c12.1 0 23.2 6.8 28.6 17.7L320 32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 96 0 81.7 0 64S14.3 32 32 32h96l7.2-14.3zM32 128H416V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V128zm96 64c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16z"})})})})}),BG=l("div")`
    width: 32px;
    height: 32px;
    padding: 0.2em;
    display: flex;
    justify-content: center;
    align-items: center;      
    border-radius: 100px;
    background-color: rgb(206, 56, 56);
    border: 1px solid rgba(0, 0, 0, 0.307);
    svg{
        width: 1em;
        fill: rgb(248, 248, 248)
    }
`,LG=()=>t.jsx(m.Fragment,{children:t.jsx(Xj,{title:"Editar",children:t.jsx(zG,{children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",children:t.jsx("path",{d:"M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.8 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"})})})})}),zG=l("div")`
    width: 32px;
    height: 32px;
    padding: 0.2em;
    display: flex;
    justify-content: center;
    align-items: center;      
    border-radius: 100px;
    background-color: white;
    
    border: 1px solid rgba(0, 0, 0, 0.307);
    svg{
        width: 1em;
        fill: rgba(31, 31, 31, 0.72);
    }
`,UG=({item:e})=>{const n=s=>{MS(s)};return t.jsxs(WG,{children:[t.jsx("span",{children:e.name}),t.jsx("span",{children:e.cost}),t.jsxs(mi,{children:[t.jsx(FG,{fn:()=>n(e)}),t.jsx(LG,{})]})]})},WG=l.div`
    height: 2.5em;
    background-color: #f0f0f0;
    width: 100%;
    border: 1px solid rgba(0, 0, 0, 0.300);
    border-radius: 8px;
    display: grid;
   
    align-items: center;
    padding: 0 1em;
    grid-template-columns: 1fr 1fr min-content min-content;
`,qG=({isOpen:e,handleOpen:n})=>{const s=D(q),[o,r]=m.useState("");m.useEffect(()=>{Cj(s,r)},[]);const[i,a]=m.useState({name:"",cost:0,id:""}),c=()=>new Promise((u,p)=>{u(a({...i,id:be()}))}),d=()=>{c().then(()=>{i.cost&&i.id&&i.name!==""&&(OS(i),console.log("done"),a({name:"",cost:"",id:""}))})};return e?t.jsxs(VG,{children:[t.jsxs(GG,{children:["                    ",t.jsx(QG,{children:t.jsx(ke,{bgcolor:"error",startIcon:t.jsx(O,{icon:tc}),title:"atrás",onClick:n})})]}),t.jsxs(_G,{children:[t.jsx(HG,{children:t.jsx("h4",{children:"Características del Producto"})}),t.jsxs(XG,{alignItems:"center",justifyContent:"space-between",children:[t.jsxs(JG,{children:[t.jsx(kl,{children:t.jsx(Dt,{value:i.name,placeholder:"Agregar Ingrediente",onChange:u=>a({...i,name:u.target.value})})}),t.jsx(kl,{children:t.jsx(Dt,{value:i.cost,size:"small",placeholder:"Precio",onChange:u=>a({...i,cost:u.target.value})})})]}),t.jsx(kl,{justifySelf:"right",children:t.jsx(OG,{fn:d})})]}),t.jsx(YG,{children:t.jsx(KG,{children:eC(o)?null:o.ingredientList.length>0?o.ingredientList.sort((u,p)=>u.name>p.name?1:-1).map((u,p)=>t.jsx(UG,{item:u},p)):null})})]})]}):null};l.div`
    height: 100vh;
    width: 100vw;
    display: flex;
    justify-content: center;
    align-items: center;
    
    `;const VG=l.div`
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    max-height: 600px;
    width: 100%;
    background-color: var(--White3);
    border-radius: 10px;
    border: 1px solid rgba(0, 0, 0, 0.100);
    overflow: hidden;
    display: grid;
    grid-template-rows: min-content 1fr;
`,GG=l.div`
    height: 2.5em;
    width: 100%;
    background-color: rgb(60, 60, 60);
    color: white;
    display: flex;
    align-items: center;
    padding: 0 0.4em 0 1em;
    justify-content: space-between;
`,_G=l.div`
    display: grid;
    grid-template-rows: min-content min-content 1fr;

`,HG=l.div`
    padding: 1em ;
`,QG=l.div`
    
`,YG=l.div`
    height: 100%;
    width: 100%;
    padding: 0.6em;
`,KG=l.ul`
    border: 1px solid rgba(0, 0, 0, 0.161);
    border-radius: 10px;
    height: 100%;
    width: 100%;
    background-color: #bbbbbb;
    padding: 0.4em;
    overflow: hidden;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.137);
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-auto-rows: min-content;
    gap: 0.2em;
    
`;l.div`
    height: 2.5em;
    background-color: #f0f0f0;
    width: 100%;
    border: 1px solid rgba(0, 0, 0, 0.300);
    border-radius: 8px;
    display: grid;
   
    align-items: center;
    padding: 0 1em;
    grid-template-columns: 1fr 1fr min-content min-content;
`;const JG=l.div`
    display: flex;
    align-items: center;
    gap: 1em;


`;l.div``;const kl=l.div`
    justify-self: ${e=>e.justifySelf?"flex-end":"none"};
`,XG=l.div`
    display: flex;
    width: 100%;
    justify-content: ${e=>e.justifyContent?e.justifyContent:"none"};
    padding: ${e=>e.padding?e.padding:" 0 1em"};
    gap: ${e=>e.gap?e.gap:"1em"};
    align-items: ${e=>e.alignItems};
    background-color: ${e=>e.backgroundColor};

`,ZG={hidden:{opacity:0},visible:{opacity:1}},e_={duration:.5},t_=({children:e,variants:n=ZG,initial:s="hidden",animate:o="visible",exit:r="hidden",transition:i=e_})=>t.jsx(Ie.div,{variants:n,initial:s,animate:o,exit:r,transition:i,children:e}),fp=({children:e,nameRef:n,handleSubmit:s,close:o,btnSubmitName:r,isOpen:i,subModal:a,width:c})=>{const[d,u]=m.useState(!1),p=async()=>{try{await s(),o()}catch{}finally{}};m.useEffect(()=>{i?setTimeout(()=>{u(!0)},300):u(!1)},[i]);const h={open:{opacity:1,pointerEvents:"all"},closed:{opacity:0,pointerEvents:"none"}},f={open:{scale:1},closed:{scale:0}};return t.jsx(n_,{variants:h,initial:"closed",animate:i?"open":"closed",exit:"closed",transition:{duration:.3},isOpen:i,children:t.jsxs(s_,{variants:f,initial:"closed",animate:i?"open":"closed",exit:"closed",width:c,children:[t.jsxs(o_,{children:[t.jsx(a_,{children:n}),t.jsx(ke,{title:z.operationModes.close,width:"icon24",borderRadius:"normal",color:"error",onClick:o})]}),t.jsxs(r_,{children:[d&&t.jsx(t_,{children:e}),a||null]}),t.jsx(i_,{children:t.jsxs($t,{children:[t.jsx(ke,{borderRadius:"normal",title:"Cancel",onClick:o}),t.jsx(ke,{borderRadius:"normal",title:r,onClick:p,color:"primary"})]})})]})})},n_=l(Ie.div)`
     width: 100%;
    height: 100vh;
    background-color: var(--BlackOp);
    backdrop-filter: blur(var(--blur));
    display: flex;
    justify-content: center;
    align-items: center;
    position: absolute;
    z-index: 10000;
    overflow-y: hidden;
    top: 0;
    left: 0;
    transition: opacity 400ms ease-in-out;
   
`,s_=l(Ie.div)`
 width: 100vw;
 max-width: 720px;
 height: 98vh;
 max-height: 1000px;
 background-color: var(--White);
 display: grid;
 grid-template-rows: 3em auto 3em;
 border-radius: 6px;
 overflow: hidden;
 position: relative;
 @media (max-width: 768px) {
    width: 100vw;
    height: 100vh;
    max-width: 100vw;
    max-height: 100vh;
    border-radius: 0;
 }
 ${e=>{switch(e.width){case"small":return`
            width: 100vw;
            max-width: 600px;
            `;case"medium":return`
            width: 100vw;
            max-width: 800px;
            `;case"large":return`
            width: 100vw;
            max-width: 1000px;
            `;case"extra-large":return`
            width: 100vw;
            max-width: 1200px;
            `}}}
        `,o_=l.div`
display: flex;

background-color: rgb(48, 48, 48);
align-items: center;
padding: 0 1em;
justify-content: space-between;
`,r_=l.div`
display: grid;
overflow: auto;
`,i_=l.div`
display: flex;
padding: 0 1em;
border-top: 1px solid var(--Gray);
justify-content: flex-end;
align-items: center;

`,a_=l.div`
color: rgb(255, 255, 255);
font-weight: 600;
`,c_=({item:e,index:n})=>{const s=W(),o=D(HD),r=(a,c)=>{a?(s(qD(c)),s(Tm()),s(km())):(s(VD(c)),s(Tm()),s(km()))},i=(a,c)=>a.some(d=>d.id===c);return t.jsxs(l_,{htmlFor:n,children:[t.jsx("input",{type:"checkbox",name:"",checked:i(o,e.id),id:n,onChange:a=>r(a.target.checked,e)}),t.jsx("span",{children:e.name}),t.jsx(d_,{align:"end",children:Y(e.cost)})]})},l_=l.label`
    list-style: none;
    height: 2.2em;
    display: grid;
    align-items: center;
    grid-template-columns: min-content 1fr 0.8fr;
    gap: 1em;
    padding: 0 1em;
    background-color: #f1efef;
    border-radius: 8px;
`,d_=l.div`
    display: flex;  
    align-items: center;
    gap: 0.4em;
    ${e=>{switch(e.align){case"center":return`
                    justify-content: center;
                `;case"end":return`
                    justify-content: flex-end;
                    text-align: right;
                `;default:return`
                    justify-content: flex-start;
                    
                `}}}
`,u_=({handleIngredientOpen:e})=>{const n=D(q),[s,o]=m.useState("");m.useEffect(()=>{Cj(n,o)},[n]);const r=D(ny);return t.jsxs(p_,{children:[t.jsx(m_,{children:s&&s.ingredientList.length>0?s.ingredientList.sort((i,a)=>i.name>a.name?1:-1).map((i,a)=>t.jsx(c_,{item:i,index:a},a)):null}),t.jsxs(h_,{children:[t.jsx(ke,{borderRadius:"normal",title:"Editar Ingredientes",onClick:e}),t.jsxs("span",{children:["Total: RD$ ",ct(r)]})]})]})},p_=l.div`
    margin: 0;
    padding: 0;
    border-radius: 10px;
    height: 100%;
    display: grid;
    grid-template-rows: 1fr min-content;
    background-color: rgb(218, 217, 217);
    position: relative;
    overflow: hidden;
    `,m_=l.ul`
    overflow-y: scroll;
   
    width: 100%;
    background-color: #D9D9D9;
    padding: 0.6em;
    display: grid;
    grid-auto-rows: min-content;
    grid-template-columns: repeat(auto-fill, minmax(14em, 1fr));
    gap: 0.6em;


`,h_=l.div`
    width: 100%;
    display: flex;
    height: 2.4em;
    align-items: center;
    padding: 0 1em;
    justify-content: space-between;
    border-top: var(--border-primary);
   
`,Tl=(e,n)=>{let s=String(e),o=n,r=s.match(o);return r=r.toString(),r},g_=(e,n,s)=>{const o=/Completa/;return e.match(o),`pizza de ${e}`},f_=[{value:"complete",label:"Pizza Completa"},{value:"half",label:"Mitad izquierda / Mitad derecha"}],x_=[{value:"",label:"Seleccione un tamaño"},{value:"Familiar",label:"Familiar"},{value:"Grande",label:"Grande"},{value:"Mediana",label:"Mediana"},{value:"Personal",label:"Personal"}],b_={pizzaSlices:f_,sizeList:x_},Bi=({productSelected:e,setProduct:n,isComplete:s})=>{var u,p;const o=e.a?JSON.parse(e.a):{},r=e.b?JSON.parse(e.b):{},i=((u=o==null?void 0:o.pricing)==null?void 0:u.price)||"",a=((p=r==null?void 0:r.pricing)==null?void 0:p.price)||"",c=s==="complete",d=s==="half";switch(!0){case(c&&i):return console.log("completa y a tiene precio"),n({pricing:{price:i}}),i;case(d&&i>a):return console.log("mitad y a es mayor que b"),n({pricing:{price:i}}),i;case(d&&i<a):return console.log("mitad y a es menor que b"),n({pricing:{price:a}}),a;case(d&&i===a):return console.log("mitad y a es igual que b"),n({pricing:{price:i}}),i;default:return console.log("default"),n({pricing:{price:i}}),i}},y_=async(e,n,s,o)=>{if(!o&&o.businessID)return;const r=le($,"businesses",o.businessID,"products"),i=he(r,te("type","==",n),te("size","==",s),it("name","asc")),{docs:a}=await Me(i),c=a.map(d=>d.data());console.log(c),e(c)},hg={id:"",type:"",name:"",category:"",amountToBuy:1,pricing:{price:0,cost:0,tax:0},mitad:{first:"",second:""}},v_={name:"",id:"",amountToBuy:1,pricing:{price:0,cost:0,tax:0},size:""},gg={a:"",b:""},j_=({Row:e,Group:n,newProduct:s,setNewProduct:o,initialState:r,setInitialState:i})=>{var w,S;let a="pizza";const c=W(),d=D(q),[u,p]=m.useState([]),{pizzaSlices:h,sizeList:f}=b_,[x,g]=m.useState("complete"),[y,b]=m.useState(hg),[v,C]=m.useState(gg),I=/Completa|Pepperoni|Vegetales|Jamón y queso|Maíz |Pollo/g,j=D(ny),k=D(QD),[A,P]=m.useState("");return m.useEffect(()=>{if(r===!0)try{setTimeout(()=>{C(gg),b(hg),g("complete"),P(""),o(v_),p([]),i(!1)},1e3)}catch{c(Bd({message:"Error al reiniciar el producto",type:"error"}))}},[r]),m.useEffect(()=>{A!==""&&y_(p,a,A,d)},[A,d]),m.useEffect(()=>{if(x==="complete"&&v.a!==""){const E=JSON.parse(v.a),T=Tl(String(E.name),I);o({...s,name:`${g_(T)} ${k&&`. Ingredientes extras: ${k}`}`,pricing:{...s.pricing,price:Bi({productSelected:v,setProduct:b,isComplete:x})+j},size:A,id:be(8)})}if(x==="half"&&v.a!==""&&v.b!==""){const E=JSON.parse(v.a),T=JSON.parse(v.b),R=Tl(String(E.name),I),N=Tl(String(T.name),I);try{o({...s,name:`pizza mitad de ${R} y mitad de ${N}. ${k&&`Ingredientes extras: ${k}`} `,pricing:{...s.pricing,price:Number(Bi({productSelected:v,setProduct:b,isComplete:x}))+j},size:A,id:be(8)})}catch(G){console.log(G)}}},[v,k,x]),m.useEffect(()=>{x==="complete"&&o({...s,pricing:{...s.pricing,price:Number(Bi({productSelected:v,setProduct:b,isComplete:x}))+j},size:A,id:be(8)}),x==="half"&&o({...s,pricing:{...s.pricing,price:Number(Bi({productSelected:v,setProduct:b,isComplete:x}))+j},size:A,id:be(8)})},[(w=y==null?void 0:y.pricing)==null?void 0:w.price]),console.log("?? NEW PRODUCT: ",s),t.jsxs(C_,{children:[t.jsxs(e,{children:[t.jsxs(n,{children:[t.jsx("h4",{children:"Porción"}),t.jsx("div",{children:t.jsx(Li,{name:"",id:"",value:x,onChange:E=>g(E.target.value),children:h.map((E,T)=>t.jsx("option",{value:E.value,children:E.label},T))})})]}),t.jsxs(n,{children:[t.jsx("h4",{children:"Tamaño"}),t.jsx("div",{children:t.jsx(Li,{name:"",id:"",value:A,onChange:E=>P(E.target.value),children:f.map((E,T)=>t.jsx("option",{value:E.value,children:E.label},T))})})]})]}),t.jsxs(e,{children:[t.jsx(n,{children:t.jsx("div",{children:t.jsxs(Li,{name:"",id:"",value:v.a,onChange:E=>C({...v,a:E.target.value}),children:[t.jsx("option",{value:"",children:"Eligir"}),u.sort((E,T)=>(E==null?void 0:E.name)>(T==null?void 0:T.name)?1:-1).map((E,T)=>t.jsx("option",{value:JSON.stringify(E),children:E==null?void 0:E.name},T))]})})}),x==="half"?t.jsx(n,{children:t.jsx("div",{children:t.jsxs(Li,{name:"",id:"",value:v.b,onChange:E=>C({...v,b:E.target.value}),children:[t.jsx("option",{value:"",children:"Eligir"}),u.sort((E,T)=>(E==null?void 0:E.name)>(T==null?void 0:T.name)?1:-1).map((E,T)=>t.jsx("option",{value:JSON.stringify(E),children:E==null?void 0:E.name},T))]})})}):null]}),t.jsx(w_,{children:t.jsxs("span",{children:["Total: RD$ ",ct((S=y==null?void 0:y.pricing)==null?void 0:S.price)]})})]})},C_=l.div`
`,Li=l.select`
    height: 1.8em;
    border-radius: var(--border-radius-light);
    padding: 0 0.6em;
    transition: width 0.5s ease ; 
    width: 100%;
`,w_=l.div`
height: 2em;
width: 100%;

    //background-color: #f1ebeb;
    display: flex;
    justify-content: flex-end;
    padding: 0 1em;
    align-items: center;
    span{
        
    }
`,fg={name:"",id:"",pricing:{price:0,cost:0,tax:0},amountToBuy:1,size:""},S_=({isOpen:e})=>{var h;const n=W(),[s,o]=m.useState(!1),r=()=>o(!s),[i,a]=m.useState(fg),[c,d]=m.useState(!1),u=()=>{n(Ru()),n(GD()),a(fg),d(!0)},p=async()=>{try{return(i==null?void 0:i.name)===""?(n(Bd({message:"Debe seleccionar un producto",type:"error"})),Promise.reject(new Error("Debe seleccionar un producto"))):(n(Yn(i)),Promise.resolve())}catch(f){console.log(f),n(Bd({id:be(),message:"Error al agregar producto",type:"error"}))}};return t.jsx(fp,{isOpen:e,close:u,btnSubmitName:"Aceptar",nameRef:"Producto Personalizable",handleSubmit:p,subModal:t.jsx(qG,{isOpen:s,handleOpen:r}),children:t.jsxs(I_,{children:[t.jsx(j_,{Row:E_,Group:A_,newProduct:i,setNewProduct:a,initialState:c,setInitialState:d}),t.jsx(u_,{handleIngredientOpen:r}),t.jsxs(k_,{children:[t.jsx("span",{}),t.jsxs("span",{children:["Total: RD$ ",ct((h=i==null?void 0:i.pricing)==null?void 0:h.price)]})]})]})})},I_=l.div`
 padding: 1em;
 display: grid;
 width: 100%;
    height: 100%;
  background-color: #f1ebeb;
 grid-template-rows: min-content 1fr min-content;
 gap: 0.2em 0.4em;
`,E_=l.div`
    display: flex;
    gap: 1em;
    margin-bottom: 0.4em;
`,A_=l.div`
    flex-grow: 1;
    flex-shrink: 1;
    flex-basis: 0;
    div{
        select{
            width: 100%;
        }
    }
`,k_=l.div`
    width: 100%;
    display: flex;
    height: 2.4em;
    align-items: center;
    padding: 0 1em;
    justify-content: space-between;
`,T_=({data:e})=>{const{title:n,route:s,description:o,icon:r}=e,i=s||"#";return t.jsxs(D_,{to:i,children:[t.jsxs(P_,{children:[t.jsx(O_,{children:r}),t.jsx(R_,{children:n})]}),t.jsx($_,{children:t.jsx(N_,{children:o})})]})},P_=l.div`
  
  display: flex;
  gap: 0.6em;
`,D_=l(Xa)`
  background-color: #fff;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  padding: 16px;
  color: #333;
  :hover{
    text-decoration: none;
    color: #333;
  }

`,$_=l.div`
  background-color: #fff;
 
  color: #333;
  
`,R_=l.span`
  font-size: 16px;
    font-weight: 600;
  margin-bottom: 6px;
    display: block;

`,N_=l.p`
  font-size: 14px;
    display: block;
    color: #666;
`,O_=l.div`
  margin-right: 8px;
  font-size: 20px;
`,{TAX_RECEIPT:M_,BUSINESS_INFO:F_,APP_INFO:B_,USERS:L_,USERS_LIST:z_,SETTINGS:U_}=re.SETTING_TERM,zi={BUSINESS_INFO:"Configuración de la Empresa",APP_INFO:"Aplicación"},Ui=(e,n)=>{switch(n){case"users":return L_+"/"+e;default:return U_+e}},W_=()=>[{title:"Datos de la Empresa",description:"Completa los datos de tu organización.",type:"empresa",icon:z.settings.businessInfo,category:zi.BUSINESS_INFO,route:Ui(F_)},{title:"Comprobante Fiscal",description:"Configuración de comprobante fiscal.",type:"fiscal",icon:z.settings.taxReceipt,category:zi.BUSINESS_INFO,route:Ui(M_)},{title:"Administración de Usuarios",description:"Gestiona los usuarios de tu cuenta.",type:"usuarios",icon:z.settings.users,category:zi.BUSINESS_INFO,route:Ui(z_,"users")},{title:"Información de la Aplicación",description:"Consulta detalles sobre la aplicación.",type:"aplicación",icon:z.settings.appInfo,category:zi.APP_INFO,route:Ui(B_)}],Pl={duration:.5,ease:"easeInOut"},q_={visible:{opacity:1,transition:Pl},hidden:{opacity:.5,transition:Pl},exit:{opacity:.5,transition:Pl}},V_=({children:e})=>t.jsx(Ie.div,{initial:"hidden",animate:"visible",exit:"exit",variants:q_,children:e}),G_=()=>{const n=W_().reduce((s,o)=>(s[o.category]?s[o.category].push(o):s[o.category]=[o],s),{});return t.jsx(V_,{children:t.jsxs(__,{children:[t.jsx(Ze,{sectionName:"Configuración"}),t.jsx(H_,{children:t.jsx(Q_,{children:Object.keys(n).map((s,o)=>t.jsxs(Y_,{children:[t.jsx(Qe,{variant:"h3",children:s}),t.jsx(K_,{children:n[s].map((r,i)=>t.jsx(T_,{data:r},i))})]},o))})})]})})},__=l.div`
  width: 100%;
  height: 100vh;
  display: grid;
  gap: 0.5em;
  grid-template-rows: min-content 1fr;
`,H_=l.div`
  width: 100%;
border-radius: var(--border-radius);
background-color: #ffffff;
`,Q_=l.div`
  display: grid;
  gap: 1em;
  padding: 1em;
`,Y_=l.div`
  padding: 10px;
  margin: 0 auto;
  max-width: 1000px;
  width: 100%;
  background-color: var(--color2);
  border-radius: var(--border-radius);
`,K_=l.div`
  padding: 10px 0 0 0;
  margin: 0 auto;
  
  width: 100%;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1em;
`,wj=()=>{const e=D(q),n=W(),[s,o]=m.useState([]),[r,i]=m.useState(!0);return m.useEffect(()=>{let a;if(i(!0),!e.businessID){o([]),i(!1);return}try{const c=le($,"businesses",e.businessID,"taxReceipts");a=Te(c,d=>{const u=d.docs.map(f=>f.data()),p=Eu(u);o(p);const h=p.find(f=>f.data.name==="CONSUMIDOR FINAL");n(P0(h==null?void 0:h.data.name)),i(!1)},d=>{console.error("Error fetching tax receipts: ",d),i(!1),o([])})}catch(c){console.error("Exception in tax receipts fetch: ",c),i(!1),o([])}return()=>{a&&a()}},[e,n]),{taxReceipt:s,isLoading:r}},J_=(e,n)=>m.useMemo(()=>{if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(!gS.isEqual(e[s],n[s]))return!1;return!0},[e,n]),xg=async e=>{if(!(!e||!(e!=null&&e.businessID)))try{const n=F($,"businesses",e.businessID,"settings","taxReceipt"),s=await Se(n);if(s.exists()){const o=s.data().taxReceiptEnabled;await je(n,{taxReceiptEnabled:!o})}else await De(n,{taxReceiptEnabled:!0})}catch(n){console.error("Ocurrió un error al actualizar el comprobante fiscal:",n)}},tu={DO:{countryName:"República Dominicana",templates:[{name:"CONSUMIDOR FINAL",type:"B",serie:"02",sequence:0,sequenceLength:8,increase:1,quantity:2e3,description:"Comprobante para consumidores finales sin RNC"},{name:"CRÉDITO FISCAL",type:"B",serie:"01",sequence:0,sequenceLength:8,increase:1,quantity:2e3,description:"Comprobante para empresas con RNC que necesitan crédito fiscal"},{name:"GUBERNAMENTAL",type:"B",serie:"15",sequence:0,sequenceLength:8,increase:1,quantity:1e3,description:"Factura para entidades gubernamentales"}]}},X_=()=>Object.entries(tu).map(([e,n])=>({code:e,name:n.countryName})),Z_=async(e,n)=>{if(!(e!=null&&e.businessID)||typeof(e==null?void 0:e.businessID)!="string")throw new Error("Invalid or missing businessID provided.");if(!n||typeof n!="object"||Object.keys(n).length===0)throw new Error("Invalid or empty data provided for creation.");try{const s=le($,"businesses",e.businessID,"taxReceipts"),o=await tC(s,{data:n});return console.log(`Tax receipt created successfully with ID: ${o.id}`),o}catch(s){throw console.error("Error creating tax receipt:",s),new Error("Failed to create tax receipt.")}},{Option:e7}=ge,{Title:bg,Text:yg}=Xe,t7=({visible:e,onCancel:n,existingReceipts:s=[]})=>{const[o,r]=m.useState("DO"),[i,a]=m.useState([]),c=X_(),d=D(q),u=new Set(s.map(b=>{var v;return((v=b.data)==null?void 0:v.name)||""})),p=new Set(s.map(b=>{var v;return((v=b.data)==null?void 0:v.serie)||""}));m.useEffect(()=>{e||a([])},[e]);const h=b=>u.has(b.name)||p.has(b.serie),f=b=>u.has(b.name)?`Ya existe un comprobante con el nombre "${b.name}"`:p.has(b.serie)?`Ya existe un comprobante con la serie "${b.serie}"`:"",x=b=>{if(h(b)){V.error(f(b));return}const v=i.some(C=>C.name===b.name&&C.serie===b.serie);a(v?i.filter(C=>C.name!==b.name||C.serie!==b.serie):[...i,b])},g=b=>i.some(v=>v.name===b.name&&v.serie===b.serie),y=async()=>{if(i.length===0){V.warning("Por favor selecciona al menos un comprobante");return}const b="addingReceipts";V.loading({content:`Agregando ${i.length} comprobante(s)...`,key:b});try{const v=i.map(C=>{const I={...C,disabled:C.disabled===void 0?!1:C.disabled};return Z_(d,I)});await Promise.all(v),V.success({content:`${i.length} comprobante(s) agregado(s) correctamente.`,key:b,duration:2}),a([]),n()}catch(v){console.error("Error al agregar comprobantes predefinidos:",v),V.error({content:"Error al agregar los comprobantes. Por favor, inténtalo de nuevo.",key:b,duration:3})}};return t.jsx(Rt,{title:t.jsxs(s7,{children:[t.jsx(bg,{level:4,children:"Agregar Comprobantes por País"}),t.jsx(yg,{type:"secondary",children:"Selecciona los comprobantes fiscales predefinidos que deseas agregar"})]}),placement:"bottom",onClose:n,open:e,width:"100%",height:"100%",footer:t.jsxs(u7,{children:[t.jsx(p7,{children:i.length>0&&t.jsx(kn,{count:i.length,overflowCount:999,children:t.jsx(yg,{children:"Comprobantes seleccionados"})})}),t.jsxs(m7,{children:[t.jsx(U,{onClick:n,children:"Cancelar"}),t.jsx(U,{type:"primary",onClick:y,disabled:i.length===0,children:"Agregar"})]})]}),children:t.jsxs(n7,{children:[t.jsxs(o7,{children:[t.jsx("label",{children:"Selecciona un país:"}),t.jsx(ge,{value:o,onChange:r,style:{width:"100%"},size:"large",dropdownMatchSelectWidth:!1,children:c.map(b=>t.jsx(e7,{value:b.code,children:b.name},b.code))})]}),t.jsxs(r7,{children:[t.jsxs(bg,{level:5,children:["Comprobantes disponibles para ",tu[o].countryName]}),t.jsx(i7,{children:tu[o].templates.map((b,v)=>{const C=h(b),I=g(b);return t.jsxs(a7,{selected:I,disabled:C,onClick:()=>!C&&x(b),children:[C&&t.jsxs(c7,{children:[t.jsx(Is,{})," Ya existe"]}),t.jsxs(l7,{selected:I,disabled:C,children:[t.jsx("h4",{children:b.name}),t.jsxs("small",{children:["Tipo: ",b.type," | Serie: ",b.serie]})]}),t.jsxs(d7,{children:[t.jsx("p",{children:b.description}),t.jsxs("p",{children:["Secuencia: ",b.sequence]}),t.jsxs("p",{children:["Incremento: ",b.increase," | Cantidad: ",b.quantity]})]}),t.jsx(Oe,{title:C?f(b):I?"Quitar selección":"Seleccionar",children:t.jsx(U,{type:I?"primary":"default",disabled:C,block:!0,children:C?"No disponible":I?"Seleccionado":"Seleccionar"})})]},`${b.name}-${v}`)})})]})]})})},n7=l.div`
  display: flex;
  flex-direction: column;
  gap: 24px;
`,s7=l.div`
  display: flex;
  flex-direction: column;
  gap: 8px;

  h4 {
    margin-bottom: 0;
  }
`,o7=l.div`
  display: flex;
  flex-direction: column;
  gap: 8px;
  
  label {
    font-weight: 500;
    font-size: 16px;
  }
`,r7=l.div`
  display: flex;
  flex-direction: column;
  gap: 16px;
  
  h5 {
    margin: 0;
  }
`,i7=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;

  padding-right: 8px;
`,a7=l(Je)`
  cursor: ${e=>e.disabled?"not-allowed":"pointer"};
  transition: all 0.3s;
  border: 2px solid ${e=>e.disabled?"#f0f0f0":e.selected?"#1890ff":"#f0f0f0"};
  background-color: ${e=>e.disabled?"#f5f5f5":e.selected?"#f0f8ff":"#fff"};
  position: relative;
  opacity: ${e=>e.disabled?.7:1};
  
  &:hover {
    box-shadow: ${e=>e.disabled?"none":"0 4px 12px rgba(0, 0, 0, 0.1)"};
  }

  .ant-card-body {
    padding: 16px;
  }
`,c7=l.div`
  position: absolute;
  top: 8px;
  right: 8px;
  background-color: #ff4d4f;
  color: white;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.8em;
  display: flex;
  align-items: center;
  gap: 4px;
`,l7=l.div`
  border-bottom: 1px solid #f0f0f0;
  padding-bottom: 12px;
  margin-bottom: 12px;
  
  h4 {
    margin: 0 0 6px 0;
    color: ${e=>e.disabled?"#aaaaaa":e.selected?"#1890ff":"inherit"};
    font-size: 16px;
    font-weight: 600;
  }

  small {
    font-size: 12px;
    color: #999;
  }
`,d7=l.div`
  margin-bottom: 16px;
  p {
    margin: 4px 0;
    font-size: 14px;
  }
`,u7=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
`,p7=l.div`
  min-width: 200px;
`,m7=l.div`
  display: flex;
  gap: 8px;
`,Hn={small:{width:"42px",height:"22px",knobSize:"16px"},medium:{width:"48px",height:"24px",knobSize:"18px"},large:{width:"52px",height:"26px",knobSize:"20px"}},h7=l.div`
  width: ${({size:e})=>Hn[e].width};
  min-width: ${({size:e})=>Hn[e].width};
  max-width: ${({size:e})=>Hn[e].width};
  height: ${({size:e})=>Hn[e].height};
  min-height: ${({size:e})=>Hn[e].height};
  border-radius: ${({size:e})=>`calc(${Hn[e].height} / 2)`};
  background-color: ${({isOn:e})=>e?"#1976D2":"#c5c5c5"};
  display: flex;
  align-items: center;
  cursor: pointer;
`,g7=l(Ie.div)`
  width: ${({size:e})=>Hn[e].knobSize};
  height: ${({size:e})=>Hn[e].knobSize};
  border-radius: 50%;
  background-color: white;
`,f7=({size:e="medium",checked:n=!1,onChange:s,name:o})=>{const r=m.useRef(null),[i,a]=m.useState(null),c=m.useCallback(()=>{s&&s({target:{name:o,checked:!n,type:"checkbox"}})},[o,n,s]);return m.useEffect(()=>{if(r.current){const{width:d}=r.current.getBoundingClientRect(),u=parseFloat(Hn[e].knobSize),p=4,h=d-u-p;a(n?h:p)}},[n,e]),t.jsxs(h7,{ref:r,onClick:c,isOn:n,size:e,children:[t.jsx(g7,{initial:!1,animate:{x:i},transition:{type:"spring",stiffness:300,damping:20,mass:1},size:e}),t.jsx("input",{type:"checkbox",style:{display:"none"},checked:n,name:o,onChange:c})]})},{Title:x7,Text:b7}=Xe;function y7({enabled:e,onToggle:n}){return t.jsxs(v7,{children:[t.jsxs(j7,{children:[t.jsx(x7,{level:4,children:"Opción para Deshabilitar Comprobantes"}),t.jsx(b7,{children:"Activa o desactiva los comprobantes en el punto de venta"})]}),t.jsx(f7,{checked:e,onChange:n})]})}const v7=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1em;
  padding: 16px;
  background-color: #f9f9f9;
  border-radius: 8px;
`,j7=l.div`
  display: flex;
  flex-direction: column;
  > h4 {
    margin: 0;
    font-size: 16px;
    font-weight: 500;
  }
  > p {
    margin: 0;
    font-size: 14px;
    color: rgba(0, 0, 0, 0.45);
  }
`,C7=[{name:"NOMBRE"},{name:"TIPO"},{name:"SERIE"},{name:"SECUENCIA"},{name:"INCREMENTO"},{name:"CANTIDAD"}];function w7(e){if(!e||typeof e!="string")return 0;const n=e.slice(4);return parseInt(n,10)||0}async function Sj(e,n){try{const s=le($,`businesses/${e}/ncfUsage`),o=he(s,te("ncfType","==",n),te("status","in",["pending","completed"]),it("createdAt","desc"),uu(1)),r=await Me(o);if(r.empty)return 0;const i=r.docs[0].data(),a=w7(i.ncfCode);return console.log(`Last used sequence for ${n}: ${a} (NCF: ${i.ncfCode})`),a}catch(s){return console.error("Error getting last used sequence:",s),0}}const Lc=async(e,n)=>{if(!(e!=null&&e.businessID)||typeof(e==null?void 0:e.businessID)!="string")throw new Error("Invalid businessID provided.");if(!n||typeof(n==null?void 0:n.id)!="string")throw new Error("Invalid or empty data provided for update.");try{const s=F($,"businesses",e.businessID,"taxReceipts",n.id);if(n.sequence!==void 0){const o=await Se(s);if(o.exists()){const r=o.data().data,i=parseInt(r.sequence||"0",10),a=parseInt(n.sequence||"0",10),c=r.name,d=await S7(e.businessID,c,a,i);if(!d.isValid)throw console.error(`SECURITY: Sequence validation failed for receipt ${n.id}: ${d.reason}`),new Error(`Error de seguridad: ${d.reason}. Esto podría causar duplicación de NCF.`);a!==i&&console.log(`✅ Sequence updated for receipt ${n.id}: ${i} -> ${a}${d.lastUsedSequence?` (last used: ${d.lastUsedSequence})`:""}`)}}if(n.ncfType){const o=await Sj(e.businessID,n.ncfType);if(o>0&&n.sequence<o)throw new Error(`No se puede retroceder la secuencia del NCF. Última secuencia usada para ${n.ncfType}: ${o}, nueva secuencia: ${n.sequence}`)}await je(s,{data:n}),console.log(`Tax receipt ${n.id} updated successfully.`)}catch(s){throw console.error(`Error updating tax receipt ${n.id}:`,s),new Error(`Failed to update tax receipt ${n.id}: ${s.message}`)}};async function S7(e,n,s,o){try{if(s<o)return{isValid:!1,reason:`No se puede retroceder la secuencia de ${o} a ${s}`};const r=await Sj(e,n);return r>0&&s<=r?{isValid:!1,reason:`La secuencia ${s} ya fue usada. Último NCF usado tiene secuencia ${r}`,lastUsedSequence:r}:{isValid:!0,lastUsedSequence:r}}catch(r){return console.error("Error validating sequence:",r),{isValid:!0,reason:`Validación falló, pero se permite la operación: ${r.message}`}}}function I7({editModalVisible:e,setEditModalVisible:n,currentEditItem:s}){const[o]=M.useForm(),r=D(q);m.useEffect(()=>{if(s){const a={...s,disabled:s.disabled===void 0?!0:s.disabled};o.setFieldsValue(a)}else o.resetFields()},[s,o]);const i=async()=>{try{const a=await o.validateFields(),c={...a,disabled:a.disabled===void 0?!0:a.disabled},d={...s,...c};await Lc(r,d),V.success("Comprobante fiscal actualizado correctamente")}catch(a){console.error("Error al guardar el comprobante fiscal:",a),V.error("Error al actualizar el comprobante fiscal. Por favor, inténtalo de nuevo más tarde.")}finally{n(!1)}};return t.jsx(Ce,{title:"Editar Comprobante Fiscal",open:e,onCancel:()=>n(!1),footer:[t.jsx(U,{onClick:()=>n(!1),children:"Cancelar"},"cancel"),t.jsx(U,{type:"primary",onClick:i,children:"Guardar"},"submit")],width:700,destroyOnHidden:!0,children:s&&t.jsxs(M,{form:o,layout:"vertical",name:"editTaxReceiptForm",initialValues:s,children:[t.jsx(M.Item,{name:"name",label:"Nombre",rules:[{required:!0,message:"Por favor ingrese el nombre del comprobante"}],children:t.jsx(ie,{placeholder:"Nombre del comprobante"})}),t.jsx(M.Item,{name:"type",label:"Tipo",rules:[{required:!0,message:"Por favor ingrese el tipo de comprobante"}],children:t.jsx(ie,{placeholder:"Tipo",maxLength:2})}),t.jsx(M.Item,{name:"serie",label:"Serie",rules:[{required:!0,message:"Por favor ingrese la serie"}],children:t.jsx(ie,{placeholder:"Serie",maxLength:2,type:"number"})}),t.jsx(M.Item,{name:"sequence",label:"Secuencia",rules:[{required:!0,message:"Por favor ingrese la secuencia"}],children:t.jsx(ie,{placeholder:"Secuencia",maxLength:10,type:"number"})}),t.jsx(M.Item,{name:"increase",label:"Incremento",rules:[{required:!0,message:"Por favor ingrese el incremento"}],children:t.jsx(ie,{placeholder:"Incremento",type:"number"})}),t.jsx(M.Item,{name:"quantity",label:"Cantidad",rules:[{required:!0,message:"Por favor ingrese la cantidad"}],children:t.jsx(ie,{placeholder:"Cantidad",type:"number"})}),t.jsx(M.Item,{name:"disabled",label:"Estado",valuePropName:"checked",children:t.jsx(Jx,{checkedChildren:"Activo",unCheckedChildren:"Inactivo"})})]})})}const{Title:E7,Text:zn}=Xe,{Option:A7}=ge,Ij=({visible:e,onCancel:n,taxReceipts:s,onAuthorizationAdded:o})=>{const[r]=M.useForm(),i=D(q),[a,c]=m.useState(null),[d,u]=m.useState(!1);m.useEffect(()=>{e&&(r.resetFields(),c(null))},[e,r]),m.useEffect(()=>{if(a){const g=We().add(1,"year");r.setFieldsValue({authorizationNumber:"",requestNumber:"",startSequence:"",approvedQuantity:"",expirationDate:g})}},[a,r]);const p=(s==null?void 0:s.filter(g=>!g.data.disabled))||[],h=g=>{const y=s.find(b=>b.id===g||b.data.id===g);c(y)},f=g=>{if(!g.startSequence||!g.approvedQuantity)return null;const y=parseInt(g.startSequence,10),b=parseInt(g.approvedQuantity,10);return isNaN(y)||isNaN(b)?null:y+b-1},x=async()=>{try{u(!0);const g=await r.validateFields();if(!a){V.error("Por favor seleccione un comprobante"),u(!1);return}const y=f(g);if(!y){V.error("Error al calcular la secuencia final"),u(!1);return}const b={authorizationNumber:g.authorizationNumber,requestNumber:g.requestNumber,startSequence:g.startSequence,endSequence:String(y),approvedQuantity:g.approvedQuantity,expirationDate:g.expirationDate.format("YYYY-MM-DD"),authorizationDate:We().format("YYYY-MM-DD")},v=a.data,C=v.authorizations||[],I=parseInt(v.sequence||"0",10),j=parseInt(g.startSequence,10);if(j<I){V.error(`Error: La secuencia inicial (${j}) no puede ser menor que la secuencia actual (${I}). Esto podría causar duplicación de NCF.`),u(!1);return}const k={...v,id:v.id,sequence:j>I?g.startSequence:v.sequence,quantity:j>I?g.approvedQuantity:v.quantity,sequenceLength:g.startSequence.length,authorizations:[...C,b]};await Lc(i,k),V.success("Autorización registrada correctamente"),o(k),n()}catch(g){console.error("Error al guardar la autorización:",g),V.error("Error al registrar la autorización del comprobante")}finally{u(!1)}};return t.jsx(Ce,{title:t.jsx(T7,{children:t.jsxs("div",{children:[t.jsx(E7,{level:4,children:"Registro de Autorización de Comprobantes"}),t.jsx(zn,{type:"secondary",children:"Registra una nueva autorización de comprobantes fiscales emitida por la DGI"})]})}),open:e,onCancel:n,width:700,footer:[t.jsx(U,{onClick:n,children:"Cancelar"},"cancel"),t.jsx(U,{type:"primary",onClick:x,loading:d,icon:t.jsx($o,{}),disabled:!a,children:"Registrar Autorización"},"submit")],destroyOnHidden:!0,children:t.jsx(k7,{children:t.jsxs(M,{form:r,layout:"vertical",name:"authorizationForm",children:[t.jsx(Wt,{gutter:16,children:t.jsx(rt,{span:24,children:t.jsx(M.Item,{name:"receiptId",label:"Seleccione el comprobante a actualizar",rules:[{required:!0,message:"Por favor seleccione un comprobante"}],children:t.jsx(ge,{placeholder:"Seleccionar comprobante",onChange:h,optionLabelProp:"label",children:p.map(g=>t.jsx(A7,{value:g.id||g.data.id,label:g.data.name,children:t.jsxs(P7,{children:[t.jsx("div",{className:"receipt-name",children:g.data.name}),t.jsxs("div",{className:"receipt-info",children:[t.jsx("span",{className:"code-label",children:"Código:"}),t.jsxs("span",{className:"code-value",children:[g.data.type,g.data.serie]})]})]})},g.id||g.data.id))})})})}),a&&t.jsxs(t.Fragment,{children:[t.jsx(gn,{children:"Información del Comprobante"}),t.jsx(D7,{children:t.jsxs($7,{children:[t.jsxs(Wi,{children:[t.jsx(zn,{strong:!0,children:"Nombre:"}),t.jsx(zn,{children:a.data.name})]}),t.jsxs(Wi,{children:[t.jsx(zn,{strong:!0,children:"Tipo-Serie:"}),t.jsxs(zn,{children:[a.data.type,a.data.serie]})]}),t.jsxs(Wi,{children:[t.jsx(zn,{strong:!0,children:"Secuencia actual:"}),t.jsx(zn,{children:a.data.sequence})]}),t.jsxs(Wi,{children:[t.jsx(zn,{strong:!0,children:"Cantidad actual:"}),t.jsx(zn,{children:a.data.quantity})]})]})}),t.jsx(gn,{children:"Datos de Autorización"}),t.jsxs(Wt,{gutter:16,children:[t.jsx(rt,{span:12,children:t.jsx(M.Item,{name:"authorizationNumber",label:"Número de Autorización",rules:[{required:!0,message:"Ingrese el número de autorización"},{pattern:/^\d+$/,message:"Ingrese solo números"}],children:t.jsx(ie,{placeholder:"Ej: 5004526018",prefix:t.jsx($a,{}),maxLength:20})})}),t.jsx(rt,{span:12,children:t.jsx(M.Item,{name:"requestNumber",label:"Número de Solicitud",rules:[{required:!0,message:"Ingrese el número de solicitud"},{pattern:/^\d+$/,message:"Ingrese solo números"}],children:t.jsx(ie,{placeholder:"Ej: 5009083898",prefix:t.jsx($a,{}),maxLength:20})})})]}),t.jsxs(Wt,{gutter:16,children:[t.jsx(rt,{span:8,children:t.jsx(M.Item,{name:"startSequence",label:"Secuencia Inicial",rules:[{required:!0,message:"Ingrese la secuencia inicial"},{pattern:/^\d+$/,message:"Ingrese solo números"}],children:t.jsx(ie,{placeholder:"Ej: 1000001537",prefix:t.jsx(vu,{})})})}),t.jsx(rt,{span:8,children:t.jsx(M.Item,{name:"approvedQuantity",label:"Cantidad Aprobada",rules:[{required:!0,message:"Ingrese la cantidad aprobada"},{pattern:/^\d+$/,message:"Ingrese solo números"}],children:t.jsx(ie,{placeholder:"Ej: 324",type:"number",min:1})})}),t.jsx(rt,{span:8,children:t.jsx(M.Item,{name:"expirationDate",label:"Fecha de Vencimiento",rules:[{required:!0,message:"Seleccione la fecha de vencimiento"}],children:t.jsx(yt,{style:{width:"100%"},format:"DD/MM/YYYY",placeholder:"Seleccione fecha"})})})]})]})]})})})},k7=l.div`
  display: flex;
  flex-direction: column;
  gap: 20px;
`,T7=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,P7=l.div`
  display: flex;
  justify-content: space-between;
  width: 100%;
  
  .receipt-name {
    font-weight: 500;
  }
  
  .receipt-info {
    color: #1677ff;
    
    .code-label {
      margin-right: 4px;
      font-size: 12px;
      opacity: 0.8;
    }
    
    .code-value {
      font-weight: 500;
      background: rgba(24, 144, 255, 0.1);
      padding: 0 4px;
      border-radius: 3px;
    }
  }
`,D7=l.div`
  background-color: #f8fafc;
  border-radius: 8px;
  padding: 16px;
  border: 1px solid #e6e8eb;
  margin-bottom: 20px;
`,$7=l.div`
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
`,Wi=l.div`
  display: flex;
  flex-direction: column;
  flex: 1;
  min-width: 120px;
  gap: 4px;
`,R7=({array:e,setData:n})=>{const[s]=M.useForm(),[o,r]=m.useState(!1),[i,a]=m.useState(null),[c,d]=m.useState(null),[u,p]=m.useState(!1),h=D(q),f=e==null?void 0:e.filter(I=>{var j;return!((j=I.data)!=null&&j.disabled)});if(!f||f.length===0)return t.jsx(vg,{children:t.jsx(N7,{children:"No hay comprobantes disponibles."})});const x=async I=>{var w;const j=e[I],k=((w=j.data)==null?void 0:w.disabled)===!0,A=k?"habilitar":"deshabilitar",P=k?"activo":"inactivo";Ce.confirm({title:`¿Estás seguro de ${A} este comprobante?`,icon:t.jsx(Is,{}),content:`El comprobante se marcará como ${P}.`,okText:k?"Habilitar":"Deshabilitar",okType:k?"primary":"danger",cancelText:"Cancelar",onOk:async()=>{try{const S=!k,E={id:j.data.id,...j.data,disabled:S};await Lc(h,E),V.success(`Comprobante ${k?"habilitado":"deshabilitado"} correctamente`);const T=e.map((R,N)=>N===I?{...R,data:{...R.data,disabled:S}}:R);n(T)}catch(S){console.error(`Error al ${A} comprobante:`,S),V.error(`Error al ${A} el comprobante`)}}})},g=I=>{const j=e[I];j&&j.data?(a({...j.data}),d(I),r(!0)):(console.error("Intento de editar un elemento inválido en el índice:",I,j),V.error("No se pudieron cargar los datos para editar."))},y=(I,j)=>I===void 0||j===void 0?I:String(I).padStart(j,"0"),b=I=>{const j=e.map(k=>k.data.id===I.id?{...k,data:I}:k);n(j)},v=I=>{try{if(!I)return"N/A";const{type:j,serie:k,sequence:A,quantity:P,sequenceLength:w}=I;if(!j||!k||A===void 0||!P)return"N/A";const S=parseInt(A,10)+parseInt(P,10);return`${j}${k}${String(S).padStart(w||8,"0")}`}catch(j){return console.error("Error al calcular el límite:",j),"Error"}},C=[...C7,{name:"LÍMITE (NCF)"},{name:"ACCIÓN"}];return t.jsxs(vg,{children:[t.jsx(jg,{children:C.map((I,j)=>t.jsx(Un,{children:t.jsx("h4",{children:I.name})},j))}),f.map((I,j)=>{var k,A,P,w,S;return t.jsxs(jg,{onDoubleClick:()=>g(e.indexOf(I)),children:[t.jsx(Un,{children:t.jsx("span",{children:(k=I.data)==null?void 0:k.name})}),t.jsx(Un,{children:t.jsx("span",{children:(A=I.data)==null?void 0:A.type})}),t.jsx(Un,{children:t.jsx("span",{children:(P=I.data)==null?void 0:P.serie})}),t.jsx(Un,{children:t.jsx("span",{children:y(I.data.sequence,I.data.sequenceLength)})}),t.jsx(Un,{children:t.jsx("span",{children:(w=I.data)==null?void 0:w.increase})}),t.jsx(Un,{children:t.jsx("span",{children:(S=I.data)==null?void 0:S.quantity})}),t.jsx(Un,{children:t.jsx(Oe,{title:"Número del último comprobante que se generará",children:t.jsxs(O7,{children:[t.jsx(no,{style:{marginRight:5}}),v(I.data)]})})}),t.jsx(Un,{children:t.jsxs(M7,{children:[t.jsx(Cg,{onClick:()=>g(e.indexOf(I)),className:"edit-button",title:"Editar",children:t.jsx(es,{})}),t.jsx(Cg,{onClick:()=>x(e.indexOf(I)),className:"delete-button",title:"Deshabilitar",children:t.jsx(r0,{})})]})})]},j)}),"      ",t.jsx(I7,{editModalVisible:o,setEditModalVisible:r,currentEditItem:i}),t.jsx(Ij,{visible:u,onCancel:()=>p(!1),taxReceipts:e,onAuthorizationAdded:b})]})},vg=l.div`
  border: 1px solid var(--Gray1);
  border-radius: 10px;
  overflow: hidden;
`,N7=l.div`
  padding: 2em;
  text-align: center;
  font-size: 14px;
  color: #666;
`,jg=l.div`
  display: grid;
  align-items: center;
  grid-template-columns: minmax(150px, 0.7fr) minmax(40px, 0.2fr) minmax(40px, 0.2fr) minmax(90px, 0.5fr) minmax(80px, 0.3fr) minmax(80px, 0.3fr) minmax(100px, 0.6fr) 80px;
  border-bottom: 1px solid var(--Gray1);
  height: 2.75em;
  :last-child { border-bottom: 0; }
  background-color: ${e=>e.disabled?"#f5f5f5":"transparent"};
  position: relative;
  ${e=>e.disabled&&`
    & span { text-decoration: line-through; color: #999; }
    & div[class^="LimitDisplay"] { opacity: 0.7; }
    & div[class^="LimitDisplay"] span { text-decoration: none; color: #1890ff; }
    & button.enable-button { opacity: 1; position: relative; z-index: 1; box-shadow: 0 0 8px rgba(82,196,26,0.2); }
    & button.enable-button span { color: inherit; text-decoration: none; }
  `}
`,Un=l.div`
  height: 100%;
  padding: 0 0.6em;
  display: flex;
  align-items: center;
  border-right: 1px solid var(--Gray1);
  :last-child { border-right: 0; }
  :first-child { border-left: 0; }
  input[type="text"], input[type="number"] { width: 100%; height: 100%; border: 0; font-size: 12px; padding: 0;
    :focus { outline: none; }
  }
  input[type='number']::-webkit-inner-spin-button, input[type='number']::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
  h4 { font-size: 12px; width: 100%; text-align: left; margin: 0; padding: 0 !important; }
`,O7=l.div`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  font-size: 12px;
  color: #1890ff;
  font-weight: 600;
  letter-spacing: 0.5px;
  background-color: #f0f8ff;
  padding: 4px 8px;
  border-radius: 4px;
  border: 1px dashed #1890ff;
`,M7=l.div`
  display: flex;
  justify-content: space-around;
  align-items: center;
  width: 100%;
  height: 100%;
`,Cg=l.button`
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 4px;
  font-size: 18px;
  border-radius: 4px;
  transition: all 0.2s;
  &.edit-button { color: #474747; &:hover { color: #414141; } }
  &.delete-button { color: #ff4d4f; &:hover { color: #ff7875; background-color: rgba(255,77,79,0.1); } }
  &.enable-button { color: #52c41a; opacity: 1 !important; font-weight: 500; background-color: transparent; box-shadow: none; position: relative; z-index: 300; &:hover { color: #73d13d; background-color: #fff; } }
  &:focus { outline: none; }
`,F7=({visible:e,onCancel:n,disabledReceipts:s,onRestore:o})=>{const r=D(q),i=async a=>{try{const c={id:a.id,...a,disabled:!1};await Lc(r,c),V.success("Comprobante restaurado correctamente"),o(a.id)}catch(c){console.error("Error al restaurar comprobante:",c),V.error("Error al restaurar el comprobante")}};return t.jsx(Ce,{title:t.jsxs(z7,{children:[t.jsx(U7,{children:"Comprobantes Deshabilitados"}),t.jsx(W7,{children:"Estos comprobantes están inactivos pero pueden ser restaurados"})]}),width:800,open:e,onCancel:n,footer:[t.jsx(U,{onClick:n,children:"Cerrar"},"close")],children:t.jsx(L7,{children:s.length>0?t.jsx(q7,{children:s.map(a=>t.jsxs(V7,{children:[t.jsxs(G7,{children:[t.jsx(_7,{children:a.data.name}),t.jsxs(H7,{children:[a.data.type,a.data.serie]})]}),t.jsx(Q7,{children:t.jsxs(Y7,{children:[t.jsx(K7,{children:"Secuencia:"}),t.jsx(J7,{children:a.data.sequence})]})}),"                ",t.jsx(X7,{children:t.jsxs(Z7,{onClick:()=>i(a.data),children:[t.jsx($o,{style:{fontSize:"12px"}}),t.jsx("span",{children:"Restaurar"})]})})]},a.id||a.data.id))}):t.jsxs(eH,{children:[t.jsx(tH,{children:t.jsx(B7,{})}),t.jsx(nH,{children:"No hay comprobantes deshabilitados"})]})})})},B7=()=>t.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("path",{d:"M48 8H16C13.7909 8 12 9.79086 12 12V52C12 54.2091 13.7909 56 16 56H48C50.2091 56 52 54.2091 52 52V12C52 9.79086 50.2091 8 48 8Z",stroke:"#d9d9d9",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsx("path",{d:"M36 8V18H44",stroke:"#d9d9d9",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsx("path",{d:"M24 30H40",stroke:"#d9d9d9",strokeWidth:"2",strokeLinecap:"round"}),t.jsx("path",{d:"M24 38H40",stroke:"#d9d9d9",strokeWidth:"2",strokeLinecap:"round"})]}),L7=l.div`
  display: flex;
  flex-direction: column;
  gap: 16px;
  max-height: 70vh;
  overflow-y: auto;
  padding-right: 4px;
`,z7=l.div`
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 18px;
`,U7=l.h4`
  margin: 0;
  font-size: 20px;
  font-weight: 600;
  color: #1a1a1a;
`,W7=l.p`
  margin: 0;
  font-size: 14px;
  color: #8c8c8c;
`,q7=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 12px;
`,V7=l.div`
  display: flex;
  flex-direction: column;
  background-color: white;
  border-radius: 6px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  overflow: hidden;
  border: 1px solid #eaeaea;
`,G7=l.div`
  padding: 10px 12px;
  background-color: #f8f9fa;
  border-bottom: 1px solid #eaeaea;
  display: flex;
  justify-content: space-between;
  align-items: center;
`,_7=l.h4`
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  color: #1a1a1a;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex: 1;
`,H7=l.span`
  font-size: 13px;
  font-weight: 500;
  color: #1677ff;
  background-color: rgba(22, 119, 255, 0.1);
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
`,Q7=l.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 10px 12px;
  flex: 1;
  gap: 12px;
  background-color: #fafafa;
`,Y7=l.div`
  display: flex;
  flex: 1;
  gap: 6px;
`,K7=l.span`
  font-size: 13px;
  color: #8c8c8c;
  margin-bottom: 2px;
`,J7=l.span`
  font-size: 13px;
  font-weight: 500;
  color: #262626;
`,X7=l.div`
  padding: 8px 12px;
  border-top: 1px solid #eaeaea;
`,Z7=l.button`
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  background-color: #1677ff;
  color: white;
  border: none;
  border-radius: 4px;
  padding: 8px 12px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  width: 100%;
  
  &:hover {
    background-color: #0958d9;
  }
`,eH=l.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 24px;
  text-align: center;
`,tH=l.div`
  margin-bottom: 16px;
  opacity: 0.5;
`,nH=l.p`
  font-size: 16px;
  color: #8c8c8c;
  margin: 0;
`,sH=({enabled:e,itemsLocal:n,setItemsLocal:s,onAddBlank:o,onAddPredefined:r})=>{const[i,a]=m.useState(!1),[c,d]=m.useState(!1),u=n==null?void 0:n.filter(h=>{var f;return(f=h.data)==null?void 0:f.disabled}),p=h=>{const f=n.map(x=>x.data.id===h?{...x,data:{...x.data,disabled:!1}}:x);s(f)};return e?t.jsxs(oH,{children:["      ",t.jsxs(rH,{children:[t.jsx(wg,{}),"        ",t.jsxs(iH,{children:[t.jsx(U,{icon:t.jsx(Jn,{}),type:"primary",onClick:r,children:"Comprobante"}),t.jsx(U,{icon:t.jsx(vu,{}),type:"primary",onClick:()=>d(!0),children:"Autorización"})]})]}),t.jsx(R7,{array:n,setData:s}),t.jsx(aH,{children:t.jsx(wg,{children:u.length>0&&t.jsxs(cH,{onClick:()=>a(!0),children:["Ver Comprobantes Inactivos",t.jsx(kn,{count:u.length})]})})}),"      ",t.jsx(F7,{visible:i,onCancel:()=>a(!1),disabledReceipts:u,onRestore:p}),t.jsx(Ij,{visible:c,onCancel:()=>d(!1),taxReceipts:n,onAuthorizationAdded:h=>{const f=n.map(x=>x.data.id===h.id?{...x,data:h}:x);s(f)}})]}):null},oH=l.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
`,rH=l.div`
  display: flex;
  justify-content: space-between;
  padding: 0;
  border-radius: 8px;
  margin-bottom: 10px;
`,wg=l.div`
  display: flex;
`,iH=l.div`
  display: flex;
  gap: 12px;
`,aH=l.div`
  display: flex;
  justify-content: space-between;
  padding: 0;
  border-radius: 8px;
  margin-top: 10px;
`,cH=l.button`
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px 16px;
  background-color: #f9f0ff;
  border: 1px dashed #722ed1;
  border-radius: 8px;
  color: #722ed1;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s;

  &:hover {
    background-color: #f0e6ff;
    border-color: #531dab;
  }

  .ant-badge {
    margin-left: 8px;
  }
`;function lH(e){const n=new Set(e.map(r=>r.data.serie));let s=3,o=s<10?`0${s}`:`${s}`;for(;n.has(o);)s++,o=s<10?`0${s}`:`${s}`;return{data:{name:"NUEVO COMPROBANTE",type:"B",serie:o,sequence:"0000000000",increase:1,quantity:2e3,disabled:!1}}}function dH(e,n){const s=new Set(n.map(c=>c.data.serie)),o=new Set(n.map(c=>c.data.name)),r=[],i=[],a=[];return e.forEach(c=>{const{name:d,serie:u}=c.data;if(o.has(d))i.push(d);else if(s.has(u))a.push(u);else{const p={...c,data:{...c.data,disabled:!1}};r.push(p),o.add(d),s.add(u)}}),{unique:r,duplicateNames:i,duplicateSeries:a}}function uH(e){return m.useMemo(()=>{const s=Array.isArray(e)&&e.some(i=>i.loading===!0),o=Array.isArray(e)&&e.find(i=>i.loading===!0),r=o?o.tip:"";return{isLoading:s,tip:r}},[e])}const{Title:pH,Paragraph:mH}=Xe,Sg=()=>{const e=W(),n=D(q),s=D(os),{taxReceipt:o,isLoading:r}=wj(),{setDialogConfirm:i,onClose:a}=Ds(),[c,d]=m.useState([]),[u,p]=m.useState(!1),[h,f]=m.useState(!1),x=J_(c,o);m.useEffect(()=>{const A=Eu(o);e(k0(A)),d(A)},[o,e]),m.useCallback(async()=>{f(!0);try{await E0(n,c),V.success("Comprobantes fiscales actualizados correctamente")}catch{V.error("Error al actualizar los comprobantes fiscales. Por favor, inténtalo de nuevo más tarde.")}finally{f(!1)}},[n,c]);const g=()=>{s?i({title:"¿Deshabilitar comprobantes?",isOpen:!0,type:"warning",message:"Si deshabilitas los comprobantes, no se mostrarán en el punto de venta.",onConfirm:()=>{xg(n),a()}}):xg(n)},y=()=>{const A=lH(c);d([...c,A]),V.success("Nuevo comprobante agregado. No olvides guardar los cambios.")},b=()=>p(!0),v=()=>p(!1);function C(A){const{unique:P,duplicateNames:w,duplicateSeries:S}=dH(A,c);let E="";w.length&&(E+=`Se omitieron ${w.length} comprobante(s) con nombre(s) duplicado(s): ${w.join(", ")}. `),S.length&&(E+=`Se omitieron ${S.length} comprobante(s) con serie(s) duplicada(s): ${S.join(", ")}.`),E&&V.warning(E),P.length?(d([...c,...P]),V.success(`${P.length} comprobante(s) añadidos correctamente. No olvides guardar los cambios.`)):E||V.error("No se agregaron comprobantes. Todos ya existen en el sistema.")}const I=[{loading:r===!0,tip:"Cargando comprobantes fiscales..."},{loading:h===!0,tip:"Guardando comprobantes fiscales..."}],{isLoading:j,tip:k}=uH(I);return t.jsx(He,{spinning:j,tip:k,children:t.jsxs(hH,{children:[t.jsxs(gH,{children:[t.jsx(pH,{level:3,style:{margin:"0 0 8px 0",fontSize:"18px",fontWeight:600},children:"Configuración de Comprobantes"}),t.jsx(mH,{style:{fontSize:"16px",margin:0,lineHeight:"1.5",color:"rgba(0, 0, 0, 0.65)"},children:"Ajusta cómo se generan y muestran los comprobantes en el punto de venta."})]}),t.jsx(y7,{enabled:s,onToggle:g}),t.jsx(sH,{enabled:s,itemsLocal:c,setItemsLocal:d,isUnchanged:x,onAddBlank:y,onAddPredefined:b}),t.jsx(t7,{visible:u,onCancel:v,onAddReceipt:C,existingReceipts:c})]})})},hH=l.div`
  display: grid;
  gap: 1.6em;
  padding: 1em;
`,gH=l.div`
  display: grid;
  width: 100%;
`,fH=({cat:e,Row:n,Col:s})=>{W();const o=D(q),[r,i]=m.useState(null),[a,c]=m.useState({name:e.name,id:e.id}),[d,u]=m.useState(!1),p=m.useRef(null),h=m.useRef(null),f=()=>{u(!1),i(null)};m.useEffect(()=>{c({name:e.name,id:e.id})},[e]);const x=()=>{c({name:e.name,id:e.id}),i("EDIT"),u(!0),p.current.focus(),p.current.select()},g=v=>{i("DELETE"),u(!0)},y=()=>{switch(r){case"DELETE":bM(o,e.id),V.success("Categoría eliminada",2.5);break;case"EDIT":yM(a,o),V.success("Categoría actualizada",2.5);break}i(null),u(!1)},b=()=>{c({name:e.name,id:e.id}),i(null),u(!1)};return kt(h,d,f),t.jsxs(n,{ref:h,children:[t.jsx(xH,{ref:p,type:"text",value:a.name,onChange:v=>c({...a,name:v.target.value}),readOnly:!d}),t.jsx(s,{children:d?t.jsxs($t,{children:[t.jsx(qi,{icon:z.operationModes.cancel,onClick:b}),t.jsx(qi,{icon:z.operationModes.accept,onClick:y})]}):t.jsxs($t,{children:[t.jsx(qi,{icon:z.operationModes.edit,onClick:x}),t.jsx(qi,{icon:z.operationModes.delete,onClick:()=>g(e.id),danger:!0})]})})]})};l.div`
`;const qi=l(U)`
font-size: 1.2em;
display: flex;
justify-content: center;
align-items: center;
`,xH=l.input`
margin-left: 1em;
border: none;
height: 2em;

:focus{
  outline: 2px solid rgba(0, 0, 0, 0.200);
}
${e=>{switch(e.readOnly){case!0:return`
        background-color: #ffffff;
        :focus{
          user-select: none;
          outline: none;
          pointer-events: none;
        }
        ::selection{
          background-color: transparent;
          color: inherit;
        }
        
        `}}}
`,bH=({searchTerm:e})=>{const{categories:n}=Wu(),s=$n(n,e);return t.jsx(yH,{children:t.jsxs(vH,{children:[t.jsx(wH,{children:t.jsx("span",{children:"Administrar Categoría"})}),t.jsx(jH,{children:t.jsx(CH,{children:s.length>0?s.map(({category:o},r)=>t.jsx(fH,{Row:SH,Col:IH,cat:o},r)):null})})]})})},yH=l.div`
    width: 100%;
    padding: 0 1em;
    display: flex;
    justify-content: center;
    overflow: hidden;
     padding: 1em;
`,vH=l.header`
    justify-self: center;
    border: 1px solid rgba(0, 0, 0, 0.100);
    border-radius: 10px;
    position: relative;
    overflow: hidden;
    //max-height: 400px;
    width: 100%;
    max-width: 1000px;
    
    display: grid;
    grid-template-rows: min-content 1fr; 
    background-color: #ffffff;
    @media (max-width: 800px){
      max-height: 100%;
      
  }
`,jH=l.div`
  position: relative;
  width: 100%;
  overflow: hidden;
  display: grid;
  grid-template-rows:  1fr; 
  
  `,CH=l.div`

  display: grid;
  align-content: start;
  grid-template-columns:  repeat(auto-fill, minmax(250px, 1fr));
  overflow-y: scroll;
  color: var(--Gray10);
  font-size: 15px;

`,wH=l.div`
  display: grid;
  align-items: center;
  justify-content: center;
  background: #3f3f3f;
  height: 2em;
 
    color: white;
   
  font-weight: 600;
  text-align: center;
`,SH=l.div`
  display: grid;
  align-items: center;
  height: 3em;
  gap: 0.6em;
  grid-template-columns: 
  minmax(100px, 1fr) //Nombre
  minmax(100px, min-content); // accion
  border-right: 1px solid rgba(16, 16, 16, 0.200);
  border-bottom: 1px solid rgba(16, 16, 16, 0.200);


  @media (max-width: 800px){
    gap: 0;
  }
  ${e=>{switch(e.container){case"first":return`
        @media (max-width: 800px){
        display: grid;
        grid-template-columns: min-content 1fr;
        span{
          display: block;
          transform: rotate(90deg);
          width: 
        }
      }
      
      `}}}
    ${e=>{switch(e.border){case"border-bottom":return`
              border-bottom: 1px solid rgba(0, 0, 0, 0.200);
              &:last-child{
                border-bottom: none;
              }
              `}}}
  ${e=>{switch(e.color){case"header":return`
        background-color: #9c0e0e;
        `;case"item":return`
        background-color: #ebebeb;
        `}}}
  ${e=>{switch(e.fill){case"fill":return`
          padding-right: 16px;
          height: 2em;
          background-color: var(--White1);
        `}}}
`,IH=l.div`
  padding: 0 0.6em;
  ${e=>{switch(e.position){case"right":return`
          text-align: right;
        `}}}
  ${e=>{switch(e.size){case"limit":return`
          width: 100%;
          
          display: -webkit-box;
          -webkit-line-clamp: 1;
          -webkit-box-orient: vertical;  
          //white-space: nowrap;
          text-overflow: ellipsis;
          overflow: hidden;
          `}}}
`,EH=()=>{const[e,n]=m.useState("");return t.jsxs(m.Fragment,{children:[t.jsx(Ze,{searchData:e,setSearchData:n}),t.jsx(AH,{children:t.jsx(bH,{searchTerm:e})})]})},AH=l.div`
    width: 100vw;
    height: calc(100vh - 2.75em);
    background-color: var(--color2);
    display: grid;
    grid-template-rows: 1fr;
    overflow: hidden;
   
    
`;l.div`
    height: 0.6em;
    width: 1.2em;
    border-radius: 10px;
    ${e=>{switch(e.colorRef){case"red":return`
                    background-color: #e64747;
                `;case"yellow":return`
                    background-color: #f7e43c;
                `;case"green":return`
                    background-color: #45db59;
                `;case"gray":return`
                    background-color: #777777;
                `}}}
`;const Ej=({title:e,bgColor:n,fontSize:s,width:o})=>t.jsx(kH,{bgColor:n,fontSize:s,width:o,children:e}),kH=l.div`
    height: 1.6em;
    display: flex;
    align-items: center;
    padding: 0 0.4em;
    border-radius: 6px;
    color: black;
    width: min-content;
    
   ${e=>{switch(e.width){case"auto":return`
          width: auto;
        `}}}
    ${e=>{switch(e.fontSize){case"small":return`
            font-size: 13px;
          `;case"normal":return`
            font-size: 16px;
          `;case"large":return`
            font-size: 18px;
          `}}}
    ${e=>{switch(e.bgColor){case"error":return`
                background-color: rgba(255, 0, 0, 0.100);
                color: var(--Gray10)
                `;case"primary":return`
                background-color:  rgba(0, 129, 250, 0.100);
                color: var(--Black4);
                `}}}
`,TH=async(e,n)=>{if(!n||!(n!=null&&n.businessID))return;const s=F($,"businesses",n.businessID,"providers",e);try{await Ot(s),console.log(e)}catch(o){console.log(o)}},PH=({e,Row:n,Col:s})=>{const o=_e.UPDATE.id,r=D(q),i=t.jsx(Ej,{title:"(vacio)",fontSize:"small",bgColor:"error"}),a=W(),c=u=>{TH(u,r)},d=()=>{a(Ys({mode:o,data:e}))};return t.jsxs(n,{children:[t.jsx(s,{children:e.id}),t.jsx(s,{children:e.name}),t.jsx(s,{size:"limit",children:e.tel!==""?Dn(e.tel):i}),t.jsx(s,{children:e.address?e.address:i}),t.jsx(s,{children:t.jsxs(mi,{children:[t.jsx(ke,{borderRadius:"normal",title:z.operationModes.edit,width:"icon32",color:"gray-dark",onClick:d}),t.jsx(ke,{borderRadius:"normal",title:z.operationModes.delete,width:"icon32",color:"gray-dark",onClick:()=>c(e.id)})]})})]})};l.div`
`;const DH=()=>{D(q);const{providers:e}=oi();return t.jsx($H,{children:t.jsxs(RH,{children:[t.jsx(MH,{children:t.jsx("h3",{children:"Administrar Proveedores"})}),t.jsxs(NH,{children:[t.jsxs(Ig,{fill:"fill",children:[t.jsx(ho,{children:"#"}),t.jsx(ho,{children:"Nombre"}),t.jsx(ho,{children:"Teléfono"}),t.jsx(ho,{children:"Dirección"}),t.jsx(ho,{children:"Acción"})]}),t.jsx(OH,{children:Array(e).length>0?e.map(({provider:n},s)=>t.jsx(PH,{Row:Ig,Col:ho,e:n,index:s},s)):null})]})]})})},$H=l.div`
    width: 100%;
    padding: 0 1em;
    display: flex;
    justify-content: center;
`,RH=l.header`
    justify-self: center;
    border: 1px solid rgba(0, 0, 0, 0.100);
    border-radius: 10px;
    position: relative;
    height: calc(100vh - 2.75em - 2.5em - 1.5em);
    overflow: hidden;
    //max-height: 400px;
    width: 100%;
    max-width: 1000px;
    
    display: grid;
    grid-template-rows: min-content 1fr; 
    background-color: #ffffff;
    @media (max-width: 800px){
      max-height: 100%;
      
  }
`,NH=l.div`
  position: relative;
  width: 100%;
  overflow: hidden;
  overflow-x: auto;
  display: grid;
  grid-template-rows: min-content 1fr;
  
 

`,OH=l.div`
  display: grid;
  align-items: flex-start;
  align-content: flex-start;
  overflow-y: scroll;
  overflow-x: hidden;
  width: 100%;
  color: var(--Gray10);
  font-size: 15px;
  

`,MH=l.div`
  display: grid;
  align-items: center;
  justify-content: center;
  background: #3f3f3f;
  height: 2em;
  h3{
    margin: 0;
    color: white;
    font-weight: 500;
  }
  text-align: center;
`,Ig=l.div`
  display: grid;
  align-items: center;
  height: 3em;
  gap: 0.6em;
  grid-template-columns: 
  minmax(100px, 0.1fr) //ID
  minmax(120px, 0.6fr) //Nombre
  minmax(148px, 0.5fr) //Telefono
  minmax(120px, 1fr) //Direccion
  minmax(92px, 0.2fr); //acción
  @media (max-width: 800px){
    gap: 0;
  }
  ${e=>{switch(e.container){case"first":return`
        @media (max-width: 800px){
        display: grid;
        grid-template-columns: min-content 1fr;
        span{
          display: block;
          transform: rotate(90deg);
          width: 
        }
      }
      
      `}}}
    ${e=>{switch(e.border){case"border-bottom":return`
              border-bottom: 1px solid rgba(0, 0, 0, 0.200);
              &:last-child{
                border-bottom: none;
              }
              `}}}
  ${e=>{switch(e.color){case"header":return`
        background-color: #9c0e0e;
        `;case"item":return`
        background-color: #ebebeb;
        `}}}
  ${e=>{switch(e.fill){case"fill":return`
          padding-right: 16px;
          height: 2em;
          background-color: var(--White1);
        `}}}
`,ho=l.div`
  padding: 0 0.6em;
  ${e=>{switch(e.position){case"right":return`
          text-align: right;
        `}}}
  ${e=>{switch(e.size){case"limit":return`
          width: 100%;
          
          display: -webkit-box;
          -webkit-line-clamp: 1;
          -webkit-box-orient: vertical;  
          //white-space: nowrap;
          text-overflow: ellipsis;
          overflow: hidden;
          `}}}
`,FH=({data:e,onChange:n,fn:s})=>{const o=m.useRef(),r=()=>{s(),o.current.value=""};return t.jsxs(BH,{children:[t.jsx("input",{type:"text",ref:o,onChange:n,placeholder:`Buscar ${e.name}`}),t.jsx("div",{onClick:r,children:t.jsx(O,{icon:_r})})]})},BH=l.div`
    width: 100%;
    display: flex;
    height: 2em;
    align-items: center;
    justify-content: space-between;
    background-color: white;
    padding: 0 1em;
    border-radius: 6px;
    input{
        border: none;
        outline: none;
    }
    div{
      
      height: 1.2em;
      width: 1.2em;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--White2);
    }
`,LH=(e,n,s,o,r,i,a)=>{const c=[...e];i?c[s][o][i][r]=a:c[s][o][r]=a,n(c)},zH=({data:e,array:n,setArray:s,index:o})=>{const[r,i]=m.useState(""),a=GV(e,r),[c,d]=m.useState(!1),u=()=>d(!c);return t.jsxs(UH,{children:[t.jsxs(qH,{onClick:u,children:[t.jsx(O,{icon:Zs})," ",t.jsx("span",{children:e.name})]}),t.jsx(WH,{isOpen:!!c,index:o,children:t.jsxs(m.Fragment,{children:[t.jsx(FH,{data:e,onChange:p=>i(p.target.value),fn:()=>i("")}),t.jsxs(VH,{children:[a.map((p,h)=>h<=2?t.jsxs(GH,{isSelected:!!p.selected,children:[t.jsx("input",{type:"checkbox",name:"selected",id:h,onChange:f=>{LH(n,s,o,"Items","selected",h,f.target.checked)}}),t.jsx("label",{htmlFor:h,children:p.name})]},h):null),e.Items.length>4&&t.jsx("button",{children:"See More"})]})]})})]})},UH=l.div`
    
`,WH=l.div`
height: auto;
background-color: rgb(242, 242, 242);
padding: 0.4em 1em;
gap: 1em;
display: grid;
transition: height transform 2s ease-in-out;
    ${e=>{switch(e.isOpen){case!0:return`
                transform: translate(0, 0px);
                background-color: rgb(242, 242, 242);
                padding: 0.4em 1em;
                position: relative;
                height: auto;
                z-index: 1;
                display: grid;
                gap: 1em;
                transition-property: transform, z-index;
                transition-duration: 400ms, 400ms;
                transition-delay: 0s, 400ms;
                transition-timing-function: easy-in-out;
                `;case!1:return`   
                transform: translate(0, -500px);  
                position: absolute; 
                height: 0px;
                z-index: ${-(e.index+3)};
                width: 100%;   
                transition-property: transform, z-index;
                transition-duration: 400ms, 400ms;
                transition-delay: 100ms, 0ms;
                transition-timing-function: easy-in-out, lineal;
        `}}}
`,qH=l.div`
height: 2em;
    display: grid;
    align-items: center;
    gap: 1em;
    grid-template-columns: min-content 1fr;
    background-color: var(--White);
    padding: 0 1em;
`,VH=l.ul`
    list-style: none;
    padding: 0;
    display: grid;
    gap: 0.4em;
   
    
`,GH=l.li`

        grid-template-columns: min-content 1fr;
        gap: 1em;
        padding: 0.2em 0.6em;
        border-radius: 0.4em;
        background-color: rgb(254, 254, 254);
        position: relative;
        display: grid;
        ${e=>{switch(e.isSelected){case!0:return`
                    background-color: rgb(34, 106, 201);
                    
                    `;case!1:return`
                    background-color: rgb(254, 254, 254);
                  
                    `}}}
`,_H=({MenuIsOpen:e})=>{const[n,s]=m.useState([]);return t.jsxs(HH,{isOpen:!!e,children:[t.jsx(QH,{children:t.jsx("h3",{children:"Filtros"})}),t.jsx(YH,{children:n.map((o,r)=>t.jsx(zH,{data:o,array:n,setArray:s,index:r},r))})]})},HH=l.div`
  overflow: hidden;
  max-height: 350px;
  height: 100%;
  max-width: 300px;
  border-radius: 6px;
  border: 1px solid rgba(0, 0, 0, 0.150);
  margin-left: 4px;
  width: 100%;
  top: 5.2em;
  position: absolute;
  z-index: 1;
  background-color: #ffffff;
  transform: scale(1);
  transition: transform 400ms ease-in-out;
  transform: perspective();
  box-shadow: 10px 10px 10px 2px rgba(0, 0, 0, 0.150);
  ${e=>{switch(e.isOpen){case!0:return`
        transform: scaleX(1) translateX(0px) translateY(0px);
        `;case!1:return`   
        transform: scale(0) translateX(-400px) translateY(-100px);
        `}}}
`,QH=l.div`
  background-color: var(--White);
  h3{
    margin: 0;
    padding: 0.4em 1em;
  }
`,YH=l.div`

`,KH=()=>{const[e,n]=m.useState(!1),s=()=>n(!e);return t.jsxs(JH,{children:["      ",t.jsx(ke,{borderRadius:"normal",startIcon:t.jsx(O,{icon:Or}),title:"Filtros",color:"gray-dark",onClick:s}),t.jsx(_H,{MenuIsOpen:e})]})},JH=l.div`
    
`,XH=()=>{const e=_e.CREATE.id,n=W(),s=()=>{n(Ys({mode:e,data:null}))};return t.jsx(ZH,{children:t.jsxs(eQ,{children:[t.jsx(KH,{}),"                ",t.jsx(ke,{borderRadius:"normal",bgcolor:"primary",startIcon:t.jsx(O,{icon:js}),title:" Proveedores",onClick:s})]})})},ZH=l.div`
    height: 2.50em;
    width: 100vw;
    background-color: rgb(255, 255, 255);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1em;
`,eQ=l.div`
    max-width: 1000px;
    width: 100%;
    padding: 0 1em;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1em;
`,tQ=()=>t.jsxs(m.Fragment,{children:[t.jsx(Ze,{}),t.jsxs(nQ,{children:[t.jsx(XH,{}),t.jsx(DH,{})]})]}),nQ=l.div`
    width: 100vw;
    height: calc(100vh - 2.75em);
    background-color: var(--color2);
    display: grid;
    grid-auto-rows: min-content;
    justify-content: center;
    align-items: flex-start;
    overflow: hidden;
    
`,{Button:Eg}=Ne,sQ=()=>{const e=W(),n=D(q),s=_e.UPDATE.id,o=t.jsx(Ej,{title:"(vacio)",fontSize:"small",bgColor:"error"}),r=async d=>await Ic(n==null?void 0:n.businessID,d),i=d=>{e(Pn({mode:s,data:d}))};return{columns:[{Header:"Nombre",accessor:"name"},{Header:"Telefono",accessor:"phone",cell:({value:d})=>d?Dn(d):o},{Header:"RNC/Cedula",accessor:"rnc",cell:({value:d})=>d||o},{Header:"Direccion",accessor:"address",cell:({value:d})=>d?Ro(d,14):o},{Header:"Acciones",accessor:"actions",minWidth:"300px",maxWidth:"1fr",align:"right",cell:({value:d})=>t.jsxs($t,{children:[t.jsx(Eg,{icon:z.operationModes.edit,onClick:()=>i(d)}),t.jsx(Eg,{danger:!0,icon:z.operationModes.delete,onClick:()=>r(d.id)})]})}],filterConfig:[{label:"Cliente",accessor:"name"}]}},oQ=({clients:e=[]})=>{const{columns:n,filterConfig:s}=sQ(),o=e.map(({client:r})=>({id:r.id,name:r.name,phone:r.tel,rnc:r.personalID,address:r.address,actions:r}));return t.jsx(rn,{data:o,columns:n,filterUI:!0,filterConfig:s})};l.div`
    width: 100%;
    padding: 0 1em;

`;l.header`
    justify-self: center;
    border: 1px solid rgba(0, 0, 0, 0.100);
    border-radius: 10px;
    position: relative;
    height: calc(100vh - 2.75em - 2.5em - 1.5em);
    overflow: hidden;
    //max-height: 400px;
    width: 100%;
    max-width: 1000px;
    
    display: grid;
    grid-template-rows: min-content 1fr; 
    background-color: #ffffff;
    @media (max-width: 800px){
      max-height: 100%;
      
  }
`;l.div`
  position: relative;
  width: 100%;
  overflow: hidden;
  overflow-x: auto;
  display: grid;
  grid-template-rows: min-content 1fr;
  
 

`;l.div`
  display: grid;
  align-items: flex-start;
  align-content: flex-start;
  overflow-y: auto;
  overflow-x: hidden;
  width: 100%;
  color: var(--Gray10);
  font-size: 15px;
  

`;l.div`
  display: grid;
  align-items: center;
  justify-content: center;
  background: #3f3f3f;
  height: 2em;
  h3{
    margin: 0;
    color: white;
    font-weight: 500;
  }
  text-align: center;
`;l.div`
  display: grid;
  align-items: center;
  height: 3em;
  gap: 1em;
  grid-template-columns: 
  minmax(120px, 0.1fr) //ID
  minmax(170px, 0.4fr) //Nombre
  minmax(170px, 0.4fr) //Telefono
  minmax(130px, 0.3fr) //RNC/Cedula
  minmax(170px, 1fr) //Direccion
  minmax(92px, 0.2fr); //acción
  @media (max-width: 800px){
    gap: 0;
  }
  ${e=>{switch(e.container){case"first":return`
        @media (max-width: 800px){
        display: grid;
        grid-template-columns: min-content 1fr;
        span{
          display: block;
          transform: rotate(90deg);
          width: 
        }
      }
      
      `}}}
    ${e=>{switch(e.border){case"border-bottom":return`
              border-bottom: 1px solid rgba(0, 0, 0, 0.200);
              &:last-child{
                border-bottom: none;
              }
              `}}}
  ${e=>{switch(e.color){case"header":return`
        background-color: #9c0e0e;
        `;case"item":return`
        background-color: #ebebeb;
        `}}}
  ${e=>{switch(e.fill){case"fill":return`
          padding-right: 18px;
          height: 2em;
          background-color: var(--White1);
        `}}}
`;l.div`
  padding: 0 0.6em;
  ${e=>{switch(e.position){case"right":return`
          text-align: right;
        `}}}
  ${e=>{switch(e.size){case"limit":return`
          width: 100%;
          
          display: -webkit-box;
          -webkit-line-clamp: 1;
          -webkit-box-orient: vertical;  
          //white-space: nowrap;
          text-overflow: ellipsis;
          overflow: hidden;
          `}}}
`;l.div`
    height: 2.50em;
    width: 100vw;
    background-color: rgb(255, 255, 255);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1em;
`;l.div`
    max-width: 1000px;
    width: 100%;
    padding: 0 1em;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1em;
`;const Aj=()=>{const[e,n]=m.useState([]),[s,o]=m.useState(!0),r=D(q);return m.useEffect(()=>{if(!r||!r.businessID){o(!1);return}const{businessID:i}=r,a=le($,"businesses",i,"clients"),c=he(a,it("client.name","asc")),d=Te(c,u=>{if(u.empty){n([]),o(!1);return}let p=u.docs.map(h=>h.data());n(p),o(!1)});return()=>{d()}},[r]),{clients:e,loading:s}},rQ=()=>{const[e,n]=m.useState(""),{clients:s}=Aj(),o=$n(s,e);return t.jsxs(m.Fragment,{children:[t.jsx(Ze,{sectionName:"Clientes",searchData:e,setSearchData:n}),t.jsx(iQ,{children:t.jsx(oQ,{clients:o})})]})},iQ=l.div`
    width: 100vw;
    height: calc(100vh - 2.75em);
    background-color: var(--color2);
    display: grid;

    overflow: hidden;
`,aQ=()=>t.jsxs(cQ,{children:[t.jsx(Ze,{sectionName:"Lista de Usuarios"}),t.jsx(pc,{})]}),cQ=l.div`
    height: 100vh;
    overflow: hidden;
    display: grid;
    grid-template-rows: min-content 1fr;
`,lQ=({isOpen:e,handleIsOpen:n,id:s})=>{const o=W(),r=a=>{n(!1),o(_u(a)),o(wm()),o(ID()),o(SD()),o(CD()),o(wm())},i=()=>{n(!1)};return t.jsxs(dQ,{isOpen:e?"true":"false",children:[t.jsx("h1",{children:"¿Quieres Eliminar?"}),t.jsxs($t,{children:[t.jsx(ke,{borderRadius:"normal",title:t.jsx(O,{icon:ec}),width:"icon32",onClick:()=>r(s)}),t.jsx(ke,{title:"Cancelar",borderRadius:"normal",onClick:()=>i()})]})]})},dQ=l.div`
    width: 100%;
    height: 100%;
    background-color: #d32929;
    border-radius: 4px;
    position: absolute;
    top: 0;
    left: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 1em;
    transition: transform 500ms ease-in-out;
    z-index: 20;
    
    h1{
        font-size: 1em;
        margin: 0;
        color: white;
    }
    ${e=>{switch(e.isOpen){case"true":return`
              
                transition: transform 390ms ease-in-out;
                transform: scale(1) translateY(0);
                
                `;case"false":return`
                transition: transform 200ms ease-in-out;
                transform: scale(0) translateY(-200%);
                  
                `}}}
`,uQ=({amountToBuy:e,stock:n,id:s,item:o})=>{const r=W(),[i,a]=m.useState(!1),[c,d]=m.useState(e||1);m.useEffect(()=>{d(e)},[e]);const u=f=>{const x=parseInt(f.target.value,10);o.restrictSaleWithoutStock&&x>n?(alert(`La cantidad solicitada no puede exceder el stock disponible (${n} unidades).`),d(n)):x>0&&(d(x),r(jD({id:s,value:x})))},p=()=>{const f=c+1;o.restrictSaleWithoutStock&&f>n?alert(`No puedes agregar más de ${n} unidades.`):(d(f),r(fD({id:s,value:f})))},h=()=>{if(c>1){const f=c-1;d(f),r(vD({id:s,value:f}))}else a(!0)};return t.jsxs(m.Fragment,{children:[t.jsxs(pQ,{children:[t.jsx(Ag,{onClick:h,children:t.jsx(hQ,{children:"−"})}),t.jsx(mQ,{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:c,onChange:u}),t.jsx(Ag,{onClick:p,disabled:o.restrictSaleWithoutStock&&c>=n,children:t.jsx(gQ,{children:"+"})})]}),t.jsx(lQ,{id:s,isOpen:i,handleIsOpen:a})]})},pQ=l.div`
    display: flex;
    align-items: center;
    background-color: #f5f5f7;
    height: 32px;
    border-radius: 10px;
    overflow: hidden;
    width: 100%;
    border: 1px solid #ddd;
`,Ag=l.button`
    border: none;
    outline: none;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f5f5f5;
    width: 40px;
    height: 100%;
    cursor: pointer;
    transition: background-color 0.2s;
    
    &:hover {
        background-color: #eaeaea;
    }
    
    &:focus {
        outline: none;
    }
    
    &:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
`,mQ=l.input`
    border: none;
    width: 34px;
    height: 100%;
    text-align: center;
    font-size: 14px;
    font-weight: 500;
    outline: none;
    background-color: white;
    color: #333;
    
    &::-webkit-inner-spin-button,
    &::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
`,hQ=l.span`
    font-size: 16px;
    line-height: 1;
    color: #555;
    user-select: none;
`,gQ=l.span`
    font-size: 16px;
    line-height: 1;
    color: #555;
    user-select: none;
`,kg=async(e,n,s)=>{try{if(!e||!n||!s){console.error("Parámetros insuficientes para actualizar o crear la unidad de venta.");return}console.log("user ",e.businessID),console.log("productId ",n),console.log("newSaleUnit ",s);const o=F($,"businesses",e.businessID,"products",n),r=await Se(o);if(!r.exists()){console.error("El producto no existe en la base de datos.");return}const i=r.data().saleUnitsCount||0;s.id=s.id??be();const a=F($,"businesses",e.businessID,"products",n,"saleUnits",s.id);i>0?(await Se(a)).exists()?(console.log("Actualizando la unidad de venta en la base de datos."),await je(a,s)):(console.log("Creando la unidad de venta en la base de datos."),await De(a,s),await je(o,{saleUnitsCount:fn(1)})):(console.log("No existen unidades de venta. Creando la primera unidad de venta en la base de datos."),await De(a,s),await je(o,{saleUnitsCount:fn(1)})),console.log("Unidad de venta actualizada o creada con éxito en la base de datos.")}catch(o){console.error("Error actualizando o creando la unidad de venta: ",o)}},fQ=async(e,n,s)=>{try{if(!e||!n||!s){console.error("Parámetros insuficientes para eliminar la unidad de venta.");return}console.log("user ",e.businessID),console.log("productId ",n),console.log("saleUnitId ",s);const o=F($,"businesses",e.businessID,"products",n,"saleUnits",s);await Ot(o);const r=F($,"businesses",e.businessID,"products",n);await je(r,{saleUnitsCount:fn(-1)}),console.log("Unidad de venta eliminada con éxito de la base de datos.")}catch(o){console.error("Error eliminando la unidad de venta: ",o)}},kj=e=>{const[n,s]=m.useState([]),o=D(q),[r,i]=m.useState(!0),[a,c]=m.useState(null);return m.useEffect(()=>{if(!o||!e){c("Parámetros insuficientes para escuchar las unidades de venta."),i(!1);return}console.log("user ",o.businessID),console.log("productId ",e);const d=le($,"businesses",o.businessID,"products",e,"saleUnits"),u=Te(d,p=>{const h=p.docs.map(f=>({id:f.id,...f.data()}));s(h),i(!1)},p=>{console.error("Error escuchando las unidades de venta: ",p),c(p),i(!1)});return()=>u()},[o,e]),{data:n,loading:r,error:a}};function jo(e,n=!0){const{listPrice:s,avgPrice:o,minPrice:r}=e||{};return[{label:"Precio de Lista",value:s||"N/A",valueWithTax:Fa({pricing:e},n),pricing:e,type:"listPrice",enabled:(e==null?void 0:e.listPriceEnabled)??!0},{label:"Precio Promedio",value:o||"N/A",valueWithTax:Tb({pricing:e},n),type:"avgPrice",pricing:e,enabled:(e==null?void 0:e.avgPriceEnabled)??!0},{label:"Precio Mínimo",value:r||"N/A",valueWithTax:Pb({pricing:e},n),type:"minPrice",pricing:e,enabled:(e==null?void 0:e.minPriceEnabled)??!0}]}const xQ=l.div`
  display: flex;
  flex-direction: column;
  gap: 1.5em;
`,Dl=l.h3`
  font-size: 0.9rem;
  font-weight: 500;
  margin-bottom: 10px;
`,bQ=l.div`
  padding: 10px;
  cursor: pointer;
  border: ${({selected:e})=>e?"2px solid #1890ff":"1px solid #ddd"};
  border-radius: 8px;
  background: ${({selected:e})=>e?"#e6f7ff":"white"};
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: background 0.3s ease;

  &:hover {
    background: #f0f0f0;
  }
`,yQ=l.div`
  padding: 0.6em;
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  background-color: #fafafa;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 0.6em;
`,Tg=l.div`
  padding: 15px;
  cursor: pointer;
  border-radius: 10px;
  border: ${({selected:e})=>e?"2px solid #1890ff":"1px solid #ddd"};
  background: ${({selected:e})=>e?"#e6f7ff":"white"};
  transition: background 0.3s ease;

  display: flex;
  flex-direction: column;
  align-items: flex-start;
  &:hover {
    background: #f0f0f0;
  }
`,vQ=l.div`
  color: #999;
  font-size: 1rem;
  text-align: center;
  margin-top: 10px;
`,jQ=l.div`
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.6em;
`,Pg=l.div`
  padding: 12px;
  background-color: #f0f8ff;
  border: 1px solid #d4edda;
  border-radius: 8px;
  color: #155724;
  font-size: 0.9rem;
  text-align: center;
  margin-bottom: 10px;

  .info-button {
    margin-top: 10px;
  }
`,CQ=({isVisible:e,onClose:n,item:s,onSelectPrice:o,onSelectDefaultUnit:r,onSelectUnit:i})=>{const a=s.id,[c,d]=m.useState(s.defaultSaleUnitId||"default"),[u,p]=m.useState([]),[h,f]=m.useState(null),{data:x}=kj(a),g=Fe(),y=()=>{g("/inventory/items")},b=()=>{var A,P,w,S,E,T;if(c==="default"){const R=jo(s.pricing)||[],N=(A=R.find(oe=>oe.type==="listPrice"))==null?void 0:A.valueWithTax,G=(P=R.find(oe=>oe.type==="avgPrice"))==null?void 0:P.valueWithTax,Q=(w=R.find(oe=>oe.type==="minPrice"))==null?void 0:w.valueWithTax,ae=tt({pricing:s.pricing});return ae===N?"listPrice":ae===G?"avgPrice":ae===Q?"minPrice":"listPrice"}else{const R=x==null?void 0:x.find(Z=>Z.id===c);if(!R)return"listPrice";const N=jo(R.pricing)||[],G=(S=N.find(Z=>Z.type==="listPrice"))==null?void 0:S.valueWithTax,Q=(E=N.find(Z=>Z.type==="avgPrice"))==null?void 0:E.valueWithTax,ae=(T=N.find(Z=>Z.type==="minPrice"))==null?void 0:T.valueWithTax,oe=tt({pricing:R.pricing});return oe===G?"listPrice":oe===Q?"avgPrice":oe===ae?"minPrice":"listPrice"}},v=A=>{const P=b();return A.find(S=>S.type===P)||A.find(S=>S.type==="listPrice")||A[0]},C=A=>{d(A.id),i(A);const P=A.pricing;if(P){const S=jo(P).filter(T=>T.enabled&&T.valueWithTax&&!isNaN(T.valueWithTax)&&T.valueWithTax>0),E=v(S);f(E),E&&o(E)}},I=()=>{d("default"),r(s);const A=s.pricing;if(A){const w=jo(A).filter(E=>E.enabled&&E.valueWithTax&&!isNaN(E.valueWithTax)&&E.valueWithTax>0),S=v(w);f(S),S&&o(S)}},j=A=>{f(A),o(A)};m.useEffect(()=>{var P;if(!e)return;const A=c==="default"?s.pricing:(P=x==null?void 0:x.find(w=>w.id===c))==null?void 0:P.pricing;if(A){const S=jo(A).filter(T=>T.enabled&&T.valueWithTax&&!isNaN(T.valueWithTax)&&T.valueWithTax>0);p(S);const E=v(S);f(E)}},[c,x,s,e]);const k=A=>h?A.type===h.type:!1;return t.jsx(Ce,{open:e,title:"Detalles del Producto",onCancel:n,footer:null,style:{top:10},width:500,children:t.jsxs(xQ,{children:[t.jsxs("div",{children:[t.jsx(Dl,{children:"Unidad por Defecto"}),t.jsx(Tg,{selected:c==="default",onClick:I,children:t.jsxs("div",{children:[t.jsx("p",{children:(s==null?void 0:s.name)||"Unidad por defecto"}),t.jsxs("p",{children:["Precio: ",Y(Fa({pricing:s==null?void 0:s.pricing}))]})]})})]}),t.jsxs("div",{children:[t.jsx(Dl,{children:"Unidades de Venta"}),x&&x.length>0?t.jsx(yQ,{children:x.map(A=>t.jsx(Tg,{selected:A.id===c,onClick:()=>C(A),children:t.jsxs("div",{children:[t.jsx("p",{children:A==null?void 0:A.unitName}),t.jsxs("p",{children:["Precio: ",Y(Fa({pricing:A==null?void 0:A.pricing}))]})]})},A.id))}):t.jsx(vQ,{children:"No hay unidades de venta configuradas."})]}),"        ","        ",t.jsxs("div",{children:[t.jsx(Dl,{children:"Selecciona un Precio"}),"          ",u.length===0?t.jsxs(Pg,{children:["📋 No hay precios configurados para esta unidad. Ve a la configuración del producto para establecer los precios.",t.jsx("div",{className:"info-button",children:t.jsx(U,{type:"primary",size:"small",onClick:y,children:"Ir a Inventario"})})]}):u.length===1?t.jsx(Pg,{children:"Solo hay un precio disponible para esta unidad. Para más opciones de precios, ve a la configuración del producto."}):t.jsx(jQ,{children:u.map((A,P)=>t.jsx(bQ,{selected:k(A),onClick:()=>j(A),children:t.jsxs("span",{children:[A.label,": ",Y(A.valueWithTax)]})},P))})]})]})})},wQ=({item:e,onModalOpen:n})=>{var b,v;const s=W(),{abilities:o,loading:r}=rs(),i=o.can("modify","Price"),a=o.can("read","PriceList"),c=D(os),[d,u]=m.useState(hm(e,c)),[p,h]=m.useState(!1);m.useEffect(()=>{u(hm(e,c))},[e,c]);const f=C=>{const I=C.target.value.replace(/[^0-9.]/g,"");u(I)},x=()=>{if(p&&i){const C=E2(parseFloat(d),e.pricing.tax,c);s(Jb({id:e.id,price:C})),h(!1)}},g=()=>{var C;i&&!((C=e==null?void 0:e.weightDetail)!=null&&C.isSoldByWeight)&&h(!0)},y=()=>{a&&n()};return r?t.jsx(Dg,{children:t.jsx("div",{style:{padding:"8px",textAlign:"center"},children:"Cargando..."})}):t.jsxs(Dg,{children:[t.jsx(SQ,{onClick:y,disabled:!a,title:a?"Ver lista de precios":"No tienes permisos para ver la lista de precios",children:t.jsx(IQ,{children:z.arrows.caretDown})}),t.jsx(EQ,{disabled:!i||((b=e==null?void 0:e.weightDetail)==null?void 0:b.isSoldByWeight),type:"text",value:p?d:Y(d),onChange:f,onBlur:x,onFocus:g,readOnly:!i||((v=e==null?void 0:e.weightDetail)==null?void 0:v.isSoldByWeight),title:i?"":"No tienes permisos para modificar precios"})]})},Dg=l.div`
  display: flex;
  align-items: center;
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  height: 32px;
  width: 100%;
  background-color: #f5f5f7;
`,SQ=l.button`
  border: none;
  background-color: #f5f5f5;
  height: 100%;
  width: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: ${e=>e.disabled?"not-allowed":"pointer"};
  opacity: ${e=>e.disabled?.5:1};
  transition: background-color 0.2s;
  
  &:hover {
    background-color: ${e=>e.disabled?"#f5f5f5":"#eaeaea"};
  }
`,IQ=l.div`
  display: flex;
  align-items: center;
  justify-content: center;
  color: #555;
  
  svg {
    width: 12px;
    height: 12px;
  }
`,EQ=l.input`
  flex: 1;
  height: 100%;
  padding: 0 8px;
  border: none;
  background-color: white;
  font-size: 14px;
  font-weight: 500;
  color: #333;
  outline: none;
  
  &:disabled {
    background-color: #f9f9f9;
    color: #999;
    cursor: not-allowed;
  }
`,AQ=({item:e})=>{var o,r;const n=W(),s=i=>{n(bD({id:e.cid,weight:i.target.value}))};return t.jsxs(kQ,{children:[t.jsx(TQ,{value:`${(o=e==null?void 0:e.weightDetail)==null?void 0:o.weight}`,onChange:s}),t.jsx(PQ,{children:(r=e==null?void 0:e.weightDetail)==null?void 0:r.weightUnit})]})},kQ=l.div`
  display: flex;
  align-items: center;
  gap: 1em;
`,TQ=l.input`
  width: 100%;
  height: 1.8em;
  font-size: 14px;
  font-weight: 600;
  border-radius: 6px;
  padding: 0 10px;
  background-color: var(--White3);
  border: 2px solid var(--Gray4);
  color: var(--Gray6);
  outline: none;
`,PQ=l.span`
  font-size: 14px;
  font-weight: 500;
  color: var(--Gray6);
`,DQ=e=>e===""?"":/^(\d+)?\.?(\d+)?$/.test(e)?e:null,$Q=({item:e})=>{var c,d;const n=W(),[s,o]=m.useState({mode:((c=e.insurance)==null?void 0:c.mode)||"porcentaje",value:(d=e.insurance)==null?void 0:d.value});m.useEffect(()=>{var u,p;o({mode:((u=e.insurance)==null?void 0:u.mode)||"porcentaje",value:(p=e.insurance)==null?void 0:p.value})},[e]);const r=u=>{const p={...s,mode:u};o(p),n(nl({id:e.id,mode:u,value:p.value}))},i=u=>{const p=DQ(u);if(p===null)return;const h={...s,value:p};o(h),n(nl({id:e.id,mode:h.mode,value:h.value}))},a=u=>{let p=u.target.value===""?"":Number(u.target.value);s.mode==="porcentaje"&&(p>100&&(p=100),o({...s,value:p}),n(nl({id:e.id,mode:s.mode,value:p})))};return t.jsxs(RQ,{as:Ie.div,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3},children:[t.jsx(NQ,{children:"Cobertura"}),t.jsxs(OQ,{children:[t.jsx(MQ,{children:t.jsxs(FQ,{onClick:()=>r(s.mode==="porcentaje"?"monto":"porcentaje"),active:s.mode==="monto",children:[t.jsx($g,{position:"left",active:s.mode==="porcentaje",children:"%"}),t.jsx($g,{position:"right",active:s.mode==="monto",children:"$"}),t.jsx(BQ,{as:Ie.div,animate:{x:s.mode==="monto"?24:-2},transition:{type:"spring",stiffness:400,damping:25}})]})}),t.jsx(LQ,{value:s.value,onChange:u=>i(u.target.value),onBlur:a,as:Ie.input,whileFocus:{boxShadow:"0 0 0 2px rgba(37, 99, 235, 0.25)"}})]})]})},RQ=l.div`
  display: inline-flex;
  align-items: center;
  padding: 4px 8px;
  border-radius: 10px;
  background: #f9f9f9;
  border: 1px solid #eaeaea;
  box-shadow: 0 1px 2px rgba(0,0,0,0.03);
  transition: all 0.2s ease;
  
  &:hover {
    box-shadow: 0 2px 4px rgba(0,0,0,0.06);
    border-color: #e0e0e0;
  }
`,NQ=l.span`
  font-size: 12px;
  font-weight: 500;
  color: #666;
  margin-right: 8px;
  white-space: nowrap;
`,OQ=l.div`
  display: flex;
  align-items: center;
  gap: 6px;
`,MQ=l.div`
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
`,FQ=l.div`
  width: 52px;
  height: 28px;
  background-color: #f3f3f3;
  border-radius: 100px;
  border: 1px solid #e0e0e0;
  cursor: pointer;
  display: flex;
  align-items: center;
  position: relative;
  box-shadow: 0 1px 6px rgba(0, 0, 0, 0.151) inset;
  padding: 0 2px;
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  
  &:hover {
    border-color: #d0d0d0;
  }
`,BQ=l.div`
  position: absolute;
  left: 2px;
  width: 24px;
  height: 24px;
  background-color: #ffffff;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  z-index: 2;
`,$g=l.div`
  position: absolute;
  left: ${e=>e.position==="left"?"6px":"34px"};
  color: ${e=>e.active?"black":"#3b3b3b"};
  font-size: 14px;
  font-weight: 500;
  z-index: 3;
  transition: color 0.3s ease;
`,LQ=l.input`
  width: 100%;
  height: 2em;
  border-radius: 10px;
  border: 1px solid #e0e0e0;
  background: white;
  padding: 0 8px;
  text-align: center;
  font-size: 14px;
  color: #333;
  transition: all 0.2s ease;
  
  &:hover, &:focus {
    border-color: #2563eb;
    outline: none;
  }
  
  &:focus {
    box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
  }
  
  &::placeholder {
    color: #aaa;
  }
  
  &::-webkit-outer-spin-button,
  &::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  -moz-appearance: textfield;
`,zQ={initial:{opacity:0,y:-90},animate:{opacity:1,y:0},exit:{opacity:0,y:150,transition:{duration:.5}}},UQ=({item:e,onOpenCommentModal:n,onOpenDeleteModal:s,onOpenDiscountModal:o})=>{var E,T,R;const r=W(),i=cs(),a=D(os),[c,d]=m.useState(null),[u,p]=m.useState([]),[h,f]=m.useState(!1),x=N=>{p(jo(N,a))},g=N=>{d(N);const G=N.pricing;x(G)},y=N=>{const G=N==null?void 0:N.pricing;d(null),x(G)},b=N=>{x(N.pricing);let G;switch(N.type){case"listPrice":G=N.pricing.listPrice;break;case"avgPrice":G=N.pricing.avgPrice;break;case"minPrice":G=N.pricing.minPrice;break;default:G=N.pricing.listPrice}G&&G!=="N/A"&&r(Jb({id:e.id,price:parseFloat(G)})),f(!1)},v=[{key:"discount",label:t.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(i0,{style:{color:e.discount?"#52c41a":"#8c8c8c"}}),e.discount?"Editar descuento":"Aplicar descuento"]}),onClick:()=>o(e)},{key:"comment",label:t.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(Zw,{style:{color:e.comment?"#1890ff":"#8c8c8c"}}),e.comment?"Editar comentario":"Agregar comentario"]}),onClick:()=>n(e)}],C=!!(e.comment||e.discount),I=tt(e,a),j=((E=e.pricing)==null?void 0:E.price)||e.price||0,k=Number((T=e.pricing)==null?void 0:T.tax)||0,A=e.amountToBuy||1,w=(a?j*(1+k/100):j)*A,S=e.discount&&e.discount.value>0;return t.jsxs(WQ,{variants:zQ,initial:"initial",animate:"animate",transition:{duration:.6},children:[t.jsx(Rg,{children:t.jsxs(QQ,{children:["                    ",t.jsxs(VQ,{children:[t.jsx(KQ,{children:e.name}),e.comment&&t.jsx(HQ,{title:e.comment,children:e.comment})]}),t.jsxs(GQ,{children:["                        ",S&&t.jsx(_Q,{children:Y(w)}),t.jsx(JQ,{hasDiscount:S,children:Y(I)})]}),t.jsxs(YQ,{children:[t.jsx(Oe,{title:"Opciones del producto",children:t.jsx(kn,{dot:C,color:e.comment?"#1890ff":e.discount?"#52c41a":"#8c8c8c",offset:[-2,2],children:t.jsx(Qs,{menu:{items:v},trigger:["click"],placement:"bottomRight",children:t.jsx(U,{type:"text",size:"small",icon:t.jsx(lc,{style:{fontSize:"16px",color:C?e.comment?"#1890ff":"#52c41a":"#8c8c8c"}})})})})}),t.jsx(U,{type:"text",size:"small",icon:z.operationModes.discard,onClick:()=>s(e),danger:!0})]})]})}),t.jsx(Rg,{children:t.jsxs(qQ,{children:[t.jsx(wQ,{item:e,onModalOpen:()=>f(!0)}),(R=e==null?void 0:e.weightDetail)!=null&&R.isSoldByWeight?t.jsx(AQ,{item:e}):t.jsx(uQ,{item:e,amountToBuy:e.amountToBuy,stock:e==null?void 0:e.stock,id:e.id,product:e})]})}),i&&t.jsx($Q,{item:e}),t.jsx(CQ,{isVisible:h,onClose:()=>f(!1),prices:u,selectedUnit:c,onSelectDefaultUnit:y,item:e,onSelectPrice:b,onSelectUnit:g})]})},WQ=l(Ie.div)`
    width: 100%;
    height: min-content;
    background-color: #ffffff;
    padding: 0.4em;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    display: grid;
    gap: 0.2em;
    position: relative;
`,Rg=l.div`
    display: grid;
    align-items: center;
`,qQ=l.div`
    display: grid;
    align-items: center;
    gap: 0.4em;
    grid-template-columns: 1fr 120px;
`,VQ=l.div`
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0; // Importante para que el texto se corte correctamente
  flex: 1;
`,GQ=l.div`
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 2px;
  min-width: fit-content;
`,_Q=l.span`
  font-size: 11px;
  color: #8c8c8c;
  text-decoration: line-through;
  line-height: 1;
  font-weight: 400;
`,HQ=l.div`
  color: #8c8c8c;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-left: 2px;
  max-width: calc(100% - 8px); // Dejamos un pequeño margen
  line-height: 1;
`,QQ=l.div`
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto auto;
    gap: 8px;
    align-items: start;
    width: 100%;
`,YQ=l.div`
  display: flex;
  align-items: center;
  gap: 4px;

  button {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 4px;

    &:hover {
      background-color: rgba(0, 0, 0, 0.04);
    }
  }
`,KQ=l.span`
    font-weight: 500;
    line-height: 16px;
    font-size: 14px;
    color: rgb(71, 71, 71);
    text-transform: capitalize;
`,JQ=l.span`
    font-size: 14px;
    font-weight: 600;
    white-space: nowrap;
    padding: 0 10px;
    background-color: var(--White1);
    color: ${e=>e.hasDiscount?"#52c41a":"var(--Gray6)"};
`,Tj=e=>!e||!e.businessID?(console.warn("Usuario o businessID no disponible aún"),null):le($,"businesses",e.businessID,"insuranceBeneficiaries"),XQ=async(e,n,s)=>{try{const o=be(),r=new Date().toISOString(),i=Tj(e);if(!i)return console.warn("No se pudo agregar beneficiario: datos de usuario no disponibles"),null;const a=F(i,o);return await De(a,{id:o,userId:e.uid,clientId:s,...n,createdBy:e.uid,createdAt:r,updatedAt:r,deleted:!1}),o}catch(o){throw console.error("Error adding insurance beneficiary:",o),o}},ZQ=({user:e,clientId:n,callback:s,errorCallback:o})=>{const r=Tj(e);if(!r)return console.warn("No se pudo escuchar beneficiarios: datos de usuario no disponibles"),()=>{};let i=r;return n&&(i=he(r,te("clientId","==",n))),Te(i,a=>{const c=a.docs.map(d=>d.data()).filter(d=>!d.deleted);s(c)},o)},eY=(e,n)=>{const[s,o]=m.useState([]);return m.useEffect(()=>{if(!e)return;const r=ZQ({user:e,clientId:n,callback:i=>o(i),errorCallback:i=>{console.error("Error listening to insurance beneficiaries:",i)}});return()=>r()},[e,n]),s},bt=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),tY=l.div`
  height: 100%;
  display: grid;
  grid-template-rows: min-content 1fr;
  gap: 8px;
  overflow: hidden;
`,nY=l.div`
  display: flex;
  gap: 8px;
  align-items: center;
  padding: 0 1em;
  
  .search-container { flex: 1; }
`,sY=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 12px;
  padding: 0 1em;
  overflow-y: auto;
  align-content: start;
`,oY=l.div`
  background-color: ${e=>e.$isSelected?"#e6f7ff":"white"};
  border: 1px solid ${e=>e.$isSelected?"#1890ff":"#e8e8e8"};
  padding: 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;

  &:hover { box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 4px;
  }

  .actions {
    color: #8c8c8c;
    padding: 4px;
    border-radius: 4px;
    
    &:hover {
      background-color: rgba(0, 0, 0, 0.04);
    }
  }

  .name {
    font-size: 14px;
    font-weight: 500;
    color: #262626;
  }

  .relationship {
    font-size: 12px;
    color: #8c8c8c;
  }
`,rY=l.div`
  border: 1px solid #d9d9d9;
  border-radius: 8px;
  padding: 0.4em 0.6em 0.6em;
  cursor: pointer;
  transition: all 0.2s;

  &:hover {
    border-color: #40a9ff;
  }

  &.empty {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #8c8c8c;
    min-height: 100px;
  }

  .dependent-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 4px;
  }

  .dependent-name {
    font-size: 16px;
    font-weight: 500;
    color: #262626;
  }

  .dependent-details {
    display: flex;

    gap: 0.4em 1.6em;
    font-size: 14px;
    line-height: 1pc;
    color: #595959;
  }

  .detail-item {
    gap: 4px;
  }

  .detail-label {
    color: #40a9ff;
    font-size: 12px;
  }
`,Ng=e=>({child:"Hijo/a",spouse:"Cónyuge",father:"Padre",mother:"Madre",other:"Otro",hijo:"Hijo/a",conyuge:"Cónyuge",padre:"Padre",madre:"Madre",otro:"Otro"})[e]||e,Og=e=>e==="M"?"Masculino":"Femenino",Mg=e=>{if(!e)return"N/A";try{const n=ce.fromISO(e),o=ce.now().diff(n,"years");return Math.floor(o.years)}catch(n){return console.error("Error calculating age:",n),"N/A"}},iY=({dependents:e=[],selectedDependent:n,onSelectDependent:s,onAddDependent:o,onEditDependent:r,validateStatus:i,help:a})=>{const[c,d]=m.useState(!1),[u,p]=m.useState(""),h=m.useRef(null);m.useEffect(()=>{c&&h.current&&setTimeout(()=>{h.current.focus()},100)},[c]);const f=u?e.filter(I=>bt(I.name).includes(bt(u))):e,x=I=>{s==null||s(I),d(!1),p("")},g=(I,j)=>{if(!I.target.closest(".dropdown-container")){if((n==null?void 0:n.id)===j.id)return;x(j)}},y=(I,j)=>{I.stopPropagation(),r==null||r(j),d(!1)},b=I=>[{key:"edit",label:"Editar",icon:t.jsx(es,{}),onClick:j=>y(j,I)}],v=I=>{I.preventDefault(),I.stopPropagation(),s==null||s(null)},C=I=>I?new Date(I).toLocaleDateString("es-ES"):"N/A";return t.jsxs(M.Item,{label:"Dependiente",required:!1,validateStatus:i,help:a,children:[t.jsx(rY,{className:n?"":"empty",onClick:()=>d(!0),children:n?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"dependent-header",children:[t.jsx("span",{className:"dependent-name",children:n.name}),t.jsx(Qr,{onClick:v,style:{cursor:"pointer",color:"#8c8c8c"}})]}),t.jsxs("div",{className:"dependent-details",children:[t.jsxs("div",{className:"detail-item",children:[t.jsx("div",{className:"detail-label",children:"Parentesco:"}),Ng(n.relationship)]}),t.jsxs("div",{className:"detail-item",children:[t.jsx("div",{className:"detail-label",children:"Género:"}),Og(n.gender)]}),t.jsxs("div",{className:"detail-item",children:[t.jsx("div",{className:"detail-label",children:"Edad:"}),Mg(n.birthDate)," años"]}),t.jsxs("div",{className:"detail-item",children:[t.jsx("div",{className:"detail-label",children:"Fecha de nacimiento:"}),C(n.birthDate)]})]})]}):t.jsxs("div",{children:[t.jsx(Jn,{style:{marginRight:8}}),"Seleccionar Dependiente (Opcional)"]})}),t.jsx(Rt,{title:"Lista de Dependientes",placement:"bottom",onClose:()=>{d(!1),p("")},open:c,height:"80%",styles:{body:{padding:"1em"}},children:t.jsxs(tY,{children:[t.jsxs(nY,{children:[t.jsx("div",{className:"search-container",children:t.jsx(ie,{ref:h,placeholder:"Buscar dependientes...",value:u,onChange:I=>p(I.target.value)})}),t.jsx(Oe,{title:"Agregar dependiente",children:t.jsx(U,{type:"primary",icon:t.jsx(Jn,{}),onClick:o,children:"Dependiente"})})]}),t.jsx(sY,{children:f.length>0?f.map(I=>t.jsxs(oY,{onClick:j=>g(j,I),$isSelected:(n==null?void 0:n.id)===I.id,children:[t.jsxs("div",{className:"card-header",children:[t.jsx("div",{className:"name",children:I.name}),t.jsx("div",{className:"dropdown-container",onClick:j=>j.stopPropagation(),children:t.jsx(Qs,{menu:{items:b(I)},trigger:["click"],children:t.jsx(U,{type:"text",className:"actions",icon:t.jsx(lc,{})})})})]}),t.jsxs("div",{className:"relationship",children:[Ng(I.relationship)," • ",Og(I.gender)," • ",Mg(I.birthDate)," años"]})]},I.id)):t.jsxs("div",{style:{gridColumn:"1 / -1",textAlign:"center",padding:"20px",color:"#8c8c8c"},children:["No se encontraron dependientes",u&&` que coincidan con "${u}"`]})})]})})]})},aY=({form:e})=>{var y;const n=D(q),s=D(Ht),[o,r]=m.useState(!1),[i]=M.useForm(),[a,c]=m.useState(!1),[d,u]=m.useState(null),p=eY(n,s.id),h=b=>b&&b>new Date;m.useEffect(()=>{const b=e.getFieldValue("dependentId");if(b){const v=p.find(C=>C.id===b);u(v||null)}else u(null)},[e,p]);const f=async()=>{try{c(!0);const b=await i.validateFields(),v={name:b.name,gender:b.gender,birthDate:b.birthDate?b.birthDate.toISOString():null,relationship:b.relationship};await XQ(n,v,s==null?void 0:s.id),V.success("Dependiente agregado exitosamente"),r(!1),i.resetFields()}catch(b){console.error("Error al agregar dependiente:",b),V.error("Error al agregar dependiente")}finally{c(!1)}},x=b=>{console.log("Editar dependiente:",b)},g=b=>{b?(e.setFieldsValue({dependentId:b.id,hasDependent:!0}),u(b)):(e.setFieldsValue({dependentId:null,hasDependent:!1}),u(null))};return t.jsxs(t.Fragment,{children:[t.jsx(M.Item,{label:"Para dependiente",name:"dependentId",rules:[{required:!1,message:"Por favor seleccione un dependiente si aplica"}],hidden:!0}),t.jsx(iY,{dependents:p,selectedDependent:d,onSelectDependent:g,onAddDependent:()=>r(!0),onEditDependent:x,validateStatus:e.getFieldError("dependentId")?"error":"",help:(y=e.getFieldError("dependentId"))==null?void 0:y[0]}),t.jsx(Ce,{title:"Nuevo Dependiente",open:o,onCancel:()=>{r(!1),i.resetFields()},onOk:f,confirmLoading:a,children:t.jsxs(M,{form:i,layout:"vertical",children:[t.jsx(M.Item,{name:"name",label:"Nombre",rules:[{required:!0,message:"Por favor ingrese el nombre"}],children:t.jsx(ie,{autoComplete:"off"})}),t.jsx(M.Item,{name:"birthDate",label:"Fecha de Nacimiento",rules:[{required:!0,message:"Por favor seleccione la fecha de nacimiento"}],children:t.jsx(yt,{style:{width:"100%"},autoComplete:"off",format:"DD/MM/YYYY",disabledDate:h})}),t.jsx(M.Item,{name:"relationship",label:"Parentesco",rules:[{required:!0,message:"Por favor seleccione el parentesco"}],children:t.jsxs(ge,{placeholder:"Seleccione el parentesco",children:[t.jsx(ge.Option,{value:"child",children:"Hijo/a"}),t.jsx(ge.Option,{value:"spouse",children:"Cónyuge"}),t.jsx(ge.Option,{value:"father",children:"Padre"}),t.jsx(ge.Option,{value:"mother",children:"Madre"}),t.jsx(ge.Option,{value:"other",children:"Otro"})]})}),t.jsx(M.Item,{name:"gender",label:"Sexo",rules:[{required:!0,message:"Por favor seleccione el sexo"}],children:t.jsxs(Cs.Group,{children:[t.jsx(Cs,{value:"M",children:"Masculino"}),t.jsx(Cs,{value:"F",children:"Femenino"})]})})]})})]})},cY=l.div`
  max-height: 300px;
  overflow-y: auto;
`,lY=l.div`
  display: flex;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #f0f0f0;
  
  &:hover {
    background-color: #f5f5f5;
  }
`,dY=l.div`
  flex: 1;
  margin-left: 10px;
`;l.span`
  color: #888;
  font-size: 12px;
  margin-left: 10px;
`;const uY=l.button`
  background: none;
  border: none;
  color: #ff4d4f;
  cursor: pointer;
  padding: 5px;
  
  &:hover {
    color: #cf1322;
  }
`,Fg=l(Ge)`
  margin-left: 8px;
  font-size: 11px;
`,pY=l.div`
  margin-bottom: 16px;
`,mY=l.button`
  background: none;
  border: none;
  color: #1890ff;
  cursor: pointer;
  padding: 5px;
  margin-right: 8px;
  
  &:hover {
    color: #40a9ff;
  }
`,hY=l.h4`
  margin: 12px 0;
  color: #666;
  font-weight: 500;
`,gY=l.span`
  margin-right: 8px;
  font-size: 16px;
  display: flex;
  align-items: center;
`,xp=({files:e=[],removeFile:n,handlePreview:s,fileTypeLabels:o={}})=>{const r=u=>({document:"default",receipts:"green",invoices:"blue",others:"orange",imagen:"purple",pdf:"red"})[u==null?void 0:u.toLowerCase()]||"default",i=u=>{const p=u.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif"].includes(p)},a=u=>u.split(".").pop().toLowerCase()==="pdf",c=m.useMemo(()=>{const u={};return e==null||e.forEach(p=>{var f;const h=((f=p.type)==null?void 0:f.toLowerCase())||"document";u[h]||(u[h]={title:o[h]||h.charAt(0).toUpperCase()+h.slice(1),files:[]}),u[h].files.push(p)}),Object.entries(u)},[e,o]),d=u=>t.jsxs(lY,{children:[t.jsx(gY,{children:i(u.name)?t.jsx(ts,{style:{color:"#52c41a"}}):a(u.name)?t.jsx(ns,{style:{color:"#ff4d4f"}}):t.jsx(no,{})}),t.jsxs(dY,{children:[t.jsx(Oe,{title:u.name,children:u.name}),t.jsx(Fg,{color:r(u.type),children:u.type}),t.jsx(Fg,{color:u.url?"purple":"blue",children:u.url?"Remoto":"Local"})]}),t.jsxs("div",{children:[(i(u.name)||a(u.name))&&t.jsx(mY,{onClick:()=>s(u),children:t.jsx(zo,{})}),n&&t.jsx(uY,{onClick:()=>n(u.id||u.url),children:t.jsx(ht,{})})]})]},u.id||u.url);return e!=null&&e.length?t.jsx(cY,{children:c.map(([u,p])=>t.jsxs(pY,{children:[t.jsx(hY,{children:p.title}),p.files.map(d)]},u))}):t.jsx(Lt,{description:"No hay archivos adjuntos"})};xp.defaultProps={files:[],removeFile:()=>{},handlePreview:()=>{},fileTypeLabels:{}};const fY=sn`
  from { opacity: 0; }
  to { opacity: 1; }
`,xY=sn`
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
`,bY=l.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  visibility: ${e=>e.isDragging?"visible":"hidden"};
  opacity: ${e=>e.isDragging?1:0};
  transition: all 0.3s ease-in-out;
  animation: ${fY} 0.3s ease-in-out;
`,yY=l.div`
  background: rgba(255, 255, 255, 0.95);
  padding: 48px 64px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  transform: scale(${e=>e.isDragging?"1.02":"1"});
  transition: transform 0.2s ease-in-out;

  .icon-wrapper {
    animation: ${xY} 2s infinite ease-in-out;
    margin-bottom: 20px;
  }

  h3 {
    margin: 16px 0;
    color: #1890ff;
    font-size: 24px;
    font-weight: 600;
  }

  p {
    color: #666;
    font-size: 16px;
    margin: 8px 0;
  }
`,vY=e=>{switch(e.toLowerCase()){case"imagen":return t.jsx(ts,{style:{fontSize:56,color:"#1890ff"}});case"pdf":return t.jsx(ns,{style:{fontSize:56,color:"#1890ff"}});default:return t.jsx(ss,{style:{fontSize:56,color:"#1890ff"}})}},jY=({isDragging:e,onDrop:n,onDragOver:s,onDragLeave:o,fileType:r})=>t.jsx(bY,{isDragging:e,onDrop:n,onDragOver:s,onDragLeave:o,children:t.jsxs(yY,{isDragging:e,children:[t.jsx("div",{className:"icon-wrapper",children:vY(r)}),t.jsx("h3",{children:"Arrastra y suelta tus archivos aquí"}),t.jsxs("p",{children:["Suelta los archivos para agregarlos como ",r]})]})}),CY=l.div`
  max-width: 100%;
  height: 100%;
`,wY=l.div`
  height: 100%;
  margin: 0;
  padding: 0;
  width: 100%;
  
  embed {
    width: 100%;
    height: 100%;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 4px;
  }
`,Bg=l.div`
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
`,Lg=l.div`
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
`,SY=({previewFile:e,previewVisible:n,setPreviewVisible:s,setPreviewFile:o})=>{const[r,i]=m.useState(!1),[a,c]=m.useState(null),[d,u]=m.useState(0),p=m.useCallback(()=>{i(!1),u(0)},[]),h=m.useCallback(()=>{d<2?(u(x=>x+1),setTimeout(()=>i(!0),1e3)):(i(!1),c("No se pudo cargar el PDF. Por favor, verifique su conexión o intente abrirlo en una nueva pestaña."))},[d]),f=()=>{if(!e)return null;const x=e.name.split(".").pop().toLowerCase(),g=e.url||e.preview||e.file&&URL.createObjectURL(e.file);return["jpg","jpeg","png","gif"].includes(x)?t.jsxs(t.Fragment,{children:[t.jsx(Lg,{role:"status","aria-live":"polite",children:r?"Cargando imagen...":a||"Imagen cargada"}),t.jsx(Lo,{src:g,alt:e.name,style:{maxWidth:"100%",height:"auto"},placeholder:t.jsx(Bg,{children:t.jsx(He,{size:"large",tip:"Cargando imagen..."})}),onError:()=>c("No se pudo cargar la imagen. Verifique su conexión o permisos de acceso.")})]}):x==="pdf"?t.jsxs(wY,{children:[t.jsx(Lg,{role:"status","aria-live":"polite",children:r?"Cargando PDF...":a||"PDF cargado"}),r&&t.jsx(Bg,{children:t.jsx(He,{size:"large",tip:`Cargando PDF${d>0?` (intento ${d+1}/3)`:""}`})}),t.jsx("embed",{src:`${g}#toolbar=1&navpanes=1&scrollbar=1&zoom=100`,type:"application/pdf",style:{display:r?"none":"block"},onLoad:p,onError:h}),a&&t.jsx(Pt,{message:"Error al cargar el PDF",description:t.jsxs(t.Fragment,{children:[a,t.jsx("br",{}),t.jsx("a",{href:g,target:"_blank",rel:"noopener noreferrer",children:"Abrir en nueva pestaña"})]}),type:"error",showIcon:!0,style:{margin:"20px"}})]}):t.jsx("p",{children:"No hay vista previa disponible para este tipo de archivo"})};return m.useEffect(()=>{let x;return e&&(i(!0),c(null),e.file instanceof File&&(x=URL.createObjectURL(e.file))),()=>{x&&URL.revokeObjectURL(x),c(null),i(!1)}},[e]),t.jsx(Rt,{open:n,onClose:()=>{s(!1),o(null),u(0)},width:window.innerWidth<=768?"100%":"80%",height:"100%",title:e==null?void 0:e.name,placement:window.innerWidth<=768?"right":"bottom",footer:null,styles:{content:{height:"100%",padding:0,margin:0},body:{padding:"0",margin:"0",height:"100%",overflow:"hidden"}},children:t.jsx(CY,{children:f()})})},IY=({lightboxOpen:e,setLightboxOpen:n,lightboxIndex:s,setLightboxIndex:o,getImageFiles:r})=>t.jsx(mc,{open:e,close:()=>n(!1),index:s,slides:r(),plugins:[hc,gc,fc],carousel:{spacing:0,padding:0,imageFit:"contain"},zoom:{wheelZoomDistanceFactor:100,pinchZoomDistanceFactor:100,scrollToZoom:!0},thumbnails:{position:"bottom",width:120,height:80,gap:2,padding:5},captions:{showToggle:!0,descriptionTextAlign:"left"}}),EY=l.button`
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border: 1px solid #d9d9d9;
  border-radius: 6px;
  background: white;
  cursor: pointer;
  transition: all 0.3s;

  &:hover {
    border-color: #1890ff;
    color: #1890ff;
  }
`,AY=({onFileInput:e,buttonText:n="Cargar",acceptedFileTypes:s=null})=>t.jsxs(t.Fragment,{children:[t.jsxs(EY,{onClick:()=>document.getElementById("fileInput").click(),children:[t.jsx(ss,{}),n]}),t.jsx("input",{id:"fileInput",type:"file",multiple:!0,onChange:e,accept:s,style:{display:"none"}})]}),{Option:kY}=ge,TY=({fileType:e,setFileType:n,handleFileInput:s,fileTypes:o=[],fileTypeLabels:r={},title:i="Adjuntar archivo",acceptedFileTypes:a=null,compact:c=!1,alwaysShowTypeSelector:d=!1})=>s?t.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[(o.length>1||d)&&t.jsx(M.Item,{label:"",style:{marginBottom:0},children:t.jsx(ge,{value:e,style:{width:120},onChange:u=>n(u),children:o.map(u=>t.jsx(kY,{value:u,children:r[u]||u},u))})}),t.jsx(M.Item,{label:c?null:i,style:{marginBottom:0},children:t.jsx(AY,{onFileInput:s,acceptedFileTypes:a,buttonText:c?i:"Cargar"})})]}):null,PY=({open:e,onClose:n,files:s,removeFile:o,handlePreview:r,fileTypeLabels:i,title:a="Archivos adjuntos"})=>t.jsx(Rt,{title:a,placement:"bottom",onClose:n,open:e,width:520,children:t.jsx(xp,{files:s,removeFile:o,handlePreview:r,fileTypeLabels:i})}),DY=({files:e=[],attachmentUrls:n=[],onAddFiles:s=null,onRemoveFiles:o=null,showFileList:r=!0,defaultFileType:i="document",fileTypes:a=["document"],fileTypeLabels:c={document:"Documento"},maxFiles:d=null,acceptedFileTypes:u=null,uploaderTitle:p="Subir archivos",successMessage:h="{count} archivo(s) agregado(s)",errorMaxFilesMessage:f="Solo puede subir un máximo de {max} archivos",errorFileTypeMessage:x="Tipo(s) de archivo no permitido(s): {files}",compact:g=!1,alwaysShowTypeSelector:y=!1,inlineLayout:b=!1})=>{const[v,C]=m.useState(i),[I,j]=m.useState(!1),[k,A]=m.useState(null),[P,w]=m.useState(!1),[S,E]=m.useState(!1),[T,R]=m.useState(0),[N,G]=m.useState(!1);m.useEffect(()=>{const ee=B=>{B.preventDefault(),j(!0)},K=B=>{B.preventDefault(),B.relatedTarget===null&&j(!1)};return window.addEventListener("dragenter",ee),window.addEventListener("dragleave",K),()=>{window.removeEventListener("dragenter",ee),window.removeEventListener("dragleave",K)}},[]);const Q=ee=>{ee.preventDefault(),j(!1);const K=Array.from(ee.dataTransfer.files);oe(K)},ae=ee=>{const K=Array.from(ee.target.files);oe(K)},oe=ee=>{if(d&&e.length+ee.length>d){V.error(f.replace("{max}",d));return}if(u){const B=u.split(","),_=ee.filter(L=>{const H="."+L.name.split(".").pop().toLowerCase();return!B.includes(H)});if(_.length>0&&(V.error(x.replace("{files}",_.map(L=>L.name).join(", "))),ee=ee.filter(L=>{const H="."+L.name.split(".").pop().toLowerCase();return B.includes(H)}),ee.length===0))return}const K=ee.map(B=>({file:B,type:v,id:Math.random().toString(36).substr(2,9),name:B.name,isLocal:!0}));s&&(s(K),V.success(h.replace("{count}",ee.length)))},Z=ee=>{o&&o(ee)},J=m.useCallback(()=>{const ee=[];return e.forEach(K=>{Vt(K.name)&&ee.push({src:nn(K.file),title:K.name,description:`Tipo: ${K.type}`})}),n.filter(K=>{var B;return(B=K.url)==null?void 0:B.includes("firebasestorage.googleapis.com")}).forEach(K=>{Vt(K.name)&&ee.push({src:K.url,title:K.name,description:`Tipo: ${K.type}`})}),ee},[e,n]),X=m.useMemo(()=>{const ee=(e||[]).map(B=>({...B,isLocal:!0,preview:B.file?nn(B.file):null})),K=(n||[]).filter(B=>{var _;return(_=B.url)==null?void 0:_.includes("firebasestorage.googleapis.com")}).map(B=>({id:B.id||Math.random().toString(36).substr(2,9),name:B.name||"Archivo sin nombre",type:B.type||Nc(B.url),url:B.url,isLocal:!1}));return[...ee,...K]},[e,n]);m.useEffect(()=>()=>{X.filter(ee=>ee.isLocal&&ee.preview).forEach(ee=>{Rc(ee.preview)})},[X]);const me=m.useCallback(ee=>{if(!ee)return;const K=Vt(ee.name),B=di(ee.name);if(K){const L=J().findIndex(H=>H.title===ee.name&&H.src===(ee.url||ee.file&&nn(ee.file)));R(Math.max(0,L)),E(!0)}else B&&(A(ee),w(!0))},[J]),fe=()=>r?g?t.jsx(PY,{open:N,onClose:()=>G(!1),files:X,removeFile:o?Z:null,handlePreview:me,fileTypeLabels:c,title:`${X.length} Archivo${X.length!==1?"s":""} adjunto${X.length!==1?"s":""}`}):t.jsx(xp,{files:X,removeFile:o?Z:null,handlePreview:me,fileTypeLabels:c}):null,se=()=>{if(!g||!r)return null;const ee=X.length,K=()=>{G(!0)};return t.jsx(kn,{count:ee,style:{marginLeft:8},children:t.jsx(U,{icon:t.jsx(no,{}),onClick:K,disabled:ee===0,children:"Ver archivos"})})};return t.jsxs("div",{style:b?{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}:{},children:[s&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1em"},children:[t.jsx(TY,{fileType:v,setFileType:C,handleFileInput:ae,fileTypes:a,fileTypeLabels:c,title:p,acceptedFileTypes:u,compact:g||b,alwaysShowTypeSelector:y}),se()]}),fe(),t.jsx(SY,{previewFile:k,previewVisible:P,setPreviewVisible:w,setPreviewFile:A}),t.jsx(IY,{lightboxOpen:S,setLightboxOpen:E,lightboxIndex:T,setLightboxIndex:R,getImageFiles:J}),t.jsx(jY,{isDragging:I,onDrop:Q,onDragOver:ee=>ee.preventDefault(),onDragLeave:ee=>{ee.preventDefault(),ee.relatedTarget===null&&j(!1)},fileType:v})]})},go=l.div`
  display: flex;
  gap: 16px;
  margin-bottom: 24px;
`,xn=l.div`
  flex: 1;
`,$Y=l.div`
  padding: 10px 0 0;
  margin-bottom: 20px;
  /* border-bottom: 1px solid #eaeaea; */
  display: flex;
  align-items: center;
  
  .icon-container {
    width: 32px;
    height: 32px;
    border-radius: 4px;
    background-color: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
  }
  
  .icon {
    font-size: 16px;
    color: #666;
  }
  
  .client-info {
    display: flex;
    flex-direction: column;
  }
  
  .label {
    font-size: 12px;
    color: #8c8c8c;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 2px;
  }
  
  .client-name {
    font-size: 16px;
    font-weight: 500;
    color: #262626;
  }
`,RY=l.div`
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
`,$l=l.h3`
  font-size: 16px;
  color: #262626;
  margin-top: 10px;
  margin-bottom: 16px;
  padding-bottom: 8px;
  border-bottom: 1px solid #f0f0f0;
`,NY=()=>{const{open:e}=D(lD),n=D(Ac),s=D(cD),o=D(q),r=D(Ht),i=cs(),a=W(),[c]=M.useForm(),[d,u]=m.useState(!1),[p,h]=m.useState(!1),[f,x]=m.useState(!1),[g,y]=m.useState(!1),[b,v]=m.useState(null),[C,I]=m.useState(null),[j,k]=m.useState([]),{data:A,loading:P}=gj(),w=m.useCallback(se=>!A||!se?null:A.find(ee=>ee.id===se)||null,[A]);m.useCallback(se=>!(C!=null&&C.insuranceTypes)||!se?null:C.insuranceTypes.find(ee=>ee.id===se)||null,[C]),m.useEffect(()=>{const se=w(b);I(se)},[b,w]);const S=m.useMemo(()=>C!=null&&C.insuranceTypes?C.insuranceTypes:[],[C]),E=m.useCallback(async(se,ee)=>{if(!(!(r!=null&&r.id)||!o))try{let K=ee;se==="birthDate"&&ee instanceof We&&(K=ee.toISOString());const B={clientId:r.id,[se]:K};if(se!=="insuranceId"&&n.insuranceId&&(B.insuranceId=n.insuranceId),se!=="insuranceType"&&n.insuranceType&&(B.insuranceType=n.insuranceType),se!=="birthDate"&&n.birthDate&&(B.birthDate=n.birthDate instanceof We?n.birthDate.toISOString():n.birthDate),n.clientInsuranceId)await bm(o,{id:n.clientInsuranceId,...B});else{const _=await xm(o,B)}a(gs({insuranceId:n.insuranceId})),a(iD({field:se,value:K}))}catch(K){console.error("Error saving specific insurance field:",K),V.error("No se pudo guardar el campo de seguro")}},[r==null?void 0:r.id,o,n.insuranceId,n.insuranceType,n.birthDate,n.clientInsuranceId,a]),T=se=>{v(se),c.setFieldValue("insuranceType",void 0),E("insuranceId",se)},R=se=>{E("insuranceType",se)},N=se=>{se&&E("birthDate",se)},G=m.useCallback(()=>{if(!i)return y(!1),!1;try{const se=c.getFieldsValue(),K=["insuranceId","insuranceType","affiliateNumber","authNumber","doctor","specialty","indicationDate"].every(B=>{const _=se[B];return _!=null&&_!==""});return y(K),K}catch(se){return console.error("Error validando completitud del formulario:",se),!1}},[c,i]),Q=m.useCallback(se=>{G()},[G]);m.useEffect(()=>{n&&setTimeout(()=>G(),300)},[n,G]),m.useEffect(()=>{e&&(r!=null&&r.id)&&o&&!(n!=null&&n.clientId)&&a(xa({user:o,clientId:r.id}))},[e,r==null?void 0:r.id,o,n==null?void 0:n.clientId,a]),m.useEffect(()=>{if(e){const se=n||{};se.insuranceId&&v(se.insuranceId);const ee={...se};ee.birthDate&&(ee.birthDate=We(ee.birthDate)),ee.indicationDate&&(ee.indicationDate=We(ee.indicationDate)),c.setFieldsValue(ee),u(se.hasDependent||!1),setTimeout(()=>G(),300)}},[e,n,c,G]);const ae=se=>se&&se>We(),oe=se=>{k(K=>[...K,...se]);const ee=c.getFieldValue("prescription")||[];c.setFieldValue("prescription",[...ee,...se]),G()},Z=se=>{k(K=>K.filter(B=>B.id!==se));const ee=c.getFieldValue("prescription")||[];c.setFieldValue("prescription",ee.filter(K=>K.id!==se)),G()};m.useEffect(()=>{if(e&&(n!=null&&n.prescription)){const se=Array.isArray(n.prescription)?n.prescription:[n.prescription];k(se.map(ee=>({...ee,id:ee.id||Math.random().toString(36).substr(2,9),name:ee.name||ee.file&&ee.file.name||"Archivo de receta"})))}else k([])},[e,n==null?void 0:n.prescription]);const J=()=>{a(ym())},X=async()=>{try{x(!0);const se=await c.validateFields(),ee={...se,birthDate:se.birthDate?se.birthDate.toISOString():null,indicationDate:se.indicationDate?se.indicationDate.toISOString():null,prescription:j};if(a(Md(ee)),r!=null&&r.id)try{const K=await qu(o,r.id),B={clientId:r.id,insuranceId:ee.insuranceId,insuranceType:ee.insuranceType,birthDate:ee.birthDate};let _=!1;if(K?K.insuranceId!==B.insuranceId||K.insuranceType!==B.insuranceType||K.birthDate!==B.birthDate?_=await bm(o,{id:K.id,...B}):_=!0:_=await xm(o,B),_)V.success("Datos de seguro guardados exitosamente");else{V.error("Error al guardar los datos de seguro"),x(!1);return}}catch(K){console.error("Error al guardar datos de seguro:",K),V.error(K.message||"Error al guardar los datos de seguro"),x(!1);return}else V.warning("No se puede guardar la autorización sin un cliente seleccionado");a(ym())}catch(se){console.error("Validation failed:",se)}finally{x(!1)}},me=!i,fe=!i||i&&!g;return t.jsxs(Ce,{title:"Autorización de Seguro",open:e,onCancel:J,onOk:X,okButtonProps:{loading:f,disabled:fe},style:{top:20},width:800,destroyOnHidden:!0,children:[t.jsxs($Y,{children:[t.jsx("div",{className:"icon-container",children:t.jsx(dc,{className:"icon"})}),t.jsxs("div",{className:"client-info",children:[t.jsx("span",{className:"label",children:"Cliente"}),t.jsx("span",{className:"client-name",children:(r==null?void 0:r.name)||"Sin cliente seleccionado"})]})]}),!i&&t.jsxs("div",{style:{marginBottom:"20px",padding:"10px",backgroundColor:"#fffbe6",border:"1px solid #ffe58f",borderRadius:"4px"},children:[t.jsx("strong",{children:"Seguro no disponible:"})," El seguro no está habilitado. Verifique su tipo de negocio o active el seguro en la configuración."]}),s?t.jsx(RY,{children:t.jsx(He,{tip:"Cargando datos de autorización..."})}):t.jsxs(M,{form:c,layout:"vertical",disabled:me,onValuesChange:Q,children:[t.jsx($l,{children:"Información del Seguro"}),t.jsxs(go,{children:[t.jsx(xn,{children:t.jsx(M.Item,{name:"insuranceId",label:"Aseguradora",rules:[{required:!0,message:"Por favor seleccione la aseguradora"}],children:t.jsx(ge,{placeholder:"Seleccione la aseguradora",loading:P,onChange:T,optionLabelProp:"label",children:A==null?void 0:A.map(se=>t.jsx(ge.Option,{value:se.id,label:se.insuranceCompanyName,children:se.insuranceCompanyName},se.id))})})}),t.jsx(xn,{children:t.jsx(M.Item,{name:"insuranceType",label:"Tipo de Seguro",rules:[{required:!0,message:"Por favor seleccione el tipo de seguro"}],children:t.jsx(ge,{placeholder:"Seleccione el tipo de seguro",disabled:!b||me,optionLabelProp:"label",onChange:R,children:S.map(se=>t.jsx(ge.Option,{value:se.id,label:se.type,children:se.type},se.id))})})})]}),t.jsxs(go,{children:[t.jsx(xn,{children:t.jsx(M.Item,{name:"affiliateNumber",label:"Número de Afiliado",rules:[{required:!0,message:"Por favor ingrese el número de afiliado"}],children:t.jsx(ie,{placeholder:"Ingrese el número de afiliado",autoComplete:"off"})})}),t.jsx(xn,{children:t.jsx(M.Item,{name:"authNumber",label:"Número de Autorización",rules:[{required:!0,message:"Por favor ingrese el número de autorización"}],children:t.jsx(ie,{placeholder:"Número de autorización",autoComplete:"off"})})})]}),t.jsxs(go,{children:[t.jsx(xn,{children:t.jsx(M.Item,{name:"doctor",label:"Médico",rules:[{required:!0,message:"Por favor ingrese el nombre del médico"}],children:t.jsx(ie,{placeholder:"Nombre del médico",autoComplete:"off"})})}),t.jsx(xn,{children:t.jsx(M.Item,{name:"specialty",label:"Especialidad del Médico",rules:[{required:!0,message:"Por favor ingrese la especialidad del médico"}],children:t.jsx(ie,{placeholder:"Especialidad del médico",autoComplete:"off"})})})]}),t.jsxs(go,{children:[t.jsx(xn,{children:t.jsx(M.Item,{name:"indicationDate",label:"Fecha de Indicación",rules:[{required:!0,message:"Por favor seleccione la fecha de indicación"}],children:t.jsx(yt,{style:{width:"100%"},autoComplete:"off",format:"DD/MM/YYYY",disabledDate:ae})})}),t.jsx(xn,{})]}),t.jsx(go,{children:t.jsx(xn,{children:t.jsx(M.Item,{name:"prescription",label:"Receta",children:t.jsx(DY,{files:j,onAddFiles:oe,onRemoveFiles:Z,defaultFileType:"prescription",fileTypes:["prescription","document","identification","insurance"],fileTypeLabels:{prescription:"Receta",document:"Documento",identification:"Identificación",insurance:"Seguro"},acceptedFileTypes:".pdf,.jpg,.jpeg,.png",uploaderTitle:"cargar",successMessage:"Archivo de receta agregado",showFileList:!0,maxFiles:3,compact:!0,alwaysShowTypeSelector:!0,inlineLayout:!0})})})}),t.jsx($l,{children:"Información del Cliente"}),t.jsx(go,{children:t.jsx(xn,{children:t.jsx(M.Item,{name:"birthDate",label:"Fecha de Nacimiento",rules:[{required:!1,message:"Por favor seleccione la fecha de nacimiento"}],children:t.jsx(yt,{style:{width:"100%"},autoComplete:"off",format:"DD/MM/YYYY",disabledDate:ae,onChange:N})})})}),t.jsx($l,{children:"Información del Dependiente (opcional)"}),t.jsx(aY,{form:c,hasDependent:d,onDependentChange:u})]})]})},OY=()=>{const e=W(),n=D(q),s=D(Ht),o=D(Ac),r=D(ep),[i,a]=m.useState(null);if(m.useEffect(()=>{const p=async()=>{if(s!=null&&s.id){const h=await qu(n,s.id);h&&(a(h),e(Md({insuranceId:h.insuranceId,insuranceType:h.insuranceType,birthDate:h.birthDate})))}};s!=null&&s.id&&p()},[s,n,e]),!s)return null;const c=()=>{e(aD({initialValues:{clientId:s==null?void 0:s.id,insuranceId:(i==null?void 0:i.insuranceId)||(o==null?void 0:o.insuranceId),insuranceType:(i==null?void 0:i.insuranceType)||(o==null?void 0:o.insuranceType),birthDate:(i==null?void 0:i.birthDate)||(o==null?void 0:o.birthDate)}}))},d=p=>{e(ja({recurrence:p.target.checked}))},u=p=>{e(Md({authNumber:p.target.value.trim()}))};return t.jsxs(MY,{children:[t.jsx(zg,{children:t.jsx(FY,{checked:r==null?void 0:r.recurrence,onChange:d,children:"Guardar recurrencia de seguro"})}),t.jsx(zg,{children:t.jsxs(BY,{children:[t.jsx(LY,{placeholder:"Número de autorización del seguro",value:o==null?void 0:o.authNumber,onChange:u}),t.jsx(zY,{type:"primary",icon:t.jsx(es,{}),onClick:c,children:"Editar"})]})}),t.jsx(NY,{})]})},MY=l.div`
  box-shadow: 0 -8px 10px -1px rgba(0, 0, 0, 0.1), 0 -2px 4px -1px rgba(0, 0, 0, 0.158);
  position: sticky;
  bottom: 0;
  display: flex;
  flex-direction: column;
  gap: 0.2rem;
  background-color: #fff;
  padding: 0.4em;
  border-radius: 0.4em;
  z-index: 4;
  border: 1px solid #e8e8e8;
`,zg=l.div`
  display: flex; 
  align-items: center;
  width: 100%;
`,FY=l(St)`
  &.ant-checkbox-wrapper {
    color: ${e=>e.theme.text.color1};
  }
`,BY=l.div`
  display: flex;
  width: 100%;
  gap: 8px;
`,LY=l(ie)`
  width: 100%;
  &:hover {
    border-color: #40a9ff;
  }
`,zY=l(U)`
  flex-shrink: 0;
`,{TextArea:UY}=ie,WY=({isOpen:e,onClose:n,selectedProduct:s,comment:o,onCommentChange:r,onSave:i,onDelete:a})=>{const[c,d]=st.useState(!1),[u,p]=st.useState(""),[h,f]=st.useState(!1);return t.jsx(qY,{open:e,onCancel:n,centered:!0,closeIcon:null,footer:null,children:t.jsxs(VY,{children:[t.jsxs(GY,{children:[t.jsx(_Y,{children:s==null?void 0:s.name}),t.jsx(HY,{onClick:n,children:t.jsx(Qr,{})})]}),t.jsxs(QY,{children:[t.jsxs(KY,{children:[t.jsx(UY,{value:o,onChange:x=>r(x.target.value),placeholder:"Agregar un comentario...",autoSize:{minRows:5,maxRows:14},maxLength:600}),t.jsxs(JY,{children:[o.length,"/600"]})]}),"                    ",t.jsxs(eK,{children:[t.jsx(tK,{children:"Herramientas del comentario"}),t.jsx(nK,{children:o&&t.jsx(Oe,{title:"Eliminar comentario",children:t.jsx(sK,{onClick:()=>{Ce.confirm({title:"¿Eliminar comentario?",icon:t.jsx(Is,{}),content:"¿Estás seguro que deseas eliminar este comentario?",okText:"Sí, eliminar",cancelText:"Cancelar",okButtonProps:{danger:!0},onOk:a})},danger:!0,icon:t.jsx(ht,{})})})})]})]}),"                ",t.jsx(XY,{children:t.jsx(YY,{children:t.jsx(ZY,{onClick:i,type:"primary",icon:t.jsx(t0,{}),children:"Guardar"})})})]})})},qY=l(Ce)`
    .ant-modal-content {
        padding: 0;
        /* border-radius: 16px; */
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    }
`,VY=l.div`
    display: flex;
    flex-direction: column;
    background: #fff;
`,GY=l.div`
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    background: #fafafa;
    border-bottom: 1px solid #f0f0f0;
`,_Y=l.h3`
    margin: 0;
    font-size: 16px;
    font-weight: 500;
    color: #1f2937;
`,HY=l.button`
    background: none;
    border: none;
    color: #6b7280;
    cursor: pointer;
    padding: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;

`,QY=l.div`
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    min-height: 180px;
`,YY=l.div`
    display: flex;
    gap: 8px;
`,KY=l.div`
    position: relative;
    background: #f8fafc;
    border-radius: 12px;
    padding: 4px;

    .ant-input {
        background: transparent;
        font-size: 14px;
        color: #334155;
        
        &::placeholder {
            color: #94a3b8;
        }
    }
`,JY=l.span`
    position: absolute;
    bottom: 8px;
    right: 12px;
    font-size: 11px;
    color: #94a3b8;
`,XY=l.div`
    padding: 16px 20px;
    border-top: 1px solid #f0f0f0;
    display: flex;
    gap: 8px;
    justify-content: flex-end;
`,ZY=l(U)`
`,eK=l.div`
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    padding: 8px 1.4em;
   
`,tK=l.span`
    font-size: 12px;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: block;
    margin-bottom: 8px;
`,nK=l.div`
    display: flex;
    gap: 8px;
    align-items: center;
`,sK=l(U)`
    &.ant-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        padding: 0;
        border-radius: 50%;

        &[disabled] {
            background: #f1f5f9;
            border-color: transparent;
            
            .anticon {
                color: #94a3b8;
            }
        }

        &.ant-btn-dangerous {
            background: #fef2f2;
            
            &:hover {
                background: #fee2e2;
            }
        }

        .anticon {
            font-size: 16px;
        }
    }
`,{Text:oK,Title:qCe}=Xe,rK=({visible:e,onClose:n,product:s})=>{const o=W(),r=D(os),[i,a]=m.useState("percentage"),[c,d]=m.useState(0),[u,p]=m.useState(null),h=[{label:"5%",value:5,type:"percentage"},{label:"10%",value:10,type:"percentage"},{label:"15%",value:15,type:"percentage"},{label:"20%",value:20,type:"percentage"},{label:"25%",value:25,type:"percentage"},{label:"50%",value:50,type:"percentage"}];m.useEffect(()=>{e&&s&&(s.discount?(a(s.discount.type),d(s.discount.value),p(null)):(a("percentage"),d(0),p(null)))},[e,s]);const f=()=>{if(!s)return 0;const T=(u==null?void 0:u.value)||c,R=(u==null?void 0:u.type)||i,N={...s,discount:null},G=tt(N,r,!1),Q=s.amountToBuy||1,ae=G*Q;return T<=0?ae:R==="percentage"?ae*(1-T/100):Math.max(0,ae-T)},x=()=>{if(!s)return 0;const T={...s,discount:null},R=tt(T,r,!1),N=s.amountToBuy||1,G=R*N,Q=f();return G-Q},g=st.useMemo(()=>{if(!s)return{unitPrice:0,totalPrice:0};const T={...s,discount:null},R=tt(T,r,!1),N=s.amountToBuy||1,G=R*N;return{unitPrice:R,totalPrice:G}},[s,r]),y=Y(g.unitPrice),b=Y(g.totalPrice),v=Y(x()),C=Y(f()),I=()=>{const T=u||{type:i,value:c},R=(u==null?void 0:u.value)||c;console.log("Aplicando descuento:",{product:s==null?void 0:s.name,discount:T,finalDiscountValue:R,productId:(s==null?void 0:s.id)||(s==null?void 0:s.cid)}),o(Am({id:s.id||s.cid,discount:R>0?T:null})),n()},j=()=>{o(Am({id:s.id||s.cid,discount:null})),n()},k=T=>{p(T),d(0)},A=T=>{d(T||0),p(null)},P=T=>{const R=T.target.value;a(R),R==="fixed"&&p(null),d(0)},w=g.totalPrice,E=((u==null?void 0:u.value)||c)>0;return u!=null&&u.value,t.jsxs(Ce,{title:"Aplicar Descuento al Producto",open:e,onCancel:n,style:{top:10},footer:[t.jsx(U,{onClick:n,children:"Cancelar"},"cancel"),(s==null?void 0:s.discount)&&t.jsx(U,{onClick:j,danger:!0,children:"Quitar Descuento"},"remove"),t.jsx(U,{type:"primary",onClick:I,disabled:!E,children:"Aplicar Descuento"},"apply")],width:500,children:["            ",t.jsxs(iK,{children:[t.jsxs(aK,{children:[t.jsxs(cK,{children:[t.jsx(lK,{children:(s==null?void 0:s.name)||(s==null?void 0:s.productName)}),t.jsxs(dK,{children:["Cant: ",(s==null?void 0:s.amountToBuy)||1]})]}),t.jsxs(uK,{children:[t.jsxs(Vi,{children:[t.jsx(Gi,{children:"Precio unitario:"}),t.jsx(_i,{children:y})]}),t.jsxs(Vi,{children:[t.jsx(Gi,{children:"Total actual:"}),t.jsx(_i,{$isTotal:!0,children:b})]})]})]}),t.jsxs(pK,{children:[i==="percentage"&&t.jsxs("div",{children:[t.jsx(oK,{strong:!0,style:{marginBottom:"8px",display:"block"},children:"Descuentos rápidos:"}),t.jsx(hK,{children:h.map((T,R)=>t.jsx(gK,{$isSelected:(u==null?void 0:u.value)===T.value&&(u==null?void 0:u.type)===T.type,onClick:()=>k(T),children:T.label},R))})]}),t.jsxs(mK,{children:["                        ",t.jsxs(Cs.Group,{value:i,onChange:P,children:[t.jsx(Ug,{value:"percentage",children:t.jsxs(Wg,{children:[t.jsx(i0,{}),"Porcentaje"]})}),t.jsx(Ug,{value:"fixed",children:t.jsxs(Wg,{children:[t.jsx(Da,{}),"Monto fijo"]})})]}),"                        ",t.jsx(Ke,{style:{width:"100%"},placeholder:i==="percentage"?"Ej: 15":`Máx: ${w}`,value:c,onChange:A,min:0,max:i==="percentage"?100:w,suffix:i==="percentage"?"%":"$",size:"large"}),E&&t.jsxs(fK,{children:[t.jsxs(Vi,{$isDiscount:!0,children:[t.jsx(Gi,{children:"Descuento:"}),t.jsxs(_i,{$isDiscount:!0,children:["-",v]})]}),t.jsxs(Vi,{$isFinal:!0,children:[t.jsx(Gi,{children:"Precio final:"}),t.jsx(_i,{$isFinal:!0,children:C})]})]})]})]})]})]})},iK=l.div`
    display: flex;
    flex-direction: column;
    gap: 16px;
`,aK=l.div`
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 16px;
  
    border-radius: 8px;
    border: 1px solid #e0e6ed;
`,cK=l.div`
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
`,lK=l.div`
    font-size: 16px;
    font-weight: 600;
    color: #2c3e50;
    flex: 1;
    line-height: 1.3;
`,dK=l.div`
    background-color: #1890ff;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    white-space: nowrap;
`,uK=l.div`
    display: flex;
    flex-direction: column;
    gap: 6px;
`,Vi=l.div`
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: ${e=>e.$isFinal?"8px 0 4px 0":"4px 0"};
    background-color: ${e=>e.$isFinal?"rgba(82, 196, 26, 0.1)":e.$isDiscount?"rgba(255, 77, 79, 0.05)":"transparent"};
    border-radius: ${e=>e.$isFinal||e.$isDiscount?"6px":"0"};
    margin: ${e=>e.$isFinal||e.$isDiscount?"0 -8px":"0"};
    padding-left: ${e=>e.$isFinal||e.$isDiscount?"8px":"0"};
    padding-right: ${e=>e.$isFinal||e.$isDiscount?"8px":"0"};
`,Gi=l.span`
    font-size: 14px;
    color: ${e=>e.$isFinal?"#52c41a":e.$isDiscount?"#ff4d4f":"#6c757d"};
    font-weight: ${e=>e.$isFinal?"600":"500"};
`,_i=l.span`
    font-size: ${e=>e.$isFinal?"18px":e.$isTotal?"16px":"14px"};
    font-weight: 700;
    color: ${e=>e.$isFinal?"#52c41a":e.$isDiscount?"#ff4d4f":e.$isTotal?"#2c3e50":"#495057"};
`;l.div`
    height: 1px;
    background: linear-gradient(90deg, transparent 0%, #e0e6ed 50%, transparent 100%);
    margin: 4px 0;
`;l.div`
    display: flex;
    flex-direction: column;
    gap: 4px;
`;const pK=l.div`
    display: flex;
    flex-direction: column;
    width: 100%;
    gap: 20px;
`,mK=l.div`
    display: flex;
    flex-direction: column;
    width: 100%;
    gap: 12px;
`,Ug=l(Cs)`
    .ant-radio-wrapper {
        display: flex;
        align-items: center;
    }
`,Wg=l.div`
    display: flex;
    align-items: center;
    gap: 8px;
`,hK=l.div`
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 6px;
`,gK=l.div`
    height: 32px;
    padding: 0 12px;
    font-size: 12px;
    min-width: auto;
    border-radius: 16px;
    border: 1px solid ${e=>e.$isSelected?"#1890ff":"#d9d9d9"};
    background-color: ${e=>e.$isSelected?"#1890ff":"white"};
    color: ${e=>e.$isSelected?"white":"#595959"};
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 500;
    transition: all 0.2s ease;
    
    &:hover {
        border-color: #1890ff;
        color: ${e=>e.$isSelected?"white":"#1890ff"};
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(24, 144, 255, 0.2);
    }
    
    &:active {
        transform: translateY(0);
    }
`;l(U)`
    height: 32px;
    padding: 0 8px;
    font-size: 12px;
    min-width: auto;
`;const fK=l.div`
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-top: 8px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid rgba(24, 144, 255, 0.2);
`,xK=()=>{const e=W(),n=D(Xb),s=cs(),o=D(ep),r="Los productos seleccionados aparecerán aquí...",[i,a]=m.useState(!1),[c,d]=m.useState(!1),[u,p]=m.useState(!1),[h,f]=m.useState(null),[x,g]=m.useState(""),y=P=>{f(P),g(P.comment||""),a(!0)},b=P=>{f(P),d(!0)},v=P=>{f(P),p(!0)},C=()=>{h&&e(Im({id:h.id,data:{comment:x}})),a(!1)},I=()=>{h&&e(_u(h.cid)),d(!1)},j=P=>{e(ja({recurrence:P.target.checked}))},k=P=>{e(ja({validity:P.target.checked}))},A=P=>{e(ja({authNumber:P.target.value}))};return t.jsxs(bK,{children:[t.jsx(vK,{children:n.length>0?t.jsxs(gt,{children:["                        ",n.map((P,w)=>t.jsx(UQ,{item:P,onOpenCommentModal:y,onOpenDeleteModal:b,onOpenDiscountModal:v},w))]}):t.jsx(yK,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:t.jsx(Qe,{variant:"body1",children:r})},"empty-message")}),s&&t.jsx(OY,{values:o,onRecurrenceChange:j,onValidityChange:k,onAuthNumberChange:A}),"            ",t.jsx(WY,{isOpen:i,onClose:()=>a(!1),selectedProduct:h,comment:x,onCommentChange:g,onSave:C,onDelete:()=>{g(""),e(Im({id:h.id,data:{comment:""}})),a(!1)}}),t.jsx(rK,{visible:u,onClose:()=>p(!1),product:h}),t.jsx(Ce,{title:"Eliminar producto",open:c,onOk:I,onCancel:()=>d(!1),okText:"Eliminar",cancelText:"Cancelar",okButtonProps:{danger:!0},centered:!0,children:t.jsx("div",{style:{textAlign:"center",marginBottom:"1rem"},children:t.jsx(Pt,{message:"¿Estás seguro que deseas eliminar este producto del carrito?",description:`Se eliminará "${(h==null?void 0:h.name)||""}" del carrito de compras.`,type:"warning",showIcon:!0})})})]})},bK=l.ul`
    background-color: ${e=>e.theme.bg.color2}; 
    display: grid;
    gap: 0.4em;
    grid-template-rows: 1fr min-content;
    width: 100%;
    margin: 0;
    padding: 0.4em;
    overflow-y: scroll;
    position: relative;
    border-top-left-radius: 8px;
    border-bottom-left-radius: 8px;
    border: 1px solid rgba(0, 0, 0, 0.121);
`,yK=l(Ie.div)`
  margin: 1em;
`,vK=l.div`
    display: grid;
    align-items: start;
    align-content: start;
    gap: 0.2rem;
`,jK=e=>{const n=e.toString();return Number(n.replace(/^0+/,""))},{Title:CK,Paragraph:wK}=Xe,SK=({options:e,value:n,discount:s,disabled:o=!1})=>{const[r,i]=m.useState(!1),a=W(),c=m.useRef(null),d=h=>{o||a(Cm(Number(jK(h))))},u=()=>{o||i(!r)},p=h=>{o||(i(!1),a(Cm(h)))};return kt(c,r,u),m.useEffect(()=>{n<0&&V.error("El descuento no puede ser negativo"),n>100&&V.error("El descuento no puede ser mayor a 100")},[n]),t.jsxs(IK,{ref:c,children:[r&&t.jsxs(kK,{children:[t.jsx(CK,{level:5,children:"Descuentos"}),t.jsx(wK,{children:"Selecciona un descuento"}),t.jsx(AK,{children:e.map(h=>t.jsxs(TK,{onClick:()=>p(h),children:[h,"%"]},h))})]}),"      ",t.jsx(EK,{children:t.jsx(Ke,{value:n,onChange:d,placeholder:"%",prefix:"%",addonAfter:"-"+Y(s),style:{width:"170px"},min:0,max:100,onClick:u,disabled:o})})]})},IK=l.div`
  position: relative;
`,EK=l.div`
    position: relative;
    label{
        height: 12px;
    box-sizing: border-box;
    margin: 0;
    padding: 0 0.4em;
    position: absolute;
    top: -8px;
    display: flex;
    align-items: center;
    background-color: white;
    color: #353535;
    font-weight: 600;
    border-radius: 3px;
    font-size: 11px;
    }
`,AK=l.ul`
  display: grid;
  gap: 0.2em;
  grid-template-columns: repeat(6, 1fr);
  list-style: none;
  padding: 0;
`,kK=l.div`
  border: 1px solid #ccc;
  padding: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  width: min-content;
  max-width: 500px;
  border-radius: 6px;
  background: #ffffff;
  position: absolute;
  z-index: 10;
  margin: -80px 0;
  right: 0;
  top: -58px;
 
`,TK=l.li`
  padding: 5px 5px;
  display: flex;
  height: 2.4em;
  width: 3.2em;
  align-items: center;
  border-radius: 4px;
  justify-content: center;
  background-color: #f3f3f3;

  cursor: pointer;
`,PK=()=>{var i,a,c,d;const e=W(),n=m.useRef(null),s=D(Ht);m.useEffect(()=>{var u;(u=s==null?void 0:s.delivery)!=null&&u.status&&n.current&&n.current.focus()},[(i=s==null?void 0:s.delivery)==null?void 0:i.status]);const o=u=>{const p=u.target.checked;e(Ba({...s,delivery:{...s.delivery,status:p}}))},r=u=>{e(Ba({...s,delivery:{...s.delivery,value:Number(u)}}))};return t.jsxs(Io,{children:[t.jsx(Vn,{htmlFor:"delivery",children:"Delivery:"}),t.jsxs("span",{style:{display:"grid",gridTemplateColumns:"min-content 1fr",alignItems:"center",gap:"0.2em"},children:[t.jsx(St,{id:"delivery",checked:(a=s==null?void 0:s.delivery)==null?void 0:a.status,onChange:u=>o(u)}),t.jsx(Ke,{value:((c=s==null?void 0:s.delivery)==null?void 0:c.value)||"",ref:n,placeholder:"0",prefix:"$",style:{width:"170px"},min:0,disabled:!((d=s==null?void 0:s.delivery)!=null&&d.status),onChange:u=>r(u)})]})]})},DK=async(e,n)=>{try{const s={...n,id:be(),date:null,status:"pending",type:"preorder",preorderDetails:{date:de(),isOrWasPreorder:!0,numberID:await Mt(e,"preorder"),userID:e.uid,paymentStatus:"unpaid"},history:[{type:"preorder",status:"pending",date:ue.now(),userID:e.uid}]},o=F($,`businesses/${e.businessID}/invoices/${s.id}`),r=await De(o,{data:s});return s}catch(s){throw new Error(s.message)}},{Modal:$K}=Ne,RK=({open:e,onConfirm:n,onCancel:s,preorder:o})=>{var r,i;return t.jsx($K,{title:"Confirmar Preorden",open:e,onOk:()=>n(o.data.numberID),onCancel:s,okText:"Completar",cancelText:"Cancelar",children:t.jsxs("p",{children:["¿Estás seguro de que deseas completar la preorden ",t.jsx("strong",{children:o.data.preorderDetails.numberID})," para el cliente ",t.jsx("strong",{children:(i=(r=o==null?void 0:o.data)==null?void 0:r.client)==null?void 0:i.name}),"?"]})})},NK=()=>{const e=D(Ac),n=cs();if(!n)return{isFormComplete:!1,insuranceEnabled:n,shouldDisableButton:!1};const o=["insuranceId","insuranceType","affiliateNumber","authNumber","doctor","specialty","indicationDate","birthDate"].every(i=>{const a=e[i];return a!=null&&a!==""});return{isFormComplete:o,insuranceEnabled:n,shouldDisableButton:n&&!o}},OK=({options:e=[],disabled:n})=>{const[s,o]=m.useState(!1),r=m.useRef(null);return kt(r,s,()=>o(!1)),t.jsxs(t.Fragment,{children:[t.jsx(MK,{children:t.jsx(FK,{onClick:()=>o(!s),disabled:n,children:t.jsx(BK,{disabled:n,children:"⋮"})})}),t.jsx(gt,{children:s&&t.jsxs(LK,{ref:r,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},children:[t.jsxs(zK,{children:[t.jsx(UK,{children:"Más Acciones"}),t.jsx(GK,{onClick:()=>o(!1),children:t.jsx(O,{icon:_r})})]}),t.jsx(WK,{children:e.map((i,a)=>t.jsxs(qK,{onClick:()=>{i.action(),o(!1)},disabled:i.disabled,children:[i.icon&&t.jsx(VK,{children:i.icon}),i.text]},a))})]})})]})},MK=l.div`
  position: relative;
  width: 100%;
`,FK=l.button`
  background: transparent;
  border: none;
  display: grid;
  place-items: center;
  height: 32px;
  width: 32px;
  cursor: ${e=>e.disabled?"not-allowed":"pointer"};
  opacity: ${e=>e.disabled?.6:1};
`,BK=l.span`
  font-size: 22px;
  line-height: 0;
  color: ${e=>e.disabled?"#94a3b8":"#1e293b"};
  font-weight: 600;
`,LK=l(Ie.div)`
  position: absolute;
  border: 1px solid #cfcfcf;
  bottom: 8px;
  left: 2px;
  right: 2px;
  margin: 0 auto;
  width: 95%;
  background: #ffffff;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.397);
  z-index: 1000;
`,zK=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 12px;
  border-bottom: 1px solid #eee;
`,UK=l.h3`
  margin: 0;
  font-size: 14px;
  color: #0f172a;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
`,WK=l.div`
  display: flex;
  flex-direction: column;
  padding: 4px; 
  gap: 0.2em;
`,qK=l.button`
  display: flex;
  align-items: center;
  gap: 8px; 
  padding: 10px;  
  border: none;
  background: #ffffff;
  border-radius: 6px; 
  cursor: ${e=>e.disabled?"not-allowed":"pointer"};
  opacity: ${e=>e.disabled?.6:1};
  width: 100%;
  text-align: left;
  font-size: 15px;
  font-weight: 500;
  color: #475569;
  transition: all 0.2s;
  
  &:hover {
    background: ${e=>!e.disabled&&"#f0f0f0"};
    color: ${e=>!e.disabled&&"#0f172a"};
  }
`,VK=l.span`
  display: flex;
  align-items: center;
  font-size: 16px;
  color: #64748b;
`,GK=l.button`
  position: absolute;
  top: 8px;
  right: 8px;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 4px 8px;
  font-size: 16px;
  color: #64748b;
  font-weight: 500;
  border-radius: 4px;
  
  &:hover {
    background: #f0f0f0;
    color: #0f172a;
  }
`,Rr=({textAlign:e,children:n})=>t.jsx(_K,{textAlign:e,children:n}),_K=l.div`
  width: 100%;
    display: flex;
    justify-content: ${e=>e.textAlign};
  `,Vs=({cols:e,space:n,children:s})=>t.jsx(QK,{cols:e,space:n,children:s}),HK={true:"padding: 0.4em 0;",false:""},qg={3:"grid-template-columns: 1fr 0.8fr 0.8fr;",default:"grid-template-columns: 1fr;"},QK=l.div`
   display: grid;
  align-items: center;
  gap: 0.4em;
  ${({space:e})=>HK[e]}
  ${({cols:e})=>qg[e]||qg.default}
  `,YK=({data:e})=>{const{products:n,NCF:s}=e,{taxReceipt:o}=D(zt),r=({name:i,measurement:a,footer:c})=>`${i}${a?` Medida: [${a}]`:""}${c?` Pie: [${c}]`:""}`;return t.jsx(KK,{children:t.jsx(JK,{children:(n==null?void 0:n.length)>0?n==null?void 0:n.map((i,a)=>{var c,d,u,p,h,f,x;return t.jsxs(XK,{children:[t.jsxs(Vs,{cols:"3",children:[t.jsx(Rr,{children:(c=i==null?void 0:i.weightDetail)!=null&&c.isSoldByWeight?t.jsxs("div",{children:[(d=i==null?void 0:i.weightDetail)==null?void 0:d.weight," ",(u=i==null?void 0:i.weightDetail)==null?void 0:u.weightUnit," X ",Y(tt(Ks(i),o==null?void 0:o.enabled))]}):t.jsxs("div",{children:[(i==null?void 0:i.amountToBuy)||0," x ",ct(tt(Ks(i),o==null?void 0:o.enabled))]})}),t.jsx(Rr,{textAlign:"right",children:ct(Xn(i,s))}),t.jsx(Rr,{textAlign:"right",children:ct(tt(i,s))})]}),t.jsx(Vs,{children:t.jsxs(ZK,{children:[r(i)," "]})}),"                                ",((p=i==null?void 0:i.warranty)==null?void 0:p.status)&&t.jsxs(Vs,{children:[Ec((h=i==null?void 0:i.warranty)==null?void 0:h.quantity,(f=i==null?void 0:i.warranty)==null?void 0:f.unit)," de Garantía"]}),(i==null?void 0:i.discount)&&((x=i==null?void 0:i.discount)==null?void 0:x.value)>0&&t.jsx(Vs,{children:t.jsxs(eJ,{children:["Descuento: -",Y(Bu(i)),"(",i.discount.type==="percentage"?`${i.discount.value}%`:"Monto fijo",")"]})})]},a)}):null})})},KK=l.div`
 
`,JK=l.div`
      display: block;
    border: none;
    padding: 0;
    list-style: none;
    line-height: 22px;
`,XK=l.div`
    width: 100%;

    &:nth-child(1n) {
            border-bottom: 1px dashed black;
        }

        &:last-child {
            border-bottom: none;
        }
`,ZK=l.div`
        width: 100%;
        grid-column: 1 / 4;
        line-height: 1.4pc;
        text-transform: capitalize;
     
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        //white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
`,eJ=l.div`
    font-size: 0.9em;
    font-weight: 600;
    color: #52c41a;
    padding-left: 8px;
    border-left: 2px solid #52c41a;
    margin: 2px 0;
`,tJ=l.div`
    width: 100%;
    margin: 0;
    padding: 3mm; 
    line-height: 20px;
    font-size: 11px;
    background-color: white;
    text-transform: uppercase;
    font-family: 'Lato', sans-serif;
    pointer-events: none;
    p {
        line-height: 16px;
    }
    @media print {
        margin: 0;
        
        pointer-events: auto;
    }
`,nJ=l.div`
    display: ${({ignoreHidden:e})=>!e&&"none"};
`;l.p`
    font-size: 18px;
    font-weight: 600;
    padding: 0.2em 0;
    text-align: center;
    margin: 0;
`;function ps({label:e,value:n,align:s="left",textTransform:o="",justifyContent:r=""}){return t.jsxs(sJ,{textTransform:o,justifyContent:r,children:[e&&t.jsxs(Pj,{align:s,children:[e," ",n&&": "]}),n&&t.jsx("span",{children:n})]})}const sJ=l.div`
    display: flex;
    gap: 12px;
    text-transform: ${e=>e.textTransform};
    justify-content: ${e=>e.justifyContent};
`,oJ=l.p`
    display: flex;
    font-weight: 600;
    line-height: 12px;
    padding: 0;
    margin: 0;
    white-space: nowrap;
    
    justify-content: ${({align:e})=>e};
`,Pj=l.p`
    margin: 0;
    padding: 0.2em 0;
    text-transform: uppercase;
    ${({align:e})=>{switch(e){case"center":return"text-align: center;";case"right":return"text-align: right;";default:return"text-align: left;"}}}
`;l.div`
    border: none;
    border-top: 1px dashed black;
`;const Ja=l.div`
    margin-bottom: 0.8em;
    ${({size:e})=>{switch(e){case"small":return"margin-bottom: 0.2em;";case"medium":return"margin-bottom: 0.8em;";case"large":return"margin-bottom: 1.6em;";default:return"margin-bottom: 0.8em;"}}}
`,Vg={Container:tJ,HiddenPrintWrapper:nJ},rJ=({data:e})=>{var x,g,y,b,v,C,I,j,k,A;const[n,s]=m.useState(0),o=D(q),r=o==null?void 0:o.businessID,i=(x=e==null?void 0:e.client)==null?void 0:x.id,a=Nn((e==null?void 0:e.products)||[])+$s((e==null?void 0:e.products)||[]),c=is(a,((g=e==null?void 0:e.discount)==null?void 0:g.value)||0),d=Fu((e==null?void 0:e.products)||[]),u=d>0,p=P=>Y(P,"");Ho(r,i,s);const h={cash:"Efectivo",card:"Tarjeta",transfer:"Transferencia"},f=[{label:"ENVÍO",value1:null,value2:p((y=e==null?void 0:e.delivery)==null?void 0:y.value),condition:(b=e==null?void 0:e.delivery)==null?void 0:b.status},{label:"SUBTOTAL",value2:p(a),condition:!0},{label:"DESCUENTO GENERAL",value2:p(c),condition:!u&&c>0},{label:"DESCUENTOS PRODUCTOS",value2:p(d),condition:u},...((v=e==null?void 0:e.paymentMethod)==null?void 0:v.filter(P=>(P==null?void 0:P.status)===!0).map(P=>({label:h[P==null?void 0:P.method],value2:p(P==null?void 0:P.value),condition:!0})))||[],{subtitle:"TOTAL",value1:p((C=e==null?void 0:e.totalTaxes)==null?void 0:C.value),value2:p((I=e==null?void 0:e.totalPurchase)==null?void 0:I.value),condition:!0,spacingEnd:!0,spacingStart:!0},{label:((j=e==null?void 0:e.change)==null?void 0:j.value)>=0?"CAMBIO":"FALTANTE",value2:p((k=e==null?void 0:e.change)==null?void 0:k.value),condition:!0},{label:"BALANCE ACTUAL",value2:p(n),condition:((A=e==null?void 0:e.change)==null?void 0:A.value)<0}];return t.jsx(aJ,{children:f.map((P,w)=>t.jsx(iJ,{row:P},w))})},iJ=({row:{subtitle:e,label:n,value1:s,value2:o,condition:r,textAlign:i,spacingEnd:a,spacingStart:c,line:d}})=>t.jsxs(m.Fragment,{children:[c&&t.jsx(Ja,{}),r&&t.jsxs(Vs,{cols:"3",children:[e&&t.jsxs(nu,{children:[e," : "]}),n&&t.jsxs(Pj,{children:[n," : "]}),t.jsx(Rr,{textAlign:i||"right",children:s}),e?t.jsx(oJ,{align:i||"right",children:o}):t.jsx(Rr,{textAlign:i||"right",children:o})]}),a&&t.jsx(Ja,{}),d&&t.jsx(Er,{})]}),aJ=l.div`
padding-top: 0.6em;
`,cJ=({data:e,Space:n})=>{var r,i,a,c,d,u,p,h;let s=D(ft)||"";const o=e!=null&&e.date?Ve.convertMillisToISODate(Ve.convertTimestampToMillis(e.date),"dd/MM/yyyy HH:mm"):ce.now().toFormat("dd/MM/yyyy HH:mm");return t.jsxs(lJ,{children:[t.jsx(dJ,{children:s==null?void 0:s.name}),t.jsx(ps,{align:"center",label:s==null?void 0:s.address,justifyContent:"center"}),t.jsx(ps,{align:"center",label:Dn(s==null?void 0:s.tel),justifyContent:"center"}),t.jsx(Ja,{size:"large"}),t.jsx(ps,{label:"Fecha",value:o}),(e==null?void 0:e.NCF)&&t.jsx(ps,{label:"NCF",value:e==null?void 0:e.NCF}),t.jsx(Ja,{}),(e==null?void 0:e.client)&&t.jsxs("div",{children:[t.jsx(ps,{label:"CLIENTE",value:((i=(r=e==null?void 0:e.client)==null?void 0:r.name)==null?void 0:i.toUpperCase())||"CLIENTE GENERICO"}),((a=e==null?void 0:e.client)==null?void 0:a.personalID)&&t.jsx(ps,{label:"CEDULA/RNC",value:(c=e==null?void 0:e.client)==null?void 0:c.personalID}),((d=e==null?void 0:e.client)==null?void 0:d.tel)&&t.jsx(ps,{label:"TEL",value:Dn((u=e==null?void 0:e.client)==null?void 0:u.tel)}),((p=e==null?void 0:e.client)==null?void 0:p.address)&&t.jsx(ps,{label:"DIR",value:(h=e==null?void 0:e.client)==null?void 0:h.address})]})]})},lJ=l.div`
    margin-top: 1em;
    margin-bottom: 0.6em;
`,dJ=l.p`
    font-size: 16px;
    font-weight: 600;
    padding: 0.2em 0;
    text-align: center;
    margin: 0;
    
`;l.div`
    display: flex;
    gap: 12px;
`;const uJ=({data:e})=>{var s;if((s=e==null?void 0:e.products)==null?void 0:s.some(o=>{var r;return(r=o==null?void 0:o.warranty)==null?void 0:r.status}))return t.jsxs(pJ,{children:[t.jsxs("div",{children:[t.jsx(Gg,{}),t.jsx(_g,{children:"Despachado por"})]}),t.jsxs("div",{children:[t.jsx(Gg,{}),t.jsx(_g,{children:"Recibido por"})]})]})},pJ=l.div`
  display: grid;
  gap: 2em;
  padding: 0 0.4em;
  margin-top: 2.5em;
`,Gg=l.div`
  width: 100%;
  border-bottom: 1px solid black;
  padding: 0 10px;
`,_g=l.span`
  font-size: 14px;
  color: #333;
`,mJ=({message:e})=>e?t.jsx(hJ,{children:t.jsx(gJ,{children:e})}):null,hJ=l.div`
  /* display: flex;
  justify-content: center;
  align-items: center; */
  text-align: center;
  margin-top: 1em;
`,gJ=l.p`
  font-size: 12px;
  line-height: 1.6;
  color: #333;
  margin: 0;
`;st.forwardRef(({data:e,ignoreHidden:n},s)=>{var a,c;const o=D(ft)||"";function r(d){if(!d)return{type:"Desconocido",description:"RECIBO  DE PAGO"};const u=/(B0\d)/,p=d.match(u),h={B01:{type:"Crédito Fiscal",description:"FACTURA PARA CREDITO FISCAL"},B02:{type:"Consumidor Final",description:"FACTURA PARA CONUMIDOR FINAL"}};return p&&p[0]&&h[p[0]]?h[p[0]]:{type:"Desconocido",description:"RECIBO DE PAGO"}}const i=(a=r(e==null?void 0:e.NCF))==null?void 0:a.description;return e?t.jsx(Vg.HiddenPrintWrapper,{ignoreHidden:n,children:t.jsxs(Vg.Container,{ref:s,children:[t.jsx(cJ,{data:e,Space:Hg,SubTitle:nu,P:dr}),t.jsx(Hg,{}),t.jsx(Er,{}),t.jsx(Vs,{space:!0,children:t.jsxs(nu,{align:"center",children:[" ",i]})}),t.jsx(Er,{}),t.jsxs(Vs,{cols:"3",space:!0,children:[t.jsx(dr,{children:"DESCRIPCION"}),t.jsx(dr,{align:"right",children:"ITBIS"}),t.jsx(dr,{align:"right",children:"VALOR"})]}),t.jsx(Er,{}),t.jsx(YK,{data:e}),t.jsx(Er,{}),t.jsx(rJ,{P:dr,data:e}),t.jsx(uJ,{data:e}),t.jsx(mJ,{message:(c=o==null?void 0:o.invoice)==null?void 0:c.invoiceMessage})]})}):null});const nu=l.p`
    font-weight: 600;
    line-height: 12px;
    padding: 0 0;
    margin: 0;
    white-space: nowrap;
    
    ${e=>{switch(e.align){case"center":return"text-align: center;";case"right":return"text-align: right;";default:return"text-align: left;"}}}
`,dr=l.p`
   
    margin: 0;
    padding: 0.2em 0;
    text-transform: uppercase;
    ${e=>{switch(e.align){case"center":return"text-align: center;";case"right":return"text-align: right;";default:return"text-align: left;"}}}
   
`,Er=l.div`
    border: none;
    border-top: 1px dashed black;
`,Hg=l.div`
 margin-bottom: 0.6em;
 ${e=>{switch(e.size){case"small":return"margin-bottom: 0.2em;";case"medium":return"margin-bottom: 0.8em;";case"large":return"margin-bottom: 1.6em;";default:return"margin-bottom: 0.8em;"}}}

`,fJ=e=>({title:"COTIZACIÓN",label:"quote"}),Qg=e=>e&&e.seconds?new Date(e.seconds*1e3).toLocaleDateString():"";function xJ({business:e,data:n}){var o,r,i,a;const s=fJ(n==null?void 0:n.NCF);return t.jsxs(bJ,{children:[(e==null?void 0:e.logoUrl)&&t.jsx(wJ,{children:t.jsx("img",{src:e.logoUrl,alt:"Company Logo"})}),t.jsxs(vJ,{children:[t.jsxs(Dj,{children:[t.jsx(CJ,{children:(e==null?void 0:e.name)||"Ventamax Dev"}),t.jsx("p",{children:e==null?void 0:e.address}),(e==null?void 0:e.tel)&&t.jsxs("p",{children:[t.jsx(O,{icon:rc})," ",e==null?void 0:e.tel]}),(e==null?void 0:e.email)&&t.jsxs("p",{children:[t.jsx(O,{icon:sc})," ",e==null?void 0:e.email]}),(e==null?void 0:e.rnc)&&t.jsxs("p",{children:[" RNC: ",e==null?void 0:e.rnc]})]}),t.jsxs(Yg,{children:[t.jsx(yJ,{children:s.title}),t.jsxs("p",{children:["Fecha: ",Qg(n==null?void 0:n.createdAt)]}),t.jsxs("p",{children:["Cotización No: ",n==null?void 0:n.numberID]}),(n==null?void 0:n.expirationDate)&&t.jsxs("p",{children:["Fecha que vence: ",Qg(n==null?void 0:n.expirationDate)]})]})]}),t.jsxs(jJ,{children:[t.jsxs("div",{style:{display:"flex",gap:"1em"},children:[t.jsxs("span",{children:[((o=n==null?void 0:n.client)==null?void 0:o.name)&&t.jsxs("p",{children:[t.jsx("strong",{children:"Cliente:"})," ",n.client.name]}),((r=n==null?void 0:n.client)==null?void 0:r.address)&&t.jsxs("p",{children:["Dirección: ",n.client.address]})]}),t.jsxs("span",{children:[((i=n==null?void 0:n.client)==null?void 0:i.tel)&&t.jsxs("p",{children:["Tel: ",n.client.tel]}),((a=n==null?void 0:n.client)==null?void 0:a.personalID)&&t.jsxs("p",{children:["RNC: ",n.client.personalID]})]})]}),t.jsx(Yg,{children:(n==null?void 0:n.comprobante)&&t.jsxs("p",{children:[s.label,": ",n.comprobante]})})]})]})}const bJ=l.div`
    margin: 1em;
`,yJ=l.h1`
  font-size: 1.1rem;
  margin-bottom: 1rem;
`,vJ=l.div`
  display: flex;
  justify-content: space-between;
  margin-bottom: 0em;
`,Dj=l.div`
  line-height: 1.2;
  font-size: 14px;
  p {
    margin: 0.5em 0;
  }
`,jJ=l(Dj)`
  display: grid;
  grid-template-columns: 1fr 1fr;
`,CJ=l.h2`
  font-weight: bold;
  font-size: 1.25rem;
`,Yg=l.div`
  display: grid;
  justify-content: end;
  text-align: right;
  font-size: 14px;
`;l.div`

  font-size: 14px;
  text-align: right;
`;const wJ=l.div`
  max-width: 200px;
  height: 40px;
  margin-bottom: 1em;

  img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: left center;
  }
`,SJ=[{title:"CANT.",dataIndex:"amountToBuy",key:"quantity"},{title:"CODIGO",dataIndex:"barcode",key:"code"},{title:"DESCRIPCION",dataIndex:"name",key:"description"},{title:"PRECIO",dataIndex:"pricing",key:"price",align:"right",render:e=>e.price.toFixed(2)},{title:"ITBIS",dataIndex:"pricing",key:"itbis",align:"right",render:e=>(e.price*Number(e.tax)/100).toFixed(2)},{title:"TOTAL",key:"total",align:"right",render:(e,n)=>{const s=n.pricing.price,o=s*Number(n.pricing.tax)/100;return((s+o)*n.amountToBuy).toFixed(2)}}];function IJ({data:e}){return t.jsx(AJ,{children:t.jsx(EJ,{children:t.jsx(Gt,{size:"small",columns:SJ,dataSource:(e==null?void 0:e.products)||[],pagination:!1})})})}const EJ=l.div`
  margin-top: 16px;
  @media print {
    margin-top: 0;
  }
`,AJ=l.div`
  padding: 0 2em;
  border: 1px solid #e0e0e0;
  width: 100%;
  /* border: 1px solid green; */
`;function kJ({business:e,data:n}){var i,a,c,d,u,p,h,f;const s=Nn((n==null?void 0:n.products)||[]),o=is(s,((i=n==null?void 0:n.discount)==null?void 0:i.value)||0),r={subtotal:Y(((a=n==null?void 0:n.totalPurchaseWithoutTaxes)==null?void 0:a.value)||0),discount:`-${Y(o||0)}`,tax:Y(((c=n==null?void 0:n.totalTaxes)==null?void 0:c.value)||0),delivery:Y(((d=n==null?void 0:n.delivery)==null?void 0:d.value)||0),total:Y(((u=n==null?void 0:n.totalPurchase)==null?void 0:u.value)||0)};return t.jsx(DJ,{children:t.jsxs(RJ,{children:[t.jsx(PJ,{children:t.jsx(TJ,{children:t.jsx("div",{})})}),t.jsxs($J,{children:[t.jsxs(ur,{children:[t.jsx("span",{children:"Sub-Total:"}),t.jsx("span",{className:"value",children:r.subtotal})]}),t.jsxs(ur,{children:[t.jsx("span",{children:"ITBIS:"}),t.jsx("span",{className:"value",children:r.tax})]}),(p=n==null?void 0:n.discount)!=null&&p.value?t.jsxs(ur,{children:[t.jsxs("span",{children:["Descuento (%",(h=n==null?void 0:n.discount)==null?void 0:h.value,"):"]}),t.jsx("span",{className:"value",children:r.discount})]}):null,((f=n==null?void 0:n.delivery)==null?void 0:f.status)&&t.jsxs(ur,{children:[t.jsx("span",{children:"Delivery :"}),t.jsxs("span",{className:"value",children:[" ",r.delivery]})]}),t.jsxs(ur,{className:"bold",children:[t.jsx("span",{children:"Total:"}),t.jsx("span",{className:"value",children:r.total})]})]})]})})}l.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  column-gap: 2em;

`;const TJ=l.div`
    display: grid;
    grid-template-columns: 1fr 0.4fr;
    `,PJ=l.div`
    display: grid;
  `,DJ=l.div`
display: grid;
gap: 2em;
padding: 0 1em 1em 1em;
padding-top: 32px;
font-size: 0.875rem;
/* border: 1px solid red; */
`,$J=l.div`
/* display: grid; */

`;l.div`
  /* margin-top: 1em; */
  font-size: 14px;
`;const ur=l.div`
display: grid;
grid-template-columns: 1fr 1fr;
font-size: 14px;
gap: 1em;

span {
  white-space: nowrap;
}

&.bold {
  font-weight: bold;
}

.value {
  text-align: right;
}
`;l.p`
  font-weight: bold;
  font-size: 14px;
`;const RJ=l.div`
    display: grid;
    grid-template-columns: 1fr 0.6fr;
    column-gap: 1em;
    align-items: end;
    `;function NJ(e,n){var r,i,a,c;let s=0;return e!=null&&e.logoUrl&&s++,s++,e!=null&&e.address&&s++,e!=null&&e.tel&&s++,e!=null&&e.email&&s++,e!=null&&e.rnc&&s++,s++,s++,s++,n!=null&&n.expirationDate&&s++,((r=n==null?void 0:n.client)!=null&&r.name||(i=n==null?void 0:n.client)!=null&&i.address)&&s++,((a=n==null?void 0:n.client)!=null&&a.tel||(c=n==null?void 0:n.client)!=null&&c.personalID)&&s++,s*20+16*2}function OJ(e){var o,r;let n=3;return(o=e==null?void 0:e.discount)!=null&&o.value&&n++,(r=e==null?void 0:e.delivery)!=null&&r.status&&n++,n*16+16*2}const MJ=l.div`
  position: relative;
  width: 100%;
  margin: 0;
  padding: 16px;
  @media print { padding: 0; }
`,FJ=l.div`
 & table {
   width: 100% !important;  
  }
  @media print {
    thead { display: table-header-group; }
    tfoot { display: table-footer-group; }
    /* la tabla interna de Content: */
    > tbody > tr > td > table {
      display: table-row-group !important;
    }
  }
`,BJ=l.div`
  @media print { height: ${e=>e.height}px; }
`,LJ=l.div`
   @media print { height: ${e=>e.height}px; }
`,zJ=l.div`
  padding: 16px;
  margin-bottom: 16px;
  @media print {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 10000;
  }
`,UJ=l.div`

  bottom: 0;
  left: 0;
  right: 0;
  padding: 16px;
  z-index: 10000;

  @media print {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
  }
`,WJ=st.forwardRef(({data:e,ignoreHidden:n},s)=>{const o=D(ft)||{},[r,i]=m.useState(0),[a,c]=m.useState(0);return m.useLayoutEffect(()=>{i(NJ(o,e)),c(OJ(e))},[o,e]),e?t.jsx(MJ,{style:{display:n?"block":"none"},children:t.jsxs(FJ,{ref:s,children:[t.jsx(zJ,{children:t.jsx(xJ,{business:o,data:e})}),t.jsx("thead",{children:t.jsx("tr",{children:t.jsx("td",{children:t.jsx(BJ,{height:r})})})}),t.jsx("tbody",{children:t.jsx("tr",{children:t.jsx("td",{children:t.jsx(IJ,{data:e})})})}),t.jsx("tfoot",{children:t.jsx("tr",{children:t.jsx("td",{children:t.jsx(LJ,{height:a})})})}),t.jsx(UJ,{children:t.jsx(kJ,{business:o,data:e})})]})}):null}),qJ=l.div`
  ${e=>e.template==="template2"&&`
    font-size: 12px;
    
    table {
      font-size: 10px;
    }
    
    h1, h2, h3 {
      font-size: 14px;
    }
  `}
  
  ${e=>e.template==="template1"&&`
    font-size: 14px;
    
    table {
      font-size: 12px;
    }
  `}
`,VJ=st.forwardRef(({data:e,template:n="template2",ignoreHidden:s},o)=>{const{billing:{billingMode:r,invoiceType:i}}=D(zt),a=()=>t.jsx(WJ,{ref:o,data:e,ignoreHidden:s});return t.jsx(qJ,{template:n,children:a()})});function GJ(e){return ce.now().plus({days:e}).toJSDate()}async function _J(e,n){try{const s=F($,"businesses",e.businessID,"quotations",n),o=await Se(s);if(o.exists()){const r=o.data();return r.expired=r.expirationDate<new Date,r}else throw new Error("Quotation not found")}catch(s){throw console.error("Error fetching quotation:",s),new Error("Could not fetch quotation")}}async function HJ(e,n,s){try{const o=be(),r=F($,"businesses",e.businessID,"quotations",o),i=(s==null?void 0:s.quoteValidity)??30,a=(s==null?void 0:s.quoteDefaultNote)??"",c={...n,id:o,numberID:await Mt(e,"quotations"),date:de(),createdBy:e.uid,note:a,validity:i,expirationDate:GJ(i)};return await De(r,c),await _J(e,o)}catch(o){throw console.error("Error adding quotation:",o),new Error("Could not add quotation")}}const QJ=({message:e,icon:n="⚠️"})=>{const[s,o]=m.useState(!1),r=m.useRef(null);if(kt(r,()=>{s&&o(!1)}),!e)return null;const i=()=>o(a=>!a);return t.jsxs(t.Fragment,{children:[t.jsx(YJ,{onClick:i,children:t.jsx(KJ,{children:n})}),t.jsx(gt,{children:s&&t.jsxs(JJ,{ref:r,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3,ease:"easeOut"},children:[t.jsxs(XJ,{children:[t.jsx(ZJ,{children:n}),t.jsx(eX,{children:e})]}),t.jsx(tX,{onClick:i,children:"×"})]})})]})},YJ=l.div`
  position: fixed;
  bottom: 40px;
  right: 330px;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background-color: #fffbe6;
  border: 1px solid #ffd666;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  z-index: 2;
  transition: transform 0.2s, box-shadow 0.2s;

  &:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }
`,KJ=l.span`
  font-size: 16px;
  color: #fa8c16;
`,JJ=l(Ie.div)`
  position: fixed;
  bottom: 80px;
  right: 30px;
  width: 320px;
  background-color: #fffbe6;
  border: 1px solid #ffd666;
  border-radius: 8px;
  padding: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 20;
  display: flex;
  justify-content: space-between;
`,XJ=l.div`
  display: flex;
  align-items: flex-start;
  flex: 1;
`,ZJ=l.span`
  font-size: 18px;
  color: #fa8c16;
  margin-right: 12px;
  flex-shrink: 0;
`,eX=l.div`
  color: #d48806;
  font-size: 14px;
  line-height: 1.5;
`,tX=l.button`
  background: none;
  border: none;
  color: #d48806;
  font-size: 20px;
  cursor: pointer;
  padding: 0;
  margin-left: 8px;
  line-height: 1;
  align-self: flex-start;
  opacity: 0.6;
  transition: opacity 0.2s;
  
  &:hover {
    opacity: 1;
  }
`,nX=()=>{var se,ee,K,B;const[e,n]=m.useState(!1),s=D(Tc),o=D(q),[r,i]=m.useState(!1),a=D(as),c=((se=a==null?void 0:a.totalInsurance)==null?void 0:se.value)||0,d=(ee=s==null?void 0:s.settings)==null?void 0:ee.billing,u=D(ft)||{},p=(K=a==null?void 0:a.totalPurchase)==null?void 0:K.value,h=(B=a==null?void 0:a.totalPurchaseWithoutTaxes)==null?void 0:B.value,f=a.totalTaxes.value,x=a.discount.value,g=m.useRef(),[y,b]=m.useState(),[v,C]=m.useState(!1),I=is(h,x),{billing:j}=D(zt),k=D(OD),A=D(MD),P=k.length>0,w=W(),S=cs(),{shouldDisableButton:E}=NK(),T=m.useMemo(()=>{if(!S)return{isValid:!0,message:null};const _=(a==null?void 0:a.products)||[];if(_.filter(Pe=>{const Ue=(Pe==null?void 0:Pe.insurance)||{};return Ue.mode&&Ue.value>0}).length===0)return{isValid:!1,message:"Al menos un producto debe tener cobertura de seguro configurada"};const H=["medicamento","medicina","farmacia","recetado"],pe=_.filter(Pe=>{const Ue=(Pe==null?void 0:Pe.category)&&H.some(ve=>Pe.category.toLowerCase().includes(ve)),ut=(Pe==null?void 0:Pe.requiresInsurance)===!0;return Ue||ut}).filter(Pe=>{const Ue=(Pe==null?void 0:Pe.insurance)||{};return!Ue.mode||Ue.value<=0});if(pe.length>0)return{isValid:!1,message:`Los siguientes productos requieren configuración de seguro: ${pe.map(Ue=>Ue.productName||"Producto sin nombre").join(", ")}`,invalidProducts:pe};const ye=_.filter(Pe=>{var xe;const Ue=(Pe==null?void 0:Pe.insurance)||{},ut=((xe=Pe==null?void 0:Pe.pricing)==null?void 0:xe.price)??0;return[()=>!Ue.mode,()=>Ue.value<=0,()=>Ue.mode==="porcentaje"&&(Ue.value<1||Ue.value>100),()=>Ue.mode==="monto"&&Ue.value>ut].some(Ae=>Ae())});return ye.length>0?{isValid:!1,message:`Valor de cobertura inválido en: ${ye.map(Ue=>Ue.productName||"Producto sin nombre").join(", ")}`,invalidProducts:ye}:{isValid:!0,message:null}},[a==null?void 0:a.products,S]);m.useEffect(()=>{const{isValid:_}=$r(a);n(_)},[a]);const R=()=>{const{isValid:_,message:L}=$r(a);_?(w(yD()),w(Qu()),w(Yb())):Be.error({description:L})};Vo.useReactToPrint({content:()=>g.current,onAfterPrint:()=>{Ce.confirm({title:"¿Limpiar cotización?",content:"¿Desea limpiar los datos de la cotización?",okText:"Limpiar",cancelText:"Mantener",onOk:()=>{So({dispatch:w,closeInvoicePanel:!1}),Be.success({message:"Cotización eliminada",description:"Los datos de la cotización han sido eliminados.",duration:4})},onCancel:()=>{Be.success({message:"Cotización conservada",description:"Los datos de la cotización se han mantenido.",duration:4})}})}});function N(){Ce.confirm({title:"¿Limpiar cotización?",content:"¿Desea limpiar los datos de la cotización?",okText:"Limpiar",cancelText:"Mantener",onOk:()=>{So({dispatch:w,closeInvoicePanel:!1}),V.success("Se han restablecido los datos")},onCancel:()=>{V.success("Se han mantenido los datos de la cotización")}})}async function G(){try{C(!0);const _=await HJ(o,a,d);await MV(u,_,N)}catch(_){console.error("Error al descargar la cotización:",_)}finally{C(!1)}}const Q=async()=>{const{isValid:_,message:L}=$r(a);try{await DK(o,a),So(),i(!1),Be.success({message:"Preorden guardada con éxito",type:"success"})}catch(H){console.error("Error al guardar la preorden:",H)}},ae=!e||E||!T.isValid,oe=m.useMemo(()=>E?"Complete todos los datos del formulario de autorización de seguro para continuar.":T.isValid?null:T.message,[E,T]),Z={direct:{text:"Facturar",action:R,disabled:ae},deferred:{text:"Preventa",action:()=>i(!0),disabled:ae},default:{text:"Sin accion",action:void 0,disabled:!0}},{text:J,action:X,disabled:me}=Z[j==null?void 0:j.billingMode]||Z.default,fe=[(d==null?void 0:d.quoteEnabled)&&{text:v?"Cargando...":"Cotización",action:G,icon:v?t.jsx(He,{size:"small"}):z.quotation.quote,disabled:ae||v},{text:"Cancelar venta",action:()=>So({dispatch:w,closeInvoicePanel:!1}),icon:z.operationModes.close,disabled:!e&&!(j!=null&&j.isLoading)}].filter(Boolean);return t.jsxs(m.Fragment,{children:[v&&t.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(255,255,255,0.7)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(He,{tip:"Cargando cotización...",size:"large"})}),t.jsxs(sX,{children:[t.jsxs(Io,{children:[t.jsx(Vn,{children:"SubTotal:"}),t.jsx(Vn,{children:Y(h)})]}),t.jsxs(Io,{children:[t.jsx(Vn,{children:"ITBIS:"}),t.jsx(Vn,{children:Y(f)})]}),t.jsx(PK,{}),"        ",t.jsxs(Io,{children:[t.jsx(Vn,{children:"Descuento:"}),P?t.jsxs(Vn,{style:{color:"#52c41a",fontWeight:600},children:["-",Y(A)]}):t.jsx(SK,{discount:I,value:x,options:["10","20","30","40","50"],disabled:P})]}),S&&t.jsxs(Io,{children:[t.jsx(Vn,{children:"Cobertura:"}),t.jsx(Vn,{children:Y(c)})]}),oe&&t.jsx(QJ,{message:oe}),t.jsxs(oX,{children:[t.jsx(rX,{onClick:X,disabled:me,title:oe||"",children:J}),t.jsx(OK,{disabled:me,options:fe}),t.jsx(VJ,{ref:g,data:y}),t.jsx(iX,{children:t.jsx(Kd,{value:Y(p)})})]})]}),t.jsx(RK,{open:r,onCancel:()=>i(!1),onConfirm:Q,preorder:{data:a}})]})},sX=l.div`
  border-radius: 5px;
  padding: 0px 10px;
  position: relative;
`,Io=l.div`
  display: flex;
  justify-content: space-between;
  padding: 2px 0;
  :first-child {
    border-bottom: 1px solid #ccc;
  }
  :last-child {
    border-top: 1px solid #ccc;
    padding: 0;
  }
 
  align-items: center;
`,oX=l(Io)`
`,rX=l.button`
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 5px;
  padding: 8px 12px;
  cursor: pointer;
  :disabled {
    background-color: #8a8a8a;
    cursor: not-allowed;
    :hover {
      background-color: #585858;
    }
  }
  :not(:disabled):hover {
    background-color: #0056b3;
  }
`,iX=l.span`
  font-weight: bold;
  font-size: 1.2em;
  height: 2.4em;
  display: grid;
  align-content: center;
`,Vn=l.span`
  font-weight: 500;
  white-space: nowrap;
  font-size: 14px;
 `,aX=()=>{const e=D(RD);return t.jsxs(cX,{isOpen:e,children:[t.jsx(EX,{}),t.jsx(xK,{}),t.jsx(nX,{})]})},cX=l.div`
  position: relative;
   background-color: ${({theme:e})=>e.bg.shade};
   max-width: 30em;
   width: 24em;
   overflow: hidden;
   display: grid;
   grid-template-rows: min-content 1fr min-content ;
   padding: 0 ;
   margin: 0;
   gap: 0.4em;
   transition: width 600ms 0ms linear;
   @media(max-width: 800px){
      height: calc(100vh);
      width: 100%;
      max-width: 100%;
      border: 1px solid rgba(0, 0, 0, 0.121);
      border-top: 0;

      border-bottom: 0;
      position: absolute;
      top: 0;
      z-index: 1000;
 
      transition: transform 600ms 0ms linear;
      
      ${e=>{switch(e.isOpen){case!1:return`
              transform: translateX(-100%);
              position: absolute;
              z-index: 1;
            `}}}
   
   }
   
`,lX=({children:e})=>{const n=D(q),s=Fe();return m.useEffect(()=>{n===null&&s("/",{replace:!0})},[n]),n?e:null},$j=(e,n)=>{const{name:s,type:o}=n.target;let r;switch(o){case"checkbox":r=n.target.checked;break;case"number":r=Number(n.target.value)||0;break;default:r=n.target.value}let i=JSON.parse(JSON.stringify(e));const a=s.split(".");let c=i;for(let d=0;d<a.length;d++){const u=a[d];d===a.length-1?c[u]=r:(c[u]=c[u]||{},c=c[u])}return i},dX=({mode:e})=>{const n=W(),s=D(Ht),o=(s==null?void 0:s.name)&&(s==null?void 0:s.name)!=="Generic Client"||e,[r,i]=m.useState(0),c=D(q).businessID,[d,u]=m.useState(!1),p=m.useRef(null),h=cs();kt(p,d,()=>u(!1),"mousedown"),Ho(c,s.id,i);const f=()=>{n($c({isOpen:!0,paymentDetails:{paymentScope:"balance",paymentOption:"installment",totalAmount:r,clientId:s.id}}))},x=b=>{n(Ba($j(s,b)))},g=()=>{u(!d)},y=t.jsxs(t.Fragment,{children:[t.jsx(SX,{children:t.jsxs(IX,{children:[t.jsx(Dt,{size:"small",type:"text",name:"tel",label:"Teléfono",labelVariant:"primary",value:s.tel,onChange:x,autoComplete:"off"}),t.jsx(Dt,{type:"text",name:"tel2",label:"Teléfono 2",size:"small",labelVariant:"primary",value:s==null?void 0:s.tel2,onChange:x,autoComplete:"off"})]})}),t.jsx(wX,{children:t.jsx(Dt,{type:"text",name:"address",label:"Dirección",labelVariant:"primary",size:"small",value:s.address,onChange:x,autoComplete:"off"})})]});return o&&t.jsxs(uX,{children:[t.jsxs(pX,{children:[t.jsxs(gX,{children:[t.jsxs(mX,{children:[t.jsx(hX,{children:`#${s==null?void 0:s.numberId}`}),h&&t.jsx(xX,{onClick:g,isExpanded:d,children:t.jsx(bX,{isExpanded:d,children:"▼"})})]}),t.jsx(Dt,{type:"text",name:"personalID",label:"Cédula/RNC",size:"small",labelVariant:"primary",value:s.personalID,onChange:x,autoComplete:"off"}),t.jsx(fX,{children:t.jsx(Dt,{type:"text",label:"Bal general",size:"small",labelVariant:"primary",value:Y(r),autoComplete:"off",buttons:[{name:"Pagar",onClick:f,disabled:r===0,color:"primary"}]})})]}),t.jsx(t.Fragment,{children:!h&&y})]}),h?t.jsx(gt,{children:d&&t.jsxs(yX,{ref:p,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[t.jsxs(vX,{children:[t.jsx(jX,{children:"Detalles del cliente"}),t.jsx(CX,{onClick:g,children:"×"})]}),y]})}):null]})},uX=l.div`
   position: relative;
   padding: 0em 0.4em 0em;
   border-bottom-left-radius: 6px;
   border-bottom-right-radius: 6px;
   gap: 0.6em;
`,pX=l.div`
   display: grid;
   gap: 0.6em;
   width: 100%;
`,mX=l.div`
   display: flex;
   flex-direction: column;
   align-items: center;
   
`,hX=l.div`
   font-weight: 500;
   line-height: 18px;
   color: var(--Gray6);
   white-space: nowrap;
`,gX=l.div`
   display: flex;
   flex: 1;
   gap: 0.4em;
   align-items: center;
`,fX=l.div`
   display: flex;
   gap: 0.2em;
   align-items: center;
`,xX=l.button`
   width: 18px;
   height: 18px;
   border-radius: 50%;
   background: white;
   border: 1px solid #ddd;
   display: flex;
   align-items: center;
   justify-content: center;
   cursor: pointer;
   box-shadow: 0 1px 2px rgba(0,0,0,0.1);
   outline: none;
   transition: all 0.2s;
   padding: 0;
   
   &:hover {
      background: #f5f5f7;
   }
   
   &:active {
      transform: scale(0.95);
   }
`,bX=l.span`
   font-size: 8px;
   color: #666;
   transform: ${e=>e.isExpanded?"rotate(180deg)":"rotate(0)"};
   transition: transform 0.3s;
   display: flex;
   align-items: center;
   justify-content: center;
   margin-top: ${e=>e.isExpanded?"-1px":"1px"};
`,yX=l(Ie.div)`
   position: absolute;
   top: 100%;
   left: 0;
   right: 0;
   background: white;
   border: 1px solid #eee;
   border-radius: 6px;
   padding: 0.6em;
   box-shadow: 0 2px 8px rgba(0,0,0,0.1);
   z-index: 5;
   display: grid;
   gap: 0.6em;
`,vX=l.div`
   display: flex;
   justify-content: space-between;
   align-items: center;
   border-bottom: 1px solid #eee;
   padding-bottom: 0.5em;
   margin-bottom: 0.3em;
`,jX=l.h3`
   font-size: 0.9rem;
   font-weight: 500;
   color: var(--Gray6);
   margin: 0;
`,CX=l.button`
   background: transparent;
   border: none;
   color: #999;
   font-size: 1.2rem;
   cursor: pointer;
   display: flex;
   align-items: center;
   justify-content: center;
   width: 24px;
   height: 24px;
   border-radius: 50%;
   transition: all 0.2s;
   
   &:hover {
      background: #f5f5f7;
      color: #666;
   }
   
   &:active {
      transform: scale(0.95);
   }
`,wX=l.div`
   display: grid;
   gap: 0.6em;
`,SX=l.div`
   display: flex;
   gap: 0.6em;
   width: 100%;
`,IX=l.div`
   display: flex;
   gap: 0.4em;
   align-items: center;
   width: 100%;
`;l.div`
   border-top: 1px solid #eee;
   padding-top: 0.6em;
   margin-top: 0.3em;
   display: grid;
   gap: 0.6em;
`;l.h4`
   font-size: 0.85rem;
   font-weight: 500;
   color: var(--Gray6);
   margin: 0 0 0.3em 0;
`;const EX=()=>{var P;const e=W(),n=D(ft),s=D(Ht),o=D(Hb),r=D($0),i=(P=r==null?void 0:r.settings)==null?void 0:P.taxReceiptEnabled,a=D(Qb),[c,d]=m.useState(),u=wj(),p=D(D0),h=cs(),f=()=>e(ko(!1)),x=w=>e(pD(w)),g=()=>e(Pn({mode:_e.CREATE.id,data:null,addClientToCart:!0})),y=()=>e(Pn({mode:_e.UPDATE.id,data:s,addClientToCart:!0})),b=()=>{e(Gu()),e(Vu()),e(kD()),e(sl(!1))},v=w=>{o===at.SEARCH.id&&x(w.target.value),(o===at.UPDATE.id||o===at.CREATE.id)&&e(Ba($j(s,w)))},C=w=>{const S=w.target.checked;e(sl(S))};m.useEffect(()=>{switch(o){case at.SEARCH.id:d(at.SEARCH.icon),x("");break;case at.UPDATE.id:d(at.UPDATE.icon),f();break;case at.CREATE.id:d(at.CREATE.icon),f();break}},[o]),m.useEffect(()=>{e(xD(s))},[s]),m.useEffect(()=>{s!=null&&s.id||e(sl(!1))},[s,e]);const I=m.useRef(null),j=()=>{switch(o){case at.CREATE.id:f();break;case at.SEARCH.id:e(ko(!0));break;case at.UPDATE.id:e(ko(!0));break}},k=()=>e(kc()),A=Pu();return t.jsxs(AX,{ref:I,children:[t.jsx(kX,{children:t.jsxs(TX,{"data-client-control-input":"true",children:[t.jsx(ie,{prefix:c,placeholder:"Buscar cliente...",value:o===at.SEARCH.id?a:s.name,onChange:w=>v(w),onClick:j,style:{width:"100%"},allowClear:!0,onClear:b,"data-client-control-input":"true"}),o===at.SEARCH.id&&t.jsx(Rl,{color:"blue",variant:"solid",icon:z.operationModes.add,onClick:g,"data-client-control-input":"true",children:"Cliente"}),o===at.UPDATE.id&&t.jsx(Rl,{type:"primary",icon:z.operationModes.edit,onClick:y,"data-client-control-input":"true",children:"Cliente"}),!A&&t.jsx(Rl,{onClick:k,"data-client-control-input":"true",children:"Volver"})]})}),t.jsx(dX,{mode:o===at.CREATE.id}),i&&t.jsxs(PX,{children:[t.jsx(ge,{style:{width:200},value:p,onChange:w=>e(P0(w)),children:t.jsx(ge.OptGroup,{label:"Comprobantes Fiscal",children:u.taxReceipt.filter(w=>{var S;return!((S=w.data)!=null&&S.disabled)}).map(({data:w},S)=>t.jsx(ge.Option,{value:w.name,children:w.name},S))})}),(n==null?void 0:n.businessType)==="pharmacy"&&t.jsx(St,{onChange:C,disabled:!(s!=null&&s.id),checked:h,children:"Seguro"})]})]})},AX=l.div`
    position: relative;
    display: grid;
    gap: 6px;
    margin: 0;
    border: 0;
    width: 100%;
`,kX=l.div`
   width: 100%;
   display: flex;
   align-items: center; 
   justify-content: space-between;
   height: 2.75em;
   position: relative;
   z-index: 10;
   background-color: var(--Gray8);
   border-bottom-left-radius: var(--border-radius-light);
   padding: 0.5em;
   
   .ant-input-affix-wrapper {
      border-right: none;
   }
`,TX=l.div`
   display: flex;
   width: 100%;
   
   .ant-input-affix-wrapper {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
   }
`,Rl=l(U)`
   border-radius: 0;
   height: 32px;
   display: flex;
   align-items: center;
   justify-content: center;
   
   &.ant-btn-primary {
      background-color: #1890ff;
   }
   
   &:last-child {
      border-top-right-radius: 4px;
      border-bottom-right-radius: 4px;
   }
`,PX=l.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 0 6px;

  .ant-select {
    width: 200px;
  }

  .ant-select:hover {
    border-color: var(--primary-color);
  }
`,DX=({isOpen:e})=>{const n=W(),[s,o]=m.useState({name:"",address:"",tel:"",email:"",id:be(4),personalID:""}),r=c=>{o({...s,[c.target.name]:c.target.value})},i=()=>n(TP()),a=async()=>{try{const c=F($,"client",s.id);await De(c,{client:s}),i()}catch(c){console.error("Error adding document: ",c)}};return t.jsx(fp,{isOpen:e,nameRef:"Agregar Cliente",btnSubmitName:"Guardar",close:i,handleSubmit:a,children:t.jsx($X,{children:t.jsxs(RX,{children:[t.jsxs(pr,{children:[t.jsx(mr,{id:"nombre",children:"Nombre Completo:"}),t.jsx(Dt,{id:"name",name:"name",onChange:r,placeholder:"Nombre"})]}),t.jsxs(pr,{children:[t.jsx(mr,{children:"Identificación"}),t.jsx(Dt,{id:"DocumentType",name:"personalID",onChange:c=>o({...s,personalID:c.target.value}),placeholder:"RNC / Cédula"})]}),t.jsxs(pr,{span:"2",children:[t.jsx(mr,{children:"Dirección: "}),t.jsx(Dt,{name:"address",onChange:r,placeholder:"Dirección"})]}),t.jsxs(pr,{children:[t.jsx(mr,{children:"Teléfono:"}),t.jsx(Dt,{name:"tel",placeholder:"Teléfono",pattern:"[0-9]{3}-[0-9]{3}-[0-9]{4}",onChange:c=>o({...s,tel:c.target.value})})]}),t.jsxs(pr,{children:[t.jsx(mr,{children:"Correo:"}),t.jsx(Dt,{name:"email",onChange:r,placeholder:"ejemplo@ejemplo.com"})]})]})})})},$X=l.div`
    padding: 1em;
    `,RX=l.form`
 
    display: grid;
    grid-template-columns: repeat( 2, 1fr);
    flex-wrap: wrap;
    gap: 1em;
    overflow: auto;
 
`,pr=l.div`
display: grid;
gap: 1em;


${e=>{switch(e.span){case"2":return`
            grid-column: 2 span;
            label{
                word-wrap: break-word;
            }
            input{
                width: 100%;
            }
           `}}}

`,mr=l.label`
 margin: 0 1em 0 0;
`,NX=l.div`
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: 8px 0;
  border-bottom: 1px solid #f0f0f0;
  
  &:last-child {
    border-bottom: none;
  }
`,OX=l.div`
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 8px;
  align-items: center;
  font-size: 0.9em;
`,MX=({differences:e})=>t.jsx(Sn,{size:"small",dataSource:e,renderItem:n=>t.jsxs(NX,{children:[t.jsx("strong",{children:n.label}),t.jsxs(OX,{children:[t.jsx("span",{children:n.currentValue||"(vacío)"}),t.jsx(Pa,{}),t.jsx("span",{children:n.dgiiValue||"(vacío)"})]})]})}),Rj=({differences:e,onSync:n,loading:s})=>{if(!(e!=null&&e.length))return null;const o=t.jsx("div",{style:{maxWidth:300},children:t.jsx(MX,{differences:e})});return t.jsx(Pt,{message:t.jsxs(Ye,{children:[t.jsx("span",{children:"Datos no sincronizados con DGII"}),t.jsx(Vw,{title:"Diferencias encontradas",content:o,trigger:"click",children:t.jsx(Ge,{color:"warning",style:{cursor:"pointer"},children:"Ver diferencias"})})]}),type:"warning",showIcon:!0,action:t.jsx(U,{icon:t.jsx(Pa,{spin:s}),onClick:n,loading:s,children:"Sincronizar con DGII"})})},{Text:VCe,Paragraph:GCe}=Xe;l.div`
  padding: 16px;
  border-radius: 8px;
  margin: 16px 0;
  position: relative;
  overflow: hidden;
  border: 1px solid;

  ${({$status:e})=>{switch(e){case"ACTIVO":return`
          background: #f6ffed;
          border-color: #b7eb8f;
          .icon { color: #52c41a; }
        `;case"SUSPENDIDO":return`
          background: #fffbe6;
          border-color: #ffe58f;
          .icon { color: #faad14; }
        `;case"DADO DE BAJA":return`
          background: #fff2f0;
          border-color: #ffccc7;
          .icon { color: #ff4d4f; }
        `;default:return`
          background: #f5f5f5;
          border-color: #d9d9d9;
          .icon { color: #8c8c8c; }
        `}}}

  .details-section {
    margin-top: 12px;
    padding: 12px;
    border-radius: 6px;
    font-size: 13px;
    line-height: 1.5;
    
    ${({$status:e})=>{switch(e){case"ACTIVO":return`
            background: #f6ffed;
            color: #135200;
          `;case"SUSPENDIDO":return`
            background: #fff7e6;
            color: #874d00;
          `;case"DADO DE BAJA":return`
            background: #fff1f0;
            color: #a8071a;
          `;default:return`
            background: #fafafa;
            color: #262626;
          `}}}
  }

  .details-list {
    margin: 8px 0 0 0;
    padding-left: 0;
    list-style-type: none;

    li {
      position: relative;
      padding-left: 12px;
      margin-bottom: 4px;

      &:before {
        content: "•";
        position: absolute;
        left: 0;
        color: currentColor;
        opacity: 0.7;
      }
    }
  }
`;l.div`
  font-size: 20px;
  margin-right: 12px;
`;l.div`
  display: flex;
  align-items: flex-start;
`;const FX=async(e,n)=>{if(!(!n||!(n!=null&&n.businessID))){e={...e,id:be(10),createdAt:ue.now(),status:"active"};try{const s=F($,"businesses",n.businessID,"providers",e.id);await De(s,{provider:e}),console.log("Document written with ID: ",e.id)}catch(s){console.error("Error adding document: ",s)}}},BX=async(e,n)=>{if(!n||!(n!=null&&n.businessID))return;const s=F($,"businesses",n.businessID,"providers",e.id);await je(s,{provider:e}).then(()=>{console.log("product from firebase",e)})},Kg=(e,n="DO")=>{if(!e)return"";try{let s=e;if(!e.startsWith("+")){const r=Br(n);s=e.startsWith(r)?`+${e}`:`+${r}${e.replace(/^0+/,"")}`}const o=m0(s,n);return o?o.formatInternational():e}catch(s){return console.warn("Error formatting phone number:",s),e}},LX=(e,n="DO")=>{if(!e)return"";try{const s=m0(e,n);return s?s.number:e.replace(/[^\d+]/g,"")}catch(s){return console.warn("Error unformatting phone number:",s),e.replace(/[^\d+]/g,"")}},zX=(e,n="DO")=>{if(!e)return!1;try{let s=e;return e.startsWith("+")||(s=`+${Br(n)}${e.replace(/^0+/,"")}`),fS(s,n)}catch(s){return console.warn("Error validating phone number:",s),!1}},Nj=[{value:"01",label:"Factura de Crédito Fiscal",description:"Registra transacciones comerciales de bienes/servicios. Permite sustentar gastos y créditos de ISR o ITBIS."},{value:"02",label:"Factura de Consumo",description:"Acredita transferencias de bienes o servicios a consumidores finales. Sin efectos tributarios."},{value:"03",label:"Nota de Débito",description:"Documento emitido para recuperar costos como intereses, fletes, tras emitir el comprobante fiscal."},{value:"04",label:"Nota de Crédito",description:"Documento emitido para anular operaciones, efectuar devoluciones, conceder descuentos o corregir errores."},{value:"11",label:"Comprobante de Compra",description:"Emitido al adquirir bienes o servicios de personas no registradas como contribuyentes."},{value:"12",label:"Comprobante de Registro Único de Ingresos",description:"Resumen de transacciones diarias a consumidores finales, generalmente exentos de ITBIS."},{value:"13",label:"Comprobante para Gastos Menores",description:"Para sustentar pagos menores relacionados con actividades laborales, como transporte o consumibles."},{value:"14",label:"Comprobante para Regímenes Especiales",description:"Utilizado en ventas o servicios exentos a personas bajo regímenes tributarios especiales."},{value:"15",label:"Comprobante Gubernamental",description:"Utilizado para facturar bienes/servicios al Gobierno Central y entidades relacionadas."},{value:"16",label:"Comprobante para Exportaciones",description:"Usado para reportar ventas de bienes fuera del territorio nacional por exportadores y zonas francas."},{value:"17",label:"Comprobante para Pagos al Exterior",description:"Emitido para pagos de rentas gravadas a personas no residentes fiscales, incluye retención del ISR."},{value:"e-CF",label:"Comprobante Fiscal Electrónico",description:"Documento digital que acredita transferencias de bienes o prestación de servicios cumpliendo normativa."}],UX="https://safxuhklxqxkcbvvgjgi.supabase.co",WX="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNhZnh1aGtseHF4a2NidnZnamdpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzMyNDQ1MjUsImV4cCI6MjA0ODgyMDUyNX0.gimVwYN5MxRbAy3HUc8ABv8aXphhRdwc9RUEnYt3ivg",qX=mS(UX,WX),Nl={rnc:{formKey:"rnc",dgiiKey:"rnc_number",label:"RNC"},personalID:{formKey:"personalID",dgiiKey:"rnc_number",label:"Cédula/RNC"}},Ol=[{formKey:"name",dgiiKey:"full_name",label:"Nombre"}],Oj=(e,n="rnc")=>{const[s,o]=m.useState(!1),[r,i]=m.useState(""),[a,c]=m.useState(null),[d,u]=m.useState([]),p=()=>{c(null),u([]),i("")},h=m.useCallback((g,y)=>{if(!y)return u([]),!1;const v=[...Ol,Nl[n]].reduce((C,I)=>{const j=g[I.formKey],k=y[I.dgiiKey];return j&&k&&j!==k&&C.push({field:I.formKey,label:I.label,currentValue:j,dgiiValue:k}),C},[]);return u(v),v.length>0},[n]);return{loading:s,error:r,rncInfo:a,differences:d,consultarRNC:async(g,y=!1)=>{if(!g){p();return}y||p();try{if(o(!0),!/^\d{9,11}$/.test(g))throw p(),new Error("El número debe tener entre 9 y 11 dígitos.");const{data:b,error:v}=await qX.from("rnc").select("*").eq("rnc_number",g).single();if(v)throw v;if(!b)throw p(),new Error("No se encontraron resultados para el número ingresado.");c(b);const I=[...Ol,Nl[n]].reduce((k,A)=>(b[A.dgiiKey]&&(k[A.formKey]=b[A.dgiiKey]),k),{});e.setFieldsValue(I);const j=e.getFieldsValue();return h(j,b),b}catch{return p(),y||i("No se pudo consultar el RNC. Intente de nuevo más tarde."),null}finally{o(!1)}},syncWithDgii:async()=>{if(!a){p();return}o(!0);try{const y=[...Ol,Nl[n]].reduce((v,C)=>(a[C.dgiiKey]&&(v[C.formKey]=a[C.dgiiKey]),v),{});await e.setFieldsValue(y);const b=e.getFieldsValue();return h(b,a),u([]),!0}catch(g){return console.error("Error syncing with DGII:",g),!1}finally{o(!1)}},compareDgiiData:h,setError:i}},VX=l.div`
  padding: 24px;
  background-color: #fff;
  border-radius: 4px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  height: fit-content;
  position: sticky;
  top: 10px;
  border: 1px solid #f0f0f0;
  position: relative;
`,GX=l.div`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.8);
  z-index: 1;
  border-radius: 4px;
`,_X=l.div`
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid #f0f0f0;
`,HX=l.h3`
  color: #262626;
  font-size: 16px;
  margin: 0;
  font-weight: 500;
`,QX=l.p`
  color: #8c8c8c;
  font-size: 13px;
  margin: 4px 0 0 0;
`,YX=l.div`
  display: grid;
  gap: 16px;
`,zs=l.div`
  display: grid;
  grid-template-columns: 120px 1fr;
  align-items: baseline;
  gap: 12px;

  label {
    color: #595959;
    font-size: 13px;
  }

  span {
    color: #262626;
    font-size: 14px;
  }
`;l(zs)`
  align-items: center;
  
  .status-btn {
    margin-left: 8px;
    padding: 0 8px;
    height: 24px;
    font-size: 12px;
  }
`;const KX=l.div`
  padding: 16px;
  border-radius: 8px;
  margin-top: 16px;
  position: relative;
  border: 1px solid;

  ${({$status:e})=>{switch(e){case"ACTIVO":return`
          background: #f6ffed;
          border-color: #b7eb8f;
          .icon { color: #52c41a; }
          .details-section { color: #135200; }
        `;case"SUSPENDIDO":return`
          background: #fffbe6;
          border-color: #ffe58f;
          .icon { color: #faad14; }
          .details-section { color: #874d00; }
        `;case"DADO DE BAJA":return`
          background: #fff2f0;
          border-color: #ffccc7;
          .icon { color: #ff4d4f; }
          .details-section { color: #a8071a; }
        `;default:return`
          background: #f5f5f5;
          border-color: #d9d9d9;
          .icon { color: #8c8c8c; }
          .details-section { color: #262626; }
        `}}}

  .details-section {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px dashed currentColor;
    opacity: 0.9;
  }

  .details-list {
    margin: 8px 0 0 0;
    padding-left: 16px;
    list-style-type: none;

    li {
      position: relative;
      padding-left: 12px;
      margin-bottom: 4px;
      font-size: 14px;

      &:before {
        content: "•";
        position: absolute;
        left: 0;
        opacity: 0.7;
      }
    }
  }
`,JX={ACTIVO:{color:"success",title:"RNC Activo",description:"Contribuyente habilitado para fines tributarios.",details:`• Habilitado para todos los servicios de la DGII
      • Puede emitir y recibir comprobantes fiscales
      • Debe mantener sus obligaciones tributarias al día`,icon:$o},SUSPENDIDO:{color:"warning",title:"Estado Suspendido",description:"Contribuyente en incumplimiento prolongado.",details:`• Inhabilitado para solicitar nuevos comprobantes fiscales
      • Inadmisibilidad de deducción por comprobantes fiscales
      • Restricciones en trámites administrativos
      • Mantiene acceso a Oficina Virtual
      • Puede reactivarse presentando declaraciones pendientes
      • No requiere pago de multa para reactivación`,icon:cc},"DADO DE BAJA":{color:"error",title:"Estado Dado de Baja",description:"Cese definitivo de operaciones comerciales.",details:`• RNC inhabilitado
      • Comprobantes fiscales inhabilitados
      • Sin obligaciones tributarias activas
      • Debe solicitar reactivación para operar`,icon:r0}},Mj=({rncInfo:e,loading:n})=>{const s=a=>{try{return ce.fromISO(a).setLocale("es").toFormat("dd/MM/yyyy")}catch{return a}};if(!e&&!n)return null;const o=e==null?void 0:e.status,r=JX[o]||{title:"Estado No Especificado",description:"No hay información disponible",details:"",icon:eS},i=a=>a.split(`
`).map((c,d)=>{const u=c.trim();return u.startsWith("•")?t.jsx("li",{children:u.substring(1).trim()},d):null}).filter(Boolean);return t.jsxs(VX,{children:[n&&t.jsx(GX,{children:t.jsx(He,{tip:"Consultando RNC..."})}),t.jsxs(_X,{children:[t.jsx(HX,{children:"Datos Registrados DGII"}),t.jsx(QX,{children:"Información oficial del contribuyente"})]}),t.jsxs(YX,{style:{opacity:n?.6:1},children:[t.jsxs(zs,{children:[t.jsx("label",{children:"Número RNC:"}),t.jsx("span",{children:e==null?void 0:e.rnc_number})]}),t.jsxs(zs,{children:[t.jsx("label",{children:"Razón Social:"}),t.jsx("span",{children:e==null?void 0:e.full_name})]}),t.jsxs(zs,{children:[t.jsx("label",{children:"Nombre Comercial:"}),t.jsx("span",{children:e==null?void 0:e.business_name})]}),t.jsxs(zs,{children:[t.jsx("label",{children:"Actividad:"}),t.jsx("span",{children:e==null?void 0:e.business_activity})]}),t.jsxs(zs,{children:[t.jsx("label",{children:"Fecha de Registro:"}),t.jsx("span",{children:s(e==null?void 0:e.registration_date)})]}),t.jsxs(zs,{children:[t.jsx("label",{children:"Condición:"}),t.jsx("span",{children:e==null?void 0:e.condition})]})]}),t.jsx(KX,{$status:o,children:t.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"flex-start"},children:[t.jsx("span",{className:"icon",style:{fontSize:"20px"},children:m.createElement(r.icon)}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500,marginBottom:"4px"},children:r.title}),t.jsx("div",{style:{fontSize:"14px"},children:r.description}),r.details&&t.jsx("div",{className:"details-section",children:t.jsx("ul",{className:"details-list",children:i(r.details)})})]})]})})]})},XX=async(e,n,s,o=null)=>{const r=le($,"businesses",e,"providers"),i=he(r,te("provider.rnc","==",n)),a=await Me(i),c=he(r,te("provider.name","==",s)),d=await Me(c),u={rnc:!1,name:!1};return a.forEach(p=>{p.data().provider.id!==o&&(u.rnc=!0)}),d.forEach(p=>{p.data().provider.id!==o&&(u.name=!0)}),u},{TextArea:Jg}=ie,Hi=_e.CREATE.id,Xg=_e.UPDATE.id,ZX=l.div`
    display: grid;
    gap: 1em;
    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
`,eZ=xS().map(e=>{const n=bS[e];return{value:e,label:t.jsxs(Ye,{children:[n&&t.jsx(n,{style:{width:"1em"}}),t.jsx("span",{children:e}),t.jsxs("span",{style:{color:"#888",fontSize:"0.9em"},children:["(+",Br(e),")"]})]}),searchText:`${e} +${Br(e)}`}}),Ml=({children:e})=>t.jsxs("span",{children:[e,t.jsx("span",{style:{color:"#999",marginLeft:"4px",fontSize:"13px"},children:"(Opcional)"})]}),tZ=()=>{const e=W(),{isOpen:n,mode:s,data:o}=D(xb);_e.UPDATE.id;const r=D(q),[i]=M.useForm(),[a,c]=m.useState("DO"),{loading:d,error:u,rncInfo:p,differences:h,consultarRNC:f,syncWithDgii:x,compareDgiiData:g}=Oj(i),[y,b]=m.useState(!1),v=M.useWatch([],i);m.useEffect(()=>{p&&v&&g(v,p)},[v,p,g]),m.useEffect(()=>{s===Xg&&o?(i.setFieldsValue(o),o.rnc&&f(o.rnc)):i.setFieldsValue({email:"",notes:""})},[s,o,i]);const C=()=>{e(Ys({mode:Hi})),i.resetFields()},I=async()=>{try{const w=await i.validateFields();if((p==null?void 0:p.status)==="DADO DE BAJA"){b(!0);return}await j(w)}catch(w){V.error({content:"Error al procesar el proveedor",key:"providerSubmit"}),console.error("Error en proveedor:",w)}},j=async w=>{try{V.loading({content:"Validando...",key:"providerSubmit"});const S=await XX(r.businessID,w.rnc.trim(),w.name.trim(),s===Xg?o.id:null);if(S.rnc||S.name){let T="";S.rnc&&(T+="Ya existe un proveedor con este RNC. "),S.name&&(T+="Ya existe un proveedor con este nombre. "),V.error({content:T.trim(),key:"providerSubmit"});return}const E={...w,tel:LX(w.tel),email:w.email||"",notes:w.notes||"",address:w.address||""};s===Hi?(await FX(E,r),V.success({content:"Proveedor creado exitosamente",key:"providerSubmit"})):(await BX({...E,id:o.id},r),V.success({content:"Proveedor actualizado exitosamente",key:"providerSubmit"})),C()}catch(S){V.error({content:"Error al procesar el proveedor",key:"providerSubmit"}),console.error("Error en proveedor:",S)}},k=w=>{const{value:S}=w.target,E=Kg(S,a);i.setFieldsValue({tel:E})},A=w=>{c(w);const S=i.getFieldValue("tel");if(S){const E=Kg(S,w);i.setFieldsValue({tel:E})}},P=w=>{var E;const S=(E=w||i.getFieldValue("rnc"))==null?void 0:E.trim();S&&S.length>=9&&S.length<=11&&f(S)};return t.jsx(t.Fragment,{children:t.jsx(Ce,{title:s===Hi?"Nuevo Proveedor":"Editar Proveedor",open:n,onCancel:C,footer:[t.jsx(U,{onClick:C,children:"Cancelar"},"cancel"),t.jsx(U,{type:"primary",onClick:()=>i.submit(),children:s===Hi?"Crear":"Actualizar"},"submit")],closeIcon:t.jsx(O,{icon:_r}),width:1e3,style:{maxWidth:p?"1000px":"700px",top:10},children:t.jsxs(ZX,{children:[t.jsxs("div",{children:[h.length>0&&t.jsx(Rj,{differences:h,onSync:x,loading:d}),t.jsxs(M,{form:i,layout:"vertical",onFinish:I,children:[t.jsx(M.Item,{label:"RNC",name:"rnc",rules:[{transform:w=>w==null?void 0:w.trim(),required:!0,message:"Por favor, ingrese el RNC del proveedor."},{transform:w=>w==null?void 0:w.trim(),pattern:/^[0-9]{9,11}$/,message:"El RNC debe tener entre 9 y 11 dígitos."}],help:(p==null?void 0:p.status)==="SUSPENDIDO"?t.jsx("span",{style:{color:"#e49800",fontSize:"13px"},children:"⚠️ Este RNC se encuentra actualmente suspendido en la DGII"}):(p==null?void 0:p.status)==="DADO DE BAJA"?t.jsx("span",{style:{color:"#ff4d4f",fontSize:"13px"},children:"⚠️ Este RNC se encuentra dado de baja en la DGII"}):null,validateStatus:(p==null?void 0:p.status)==="SUSPENDIDO"||(p==null?void 0:p.status)==="DADO DE BAJA"?"warning":void 0,children:t.jsx(ie.Search,{placeholder:"101123456",enterButton:t.jsx(U,{type:"primary",icon:t.jsx(ha,{}),children:"Buscar RNC"}),onSearch:P,loading:d})}),u&&t.jsx("p",{style:{color:"red",marginTop:"-10px",marginBottom:"10px"},children:u}),t.jsx(M.Item,{label:t.jsxs("span",{children:["Nombre ",t.jsx(Oe,{title:"Nombre comercial del proveedor",children:t.jsx(a0,{})})]}),name:"name",rules:[{required:!0,message:"Por favor, ingrese el nombre del proveedor."},{min:3,message:"El nombre debe tener al menos 3 caracteres."},{max:100,message:"El nombre no puede exceder 100 caracteres."}],children:t.jsx(ie,{placeholder:"Ejemplo: Distribuidora XYZ"})}),t.jsx(M.Item,{label:t.jsx(Ml,{children:"Email"}),name:"email",rules:[{type:"email",message:"Por favor ingrese un email válido"}],children:t.jsx(ie,{placeholder:"ejemplo@dominio.com"})}),t.jsx(M.Item,{label:t.jsxs(Ye,{children:[t.jsx(ha,{}),t.jsx("span",{children:"Teléfono"})]}),style:{marginBottom:0},tooltip:"Seleccione el país y escriba el número sin código de área",children:t.jsxs(Ye.Compact,{style:{width:"100%"},children:[t.jsx(M.Item,{name:"country",initialValue:"DO",style:{marginBottom:0,width:"40%"},children:t.jsx(ge,{showSearch:!0,options:eZ,onChange:A,placeholder:t.jsxs(Ye,{children:[t.jsx(ha,{}),t.jsx("span",{children:"País"})]}),optionLabelProp:"label",filterOption:(w,S)=>S==null?void 0:S.searchText.toLowerCase().includes(w.toLowerCase()),popupMatchSelectWidth:!1,style:{minWidth:"150px"}})}),t.jsx(M.Item,{name:"tel",style:{flex:1},rules:[{validator:(w,S)=>S?zX(S,a)?Promise.resolve():Promise.reject(t.jsxs("span",{children:["Formato inválido para ",a,t.jsx("br",{})]})):Promise.resolve()}],children:t.jsx(ie,{onChange:k,placeholder:`Ejemplo: ${Br(a)} XX XXX XXXX`,type:"tel"})})]})}),t.jsx(M.Item,{label:t.jsx(Ml,{children:"Dirección"}),name:"address",children:t.jsx(Jg,{placeholder:"27 de Febrero #12, Ensanche Ozama, Santo Domingo",rows:5})}),t.jsx(M.Item,{label:"Tipo de Comprobante",name:"voucherType",rules:[{required:!0,message:"Por favor, seleccione un tipo de comprobante."}],children:t.jsx(ge,{allowClear:!0,placeholder:"Seleccione el tipo de comprobante",options:Nj})}),t.jsx(M.Item,{label:t.jsx(Ml,{children:"Notas"}),name:"notes",children:t.jsx(Jg,{placeholder:"Información adicional sobre el proveedor",rows:3})})]})]}),t.jsx("div",{children:t.jsx(Mj,{rncInfo:p,loading:d})})]})})})};l.div`
    display: grid;
    gap: 1em;
    grid-template-columns: 1fr min-content;
    align-items: center;
`;const nZ=({isOpen:e,data:n})=>{const s=W(),o=()=>s(PP({isOpen:"close"}));return t.jsx(sZ,{isOpen:e===!0&&n!==null,children:t.jsxs(oZ,{isOpen:e===!0,children:[t.jsxs(rZ,{children:[t.jsx(aZ,{children:t.jsx(O,{icon:vw})}),t.jsx(cZ,{children:t.jsx(lZ,{children:n!==""&&n!==null?n.note?n.note:"vacio":null})})]}),t.jsx(iZ,{children:t.jsx(ke,{borderRadius:"normal",title:"ok",onClick:o})})]})})},sZ=l.div`
  height: 100%;
  width: 100vw;
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  z-index: 2;
  ${e=>{switch(e.isOpen){case!1:return`
          transform: scale(0);
          display: none;
        `}}}
`,oZ=l.div`
  background-color: #ffffff;
  height: min-content;
  max-width: 600px;
  width: 100%;
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  box-shadow: var(--box-shadow);
  color: #141414;
  display: grid;
  grid-template-rows: 1fr min-content;
  gap: 1em;
  grid-template-columns: 1fr;
  position: relative;
  align-items: center;
  padding: 0.5em 0;

  ${e=>{switch(e.isOpen){case!1:return`
          transform: scale(0);
        `}}}
`,rZ=l.div`
  height: 100%;
  max-width: 100%;
  width: 100%;
  overflow: hidden;
  padding: 1em 2em 1em 0;
  display: grid;
  grid-template-columns: 0.4fr 1fr;
  grid-template-rows: 1fr;

  @media (max-width: 1000px){
    border-radius: 0;
    height: min-content;
    grid-template-columns: 1fr;
    align-items: flex-start;
    align-content: flex-start;
    justify-content: center;
    grid-template-rows: auto;
  }
`,iZ=l.div`
  padding: 0 1em;
  display: flex;
  justify-content: flex-end;
`,aZ=l.div`
  width: 100%;
  height: min-content;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 70px;
  color: var(--font-color-dark-slightly);
`,cZ=l.div`
height: min-content;
width: 100%;
overflow: hidden;
overflow-wrap: break-word;
padding: 1em 2em;
`,lZ=l.p`
  width: 100%;
`,dZ=e=>{switch(e){case"success":return 4e3;case"error":return 1e4;case"warning":return 7e3;default:return 5e3}},uZ=()=>{const[e,n]=m.useState(null),s=D(cy),{title:o,message:r,type:i,visible:a}=s,c=W(),d=()=>{c(v$())};m.useEffect(()=>{a&&setTimeout(()=>{d()},dZ(6e3))},[a,c]),m.useEffect(()=>{if(i)switch(i){case"error":return n(t.jsx(O,{icon:jw}));case"success":return n(t.jsx(O,{icon:oc}));case"info":return n(t.jsx(O,{icon:Yx}));case"warning":return n(t.jsx(FaInfoCircle,{}));default:return n(null)}},[i]);const u={hidden:{y:-100,opacity:0,transition:{y:{duration:.1,ease:"easeInOut"},opacity:{delay:.8,duration:.5,ease:"easeInOut"}}},visible:{opacity:1,y:0,transition:{duration:.5,ease:"easeInOut"}}};return t.jsxs(pZ,{type:i,variants:u,initial:"hidden",animate:a?"visible":"hidden",exit:"hidden",children:[e?t.jsx(hZ,{type:i,children:e}):null,t.jsxs(mZ,{children:[o?t.jsx(Zg,{children:o}):t.jsx(Zg,{children:i}),r?t.jsx(gZ,{children:r}):null]}),t.jsx(ke,{borderRadius:"light",width:"icon24",startIcon:z.operationModes.close,onClick:d})]})},pZ=l(Ie.div)`
    max-width: 24em;
    width: 100%;
    min-height: 4em;
    height: auto;
    color: #fff;
    padding: 0.8em 0.4em 0.8em 1em;
    border-radius: 4px;
    display: grid;
    grid-template-columns: min-content 1fr min-content;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    background-color: var(--White);
    backdrop-filter: blur(20px);
    align-items: center;

svg{
    width: 1.4em;
    height: 1.4em;
}

gap: 1em;
position: fixed;
top: 2px;
margin: 0 auto;
left: 0;
right: 0;
z-index: 1000000000;
transform: translateY(-100px);
transition: transform 1s ease-in-out;

@media (max-width: 600px){
    width: 96%;
}

${e=>{switch(e.type){case"error":return`
                color: #5c5c5c;
                svg{
                    fill: #f18f8f;
                }
                `;case"success":return`
                color: #4e4e4e;
                svg{
                    fill: #8cd88c;
                }
                `;case"info":return`
                color: #4e4e4e;
                svg{
                    fill: #8cbcd8;
                }
                `;case"warning":return`
                color: #4e4e4e;
                svg{
                    fill: #e29843;
                }
                `;default:return`
                color: #4e4e4e;
                svg{
                    fill: #8cd88c;
                }
                `}}};
`,Zg=l.h2`
font-weight: 600;
font-size: 16px;
line-height: 14px;
margin: 0;
text-transform: capitalize;
`,mZ=l.div`
    display: grid;
    align-items: center;
    gap: 0.4em;
`,hZ=l.div`
     height: 2.4em;
    width: 2.8em;
    /*
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--border-radius); */
    height: 100%;
    display: flex;
    align-items: center;
    svg{
        fill: white;
        font-size: 1.4em;
        
    }
  
    ${e=>{switch(e.type){case"error":return`  
                svg{

                    fill: #f18f8f;
                }             
                `;case"success":return`
                svg{
                    fill: #8cd88c;
                } 
           
                `;case"info":return`
                svg{
                    fill: #8cbcd8;
                }
                background-color: #8cbcd8;
                `;case"warning":return`
                svg{
                    fill: #FFCC00;
                }
              
                `;default:return`

                color: #4e4e4e;
              
                `}}};
`,gZ=l.p`
    font-size: 14px;
    line-height: 16px;
`,fZ=()=>{const e=D(Ku),n=W(),s=()=>{n(Ld()),Be.success({message:e?"Modo Producción":"Modo Prueba",description:e?"Las facturas ahora se guardarán en la base de datos.":"Las facturas se procesarán como prueba sin afectar los datos.",duration:4})};return e?t.jsxs(bZ,{children:[t.jsx(yZ,{children:t.jsx(O,{icon:Cw})}),t.jsxs(vZ,{children:[t.jsx(jZ,{children:"Modo de Prueba"}),t.jsx(CZ,{children:"Las facturas no se guardan"})]}),t.jsx(wZ,{onClick:s,title:"Desactivar modo de prueba",children:t.jsx(O,{icon:_r})})]}):null},Fj=sn`
  0% { box-shadow: 0 0 20px rgba(255, 193, 7, 0.4); }
  50% { box-shadow: 0 0 80px rgba(255, 193, 7, 0.6), 0 0 40px rgba(255, 193, 7, 0.3); }
  100% { box-shadow: 0 0 20px rgba(255, 193, 7, 0.4); }
`,xZ=sn`
  from {
    transform: translate(-50%, -100%);
    opacity: 0;
  }
  to {
    transform: translate(-50%, 0);
    opacity: 1;
  }
`,bZ=l.div`
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10000;
  
  display: flex;
  align-items: center;
  gap: 12px;
  
  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
  border: 2px solid #f39c12;
  border-radius: 50px;
  padding: 8px 16px 8px 8px;
  
  animation: ${xZ} 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55),
             ${Fj} 2s ease-in-out infinite;
  
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.3),
    0 0 20px rgba(255, 193, 7, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  
  transition: all 0.3s ease;
  
  &:hover {
    transform: translateX(-50%) scale(1.01);
    box-shadow: 
      0 12px 40px rgba(0, 0, 0, 0.4),
      0 0 30px rgba(255, 193, 7, 0.6),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
  }
`,yZ=l.div`
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 16px;
  box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
  
  /* animation: ${Fj} 2s ease-in-out infinite; */
`,vZ=l.div`
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 120px;
`,jZ=l.span`
  color: #ecf0f1;
  font-weight: 600;
  font-size: 14px;
  letter-spacing: 0.5px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
`,CZ=l.span`
  color: #bdc3c7;
  font-size: 11px;
  font-weight: 400;
  opacity: 0.9;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
`,wZ=l.button`
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: none;
  background-color: #292929;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  transition: all 0.2s ease;
  
  &:hover {
    background-color: #585858;
  }
`,SZ=()=>{const e=W(),n=D(F$),s=D(B$),o=m.useRef(null),r=()=>e(Ju({show:!1,url:""}));return kt(o,n,r),m.useEffect(()=>{const i=a=>{a.key==="Escape"&&r()};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[]),n?t.jsx(gt,{children:n&&t.jsxs(IZ,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[t.jsxs(AZ,{children:[t.jsx(Qe,{disableMargins:!0,variant:"h2",color:"light",children:"Visualizador de imagen"}),"            ",t.jsx(ke,{title:t.jsx(O,{icon:pa}),onClick:r})]}),s&&t.jsx(EZ,{ref:o,children:t.jsx(yS,{minScale:1,maxScale:2,wheel:{step:50},children:t.jsx(vS,{contentStyle:{width:"100%",height:"100%"},wrapperStyle:{width:"100%",height:"100%"},children:t.jsx("img",{src:s,alt:"Visualización de imagen",style:{width:"100%",objectFit:"contain"}})})})}),!s&&t.jsx(si,{textVariant:"h2",containerVariant:"contained",text:"No se proporciono una imagen para visualizar"})]})}):null},IZ=l(Ie.div)`
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.8);
  display: grid;
  gap: 0.5em;
  align-items: start;
  padding: 0.3em;
  z-index: 9999;
`,EZ=l.div`
    background-color: #000;
    width: calc(100%);
    height: calc(88vh);
    overflow: hidden;
   
    border-radius: 10px;
    object-fit: contain;

/* .content-style {
    width: 100%;
    height: 100%;
} */

 img{
  width: 100%;
  height: 100%;
  object-fit: contain;
 
  }
`,AZ=l.div`
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: #2e2e2e;
  border-radius: 10px;
  z-index: 9999;
  padding: 0.5em 1em;
`,{Title:kZ}=Xe,TZ=()=>{const{category:e,categoryState:n,onSubmit:s,onClose:o}=ai(),{type:r,isOpen:i}=n,[a]=M.useForm();m.useEffect(()=>{i&&a.setFieldsValue({name:e.name})},[i,e.name,a]);const c=async()=>{try{const{name:u}=await a.validateFields();if(alert(u),!u){Be.error({message:"El nombre de la categoría no puede estar vacío"});return}const p={...e,name:u};s(p),Be.success({message:r==="create"?"Categoría creada con éxito":"Categoría actualizada con éxito"}),a.resetFields(),o()}catch(u){console.error("Error al validar el formulario:",u)}},d=()=>{a.resetFields(),o()};return t.jsx(Ce,{open:i,title:t.jsx(kZ,{level:4,children:r==="create"?"Crear Categoría":"Actualizar Categoría"}),onOk:c,onCancel:d,okText:r==="create"?"Crear":"Actualizar",cancelText:"Cancelar",width:400,destroyOnHidden:!0,children:t.jsx(M,{form:a,layout:"vertical",initialValues:{name:e.name},children:t.jsx(M.Item,{name:"name",label:"Nombre de la Categoría",rules:[{required:!0,message:"Por favor ingresa el nombre de la categoría"}],children:t.jsx(ie,{placeholder:"Nombre de la Categoría",autoFocus:!0})})})})},bp=async(e,n)=>{if(!(e!=null&&e.businessID)||!Array.isArray(n)||n.length===0)return;const s=dt($);n.forEach(o=>{var c;const r=(c=o==null?void 0:o.product)==null?void 0:c.id;if(!r)return;const i=F($,"businesses",e.businessID,"products",r),a=o==null?void 0:o.quantityRemoved;console.log(a),a&&s.update(i,{stock:fn(Number(a))})});try{await s.commit(),console.log("Todas las actualizaciones de inventario han sido aplicadas")}catch(o){console.error("Error al actualizar el inventario:",o)}},PZ=async(e,n)=>{if(!(e!=null&&e.businessID)||!(e!=null&&e.uid)){console.error("Información requerida para la operación faltante o inválida");return}console.log(n,e.uid);const s=n.productList.map(i=>({product:i.product,quantityRemoved:-i.quantityRemoved})),o={...n,id:be(10),createdAt:de(),createdBy:e.uid,isDeleted:!1};console.log(o);const r=F($,"businesses",e.businessID,"productOutflow",o.id);try{await De(r,o),await bp(e,s)}catch(i){console.error("Error en fbAddProductOutFlow:",i)}},DZ=async(e,n)=>{if(!(e!=null&&e.businessID)||!(n!=null&&n.id))return;const s=F($,"businesses",e.businessID,"productOutflow",n.id);try{const o=await $Z(s);if(!o){console.log("No existe el documento!");return}const r=RZ(o.productList,n.productList);console.log(r),await bp(e,r),await je(s,n)}catch(o){console.log("Error al actualizar el flujo de salida de productos: ",o)}},$Z=async e=>{const n=await Se(e);return n.exists()?n.data():null},RZ=(e,n)=>n.map(s=>{const r=((e.find(i=>i.id===s.id)||{}).quantityRemoved||0)-s.quantityRemoved;return{product:s.product,quantityRemoved:r}}),Bj=e=>{const[n,s]=m.useState(!1);return m.useEffect(()=>{const o=()=>{e.current&&e.current.scrollTop>=10?s(!0):s(!1)};return e.current&&e.current.addEventListener("scroll",o),()=>{e.current&&e.current.removeEventListener("scroll",o)}},[e]),n},NZ=({data:e,fn:n,close:s})=>{const o=async()=>{try{n(e),s()}catch{}};return t.jsx(OZ,{onClick:o,children:t.jsx("span",{children:e.name})})},OZ=l.div`
    min-height: 2.4em;
    height: min-content;
    display: flex;
    align-items: center;
    padding: 0 0.6em;
    background-color: var(--White);
    border-radius: var(--border-radius-light);
    
`,MZ=({productName:e,isOpen:n,setIsOpen:s,handleSelectProduct:o})=>{const[r,i]=m.useState(e||null),a=()=>{s(!1)},c=m.useRef(null),{products:d}=Rs(!0),u=d.filter(h=>h.trackInventory===!0)||[],p=typeof r=="string"&&$n(u,r);return m.useEffect(()=>{e||i(""),e&&i(e)},[e]),kt(c,n,a),t.jsxs(FZ,{children:[t.jsx(ie,{value:r,placeholder:"Buscar...",onChange:h=>i(h.target.value),onFocus:()=>s(!0)}),n?t.jsxs(BZ,{ref:c,children:[t.jsxs(LZ,{children:[t.jsx("span",{children:"Lista de Productos Inventariables"}),t.jsx("span",{children:t.jsx(UZ,{onClick:a,children:t.jsx(O,{icon:_r})})})]}),t.jsx(zZ,{children:p.map((h,f)=>t.jsx(NZ,{fn:o,data:h,close:a,setShowProductList:s},f))})]}):null]})},FZ=l.div`
  display: block;
  z-index: 1;
`,BZ=l.div`
  height: calc(100vh - 18em);
  max-height: 400px;
  max-width: 1000px;
  width: 100%;
  
  position: absolute;
  z-index: 9999;
  top: 2.8em;
  
  margin: 0 auto;
  box-shadow: 2px 10px 10px rgba(0, 0, 0, 0.400);
  border: var(--border-primary);
  border-radius: 08px;
  overflow: hidden;

  display: grid;
  grid-template-rows: min-content 1fr;
  background-color: #b4c4ce;
  
`,LZ=l.div`
 background-color: var(--White3);
height: 2.2em;
display: flex;
align-items: center;

padding: 0 0.4em;
display: flex;
justify-content: space-between;
`,zZ=l.div`
 
  overflow-y: scroll;
 // background-color: #f0f0f0;
 display: grid;
 grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
 grid-auto-rows: min-content;
 align-items: flex-start;
 align-content: flex-start;
 background-color: var(--White3);
 gap: 0.4em;
 padding: 0.3em;


  
`,UZ=l.button`
  width: 1.2em;
  height: 1.2em;
  display: flex;
  align-items: center;

  justify-content: center;
  padding: 0;
  font-size: 1.05em;
  border-radius: 100%;
  &:focus {
    outline: none;
  }
`,WZ=({Group:e})=>{const n=D(yy);return[{width:"1fr ",subtitle:"Producto",render:o=>t.jsx(e,{children:t.jsx("span",{children:o})})},{width:"0.8fr",subtitle:`Cantidad ${`(${(()=>{var i;const o=n==null?void 0:n.currentRemovedQuantity,r=(i=n==null?void 0:n.product)==null?void 0:i.stock;return typeof(r&&o)!="number"?0:r-o})()})`}`,render:o=>t.jsx("span",{children:o})},{width:" 0.8fr ",subtitle:"Motivo",render:o=>t.jsxs(e,{children:[t.jsx("span",{children:o}),t.jsx(ke,{borderRadius:"normal",title:t.jsx(O,{icon:js})})]})},{width:"0.8fr",subtitle:"Observaciones",render:o=>t.jsx("span",{children:o})},{width:"min-content",subtitle:"",render:()=>t.jsx("div",{})}]},qZ=()=>{var d;const e=W(),[n,s]=m.useState(!1),o=D(yy),r=()=>e(_$(o)),i=async u=>{const p={name:u==null?void 0:u.name,id:u==null?void 0:u.id};e(vi({...o,product:p}))},a=(u,p=!1)=>{switch(p){case!1:return e(vi({...o,[u.target.name]:u.target.value}));case"number":return e(vi({...o,[u.target.name]:Number(u.target.value)}));default:return e(vi({...o,[u.target.name]:u.target.value}))}},c=WZ({Group:_Z});return t.jsxs(VZ,{children:[t.jsx(ef,{columns:c,children:c.map((u,p)=>t.jsx(GZ,{children:u.render(u.subtitle)},p))}),t.jsxs(ef,{columns:c,children:[t.jsx(MZ,{handleSelectProduct:i,isOpen:n,setIsOpen:s,productName:((d=o==null?void 0:o.product)==null?void 0:d.name)||""}),t.jsx("div",{children:t.jsx(Dt,{type:"number",bgColor:"gray-light",border:!0,placeholder:"Cantidad",name:"quantityRemoved",value:(o==null?void 0:o.quantityRemoved)||"",onChange:u=>a(u,"number")})}),t.jsx("div",{children:t.jsx(Dt,{value:(o==null?void 0:o.motive)||"",placeholder:"Motivo",name:"motive",onChange:a,border:!0,bgColor:"gray-light"})}),t.jsx("div",{children:t.jsx(Dt,{value:(o==null?void 0:o.observations)||"",placeholder:"Observaciones",name:"observations",onChange:a,border:!0,bgColor:"gray-light"})}),t.jsx("div",{children:t.jsx(ke,{title:t.jsx(O,{icon:js}),width:"icon32",border:"light",borderRadius:"normal",onClick:r})})]})]})},VZ=l.div`
    background-color: var(--White);

    display: grid;
    gap: 0.2em;
    padding: 0.2em 1em 0.4em;
    position: relative;
    z-index: 2;
`,ef=l.div`
    color: rgb(37, 37, 37);
     display: grid;
     position: relative;
     gap: 1em;

${({columns:e})=>e&&`
    grid-template-columns: ${e.map(n=>n.width).join(" ")};
    `}
     
`,GZ=l.div`
       display: flex;
       font-weight: 500;
       min-width: 2em;
       align-items: center;
       span{
        
    font-size: 12px;
    line-height: 12px;
       }
`,_Z=l.div`
    display: flex;
    gap: 0.5em;
    align-items: center;
    width: 100%;
    height: 100%;
    padding: 0.5em;
    border-radius: 0.5em;
    background-color: var(--White);
    border: 1px solid var(--Gray-300);
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    &:hover{
        background-color: var(--Gray-100);
    }
    span{
        font-size: 12px;
        line-height: 12px;
    }
`,HZ=(e,n)=>{if(!(e!=null&&e.businessID))return;const{product:s,totalRemovedQuantity:o}=n,r=s.stock+o,i=F($,"businesses",e.businessID,"products",s.id);console.log(s.stock,"========",o,"========",r);try{je(i,{"product.stock":fn(o)})}catch(a){console.log("Lo sentimos Ocurrió un error: ",a)}},QZ=({isOpen:e,mode:n="create"})=>{const s=D(K$),o=D(Xu),r=W(),i=D(q),a=()=>{r(wc()),r(Q$())},c=(g,y)=>{HZ(i,g),r(H$({id:g.id}))},d=async()=>{try{await DZ(i,o.data)}catch{}},u=async()=>{try{await PZ(i,o.data)}catch{}},p=async()=>{n==="create"&&await u(),n==="update"&&await d()},h=(g,y)=>{r(Y$({id:g,data:y}))},f=m.useRef(null),x=Bj(f);return t.jsx(fp,{width:"large",isOpen:e,btnSubmitName:"Guardar",nameRef:n==="create"?"Agregar Salida de Producto":"Editar Salida de Producto",handleSubmit:p,close:a,children:t.jsxs(YZ,{children:[t.jsx(KZ,{children:t.jsx(qZ,{})}),t.jsx(JZ,{children:t.jsxs(XZ,{ref:f,children:[t.jsxs(eee,{isScrolled:x,children:[t.jsx(nt,{type:"subtitle-table",value:"#"}),t.jsx(nt,{type:"subtitle-table",value:"Producto"}),t.jsx(nt,{type:"subtitle-table",value:"Cantidad"}),t.jsx(nt,{type:"subtitle-table",value:"Motivo"}),t.jsx(nt,{type:"subtitle-table",value:"Observaciones"}),t.jsx(nt,{type:"subtitle-table",value:"Acción"})]}),t.jsx(ZZ,{children:(s==null?void 0:s.length)>0&&s.slice().sort((g,y)=>new Date(g.date)-new Date(y.date)).reverse().map((g,y)=>{var b;return t.jsxs(tee,{children:[t.jsx(nt,{type:"number",value:(s==null?void 0:s.length)-y}),t.jsx(nt,{type:"text",value:(b=g==null?void 0:g.product)==null?void 0:b.name}),t.jsx(ie,{type:"number",value:g==null?void 0:g.quantityRemoved,onChange:v=>h(g.id,{quantityRemoved:v.target.value})}),t.jsx(ie,{value:(g==null?void 0:g.motive)||"none",onChange:v=>h(g.id,{motive:v.target.value})}),t.jsx(ie,{value:(g==null?void 0:g.observations)||"none",onChange:v=>h(g.id,{observations:v.target.value})}),t.jsx("div",{style:{display:"flex",justifyContent:"right"},children:t.jsx(U,{danger:!0,icon:z.operationModes.delete,onClick:()=>c(g,o.data.id)})})]},y)})||t.jsx(si,{text:n==="create"?"Seleccione un producto para agregar una salida de producto, y rellene los campos de cantidad, motivo y observaciones":"No hay registros de salida de productos"})})]})})]})})},YZ=l.div`
display: grid;
grid-template-rows: min-content 1fr;
height: 100%;
overflow: hidden;
`,KZ=l.div`

width: 100%;
`,JZ=l.div`
height: 100%;
width: 100%;
overflow-y: hidden;
`,XZ=l.div`
max-width: 1100px;
width: 100%;
overflow-y: hidden;
margin: 0 auto;
height: 100%;
background-color: aliceblue;

background-color: var(--White);

`,ZZ=l.div`
display: grid;
height: calc(100% - 2.6em);
overflow-y: scroll;
align-content: flex-start;
align-items: flex-start;
  position: relative;
`,eee=l.div`
  display: grid;
  grid-template-columns: 3em 1fr 1fr 1fr 1fr 5em;
  align-items: center;
  background-color: var(--White);
  padding: 8px 24px 8px 8px;
  gap: 1em;
  font-size: 14px;
  font-weight: bold;
  position: sticky;
    top: 0;
    border-bottom: 1px solid transparent;
    z-index: 1;
    transition: all 0.2s linear;
    ${({isScrolled:e})=>e&&`
    background-color: var(--White);
    border-bottom: 1px solid rgba(0, 0, 0, 0.100);
  `}
`,tee=l.div`
  display: grid;
  grid-template-columns: 3em  1fr 1fr 1fr 1fr 5em;
  align-items: center;
  gap: 1em;
  border-radius: 4px;
  padding: 8px 8px 8px 8px;
  font-size: 14px;
  transition: all 0.2s linear;
  :hover{
    background-color: #f5f5f5;
  }
`,nee=()=>{const e=D(cR),{isOpen:n,title:s,description:o,onConfirm:r}=e,i=W(),a=Fe(),d={isExistingOpenCR:Lq()},u=()=>Oq(r,a,i,d),p=()=>i(Zu()),h={hidden:{opacity:0,pointerEvent:"none"},visible:{opacity:1,pointerEvent:"auto"}},f={hidden:{opacity:0,scale:.5},visible:{opacity:1,scale:1,transition:{type:"spring",stiffness:100,damping:15}}},x=()=>{switch(r){case null:return"Aceptar";default:return"Cancelar"}};return n&&t.jsx(see,{variants:h,initial:"hidden",animate:n?"visible":"hidden",children:t.jsxs(oee,{variants:f,initial:"hidden",animate:n?"visible":"hidden",children:[t.jsx(ree,{children:t.jsx(nt,{type:"title",value:s})}),t.jsx(iee,{children:t.jsx(nt,{type:"paragraph",value:o})}),t.jsx(aee,{children:t.jsx(cee,{children:t.jsxs($t,{children:[t.jsx(ke,{title:x(),onClick:p,bgcolor:"gray"}),r!==null&&t.jsx(ke,{title:"Confirmar",onClick:u,bgcolor:"primary"})]})})})]})})},see=l(Ie.div)`
    height: 100vh;
    width: 100vw;
    backdrop-filter: blur(5px) brightness(0.5) saturate(100%) contrast(100%);
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
    top: 0;
    left: 0;
    z-index: 10000;
`,oee=l(Ie.div)`
    height: 300px;
    max-width: 600px;
    width: 100%;
    background-color: white;
    border-radius: var(--border-radius);
    padding: 0.4em;
    display: grid;
    grid-template-rows: min-content 1fr min-content;
    gap: 1em;
`,ree=l.div`
    padding: 1em;
`,iee=l.div`
    padding:  0 1em;
`,aee=l.div`

`,cee=l.div`
    display: flex;
    justify-content: flex-end;
`,lee={hidden:{opacity:0,pointerEvent:"none"},visible:{opacity:1,pointerEvent:"auto"}},dee={hidden:{opacity:0,scale:.5},visible:{opacity:1,scale:1,transition:{type:"spring",stiffness:100,damping:15}}},wt={error:{background:"#FFF5F5",border:"#FFA5A5",text:"#DC2626",button:"#EF4444",buttonHover:"#DC2626",iconBg:"rgba(239, 68, 68, 0.1)"},warning:{background:"#FFFBEB",border:"#FCD34D",text:"#D97706",button:"#F59E0B",buttonHover:"#D97706",iconBg:"rgba(245, 158, 11, 0.1)"},success:{background:"#F0FDF4",border:"#86EFAC",text:"#16A34A",button:"#22C55E",buttonHover:"#16A34A",iconBg:"rgba(34, 197, 94, 0.1)"},info:{background:"#EFF6FF",border:"#93C5FD",text:"#2563EB",button:"#3B82F6",buttonHover:"#2563EB",iconBg:"rgba(59, 130, 246, 0.1)"}},uee={warning:z.types.warning,error:z.types.error,success:z.types.success,info:z.types.info},yp=l.button`
    position: relative;
    min-width: 120px;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    transform-origin: center;
    overflow: hidden;
    
    &:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none !important;
    }

    &::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
        transform: translateX(-100%);
        transition: transform 0.6s ease;
    }

    &:hover:not(:disabled)::before {
        transform: translateX(100%);
    }

    &:active:not(:disabled) {
        transform: scale(0.98);
    }
`,pee=l(yp)`
    background: ${e=>e.theme.colors.background||"#ffffff"};
    color: #64748b;
    border: 2px solid #e2e8f0;
    
    &:hover:not(:disabled) {
        background: #f8fafc;
        color: #475569;
        border-color: #cbd5e1;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(148, 163, 184, 0.1);
    }
`,mee=l(yp)`
    background: ${e=>{var n;return((n=wt[e.$type])==null?void 0:n.button)||"#3b82f6"}};
    color: white;
    border: none;
    box-shadow: 0 2px 8px ${e=>{var n;return(n=wt[e.$type])==null?void 0:n.border}}40;
    
    &:hover:not(:disabled) {
        background: ${e=>{var n;return((n=wt[e.$type])==null?void 0:n.buttonHover)||"#2563eb"}};
        transform: translateY(-2px);
        box-shadow: 0 4px 15px ${e=>{var n;return(n=wt[e.$type])==null?void 0:n.border}}60;
    }

    &:disabled {
        background: ${e=>{var n;return(n=wt[e.$type])==null?void 0:n.button}}90;
    }
`,hee=l(yp)`
    width: 32px;
    height: 32px;
    min-width: unset;
    padding: 0;
    border-radius: 50%;
    background: transparent;
    color: ${e=>{var n;return(n=wt[e.type])==null?void 0:n.text}};
    border: 2px solid ${e=>{var n;return(n=wt[e.type])==null?void 0:n.border}}40;
    
    &:hover:not(:disabled) {
        background: ${e=>{var n;return(n=wt[e.type])==null?void 0:n.border}}20;
        transform: rotate(90deg);
    }

    svg {
        width: 16px;
        height: 16px;
        fill: ${e=>{var n;return(n=wt[e.type])==null?void 0:n.text}};
    }
`,gee=l.div`
    width: 16px;
    height: 16px;
    border: 2px solid #ffffff;
    border-bottom-color: transparent;
    border-radius: 50%;
    display: inline-block;
    animation: rotation 1s linear infinite;

    @keyframes rotation {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
`,fee=()=>{const{dialog:e,onClose:n}=Ds(),[s,o]=m.useState(!1);if(!e.isOpen)return null;const{isOpen:r,title:i,type:a,message:c,onConfirm:d,onCancel:u,size:p="default",successMessage:h,cancelButtonText:f,confirmButtonText:x}=e,g=()=>{s||(u==null||u(),n())},y=async()=>{if(d){o(!0);try{const C=d();C&&typeof C.then=="function"&&await C,h&&V.success(h)}finally{o(!1),n()}}},b=f||(d===null?"Aceptar":"Cancelar"),v=x||"Confirmar";return t.jsx(gt,{children:r&&t.jsx(bee,{variants:lee,initial:"hidden",animate:"visible",exit:"hidden",children:t.jsxs(yee,{variants:dee,initial:"hidden",animate:"visible",exit:"hidden",$size:p,type:a,children:[t.jsxs(vee,{type:a,children:[t.jsx(Qe,{variant:"h2",disableMargins:!0,children:i}),t.jsx(hee,{onClick:n,type:a,disabled:s,children:z.operationModes.close})]}),t.jsx(jee,{children:t.jsxs(Cee,{type:a,children:[t.jsx(wee,{type:a,children:uee[a]}),t.jsx(See,{variant:"p",color:"inherit",disableMargins:!0,children:c})]})}),t.jsx(Iee,{children:t.jsxs($t,{children:[t.jsx(pee,{onClick:g,disabled:s,children:b}),d!==null&&t.jsxs(mee,{onClick:y,$type:a,disabled:s,children:[v,s&&t.jsx(gee,{})]})]})})]})})})},xee=e=>{const n={small:qe`
            max-width: 400px;
            min-height: 200px;
        `,default:qe`
            max-width: 600px;
            min-height: 300px;
        `,large:qe`
            max-width: 800px;
            min-height: 400px;
        `};return n[e]||n.default},bee=l(Ie.div)`
    position: fixed;
    height: 100vh;
    width: 100vw;
    backdrop-filter: blur(4px) brightness(0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    top: 0;
    left: 0;
    z-index: 10000;
    padding: 1rem;
`,yee=l(Ie.div)`
    ${e=>xee(e.$size)}
    width: 100%;
    background-color: ${e=>{var n;return((n=wt[e.type])==null?void 0:n.background)||e.theme.colors.background}};
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    padding: 1.75rem;
    display: grid;
    grid-template-rows: min-content 1fr min-content;
    gap: 1.5rem;
    border: 2px solid ${e=>{var n;return((n=wt[e.type])==null?void 0:n.border)||"rgba(0,0,0,0.1)"}};
    transition: transform 0.15s ease;

    &:hover {
        transform: translateY(-2px);
    }
`,vee=l.div`
    display: flex;
    align-items: center;
    justify-content: space-between;
    color: ${e=>{var n;return(n=wt[e.type])==null?void 0:n.text}};
    padding-bottom: 0.5rem;
    border-bottom: 1px solid ${e=>{var n;return(n=wt[e.type])==null?void 0:n.border}}30;
`,jee=l.div`
    display: flex;
    align-items: flex-start;
`,Cee=l.div`
    background-color: ${e=>{var n;return((n=wt[e.type])==null?void 0:n.iconBg)||"rgba(0,0,0,0.05)"}};
    color: ${e=>{var n;return(n=wt[e.type])==null?void 0:n.text}};
    padding: 1.5rem;
    border-radius: 12px;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    width: 100%;
    border: 1px solid ${e=>{var n;return(n=wt[e.type])==null?void 0:n.border}}30;
`,wee=l.div`
    width: 2em;
    height: 2em;
    display: flex;
    align-items: center;
    justify-content: center;
    color: ${e=>{var n;return((n=wt[e.type])==null?void 0:n.text)||"inherit"}};
`,See=l(Qe)`
    flex: 1;
    line-height: 1.5;
`,Iee=l.div`
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
`,{Title:_Ce,Paragraph:Eee}=Xe,Aee=()=>{const e=W(),n=D(TE),s=n.isOpen,o=n.note,r=()=>{e(AE())};return t.jsx(Ce,{title:"Nota",open:s,onCancel:r,footer:[t.jsx(U,{type:"primary",onClick:r,children:"Cerrar"},"close")],children:t.jsx(Eee,{children:o})})},{Form:Wn,Input:Os,Button:tf,notification:kee}=Ne,Tee=l.div`
    display: grid;
    gap: 1em;
    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
`,Pee=({form:e,customerData:n,creditLimitForm:s})=>{const o=D(q),r=W();_e.UPDATE.id;const i=_e.CREATE.id,{loading:a,error:c,rncInfo:d,differences:u,consultarRNC:p,syncWithDgii:h,compareDgiiData:f}=Oj(e,"personalID"),x=Wn.useWatch([],e);m.useEffect(()=>{d&&x&&f(x,d)},[x,d,f]),m.useEffect(()=>{if(n!=null&&n.personalID){const v=n.personalID.trim();v.length>=9&&v.length<=11&&p(v,!0)}},[n]);const g=async()=>{try{await Ic(o.businessID,n.id),e.resetFields(),s.resetFields(),kee.success({message:"Cliente Actualizado",description:"Eliminado Correctamente"}),r(Pn({mode:i}))}catch{}},y=v=>{var I;const C=(I=v||e.getFieldValue("personalID"))==null?void 0:I.trim();C&&C.length>=9&&C.length<=11&&p(C)},b=v=>{v.key==="Enter"&&v.stopPropagation()};return t.jsxs(Tee,{children:[t.jsxs("div",{children:[u.length>0&&t.jsx(Rj,{differences:u,onSync:h,loading:a}),t.jsxs(Wn,{form:e,layout:"vertical",name:"form_in_modal",initialValues:{...n,modifier:"public"},children:[t.jsx(Wn.Item,{name:"personalID",label:t.jsx("span",{children:"Cédula/RNC"}),validateStatus:c?"error":void 0,help:c?t.jsx("span",{style:{color:"#ff4d4f"},children:c}):(d==null?void 0:d.status)==="SUSPENDIDO"?t.jsx("span",{style:{color:"#e49800",fontSize:"13px"},children:"⚠️ Este RNC se encuentra actualmente suspendido en la DGII"}):(d==null?void 0:d.status)==="DADO DE BAJA"?t.jsx("span",{style:{color:"#ff4d4f",fontSize:"13px"},children:"⚠️ Este RNC se encuentra dado de baja en la DGII"}):null,children:t.jsx(Os.Search,{placeholder:"Cédula o RNC",enterButton:t.jsx(tf,{type:"primary",icon:t.jsx(ha,{}),children:"Buscar RNC"}),onSearch:y,onKeyDown:b,loading:a,disabled:a})}),c&&t.jsx("p",{style:{color:"red",marginTop:"-10px",marginBottom:"10px"},children:c}),t.jsx(Wn.Item,{name:"name",label:"Nombre Completo",rules:[{required:!0,message:"Por favor ingrese el nombre del cliente"}],children:t.jsx(Os,{})}),t.jsxs(Dee,{children:[t.jsx(Wn.Item,{name:"tel",label:"Teléfono 1",style:{width:"100%"},children:t.jsx(Os,{})}),t.jsx(Wn.Item,{name:"tel2",label:"Teléfono 2",style:{width:"100%"},children:t.jsx(Os,{})})]}),t.jsx(Wn.Item,{name:"address",label:"Dirección",children:t.jsx(Os,{})}),t.jsx(Wn.Item,{name:"sector",label:"Sector",children:t.jsx(Os,{})}),t.jsx(Wn.Item,{name:"province",label:"Provincia",children:t.jsx(Os,{})}),t.jsx(tf,{danger:!0,onClick:g,children:"Eliminar Usuarios"})]})]}),t.jsx("div",{children:t.jsx(Mj,{rncInfo:d,loading:a})})]})},Dee=l.div`
    display: flex;
    gap: 1em;
    flex-grow: 1;
`,{Button:Lj}=Ne,$ee=({client:e,pendingBalance:n})=>{const s=W(),o=()=>{s($c({isOpen:!0,paymentDetails:{paymentScope:"balance",totalAmount:n,clientId:e.id}}))};return t.jsxs("div",{children:[t.jsxs(nf,{children:[t.jsxs(Bl,{children:["Código: ",e==null?void 0:e.numberId]}),t.jsx(Bl,{children:"Balance general"})]}),t.jsxs(nf,{children:[t.jsx(Bl,{children:e==null?void 0:e.name}),t.jsx(Zee,{children:Y(n)}),t.jsx(Lj,{type:"primary",onClick:o,children:"Pagar"})]})]})};l.div`
    padding: 16px;
    `;l.div`
    font-size: 16px;
    font-weight: 500;
    `;l(Lj)`
    width: 100%;
    `;const nf=l.div`
display: grid;
grid-template-columns: 1fr 1fr 6em;
`;l.div`
        
`;function Ree({user:e,clientId:n}){return new Promise((s,o)=>{if(!(e!=null&&e.businessID)||!n){o(new Error("BusinessID o ClientID no proporcionados"));return}const r=F($,"businesses",e.businessID,"creditLimit",n);return Te(r,a=>{a.exists()?s(a.data()):s(null)},a=>{o(a)})})}const{Checkbox:Nee,Input:Oee,Form:su,InputNumber:Mee,Alert:sf}=Ne,Fee=({creditLimitForm:e,arBalance:n=800,client:s})=>{var b,v,C;const[o,r]=m.useState(e.getFieldValue(["invoice","status"])),[i,a]=m.useState(e.getFieldValue(["creditLimit","status"])),c=D(q),d=s.id,{data:u,error:p,isLoading:h}=Uo({queryKey:["creditLimit",c,d],queryFn:()=>Ree({user:c,clientId:d}),enabled:!!c&&!!d,refetchOnWindowFocus:!1});m.useEffect(()=>{var I,j;u&&(e.setFieldsValue(u),r((I=u==null?void 0:u.invoice)==null?void 0:I.status),a((j=u==null?void 0:u.creditLimit)==null?void 0:j.status))},[u]);const f=(I,j)=>{var k,A;r((k=j.invoice)==null?void 0:k.status),a((A=j.creditLimit)==null?void 0:A.status),x(j)},x=I=>{var j,k;(j=I.invoice)!=null&&j.status||(e.setFieldsValue({invoice:{value:null}}),e.setFields([{name:["invoice","value"],errors:[]}])),(k=I.creditLimit)!=null&&k.status||(e.setFieldsValue({creditLimit:{value:null}}),e.setFields([{name:["creditLimit","value"],errors:[]}]))},g=(I,j)=>j==null&&!i||!o?Promise.resolve():j&&j.toString().length<0?Promise.reject("El valor debe tener al menos 6 caracteres"):Promise.resolve(),y=(I,j)=>j==null&&!i||!o?Promise.resolve():j<=0?Promise.reject("El valor debe ser mayor a cero"):Promise.resolve();return h?t.jsx("div",{children:"Loading..."}):p?t.jsx("div",{children:"Error loading credit limit"}):t.jsxs("div",{children:[t.jsx(su,{form:e,layout:"vertical",name:"creditLimitForm",onValuesChange:f,children:t.jsxs(Bee,{children:[t.jsx(Lee,{children:"Límites de crédito"}),t.jsxs(zee,{children:[t.jsx(Fl,{label:"Facturas",valuePropNameStatus:"checked",nameStatus:["invoice","status"],nameValue:["invoice","value"],type:"number",rules:o?[{required:!0,message:"Por favor, ingresa el valor de la factura"},{validator:g},{validator:y}]:[],disabled:!o,checkboxLabel:!0}),t.jsx(Fl,{label:"Límite de crédito",type:"number",valuePropNameStatus:"checked",checkboxLabel:!0,rules:i?[{required:!0,message:"Por favor, ingresa el límite de crédito"},{validator:g},{validator:y}]:[],nameStatus:["creditLimit","status"],nameValue:["creditLimit","value"],disabled:!i}),t.jsx(Fl,{label:"Crédito disponible",readOnly:!0,value:Y(((b=u==null?void 0:u.creditLimit)==null?void 0:b.value)-n||0)})]})]})}),((v=u==null?void 0:u.creditLimit)==null?void 0:v.status)&&((C=u==null?void 0:u.creditLimit)==null?void 0:C.value)<n&&t.jsx(sf,{message:"Advertencia",description:"El límite de crédito es menor que el balance disponible.",type:"warning",showIcon:!0}),!i&&t.jsx(sf,{message:"Advertencia",description:`El límite de crédito no está activado para el cliente ${s.name}. No podrás usar las funcionalidades de cuentas por cobrar hasta que actives el límite de crédito.`,type:"warning",showIcon:!0})]})},Bee=l.div`
  border: 1px solid #ccc;
  border-left: 0;
    border-right: 0;
  padding: 16px 0;

`,Lee=l.h2`
  margin-bottom: 16px;
  font-size: 18px;
  color: #333;
`,zee=l.div`
  display: grid;
    grid-template-columns: min-content  1fr 1fr;
    gap: 1em;
`;l.div`
  display: flex;
  align-items: center;
`;l.label`
  margin-left: 8px;
`;l.div`
  display: flex;
  flex-direction: column;
  align-items: center;
`;const Fl=({label:e,value:n,type:s="text",checkboxLabel:o=!1,valuePropNameStatus:r,disabled:i=!1,readOnly:a=!1,rules:c=[],nameValue:d,nameStatus:u})=>t.jsx(su.Item,{name:d,rules:c,label:o?t.jsx(su.Item,{name:u,valuePropName:r,noStyle:!0,children:t.jsx(Nee,{style:{whiteSpace:"nowrap"},children:e})}):e,children:s==="number"?t.jsx(Mee,{readOnly:a,disabled:i,value:n,style:{width:"100%"}}):t.jsx(Oee,{readOnly:a,disabled:i,value:n})}),Uee=l.div`
    display: flex;
    align-items: start;
    align-content: start;
    flex-wrap: wrap; /* No permite el wrap inicialmente */
    width: 100%;
    justify-content: ${e=>e.align==="left"?"flex-start":"flex-end"};
  
`,Wee=l.span`
  font-weight: bold;
  margin-right: 10px;
`,qee=l.span`
  color: #555;
`,Gs=({title:e,value:n,align:s="left"})=>t.jsxs(Uee,{align:s,children:[t.jsxs(Wee,{children:[e,":"]}),t.jsx(qee,{children:n})]}),{Button:Vee}=Ne;function Gee({installments:e,installmentAmount:n,lastPayment:s,lastPaymentDate:o,balance:r,isActive:i,account:a}){var p,h,f;const c=W(),d=D(Ht),u=()=>{c($c({isOpen:!0,paymentDetails:{clientId:d.id,arId:a.id,paymentScope:"account",totalAmount:r},extra:{...a}}))};return t.jsxs(_ee,{children:[t.jsx(Gs,{title:"Cuotas",value:((p=a==null?void 0:a.paidInstallments)==null?void 0:p.length)>0?` ${(h=a==null?void 0:a.paidInstallments)==null?void 0:h.length}/${e}`:`${e}`}),t.jsx(Gs,{title:"Monto cuota",value:Y(n)}),t.jsx(Gs,{title:"Último pago",value:a!=null&&a.lastPaymentDate?`${new ce(((f=a==null?void 0:a.lastPaymentDate)==null?void 0:f.seconds)*1e3).toFormat("dd/MM/yyyy")} - ${Y(a.lastPayment)}`:"N/A"}),t.jsx(Vee,{type:"primary",disabled:!i,onClick:u,children:"Pagar"})]})}const _ee=l.div`
    display: grid;
    padding: 0.4em;
    grid-template-columns: min-content 0.7fr 1fr min-content;
  
   
  `,of=({accountNumber:e,date:n,frequency:s,balance:o,installments:r,installmentAmount:i,lastPayment:a,lastPaymentDate:c,isActive:d,account:u})=>t.jsxs(Hee,{children:[t.jsxs(Qee,{children:[t.jsx(Gs,{title:"#",value:e}),t.jsx(Gs,{title:"Fecha",align:"center",value:n}),t.jsx(Gs,{title:"Frecuencia",align:"center",value:s}),t.jsx(Gs,{title:"Balance",align:"right",value:Y(o)})]}),t.jsx(Yee,{children:t.jsx(Gee,{installmentAmount:i,installments:r,lastPayment:a,lastPaymentDate:c,isActive:d,balance:o,account:u})})]}),Hee=l.div`
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 0.4em 0.4em;
    display: grid;

`,Qee=l.div`
  display: grid;
  gap: 1em;
  grid-template-columns: min-content 1fr 1fr 1fr;

  border-bottom: 1px solid #ccc;
`,Yee=l.div`
 
`,Kee=({user:e,clientId:n,onUpdate:s})=>{if(!(e!=null&&e.businessID))return;const o=le($,"businesses",e==null?void 0:e.businessID,"accountsReceivable"),r=he(o,te("clientId","==",n));return Te(r,a=>{const c=a.docs.map(d=>d.data());s&&s(c)},a=>{console.error("Error al obtener las cuentas por cobrar: ",a)})},Jee=({client:e,creditLimitForm:n})=>{const[s,o]=m.useState([]),r=D(q),[i,a]=m.useState(0),[c,d]=m.useState(1),[u,p]=m.useState(1),h=5,f=s.filter(w=>!w.isActive),x=f.length,g=s.filter(w=>w.isActive),y=g.length,b=e==null?void 0:e.id,v=w=>{a(OW(w)),o(MW(w))},C=(w,S)=>{const E=(S-1)*h,T=E+h;return w.slice(E,T)},I=w=>{d(w)},j=w=>{p(w)},k=C(g,c),A=C(f,u);m.useEffect(()=>{const w=Kee({user:r,clientId:b,onUpdate:v});return()=>{w&&w()}},[r,b]);const P=[{key:"1",label:`Abiertas ${y}`,children:t.jsxs("div",{children:[t.jsx(rf,{children:k.map(w=>t.jsx(of,{account:w,accountNumber:w.numberId,date:w.date,frequency:w.frequency,balance:w.balance,installments:w.installments,installmentAmount:w.installmentAmount,lastPayment:w.lastPayment,isActive:w.isActive},w.arId))}),y>h&&t.jsx(af,{children:t.jsx(Ta,{current:c,total:y,pageSize:h,onChange:I,showSizeChanger:!1,showTotal:(w,S)=>`${S[0]}-${S[1]} de ${w} cuentas`})})]})},{key:"2",label:`Cerradas ${x}`,children:t.jsxs("div",{children:[t.jsx(rf,{children:A.map(w=>t.jsx(of,{accountNumber:w.accountNumber,date:w.date,frequency:w.frequency,balance:w.balance,installments:w.installments,installmentAmount:w.installmentAmount,lastPayment:w.lastPayment,isActive:w.isActive,account:w},w.accountNumber))}),"          ",x>h&&t.jsx(af,{children:t.jsx(Ta,{current:u,total:x,pageSize:h,onChange:j,showSizeChanger:!1,showTotal:(w,S)=>`${S[0]}-${S[1]} de ${w} cuentas`})})]})}];return t.jsxs(Xee,{children:[t.jsx($ee,{client:e,pendingBalance:i}),t.jsx(Fee,{creditLimitForm:n,client:e,arBalance:i||0}),t.jsxs(ete,{children:[t.jsx(tte,{children:"Cuentas por cobrar"}),t.jsx(eo,{defaultActiveKey:"1",items:P})]})]})},Xee=l.div`
  display: grid;
  gap: 1em;
`;l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`;const Bl=l.p`
  font-weight: bold;
`;l.p`
  font-style: italic;
`;l(Je)`
  text-align: center;
`;l.div`
  font-weight: bold;
`;const Zee=l.div`
  color: red;

`;l(Je)`
  text-align: center;
`;l(Je)`
  text-align: center;
`;l.div`
  font-weight: bold;
`;l.div`

`;l(U)`
  margin-top: 10px;
`;const ete=l.div`

`,tte=l.h2`
  font-weight: bold;
  font-size: 18px;
  margin: 0;
`;l.div`
  margin-bottom: 10px;
`;l.div`
  margin-top: 10px;
`;l.div`
  display: flex;
  justify-content: space-between;
  margin-bottom: 5px;
`;l.section`

`;l.div`
    border-bottom: 1px solid #ccc;
`;const rf=l.div`
  display: grid;
  gap: 0.4em;
 `,af=l.div`
  display: flex;
  justify-content: center;
  margin-top: 1em;
  padding: 1em 0;
`;async function nte({user:e,client:n,creditLimitData:s}){try{if(!(e!=null&&e.businessID)||!s||!(n!=null&&n.id))return;let o={...s,updatedBy:e==null?void 0:e.uid,updatedAt:ue.now()};const r=F($,"businesses",e.businessID,"creditLimit",n==null?void 0:n.id),i=await Se(r);return i.exists()?await je(r,{...o,id:i.data().id,clientId:i.data().clientId,createdAt:i.data().createdAt,createdBy:i.data().createdBy}):(o={...o,id:n==null?void 0:n.id,clientId:n==null?void 0:n.id,createdAt:ue.now(),createdBy:e==null?void 0:e.uid},await De(r,o)),o}catch(o){throw o}}const{Modal:ste,Form:cf,Tabs:ote,notification:lf,message:rte}=Ne,ite=({isOpen:e,mode:n,data:s,addClientToCart:o=!1})=>{const r=_e.UPDATE.id,i=_e.CREATE.id,a=n===r,[c]=cf.useForm(),[d]=cf.useForm(),[u,p]=m.useState(!1),[h,f]=m.useState(!1),x=c.getFieldsValue(),g=W(),[y,b]=m.useState(!0),v=D(q),C={name:"",address:"",tel:"",personalID:"",tel2:"",numberId:0,province:"",sector:"",delivery:{status:!1,value:""},...s},I={...C,...s,...x};m.useEffect(()=>{n===r&&s&&c.setFieldsValue(s),n===i&&!s&&c.resetFields()},[n,s]);const j=async()=>{if(!(u||h))try{p(!0),f(!0);let w=null;const S=await c.validateFields(),E=await d.validateFields();delete S.clear;const T={...C,...S};a?(await Wb(v,T),await nte({user:v,client:T,creditLimitData:E}),lf.success({message:"Cliente Actualizado",description:"La información del cliente ha sido actualizada con éxito."})):(w=await Ub(v,T),rte.success({message:"Cliente Creado",description:"Se ha añadido un nuevo cliente con éxito."})),o&&w&&(g(Gb(at.UPDATE.id)),g(_b(w))),c.resetFields(),d.resetFields(),g(Pn({mode:i}))}catch{lf.error({message:"Error al Procesar",description:"Hubo un error al procesar el formulario. Por favor, inténtelo de nuevo."})}finally{p(!1),setTimeout(()=>{f(!1)},2e3)}},k=()=>g(Pn({mode:i})),A=()=>k(),P=[{key:"1",label:"Info. General",children:t.jsx(Pee,{form:c,creditLimitForm:d,customerData:C,isUpdating:a,setIsSubmitButtonDisabled:b})},{key:"2",label:"Info. Financiera",children:t.jsx(Jee,{creditLimitForm:d,client:I}),disabled:!a}];return t.jsx(ste,{style:{top:10},open:e,title:a?"Editar Cliente":"Nuevo Cliente",okText:a?"Actualizar":"Crear",cancelText:"Cerrar",confirmLoading:u||h,okButtonProps:{disabled:u||h},width:1e3,styles:{content:{padding:"1.2em"}},onCancel:A,onOk:j,children:t.jsx(ote,{defaultActiveKey:"1",items:P})})},ate=({product:e})=>{const n=W(),{categories:s}=Wu(),{data:o}=uv(),{configureAddProductCategoryModal:r}=ai(),i=()=>n(tO({initialValues:null}));return t.jsxs(Je,{size:"small",title:"Información del producto",id:"part-1",children:[t.jsx(M.Item,{name:"name",label:"Nombre del producto",rules:[{required:!0,message:"Introducir un nombre de producto."},{type:"string",min:4,message:"Mínimo 4 caracteres."}],children:t.jsx(ie,{placeholder:"Ingresa el nombre del producto",value:e==null?void 0:e.productName})}),t.jsxs(Wt,{gutter:16,children:[t.jsx(rt,{span:12,children:t.jsx(M.Item,{name:"type",label:"Tipo de Producto",rules:[{required:!0,message:"Introducir un tipo de producto."}],children:t.jsx(ie,{placeholder:"Ingresa el tipo del producto "})})}),t.jsx(rt,{span:12,children:t.jsx(M.Item,{name:"netContent",label:"Contenido Neto",children:t.jsx(ie,{placeholder:" "})})})]}),t.jsxs(Wt,{gutter:16,children:[t.jsx(rt,{span:12,children:t.jsx(M.Item,{name:"size",label:"Tamaño",children:t.jsx(ie,{placeholder:"Ingresa el tamaño"})})}),t.jsxs(rt,{span:12,style:{display:"grid",gridTemplateColumns:"1fr min-content",gap:"0.2em"},children:[t.jsx(M.Item,{name:"category",label:"Categoría",children:t.jsxs(ge,{showSearch:!0,placeholder:"Selecciona una categoría",optionFilterProp:"children",filterOption:(a,c)=>c.children.toLowerCase().includes(a.toLowerCase()),defaultValue:"none",children:[t.jsx(Option,{value:"none",children:"Ninguna"},"none"),s.map(({category:a})=>t.jsx(Option,{value:a.name,children:a.name},a==null?void 0:a.name))]})}),t.jsx(M.Item,{label:" ",children:t.jsx(U,{icon:z.operationModes.add,onClick:r})})]})]}),t.jsx(Wt,{gutter:16,children:t.jsxs(rt,{span:12,style:{display:"grid",gridTemplateColumns:"1fr min-content",gap:"0.2em"},children:[t.jsx(M.Item,{name:"activeIngredients",label:"Principio Activo",children:t.jsxs(ge,{showSearch:!0,placeholder:"Selecciona el principio activo",optionFilterProp:"children",filterOption:(a,c)=>c.children.toLowerCase().includes(a.toLowerCase()),children:[t.jsx(Option,{value:"none",children:"Ninguno"},"none"),o.map(a=>t.jsx(Option,{value:a.name,children:a.name},a.id))]})}),t.jsx(M.Item,{label:" ",children:t.jsx(U,{icon:z.operationModes.add,onClick:i})})]})}),t.jsxs(Wt,{gutter:16,children:[t.jsx(rt,{span:12,children:t.jsx(M.Item,{name:"measurement",label:"Medida",children:t.jsx(ie,{placeholder:"Ingresa la medida"})})}),t.jsx(rt,{span:12,children:t.jsx(M.Item,{name:"footer",label:"Pie",children:t.jsx(ie,{placeholder:"Ingresa el pie"})})})]})]})},cte=[{unit:"kg",description:"Kilogramos",conversionFactor:1},{unit:"lb",description:"Libras",conversionFactor:.453592},{unit:"g",description:"Gramos",conversionFactor:1e3},{unit:"oz",description:"Onzas",conversionFactor:28.3495},{unit:"mg",description:"Miligramos",conversionFactor:1e6}],lte=({visible:e,onClose:n,stock:s,packSize:o,onSave:r})=>{const[i,a]=m.useState(s),[c,d]=m.useState(s*o);m.useEffect(()=>{a(s),d(s*o)},[s,o]);const u=()=>{r(i,c),n()},p=()=>{n()};return t.jsx(Ce,{title:"Ajustar Inventario",open:e,onOk:u,onCancel:p,okText:"Guardar",cancelText:"Cancelar"})},{Card:dte,InputNumber:df,Row:Ll,Col:Ms,Select:uf,Checkbox:zl,Form:fo}=Ne,ute=()=>{var a;const{product:e,status:n}=D(On),[s,o]=m.useState(!1),r=()=>{o(!1)},i=(c,d)=>{};return t.jsxs(dte,{title:"Gestión de Inventarios",id:"part-2",size:"small",children:[t.jsxs(Ll,{gutter:16,children:[t.jsx(Ms,{span:12,children:t.jsx(fo.Item,{name:"trackInventory",label:"",tooltip:"Si está activado, se llevará un control del inventario de este producto.",valuePropName:"checked",help:"Activa o desactiva el seguimiento de inventario para este producto.",children:t.jsx(zl,{title:"Inventariable",defaultChecked:!0,children:"Inventariable"})})}),t.jsx(Ms,{span:12,children:t.jsx(fo.Item,{name:"restrictSaleWithoutStock",label:"",tooltip:"Si está activado, no se podrá vender este producto si no hay stock.",valuePropName:"checked",help:"Si está activado, no se podrá vender este producto si no hay stock.",children:t.jsx(zl,{title:"Inventariable",defaultChecked:!0,children:"Restringir venta sin stock"})})})]}),t.jsxs(Ll,{gutter:16,children:[t.jsx(Ms,{span:12,children:t.jsx(fo.Item,{name:"stock",label:"Stock",rules:[{required:!0},{type:"number",message:"Introducir un número."}],children:t.jsx(df,{style:{width:"100%"},type:"number",placeholder:"",disabled:n==="update"})})}),t.jsx(Ms,{span:12,children:t.jsx(fo.Item,{name:"packSize",label:"Cantidad de Productos por Paquete",help:"Especifica el número de unidades que incluye cada paquete de este producto.",rules:[{required:!0},{type:"number",message:"Introducir un número."}],children:t.jsx(df,{style:{width:"100%"},type:"number",placeholder:""})})})]}),t.jsxs(Ll,{gutter:16,children:[t.jsx(Ms,{span:12,children:t.jsx(fo.Item,{name:["weightDetail","isSoldByWeight"],label:"",valuePropName:"checked",help:"El precio se calcula por el peso en el momento de la venta.",children:t.jsx(zl,{title:"Se vende por peso",defaultChecked:!0,children:"Se vende por peso"})})}),(a=e==null?void 0:e.weightDetail)!=null&&a.isSoldByWeight?t.jsx(Ms,{span:12,children:t.jsx(fo.Item,{name:["weightDetail","weightUnit"],label:"Unidad de Medida",rules:[{required:!0,message:"Seleccionar una unidad de medida."}],children:t.jsx(uf,{children:cte.map(c=>t.jsx(uf.Option,{value:c.unit,children:c.unit}))})})}):t.jsx(Ms,{col:12}),t.jsx(lte,{visible:s,onClose:r,stock:e==null?void 0:e.stock,packSize:e==null?void 0:e.packSize,onSave:i})]})]})};l.div`
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    align-items: end;
    /* align-content: center; */
`;const{Card:pte,InputNumber:mte,Row:Ul,Col:Wl,Select:hte,Checkbox:gte,Form:ql}=Ne,fte=()=>{const e=D(os);return t.jsxs(pte,{title:"Información de precio",id:"part-3",size:"small",children:[t.jsx(Ul,{gutter:16,children:t.jsx(Wl,{children:t.jsx(ql.Item,{name:"isVisible",label:"",valuePropName:"checked",help:"Determina si el producto aparecerá en la facturación.",children:t.jsx(gte,{title:"Inventariable",defaultChecked:!0,children:"Facturable"})})})}),t.jsxs(Ul,{gutter:16,children:[t.jsx(Wl,{span:12,children:t.jsx(ql.Item,{name:["pricing","cost"],label:"Costo",rules:[{required:!0}],children:t.jsx(mte,{placeholder:"",style:{width:"100%"}})})}),t.jsx(Wl,{span:12,children:t.jsx(ql.Item,{name:["pricing","tax"],label:"Impuesto",help:e?"":"El impuesto no se aplicará a la venta del producto. La facturación de impuestos está desactivada.",rules:[{required:!0}],children:t.jsx(hte,{defaultActiveFirstOption:!0,children:No.map((n,s)=>t.jsx(Option,{value:JSON.stringify(n),children:M2(n)},n))})})})]}),t.jsx(Ul,{gutter:16})]})},{Card:xte,Space:bte,Input:yte,Form:vte}=Ne,jte=({product:e})=>t.jsx(xte,{title:"Código QR",size:"small",extra:t.jsx(Oe,{title:"El código de barra es un código que se representa en forma de barras y espacios que pueden ser leídos e interpretados por un escáner. El código de barras se utiliza para identificar productos de forma única a nivel mundial."}),children:t.jsxs(bte,{direction:"vertical",align:"center",style:{width:"100%"},children:[t.jsx(Gw,{size:100,value:(e==null?void 0:e.qrcode)||"-"}),t.jsx(vte.Item,{name:"qrCode",style:{marginBottom:0},children:t.jsx(yte,{placeholder:"Código QR",maxLength:60,value:e==null?void 0:e.qrcode})})]})}),{Card:Cte,Space:wte,Input:Ste,Form:Ite}=Ne,Ete=({product:e})=>t.jsx(Cte,{title:"Código de Barra",size:"small",extra:t.jsx(Oe,{title:"El código de barra es un código que se representa en forma de barras y espacios que pueden ser leídos e interpretados por un escáner. El código de barras se utiliza para identificar productos de forma única a nivel mundial."}),children:t.jsxs(wte,{direction:"vertical",align:"center",style:{width:"100%"},children:[t.jsx(g0,{width:1,height:50,value:(e==null?void 0:e.barcode)||"-"}),t.jsx(Ite.Item,{name:"barcode",style:{marginBottom:0},children:t.jsx(Ste,{placeholder:"Código de Barra",maxLength:60,value:e==null?void 0:e.barcode})})]})}),Ate=[{title:"Tipo",dataIndex:"description",key:"description"},{title:"Monto",dataIndex:"amount",key:"amount",render:(e,n)=>t.jsx(M.Item,{name:n.name,rules:[{required:!0,message:"Rellenar"},{type:"number",min:(n==null?void 0:n.cost)||0,message:`Minimo ${n==null?void 0:n.cost}`}],style:{margin:0},children:t.jsx(Ke,{defaultValue:e,min:0,step:.1})})},{title:"Itbis",dataIndex:"itbis",key:"itbis"},{title:"Total",dataIndex:"finalPrice",key:"finalPrice"},{title:"Margen",dataIndex:"margin",key:"margin"},{title:"% Ganancia",dataIndex:"percentBenefits",key:"percentBenefits"}],kte=()=>{const{product:e}=D(On),[n,s]=m.useState([]),o=W(),r=D(os),i=a=>[{key:"1",cost:a.pricing.cost,description:"Precio Lista",name:["pricing","listPrice"],amount:a.pricing.listPrice},{key:"2",cost:a.pricing.cost,description:"Precio Medio",name:["pricing","avgPrice"],amount:a.pricing.avgPrice},{key:"3",cost:a.pricing.cost,description:"Precio Mínimo",name:["pricing","minPrice"],amount:a.pricing.minPrice}].map(d=>{var C,I,j,k,A,P;const u=parseFloat(d.amount)||0;let p=0;typeof((C=a==null?void 0:a.pricing)==null?void 0:C.tax)=="number"?p=a.pricing.tax:typeof((I=a==null?void 0:a.pricing)==null?void 0:I.tax)=="object"&&((k=(j=a==null?void 0:a.pricing)==null?void 0:j.tax)!=null&&k.tax)?p=parseFloat(a.pricing.tax.tax):typeof((A=a==null?void 0:a.pricing)==null?void 0:A.tax)=="string"&&(p=parseFloat(a.pricing.tax));const h=parseFloat((P=a==null?void 0:a.pricing)==null?void 0:P.cost)||0,f=p/100,x=r?u*f:0,g=u+x,y=u-h,b=isFinite(y)&&isFinite(g)&&u>0,v=b&&u>0?y/u*100:0;return{...d,itbis:x.toFixed(2),finalPrice:g.toFixed(2),margin:y.toFixed(2),percentBenefits:`${b?v.toFixed(1):"0"}%`}});return m.useEffect(()=>{const a=i(e);s(a)},[e.pricing.cost,e.pricing.tax,e.pricing.listPrice,e.pricing.avgPrice,e.pricing.minPrice,r]),m.useEffect(()=>{var c;const a=Number((c=n[0])==null?void 0:c.finalPrice)||0;a>0&&a!==e.pricing.price&&o(Ob({pricing:{price:a}}))},[n,o]),t.jsx(Gt,{columns:Ate,dataSource:n,pagination:!1,size:"small"})},{message:pf,Dropdown:Tte}=Ne,Pte=({images:e})=>{const n=D(q),s=W(),o=r=>[{key:"2",label:"Seleccionar",onClick:()=>{pf.success("Imagen seleccionada"),s(Mb(r.url))}},{key:"3",label:"Delete",onClick:()=>{pf.info("Delete"),Lv(n,r)}}];return t.jsx(Dte,{children:e.map(r=>t.jsx($te,{children:t.jsx(Tte,{menu:{items:o(r)},trigger:["click"],children:t.jsx(Rte,{children:t.jsx(Nte,{preview:!1,src:r.url||vp,alt:`Thumbnail ${r}`})})})},r.id))})},Dte=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
  gap: 10px;
  margin-top: 20px;
  width: 100%;
`,$te=l.div`
//border: 1px solid #ccc;
  /* border: 1px solid #ccc;
  padding: 10px;
  text-align: center;
  cursor: pointer;
  */

`,Rte=l.div`
    width: 100%;
    height: 110px;
  
  
    overflow: hidden;
  `,Nte=l.img`
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    object-position: center;
    ${e=>e.selectedImage?`
        border: 1px solid blue;
      `:`
        border: 1px solid #ccc;
      `}
    
  `,{Upload:Ote,Button:mf,message:hf,Typography:Mte,Divider:gf}=Ne,Fte=l.div`
  display: grid;
  gap: 1em;
  padding: 20px;
`,Bte=l.div`
  display: grid;
  grid-template-columns: min-content min-content;
  justify-content: space-between;
  width: 100%;
`,Lte=l.div`
  display: flex;
  justify-content: space-between;
  width: 100%;
`,zte=l.div`
  
  /* width: 110px;
  height: 110px; */
  
  overflow: hidden;
    img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }
`,Ute=l.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: end;
  width: 100%;
  min-width: 200px;
  
`,Wte=l.div`
 
  width: 200px;

  max-width: 300px;
`,qte=({hideImageManager:e})=>{const n=D(q),[s,o]=m.useState([]),[r,i]=m.useState([]),{product:a}=D(On),c=a==null?void 0:a.productImageURL,d=W(),u=(f,x)=>{i(g=>g.map(y=>y.uid===f.uid?{...y,percent:x,name:f.name,status:"uploading"}:y))},p={name:"file",multiple:!1,fileList:r,action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",customRequest:async({file:f,onProgress:x})=>{try{const g={...f,percent:0,status:"uploading"};i([g]);const b=await zv(n,f,v=>{u(f,v),x&&x({percent:v})});await Bv(n,b),hf.success("Imagen subida exitosamente."),i([{...g,status:"done",url:b}])}catch{hf.error(`${f.name} imagen no subida.`),i([{...f,status:"error"}])}finally{i([])}}};m.useEffect(()=>{Fv(n,o)},[n]);const h=r.length>0?r[0].percent:0;return t.jsxs(Fte,{children:[t.jsx(Lte,{children:t.jsx(mf,{icon:t.jsx(tS,{}),onClick:e,children:"Atrás"})}),t.jsx(gf,{orientation:"left",style:{margin:0},children:"Cargar Imagen"}),t.jsxs(Bte,{children:[t.jsx(Wte,{children:t.jsxs(Ote.Dragger,{...p,children:[t.jsx("p",{className:"ant-upload-drag-icon",children:t.jsx(ss,{})}),t.jsx("p",{children:"Haz clic o arrastra la imagen a esta área para subirla"}),r.length>0?t.jsxs("p",{children:["Subiendo ",h,"%"]}):null]})}),t.jsxs(Ute,{children:[t.jsx(zte,{children:t.jsx(Lo,{height:110,width:110,src:c||Js,alt:"Selected",preview:!!c,fallback:vp})}),t.jsx(mf,{disabled:!c,onClick:()=>d(Mb(null)),children:"Deselecionar"})]})]}),t.jsx(gf,{orientation:"left",style:{margin:0},children:"Imágenes Subidas"}),t.jsx(Mte.Text,{type:"secondary",children:"Click en las imágenes para seleccionarlas"}),t.jsx(Pte,{images:s})]})},vp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3PTWBSGcbGzM6GCKqlIBRV0dHRJFarQ0eUT8LH4BnRU0NHR0UEFVdIlFRV7TzRksomPY8uykTk/zewQfKw/9znv4yvJynLv4uLiV2dBoDiBf4qP3/ARuCRABEFAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghgg0Aj8i0JO4OzsrPv69Wv+hi2qPHr0qNvf39+iI97soRIh4f3z58/u7du3SXX7Xt7Z2enevHmzfQe+oSN2apSAPj09TSrb+XKI/f379+08+A0cNRE2ANkupk+ACNPvkSPcAAEibACyXUyfABGm3yNHuAECRNgAZLuYPgEirKlHu7u7XdyytGwHAd8jjNyng4OD7vnz51dbPT8/7z58+NB9+/bt6jU/TI+AGWHEnrx48eJ/EsSmHzx40L18+fLyzxF3ZVMjEyDCiEDjMYZZS5wiPXnyZFbJaxMhQIQRGzHvWR7XCyOCXsOmiDAi1HmPMMQjDpbpEiDCiL358eNHurW/5SnWdIBbXiDCiA38/Pnzrce2YyZ4//59F3ePLNMl4PbpiL2J0L979+7yDtHDhw8vtzzvdGnEXdvUigSIsCLAWavHp/+qM0BcXMd/q25n1vF57TYBp0a3mUzilePj4+7k5KSLb6gt6ydAhPUzXnoPR0dHl79WGTNCfBnn1uvSCJdegQhLI1vvCk+fPu2ePXt2tZOYEV6/fn31dz+shwAR1sP1cqvLntbEN9MxA9xcYjsxS1jWR4AIa2Ibzx0tc44fYX/16lV6NDFLXH+YL32jwiACRBiEbf5KcXoTIsQSpzXx4N28Ja4BQoK7rgXiydbHjx/P25TaQAJEGAguWy0+2Q8PD6/Ki4R8EVl+bzBOnZY95fq9rj9zAkTI2SxdidBHqG9+skdw43borCXO/ZcJdraPWdv22uIEiLA4q7nvvCug8WTqzQveOH26fodo7g6uFe/a17W3+nFBAkRYENRdb1vkkz1CH9cPsVy/jrhr27PqMYvENYNlHAIesRiBYwRy0V+8iXP8+/fvX11Mr7L7ECueb/r48eMqm7FuI2BGWDEG8cm+7G3NEOfmdcTQw4h9/55lhm7DekRYKQPZF2ArbXTAyu4kDYB2YxUzwg0gi/41ztHnfQG26HbGel/crVrm7tNY+/1btkOEAZ2M05r4FB7r9GbAIdxaZYrHdOsgJ/wCEQY0J74TmOKnbxxT9n3FgGGWWsVdowHtjt9Nnvf7yQM2aZU/TIAIAxrw6dOnAWtZZcoEnBpNuTuObWMEiLAx1HY0ZQJEmHJ3HNvGCBBhY6jtaMoEiJB0Z29vL6ls58vxPcO8/zfrdo5qvKO+d3Fx8Wu8zf1dW4p/cPzLly/dtv9Ts/EbcvGAHhHyfBIhZ6NSiIBTo0LNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiEC/wGgKKC4YMA4TAAAAABJRU5ErkJggg==",Vte=async(e,n)=>{const s={...e},{businessID:o}=n,r=F($,"businesses",o,"products",s.id);await je(r,s)},Gte=(e,n)=>{if(!(n!=null&&n.businessID))return;const s={createdAt:de(),createdBy:n.uid,updatedAt:de(),updatedBy:n.uid,deletedAt:null,deletedBy:null,isDeleted:!1},o={...e,id:be(10)};return new Promise(async(r,i)=>{try{await Fo($,async a=>{const c=await Oc(n,a);if(!(c!=null&&c.id))throw new Error("No se pudo obtener almacén predeterminado");const d=await Mt(n,"batches",1,a);if(!d)throw new Error("Error al generar número de lote");const u=F($,"businesses",n.businessID,"products",o.id);a.set(u,o);const p={...s,id:be(10),productId:o.id,productName:o.name,numberId:d,status:Ur.Active,receivedDate:de(),providerId:null,quantity:o.stock,initialQuantity:o.stock},h=F($,"businesses",n.businessID,"batches",p.id);a.set(h,p);const f={...s,id:be(10),batchId:p.id,productName:o.name,batchNumberId:d,location:c.id,expirationDate:null,status:Ur.Active,productId:o.id,quantity:o.stock,initialQuantity:o.stock},x=F($,"businesses",n.businessID,"productsStock",f.id);a.set(x,f);const g={...s,id:be(10),batchId:p.id,productName:o.name,batchNumberId:d,destinationLocation:c.id,sourceLocation:null,productId:o.id,quantity:o.stock,movementType:ro.Entry,movementReason:Zn.InitialStock},y=F($,"businesses",n.businessID,"movements",g.id);a.set(y,g)}),r()}catch(a){console.error("Error en fbAddProduct:",a),i(a)}})},_te=({showImageManager:e})=>{const n=W(),s=D(q),[o,r]=m.useState(!1),[i]=M.useForm(),{product:a,status:c}=D(On),d=(h,f)=>{const x=Object.keys(h)[0],g=h[x];if(x==="cost"&&(h[x]=g?{unit:g.unit,total:g.unit}:0),x==="tax"&&(typeof g=="string"?h[x]=parseFloat(g)||No[0]:h[x]=g||No[0]),x==="pricing"){n(Ob({pricing:g}));return}if(x==="weightDetail"){n(kr({product:{weightDetail:{...a==null?void 0:a.weightDetail,...h==null?void 0:h.weightDetail}}}));return}if(x==="warranty"){n(kr({product:{warranty:{...a==null?void 0:a.warranty,...h==null?void 0:h.warranty}}}));return}n(kr({product:{...h}}))},u=async h=>{r(!0);try{await i.validateFields(),c==="update"?(await Vte(a,s),Be.success({message:"Producto Actualizado",description:"El producto ha sido actualizado correctamente."})):(await Gte(a,s),Be.success({message:"Producto Creado",description:"El producto ha sido creado correctamente."})),n(Rd()),n(Nd())}catch(f){f.errorFields&&f.errorFields.forEach(x=>{Be.error({message:"Error",description:x.errors[0],duration:10})})}finally{r(!1)}},p=()=>{i.resetFields(),n(Rd()),n(Nd())};return t.jsx(He,{tip:"Cargando...",spinning:o,indicator:t.jsx(Yr,{style:{fontSize:24},spin:!0}),children:t.jsxs(M,{form:i,layout:"vertical",onFinish:u,onValuesChange:d,initialValues:{...a},style:{gap:"10px",display:"grid"},children:[t.jsxs(Wt,{gutter:16,children:[t.jsx(rt,{span:16,style:{display:"grid"},children:t.jsxs(Ye,{direction:"vertical",style:{width:"100%"},children:[t.jsx(ate,{product:a}),t.jsx(ute,{product:a}),t.jsx(fte,{product:a})]})}),t.jsx(rt,{span:8,style:{display:"grid"},children:t.jsxs(Ye,{direction:"vertical",children:[t.jsx(Je,{title:"Imagen del producto",size:"small",children:t.jsxs(Ye,{direction:"vertical",style:{width:"100%"},children:[t.jsxs(Hte,{children:[(a==null?void 0:a.image)&&t.jsx(antd.Image,{height:150,src:a==null?void 0:a.image}),!(a!=null&&a.image)&&t.jsx(Qte,{children:t.jsx(Yte,{src:vp})})]}),t.jsxs(U,{style:{width:"100%"},onClick:e,children:[a!=null&&a.productImageURL?"Actualizar":"Agregar"," imagen"]})]})}),t.jsx(jte,{product:a}),t.jsx(Ete,{product:a}),t.jsx(z2,{})]})})]}),t.jsx(kte,{}),t.jsxs(Kte,{children:[t.jsx(U,{htmlType:"button",onClick:p,children:"Cancelar"}),t.jsx(U,{type:"primary",htmlType:"submit",onClick:u,disabled:o,children:c==="update"?"Actualizar":"Crear"})]})]})})},Hte=l.div`
    border-radius: 5px;
    height: 150px;
    overflow: hidden;
`,Qte=l.div`
    height: 100%;
   width: 100%;
  `,Yte=l.img`
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  `,Kte=l.div`
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    align-items: center;
   
 height: min-content;
    width: 100%;
    `;l.div`
  padding: 16px;
`;l.span`
  font-size: 1rem;
  font-weight: 500;
  color: #333;
`;l.div`
  font-size: 0.875rem;
  color: #8c8c8c;
  margin-top: 4px;
`;const Jte=l.div`

  min-height: 100vh;
`,Xte=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
`,Zte=l.h2`
  font-size: 1.2rem;
  font-weight: 700;
  margin-bottom: 24px;
`,ene=()=>{const{product:e,status:n}=D(On),[s,o]=m.useState([]),r=D(q);return W(),m.useEffect(()=>{let i;return(async()=>{try{if(!r||!(e!=null&&e.id))return;i=await Vv(r,e==null?void 0:e.id,o)}catch(c){console.error("Error al obtener lotes:",c)}})(),()=>{i&&i()}},[r,e]),t.jsx(Jte,{children:t.jsxs("div",{children:[t.jsx(Xte,{children:t.jsx(Zte,{children:"Lista de Lotes"})}),t.jsx(Sn,{dataSource:s,renderItem:i=>t.jsx(Sn.Item,{children:t.jsx(Sn.Item.Meta,{title:t.jsxs("strong",{children:["Lote #",i.numberId]}),description:t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:["Cantidad: ",t.jsx(Ge,{color:"blue",children:i.quantity})]}),t.jsxs("div",{children:["Fecha de Expiración: ",DateTime.fromISO(i.expirationDate).toLocaleString(DateTime.DATE_MED)]})]})})},i.key)})]})})},tne=l.div``,nne=({isOpen:e,initialValues:n,onSubmit:s,onCancel:o})=>{const[r]=M.useForm(),i=D(q),a={unitName:"",packSize:1,pricing:{tax:0,cost:0,listPrice:0,stock:0,avgPrice:0,price:0,minPrice:0,listPriceEnabled:!1,avgPriceEnabled:!1,minPriceEnabled:!1}},[c,d]=m.useState([]),{product:{id:u}}=D(On);m.useEffect(()=>{n?(r.setFieldsValue(n),f(n)):(r.resetFields(),d([]))},[n,r]);const p=x=>{try{const g={...x,pricing:{...x.pricing,price:x.pricing.listPrice}};n?(kg(i,u,{...n,...g}),V.success("Unidad de venta actualizada correctamente")):(kg(i,u,g),V.success("Unidad de venta agregada correctamente")),s()}catch(g){console.error(g)}},h=(x,g)=>{f(g)},f=x=>{const{pricing:g={}}=x,{tax:y=0,cost:b=0,listPrice:v=0,avgPrice:C=0,minPrice:I=0,listPriceEnabled:j=!1,avgPriceEnabled:k=!1,minPriceEnabled:A=!1}=g,P=S=>{const E=y/100,T=S*E,R=S+T,N=R-b,G=R>0?N/R*100:0;return{precioSinItbis:S.toFixed(2),itbis:T.toFixed(2),total:R.toFixed(2),margen:N.toFixed(2),porcentajeGanancia:`${G.toFixed(0)}%`}},w=[];j&&w.push({key:"1",tipoPrecio:"Precio de Lista",...P(v)}),k&&w.push({key:"2",tipoPrecio:"Precio Promedio",...P(C)}),A&&w.push({key:"3",tipoPrecio:"Precio Mínimo",...P(I)}),d(w)};return t.jsx(Ce,{title:n?"Editar Unidad de Venta":"Agregar Nueva Unidad de Venta",open:e,width:1e3,style:{top:5},footer:[t.jsx(U,{onClick:o,children:"Cancelar"},"back"),t.jsx(U,{type:"primary",onClick:r.submit,children:n?"Actualizar":"Agregar"},"submit")],onCancel:o,children:t.jsxs(sne,{children:[t.jsx(M,{form:r,layout:"vertical",initialValues:a,onFinish:p,onValuesChange:h,children:t.jsxs(tne,{children:[t.jsx(M.Item,{name:"unitName",tooltip:"Nombre de la unidad de venta",label:"Nombre de la Unidad",rules:[{required:!0,message:"Por favor ingresa el nombre de la unidad"}],children:t.jsx(ie,{placeholder:"Ejemplo: Caja"})}),t.jsxs(ff,{children:[t.jsx(M.Item,{tooltip:"Cantidad de productos en stock",label:"Stock",children:"//here we calculate the stock"}),t.jsx(M.Item,{name:"packSize",tooltip:"Cantidad de productos en un paquete",label:"Cantidad de Productos por Paquete",rules:[{required:!0,message:"Por favor ingresa la cantidad"}],children:t.jsx(Ke,{min:1,style:{width:"100%"}})})]}),t.jsxs(ff,{children:[t.jsx(M.Item,{name:["pricing","tax"],tooltip:"Impuesto aplicado a la unidad de venta",label:"Impuesto",rules:[{required:!0,message:"Por favor ingresa el impuesto"}],children:t.jsx(Ke,{style:{width:"100%"},placeholder:"Ejemplo: IVA"})}),t.jsx(M.Item,{name:["pricing","cost"],label:"Costo",rules:[{required:!0,message:"Por favor ingresa el costo"}],children:t.jsx(Ke,{min:0,step:.01,style:{width:"100%"}})})]}),t.jsx(M.Item,{shouldUpdate:(x,g)=>x!==g,children:({getFieldValue:x})=>{const g=x(["pricing","listPriceEnabled"]);return t.jsx(M.Item,{label:t.jsx(M.Item,{name:["pricing","listPriceEnabled"],valuePropName:"checked",noStyle:!0,children:t.jsx(St,{children:"Precio de Lista"})}),tooltip:"El precio de lista es el precio sugerido para la venta al  público.",name:["pricing","listPrice"],rules:[{required:g,message:"Por favor ingresa el precio de lista"}],children:t.jsx(Ke,{min:0,step:.01,style:{width:"100%"},disabled:!g})})}}),t.jsx(M.Item,{shouldUpdate:(x,g)=>x!==g,children:({getFieldValue:x})=>{const g=x(["pricing","avgPriceEnabled"]);return t.jsx(M.Item,{label:t.jsx(M.Item,{name:["pricing","avgPriceEnabled"],valuePropName:"checked",noStyle:!0,children:t.jsx(St,{children:"Precio Promedio"})}),tooltip:"El precio promedio es el precio que se espera que el producto se venda en el mercado.",name:["pricing","avgPrice"],rules:[{required:g,message:"Por favor ingresa el precio promedio"}],children:t.jsx(Ke,{min:0,step:.01,style:{width:"100%"},disabled:!g})})}}),t.jsx(M.Item,{shouldUpdate:(x,g)=>x!==g,children:({getFieldValue:x})=>{const g=x(["pricing","minPriceEnabled"]);return t.jsx(M.Item,{label:t.jsx(M.Item,{name:["pricing","minPriceEnabled"],valuePropName:"checked",noStyle:!0,children:t.jsx(St,{children:"Precio Mínimo"})}),tooltip:"El precio mínimo es el precio más bajo al que se puede vender el producto.",name:["pricing","minPrice"],rules:[{required:g,message:"Por favor ingresa el precio mínimo"}],children:t.jsx(Ke,{min:0,step:.01,style:{width:"100%"},disabled:!g})})}})]})}),t.jsx(one,{children:c.map(x=>t.jsxs(rne,{style:{backgroundColor:x.key==="1"?"#fff5e8":x.key==="2"?"#f4fef6":"#e9f3f9"},children:[t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsxs(ane,{children:[x.key==="1"&&t.jsx(nS,{style:{fontSize:"24px",color:"#ffbf00"}}),x.key==="2"&&t.jsx(sS,{style:{fontSize:"24px",color:"#52c41a"}}),x.key==="3"&&t.jsx(oS,{style:{fontSize:"24px",color:"#1890ff"}})]}),t.jsx(ine,{children:x.tipoPrecio})]}),t.jsx(hr,{title:"Monto",value:Y(x.precioSinItbis)}),t.jsx(hr,{title:"Itbis",value:Y(x.itbis)}),t.jsx(hr,{title:"Margen",value:Y(x.margen)}),t.jsx(hr,{title:"Ganancia (%)",value:x.porcentajeGanancia}),t.jsx(hr,{title:"Total",value:Y(x.total)})]},x.key))})]})})},sne=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));

  gap: 1em;
  width: 100%;
`,ff=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1em;
  align-items: end;

`,one=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  align-content: start;
  gap: 1em;
  margin-top: 20px;
`,rne=l.div`
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 8px 16px;
  background-color: #fafafa;
  width: 100%;
  box-shadow: 0 2px 2px rgba(0, 0, 0, 0.15);
`,ine=l.h3`
  font-size: 1rem;
  margin-bottom: 8px;
`,ane=l.div`
  margin-bottom: 8px;
`,cne=l.span`
  font-weight: 550;
  margin-right: 16px;
`,lne=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,hr=({title:e,value:n})=>t.jsxs(lne,{children:[t.jsx(cne,{children:e}),t.jsx("span",{children:n})]}),dne=l.div`
  border: 1px solid #d9d9d9;
  border-radius: 8px;
  padding: 16px;
  background-color: #fff;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
  width: 300px;

`,une=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;

`,pne=l.div`
  margin-top: 16px;
`,mne=({unit:e,onEdit:n,onDelete:s,onInfo:o})=>{var c;const r=d=>{d.stopPropagation(),o()},i=d=>{d.stopPropagation(),n()},a=d=>{d.stopPropagation(),s()};return t.jsxs(dne,{onClick:r,children:[t.jsxs(une,{children:[t.jsx("span",{children:e==null?void 0:e.unitName}),t.jsxs("div",{children:[t.jsx(Oe,{title:"Editar",children:t.jsx(U,{type:"text",icon:t.jsx(es,{}),onClick:i,size:"small",style:{marginRight:"8px"}})}),t.jsx(U,{type:"link",danger:!0,onClick:a,icon:t.jsx(ht,{}),size:"small"})]})]}),t.jsxs(pne,{children:[t.jsxs("p",{children:["Cantidad: ",e==null?void 0:e.quantity]}),t.jsxs("p",{children:["Precio: ",Y((c=e==null?void 0:e.pricing)==null?void 0:c.listPrice)]})]})]})},hne=l.div`
  margin-bottom: 20px;
`;l.div`
  margin-bottom: 20px;
`;const gne=l.div`
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
`,fne=({onShowPricingModal:e})=>{W();const{product:{id:n}}=D(On),s=D(q),{data:o}=kj(n),[r,i]=m.useState(!1),[a,c]=m.useState(null),d=()=>{c(null),i(!0)},u=g=>{c(g),i(!0)},p=g=>{e(g)},h=g=>{i(!1),c(null)},f=g=>{fQ(s,n,g)},x=()=>{i(!1),c(null)};return t.jsxs(hne,{children:[t.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:t.jsx(U,{type:"primary",icon:t.jsx(Jn,{}),onClick:d,style:{marginBottom:"20px"},children:"Unidad de Venta"})}),t.jsxs(gne,{children:[o.map(g=>t.jsx(mne,{unit:g,onEdit:()=>u(g),onDelete:()=>f(g==null?void 0:g.id),onInfo:()=>p(g)},g==null?void 0:g.id)),o.length===0&&t.jsx(xne,{children:"No hay unidades de venta configuradas."})]}),t.jsx(nne,{initialValues:a,isOpen:r,onSubmit:h,onCancel:x})]})},xne=l.p`
    font-size: 1rem;
    color: #666;
    text-align: center;
    padding: 15px;
    border: 1px dashed #ccc;
    border-radius: 8px;
    background-color: #f9f9f9;
`,bne=({visible:e,unit:n,onClose:s})=>t.jsx(Ce,{title:n?`Detalles de Precios para ${n.unitName}`:"Detalles de Precios",open:e,onCancel:s,footer:[t.jsx(U,{type:"primary",onClick:s,children:"Cerrar"},"close")],children:n?t.jsxs(Zt,{bordered:!0,column:1,children:[t.jsxs(Zt.Item,{label:"Costo",children:["$",n.pricing.cost.toFixed(2)]}),t.jsxs(Zt.Item,{label:"Precio",children:["$",n.pricing.price.toFixed(2)]}),t.jsxs(Zt.Item,{label:"Precio de Lista",children:["$",n.pricing.listPrice.toFixed(2)]}),t.jsxs(Zt.Item,{label:"Precio Promedio",children:["$",n.pricing.avgPrice.toFixed(2)]}),t.jsxs(Zt.Item,{label:"Precio Mínimo",children:["$",n.pricing.minPrice.toFixed(2)]}),t.jsx(Zt.Item,{label:"Impuesto",children:n.pricing.tax})]}):t.jsx("p",{children:"No hay información disponible."})}),yne=l.div`

 
`,vne=()=>{const[e,n]=m.useState(!1),[s,o]=m.useState(null),r=a=>{o(a),n(!0)},i=()=>{o(null),n(!1)};return t.jsxs(yne,{children:[t.jsx(fne,{onShowPricingModal:r}),t.jsx(bne,{visible:e,unit:s,onClose:i})]})},jne=({showImageManager:e})=>{const{status:n}=D(On),s=[{key:"1",label:"General",children:t.jsx(_te,{showImageManager:e})},{key:"2",label:"Lote",disabled:n==="create",children:t.jsx(ene,{})},{key:"3",label:"Unidades de Venta",disabled:n==="create",children:t.jsx(vne,{})}];return t.jsx(eo,{defaultActiveKey:"1",items:s})},Cne=(e,n,s,o)=>{if(!(e!=null&&e.businessID))return;const r=F($,"businesses",e.businessID,"products",n);return Te(r,a=>{a.exists()?s(a.data()):o(new Error("El producto no existe"))},a=>{o(a)})},wne=({isOpen:e})=>{const[n,s]=m.useState("product-form"),o=W(),r=D(q),{product:i,status:a}=D(On),c=()=>s("image-manager"),d=()=>s("product-form"),u=()=>{o(Rd()),o(Nd())};return m.useEffect(()=>{if(i.id==="")return;const p=x=>o(V2(x)),h=x=>console.error("Error al escuchar el producto:",x),f=Cne(r,i.id,p,h);return()=>f()},[r]),t.jsxs(Ce,{centered:!0,open:e,width:1e3,style:{top:5},title:a==="update"?`Editar: ${i.name}`:"Nuevo Producto",onCancel:u,footer:null,children:[n==="product-form"&&t.jsx(jne,{showImageManager:c}),n==="image-manager"&&t.jsx(qte,{hideImageManager:d})]})},{Form:Sne,Divider:Ine,Descriptions:gr,Select:Ene,Collapse:Ane}=Ne,kne=({invoice:e})=>{const n=e==null?void 0:e.client;console.log(e);const s=W(),{clients:o}=Aj();console.log(o);const r=o.map(({client:c})=>({label:c.name,value:JSON.stringify(c)})),i=c=>{s(Ey({client:JSON.parse(c)}))},a=[{key:"1",label:"Detalles del Cliente Selecionado",children:t.jsxs(gr,{layout:"vertical",size:"small",children:[t.jsx(gr.Item,{label:"Nombre",children:n.name}),t.jsx(gr.Item,{label:"Teléfono",children:n.tel}),t.jsx(gr.Item,{label:"ID Personal",children:n.personalID}),t.jsx(gr.Item,{label:"Dirección",children:n.address})]})}];return console.log(r),t.jsxs("div",{children:[t.jsx(Ine,{style:{marginTop:0},orientation:"left",orientationMargin:!1,children:"Informacion Cliente"}),t.jsx(Tne,{children:t.jsx(Sne.Item,{labelAlign:"right",tooltip:"Selecciona un cliente",hasFeedback:!0,label:"Cambiar Cliente",children:t.jsx(Ene,{showSearch:!0,placeholder:"Buscar y seleccionar cliente",filterOption:(c,d)=>d.label.toLowerCase().includes(c.toLowerCase()),options:r,style:{width:200},value:n.name,onChange:i})})}),t.jsx(Ane,{style:{margin:0},ghost:!0,items:a})]})};l.div`
    display: grid;
    gap: 1em;
    grid-template-columns: min-content 150px;

`;const Tne=l.div`
    
`,{Descriptions:xo,Typography:zj}=Ne,{Title:Pne}=zj,Dne=({invoice:e})=>t.jsxs(t.Fragment,{children:[t.jsx(Pne,{level:5,children:"Detalle de la Factura"}),t.jsxs(xo,{size:"small",layout:"vertical",children:[t.jsx(xo.Item,{label:"Cambio",children:t.jsx(zj.Text,{type:e.change.value<0?"danger":e.change.value==0?"success":null,children:Y(e.change.value)})}),t.jsx(xo.Item,{label:"Total de la Compra",children:Y(e.totalPurchase.value)}),t.jsx(xo.Item,{label:"Total sin Impuestos",children:Y(e.totalPurchaseWithoutTaxes.value)}),t.jsx(xo.Item,{label:"Impuestos Totales",children:Y(e.totalTaxes.value)}),t.jsxs(xo.Item,{label:"Articulos Comprados",children:[" ",e.totalShoppingItems.value]})]})]}),$ne=async(e,n,s)=>{try{if(!n||!e||!e.businessID||!n.id||!n.products)throw new Error("No se ha podido cancelar la factura. Faltan datos.");await Fo($,async o=>{const r=F($,"businesses",e.businessID,"invoices",n.id);for(const i of n.products){const a=F($,"businesses",e.businessID,"products",i.id);o.update(a,{"product.stock":fn(i.amountToBuy.total)})}o.update(r,{"data.status":"cancelled","data.cancel":{reason:s,user:e.uid,cancelledAt:ue.now()}})})}catch(o){console.error("Transaction failed: ",o)}},{Form:To,Input:ou,Col:Vl,Row:xf,Button:Rne,Modal:Nne,Alert:One,Typography:bf,Spin:Mne}=Ne,Fne=({invoice:e})=>{const[n,s]=m.useState(!1);e!=null&&e.date&&ce.fromSeconds(e==null?void 0:e.date).toFormat("yyyy-LL-dd");const o=()=>s(!1),r=()=>s(!0);return t.jsxs(t.Fragment,{children:[t.jsx(kne,{invoice:e}),t.jsx(gn,{orientation:"left",orientationMargin:!1,children:"Informacion de Pago"}),t.jsxs(xf,{gutter:16,children:[t.jsx(Vl,{span:8,children:t.jsx(To.Item,{label:"Monto Pagado",name:["payment","value"],children:t.jsx(ou,{type:"number"})})}),t.jsx(Vl,{span:8,children:t.jsx(To.Item,{label:"Descuento %",name:["discount","value"],help:"Ejemplo: 10 = 10%",children:t.jsx(ou,{type:"number"})})})]}),t.jsx(Dne,{invoice:e}),t.jsx("br",{}),t.jsx(xf,{gutter:16,children:t.jsx(Vl,{children:t.jsx(To.Item,{children:t.jsx(Rne,{danger:!0,disabled:e.NCF,onClick:r,children:"Anular"})})})}),t.jsx(Bne,{isOpen:n,invoice:e,handleClose:o})]})},Bne=({isOpen:e,invoice:n,handleClose:s})=>{const[o]=To.useForm(),[r,i]=m.useState(!1),[a,c]=m.useState(!1),d=W(),u=D(q),p=async()=>{c(!0);try{const x=(await o.validateFields()).cancellationReason;await $ne(u,n,x),d(Wd()),s(),V.success("Factura anulada correctamente")}catch{V.error("Error al anular factura")}finally{o.resetFields(),c(!1)}},h=()=>{o.resetFields(),s()};return t.jsx(Nne,{title:"Confirmación de Anulación",open:e,onOk:p,okText:"Anular",okButtonProps:{danger:!0},onCancel:h,children:t.jsxs(Mne,{spinning:a,tip:"Cargando...",size:"large",children:[t.jsx(One,{message:"¿Está seguro que desea anular esta factura?",description:t.jsx("div",{children:t.jsxs("ul",{style:{paddingInlineStart:0},children:[t.jsx("li",{children:t.jsx(bf.Text,{children:"Esta factura se anulará y no se podrá revertir"})}),t.jsx("li",{children:t.jsx(bf.Text,{children:"Los productos de esta factura volverán a estar disponibles en el inventario"})})]})}),type:"warning",showIcon:!0}),t.jsx("br",{}),t.jsxs(To,{form:o,layout:"vertical",children:[t.jsx(To.Item,{label:"Motivo de la anulación",name:"cancellationReason",help:"Ejemplo: El cliente se arrepintió de la compra",rules:[{required:!0,message:"Por favor ingrese el motivo de la anulación"}],children:t.jsx(ou,{type:"text",placeholder:"Motivo de la anulación"})}),t.jsx("br",{})]})]})})};l.div`
 display: grid;
  gap: 1em;
  grid-template-columns: minmax(100px, 200px) min-content;
`;l.div`
  
`;l.div`
  
`;l.div`
  display: grid;
  gap: 1em;
  grid-template-columns: 2em 80px 2em;
`;const{Modal:Lne,Table:zne,Button:Une}=Ne,Wne=({isVisible:e,onClose:n,products:s,onAddProduct:o})=>{const r=[{title:"Producto",dataIndex:["name"],key:"name",sorter:(a,c)=>a.name.localeCompare(c.name)},{title:"Precio Unitario",dataIndex:["pricing","price"],key:"price",render:(a,c)=>Y(tt(c)),sorter:(a,c)=>{const d=tt(a),u=tt(c);return d-u}},{title:"Stock",dataIndex:["stock"],key:"stock",sorter:(a,c)=>a.stock-c.stock},{title:"Acciones",key:"actions",render:(a,c)=>t.jsx(Une,{onClick:()=>o(c),children:"Añadir"})}],i={pageSize:5,position:["bottomCenter"]};return t.jsx(Lne,{title:"Agregar Producto a la Factura",open:e,onCancel:n,footer:null,width:800,children:t.jsx(zne,{dataSource:s,columns:r,pagination:i,rowKey:"id"})})},{Button:Qi,Input:qne,Table:Vne}=Ne,Gne=({invoice:e})=>{const n=W(),[s,o]=m.useState(!1),{products:r}=Rs(),i=[{title:"Producto",dataIndex:"name",key:"productName"},{title:"Cantidad",dataIndex:"amountToBuy",key:"amountToBuy",render:(u,p,h)=>t.jsxs(Hne,{children:[t.jsx(Qi,{onClick:()=>n(cl({product:p,type:"subtract"})),icon:z.mathOperations.subtract}),t.jsx(qne,{value:p.amountToBuy,onChange:f=>{const x=f.target.value;!isNaN(parseFloat(x))&&isFinite(x)&&n(cl({product:p,amount:Number(x),type:"change"}))}}),t.jsx(Qi,{onClick:()=>n(cl({product:p,type:"add"})),icon:z.operationModes.add})]})},{title:"Precio Unitario",dataIndex:"price",key:"price",render:(u,p)=>`${Y(tt(p))}`},{title:"Precio Total",key:"totalPrice",render:(u,p)=>`${Y(tt(p))}`},{title:"Acciones",key:"actions",render:(u,p)=>t.jsx(Qi,{onClick:()=>n(bR({product:p})),icon:z.operationModes.delete})}],a={pageSize:5,position:["bottomCenter"]},c=()=>{o(!0)},d=u=>{n(xR({product:u})),o(!1)};return t.jsxs(_ne,{children:[t.jsx(Qne,{children:t.jsx(Qi,{type:"primary",onClick:c,children:"Añadir Producto"})}),t.jsx(Vne,{size:"small",dataSource:e==null?void 0:e.products,columns:i,pagination:a,rowKey:"id"}),t.jsx(Wne,{isVisible:s,onClose:()=>o(!1),products:r,onAddProduct:d})]})},_ne=l.div`

`,Hne=l.div`
  display: grid;
  gap: 1em;
  grid-template-columns: 2em 80px 2em;
`,Qne=l.div`
  text-align: right; // Esto alinea tu botón a la derecha
  margin-bottom: 16px; // Para que no quede tan pegado al input
`,Yne=async(e,n)=>{const{id:s}=n.data,o=F($,"businesses",e.businessID,"previousInvoices",s);await De(o,{data:{...n.data,savedAt:ue.now()}})},Kne=async(e,n,s)=>{const o=new Map(n.products.map(i=>[i.id,i])),r=new Map(s.products.map(i=>[i.id,i]));for(const[i,a]of o){const c=r.get(i);let d=0;c?d=c.amountToBuy.total-a.amountToBuy.total:d=-a.amountToBuy.total,await yf(e,i,d)}for(const[i,a]of r)o.has(i)||await yf(e,i,a.amountToBuy.total)},yf=async(e,n,s)=>{console.log(`Simulando la actualización del stock del producto ${n} en ${s} unidades.`);const o=F($,"businesses",e.businessID,"products",n);await je(o,{"product.stock":fn(s)}),console.log(`Actualizaría el stock del producto ${n} en ${s} unidades.`)},Jne=async(e,n)=>{const{id:s}=n,o=F($,"businesses",e.businessID,"invoices",s);try{const r=await Se(o);if(r.exists()){const i=r.data();await Yne(e,i),await Kne(e,n,i.data);let a={...n,date:ue.fromMillis(n.date),updateAt:ue.now()};await je(o,{data:a})}}catch{}},{Alert:Xne,Typography:Yt}=Ne,Zne=({invoice:e})=>{const[n,s]=m.useState(0);m.useEffect(()=>{const r=()=>{const a=ce.now(),d=ce.fromMillis(e.date).plus({days:2}).diff(a,"seconds").seconds;s(Math.max(0,d))};r();const i=setInterval(r,1e3);return()=>clearInterval(i)},[e]);const o=()=>n<=0?"00:00:00":lC.fromObject({seconds:n}).toFormat("hh:mm:ss");return t.jsx("div",{children:n>0&&t.jsxs("div",{children:[t.jsx(Xne,{closable:!0,message:`Tiempo restante para modificar la factura: ${o()}`,description:"Una vez transcurrido este tiempo, no podrás realizar cambios en la factura.",type:"warning",showIcon:!0}),t.jsx("br",{}),t.jsx(ese,{invoice:e})]})})},ese=({invoice:e})=>t.jsx("div",{children:t.jsxs(tse,{children:[t.jsxs(bo,{children:[t.jsx(Yt.Text,{children:"Articulos:"}),t.jsx(Yt.Text,{children:e.totalShoppingItems.value})]}),t.jsxs(bo,{children:[t.jsx(Yt.Text,{children:"Cambio:"}),t.jsx(Yt.Text,{type:e.change.value<0?"danger":e.change.value==0?"success":null,children:Y(e.change.value)})]}),t.jsxs(bo,{children:[t.jsx(Yt.Text,{children:"SubTotal:"}),t.jsx(Yt.Text,{children:Y(e.totalPurchaseWithoutTaxes.value)})]}),t.jsxs(bo,{children:[t.jsx(Yt.Text,{children:"Impuestos:"}),t.jsx(Yt.Text,{children:Y(e.totalTaxes.value)})]}),t.jsxs(bo,{children:[t.jsx(Yt.Text,{children:"Descuento:"}),t.jsxs(Yt.Text,{children:[e.discount.value>0?` ${Y(e.discount.value/100*e.totalPurchaseWithoutTaxes.value)}`:Y("0.00")," (",e.discount.value,"%)"]})]}),t.jsxs(bo,{children:[t.jsx(Yt.Text,{children:"Total:"}),t.jsx(Yt.Text,{children:Y(e.totalPurchase.value)})]})]})}),bo=l.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
`,tse=l.div`
  max-width: 300px;
`,{Form:vf,Button:jf,Modal:nse,Select:sse}=Ne,{Option:HCe}=sse,ose=({})=>{const[e]=vf.useForm(),[n,s]=m.useState(!1),[o,r]=m.useState(!1),{invoice:i,modal:a}=D(yR),c=W(),d=D(q),u=async()=>{try{const x=await e.validateFields();await Jne(d,i),c(Wd()),V.success("Factura actualizada correctamente")}catch(x){V.error("Error al actualizar factura"),console.error("Validate Failed or Update Failed:",x)}};m.useEffect(()=>{e.setFieldsValue(i)},[i]),m.useEffect(()=>{if(a.isOpen)r(!0);else{const x=setTimeout(()=>{r(!1)},600);return()=>clearTimeout(x)}},[a.isOpen]);const p=()=>{c(Wd())},h=[{key:"1",label:"General",children:t.jsx(Fne,{invoice:i})},{key:"2",label:"Productos",children:t.jsx(Gne,{invoice:i})},{key:"3",label:"Más Detalles",children:t.jsx(Zne,{invoice:i})}],f=x=>{const g=Object.keys(x)[0];if(g==="client"){c(Ey(x));return}if(g==="discount"){c(Nm({invoice:{[g]:{value:Number(x.discount.value)}}}));return}c(Nm({invoice:x}))};return t.jsx(nse,{style:{top:10},title:`Editar factura: ${i!=null&&i.NCF?(i==null?void 0:i.NCF)+" / ":""}  ${(i==null?void 0:i.date)&&ce.fromMillis(i==null?void 0:i.date).toFormat("dd LLL yyyy")} `,open:a.isOpen,width:800,onCancel:p,destroyOnHidden:!0,footer:[t.jsxs("div",{style:{float:"left",alignItems:"center",display:"flex",gap:16},children:[t.jsxs("div",{children:["Total: ",Y(i.totalPurchase.value)]}),t.jsxs("div",{children:["Itbis: ",Y(i.totalTaxes.value)]}),t.jsxs("div",{children:["Items: ",i.totalShoppingItems.value]})]},"1"),t.jsx(jf,{onClick:p,children:"Cancelar"},"back"),t.jsx(jf,{type:"primary",onClick:u,children:"Guardar"},"submit")],children:t.jsx(vf,{form:e,initialValues:i,layout:"vertical",onValuesChange:f,children:t.jsx(eo,{defaultActiveKey:"1",items:h})})})},{Image:rse,Card:Cf}=Ne,ise=({files:e=[]})=>{const n=o=>o.includes("image")?t.jsx(ts,{}):o.includes("pdf")?t.jsx(ns,{}):t.jsx(no,{}),s=o=>{const{name:r,type:i,size:a,url:c}=o,d=i.includes("image"),u=d?t.jsx(rse,{alt:r,src:c,style:{height:110,objectFit:"cover"}}):t.jsx("div",{style:{height:110,display:"flex",fontSize:"3em",alignItems:"center",justifyContent:"center"},children:n(i)});return t.jsx(cse,{children:t.jsx(Cf,{hoverable:!0,size:"small",style:{width:"100%",marginBottom:"10px"},cover:u,onClick:()=>d?{}:window.open(c,"_blank"),children:t.jsx(Cf.Meta,{title:r,description:`Size: ${a} bytes`})})},c)};return t.jsx(ase,{gutter:16,children:e.map(s)})},ase=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
`,cse=l.div`
`,{Button:lse,Modal:dse,Typography:use,Empty:pse}=Ne,{Text:mse,Title:QCe,Paragraph:YCe}=use,hse=({data:e,onClose:n})=>{const{fileList:s,isOpen:o}=e,r=W(),i=()=>{r(n())};return t.jsxs(dse,{style:{top:10},title:"Archivos",open:o,onCancel:i,footer:[t.jsx(lse,{onClick:i,children:"Cerrar"},"back")],children:[s.length>0&&t.jsx(ise,{files:s}),s.length===0&&t.jsx(pse,{description:t.jsx(mse,{type:"secondary",children:"No hay archivos adjuntos"})})]})},{Typography:gse}=Ne,fse=m.forwardRef(({product:e},n)=>{var i,a,c,d;const s=`${Y((i=e==null?void 0:e.pricing)==null?void 0:i.price)} / ${(a=e==null?void 0:e.weightDetail)==null?void 0:a.weightUnit}`,o=Y((c=e==null?void 0:e.pricing)==null?void 0:c.price),r=(d=e==null?void 0:e.weightDetail)!=null&&d.isSoldByWeight?s:o;return t.jsxs(xse,{children:[" ",t.jsxs(bse,{ref:n,children:[t.jsxs(yse,{children:[e==null?void 0:e.name,"  (",r||"",")"]}),t.jsx(g0,{marginTop:3,width:1.6,height:50,value:(e==null?void 0:e.barcode)||"-"})]})]})}),xse=l.div`
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-top: 20px;
`,bse=l.div`
   
    width: min-content;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 0.8em;
    justify-content: center;
 
`,yse=l(gse.Text)`
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 0;
    white-space: nowrap;
`,{Modal:vse,Input:wf,Button:Sf,Form:fr,Spin:jse}=Ne,Cse=()=>{const{isOpen:e,product:n}=D(KR),[s,o]=m.useState(!1),[r]=fr.useForm(),i=W(),a=m.useRef(),c=async()=>{try{if(o(!0),a.current){const u=r.getFieldsValue(),p=u.barcodeWidth,h=parseInt(u.quantity,10),f=await SS(a.current),x=f.toDataURL("image/png"),g=f.width,y=f.height,v=p/25.4*96/g,C=y*v,I=p,j=C/96*25.4,k=new wu({orientation:I>j?"l":"p",unit:"mm",format:[I,j]});for(let S=0;S<h;S++)S>0&&k.addPage([I,j],I>j?"l":"p"),k.addImage(x,"PNG",0,0,I,j);const A=k.output("blob"),P=URL.createObjectURL(A),w=window.open(P,"_blank");w.addEventListener("load",function(){w.focus(),w.print(),URL.revokeObjectURL(P)},{once:!0})}}catch(u){console.error("Error al generar la vista previa de impresión: ",u)}finally{o(!1),r.setFieldValue("quantity",1),r.setFieldValue("barcodeWidth",100)}i(Gd())},d=()=>{i(Gd())};return t.jsx(t.Fragment,{children:t.jsx(vse,{style:{top:20},title:"Generar e Imprimir Código de Barras",open:e,onCancel:d,footer:[t.jsx(Sf,{onClick:d,children:"Cancelar"},"back"),t.jsx(Sf,{type:"primary",onClick:c,children:"Imprimir Código de Barras"},"submit")],children:t.jsx(jse,{spinning:s,size:"large",children:t.jsxs(fr,{layout:"vertical",initialValues:{product:n,barcodeWidth:100,quantity:1},form:r,children:[t.jsx(fr.Item,{label:"Producto",name:"product",rules:[{required:!0,message:"Por favor seleccione un producto"}],children:t.jsx(fse,{ref:a,product:n})}),t.jsx(fr.Item,{label:"Ancho del código de barras",name:"barcodeWidth",rules:[{required:!0,message:"Por favor ingrese el ancho del código de barras"}],children:t.jsx(wf,{addonAfter:"milímetros"})}),t.jsx(fr.Item,{label:"Cantidad",name:"quantity",rules:[{required:!0,message:"Por favor ingrese el ancho del código de barras"}],children:t.jsx(wf,{})})]})})})})};async function wse(e){const n=le($,"users"),s=he(n,te("user.name","==",e));return!(await Me(s)).empty}function Sse({id:e,name:n,password:s,businessID:o,role:r}){if(!n)throw new Error("Error: Es obligatorio proporcionar un nombre de usuario.");if(!s)throw new Error("Error: Es obligatorio proporcionar una contraseña.");if(!o)throw new Error("Error: Es obligatorio proporcionar un ID de negocio.");if(!r)throw new Error("Error: Es obligatorio seleccionar un rol.")}const Ise=async e=>{if(Sse(e),e.id=be(10),await wse(e.name))throw new Error("Error: Ya existe un usuario con este nombre.");const s=await Wo.hash(e.password,10),o=F($,"users",e.id);await De(o,{user:{...e,name:e.name.toLowerCase(),password:s,active:!0,createAt:ue.now(),loginAttempts:0,lockUntil:null}})},pn=[{id:"admin",label:"Admin",primaryColor:"#9750DD",secondaryColor:"#f5ebff"},{id:"manager",label:"Gerente",primaryColor:"#F31260",secondaryColor:"#ffe3ec"},{id:"cashier",label:"Cajero",primaryColor:"#F5A524",secondaryColor:"#fff8ec"},{id:"buyer",label:"Comprador",primaryColor:"#17C964",secondaryColor:"#e3ffef"},{id:"dev",label:"Desarrollador",primaryColor:"#f312bb",secondaryColor:"#ffebfd"}],Ese=e=>{const n=pn.find(s=>s.id===e);return n?n.label:"Rol no definido"},Gl=e=>{if(!e||!e.role)return[];const n=e.role;switch(n){case"dev":return pn.filter(s=>s.id!=="dev");case"admin":return pn.filter(s=>s.id!=="admin"&&s.id!=="dev");case"manager":return pn.filter(s=>["cashier","buyer"].includes(s.id));case"cashier":return pn.filter(s=>s.id===n);case"buyer":return pn.filter(s=>s.id===n);default:return[]}},Ase=e=>{if(!e||!e.role)return[];const n=e.role;let s=[];switch(n){case"dev":s=pn.filter(o=>!0);break;case"admin":s=pn.filter(o=>o.id!=="dev");break;case"manager":s=pn.filter(o=>["cashier","buyer"].includes(o.id));break;default:s=[];break}return s.map(o=>({value:o.id,label:o.label}))},{Title:If,Text:Ef}=Xe,{Option:kse}=ge,Tse=({userId:e,userName:n,userRole:s,isOpen:o,onClose:r})=>{const[i,a]=m.useState({additionalPermissions:[],restrictedPermissions:[]}),[c,d]=m.useState(null),[u,p]=m.useState(!1),[h,f]=m.useState(!1),x=D(q),{abilities:g}=rs(),y=g.can("manage","users");m.useEffect(()=>{o&&e&&b()},[o,e]);const b=async()=>{p(!0);try{const A=await ub(e,x);a(A)}catch(A){console.error("Error loading user permissions:",A)}p(!1)},v=A=>{const P=c;P&&(a(w=>({...w,additionalPermissions:[...w.additionalPermissions,P]})),d(null))},C=(A,P)=>{a(w=>({...w,additionalPermissions:w.additionalPermissions.filter((S,E)=>E!==P)}))},I=async()=>{f(!0);try{await fP(x,e,i),r()}catch(A){console.error("Error saving permissions:",A),alert("Error guardando permisos: "+A.message)}f(!1)},j=A=>Jc(s).filter(w=>!A.some(S=>S.action===w.action&&S.subject===w.subject)).map(w=>({id:`${w.action}-${w.subject}`,label:`${w.label||`${w.action} ${w.subject}`} (${w.category})`,value:w}));if(!y)return null;const k=xP(s);return t.jsx(Ce,{title:t.jsxs("div",{children:[t.jsx(If,{level:4,style:{margin:0},children:"Gestionar Permisos Dinámicos"}),t.jsxs(Ef,{type:"secondary",children:["Usuario: ",t.jsx("strong",{children:n})," | Rol: ",t.jsx("strong",{children:s})," |",k.totalAvailable," permisos disponibles"]})]}),open:o,onCancel:r,width:800,footer:[t.jsx(U,{onClick:r,disabled:h,children:"Cancelar"},"cancel"),t.jsx(U,{type:"primary",loading:h,onClick:I,disabled:u,children:"Guardar"},"save")],children:u?t.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[t.jsx(He,{size:"large"}),t.jsx("div",{style:{marginTop:"1rem"},children:"Cargando permisos..."})]}):t.jsx("div",{children:t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsx(If,{level:5,children:"Permisos Adicionales"}),t.jsx(Ef,{type:"secondary",style:{display:"block",marginBottom:"1rem"},children:"Permisos extra que se agregan al rol base del usuario"}),t.jsxs(Ye.Compact,{style:{width:"100%",marginBottom:"1rem"},children:[t.jsx(ge,{placeholder:"Seleccionar permiso para agregar",style:{flex:1},value:c?`${c.action}-${c.subject}`:void 0,onChange:A=>{const w=Jc(s).find(S=>`${S.action}-${S.subject}`===A);d(w)},showSearch:!0,filterOption:(A,P)=>P.children.toLowerCase().indexOf(A.toLowerCase())>=0,children:j(i.additionalPermissions).map(A=>t.jsx(kse,{value:A.id,children:A.label},A.id))}),t.jsx(U,{type:"primary",icon:t.jsx(Jn,{}),onClick:()=>v(),disabled:!c,children:"Agregar"})]}),t.jsx(Sn,{size:"small",bordered:!0,dataSource:i.additionalPermissions,locale:{emptyText:"No hay permisos adicionales"},renderItem:(A,P)=>{var w;return t.jsxs(Sn.Item,{actions:[t.jsx(U,{type:"text",danger:!0,size:"small",icon:t.jsx(ht,{}),onClick:()=>C("additional",P),children:"Eliminar"},"delete")],children:["                                    ",t.jsxs(Ge,{color:"green",children:[A.action," - ",A.subject]}),t.jsx("span",{style:{marginLeft:"8px"},children:((w=Jc(s).find(S=>S.action===A.action&&S.subject===A.subject))==null?void 0:w.label)||"Permiso personalizado"})]})}})]})})})},Pse=({isOpen:e,currentRole:n,newRole:s,userName:o,onConfirm:r,onCancel:i})=>t.jsxs(Dse,{open:e,onCancel:i,footer:null,width:500,centered:!0,closable:!1,children:["      ",t.jsxs($se,{children:[t.jsx(Rse,{children:t.jsx(O,{icon:fu})}),t.jsxs(Nse,{children:[t.jsx(Ose,{children:"Cambiar Rol de Usuario"}),t.jsxs(Mse,{children:["Se reducirán los privilegios de ",t.jsx("strong",{children:o})]}),t.jsxs(Fse,{children:[t.jsxs(Af,{children:[t.jsx(kf,{children:"Actual"}),t.jsx(Tf,{children:n})]}),t.jsx(Bse,{children:t.jsx(O,{icon:ww})}),t.jsxs(Af,{children:[t.jsx(kf,{children:"Nuevo"}),t.jsx(Tf,{children:s})]})]}),t.jsx(Lse,{children:"Esta acción no se puede deshacer automáticamente"})]}),t.jsxs(zse,{children:[t.jsx(Use,{onClick:i,children:"Cancelar"}),t.jsx(Wse,{onClick:r,children:"Confirmar"})]})]})]}),Dse=l(Ce)`
  .ant-modal-content {
    border-radius: 20px;
    overflow: hidden;
    padding: 0;
    box-shadow: 0 24px 48px rgba(0, 0, 0, 0.15);
    animation: modalSlideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-12px) scale(0.96);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
`,$se=l.div`
  background: #ffffff;
  text-align: center;
`,Rse=l.div`
  padding: 32px 24px 24px 24px;
  font-size: 48px;
  color: #ff9500;
`,Nse=l.div`
  padding: 0 24px 24px 24px;
`,Ose=l.h3`
  margin: 0 0 8px 0;
  font-size: 17px;
  font-weight: 600;
  color: #1d1d1f;
  letter-spacing: -0.022em;
`,Mse=l.p`
  margin: 0 0 24px 0;
  font-size: 13px;
  color: #86868b;
  line-height: 1.38;
  
  strong {
    color: #1d1d1f;
    font-weight: 600;
  }
`,Fse=l.div`
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  margin: 24px 0;
  padding: 16px;
  background: #f5f5f7;
  border-radius: 12px;
`,Af=l.div`
  text-align: center;
`,kf=l.div`
  font-size: 11px;
  color: #86868b;
  text-transform: uppercase;
  letter-spacing: 0.6px;
  margin-bottom: 4px;
  font-weight: 500;
`,Tf=l.div`
  font-size: 15px;
  color: #1d1d1f;
  font-weight: 600;
  text-transform: capitalize;
`,Bse=l.div`
  color: #86868b;
  font-size: 16px;
`,Lse=l.div`
  margin: 24px 0;
  padding: 12px 16px;
  background: #fff9f4;
  border-radius: 8px;
  font-size: 13px;
  color: #bf4800;
  border: 1px solid #ffe5cc;
`,zse=l.div`
  display: flex;
  border-top: 0.5px solid #d2d2d7;
`,Uj=l.button`
  flex: 1;
  padding: 17px 16px;
  border: none;
  background: transparent;
  font-size: 17px;
  cursor: pointer;
  transition: background-color 0.15s ease;
  
  &:not(:last-child) {
    border-right: 0.5px solid #d2d2d7;
  }
  
  &:hover {
    background: rgba(0, 0, 0, 0.04);
  }
  
  &:active {
    background: rgba(0, 0, 0, 0.08);
  }
`,Use=l(Uj)`
  color: #007aff;
  font-weight: 400;
`,Wse=l(Uj)`
  color: #ff3b30;
  font-weight: 600;
`;async function qse(e,n=null){const s=le($,"users"),o=he(s,te("user.name","==",e)),r=await Me(o);return r.empty?!1:n?r.docs.some(a=>a.id!==n):!0}const Vse=async e=>{if(e={...e,updatedAt:ue.now()},await qse(e==null?void 0:e.name,e==null?void 0:e.id))throw new Error("Error: Ya existe un usuario con este nombre.");const s=F($,"users",e==null?void 0:e.id);await je(s,{user:e})};async function Gse(e){return await Wo.hash(e,10)}const _se=async(e,n,s)=>{const o=F($,"users",e),a=(await Se(o)).data().user.password;if(!await Wo.compare(n,a))throw new Error("La contraseña antigua no es correcta");const d=await Gse(s);try{await je(o,{"user.password":d})}catch{}},Hse=({user:e=null,isOpen:n=!1,setIsOpen:s,onClose:o})=>{const[r]=M.useForm(),i=async c=>{try{await _se(e.id,c.oldPassword,c.newPassword),o(),Be.success({message:"Contraseña actualizada",description:"La contraseña se actualizó correctamente"})}catch(d){console.error(d),Be.error({message:"Error",description:"Hubo un problema al actualizar la contraseña."})}},a=()=>{s(!1)};return m.useEffect(()=>{n&&r.resetFields()},[n,r]),t.jsx(Ce,{open:n,onCancel:a,footer:[t.jsx(U,{onClick:a,children:"Cancelar"}),t.jsx(U,{type:"primary",onClick:()=>r.submit(),children:"Guardar"},"submit")],children:t.jsxs(Kse,{children:[t.jsxs(Qse,{children:[t.jsx("div",{children:t.jsxs("h3",{children:["Cambiar contraseña de ",e==null?void 0:e.name]})}),t.jsx("div",{children:t.jsx("p",{children:"Para cambiar la contraseña, ingrese la contraseña antigua y la nueva contraseña."})})]}),t.jsx(Yse,{children:t.jsxs(M,{form:r,layout:"vertical",onFinish:i,children:[t.jsx(M.Item,{name:"oldPassword",label:"Contraseña antigua",rules:[{required:!0,message:"Por favor ingrese su contraseña antigua"}],children:t.jsx(ie.Password,{})}),t.jsx(M.Item,{name:"newPassword",label:"Nueva contraseña",rules:[{required:!0,message:"Por favor ingrese su nueva contraseña"}],children:t.jsx(ie.Password,{})})]})})]})})},Qse=l.div`
    display: grid;
    gap: 0.8em;
`,Yse=l.div`
    display: grid;
    align-content: start;
    gap: 1em;
`,Kse=l.div`  
    width: 100%;
    background-color: white;
    grid-template-rows: min-content  1fr min-content;
    display: grid;
    align-content: start;
    gap: 1.4em;
`;l.div`
    display: flex;
    justify-content: flex-end;
    padding: 0 1em;
`;const Jse=()=>{const[e]=M.useForm(),n=D(q),[s,o]=m.useState(!1),[r,i]=m.useState(!1),[a,c]=m.useState(!1),[d,u]=m.useState(null),[p,h]=m.useState(!1),f=D(LP),{isOpen:x,data:g}=f,[y,b]=m.useState(null),v=W(),{abilities:C}=rs(),I=C.can("manage","User"),j=C.can("create","User")||I,k=C.can("update","User")||I,A=C.can("manage","users"),P=Ase(n),w=()=>{o(!s)},S=()=>{i(!r)},E=async Q=>{if(g&&!k){V.error("No tienes permisos para actualizar usuarios");return}if(!g&&!j){V.error("No tienes permisos para crear usuarios");return}if(g&&g.role&&Q.role&&Xse(g.role,Q.role)){u(Q),c(!0);return}await T(Q)},T=async Q=>{h(!0);const ae={...g,...Q,businessID:f.businessID||n.businessID};try{g?(await Vse(ae),V.success("Usuario actualizado exitosamente"),e.resetFields()):(await Ise(ae),V.success("Usuario creado exitosamente"),e.resetFields()),G()}catch(oe){console.error(oe),b(oe.message),V.error(oe.message)}finally{setTimeout(()=>{h(!1)},1e3)}},R=async()=>{c(!1),d&&(await T(d),u(null))},N=()=>{c(!1),u(null)};m.useEffect(()=>{e.resetFields(),b(null)},[x]),m.useEffect(()=>{g&&(e.setFieldsValue(g),b(null))},[g]);const G=()=>{v(ri({isOpen:!1}))};return!I&&!j&&!k?null:t.jsxs(m.Fragment,{children:[t.jsx(Ce,{onCancel:G,style:{top:20},open:x,footer:[t.jsx(U,{onClick:G,children:"Cancelar"},"back"),t.jsx(U,{type:"primary",disabled:g?!k:!j,onClick:()=>e.submit(),children:g?"Actualizar Usuario":"Crear Usuario"},"submit")],children:t.jsx(He,{spinning:p,tip:g?"Actualizando Usuario...":"Creando Usuario...",children:t.jsxs(M,{form:e,layout:"vertical",onFinish:E,style:{display:"grid",gap:"1em"},children:[t.jsxs(Xe.Title,{level:3,children:[" ",g?"Actualizar":"Crear Usuario"]}),t.jsx(M.Item,{label:"Nombre o Alias",name:"realName",help:"Nombre real o alias del usuario. Este campo es opcional.",children:t.jsx(ie,{})}),t.jsx(M.Item,{label:"Nombre de Usuario",name:"name",rules:[{required:!0,message:"Por favor, ingresa tu nombre de usuario!"},{min:3,message:"El nombre de usuario debe tener al menos 3 caracteres!"},{max:30,message:"El nombre de usuario debe tener como máximo 30 caracteres!"}],help:"Elige un identificador único para acceder al sistema.",children:t.jsx(ie,{})}),"                        ",t.jsx(M.Item,{label:"Rol",name:"role",rules:[{required:!0,message:"Por favor, selecciona un rol!"}],help:P.length===0?"No tienes permisos para asignar roles a otros usuarios.":"Selecciona el rol que tendrá el usuario en el sistema.",children:t.jsx(ge,{placeholder:P.length===0?"Sin roles disponibles":"Selecciona un rol",options:P,disabled:P.length===0})}),!g&&t.jsx(M.Item,{label:"Contraseña",name:"password",rules:[{required:!0,message:"Por favor, ingresa tu contraseña!"},{pattern:/(?=.*[A-Z])/,message:"La contraseña debe tener al menos una letra mayúscula."},{pattern:/(?=.*[a-z])/,message:"La contraseña debe tener al menos  una letra minúscula."},{pattern:/(?=.*[0-9])/,message:"La contraseña debe tener al menos un número"}],children:t.jsx(ie.Password,{autoComplete:"new-password"})}),g&&t.jsxs("div",{children:[t.jsx(M.Item,{label:"Estado del Usuario",name:"active",valuePropName:"checked",children:t.jsx(Jx,{checkedChildren:"Activo",unCheckedChildren:"Inactivo",onChange:Q=>e.setFieldsValue({active:Q})})}),"                                    ",t.jsx(U,{onClick:w,children:"Cambiar Contraseña"}),A&&t.jsx(U,{type:"default",style:{marginLeft:"8px"},onClick:S,children:"Gestionar Permisos"})]}),y&&t.jsx(Pt,{message:y||null,type:"error",showIcon:!0}),t.jsx("br",{})]})})}),t.jsx(Hse,{isOpen:s,setIsOpen:o,user:g,onClose:w}),A&&g&&t.jsx(Tse,{userId:g.id,userName:g.name,userRole:g.role,isOpen:r,onClose:S}),t.jsx(Pse,{isOpen:a,currentRole:g==null?void 0:g.role,newRole:d==null?void 0:d.role,userName:(g==null?void 0:g.name)||(g==null?void 0:g.realName),onConfirm:R,onCancel:N})]})},Pf={dev:6,owner:5,admin:4,manager:3,buyer:2,cashier:1},Xse=(e,n)=>{const s=Pf[e]||0,o=Pf[n]||0;return s>o},{Table:Zse}=Ne,eoe=({products:e})=>t.jsxs("div",{className:"mt-4",children:[t.jsx(toe,{children:"Productos"}),t.jsx(noe,{products:e})]});l.div``;const toe=l.h2`
  font-weight: 600;
  margin: 0 0 1em;
  font-size: 1.2rem;
`,noe=({products:e})=>{const n=[{title:"Descripción",dataIndex:"name",key:"name",render:o=>o??"Producto Desconocido"},{title:"Cantidad",dataIndex:"amountToBuy",key:"amountToBuy",render:o=>o??"N/A"},{title:"Precio Unitario",dataIndex:["pricing","price"],key:"unitPrice",render:o=>Y(o)??"N/A"},{title:"Total",dataIndex:["pricing","price"],key:"total",render:(o,r)=>Y(r.pricing.price*r.amountToBuy)??"N/A"}],s=e.map((o,r)=>({key:r,...o}));return t.jsx(Zse,{size:"small",columns:n,dataSource:s})},soe=l.div`
  margin-top: 1rem;
  background-color: white;
  box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
  border-radius: 0.5rem;
  overflow: hidden;
  height: auto;
`,ooe=l.div`
  padding: 0.4rem 1em ;
`,roe=l.h2`
  font-weight: 600;
  margin: 0;
  font-size: 1.2rem;
`,ioe=l.div`
  padding: 1rem;
`,aoe=l.p`
  margin-bottom: 0.4rem;
  color: #4b5563;
  font-size: 1em;
`,coe=l.span`
  font-weight: 600;
  font-size: 0.9em;
  color: #4b5563;
`,jp=({title:e,elements:n})=>t.jsxs(soe,{children:[t.jsx(ooe,{children:t.jsx(roe,{children:e})}),t.jsx(ioe,{children:n.map((s,o)=>t.jsxs(aoe,{children:[t.jsxs(coe,{children:[s.label,":"]})," ",s.value??"N/A"]},o))})]}),loe=({client:e})=>{const n=Dn(e.tel)??"N/A",s=[{label:"Nombre",value:e.name??"N/A"},{label:"Teléfono",value:n},{label:"Dirección",value:e.address??"N/A"}];return t.jsx(jp,{title:"Cliente",elements:s})},doe=({summaryData:e})=>{const{sourceOfPurchase:n,totalShoppingItems:s,totalPurchaseWithoutTaxes:o,totalTaxes:r,payment:i}=e,a=[{label:"Método de Compra",value:n??"N/A"},{label:"Total de Artículos",value:s.value??"N/A"},{label:"Subtotal",value:Y(o.value)??"N/A"},{label:"Impuestos",value:Y(r.value)??"N/A"},{label:"Total Pagado",value:Y(i.value)??"N/A"}];return t.jsx(jp,{title:"Resumen",elements:a})},uoe={cash:"Efectivo",card:"Tarjeta",transfer:"Transferencia"},poe=({paymentMethod:e})=>{const n=e.map((s,o)=>({label:uoe[s.method],value:s.status?"Sí":"No"}));return t.jsx(jp,{title:"Método de Pago",elements:n})},{Modal:moe}=Ne,hoe=()=>{const e=W(),n=D(sN),s=n==null?void 0:n.isOpen,{client:o={},products:r=[],paymentMethod:i=[],totalPurchase:a={},date:c={},sourceOfPurchase:d="",user:u={},totalShoppingItems:p={},totalTaxes:h={},payment:f={},totalPurchaseWithoutTaxes:x={}}=(n==null?void 0:n.data)||{},g=()=>{e(nN())};return s&&t.jsxs(moe,{open:s,onCancel:g,footer:null,style:{top:10},width:800,children:[t.jsx("div",{className:"flex justify-between items-center",children:t.jsx(foe,{children:"Detalles de la Factura"})}),t.jsx(eoe,{products:r}),t.jsxs(goe,{children:[t.jsx(loe,{client:o}),t.jsx(poe,{paymentMethod:i}),t.jsx(doe,{summaryData:{sourceOfPurchase:d,totalShoppingItems:p,totalPurchaseWithoutTaxes:x,totalTaxes:h,payment:f}})]})]})},goe=l.div`
  display: grid;
  align-items: stretch;
  
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1rem;
`,foe=l.h2`
  font-size: 1.3rem;
  font-weight: 700;
  margin-bottom: 1rem;
`,xoe={cash:"Efectivo",card:"Tarjetas",transfer:"Transferencia"},{Form:Df,Input:$f,Checkbox:boe}=Ne,yoe=()=>{const{methodErrors:e,paymentDetails:n}=D(Vy),s=n.paymentMethods||[],o=W(),r=(d,u,p)=>{o(fN({method:d,key:u,error:p}))},i=d=>{o(xN({method:d}))},a=(d,u,p,h)=>{let f=null;if(h){u==="value"&&p<=0?f="El valor debe ser mayor a cero":u==="reference"&&d!=="cash"&&(!p||p.trim()==="")&&(f="La referencia es obligatoria");const x=s.find(g=>g.method===d);d!=="cash"&&h&&x.value>0&&(!x.reference||x.reference.trim()==="")?r(d,"reference","La referencia es obligatoria"):i(d)}return r(d,u,f),f},c=(d,u,p)=>{var x;o(Ci({method:d,key:u,value:p}));const f=(x=s.map(g=>g.method===d?{...g,[u]:p}:g).find(g=>g.method===d))==null?void 0:x.status;f?a(d,u,p,f):(i(d),d==="cash"?o(Ci({method:d,key:"value",value:0})):d!=="cash"&&(o(Ci({method:d,key:"reference",value:null})),o(Ci({method:d,key:"value",value:0}))))};return t.jsx("div",{children:s.map(d=>t.jsxs(voe,{children:[t.jsx(Df.Item,{name:d.method,validateStatus:e[`${d.method}_value`]?"error":"",help:e[`${d.method}_value`],label:t.jsx(boe,{checked:d.status,onChange:u=>c(d.method,"status",u.target.checked),children:xoe[d.method]}),children:t.jsx($f,{type:"number",placeholder:"$$$",value:d.value,disabled:!d.status,onChange:u=>c(d.method,"value",parseFloat(u.target.value||0))})}),d.method!=="cash"&&t.jsx(Df.Item,{name:`${d.method}Reference`,label:"Referencia",validateStatus:e[`${d.method}_reference`]?"error":"",help:e[`${d.method}_reference`],children:t.jsx($f,{placeholder:"Referencia",value:d.reference,disabled:!d.status,onChange:u=>c(d.method,"reference",u.target.value)})})]},d.method))})},voe=l.div`
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.4em;
`,xr=1e-10,br=e=>Math.round(e*100)/100,joe=async(e,n)=>{const s=le($,"businesses",e.businessID,"accountsReceivableInstallments"),o=he(s,te("arId","==",n),it("installmentDate","asc"));return(await Me(o)).docs.map(i=>({id:i.id,...i.data()}))},Coe=async({user:e,paymentDetails:n})=>{const{totalPaid:s,clientId:o,arId:r,paymentMethods:i,comments:a}=n;try{const c=await joe(e,r),d=F($,"businesses",e.businessID,"accountsReceivable",r),u=await Se(d);if(!u.exists())throw new Error("Account not found");const p=u.data(),h=await io(e.businessID,p.invoiceId);return await Fo($,async f=>{let x=s;const g=be(),y=F($,"businesses",e.businessID,"accountsReceivablePayments",g),b={...Qo,id:g,paymentMethods:i,totalPaid:s,createdAt:ue.now(),updatedAt:ue.now(),comments:a,createdUserId:e==null?void 0:e.uid,updatedUserId:e==null?void 0:e.uid,isActive:!0};f.set(y,b);const v=new Set,C=[],I=[];for(const P of c){if(x<=xr)break;const w=Math.min(x,P.installmentBalance),S=br(P.installmentBalance-w);C.push({ref:F($,"businesses",e.businessID,"accountsReceivableInstallments",P.id),data:{installmentBalance:S,isActive:S>xr}}),I.push({ref:F(le($,"businesses",e.businessID,"accountsReceivableInstallmentPayments")),data:{...Fc,id:be(),installmentId:P.id,paymentId:g,createdAt:ue.now(),updatedAt:ue.now(),paymentAmount:br(w),createdBy:e.uid,updatedBy:e.uid,isActive:!0,clientId:o,arId:r}}),S<=xr&&v.add(P.id),x=br(x-w)}let j=br(p.arBalance-s);j<0?(x=-j,j=0):x=0;const k=[...p.paidInstallments||[],...Array.from(v)];return f.update(d,{arBalance:j,lastPaymentDate:ue.now(),lastPayment:s,isActive:j>xr,isClosed:j<=xr,paidInstallments:k}),C.forEach(P=>f.update(P.ref,P.data)),I.forEach(P=>f.set(P.ref,P.data)),{accounts:[{arNumber:p.numberId,invoiceNumber:h.data.numberID,invoiceId:h.data.id,arId:p.id,paidInstallments:Array.from(v).map(P=>({number:c.find(w=>w.id===P).installmentNumber,id:P,amount:br(c.find(w=>w.id===P).installmentBalance),status:"paid"})),remainingInstallments:p.totalInstallments-k.length,totalInstallments:p.totalInstallments,totalPaid:s,arBalance:j}],totalAmount:s,paymentMethod:i,change:x}})}catch(c){throw console.error("Error processing partial payment for account:",c),c}},qr=1e-10,bs=e=>Math.round(e*100)/100,woe=async(e,n)=>{const s=le($,"businesses",e.businessID,"accountsReceivable"),o=he(s,te("clientId","==",n),it("createdAt","asc"));return(await Me(o)).docs.map(i=>({id:i.id,...i.data()}))},Soe=async(e,n)=>{const s=le($,"businesses",e.businessID,"accountsReceivableInstallments"),o=he(s,te("arId","==",n),te("isActive","==",!0),it("installmentDate","asc"));return(await Me(o)).docs.map(i=>i.data())},Ioe=async(e,n)=>{const{totalPaid:s,paymentMethods:o,comments:r}=n,i=be(),a=F($,"businesses",e.businessID,"accountsReceivablePayments",i),c={...Qo,paymentId:i,paymentMethods:o,totalPaid:s,createdAt:ue.now(),updatedAt:ue.now(),comments:r,createdUserId:e==null?void 0:e.uid,updatedUserId:e==null?void 0:e.uid,isActive:!0};return await De(a,c),i},Eoe=async(e,n,s,o,r,i,a)=>{const c=Math.min(o,s.installmentBalance),d=bs(s.installmentBalance-c),u=bs(a.arBalance-c),p=F($,"businesses",n.businessID,"accountsReceivableInstallments",s.id);if(!(await Se(p)).exists())return console.error(`Installment document ${s.id} does not exist.`),null;const f=F(le($,"businesses",n.businessID,"accountsReceivableInstallmentPayments"));return e.update(p,{installmentBalance:d,isActive:d>qr}),e.set(f,{...Fc,installmentPaymentId:be(),installmentId:s.id,paymentId:r,createdAt:ue.now(),updatedAt:ue.now(),paymentAmount:bs(c),createdBy:n.uid,updatedBy:n.uid,isActive:!0,clientId:i,arId:a.id}),{amountToApply:c,newAccountBalance:u,newInstallmentBalance:d}},Aoe=async(e,n,s)=>{const o=F($,"businesses",n.businessID,"accountsReceivable",s.id);if(!(await Se(o)).exists())return console.error(`Account document ${s.id} does not exist.`),null;e.update(o,{arBalance:s.arBalance,lastPaymentDate:ue.now(),isActive:s.arBalance>qr,isClosed:s.arBalance<=qr})},koe=async({user:e,paymentDetails:n})=>{var a,c;const{clientId:s,paymentMethods:o}=n,r=parseFloat(n.totalPaid);if(isNaN(r))throw new Error("Invalid totalPaid amount");let i=r;if(!e||!s||r<=0||!o)throw new Error("Invalid input parameters");try{const d=await woe(e,s),u=await Ioe(e,n),p=dt($),h={accounts:[],totalAmount:r,paymentMethod:o,change:0};for(let f of d){if(i<=0)break;console.log(`Processing account ${f.id} - remainingAmount: ${i}`);const x=await Soe(e,f.id);console.log(`Account ${f.id} has ${x.length} installments, accountInstallments: `,x);let g=0;const y=[];for(let v of x){if(console.log(`Processing installment ${v.id} - remainingAmount: ${i}`),i<=0)break;const C=await Eoe(p,e,v,i,u,s,f);if(!C){console.error(`Error processing installment ${v.id}`);continue}const{amountToApply:I,newAccountBalance:j,newInstallmentBalance:k}=C;console.log(` ---- > remainingAmount: ${isNaN(i)?"NaN":i} - amountToApply: ${I} - newAccountBalance: ${j} - newInstallmentBalance: ${k}`),i=bs(i-I),g=bs(g+I),f.arBalance=j,y.push({number:v.installmentNumber,id:v.id,amount:bs(I),status:k<=qr?"paid":"partial",remainingBalance:k})}await Aoe(p,e,f);const b=await io(e.businessID,f.invoiceId);if(b){const v=F($,"businesses",e.businessID,"invoices",f.invoiceId),C=b.data;console.log("invoice data: ",C),C.totalPaid=bs((C.totalPaid||0)+g),C.balanceDue=bs(C.totalAmount-C.totalPaid),C.status=C.balanceDue<=qr,p.update(v,C)}h.accounts.push({arNumber:f.numberId,arId:f.id,invoiceNumber:(a=b==null?void 0:b.data)==null?void 0:a.numberID,invoiceId:(c=b==null?void 0:b.data)==null?void 0:c.id,paidInstallments:y,remainingInstallments:(f==null?void 0:f.totalInstallments)-y.length,totalInstallments:f==null?void 0:f.totalInstallments,totalPaid:g,arBalance:f==null?void 0:f.arBalance})}return await p.commit(),h.change=i>0?i:0,dp({user:e,clientId:s,paymentReceipt:h})}catch(d){throw console.error("Error processing payment:",d),d}},yr=1e-10,vr=e=>Math.round(e*100)/100,Toe=async(e,n)=>{const s=le($,"businesses",e.businessID,"accountsReceivableInstallments"),o=he(s,te("arId","==",n),it("installmentDate","asc"));return(await Me(o)).docs.map(i=>({id:i.id,...i.data()}))},Poe=async({user:e,paymentDetails:n})=>{const{totalPaid:s,arId:o,clientId:r,paymentMethods:i,comments:a}=n;try{const c=await Toe(e,o),d=F($,"businesses",e.businessID,"accountsReceivable",o),u=await Se(d);if(!u.exists())throw new Error("Account not found");const p=u.data();return await Fo($,async h=>{var S,E;let f=s;const x=be(),g=F($,"businesses",e.businessID,"accountsReceivablePayments",x),y={...Qo,id:x,paymentMethods:i,totalPaid:s,createdAt:ue.now(),updatedAt:ue.now(),comments:a,clientId:r,createdUserId:e==null?void 0:e.uid,updatedUserId:e==null?void 0:e.uid,isActive:!0};h.set(g,y);const b=[],v=[],C=[];let I=0;for(let T of c){if(I+=T.installmentBalance,f<=yr)break;const R=Math.min(f,T.installmentBalance),N=vr(T.installmentBalance-R);v.push({ref:F($,"businesses",e.businessID,"accountsReceivableInstallments",T.id),data:{installmentBalance:N,isActive:N>yr}}),C.push({ref:F(le($,"businesses",e.businessID,"accountsReceivableInstallmentPayments")),data:{...Fc,installmentPaymentId:be(),installmentId:T.id,paymentId:x,createdAt:ue.now(),updatedAt:ue.now(),paymentAmount:vr(R),createdBy:e.uid,updatedBy:e.uid,isActive:!0,clientId:r,arId:o}}),N<=yr&&b.push(T.id),f=vr(f-R)}let j=vr(I-s);j<0?(f=-j,j=0):f=0;const k=[...p.paidInstallments||[],...b];h.update(d,{arBalance:j,lastPaymentDate:ue.now(),lastPayment:s,isActive:j>yr,isClosed:j<=yr,paidInstallments:k}),v.forEach(T=>h.update(T.ref,T.data)),C.forEach(T=>h.set(T.ref,T.data));const A=await io(e.businessID,p.invoiceId),P={receiptId:be(),paymentId:x,clientId:r,arId:o,businessId:e.businessID,createdAt:ue.now(),createdBy:e.uid,accounts:[{arNumber:p.numberId,arId:p.id,invoiceNumber:(S=A==null?void 0:A.data)==null?void 0:S.numberID,invoiceId:(E=A==null?void 0:A.data)==null?void 0:E.id,paidInstallments:b.map(T=>({number:c.find(R=>R.id===T).installmentNumber,id:T,amount:vr(c.find(R=>R.id===T).installmentBalance),status:"paid"})),remainingInstallments:p.totalInstallments-k.length,totalInstallments:p.totalInstallments,totalPaid:s,arBalance:j}],totalAmount:s,paymentMethod:i,change:f},w=F($,"businesses",e.businessID,"paymentReceipts",P.receiptId);return h.set(w,P),P})}catch(c){throw console.error("Error processing payment for all installments:",c),c}},Doe=async(e,n)=>{const s=be(),o=Bq("businesses",e.businessID,"accountsReceivablePayments",s),r={...Qo,...n,id:s,createdAt:ue.now(),updatedAt:ue.now(),createdUserId:e==null?void 0:e.uid,updatedUserId:e==null?void 0:e.uid,isActive:!0};return await De(o,r),r},$oe=async(e,n)=>{try{const s=F($,"businesses",e.businessID,"accountsReceivable",n),o=await Se(s);return o.exists()?{id:o.id,...o.data()}:(console.log("No account found with the specified ID."),null)}catch(s){throw console.error("Error getting client account by ID:",s),s}},Roe=async(e,n)=>{try{const s=le($,"businesses",e.businessID,"accountsReceivableInstallments"),o=he(s,te("arId","==",n),te("isActive","==",!0),it("installmentDate","asc"));return(await Me(o)).docs.map(i=>({id:i.id,...i.data()}))[0]}catch(s){throw console.error("Error getting oldest active installment by AR ID:",s),s}},ms=e=>Math.round(e*100)/100,Noe=async({user:e,paymentDetails:n})=>{var s,o,r;try{const{clientId:i,totalAmount:a,arId:c,paymentMethods:d,comments:u,totalPaid:p}=n,h=ms(parseFloat(a)),f=ms(parseFloat(p));if(!h||h<=0){console.log("Invalid payment amount.");return}if(f!==h)throw new Error("Total paid and total amount are not equal.");const x=await $oe(e,c);if(!x)return;const g=await Roe(e,x.id);if(!g){console.log("No active installment found for the account.");return}const y=await Doe(e,n),b=dt($);let v=ms(Math.min(h,parseFloat(g.installmentBalance??0))),C=ms(parseFloat(g.installmentBalance??0)-v),I=ms(parseFloat(x.arBalance??0)-v);Math.abs(I)<.01&&(I=0),Math.abs(C)<.01&&(C=0);const j=F($,"businesses",e.businessID,"accountsReceivable",x.id),k=F($,"businesses",e.businessID,"accountsReceivableInstallments",g.id),A=F(le($,"businesses",e.businessID,"accountsReceivableInstallmentPayments"));if(b.update(k,{installmentBalance:C,isActive:C>0}),C<=0){const T=[...x.paidInstallments||[],g.id];b.update(j,{arBalance:I,lastPaymentDate:ue.now(),lastPayment:v,isActive:I>0,isClosed:I<=0,paidInstallments:T})}b.set(A,{...Qo,installmentPaymentId:be(),installmentId:g.id,paymentId:y.id,createdAt:ue.now(),updatedAt:ue.now(),paymentAmount:v,createdBy:e.uid,user:{id:e.uid,displayName:e.displayName},updatedBy:e.uid,isActive:!0,clientId:i,arId:x.id}),await b.commit();const P=ms(h-v);if(P>0){const T=dt($),R=F($,"businesses",e.businessID,"accountsReceivableInstallments",g.id);T.update(R,{installmentBalance:ms(C+P)}),await T.commit(),console.log(`Payment completed with adjustment. Remaining amount adjusted: ${P}`)}else console.log("Payment completed with no remaining amount.");const w=await io(e.businessID,x.invoiceId),S={accounts:[{arNumber:x.numberId,invoiceNumber:(s=w==null?void 0:w.data)==null?void 0:s.numberID,invoiceId:(o=w==null?void 0:w.data)==null?void 0:o.id,arId:x.id,paidInstallments:[{number:g.installmentNumber,id:g.id,amount:v,status:"paid"}],remainingInstallments:(x==null?void 0:x.totalInstallments)-((r=x==null?void 0:x.paidInstallments)==null?void 0:r.length),totalInstallments:x.totalInstallments,totalPaid:v,arBalance:I}],totalAmount:a,paymentMethod:d,change:ms(h-v)};return await dp({user:e,clientId:i,paymentReceipt:S})}catch(i){throw console.error("Error processing payment for oldest active installment:",i),i}},Ooe=async(e,n,s)=>{const{paymentScope:o,paymentOption:r,clientId:i,totalAmount:a,paymentMethods:c}=n,d={balance:async()=>await koe({user:e,paymentDetails:n}),account:{installment:async()=>await Noe({user:e,paymentDetails:n}),balance:async()=>await Poe({user:e,paymentDetails:n}),partial:async()=>await Coe({user:e,paymentDetails:n})}};try{let u;if(o==="balance")u=await d.balance();else if(o==="account"&&d.account[r])u=await d.account[r](i,n.arId,a);else throw new Error("Invalid payment option.");return s(u),u}catch(u){throw console.error("Error processing payment:",u),u}};function Moe(e){return e==null?void 0:e.reduce((n,s)=>n+s.value,0)}const Foe=({data:e})=>{var o;const n={cash:"Efectivo",card:"Tarjeta",transfer:"Trasferencia"},s=[...((o=e==null?void 0:e.paymentMethod)==null?void 0:o.filter(r=>(r==null?void 0:r.status)===!0).map(r=>({label:n[r==null?void 0:r.method],value2:Y(r==null?void 0:r.value),condition:!0})))||[],{subtitle:"TOTAL PAGADO",value2:Y(Moe(e==null?void 0:e.paymentMethod)),condition:!0,spacingStart:!0,spacingEnd:!0},{label:(e==null?void 0:e.change)>=0?"CAMBIO":"FALTANTE",value2:Y(e==null?void 0:e.change),condition:!0}];return t.jsx(Loe,{children:s.map((r,i)=>t.jsx(Boe,{row:r},i))})},Boe=({row:{subtitle:e,label:n,value1:s,value2:o,condition:r,textAlign:i,spacingStart:a,spacingEnd:c}})=>t.jsxs(m.Fragment,{children:[a&&t.jsx(Mo,{}),r&&t.jsxs(ws,{cols:"3",children:[e&&t.jsxs(Oo,{children:[e," : "]}),n&&t.jsxs(Mc,{children:[n," : "]}),t.jsx(Hs,{textAlign:i||"right",children:s}),e?t.jsx(Oo,{align:i||"right",children:o}):t.jsx(Hs,{textAlign:i||"right",children:o})]}),c&&t.jsx(Mo,{})]}),Loe=l.div`
padding-top: 0.6em;
`,zoe=({data:e})=>{var a;const n=D(q),s=n==null?void 0:n.businessID,o=(a=e==null?void 0:e.client)==null?void 0:a.id,[r,i]=m.useState(0);return Ho(s,o,i),t.jsxs(Uoe,{children:[t.jsx(Oo,{children:"Balance General"}),t.jsx(Oo,{children:Y(r)})]})},Uoe=l.div`
    width: min-content;
    display: grid;
    width: 100%;
   justify-items: right;
    white-space: nowrap;
`;function Woe({title:e,list:n=[],formatReceipt:s}){return t.jsxs(qoe,{children:[t.jsx(Mc,{children:e}),t.jsx("ul",{children:n.map((o,r)=>t.jsx("li",{children:s(o)},r))})]})}const qoe=l.div`

`,Voe=m.forwardRef(({data:e},n)=>{const s={paid:"Pagado"},o=r=>`Cuota #${r.number}, ${Y(r.amount)}, ${s[r.status]}`;return t.jsx(qa.HiddenPrintWrapper,{children:t.jsxs(qa.Container,{ref:n,children:[t.jsx(Dv,{data:e}),t.jsxs(Goe,{children:[t.jsx(zoe,{data:e}),t.jsx(vs,{}),t.jsx(ws,{space:!0,children:t.jsx(Oo,{align:"center",children:"RECIBO DE PAGO"})}),t.jsx(vs,{}),e==null?void 0:e.accounts.map((r,i)=>t.jsxs("div",{children:[t.jsx(Xt,{label:"NO. DOCUMENTO",value:`#${r==null?void 0:r.arNumber}`}),t.jsx(Woe,{title:"Pago Aplicado a: ",list:r==null?void 0:r.paidInstallments,formatReceipt:o}),t.jsx(Xt,{label:"FACTURA",value:`#${mt(r==null?void 0:r.invoiceNumber)}`}),t.jsx(Xt,{label:"PAGO",value:Y(r==null?void 0:r.totalPaid),justifyContent:"space-between"}),t.jsx(Xt,{label:"BALANCE DE CUENTA",value:Y(r==null?void 0:r.arBalance),justifyContent:"space-between"}),t.jsx(vs,{})]},i))]}),t.jsx(Foe,{data:e})]})})});l.div`
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
  font-family: Arial, sans-serif;
  border: 1px solid #000;
`;l.div`
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
`;l.h2`
  margin: 0;
  font-size: 1.5em;
`;const Goe=l.div`
  margin-bottom: 20px;
`;l.span`
  font-weight: bold;
`;const{Form:_l,Checkbox:_oe,Select:Wj,Button:Rf,notification:Hoe}=Ne,{Option:Qoe}=Wj,Yoe=()=>{const[e]=_l.useForm(),n=W(),s=D(q),o=m.useRef(),[r,i]=m.useState(!1),[a,c]=m.useState(!1),[d,u]=m.useState(null),{isOpen:p,paymentDetails:h}=D(Vy);m.useEffect(()=>{p&&h.arId&&n(_d({user:s,arId:h.arId}))},[p,s,h.arId]),m.useEffect(()=>{p||c(!1)},[p]);const f=j=>n(gN({paymentOption:j})),x=(j,k)=>{const{paymentMethods:A}=h;k.cash;const P=A.map(S=>{const E=S.method==="cash",T=Number(k[S.method])||0;let R;E||(R=k[`${S.method}Reference`]||S.reference);const N=typeof k[S.method]=="boolean"?k[S.method]:S.status;return{...S,value:T,...R&&{reference:R},status:N}}),w=P.reduce((S,E)=>E.status?S+(Number(E.value)||0):S,0);n(Fm({paymentMethods:P,totalPaid:w}))},g=()=>{if(h.totalAmount<=0)throw new Error("El monto total debe ser mayor a cero.");if((h.paymentOptions==="balance"||h.paymentOptions==="installment")&&h.totalPaid<h.totalAmount)throw new Error("Debe de pagar el monto total");const j=h.paymentMethods.filter(k=>k.status);if(j.length===0)throw new Error("Debe seleccionar al menos un método de pago.");for(const k of j){if(k.method!=="cash"&&!k.reference)throw new Error(`El método de pago ${k.method} requiere una referencia.`);if(k.value<=0)throw new Error(`El valor del método de pago ${k.method} debe ser mayor a cero.`)}if(h.comments.length>500)throw new Error("Los comentarios no pueden exceder los 500 caracteres.")},y=()=>{n(ji()),e.resetFields()},b=Vo.useReactToPrint({content:()=>o.current,onAfterPrint:()=>{Hoe.success({message:"Pago Procesada",description:"Pago Registrado con éxito",duration:4}),y()}}),v=async()=>{i(!0);try{g(),await e.validateFields(),await Ooe(s,h,u),c(!0),h.printReceipt?setTimeout(()=>b(),1e3):(n(ji()),e.resetFields())}catch(j){c(!1),j.name==="ValidationError"?console.log("Validate Failed:",j):Be.error({message:"Error al procesar el pago",description:j.message})}finally{i(!1)}},C=Object.values(BW),I=(h.totalPaid||0)-h.totalAmount;return t.jsxs(vj,{open:p,style:{top:10},title:`${FW[h.paymentScope]}`,onCancel:()=>n(ji()),styles:bj,footer:[t.jsx(Rf,{onClick:()=>n(ji()),children:"Cancelar"},"back"),t.jsx(Rf,{type:"primary",onClick:v,loading:r,disabled:a,children:"Pagar"},"submit")],zIndex:2e3,children:[t.jsx(_l,{form:e,layout:"vertical",initialValues:{paymentConcept:h==null?void 0:h.paymentScope,totalAmountDue:h==null?void 0:h.totalAmountDue},onValuesChange:x,children:t.jsxs(Koe,{children:[(h==null?void 0:h.paymentScope)!=="balance"&&t.jsx(Wj,{value:h.paymentOption,onChange:f,children:C.map(j=>t.jsx(Qoe,{value:j.name,children:j.text},j.name))}),h.paymentOption=="partial"&&t.jsx(Pr,{showcases:[{title:"Balance de la cuenta Actual",valueType:"price",description:"Se aplicara el pago a las diferentes cuotas de la cuenta actual",value:h.totalAmount}]}),h.paymentOption!="partial"&&t.jsx(Pr,{showcases:[{title:h.paymentScope=="balance"?"Balance General":"Total a pagar",valueType:"price",description:h.paymentScope=="balance"?"Se aplicara el pago a las diferentes cuentas por cobrar del cliente actual":"Total a pagar por el cliente",value:h.totalAmount}]}),t.jsx(yoe,{handleAmountChange:x}),t.jsx(Pr,{showcases:[{title:"Total pagado",valueType:"price",value:h.totalPaid},{title:I>=0?"Devuelta":"Faltante",valueType:"price",value:I,description:h.paymentOption=="installment"||h.paymentOption=="balance"?"Tiene que pagar completamente":"No tiene que pagar el faltante completamente",color:h.paymentOption=="installment"||h.paymentOption=="balance"?h.totalAmount>=h.totalPaid:null}]}),t.jsx(_l.Item,{children:t.jsx(_oe,{checked:h.printReceipt,onChange:j=>n(Fm({printReceipt:j.target.checked})),children:"Imprimir recibo de pago"})})]})}),t.jsx("div",{style:{display:"none"},children:t.jsx(Voe,{data:d,ref:o})})]})},Koe=l.div`
    display: grid;
    gap: 1em;
`,{Title:Ar,Text:Joe}=Xe,{TabPane:Hl}=eo,Xoe=l(Je)`
  border-radius: 8px;
  margin-bottom: 16px;
`;l(Ar)`
  margin-top: 10px !important;
`;const qj=l.div`
  margin-bottom: 24px;
  padding: 16px;
  background: #fafafa;
  border-radius: 8px;

  .info-row {
    display: flex;
    margin-bottom: 8px;
  }

  .info-label {
    font-weight: 500;
    width: 120px;
    color: #666;
  }

  .info-value {
    flex: 1;
  }
`,Zoe=l(qj)`
 
  background: #f0f5ff;
`,ere=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 24px;
  margin-top: 24px;
`,Nf=l.div`
  padding: 16px;
  background: ${e=>e.variant==="invoice"?"#f0f5ff":"#fafafa"};
  border-radius: 8px;
  
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .content {
    display: grid;
    gap: 12px;
  }

  .info-item {
    display: flex;
    flex-direction: column;
    
    .label {
      color: #666;
      font-size: 12px;
      margin-bottom: 4px;
    }
    
    .value {
      font-size: 14px;
      font-weight: 500;
    }
  }
`,Of=l.span`
  color: ${e=>e.isPaid?"#52c41a":e.isLate?"#f5222d":"#1890ff"};
  font-size: 12px;
  margin-left: 8px;
`,Ql=l.span`
  display: flex;
  align-items: baseline;
  gap: 4px;
  
  .amount {
    font-size: 16px;
    font-weight: 600;
  }
  
  .label {
    font-size: 12px;
    color: #8c8c8c;
  }
`;function tre({}){var k,A,P,w;const e=W(),n=D(lN),{isOpen:s,arId:o}=D(pN),r=D(dN),i=D(uN),a=D(q),[c,d]=m.useState("summary"),u=S=>typeof S=="number"?`$${S.toFixed(2)}`:"N/A",p=S=>{if(!S)return"N/A";try{return S!=null&&S.seconds?new Date(S.seconds*1e3).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):new Date(S).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})}catch{return"N/A"}},h=()=>{var T,R;const S=((T=n==null?void 0:n.ar)==null?void 0:T.totalReceivable)||0,E=((R=n==null?void 0:n.ar)==null?void 0:R.currentBalance)||0;return S>0?Math.min((S-E)/S*100,100):0},f=[{title:"Nº Cuota",dataIndex:"index",render:(S,E,T)=>(T+1).toString()},{title:"Fecha de Vencimiento",dataIndex:"installmentDate",render:S=>p(S)},{title:"Monto",dataIndex:"installmentAmount",render:S=>u(S)},{title:"Saldo",dataIndex:"installmentBalance",render:S=>u(S)},{title:"Estado",dataIndex:"isActive",render:S=>t.jsx(kn,{status:S?"processing":"default",text:S?"Activa":"Pagada"})}],x=[{title:"Fecha",dataIndex:"createdAt",render:S=>p(S)},{title:"Cuota",dataIndex:"installmentNumber"},{title:"Monto",dataIndex:"amount",render:(S,E)=>{var T;return u(((T=E.paymentDetails)==null?void 0:T.totalPaid)||E.paymentAmount)}},{title:"Método de Pago",dataIndex:"paymentMethods",render:(S,E)=>{var R;return(((R=E.paymentDetails)==null?void 0:R.paymentMethods)||[]).filter(N=>N.status&&N.value>0).map(N=>`${N.method}: ${u(N.value)}`).join(", ")}},{title:"Usuario",dataIndex:"user",render:(S,E)=>{var T;return((T=E.user)==null?void 0:T.displayName)||E.createdBy}},{title:"Comentarios",dataIndex:"comments",ellipsis:!0}];m.useEffect(()=>{a!=null&&a.businessID&&o&&e(va({arId:o,businessID:a.businessID}))},[o,a]);const g=()=>{e(Uy({isOpen:!1})),setTimeout(()=>{e(Dc())},300)},y=()=>n!=null&&n.client?t.jsxs(qj,{children:[t.jsx(Ar,{level:5,children:"Información del Cliente"}),t.jsxs("div",{className:"info-row",children:[t.jsx("span",{className:"info-label",children:"Teléfono:"}),t.jsxs("span",{className:"info-value",children:[n.client.tel,n.client.tel2&&` / ${n.client.tel2}`]})]}),t.jsxs("div",{className:"info-row",children:[t.jsx("span",{className:"info-label",children:"RNC/Cédula:"}),t.jsx("span",{className:"info-value",children:n.client.personalID})]}),t.jsxs("div",{className:"info-row",children:[t.jsx("span",{className:"info-label",children:"Dirección:"}),t.jsx("span",{className:"info-value",children:n.client.address})]}),t.jsxs("div",{className:"info-row",children:[t.jsx("span",{className:"info-label",children:"Sector:"}),t.jsx("span",{className:"info-value",children:n.client.sector})]}),t.jsxs("div",{className:"info-row",children:[t.jsx("span",{className:"info-label",children:"Provincia:"}),t.jsx("span",{className:"info-value",children:n.client.province})]})]}):null,b=()=>{var S,E;return n!=null&&n.invoice?t.jsxs(Zoe,{children:[t.jsx(Ar,{level:5,children:"Información de la Factura"}),t.jsxs("div",{className:"info-row",children:[t.jsx("span",{className:"info-label",children:"Número:"}),t.jsxs("span",{className:"info-value",children:["#",n.invoice.numberID]})]}),t.jsxs("div",{className:"info-row",children:[t.jsx("span",{className:"info-label",children:"NCF:"}),t.jsx("span",{className:"info-value",children:n.invoice.NCF})]}),t.jsxs("div",{className:"info-row",children:[t.jsx("span",{className:"info-label",children:"Fecha:"}),t.jsx("span",{className:"info-value",children:p(n.invoice.date)})]}),t.jsxs("div",{className:"info-row",children:[t.jsx("span",{className:"info-label",children:"Total:"}),t.jsx("span",{className:"info-value",children:u((S=n.invoice.totalPurchase)==null?void 0:S.value)})]}),t.jsxs("div",{className:"info-row",children:[t.jsx("span",{className:"info-label",children:"Items:"}),t.jsx("span",{className:"info-value",children:(E=n.invoice.totalShoppingItems)==null?void 0:E.value})]})]}):null},v=()=>{if(!(n!=null&&n.installments)||!(n!=null&&n.ar))return{date:null,status:"N/A"};const E=[...n.installments].sort((G,Q)=>{var ae,oe;return(((ae=G.installmentDate)==null?void 0:ae.seconds)||0)-(((oe=Q.installmentDate)==null?void 0:oe.seconds)||0)}).find(G=>G.installmentBalance>0);if(!E)return{date:null,isPaid:!0,isLate:!1,status:"COMPLETADO",installmentNumber:null};const T=new Date(E.installmentDate.seconds*1e3),N=T<new Date;return{date:T,isPaid:!1,isLate:N,status:N?"ATRASADO":"PENDIENTE",installmentNumber:E.installmentNumber,amount:E.installmentAmount}},C=()=>{var G,Q,ae,oe;const S=v(),E=((G=n==null?void 0:n.ar)==null?void 0:G.totalReceivable)||0,T=((Q=n.invoice.totalPurchase)==null?void 0:Q.value)-n.ar.totalReceivable,R=((ae=n==null?void 0:n.ar)==null?void 0:ae.arBalance)||0,N=E-R;return t.jsxs(ere,{children:[t.jsxs(Nf,{children:[t.jsxs("div",{className:"header",children:[t.jsx(Ar,{level:5,children:"Estado de Cuenta"}),t.jsx(to,{type:"circle",percent:h(),width:40})]}),t.jsxs("div",{className:"content",children:[t.jsxs("div",{className:"info-item",children:[t.jsx("span",{className:"label",children:"Monto Inicial"}),t.jsx(Ql,{children:t.jsx("span",{className:"amount",children:u(T)})})]}),t.jsxs("div",{className:"info-item",children:[t.jsx("span",{className:"label",children:"Monto Total del Crédito"}),t.jsx(Ql,{children:t.jsx("span",{className:"amount",children:u(E)})})]}),t.jsxs("div",{className:"info-item",children:[t.jsx("span",{className:"label",children:"Balance Actual"}),t.jsxs(Ql,{children:[t.jsx("span",{className:"amount",children:u(R)}),N>0&&t.jsxs("span",{className:"label",children:["(Pagado: ",u(N),")"]})]})]})]})]}),t.jsxs(Nf,{children:[t.jsxs("div",{className:"header",children:[t.jsx(Ar,{level:5,children:"Detalles de Pago"}),t.jsx(Tn,{style:{fontSize:"20px",color:"#1890ff"}})]}),t.jsxs("div",{className:"content",children:[t.jsxs("div",{className:"info-item",children:[t.jsx("span",{className:"label",children:"Frecuencia"}),t.jsx("span",{className:"value",children:((oe=n==null?void 0:n.ar)==null?void 0:oe.paymentFrequency)||"N/A"})]}),t.jsxs("div",{className:"info-item",children:[t.jsx("span",{className:"label",children:S.status==="COMPLETADO"?"Estado":"Próximo Pago"}),t.jsx("span",{className:"value",children:S.date?t.jsxs(t.Fragment,{children:[p(S.date),S.installmentNumber&&t.jsxs(Joe,{type:"secondary",style:{marginLeft:"8px"},children:["(Cuota ",S.installmentNumber,")"]}),t.jsx(Of,{isPaid:S.isPaid,isLate:S.isLate,children:S.status})]}):t.jsx(Of,{isPaid:!0,children:S.status})})]}),S.amount&&t.jsxs("div",{className:"info-item",children:[t.jsx("span",{className:"label",children:"Monto de Cuota"}),t.jsx("span",{className:"value",children:u(S.amount)})]})]})]})]})},I=()=>{var Q,ae,oe,Z,J,X,me,fe,se,ee,K,B,_,L,H,ne,pe;const S=new wu;let E=15;const T=15,R=5,N=(ye,Pe=0)=>{S.text(T+Pe,E,ye),E+=7};S.setFontSize(16),N("Resumen de Cuenta por Cobrar"),E+=5,S.setFontSize(12),S.setTextColor(100),N("Información del Cliente"),S.setTextColor(0),S.setFontSize(10),N(`Nombre: ${((Q=n==null?void 0:n.client)==null?void 0:Q.name)||"N/A"}`,R),N(`ID: ${((ae=n==null?void 0:n.client)==null?void 0:ae.personalID)||"N/A"}`,R),N(`Teléfono: ${((oe=n==null?void 0:n.client)==null?void 0:oe.tel)||"N/A"}`,R),N(`Dirección: ${((Z=n==null?void 0:n.client)==null?void 0:Z.address)||"N/A"}`,R),E+=5,S.setFontSize(12),S.setTextColor(100),N("Información de la Factura"),S.setTextColor(0),S.setFontSize(10),N(`Número: #${((J=n==null?void 0:n.invoice)==null?void 0:J.numberID)||"N/A"}`,R),N(`NCF: ${((X=n==null?void 0:n.invoice)==null?void 0:X.NCF)||"N/A"}`,R),N(`Fecha: ${p((me=n==null?void 0:n.invoice)==null?void 0:me.date)}`,R),N(`Total: ${u((se=(fe=n==null?void 0:n.invoice)==null?void 0:fe.totalPurchase)==null?void 0:se.value)}`,R),E+=5,S.setFontSize(12),S.setTextColor(100),N("Detalles de la Cuenta"),S.setTextColor(0),S.setFontSize(10),N(`Total por Cobrar: ${u((ee=n==null?void 0:n.ar)==null?void 0:ee.totalReceivable)}`,R),N(`Saldo Actual: ${u((K=n==null?void 0:n.ar)==null?void 0:K.currentBalance)}`,R),N(`Frecuencia de Pago: ${((B=n==null?void 0:n.ar)==null?void 0:B.paymentFrequency)||"N/A"}`,R),N(`Próximo Pago: ${p((_=n==null?void 0:n.ar)==null?void 0:_.paymentDate)}`,R),E+=5,S.autoTable({startY:E,head:[["Nº","Vencimiento","Monto","Saldo","Estado"]],body:((L=n==null?void 0:n.installments)==null?void 0:L.map((ye,Pe)=>[Pe+1,p(ye.installmentDate),u(ye.installmentAmount),u(ye.installmentBalance),ye.isActive?"Activa":"Pagada"]))||[],theme:"striped",headStyles:{fillColor:[71,85,105]},styles:{fontSize:8},margin:{top:15,right:T,left:T}}),S.autoTable({startY:S.lastAutoTable.finalY+10,head:[["Fecha","Cuota","Monto","Método de Pago","Usuario"]],body:((H=n==null?void 0:n.payments)==null?void 0:H.map(ye=>{var Pe,Ue,ut,ve;return[p(ye.createdAt),ye.installmentNumber,u(((Pe=ye.paymentDetails)==null?void 0:Pe.totalPaid)||ye.paymentAmount),(ut=(Ue=ye.paymentDetails)==null?void 0:Ue.paymentMethods)==null?void 0:ut.filter(xe=>xe.status&&xe.value>0).map(xe=>`${xe.method}: ${u(xe.value)}`).join(", "),((ve=ye.user)==null?void 0:ve.displayName)||ye.createdBy]}))||[],theme:"striped",headStyles:{fillColor:[71,85,105]},styles:{fontSize:8},margin:{top:15,right:T,left:T}});const G=S.internal.getNumberOfPages();S.setFontSize(8),S.setTextColor(128);for(let ye=1;ye<=G;ye++)S.setPage(ye),S.text(`Página ${ye} de ${G}`,S.internal.pageSize.width/2,S.internal.pageSize.height-10,{align:"center"});S.save(`CxC_${((ne=n==null?void 0:n.client)==null?void 0:ne.name)||"Cliente"}_${((pe=n==null?void 0:n.invoice)==null?void 0:pe.numberID)||"NA"}.pdf`)},j=st.useMemo(()=>n!=null&&n.installments?[...n.installments].sort((S,E)=>{var T,R;return(((T=S.installmentDate)==null?void 0:T.seconds)||0)-(((R=E.installmentDate)==null?void 0:R.seconds)||0)}).map((S,E)=>{var T;return{key:(S==null?void 0:S.id)||E,installmentDate:((T=S==null?void 0:S.installmentDate)==null?void 0:T.seconds)*1e3,installmentAmount:S==null?void 0:S.installmentAmount,installmentBalance:S==null?void 0:S.installmentBalance,isActive:S==null?void 0:S.isActive,payments:(S==null?void 0:S.payments)||[]}}):[],[n==null?void 0:n.installments]);return t.jsx(t.Fragment,{children:t.jsxs(Ce,{title:"Resumen de Cuenta por Cobrar",open:s,onCancel:g,footer:null,width:1e3,children:[r?t.jsx("div",{style:{textAlign:"center",padding:"50px 0"},children:t.jsx(He,{size:"large"})}):i?t.jsx(Pt,{message:"Error",description:i,type:"error",showIcon:!0}):n!=null&&n.ar?t.jsx(Xoe,{title:t.jsxs(Ye,{children:[((k=n==null?void 0:n.client)==null?void 0:k.name)||"Cliente no disponible",t.jsx(kn,{status:(A=n==null?void 0:n.ar)!=null&&A.isActive?"success":"error",text:(P=n==null?void 0:n.ar)!=null&&P.isActive?"Activa":"Inactiva"})]}),children:t.jsxs(eo,{activeKey:c,onChange:d,children:[t.jsxs(Hl,{tab:"Resumen",children:[t.jsxs(nre,{children:[y(),b()]}),C()]},"summary"),t.jsx(Hl,{tab:"Cuotas",children:t.jsx(Gt,{columns:f,dataSource:j,pagination:!1})},"installments"),t.jsx(Hl,{tab:"Pagos",children:t.jsx(Gt,{columns:x,dataSource:((w=n==null?void 0:n.payments)==null?void 0:w.map(S=>({key:S.id||S.paymentId,...S})))||[],pagination:!1,scroll:{x:"max-content"}})},"payments")]})}):t.jsx(Pt,{message:"Sin datos",description:"No se encontró información para esta cuenta por cobrar.",type:"info",showIcon:!0}),t.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"16px"},children:t.jsx(Oe,{title:"Descargar resumen",children:t.jsx(U,{icon:t.jsx(rS,{}),onClick:I})})})]})})}const nre=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 24px;
`,sre=(e,n,s)=>{if(!e){const a=new Error("businessID no proporcionado");return s(a),()=>{}}const o=le($,"businesses",e,"products"),r=he(o);return Te(r,a=>{const c=a.docs.map(d=>({id:d.id,...d.data()}));n(c)},a=>{console.error("Error en la suscripción de productos:",a),s(a)})},ore=()=>{const[e,n]=m.useState([]),[s,o]=m.useState(!0),[r,i]=m.useState(null),a=D(q);return m.useEffect(()=>{if(!a||!a.businessID){n([]),o(!1);return}const c=sre(a.businessID,d=>{n(d),o(!1)},d=>{i(d.message),o(!1)});return()=>c()},[a]),{products:e,loading:s,error:r}},rre=(e,n=null)=>{const[s,o]=m.useState([]),[r,i]=m.useState(!0),[a,c]=m.useState(null);return m.useEffect(()=>{if(!n){o([]),i(!1);return}if(!e){o([]),i(!1);return}i(!0),c(null);const d=Vv(e,n,u=>{o(u),i(!1)});return()=>d()},[e,n]),{batches:s,loading:r,error:a}},{Option:Mf}=ge,ire=l(M)`
  display: flex;
  flex-direction: column;
`,are=l(U)`
  width: 100%;
  background-color: #1890ff;
  color: white;
  &:hover {
    background-color: #40a9ff;
  }
`,cre=(e,n,s,o)=>{if(!e)throw new Error("warehouseId is required to determine the location path.");let r=[e];return n&&r.push(n),s&&r.push(s),o&&r.push(o),r.join("/")};function lre(){const e=W(),[n]=M.useForm(),s=D(q),{isOpen:o,formData:r}=D(EN),{selectedWarehouse:i,selectedShelf:a,selectedRowShelf:c,selectedSegment:d}=D(li),{warehouseId:u,shelfId:p,rowId:h,segmentId:f}={warehouseId:i==null?void 0:i.id,shelfId:a==null?void 0:a.id,rowId:c==null?void 0:c.id,segmentId:d==null?void 0:d.id},{productId:x,batchId:g,stock:y,locationId:b}=r,{products:v,loading:C}=ore(),{batches:I,loading:j}=rre(s,r==null?void 0:r.productId),{data:k}=mp(x),A=C||j,P=I.find(Z=>Z.id===g),w=P?P.quantity:0,S=(k==null?void 0:k.filter(Z=>Z.id!==r.id).reduce((Z,J)=>Z+(J.stock||0),0))||0,E=(y||0)+S,T=w-E,R=g&&w-S>0;m.useEffect(()=>{o&&u&&e(er({path:cre(u,p,h,f)}))},[o,u,p,h,f]);const N=Z=>{const J=v.find(X=>X.id===Z);e(er({productId:Z,productName:(J==null?void 0:J.name)||"",batchId:""}))},G=Z=>{const J=k==null?void 0:k.find(X=>X.batchId===Z&&X.location.id===b);J?antd.Modal.confirm({title:"Este batch ya existe en la ubicación actual",content:"¿Deseas actualizar el stock existente en lugar de agregar uno nuevo?",okText:"Sí, actualizar",cancelText:"No",onOk:()=>{e(CN(J))},onCancel:()=>{e(er({batchId:Z}))}}):e(er({batchId:Z}))},Q=Z=>{e(er({stock:Z}))},ae=async()=>{try{if(await n.validateFields(),!r.productId){V.error("Por favor, selecciona un producto.");return}if(I.length>0&&!r.batchId){V.error("Por favor, selecciona un batch.");return}if(r.stock<=0||isNaN(r.stock)){V.error("La cantidad de stock no puede ser negativa o cero.");return}if(r.id){const Z=r.stock,J={...r,stock:Z};await Sa(s,J),V.success("Stock actualizado exitosamente.")}else{const Z={...r};await pp(s,Z),V.success("Producto creado exitosamente.")}oe()}catch(Z){console.error(Z),V.error("Ocurrió un error al procesar la solicitud.")}},oe=()=>{e(SN()),e(wN())};return t.jsx(Ce,{title:r.id?"Actualizar Producto en Stock":"Agregar Producto en Stock",open:o,onCancel:oe,footer:null,destroyOnHidden:!0,children:t.jsx(He,{spinning:A,children:t.jsxs(ire,{form:n,layout:"vertical",onFinish:ae,children:[t.jsx(M.Item,{label:"Producto",required:!0,tooltip:"Selecciona el producto correspondiente",rules:[{required:!0,message:"Por favor selecciona un producto"}],children:t.jsx(ge,{showSearch:!0,placeholder:"Selecciona un producto",optionFilterProp:"children",onChange:N,filterOption:(Z,J)=>J.children.toLowerCase().includes(Z.toLowerCase()),value:r.productId||void 0,allowClear:!0,children:v.map(Z=>t.jsx(Mf,{value:Z.id,children:Z.name},Z.id))})}),I.length>0&&t.jsx(M.Item,{label:"Batch",required:!0,tooltip:"Selecciona el batch correspondiente",rules:[{required:!0,message:"Por favor selecciona un batch"}],children:t.jsx(ge,{showSearch:!0,placeholder:"Selecciona un batch",optionFilterProp:"children",onChange:G,filterOption:(Z,J)=>J.children.toLowerCase().includes(Z.toLowerCase()),value:r.batchId||void 0,allowClear:!0,children:I.map(Z=>t.jsx(Mf,{value:Z.id,children:Z.shortName},Z.id))})}),R?t.jsx(M.Item,{label:"Cantidad de Stock",required:!0,tooltip:"Ingresa la cantidad de stock disponible",rules:[{required:!0,message:"Por favor ingresa la cantidad de stock"}],children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1em"},children:[t.jsx(Ke,{min:0,max:w-S,style:{width:"100%"},value:r.stock,onChange:Q}),t.jsxs("span",{style:{whiteSpace:"nowrap",color:T<0?"red":"black"},children:[" (Máximo: ",w-S,")"]})]})}):g&&t.jsx(Pt,{message:"El máximo disponible ha sido alcanzado. Por favor intenta con otro producto o lote.",type:"warning",showIcon:!0,style:{marginBottom:16}}),R&&t.jsxs(M.Item,{label:"Stock Total Disponible",tooltip:"Este es el stock total disponible del batch seleccionado y otros productos",children:[t.jsxs("div",{children:[t.jsx(to,{percent:mt(E/w*100),status:T<0?"exception":"normal"}),t.jsx("span",{children:mt(E)}),"/",t.jsx("span",{children:w})]}),T<0&&t.jsx(Pt,{message:"El stock ingresado excede el total disponible. Por favor ajusta la cantidad.",type:"error",showIcon:!0,style:{marginTop:8}})]}),t.jsx(are,{type:"primary",htmlType:"submit",disabled:A||T<0||!R,children:r.id?"Actualizar":"Agregar"})]})})})}const Vj=e=>{if(typeof e!="string"||!e){console.error("Invalid parameter passed to getShelfCollectionRef",e);return}return le($,"businesses",e,"shelves")},dre=async(e,n,s)=>{const o=En();console.log("data",s);try{const r=Vj(e.businessID),i=F(r,o);return await De(i,{...s,id:o,warehouseId:n,createdAt:de(),createdBy:e.uid,updatedAt:de(),updatedBy:e.uid,isDeleted:!1,deletedAt:null,deletedBy:null}),s}catch(r){throw console.error("Error al añadir el documento: ",r),r}},ure=(e,n,s,o)=>{const r=Vj(e.businessID),i=he(r,te("isDeleted","==",!1),te("warehouseId","==",n));return Te(i,a=>{const d=a.docs.map(u=>u.data()).sort((u,p)=>u.createdAt-p.createdAt);s(d)},a=>{o&&o(a)})},pre=async(e,n,s)=>{try{if(!(e!=null&&e.businessID)||!(s!=null&&s.id))throw new Error("Missing required parameters for shelf update");const o=F($,"businesses",e.businessID,"shelves",s.id);return await je(o,{...s,warehouseId:n,updatedAt:de(),updatedBy:e.uid}),s}catch(o){throw console.error("Error al actualizar el documento: ",o),o}},mre=async(e,n)=>{try{const s=F($,"businesses",e.businessID,"shelves",n);return await je(s,{isDeleted:!0,deletedAt:de(),deletedBy:e.uid}),n}catch(s){throw console.error("Error al marcar el documento como eliminado: ",s),s}};function hre({}){const e=W(),[n]=M.useForm(),{formData:s,isOpen:o,path:r}=D(NN),i=D(q);m.useEffect(()=>{s?n.setFieldsValue(s):n.resetFields()},[s,n]);const a=async u=>{var p;try{const h={...s,name:u.name||"",shortName:u.shortName||"",description:u.description||"",rowCapacity:parseInt(u.rowCapacity,10)||0},f=(p=r[0])==null?void 0:p.id;if(!f)throw new Error("No se encontró el ID del almacén");s!=null&&s.id?(await pre(i,f,h),V.success("Estante actualizado con éxito.")):(await dre(i,f,h),V.success("Estante creado con éxito.")),c()}catch(h){console.error("Error al guardar el estante: ",h),V.error(h.message||"Error al guardar el estante.")}},c=()=>{e(DN()),e(PN()),n.resetFields()},d=u=>{e($N(u))};return t.jsx(Ce,{title:s!=null&&s.id?"Editar Estante":"Añadir Estante",open:o,onCancel:c,footer:null,children:t.jsxs(M,{form:n,layout:"vertical",initialValues:s,onFinish:a,onValuesChange:d,children:[t.jsx(M.Item,{name:"name",label:"Nombre",rules:[{required:!0,message:"Por favor, ingrese el nombre"}],children:t.jsx(ie,{})}),t.jsx(M.Item,{name:"shortName",label:"Nombre Corto",rules:[{required:!0,message:"Por favor, ingrese el nombre corto"}],children:t.jsx(ie,{})}),t.jsx(M.Item,{name:"description",label:"Descripción",children:t.jsx(ie.TextArea,{})}),t.jsx(M.Item,{name:"rowCapacity",label:"Capacidad de Fila",rules:[{required:!0,message:"Por favor, ingrese la capacidad de fila"}],children:t.jsx(ie,{type:"number",min:"0"})}),t.jsx(M.Item,{children:t.jsx(U,{type:"primary",htmlType:"submit",children:"Guardar"})})]})})}const Gj=e=>le($,"businesses",e,"rows"),gre=async(e,n,s,o)=>{const r=En();try{const i=Gj(e.businessID),a=F(i,r);return await De(a,{...o,id:r,shelfId:s,warehouseId:n,createdAt:de(),createdBy:e.uid,updatedAt:de(),updatedBy:e.uid,isDeleted:!1,deletedAt:null,deletedBy:null}),{...o,id:r}}catch(i){throw console.error("Error al añadir el documento: ",i),i}},fre=(e,n,s,o,r)=>{try{const i=Gj(e.businessID),a=he(i,te("warehouseId","==",n),te("shelfId","==",s),te("isDeleted","==",!1));return Te(a,c=>{const d=c.docs.map(u=>u.data());o(d)},c=>{console.error("Error al escuchar documentos en tiempo real: ",c),r&&r(c)})}catch(i){throw console.error("Error al escuchar documentos en tiempo real: ",i),i}},xre=async(e,n,s,o,r)=>{try{const i=F($,"businesses",e.businessID,"rows",o);return await je(i,{...r,updatedAt:de(),updatedBy:e.uid}),{id:o,...r}}catch(i){throw console.error("Error al actualizar el documento: ",i),i}},bre=async(e,n,s,o)=>{try{const r=F($,"businesses",e.businessID,"rows",o);return await je(r,{isDeleted:!0,deletedAt:de(),deletedBy:e.uid}),o}catch(r){throw console.error("Error al marcar el documento como eliminado: ",r),r}},{Form:Fs,Input:Yi,Button:yre,Modal:vre,message:Yl}=Ne;function jre(){const[e]=Fs.useForm(),n=W(),s=D(q),{selectedWarehouse:o,selectedShelf:r,selectedRowShelf:i}=D(li),{formData:a,isOpen:c,path:d}=D(LN);m.useEffect(()=>{a?e.setFieldsValue(a):e.resetFields()},[a,e]);const u=async f=>{var x,g;try{const y={...a,...f,capacity:parseInt(f.capacity,10)};if(a!=null&&a.id)await xre(s,o==null?void 0:o.id,r==null?void 0:r.id,a==null?void 0:a.id,y),Yl.success("Fila de estante actualizada con éxito.");else{const b=(x=d[0])==null?void 0:x.id,v=(g=d[1])==null?void 0:g.id;await gre(s,b,v,y),Yl.success("Fila de estante creada con éxito.")}p()}catch(y){console.error("Error al guardar la fila de estante: ",y),Yl.error("Error al guardar la fila de estante.")}},p=()=>{n(MN()),n(ON()),e.resetFields()},h=f=>{n(FN(f))};return t.jsx(vre,{title:a!=null&&a.id?"Editar Fila de Estante":"Añadir Fila de Estante",open:c,onCancel:p,footer:null,children:t.jsxs(Fs,{form:e,layout:"vertical",initialValues:a,onFinish:u,onValuesChange:h,children:[t.jsx(Fs.Item,{name:"name",label:"Nombre",rules:[{required:!0,message:"Por favor, ingrese el nombre"}],children:t.jsx(Yi,{})}),t.jsx(Fs.Item,{name:"shortName",label:"Nombre Corto",children:t.jsx(Yi,{})}),t.jsx(Fs.Item,{name:"description",label:"Descripción",children:t.jsx(Yi.TextArea,{})}),t.jsx(Fs.Item,{name:"capacity",label:"Capacidad",rules:[{required:!0,message:"Por favor, ingrese la capacidad"}],children:t.jsx(Yi,{type:"number",min:"0"})}),t.jsx(Fs.Item,{children:t.jsx(yre,{type:"primary",htmlType:"submit",children:"Guardar"})})]})})}const _j=e=>le($,"businesses",e,"segments"),Cre=async({user:e,segmentData:n})=>{const s=En();try{if(console.log(n),!n.name||typeof n.capacity!="number")throw new Error("Datos inválidos para crear un segmento");const o=_j(e.businessID),r=F(o,s);return await De(r,{...n,id:s,createdAt:de(),createdBy:e.uid,updatedAt:de(),updatedBy:e.uid,isDeleted:!1,deletedAt:null,deletedBy:null}),{...n,id:s}}catch(o){throw console.error("Error al añadir el documento: ",o),o}},wre=(e,n,s,o,r)=>{if(e.businessID===void 0||n===void 0||s===void 0||o===void 0)return console.error("Invalid parameter passed to listenAll",e.businessID,n,s,o),()=>{};const i=_j(e.businessID),a=he(i,te("warehouseId","==",n),te("shelfId","==",s),te("rowShelfId","==",o),te("isDeleted","==",!1));return Te(a,c=>{const d=c.docs.map(u=>u.data());r(d)},c=>{console.error("Error al escuchar documentos en tiempo real: ",c)})},Sre=async(e,n)=>{try{const s=F($,"businesses",e.businessID,"segments",n.id);return await je(s,{...n,updatedAt:de(),updatedBy:e.uid}),n}catch(s){throw console.error("Error al actualizar el documento: ",s),s}},Ire=async(e,n,s,o,r)=>{try{const i=F($,"businesses",e.businessID,"segments",r);return await je(i,{isDeleted:!0,deletedAt:de(),deletedBy:e.uid}),r}catch(i){throw console.error("Error al marcar el documento como eliminado: ",i),i}},{Form:Bs,Input:Ki,Button:Ere,Modal:Are,message:Kl}=Ne;function kre(){const e=W(),[n]=Bs.useForm(),{formData:s,isOpen:o,path:r}=D(VN),{selectedWarehouse:i,selectedShelf:a,selectedRowShelf:c,selectedSegment:d}=D(li),u=D(q);m.useEffect(()=>{s?n.setFieldsValue(s):n.resetFields()},[s,n]);const p=async x=>{var g,y,b;try{const v={...s,...x,capacity:parseInt(x.capacity,10),warehouseId:(g=r[0])==null?void 0:g.id,shelfId:(y=r[1])==null?void 0:y.id,rowShelfId:(b=r[2])==null?void 0:b.id};s!=null&&s.id?(await Sre(u,v),Kl.success("Segmento actualizado con éxito.")):(await Cre({user:u,segmentData:v}),Kl.success("Segmento creado con éxito.")),h()}catch(v){console.error("Error al guardar el segmento:",v),Kl.error("Error al guardar el segmento.")}},h=()=>{e(UN()),e(zN()),n.resetFields()},f=x=>{e(WN(x))};return t.jsx(Are,{title:s!=null&&s.id?"Editar Segmento":"Añadir Segmento",open:o,onCancel:h,footer:null,children:t.jsxs(Bs,{form:n,layout:"vertical",initialValues:s,onFinish:p,onValuesChange:f,children:[t.jsx(Bs.Item,{name:"name",label:"Nombre",rules:[{required:!0,message:"Por favor, ingrese el nombre"}],children:t.jsx(Ki,{})}),t.jsx(Bs.Item,{name:"shortName",label:"Nombre Corto",rules:[{required:!0,message:"Por favor, ingrese el nombre corto"}],children:t.jsx(Ki,{})}),t.jsx(Bs.Item,{name:"description",label:"Descripción",children:t.jsx(Ki.TextArea,{})}),t.jsx(Bs.Item,{name:"capacity",label:"Capacidad",rules:[{required:!0,message:"Por favor, ingrese la capacidad"}],children:t.jsx(Ki,{type:"number",min:"0"})}),t.jsx(Bs.Item,{children:t.jsx(Ere,{type:"primary",htmlType:"submit",children:s!=null&&s.id?"Actualizar":"Crear"})})]})})}const Tre=l.div`
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
`,Pre=l.div`
  padding: 1rem;
`,Dre=l.div`
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 0.5rem;
`,Jl=l.div`
  display: flex;
  align-items: center;
`,Ji=l.div`
  width: ${({size:e})=>e||"1rem"};
  height: ${({size:e})=>e||"1rem"};
  margin-right: ${({marginRight:e})=>e||"0.5rem"};
  color: ${({color:e})=>e};
`,$re=l.span`
  background-color: ${({variant:e})=>e==="default"?"#1890ff":"#faad14"};
  color: #fff;
  padding: 0.25rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
`,Rre=l.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.5rem;
  font-size: 0.75rem;
`,Nre=l.div`
  grid-column: span 2;
  display: flex;
  align-items: center;
`,Ore=l.div`
  margin-top: 0.5rem;
  width: 100%;
  background-color: #e0e0e0;
  border-radius: 8px;
  height: 6px;
`,Mre=l.div`
  background-color: #1890ff;
  height: 6px;
  border-radius: 8px;
  width: ${({width:e})=>e}%;
`,Fre=({item:e})=>{var p,h,f,x;const n=W(),s=D(JN),o=g=>{const y=(g==null?void 0:g.seconds)*1e3;return new Date(y).toISOString().split("T")[0]},{productStockId:r,batchId:i,batchData:a,productStock:c,batch:d}=e,u=()=>{try{Ce.confirm({title:"Confirmación",content:"¿Está seguro que desea seleccionar el producto?",okText:"Sí",cancelText:"No",onOk:()=>{const g={...s,productStock:c,batch:d};n(Yn(g)),n(Xy())},onCancel:()=>{}})}catch{}};return t.jsx(Tre,{onClick:u,children:t.jsxs(Pre,{children:[t.jsxs(Dre,{children:[t.jsxs(Jl,{children:[t.jsx(Ji,{size:"1rem",marginRight:"0.5rem",color:"#1890ff",children:t.jsx(O,{icon:Fr})}),t.jsx("span",{style:{fontWeight:"bold",fontSize:"0.875rem"},children:e.warehouse})]}),t.jsx($re,{variant:e.stock>50?"default":"secondary",children:(p=e==null?void 0:e.productStock)==null?void 0:p.stock})]}),t.jsxs(Rre,{children:[t.jsxs(Jl,{children:[t.jsx(Ji,{size:"0.75rem",marginRight:"0.25rem",color:"#52c41a",children:t.jsx(O,{icon:Hr})}),e.shortName?e.shortName:"",e.shelf?`-${e.shelf}`:"",e.row?`-${e.row}`:"",e.segment?`-${e.segment}`:""]}),((h=e==null?void 0:e.batch)==null?void 0:h.expirationDate)&&t.jsxs(Jl,{children:[t.jsx(Ji,{size:"0.75rem",marginRight:"0.25rem",color:"#ff4d4f",children:t.jsx(O,{icon:ic})}),t.jsx("span",{children:o((f=e==null?void 0:e.batch)==null?void 0:f.expirationDate)})]}),t.jsxs(Nre,{children:[t.jsx(Ji,{size:"0.75rem",marginRight:"0.25rem",color:"#faad14",children:t.jsx(O,{icon:Sw})}),t.jsxs("span",{children:["Lote: ",(x=e==null?void 0:e.batch)==null?void 0:x.shortName]})]})]}),t.jsx(Ore,{children:t.jsx(Mre,{width:Math.min(e.productStock.stock,100)})})]})})},Hj=e=>{if(typeof e!="string"||!e.trim())return{};const n=e.split("/").filter(s=>s!=="");return{warehouseId:n[0]||null,shelfId:n[1]||null,rowShelfId:n[2]||null,segmentId:n[3]||null}};function Bre(e){if(!Array.isArray(e)||e.length===0)return[];const n=e.map(s=>s.batchId);return[...new Set(n)]}function Lre(e,n){return e.map(s=>{const{warehouseId:o,shelfId:r,rowShelfId:i,segmentId:a}=Hj(s.path);let c="",d="",u="",p="",h="";if(o){const b=n.warehouses.find(v=>v.id===o||v.warehouseId===o);b&&(c=(b==null?void 0:b.name)||"",d=(b==null?void 0:b.shortName)||"")}if(r){const b=n.shelves.find(v=>v.id===r||v.shelfId===r);b&&(u=(b==null?void 0:b.shortName)||"")}if(i){const b=n.rows.find(v=>v.id===i||v.rowShelfId===i);b&&(p=(b==null?void 0:b.shortName)||"")}if(a){const b=n.segments.find(v=>v.id===a||v.segmentId===a);b&&(h=(b==null?void 0:b.shortName)||"")}const f=(s==null?void 0:s.expirationDate)||"",x={id:(s==null?void 0:s.batchId)||""},g={id:(s==null?void 0:s.id)||"",stock:(s==null?void 0:s.stock)||0},y=s==null?void 0:s.path;return{warehouse:c,shortName:d,shelf:u,row:p,segment:h,path:y,productStock:g,batch:x,expirationDate:f}})}function zre(e,n){return e.map(s=>{const o=n.find(r=>r.id===s.batch.id);return o?{...s,batch:{id:o.id,shortName:o.shortName,expirationDate:o.expirationDate,stock:o.quantity}}:s})}function Ff(e){return e.sort((n,s)=>{const o=Bf(n).toLowerCase(),r=Bf(s).toLowerCase();return o<r?-1:o>r?1:0})}function Bf(e){let n="";return e.shortName&&(n+=e.shortName),e.shelf&&(n+=`-${e.shelf}`),e.row&&(n+=`-${e.row}`),e.segment&&(n+=`-${e.segment}`),n}const Ure=async(e,n,s)=>{try{if(!e.businessID)return;const o=await qre(e,n),i=(o.map(h=>h==null?void 0:h.path)||[]).map(h=>Hj(h)),{data:a}=await Vre(e,i),c=Bre(o),d=await Gre(e,c),u=Lre(o,a),p=zre(u,d);return s(Ff(p)),Ff(p)}catch(o){console.error("ocurrió un error al buscar ......................",o)}},Wre=e=>{const n=D(q),[s,o]=m.useState([]),[r,i]=m.useState(!0),[a,c]=m.useState(null);return m.useEffect(()=>{n&&e&&Ure(n,e,o).then(()=>i(!1)).catch(d=>c(d))},[n,e]),{data:s,loading:r,error:a}},qre=async(e,n)=>{const s=le($,"businesses",e.businessID,"productsStock"),o=he(s,te("productId","==",n)),r=await Me(o);let i=[];return r.forEach(a=>{i.push(a.data())}),i},Vre=async(e,n)=>{if(!e.businessID||n.length===0)return{data:{warehouses:[],shelves:[],rows:[],segments:[]},loading:!1,error:null};let s=[],o=[],r=[],i=[],a=null;for(const c of n)try{let d=`businesses/${e.businessID}/warehouses/${c.warehouseId}`;c.shelfId&&(d+=`/shelves/${c.shelfId}`,c.rowShelfId&&(d+=`/rows/${c.rowShelfId}`,c.segmentId&&(d+=`/segments/${c.segmentId}`)));const u=F($,d),p=await Se(u);if(p.exists()){const h=p.data();c.segmentId?i.push(h):c.rowShelfId?r.push(h):c.shelfId?o.push(h):c.warehouseId&&s.push(h)}}catch(d){console.error("Error obteniendo el documento:",d),a=d}return{data:{warehouses:s,shelves:o,rows:r,segments:i},loading:!1,error:a}},Gre=async(e,n)=>{const s=n.map(r=>F($,"businesses",e.businessID,"batches",r));return await Promise.all(s.map(async r=>(await Se(r)).data()))},_re=l.div`
  padding: 20px;
  background: linear-gradient(to bottom right, #f0f2f5, #c3d8ff);
  min-height: 75vh;
  display: grid;
    gap: 1rem;
`,Hre=l.div`
    display: grid;
    h3{
        color: #1a1a1a;
        font-size: 1rem;
        font-weight: 700;
    }
`,Qre=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 1rem;
`,Yre=e=>e.reduce((n,s)=>{const o=s.warehouse;return n[o]||(n[o]=[]),n[o].push(s),n},{}),Kre=()=>{const e=W(),n=D(XN),s=D(ZN);D(q);const{loading:o,data:r}=Wre(n),i=()=>{e(GN(!1)),e(Xy())},a=Yre(r);return t.jsxs(Ce,{title:"Seleccionar Ubicación de Inventario",open:s,width:1e3,onCancel:i,style:{top:10},footer:[t.jsx(U,{onClick:i,type:"primary",children:"Cerrar"},"close")],children:[t.jsx(He,{spinning:o,tip:"Cargando...",size:"large",children:o&&t.jsx("div",{style:{height:"400px"}})}),!o&&t.jsx(_re,{children:Object.entries(a).map(([c,d])=>t.jsxs(Hre,{children:[t.jsx("h3",{children:c}),t.jsx(Qre,{children:d.map(u=>t.jsx(Fre,{item:u},u.productStockId))})]},c))})]})},Jre=()=>{const e=W(),{isOpen:n,initialValues:s}=D(sO),o=D(q),[r]=M.useForm(),i=s!==null;m.useEffect(()=>{n?r.setFieldsValue({name:s?s.name:""}):r.resetFields()},[n,s,r]);const a=()=>{e(Vm())},c=async()=>{try{const u=await r.validateFields();i?(await GO(o,{id:s.id,name:u.name}),V.success("Principio activo actualizado con éxito.")):(await VO(o,{name:u.name}),V.success("Principio activo creado con éxito.")),a()}catch(u){console.log("Validate Failed:",u),V.error("Hubo un error al procesar la solicitud.")}},d=()=>{e(Vm())};return t.jsx(Ce,{title:i?"Actualizar Principio Activo":"Crear Principio Activo",open:n,onOk:c,width:400,onCancel:d,okText:i?"Actualizar":"Crear",cancelText:"Cancelar",children:t.jsx(M,{form:r,layout:"vertical",name:"active_ingredient_form",children:t.jsx(M.Item,{name:"name",label:"Nombre del Principio Activo",rules:[{required:!0,message:"Por favor ingrese el nombre del principio activo"}],children:t.jsx(ie,{placeholder:"Nombre del Principio Activo",autoFocus:!0})})})})},Xre=l.div`
  max-height: 300px;
  overflow-y: auto;
`,Zre=l.div`
  display: flex;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #f0f0f0;
  
  &:hover {
    background-color: #f5f5f5;
  }
`,eie=l.div`
  flex: 1;
  margin-left: 10px;
`;l.span`
  color: #888;
  font-size: 12px;
  margin-left: 10px;
`;const tie=l.button`
  background: none;
  border: none;
  color: #ff4d4f;
  cursor: pointer;
  padding: 5px;
  
  &:hover {
    color: #cf1322;
  }
`,Lf=l(Ge)`
  margin-left: 8px;
  font-size: 11px;
`,nie=l.div`
  margin-bottom: 16px;
`,sie=l.button`
  background: none;
  border: none;
  color: #1890ff;
  cursor: pointer;
  padding: 5px;
  margin-right: 8px;
  
  &:hover {
    color: #40a9ff;
  }
`,oie=l.h4`
  margin: 12px 0;
  color: #666;
  font-weight: 500;
`,rie=l.span`
  margin-right: 8px;
  font-size: 16px;
  display: flex;
  align-items: center;
`,Qj=({files:e=[],removeFile:n,handlePreview:s})=>{const o=d=>({receipts:"green",invoices:"blue",others:"orange"})[d==null?void 0:d.toLowerCase()]||"default",r=d=>{const u=d.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif"].includes(u)},i=d=>d.split(".").pop().toLowerCase()==="pdf",a=m.useMemo(()=>{const d={receipts:{title:"Recibos",files:[]},invoices:{title:"Facturas",files:[]},others:{title:"Otros Documentos",files:[]}};return e==null||e.forEach(u=>{var f;const p=((f=u.type)==null?void 0:f.toLowerCase())||"others";(d[p]||d.others).files.push(u)}),Object.entries(d).filter(([u,p])=>p.files.length>0)},[e]),c=d=>t.jsxs(Zre,{children:[t.jsx(rie,{children:r(d.name)?t.jsx(ts,{style:{color:"#52c41a"}}):i(d.name)?t.jsx(ns,{style:{color:"#ff4d4f"}}):t.jsx(no,{})}),t.jsxs(eie,{children:[t.jsx(Oe,{title:d.name,children:d.name}),t.jsx(Lf,{color:o(d.type),children:d.type}),t.jsx(Lf,{color:d.url?"purple":"blue",children:d.url?"Remoto":"Local"})]}),t.jsxs("div",{children:[(r(d.name)||i(d.name))&&t.jsx(sie,{onClick:()=>s(d),children:t.jsx(zo,{})}),n&&t.jsx(tie,{onClick:()=>n(d.id||d.url),children:t.jsx(ht,{})})]})]},d.id||d.url);return e!=null&&e.length?t.jsx(Xre,{children:a.map(([d,u])=>t.jsxs(nie,{children:[t.jsx(oie,{children:u.title}),u.files.map(c)]},d))}):t.jsx(Lt,{description:"No hay archivos adjuntos"})};Qj.defaultProps={files:[],removeFile:()=>{},handlePreview:()=>{}};const iie=sn`
  from { opacity: 0; }
  to { opacity: 1; }
`,aie=sn`
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
`,cie=l.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  visibility: ${e=>e.isDragging?"visible":"hidden"};
  opacity: ${e=>e.isDragging?1:0};
  transition: all 0.3s ease-in-out;
  animation: ${iie} 0.3s ease-in-out;
`,lie=l.div`
  background: rgba(255, 255, 255, 0.95);
  padding: 48px 64px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  transform: scale(${e=>e.isDragging?"1.02":"1"});
  transition: transform 0.2s ease-in-out;

  .icon-wrapper {
    animation: ${aie} 2s infinite ease-in-out;
    margin-bottom: 20px;
  }

  h3 {
    margin: 16px 0;
    color: #1890ff;
    font-size: 24px;
    font-weight: 600;
  }

  p {
    color: #666;
    font-size: 16px;
    margin: 8px 0;
  }
`,die=e=>{switch(e.toLowerCase()){case"imagen":return t.jsx(ts,{style:{fontSize:56,color:"#1890ff"}});case"pdf":return t.jsx(ns,{style:{fontSize:56,color:"#1890ff"}});default:return t.jsx(ss,{style:{fontSize:56,color:"#1890ff"}})}},uie=({isDragging:e,onDrop:n,onDragOver:s,onDragLeave:o,fileType:r})=>t.jsx(cie,{isDragging:e,onDrop:n,onDragOver:s,onDragLeave:o,children:t.jsxs(lie,{isDragging:e,children:[t.jsx("div",{className:"icon-wrapper",children:die(r)}),t.jsx("h3",{children:"Arrastra y suelta tus archivos aquí"}),t.jsxs("p",{children:["Suelta los archivos para agregarlos como ",r]})]})}),pie=l.div`
  max-width: 100%;
  height: 100%;
`,mie=l.div`
  height: 100%;
  margin: 0;
  padding: 0;
  width: 100%;
  
  embed {
    width: 100%;
    height: 100%;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 4px;
  }
`,zf=l.div`
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
`,Uf=l.div`
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
`,hie=({previewFile:e,previewVisible:n,setPreviewVisible:s,setPreviewFile:o})=>{const[r,i]=m.useState(!1),[a,c]=m.useState(null),[d,u]=m.useState(0),p=m.useCallback(()=>{i(!1),u(0)},[]),h=m.useCallback(()=>{d<2?(u(x=>x+1),setTimeout(()=>i(!0),1e3)):(i(!1),c("No se pudo cargar el PDF. Por favor, verifique su conexión o intente abrirlo en una nueva pestaña."))},[d]),f=()=>{if(!e)return null;const x=e.name.split(".").pop().toLowerCase(),g=e.url||e.preview||e.file&&URL.createObjectURL(e.file);return["jpg","jpeg","png","gif"].includes(x)?t.jsxs(t.Fragment,{children:[t.jsx(Uf,{role:"status","aria-live":"polite",children:r?"Cargando imagen...":a||"Imagen cargada"}),t.jsx(Lo,{src:g,alt:e.name,style:{maxWidth:"100%",height:"auto"},placeholder:t.jsx(zf,{children:t.jsx(He,{size:"large",tip:"Cargando imagen..."})}),onError:()=>c("No se pudo cargar la imagen. Verifique su conexión o permisos de acceso.")})]}):x==="pdf"?t.jsxs(mie,{children:[t.jsx(Uf,{role:"status","aria-live":"polite",children:r?"Cargando PDF...":a||"PDF cargado"}),r&&t.jsx(zf,{children:t.jsx(He,{size:"large",tip:`Cargando PDF${d>0?` (intento ${d+1}/3)`:""}`})}),t.jsx("embed",{src:`${g}#toolbar=1&navpanes=1&scrollbar=1&zoom=100`,type:"application/pdf",style:{display:r?"none":"block"},onLoad:p,onError:h}),a&&t.jsx(Pt,{message:"Error al cargar el PDF",description:t.jsxs(t.Fragment,{children:[a,t.jsx("br",{}),t.jsx("a",{href:g,target:"_blank",rel:"noopener noreferrer",children:"Abrir en nueva pestaña"})]}),type:"error",showIcon:!0,style:{margin:"20px"}})]}):t.jsx("p",{children:"No hay vista previa disponible para este tipo de archivo"})};return m.useEffect(()=>{let x;return e&&(i(!0),c(null),e.file instanceof File&&(x=URL.createObjectURL(e.file))),()=>{x&&URL.revokeObjectURL(x),c(null),i(!1)}},[e]),t.jsx(Rt,{open:n,onClose:()=>{s(!1),o(null),u(0)},width:window.innerWidth<=768?"100%":"80%",height:"100%",title:e==null?void 0:e.name,placement:window.innerWidth<=768?"right":"bottom",footer:null,styles:{content:{height:"100%",padding:0,margin:0},body:{padding:"0",margin:"0",height:"100%",overflow:"hidden"}},children:t.jsx(pie,{children:f()})})},gie=({lightboxOpen:e,setLightboxOpen:n,lightboxIndex:s,setLightboxIndex:o,getImageFiles:r})=>t.jsx(mc,{open:e,close:()=>n(!1),index:s,slides:r(),plugins:[hc,gc,fc],carousel:{spacing:0,padding:0,imageFit:"contain"},zoom:{wheelZoomDistanceFactor:100,pinchZoomDistanceFactor:100,scrollToZoom:!0},thumbnails:{position:"bottom",width:120,height:80,gap:2,padding:5},captions:{showToggle:!0,descriptionTextAlign:"left"}}),fie=l.button`
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border: 1px solid #d9d9d9;
  border-radius: 6px;
  background: white;
  cursor: pointer;
  transition: all 0.3s;

  &:hover {
    border-color: #1890ff;
    color: #1890ff;
  }
`,xie=({onFileInput:e})=>t.jsxs(t.Fragment,{children:[t.jsxs(fie,{onClick:()=>document.getElementById("fileInput").click(),children:[t.jsx(ss,{}),"Cargar"]}),t.jsx("input",{id:"fileInput",type:"file",multiple:!0,onChange:e,style:{display:"none"}})]}),{Option:bie}=ge,yie=[{value:"receipts",label:"Recibos"},{value:"invoices",label:"Facturas"},{value:"others",label:"Otros"}],vie=({fileType:e,setFileType:n,handleFileInput:s})=>s?t.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"16px"},children:[t.jsx(M.Item,{label:"Tipo",children:t.jsx(ge,{value:e,style:{width:120},onChange:o=>n(o),children:yie.map(o=>t.jsx(bie,{value:o.value,children:o.label},o.value))})}),t.jsx(M.Item,{label:"Adjuntar Evidencia",children:t.jsx(xie,{onFileInput:s})})]}):null,Yj=({files:e=[],attachmentUrls:n=[],onAddFiles:s=null,onRemoveFiles:o=null,showFileList:r=!0})=>{const[i,a]=m.useState("receipts"),[c,d]=m.useState(!1),[u,p]=m.useState(null),[h,f]=m.useState(!1),[x,g]=m.useState(!1),[y,b]=m.useState(0);m.useEffect(()=>{const w=E=>{E.preventDefault(),d(!0)},S=E=>{E.preventDefault(),E.relatedTarget===null&&d(!1)};return window.addEventListener("dragenter",w),window.addEventListener("dragleave",S),()=>{window.removeEventListener("dragenter",w),window.removeEventListener("dragleave",S)}},[]);const v=w=>{w.preventDefault(),d(!1);const S=Array.from(w.dataTransfer.files);I(S)},C=w=>{const S=Array.from(w.target.files);I(S)},I=w=>{const S=w.map(E=>({file:E,type:i,id:Math.random().toString(36).substr(2,9),name:E.name,isLocal:!0}));s(S),V.success(`${w.length} archivo(s) agregado(s)`)},j=w=>{o(w)},k=m.useCallback(()=>{const w=[];return e.forEach(S=>{Vt(S.name)&&w.push({src:nn(S.file),title:S.name,description:`Tipo: ${S.type}`})}),n.filter(S=>{var E;return(E=S.url)==null?void 0:E.includes("firebasestorage.googleapis.com")}).forEach(S=>{Vt(S.name)&&w.push({src:S.url,title:S.name,description:`Tipo: ${S.type}`})}),w},[e,n]),A=m.useMemo(()=>{const w=(e||[]).map(E=>({...E,isLocal:!0,preview:E.file?nn(E.file):null})),S=(n||[]).filter(E=>{var T;return(T=E.url)==null?void 0:T.includes("firebasestorage.googleapis.com")}).map(E=>({id:E.id||Math.random().toString(36).substr(2,9),name:E.name||"Archivo sin nombre",type:E.type||Nc(E.url),url:E.url,isLocal:!1}));return[...w,...S]},[e,n]);m.useEffect(()=>()=>{A.filter(w=>w.isLocal&&w.preview).forEach(w=>{Rc(w.preview)})},[A]);const P=m.useCallback(w=>{if(!w)return;const S=Vt(w.name),E=di(w.name);if(S){const R=k().findIndex(N=>N.title===w.name&&N.src===(w.url||w.file&&nn(w.file)));b(Math.max(0,R)),g(!0)}else E&&(p(w),f(!0))},[k]);return t.jsxs("div",{children:[s&&t.jsx(vie,{fileType:i,setFileType:a,handleFileInput:C}),r&&t.jsx(Qj,{files:A,removeFile:o?j:null,handlePreview:P}),t.jsx(hie,{previewFile:u,previewVisible:h,setPreviewVisible:f,setPreviewFile:p}),t.jsx(gie,{lightboxOpen:x,setLightboxOpen:g,lightboxIndex:y,setLightboxIndex:b,getImageFiles:k}),t.jsx(uie,{isDragging:c,onDrop:v,onDragOver:w=>w.preventDefault(),onDragLeave:w=>{w.preventDefault(),w.relatedTarget===null&&d(!1)},fileType:i})]})};function jie(){const e=W(),{files:n,open:s}=D(OE),o=()=>e(RE());return t.jsx(Rt,{title:"Subir Evidencia",placement:"right",onClose:o,open:s,width:720,children:t.jsx(Yj,{attachmentUrls:n})})}const Cie=()=>{const[e,n]=m.useState(null),[s,o]=m.useState(!1),[r,i]=m.useState(null),{productStockId:a,batchId:c,actionType:d,isOpen:u}=D(sv),p=D(q);return m.useEffect(()=>{let h=!0;const f=new AbortController;return u&&(a&&d==="productStock"||c&&d==="batch")&&(async()=>{if(u)try{if(o(!0),i(null),d==="batch"&&c){const[g,y]=await Promise.all([Qa(p,c,f.signal),Ya(p,{batchId:c},f.signal)]);h&&n({quantity:y.reduce((b,v)=>b+v.quantity,0),locations:y.length,expirationDate:g==null?void 0:g.expirationDate,batchNumber:g==null?void 0:g.batchNumber,numberId:g==null?void 0:g.numberId,batchId:c,originalData:{batch:g,items:y}})}else if(d==="productStock"&&a){const g=await Hv(p,a,f.signal),y=g!=null&&g.batchId?await Qa(p,g.batchId,f.signal):null;h&&n({quantity:(g==null?void 0:g.quantity)||0,locations:1,expirationDate:y==null?void 0:y.expirationDate,batchNumber:y==null?void 0:y.batchNumber,numberId:g==null?void 0:g.batchNumberId,productStockId:a,originalData:{stock:g,batch:y}})}}catch(g){h&&g.name!=="AbortError"&&(console.error("Error loading stock data:",g),i(g),n(null))}finally{h&&o(!1)}})(),()=>{h=!1,f.abort()}},[a,c,d,p,u]),{data:e,isLoading:s,error:r}},{TextArea:wie}=ie,{Text:Sie}=Xe,Iie=[{value:"expired",label:"Vencimiento"},{value:"damaged",label:"Dañado"},{value:"lost",label:"Pérdida"},{value:"other",label:"Otro"}],Eie=l.div`
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
`,Wf=l.div`
  flex: 1;
  padding: 0.5rem;
  border: 2px solid ${e=>e.isSelected?"#1890ff":"#d9d9d9"};
  border-radius: 6px;
  cursor: ${e=>e.disabled?"not-allowed":"pointer"};
  opacity: ${e=>e.disabled?.5:1};
  background-color: ${e=>e.isSelected?"#e6f7ff":"white"};
  transition: all 0.3s;
  
  &:hover {
    border-color: ${e=>!e.disabled&&"#1890ff"};
  }

  display: flex;
  align-items: center;
  gap: 0.5rem;
  justify-content: center;
`,qf=l.div`
  font-size: 1.2rem;
  color: ${e=>e.isSelected?"#1890ff":"#595959"};
`,Vf=l.span`
  font-size: 0.9rem;
  font-weight: 500;
  color: ${e=>e.isSelected?"#1890ff":"#595959"};
`,Aie=()=>{const e=W(),[n]=M.useForm(),s=D(q),{isOpen:o,productStockId:r,batchId:i,actionType:a}=D(sv),{data:c,isLoading:d,error:u}=Cie(),[p,h]=m.useState(!1),f=()=>{e(aO()),n.resetFields()},x=async()=>{var C,I;try{h(!0);const k={...await n.validateFields(),quantity:c.quantity,...a==="batch"?{batchId:i}:{productStockId:r}};a==="batch"?await kz({user:s,batchId:i,movement:k}):await Gv({user:s,productStockId:r,movement:k}),V.success(`${a==="batch"?"Lote":"Stock"} eliminado correctamente`),f()}catch(j){console.error("Error:",j),V.error(((I=(C=j.response)==null?void 0:C.data)==null?void 0:I.message)||"Error al procesar la solicitud")}finally{h(!1)}},g=C=>{e(cO(C.target.value))},y=()=>c?t.jsxs(Zt,{bordered:!0,size:"small",column:1,style:{marginBottom:"0.5rem"},contentStyle:{padding:"4px 8px"},labelStyle:{padding:"4px 8px"},children:[c.numberId&&t.jsx(Zt.Item,{label:"Número de Lote",children:c.numberId}),t.jsxs(Zt.Item,{label:"Cantidad Total",children:[c.quantity," unidades"]}),c.expirationDate&&t.jsx(Zt.Item,{label:"Fecha de Vencimiento",children:new Date(c.expirationDate).toLocaleDateString()}),t.jsxs(Zt.Item,{label:"Ubicaciones",children:[c.locations," ",c.locations>1?"ubicaciones":"ubicación"]})]}):null,b=()=>t.jsxs(Eie,{children:[t.jsxs(Wf,{isSelected:a==="productStock",disabled:!r,onClick:()=>!r||g({target:{value:"productStock"}}),children:[t.jsx(qf,{isSelected:a==="productStock",children:t.jsx(O,{icon:Hr})}),t.jsx(Vf,{isSelected:a==="productStock",children:"Stock Individual"})]}),t.jsxs(Wf,{isSelected:a==="batch",onClick:()=>g({target:{value:"batch"}}),children:[t.jsx(qf,{isSelected:a==="batch",children:t.jsx(O,{icon:Bo})}),t.jsx(Vf,{isSelected:a==="batch",children:"Lote Completo"})]})]}),v=()=>d?t.jsx(He,{size:"large",className:"w-full py-4 flex justify-center"}):u?t.jsx(Sie,{type:"danger",children:"Error cargando la información del stock"}):t.jsxs(t.Fragment,{children:[b(),y(),t.jsxs(M,{form:n,layout:"vertical",style:{gap:"0.5rem"},children:[t.jsx(M.Item,{name:"reason",label:"Motivo",style:{marginBottom:"8px"},rules:[{required:!0,message:"Por favor seleccione un motivo"}],children:t.jsx(ge,{options:Iie})}),t.jsx(M.Item,{name:"notes",label:"Notas",style:{marginBottom:"8px"},children:t.jsx(wie,{rows:3})})]})]});return t.jsx(Ce,{title:`Eliminar ${a==="batch"?"Lote":"Stock"}`,open:o,onCancel:f,onOk:x,style:{top:20},okButtonProps:{loading:p},cancelButtonProps:{disabled:p},destroyOnHidden:!0,children:v()})},kie=({visible:e,onClose:n,children:s})=>e?t.jsx(gt,{children:t.jsx(Tie,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,children:t.jsxs(Pie,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},onClick:o=>o.stopPropagation(),children:[t.jsx(Die,{onClick:n,children:"×"}),s]})})}):null,Tie=l(Ie.div)`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
`,Pie=l(Ie.div)`
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 8px;
    width: 90%;
    max-width: 1200px;
    height: 99vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
`,Die=l.button`
    position: absolute;
    top: 8px;
    right: 16px;
    background: none;
    border: none;
    color: #999;
    font-size: 24px;
    cursor: pointer;
    z-index: 10;
    
    &:hover {
        color: #fff;
    }
`,$ie=({title:e,subtitle:n})=>t.jsxs(Rie,{children:[t.jsx(Nie,{children:e}),t.jsx(Oie,{}),t.jsx(Mie,{})]}),Rie=l.div`
    background: #2a2a2a;
    padding: 12px 20px;
    border-bottom: 1px solid #333;
    display: flex;
    align-items: center;
    justify-content: space-between;
`,Nie=l.h2`
    color: #fff;
    font-size: 18px;
    font-weight: 600;
    margin: 0;
`,Oie=l.p`
    color: #999;
    font-size: 13px;
    margin: 2px 0 0 0;
`,Mie=l.div`
 
`,Fie=({inputValue:e,suggestions:n,onSuggestionSelect:s,isVisible:o=!1,selectedIndex:r=-1,onSelectedIndexChange:i,inputElement:a=null})=>{const[c,d]=m.useState("above"),u=m.useRef(null);if(m.useEffect(()=>{if(!o||!a||!u.current)return;const f=()=>{try{const g=a.getBoundingClientRect(),y=u.current,C=Math.min((n==null?void 0:n.length)||0,8)*45+20,I=g.top,j=window.innerHeight-g.bottom;I>=C&&I>j?d("above"):j>=C?d("below"):d(I>j?"above":"below")}catch{d("above")}};f();const x=()=>f();return window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x)}},[o,a,n==null?void 0:n.length]),!o||!n||n.length===0)return null;const p=(f,x)=>{i(x),s(f)},h=f=>{i(f)};return t.jsx(Bie,{ref:u,position:c,className:"autocomplete-container",children:t.jsx(Lie,{children:n.map((f,x)=>t.jsxs(zie,{isSelected:x===r,onClick:()=>p(f,x),onMouseEnter:()=>h(x),children:[t.jsx(Uie,{children:f.command}),t.jsx(Wie,{children:f.description})]},x))})})},Bie=l.div`
  position: absolute;
  ${e=>e.position==="above"?`
    bottom: 100%;
    margin-bottom: 8px;
    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
  `:`
    top: 100%;
    margin-top: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  `}
  left: 0;
  right: 0;
  background: #1a1a1a;
  border: 1px solid #333;
  border-radius: 8px;
  z-index: 1000;
  max-height: 300px;
  overflow: hidden;
  margin: 1em;
  font-family: 'Courier New', monospace;
`,Lie=l.div`
  max-height: 290px;
  overflow-y: auto;
  
  /* Personalizar scrollbar */
  &::-webkit-scrollbar {
    width: 6px;
  }
  
  &::-webkit-scrollbar-track {
    background: #1a1a1a;
  }
  
  &::-webkit-scrollbar-thumb {
    background: #444;
    border-radius: 3px;
  }
  
  &::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
`,zie=l.div`
  padding: 8px 12px;
  cursor: pointer;
  border-bottom: 1px solid #2a2a2a;
  background: ${e=>e.isSelected?"#0d3863":"transparent"};
  color: ${e=>e.isSelected?"white":"#e0e0e0"};
  transition: all 0.1s ease;

  &:hover {
    background: #0066cc;
    color: white;
  }

  &:last-child {
    border-bottom: none;
  }
`,Uie=l.div`
  font-weight: bold;
  font-size: 13px;
  color: ${e=>{var n;return(n=e.theme)!=null&&n.isSelected?"white":"#8ee78e"}};
  margin-bottom: 2px;
`,Wie=l.div`
  font-size: 11px;
  opacity: 0.8;
  color: ${e=>{var n;return(n=e.theme)!=null&&n.isSelected?"white":"#ccc"}};
`;l.div`
  padding: 6px 12px;
  background: #2d2d2d;
  border-top: 1px solid #333;
  color: #888;
  font-size: 10px;
  text-align: center;
`;const qie={hidden:{opacity:0,x:-8,transition:{duration:.1}},visible:{opacity:1,x:0,transition:{duration:.15,ease:[0,0,.2,1]}}},Vie=({consoleOutput:e,commandInput:n,setCommandInput:s,handleKeyDown:o,selectionMode:r,welcomeText:i,autoCompleteSuggestions:a=[],showAutoComplete:c=!1,autoCompleteSelectedIndex:d=-1,onAutoCompleteSuggestionSelect:u,onAutoCompleteSelectedIndexChange:p,onFilterSelection:h})=>{const f=m.useRef(null),x=m.useRef(null);m.useEffect(()=>{(()=>{f.current&&!r.active&&(f.current.focus(),setTimeout(()=>{var b;r.active||(b=f.current)==null||b.focus()},100))})(),r.active||setTimeout(()=>{var b;(b=f.current)==null||b.focus()},50)},[r.active]);const g=y=>{var b;r.active||y.target!==f.current&&(y.target.closest(".selectable-item")||y.target.closest(".autocomplete-container")||y.target.closest("button")||y.target.closest("a")||y.target.closest("[onclick]")||(b=f.current)==null||b.focus())};return t.jsxs(Gie,{children:[t.jsxs(_ie,{ref:x,className:"console-terminal",onClick:g,children:[t.jsx(Hie,{children:i}),e.map(y=>t.jsx(Ie.div,{initial:"hidden",animate:"visible",variants:qie,children:t.jsx(Qie,{type:y.type,children:y.type==="command"?t.jsxs("div",{className:"content",children:[t.jsx("span",{className:"prompt",children:y.content.prompt}),t.jsx("span",{className:"user-command",children:y.content.userCommand})]}):y.html?t.jsx("div",{className:"content",dangerouslySetInnerHTML:{__html:y.content}}):t.jsx("div",{className:"content",children:y.content})})},y.id))]}),t.jsxs(Jie,{children:[t.jsx(Fie,{inputValue:n,suggestions:a,onSuggestionSelect:u,isVisible:c&&!r.active,selectedIndex:d,onSelectedIndexChange:p,inputElement:f.current}),t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx(Yie,{children:"C:\\\\VentaMax>"}),t.jsx(Kie,{ref:f,value:n,onChange:y=>{s(y.target.value),r.active&&h&&h(y.target.value)},onKeyDown:o,placeholder:r.active?"Escribe para filtrar las opciones...":"Escriba un comando...",autoFocus:!0,style:{opacity:1,cursor:"text"}})]})]})]})},Gie=l.div`
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
`,_ie=l.div`
  background-color: #0c0c0c;
  color: #c0c0c0;
  font-family: 'Consolas', 'Lucida Console', 'Courier New', monospace;
  font-size: 14px;
  padding: 16px;
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
  cursor: text; /* Cursor de texto para indicar que es clickeable */
  
  /* Estilo para elementos seleccionables */
  .selectable-item {
    transition: background-color 0.1s ease;
    cursor: pointer !important; /* Mantener cursor pointer para elementos seleccionables */
    
    &:hover {
      background-color: rgba(0, 102, 204, 0.15);
    }
    
    &.selected {
      position: relative;
      
      &:after {
        content: '';
        position: absolute;
        inset: 0;
        border: 2px solid #0066cc;
        pointer-events: none;
        z-index: 10;
      }
    }
  }
  
  /* Authentic Windows CMD scrollbar */
  &::-webkit-scrollbar { 
    width: 16px; 
  }
  &::-webkit-scrollbar-track { 
    background: #000; 
  }
  &::-webkit-scrollbar-thumb { 
    background: #808080; 
    border: 1px solid #000;
    
    &:hover {
      background: #a0a0a0;
    }
    
    &:active {
      background: #606060;
    }
  }
  &::-webkit-scrollbar-corner {
    background: #000;
  }
`,Hie=l.div`
  color: #c0c0c0;
  margin-bottom: 0;
  white-space: pre-line;
  font-family: 'Consolas', 'Lucida Console', 'Courier New', monospace;
  font-size: 14px;
  font-weight: 400;
  line-height: 1.2;
`,Qie=l.div`
  margin-bottom: ${e=>{switch(e.type){case"command":return"2px";case"error":return"8px";default:return"12px"}}};
  white-space: pre-wrap;
  word-wrap: break-word;
  font-family: 'Consolas', 'Lucida Console', 'Courier New', monospace;
  font-size: 14px;
  font-weight: 400;
  line-height: 1.2;
  
  .content {
    color: ${e=>{switch(e.type){case"command":return"#f5deb3";case"error":return"#ff6b6b";case"selection":return"#66d9ef";default:return"#c0c0c0"}}};
  }
  
  .prompt {
    color: #c0c0c0; // Color del sistema para el prompt C:\VentaMax>
  }
  
  .user-command {
    color: #f5deb3; // Color cremita solo para lo que escribe el usuario
  }
  
  .selection-active {
    color: #ffffff;
    background-color: #0066cc;
    padding: 0 5px;
    margin-left: -5px;
    border-radius: 2px;
  }
  
  .selection-inactive {
    color: #c0c0c0;
  }
`,Yie=l.span`
  color: #c0c0c0;
  margin-right: 0;
  user-select: none;
  font-family: 'Consolas', 'Lucida Console', 'Courier New', monospace;
  font-size: 14px;
  font-weight: 400;
`,Kie=l.input`
  flex: 1;
  background: transparent;
  border: none;
  color: #f5deb3; /* Color cremita/beige para diferenciarlo del sistema */
  font-family: 'Consolas', 'Lucida Console', 'Courier New', monospace;
  font-size: 14px;
  font-weight: 400;
  outline: none;
  caret-color: #f5deb3;
  margin-left: 0;
  
  &::placeholder {
    color: #606060;
  }
  
  &::selection {
    background: #f5deb3;
    color: #000;
  }
`;l.div`
  position: relative;
  width: 100%;
`;const Jie=l.div`
  position: relative;
  background-color: #0c0c0c;
  border-top: 1px solid #333;
  padding: 12px 16px;
  flex-shrink: 0;
`,Xie=({active:e,items:n,selectedIndex:s,title:o,command:r,onExitSelectionMode:i,onSelectionConfirm:a,onSelectIndex:c,consoleOutput:d,setConsoleOutput:u})=>{if(!e)return null;const p=()=>{u(f=>f.filter(x=>x.type!=="selection"||x.type==="selection"&&x.command!==r));const h={id:Date.now()+Math.random(),content:`<div style="color:#66d9ef;font-weight:bold;margin-bottom:10px;">${o}</div>
<div style="margin-left:4px;margin-bottom:10px;">
${n.map((f,x)=>{const g=x===s;return`<div style="padding:4px 0;cursor:pointer;margin-bottom:2px;" 
      onclick="window.selectItem(${x}, event)" 
      data-index="${x}" 
      class="selectable-item ${g?"selected":""}">
      <span class="${g?"selection-active":"selection-inactive"}">${g?"🔹":"▫️"} ${f.display||f.name||f}</span>
  </div>`}).join("")}
</div>
<div style="color:#888;font-size:12px;margin-top:5px;border-top:1px solid #333;padding-top:8px;">
🔸 <strong>Filtrar:</strong> Escribe en la consola para filtrar opciones<br/>
🔸 <strong>Navegación:</strong> ESC para cancelar<br/>
🔸 <strong>Clic:</strong> Una vez para seleccionar, dos veces en el mismo para confirmar
</div>`,type:"selection",html:!0,command:r};u(f=>[...f,h]),window.selectItem=(f,x)=>{if(x&&(x.preventDefault(),x.stopPropagation()),f===s){u(y=>y.filter(b=>b.type!=="selection"||b.type==="selection"&&b.command!==r)),setTimeout(()=>{a()},0);return}c==null||c(f);const g={...h};g.id=Date.now()+Math.random(),g.content=g.content.replace(/class="selectable-item selected"/g,'class="selectable-item"').replace(/class="selection-active"/g,'class="selection-inactive"').replace(/🔹/g,"▫️"),g.content=g.content.replace(`data-index="${f}" class="selectable-item "`,`data-index="${f}" class="selectable-item selected"`).replace(`data-index="${f}"><span class="selection-inactive">▫️`,`data-index="${f}"><span class="selection-active">🔹`),u(y=>[...y.filter(b=>b.type!=="selection"||b.type==="selection"&&b.command!==r),g])},window.confirmSelection=void 0};return m.useEffect(()=>(e&&(console.log("SelectionMode - Rendering with items:",n),p()),()=>{window.selectItem=void 0,window.confirmSelection=void 0}),[e,s,n]),t.jsxs(Zie,{children:[t.jsx("span",{children:"🎯 MODO DE SELECCIÓN ACTIVO"}),t.jsx("span",{children:"Escribe para filtrar • Clic para seleccionar • ESC para cancelar"})]})},Zie=l.div`
  position: sticky;
  top: 0;
  background: linear-gradient(135deg, #0066cc 0%, #004499 100%);
  color: white;
  padding: 8px 16px;
  margin: -16px -16px 12px -16px; /* Compensar el padding del ConsoleTerminal */
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-family: 'Consolas', 'Lucida Console', 'Courier New', monospace;
  font-size: 13px;
  font-weight: bold;
  z-index: 100;
  border-bottom: 2px solid #0055aa;
  box-shadow: 0 3px 8px rgba(0,0,0,0.4);
  
  span:first-child {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  span:last-child {
    font-weight: normal;
    font-size: 12px;
    opacity: 0.95;
    background: rgba(255,255,255,0.1);
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid rgba(255,255,255,0.2);
  }
`,eae=async()=>{try{const e=le($,"businesses"),n=he(e,it("business.name","asc"));return(await Me(n)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return console.error("Error al obtener la lista de negocios:",e),[]}},tae=Fx(),Kj=async(e=50)=>{console.log("🔍 Iniciando consulta de usuarios...");const n=le(tae,"users");let s;try{s=he(n,uu(e)),console.log("📋 Ejecutando consulta de usuarios...");const o=await Me(s);console.log("📊 Documentos encontrados:",o.size);const r=o.docs.map(i=>i.data());return console.log("✅ Usuarios procesados:",r.length),r}catch(o){console.error("❌ Error en la consulta:",o)}},nae=async(e,n=20)=>{try{const s=await Kj(100);return e?s.filter(r=>r.displayName.toLowerCase().includes(e.toLowerCase())||r.email.toLowerCase().includes(e.toLowerCase())||r.id.toLowerCase().includes(e.toLowerCase())).slice(0,n):s.slice(0,n)}catch(s){throw console.error("Error searching users:",s),new Error("Error al buscar usuarios: "+s.message)}},sae=Fx(),Jj=async(e,n)=>{try{const s=await Wo.hash(n,10),o=F(sae,"users",e);await je(o,{"user.password":s})}catch(s){console.error("Error updating password:",s)}};class oae{constructor(n){this.dispatch=n.dispatch,this.navigate=n.navigate,this.user=n.user,this.isTestMode=n.isTestMode,this.isTemporaryMode=n.isTemporaryMode,this.originalBusinessId=n.originalBusinessId,this.isTemporaryRoleMode=n.isTemporaryRoleMode,this.originalRole=n.originalRole,this.addOutput=n.addOutput,this.addCommandEcho=n.addCommandEcho,this.setReactScanLoaded=n.setReactScanLoaded,this.reactScanLoaded=n.reactScanLoaded,this.setBusinesses=n.setBusinesses,this.businesses=n.businesses,this.enterSelectionMode=n.enterSelectionMode}async loadBusinessesList(){try{const n=await eae();return this.setBusinesses(n),n}catch(n){return console.error("Error al cargar negocios:",n),[]}}async loadUsersList(){try{const n=await Kj();return console.log(n),n}catch(n){return console.error("Error al cargar usuarios:",n),[]}}async changeUserPassword(n,s){try{return await Jj(n,s),!0}catch(o){throw console.error("Error al cambiar contraseña:",o),o}}getAllCommandSuggestions(){return[{command:"HELP",description:"Muestra ayuda de comandos"},{command:"CLEAR",description:"Borra la pantalla"},{command:"CLS",description:"Borra la pantalla"},{command:"USER",description:"Información del usuario"},{command:"STATE",description:"Estado del sistema"},{command:"TEST",description:"Navega a página de pruebas"},{command:"PRUEBA",description:"Navega a página de pruebas"},{command:"BUSINESS",description:"Administra negocios"},{command:"BUSINESS LIST",description:"Lista todos los negocios"},{command:"BUSINESS SELECT",description:"Selección interactiva de negocios"},{command:"BUSINESS SWITCH ",description:"Cambia a otro negocio por ID"},{command:"BUSINESS RETURN",description:"Vuelve al negocio original"},{command:"BUSINESS STATUS",description:"Estado de conexión a negocios"},{command:"ROLE",description:"Administra roles"},{command:"ROLE LIST",description:"Lista roles disponibles"},{command:"ROLE SELECT",description:"Selección interactiva de roles"},{command:"ROLE SWITCH ",description:"Cambia a otro role por ID"},{command:"ROLE RETURN",description:"Vuelve al role original"},{command:"ROLE STATUS",description:"Estado actual de roles"},{command:"NAVIGATE",description:"Navega entre rutas"},{command:"NAVIGATE LIST",description:"Lista todas las rutas"},{command:"NAVIGATE SELECT",description:"Selección interactiva de rutas"},{command:"NAVIGATE SEARCH ",description:"Busca rutas por texto"},{command:"NAVIGATE /home",description:"Navega a inicio"},{command:"NAVIGATE /sales",description:"Navega a ventas"},{command:"NAVIGATE /inventory",description:"Navega a inventario"},{command:"SELECT",description:"Comandos de selección"},{command:"SELECT HELP",description:"Ayuda de selección"},{command:"SELECT TEST",description:"Prueba de selección"},{command:"SELECT COLORS",description:"Selecciona colores"},{command:"SELECT NUMBERS",description:"Selecciona números"},{command:"DEBUG",description:"Modo de depuración"},{command:"DEBUG ON",description:"Activa debug"},{command:"DEBUG OFF",description:"Desactiva debug"},{command:"TESTMODE",description:"Modo de prueba facturación"},{command:"TESTMODE ON",description:"Activa modo prueba"},{command:"TESTMODE OFF",description:"Desactiva modo prueba"},{command:"TESTMODE STATUS",description:"Estado modo prueba"},{command:"REACTSCAN",description:"Carga React Scan"},{command:"USERS",description:"Administra usuarios"},{command:"USERS LIST",description:"Lista todos los usuarios"},{command:"USERS SELECT",description:"Selección interactiva de usuarios"},{command:"USERS SEARCH ",description:"Busca usuarios por nombre/email"},{command:"USERS PASSWORD",description:"Cambiar contraseña de usuario"}]}getCommandSuggestions(n){if(!n||n.trim()==="")return[];const s=n.trim().toLowerCase(),r=this.getAllCommandSuggestions().filter(i=>{const a=i.command.toLowerCase();return a.startsWith(s)||a.includes(s)});return r.sort((i,a)=>{const c=i.command.toLowerCase(),d=a.command.toLowerCase(),u=c.startsWith(s),p=d.startsWith(s);return u&&!p?-1:!u&&p?1:c.localeCompare(d)}),r.slice(0,8)}getAllRoutes(){const n=[],s=(o,r="")=>{Object.keys(o).forEach(i=>{const a=o[i];typeof a=="string"&&a.startsWith("/")?n.push({name:i,path:a,category:r||"General"}):typeof a=="object"&&a!==null&&s(a,i)})};return s(jc),n}filterRoutes(n){const s=this.getAllRoutes();if(!n)return s;const o=n.toLowerCase();return s.filter(r=>r.name.toLowerCase().includes(o)||r.path.toLowerCase().includes(o)||r.category.toLowerCase().includes(o))}async executeCommand(n){var s,o,r,i,a,c,d,u,p,h,f,x;this.addCommandEcho(n);try{let g;const y=n.toLowerCase().trim();switch(!0){case y==="clear":case y==="cls":return{clearConsole:!0};case y==="select help":g=`Comandos de selección interactiva:

SELECT HELP       - Muestra esta ayuda
SELECT TEST       - Muestra una selección de prueba
SELECT COLORS     - Selecciona entre diferentes colores
SELECT NUMBERS    - Selecciona entre números del 1 al 10

Para seleccionar, haga clic en una opción y doble clic para confirmar.
Pulse ESC para cancelar.`;break;case y==="select test":const b=[{id:"1",display:"Opción 1 - Esta es la primera opción"},{id:"2",display:"Opción 2 - Esta es la segunda opción"},{id:"3",display:"Opción 3 - Esta es la tercera opción"},{id:"4",display:"Opción 4 - Esta es la cuarta opción"}];this.enterSelectionMode(b,"🧪 Selección de prueba:",S=>{this.addOutput(`Has seleccionado: ${S.display}`)},"select test");break;case y==="select colors":const v=[{id:"red",display:"🔴 Rojo",value:"#FF0000"},{id:"green",display:"🟢 Verde",value:"#00FF00"},{id:"blue",display:"🔵 Azul",value:"#0000FF"},{id:"yellow",display:"🟡 Amarillo",value:"#FFFF00"},{id:"purple",display:"🟣 Morado",value:"#800080"},{id:"orange",display:"🟠 Naranja",value:"#FFA500"},{id:"black",display:"⚫ Negro",value:"#000000"},{id:"white",display:"⚪ Blanco",value:"#FFFFFF"}];this.enterSelectionMode(v,"🎨 Selección de Color:",S=>{this.addOutput(`Has seleccionado: ${S.display}
Valor hexadecimal: ${S.value}`)},"select colors");break;case y==="select numbers":const C=Array.from({length:10},(S,E)=>({id:String(E+1),display:`Número ${E+1}`,value:E+1}));this.enterSelectionMode(C,"🔢 Selección de Número:",S=>{this.addOutput(`Has seleccionado el número: ${S.value}`)},"select numbers");break;case y==="select":g=`Comando de selección interactiva.

Use uno de los siguientes comandos:
  SELECT HELP       - Muestra ayuda detallada
  SELECT TEST       - Prueba la selección interactiva
  SELECT COLORS     - Selecciona entre diferentes colores
  SELECT NUMBERS    - Selecciona entre números del 1 al 10

Para más información, use 'SELECT HELP'`;break;case y==="help":g=`Para obtener más información sobre un comando específico, escriba HELP nombre-de-comando

BUSINESS       Administra la conexión a negocios (listar, cambiar, volver).
               Incluye modo de selección interactivo con clic.
CLEAR          Borra la pantalla.
CLS            Borra la pantalla.
DEBUG          Administra el modo de depuración.
HELP           Proporciona información de ayuda para los comandos.
NAVIGATE       Navega entre diferentes rutas de la aplicación.
               Incluye búsqueda y modo de selección interactivo.
PRUEBA         Navega rápidamente a la página de pruebas (/prueba).
REACTSCAN      Carga la herramienta React Scan.
ROLE           Administra el cambio temporal de roles del usuario.
               Incluye modo de selección interactivo con clic.
SELECT         Comandos de selección interactiva con clic.
STATE          Muestra el estado actual de la aplicación.
TEST           Alias de PRUEBA - navega a la página de pruebas.
TESTMODE       Administra el modo de prueba de facturación.
USER           Muestra información del usuario actual.
USERS          Administra usuarios del sistema (listar, buscar, cambiar contraseña).
               ⚠️ Solo para desarrolladores. Incluye modo de selección interactivo.`;break;case y==="user":g=`Información del usuario actual:

Nombre de usuario: ${((s=this.user)==null?void 0:s.displayName)||"No disponible"}
Correo electrónico: ${((o=this.user)==null?void 0:o.email)||"No disponible"}
Rol del sistema: ${((r=this.user)==null?void 0:r.role)||"No asignado"}
Business ID actual: ${((i=this.user)==null?void 0:i.businessID)||"No asignado"}
Modo temporal de negocio: ${this.isTemporaryMode?"ACTIVADO":"DESACTIVADO"}
Business ID original: ${this.originalBusinessId||"N/A"}
Modo temporal de role: ${this.isTemporaryRoleMode?"ACTIVADO":"DESACTIVADO"}
Role original: ${this.originalRole||"N/A"}
Estado: ${this.user?"Autenticado":"No autenticado"}`;break;case y==="state":g=`Estado del sistema VentaMax:

Entorno de ejecución: Producción
Modo de depuración: ${localStorage.getItem("debugMode")?"ACTIVADO":"DESACTIVADO"}
Modo de prueba: ${this.isTestMode?"ACTIVADO":"DESACTIVADO"}
Modo temporal de negocio: ${this.isTemporaryMode?"ACTIVADO":"DESACTIVADO"}
Modo temporal de role: ${this.isTemporaryRoleMode?"ACTIVADO":"DESACTIVADO"}
React Scan: ${this.reactScanLoaded?"CARGADO":"NO CARGADO"}
Usuario conectado: ${((a=this.user)==null?void 0:a.displayName)||"Ninguno"}
Business ID actual: ${((c=this.user)==null?void 0:c.businessID)||"No asignado"}
Role actual: ${((d=this.user)==null?void 0:d.role)||"No asignado"}
Consola de desarrollador: ABIERTA`;break;case y==="reactscan":g="React Scan solo está disponible en el entorno de desarrollo.";break;case y==="debug on":localStorage.setItem("debugMode","true"),g="Modo de depuración ACTIVADO.";break;case y==="debug off":localStorage.removeItem("debugMode"),g="Modo de depuración DESACTIVADO.";break;case y==="debug":g=`Utilización: DEBUG [ON | OFF]

ON     Activa el modo de depuración
OFF    Desactiva el modo de depuración

Estado actual: ${localStorage.getItem("debugMode")?"ACTIVADO":"DESACTIVADO"}`;break;case y==="testmode on":this.isTestMode?g="El modo de prueba ya está activo.":(this.dispatch(Ld()),g=`🧪 Modo de prueba ACTIVADO.

Las facturas se procesarán en modo de prueba sin afectar la base de datos.`);break;case y==="testmode off":this.isTestMode?(this.dispatch(Ld()),g=`✅ Modo de prueba DESACTIVADO.

Las facturas volverán a guardarse en la base de datos.`):g="El modo de prueba ya está desactivado.";break;case y==="testmode status":g=`Estado del modo de prueba: ${this.isTestMode?"🧪 ACTIVADO":"✅ DESACTIVADO"}

${this.isTestMode?"Las facturas se procesan en modo de prueba sin afectar la base de datos.":"Las facturas se guardan normalmente en la base de datos."}`;break;case y==="testmode":g=`Utilización: TESTMODE [ON | OFF | STATUS]

ON       Activa el modo de prueba de facturación
OFF      Desactiva el modo de prueba de facturación  
STATUS   Muestra el estado actual del modo de prueba

Estado actual: ${this.isTestMode?"🧪 ACTIVADO":"✅ DESACTIVADO"}`;break;case y==="business list":g="Cargando lista de negocios...",this.loadBusinessesList().then(S=>{if(S.length===0)this.addOutput("No se encontraron negocios disponibles.","error");else{const E=`Lista de negocios disponibles:

${S.map(T=>{var R;return`${((R=T.business)==null?void 0:R.name)||"Sin nombre"} - ID: ${T.id||T.businessID}`}).join(`
`)}

Para cambiar de negocio use: BUSINESS SWITCH [ID]
Para modo interactivo use: BUSINESS SELECT`;this.addOutput(E)}}).catch(S=>{this.addOutput("Error al cargar la lista de negocios: "+S.message,"error")});break;case y==="business select":g="Cargando lista de negocios para selección...",this.loadBusinessesList().then(S=>{if(S.length===0)this.addOutput("No se encontraron negocios disponibles.","error");else{const E=S.map(T=>{var Q,ae;const R=T.id||T.businessID,N=((Q=T.business)==null?void 0:Q.name)||"Sin nombre",G=R===((ae=this.user)==null?void 0:ae.businessID);return{id:R,display:`${N}${G?" (Actual)":""} - ID: ${R}`,name:N,businessData:T,isCurrent:G}});this.enterSelectionMode(E,"📋 Seleccionar Negocio:",T=>{T.isCurrent?this.isTemporaryMode&&T.id===this.originalBusinessId?(this.dispatch(kd()),this.addOutput(`🔄 Regresando al negocio original: ${T.name}
ID: ${T.id}

✅ MODO TEMPORAL DESACTIVADO`)):this.addOutput(`🔄 Ya está conectado al negocio: ${T.name}
ID: ${T.id}`):(this.dispatch(qp(T.id)),this.addOutput(`✅ Cambiado al negocio: ${T.name}
ID: ${T.id}

⚠️  MODO TEMPORAL ACTIVADO
Para volver al negocio original use: BUSINESS RETURN`))},"business select")}}).catch(S=>{this.addOutput("Error al cargar la lista de negocios: "+S.message,"error")});break;case y.startsWith("business switch "):const I=y.replace("business switch ","").trim();if(!I)g=`Error: Debe especificar un ID de negocio.
Uso: BUSINESS SWITCH [ID]`;else if(I===((u=this.user)==null?void 0:u.businessID))g="Ya está conectado a ese negocio.";else{g="Verificando negocio...";const E=(this.businesses.length>0?this.businesses:await this.loadBusinessesList()).find(T=>{var R,N;return(T.id||T.businessID)===I||((N=(R=T.business)==null?void 0:R.name)==null?void 0:N.toLowerCase().includes(I.toLowerCase()))});setTimeout(()=>{var T;E?(this.dispatch(qp(I)),this.addOutput(`✅ Cambiado al negocio: ${((T=E.business)==null?void 0:T.name)||"Sin nombre"}
ID: ${I}

⚠️  MODO TEMPORAL ACTIVADO
Para volver al negocio original use: BUSINESS RETURN`)):this.addOutput(`Error: No se encontró el negocio con ID "${I}".
Use BUSINESS LIST para ver los negocios disponibles.`,"error")},100),g=null}break;case y==="business return":if(!this.isTemporaryMode)g="No está en modo temporal. Ya está en su negocio original.";else{const S=this.businesses.find(E=>(E.id||E.businessID)===this.originalBusinessId);this.dispatch(kd()),g=`✅ Regresado al negocio original: ${((p=S==null?void 0:S.business)==null?void 0:p.name)||"Sin nombre"}
ID: ${this.originalBusinessId}

✅ MODO TEMPORAL DESACTIVADO`}break;case y==="business status":g=`Estado de conexión a negocios:

Negocio actual: ${((h=this.user)==null?void 0:h.businessID)||"No asignado"}
Modo temporal: ${this.isTemporaryMode?"⚠️  ACTIVADO":"✅ DESACTIVADO"}
Negocio original: ${this.originalBusinessId||"N/A"}

${this.isTemporaryMode?`Está trabajando temporalmente en otro negocio.
Use BUSINESS RETURN para volver al original.`:"Está trabajando en su negocio original."}`;break;case y==="business":g=`Utilización: BUSINESS [LIST | SELECT | SWITCH | RETURN | STATUS]

LIST     Muestra todos los negocios disponibles
SELECT   Modo de selección interactivo con clic
SWITCH   Cambia temporalmente a otro negocio por ID
RETURN   Vuelve al negocio original
STATUS   Muestra el estado actual de conexión

Ejemplos:
  BUSINESS LIST               - Lista simple
  BUSINESS SELECT             - Selección interactiva
  BUSINESS SWITCH abc123xyz   - Cambio directo por ID
  BUSINESS RETURN             - Volver al original
  BUSINESS STATUS             - Estado actual`;break;case y==="role list":const j=Gl(this.user).map(S=>`${S.label} - ID: ${S.id}`).join(`
`);j.length===0?g="No tiene roles disponibles para cambio temporal.":g=`Lista de roles disponibles para su usuario:

${j}

Para cambiar de role use: ROLE SWITCH [ID]
Para modo interactivo use: ROLE SELECT`;break;case y==="role select":const k=Gl(this.user);if(k.length===0){g="No tiene roles disponibles para cambio temporal.";break}const A=k.map(S=>{var T;const E=S.id===((T=this.user)==null?void 0:T.role);return{id:S.id,display:`${S.label}${E?" (Actual)":""} - ID: ${S.id}`,label:S.label,roleData:S,isCurrent:E}});this.enterSelectionMode(A,"👤 Seleccionar Role:",S=>{S.isCurrent?this.isTemporaryRoleMode&&S.id===this.originalRole?(this.dispatch(Gp()),this.addOutput(`🔄 Regresando al role original: ${S.label}
ID: ${S.id}

✅ MODO TEMPORAL DE ROLE DESACTIVADO`)):this.addOutput(`🔄 Ya tiene asignado el role: ${S.label}
ID: ${S.id}`):(this.dispatch(Vp(S.id)),this.addOutput(`✅ Cambiado al role: ${S.label}
ID: ${S.id}

⚠️  MODO TEMPORAL DE ROLE ACTIVADO
Para volver al role original use: ROLE RETURN`))},"role select");break;case y.startsWith("role switch "):const P=y.replace("role switch ","").trim();if(!P)g=`Error: Debe especificar un ID de role.
Uso: ROLE SWITCH [ID]`;else if(P===((f=this.user)==null?void 0:f.role))g="Ya tiene ese role asignado.";else{const E=Gl(this.user).find(T=>T.id===P);E?(this.dispatch(Vp(P)),g=`✅ Cambiado al role: ${E.label}
ID: ${P}

⚠️  MODO TEMPORAL DE ROLE ACTIVADO
Para volver al role original use: ROLE RETURN`):g=`Error: No tiene permisos para cambiar al role "${P}" o el role no existe.
Use ROLE LIST para ver los roles disponibles para su usuario.`}break;case y==="role return":if(!this.isTemporaryRoleMode)g="No está en modo temporal de role. Ya está usando su role original.";else{const S=pn.find(E=>E.id===this.originalRole);this.dispatch(Gp()),g=`✅ Regresado al role original: ${(S==null?void 0:S.label)||"Sin nombre"}
ID: ${this.originalRole}

✅ MODO TEMPORAL DE ROLE DESACTIVADO`}break;case y==="role status":g=`Estado de roles del usuario:

Role actual: ${((x=this.user)==null?void 0:x.role)||"No asignado"}
Modo temporal de role: ${this.isTemporaryRoleMode?"⚠️  ACTIVADO":"✅ DESACTIVADO"}
Role original: ${this.originalRole||"N/A"}

${this.isTemporaryRoleMode?`Está usando temporalmente otro role.
Use ROLE RETURN para volver al original.`:"Está usando su role original."}`;break;case y==="role":g=`Utilización: ROLE [LIST | SELECT | SWITCH | RETURN | STATUS]

LIST     Muestra todos los roles disponibles
SELECT   Modo de selección interactivo con clic
SWITCH   Cambia temporalmente a otro role por ID
RETURN   Vuelve al role original
STATUS   Muestra el estado actual de roles

Ejemplos:
  ROLE LIST               - Lista simple
  ROLE SELECT             - Selección interactiva
  ROLE SWITCH admin       - Cambio directo por ID
  ROLE RETURN             - Volver al original
  ROLE STATUS             - Estado actual`;break;case y==="users list":g="Cargando lista de usuarios...",this.loadUsersList().then(S=>{if(S.length===0)this.addOutput("No se encontraron usuarios disponibles.","error");else{const E=`Lista de usuarios disponibles:

${S.map(({user:T},R)=>`${R+1}. ${T.name} (${T.email})
   Role: ${T.role} | ID: ${T==null?void 0:T.id}`).join(`

`)}

Total: ${S.length} usuarios
Para cambiar contraseña use: USERS PASSWORD
Para modo interactivo use: USERS SELECT`;this.addOutput(E)}}).catch(S=>{this.addOutput("Error al cargar la lista de usuarios: "+S.message,"error")});break;case y==="users select":g="Cargando lista de usuarios para selección...",this.loadUsersList().then(S=>{if(S.length===0)this.addOutput("No se encontraron usuarios disponibles.","error");else{const E=S.map(({user:T})=>({id:T==null?void 0:T.id,display:`👤 ${T.name} (${T.email}) - Role: ${T.role}`,name:T.name,email:T.email,role:T.role,userData:T}));this.enterSelectionMode(E,"👥 Seleccionar Usuario:",T=>{this.addOutput(`Usuario seleccionado:

Nombre: ${T.name}
Email: ${T.email}
Role: ${T.role}
ID: ${T.id}

Para cambiar su contraseña use: USERS PASSWORD`)},"users select")}}).catch(S=>{this.addOutput("Error al cargar la lista de usuarios: "+S.message,"error")});break;case y.startsWith("users search "):const w=y.replace("users search ","").trim();w?(g="Buscando usuarios...",nae(w).then(S=>{if(S.length===0)this.addOutput(`No se encontraron usuarios que coincidan con "${w}".`,"warning");else{const E=`Usuarios encontrados para "${w}":

${S.map(({user:T},R)=>`${R+1}. ${T==null?void 0:T.name} (${T==null?void 0:T.email})
   Role: ${T==null?void 0:T.role} | ID: ${T==null?void 0:T.id}`).join(`

`)}

Encontrados ${S==null?void 0:S.length} usuarios.`;this.addOutput(E)}}).catch(S=>{this.addOutput("Error al buscar usuarios: "+S.message,"error")})):g=`Error: Debe especificar un término de búsqueda.
Uso: USERS SEARCH [TEXTO]`;break;case y==="users password":g="Iniciando proceso de cambio de contraseña...",this.loadUsersList().then(S=>{if(S.length===0)this.addOutput("No se encontraron usuarios disponibles.","error");else{const E=S.map(({user:T})=>({id:T==null?void 0:T.id,display:`👤 ${T==null?void 0:T.name} Negocio: (${T==null?void 0:T.businessID}) - Role: ${T==null?void 0:T.role} - Id: ${T==null?void 0:T.id}`,name:T==null?void 0:T.name,email:T==null?void 0:T.email,role:T==null?void 0:T.role,userData:T}));this.enterSelectionMode(E,"🔑 Seleccionar Usuario para Cambiar Contraseña:",T=>{const R=prompt(`Ingrese la nueva contraseña para ${T.name}:`);if(R&&R.trim()){if(R.length<6){this.addOutput("❌ Error: La contraseña debe tener al menos 6 caracteres.","error");return}this.addOutput(`🔄 Cambiando contraseña para ${T.name}...`),this.changeUserPassword(T.id,R.trim()).then(()=>{this.addOutput(`✅ Contraseña cambiada exitosamente para:

Usuario: ${T.name}
Email: ${T.email}
ID: ${T.id}

🔐 La nueva contraseña ha sido encriptada y guardada.`)}).catch(N=>{this.addOutput(`❌ Error al cambiar la contraseña: ${N.message}`,"error")})}else this.addOutput("❌ Operación cancelada. No se ingresó una contraseña válida.","warning")},"users password")}}).catch(S=>{this.addOutput("Error al cargar la lista de usuarios: "+S.message,"error")});break;case y==="users":g=`Utilización: USERS [LIST | SELECT | SEARCH | PASSWORD]

LIST                    Lista todos los usuarios disponibles
SELECT                  Modo de selección interactivo con clic
SEARCH [TEXTO]          Busca usuarios por nombre, email o ID
PASSWORD                Cambiar contraseña de un usuario (modo interactivo)

Ejemplos:
  USERS LIST                    - Lista todos los usuarios
  USERS SELECT                  - Selección interactiva
  USERS SEARCH admin            - Busca usuarios que contengan "admin"
  USERS PASSWORD                - Cambiar contraseña (selección interactiva)

⚠️ ATENCIÓN: El cambio de contraseñas es una operación sensible.
Solo usuarios con rol de desarrollador pueden usar estos comandos.`;break;default:g=`Comando no reconocido: "${n}"
Escriba "HELP" para ver los comandos disponibles.`;break}return g&&this.addOutput(g),{success:!0}}catch(g){return console.error("Error al ejecutar comando:",g),this.addOutput(`Error: ${g.message}`,"error"),{success:!1,error:g}}}}const rae=()=>{const e=W(),n=Fe(),s=D(bb),o=D(q),r=D(Ku),i=D(Su),a=D(LS),c=D(zS),d=D(US),[u,p]=m.useState([]),[h,f]=m.useState(""),[x,g]=m.useState(!1),[y,b]=m.useState([]),v=m.useRef(null),[C,I]=m.useState([]),[j,k]=m.useState(!1),[A,P]=m.useState(-1),[w,S]=m.useState({active:!1,items:[],selectedIndex:0,onSelect:null,title:"",command:""}),[E,T]=m.useState([]),[R,N]=m.useState([]),G=(o==null?void 0:o.role)==="dev",Q=(L,H="result",ne=!1)=>{const pe={id:Date.now()+Math.random(),content:L,type:H,html:ne};p(ye=>[...ye,pe])},ae=L=>{const H={id:Date.now()+Math.random(),content:{prompt:"C:\\VentaMax>",userCommand:L},type:"command"};p(ne=>[...ne,H])},oe=(L,H,ne,pe="")=>{N(L),T(L),S({active:!0,items:L,selectedIndex:0,onSelect:ne,title:H,command:pe})},Z=L=>{if(w.active)if(console.log("Filtering with text:",L),console.log("Original items:",R),!L.trim())T(R),S(H=>({...H,items:R,selectedIndex:0})),console.log("Showing all items:",R);else{const H=R.filter(ne=>(typeof ne=="string"?ne:ne.name||ne.title||ne.label||String(ne)).toLowerCase().includes(L.toLowerCase()));T(H),S(ne=>({...ne,items:H,selectedIndex:0})),console.log("Filtered items:",H)}},J=L=>{S(H=>({...H,selectedIndex:L}))},X=()=>{S({active:!1,items:[],selectedIndex:0,onSelect:null,title:"",command:""}),N([]),T([]),f(""),window.selectItem=void 0,window.confirmSelection=void 0,setTimeout(()=>{const L=document.querySelector(".console-terminal input");L&&L.focus()},100)},me=()=>{const{items:L,selectedIndex:H,onSelect:ne}=w,pe=L[H];X(),ne&&ne(pe),setTimeout(()=>{const ye=document.querySelector(".console-terminal input");ye&&ye.focus()},150)},fe=L=>{if(!v.current)return;const H=v.current.getCommandSuggestions(L);I(H),k(H.length>0&&L.trim().length>0),P(-1)},se=L=>{f(L.command),k(!1),P(-1)},ee=L=>{P(L)};if(m.useEffect(()=>{fe(h)},[h]),m.useEffect(()=>{v.current=new oae({dispatch:e,navigate:n,user:o,isTestMode:r,isTemporaryMode:i,originalBusinessId:a,isTemporaryRoleMode:c,originalRole:d,addOutput:Q,addCommandEcho:ae,setReactScanLoaded:g,reactScanLoaded:x,setBusinesses:b,businesses:y,enterSelectionMode:oe})},[e,n,o,r,i,a,c,d,x,y]),m.useEffect(()=>{s.isOpen&&!G&&e(yn())},[s.isOpen,G,e]),m.useEffect(()=>{const L=H=>{s.isOpen&&B(H)};return s.isOpen&&document.addEventListener("keydown",L),()=>{document.removeEventListener("keydown",L)}},[s.isOpen]),!G)return null;const K=()=>{e(yn())},B=L=>{if(w.active){L.key==="Escape"&&(L.preventDefault(),L.stopPropagation(),X(),Q("Selección cancelada."));return}if(j&&C.length>0){if(L.key==="ArrowDown"){L.preventDefault();const H=A<C.length-1?A+1:0;P(H);return}if(L.key==="ArrowUp"){L.preventDefault();const H=A>0?A-1:C.length-1;P(H);return}if(L.key==="Tab"||L.key==="Enter"&&A>=0){if(L.preventDefault(),A>=0&&A<C.length){const H=C[A];se(H)}return}if(L.key==="Escape"){L.preventDefault(),k(!1),P(-1);return}}L.key==="Enter"&&(L.preventDefault(),j&&(k(!1),P(-1)),h.trim()&&v.current&&((async()=>{const ne=await v.current.executeCommand(h);ne&&ne.clearConsole&&p([])})(),f(""))),L.key==="l"&&L.ctrlKey&&(L.preventDefault(),p([]))};return t.jsxs(kie,{visible:s.isOpen,onClose:K,children:[t.jsx($ie,{title:"Consola de Desarrollador"}),t.jsxs(iae,{children:[w.active&&t.jsx(Xie,{active:w.active,items:w.items,selectedIndex:w.selectedIndex,title:w.title,command:w.command,onExitSelectionMode:X,onSelectionConfirm:me,onSelectIndex:J,consoleOutput:u,setConsoleOutput:p}),t.jsx(Vie,{consoleOutput:u,commandInput:h,setCommandInput:f,handleKeyDown:B,selectionMode:w,welcomeText:`
VentaMax Dev Console [Versión 1.5.0]
© 2024 VentaMax Software. Todos los derechos reservados.

ATENCIÓN: Esta consola está destinada exclusivamente para desarrolladores.
El uso incorrecto de estos comandos puede afectar el funcionamiento del sistema.

Escriba HELP para ver una lista de comandos disponibles.

`,autoCompleteSuggestions:C,showAutoComplete:j,autoCompleteSelectedIndex:A,onAutoCompleteSuggestionSelect:se,onAutoCompleteSelectedIndexChange:ee,onFilterSelection:Z})]})]})},iae=l.div`
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
`,aae=()=>{const e=_e.UPDATE.id,n=D($P),s=D(RP),o=D(NP),r=D(OP),i=D(xb),a=D(FP),c=D(MP),d=D(BP),u=D(Xu),p=D(cy),h=D(zP);return D(bb),t.jsxs(m.Fragment,{children:[t.jsxs(gt,{children:[n&&t.jsx(DX,{isOpen:n},"modal-add-client"),t.jsx(Cse,{},"modal-barcode-print"),t.jsx(hoe,{},"invoice-preview"),t.jsx(Jse,{},"sign-up-modal"),s&&t.jsx(wne,{isOpen:s},"modal-form-product"),t.jsx(hse,{data:h,onClose:DP},"modal-file-list"),t.jsx(ose,{},"modal-invoice"),o&&t.jsx(S_,{isOpen:o,handleOpen:Ru},"modal-set-custom-pizza"),r.isOpen&&t.jsx(ite,{isOpen:r.isOpen,mode:r.mode,addClientToCart:r.addClientToCart,data:r.mode===e?r.data:null},"modal-client"),t.jsx(Yoe,{},"modal-payment-form"),i.isOpen&&t.jsx(tZ,{isOpen:i.isOpen,mode:i.mode,data:i.mode===e?i.data:null},"modal-provider"),p.visible&&t.jsx(uZ,{},"notification"),t.jsx(lre,{},"modal-product-stock-form"),t.jsx(TZ,{isOpen:a.isOpen,categoryToUpdate:a.data},"modal-add-category"),d.isOpen&&t.jsx(QZ,{isOpen:d.isOpen,mode:u.mode},"modal-product-outflow"),c.isOpen&&t.jsx(nZ,{isOpen:c.isOpen,data:c.data},"modal-view-orders-notes"),t.jsx(jie,{},"modal-evidence-upload-drawer"),t.jsx(Aie,{},"modal-delete-product-stock"),t.jsx(rae,{},"modal-developer")]}),t.jsx(Aee,{}),t.jsx(sp,{}),t.jsx(fee,{}),t.jsx(Kre,{}),t.jsx(Jre,{}),t.jsx(tre,{}),t.jsx(hre,{}),t.jsx(jre,{}),t.jsx(kre,{}),t.jsx(Pv,{}),t.jsx(SZ,{}),t.jsx(fZ,{}),t.jsx(nee,{})]})};l.div`
    height: 0.6em;
    width: 1.2em;
    border-radius: 10px;
    background-color: ${e=>e.color};
`;const Xj=({title:e,children:n})=>t.jsx("abbr",{title:e,children:n}),cae=[{title:"Ir a Facturación",icon:t.jsx(O,{icon:vd}),onclick:e=>{e(kc())},align:"right",bgcolor:"primary"}],lae=()=>{const e=W();return t.jsx(dae,{children:t.jsx(uae,{children:cae.map((n,s)=>t.jsx(pae,{children:t.jsx(U,{icon:n.icon,onClick:()=>n.onclick(e),children:n.title})},s))})})},dae=l.div`   
    display: none;
    @media(max-width: 800px) {
        height: 3em;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.541);
        backdrop-filter: blur(10px);
        overflow: hidden;
        display: flex;
        z-index: 1;
        align-items: center;
    }
`,uae=l.ul`
     display: flex;
        width: 100%;
        list-style: none;
        justify-content: end;
        margin: 0;
        padding: 0.4em;
`,pae=l.li`
    ${e=>e.align==="right"?"justify-self: end;":""}
`;l.div`

`;l.div`
    padding: 2em;
`;l.div`
  
`;l.div`
    
`;l("div")`
    width: 32px;
    height: 32px;
    padding: 0.2em;
    display: flex;
    justify-content: center;
    align-items: center;      
    border-radius: 100px;
    background-color: white;
    
    border: 1px solid rgba(0, 0, 0, 0.307);
    svg{
        width: 1em;
        fill: rgba(31, 31, 31, 0.72);
    }
`;l.div`
    height: 2em;
    width: 2em;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #162b85;
    border-radius: 100px;
    svg{
        width: 1.1em;

        fill: #ffffff;
    }
`;l("div")`
    width: 32px;
    height: 32px;
    padding: 0.2em;
    display: flex;
    justify-content: center;
    align-items: center;      
    border-radius: 100px;
    background-color: white;
    
    border: 1px solid rgba(0, 0, 0, 0.307);
    svg{
        width: 1em;
        fill: rgba(31, 31, 31, 0.72);
        
    }
`;l.div`
    width: 1.5em;
    height: 32px;
    padding: 0.2em;
    display: flex;
    justify-content: center;
    align-items: center;      
    border: none;
    svg{
        width: 1em;
        fill: rgba(31, 31, 31, 0.72);
        margin-left: 2px;
    }
`;l.span`
  color: red;
  svg{
    font-size: 0.8em;
  }
  padding-left: 8px;

`;l.div`
    display: flex;
    `;l.div`
    position: relative;
    max-width: 300px;
    height: min-content;
    width: 100%;
`;l.div`
    width: 100%;
    display: flex;
    align-items: center;
    border: 1px solid rgba(0, 0, 0, 0.100);
    border-radius: var(--border-radius-light);
    background-color: var(--White);
    overflow: hidden;
    padding: 0 0 0 0.2em;
    transition-duration: 20s;
    transition-timing-function: ease-in-out;
    transition-property: all; 
`;l.div`
    min-width: 300px;
    width: 100%;
    max-height: 300px;
    height: 300px;
    position: absolute;
    z-index: 999999999999;
    background-color: #ffffff;
    overflow: hidden;
    border-radius: 6px;
    border: 1px solid rgba(0, 0, 0, 0.200);
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.200);
   
`;l.ul`
    z-index: 1;
    display: block;
    padding: 0;
    height: 100%;
    overflow-y: auto;
`;l.div`
    height: 2.2em;
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap:10px;
    transition: 1s display ease-in-out;
    padding-right: 0.5em;

    h3{
        margin: 0 0 0 10px;
        font-weight: 500;
        font-size: 1em;
        color: rgb(66, 66, 66);
        width: 100%;
        line-height: 1pc;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;  
        //white-space: nowrap;
        text-transform: uppercase;
        text-overflow: ellipsis;
        overflow: hidden;
    }
`;l.p`
        list-style: none;
        padding: 0 1em;
        display: flex;
        align-items: center;
        height: 2.4em;
    &:hover{
        background-color: var(--color);
        color: white;
    }

    ${e=>{if(e.selected)return`
                background-color: #4081d6;
                color: white;
            `}}

    
`;l.div`
 height: 1em;
 width: 0.8em;
 display: flex;
 align-items: center;
`;l.div`
    position: sticky;
    top: 0;
    padding: 0.2em;
    background-color: var(--White2);
    border-bottom: 1px solid rgba(0, 0, 0, 0.100);
`;l.div`
    padding: 1em;
`;l.label`
  font-size: 13px;
 color: var(--Gray5);
  margin-bottom: 4px;
  ${e=>{switch(e.labelVariant){case"primary":return`
        font-size: 11px;
        color: var(--Gray5);
        position: absolute;
        z-index: 1;
        background-color: white;
        padding: 0 4px;
        top: -5px;
        line-height: 1;
        height: min-content;
        color: #353535;
        font-weight: 600;
          ::after {
            content: ' :';
          }
        `;case"label2":return`
          font-size: 16px;
        color: black;
        margin-bottom: 10px;
        display: block;
        `;default:return`
        font-size: 13px;
        color: var(--Gray5);
        margin-bottom: 4px;
        `}}}
`;const mae=(e,n)=>{const s=e.toLowerCase().indexOf(n.toLowerCase());return n.length<2||s===-1?e:t.jsxs(t.Fragment,{children:[e.substring(0,s),t.jsx("span",{children:e.substring(s,s+n.length)}),e.substring(s+n.length)]})},hae=l.li`
    list-style: none;
    border: 2px solid ${e=>e.hasMissingName?"#ffd1d1":e.hasMissingID?"#fff5d6":e.isSelected?"#4096ff":"#eaeaea"};
    display: grid;
    grid-template-columns: 1fr min-content;
    gap: 1em;
    min-height: 75px;
    padding: 0.8em;
    align-items: start;
    margin: 0;
    font-size: 0.9rem;
    border-radius: 6px;
    background-color: ${e=>e.hasMissingName?"#fff5f5":e.hasMissingID?"#fffbeb":"#ffffff"};
  
    color: #2c3e50;
    cursor: pointer;
    transition: all 0.2s ease;
    /* box-shadow: ${e=>e.isSelected?"0 0 0 1px #1677ff":"0 1px 3px rgba(0,0,0,0.05)"}; */
    position: relative;
    
    @media (max-width: 700px) {
        min-height: auto;
        align-items: center;
    }
    
    &:hover {
        
        background-color: ${e=>e.isSelected?"#e6f4ff":e.hasMissingName?"#fff0f0":e.hasMissingID?"#fff7e0":"#f8f9fa"};
    }

    .highlight {
        container-type: inline-size;
        font-weight: 500;
        color: #2d3436;
    }

    .warning {
        font-weight: 500;
        font-size: 0.85rem;
    }

    .warning-name {
        color: #e74c3c;
    }

    .warning-id {
        color: #f39c12;
    }

    span.search-highlight {
        background-color: rgba(0, 62, 236, 0.1);
        border-radius: 2px;
        padding: 0 2px;
    }
`,gae=l.div`
    display: grid;
    align-items: start;
  
    grid-template-columns: minmax(150px, 2fr) minmax(110px, 1fr) minmax(130px, 1fr);
    gap: 0.8em;

    @media (max-width: 700px) {
        grid-template-columns: 1fr;
        gap: 0.3em;
        min-height: auto;
    }
    .client-name {
        font-size: 1em;
        line-height: 1.2;
        font-weight: 600;
        color: #3078bf;
        display: flex;
        gap: 1em;
        display: flex;
        justify-content: flex-start;
        min-height: 45px;
        
        @media (max-width: 700px) {
            min-height: auto;
        }
    }
    .client-detail {
        font-size: 1em;
        color: #4e4e4e;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        min-height: 45px;
        overflow: hidden;
        word-wrap: break-word;
       
        @media (max-width: 700px) {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 1em;
            min-height: auto;
        }
    }

    .warning {
        font-size: 1em;
        font-style: italic;
        &.warning-name {
            color: #e74c3c;
            font-weight: 500;
        }
        &.warning-id {
            color: #f39c12;
        }
    }
`,fae=l.div`
    display: flex;
    gap: 0.4em;
    align-self: start;
    padding-top: 0.5em;

    button {
        svg {
            font-size: 16px;
        }
    }
    
    @media (max-width: 700px) {
        align-self: center;
        padding-top: 0;
    }
`,KCe=({client:e,Close:n,updateClientMode:s,onDelete:o,searchTerm:r,selectedClient:i})=>{const a=W(),c=D(q),d=!e.name,u=!e.personalID,p=x=>{a(_b(x)),x.id&&c||a(Vu()),n()},h=x=>{x.stopPropagation(),s(e),n()},f=x=>{x.stopPropagation(),Ce.confirm({title:"¿Eliminar cliente?",icon:t.jsx(Is,{}),content:"¿Estás seguro que deseas eliminar este cliente? Esta acción no se puede deshacer.",okText:"Sí, eliminar",cancelText:"No, cancelar",okButtonProps:{danger:!0},zIndex:1e7,onOk:()=>{o(e==null?void 0:e.id)}})};return t.jsxs(hae,{onClick:()=>p(e),hasMissingName:d,hasMissingID:u,isSelected:(i==null?void 0:i.id)===e.id,children:[t.jsxs(gae,{children:[t.jsxs("div",{className:"client-name",children:[t.jsxs("div",{style:{color:"#5a5a5a",fontWeight:"400",whiteSpace:"nowrap"},children:[" # ",e.numberId]}),e.name?t.jsx("div",{children:mae(e.name,r)}):t.jsx("span",{className:"warning warning-name",children:"Nombre no disponible"})]}),t.jsx("div",{className:"client-detail",children:e.personalID?t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{fontSize:"0.9em",fontWeight:600},children:"RNC/Cédula :"}),t.jsx("div",{children:e.personalID})]}):t.jsx(Ge,{color:"red",children:"Sin identificación"})}),t.jsx("div",{className:"client-detail",children:e.tel?t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{fontSize:"0.9em",fontWeight:600},children:"Tel:"}),t.jsx("div",{children:e.tel})]}):t.jsx(Ge,{color:"red",children:"Sin teléfono"})})]}),t.jsxs(fae,{children:[t.jsx(Oe,{title:"Editar Cliente",children:t.jsx(U,{size:"small",variant:"text",color:"gray",icon:t.jsx(O,{icon:Cd}),onClick:h})}),t.jsx(Oe,{title:"Eliminar Cliente",children:t.jsx(U,{size:"small",color:"red",variant:"text",icon:t.jsx(O,{icon:ec}),onClick:f})})]})]})};l(Ie.ul)`
    position: relative;
    display: grid; 
    padding: 0;
    gap: 0.7em;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));

    ${e=>{switch(e.padding){case"bottom":return`
                    padding-bottom: 2.75em;
                `;default:return""}}}

    ${e=>{switch(e.isRow){case!0:return`
                    grid-template-columns: 1fr;
                    transition: all 400ms ease-in-out;
                `;default:return""}}}
`;l.div`
   width: 100%;
   display: flex;
   justify-content: center;
   padding: 0 1em;
   label{
    text-align: center;
    color: white;
    letter-spacing: 0.8pt;
    font-weight: 700;
    border-radius: 100px;
    max-width: 800px;
    width: 100%;
    min-width: 200px;
    padding: 0.4em 1em;
    background-color: rgb(227, 81, 81);

  }
`;const{BASIC_TERM:xae}=re,{HOME:bae,WELCOME:yae}=xae,vae=[{path:yae,element:t.jsx(DG,{}),isPublic:!0},{path:bae,element:t.jsx(i2,{}),title:"Dashboard - Ventamax",metaDescription:"Resumen de estadísticas, accesos rápidos y actividades recientes en Ventamax POS."}],jae="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4NCiAgPGRlZnM+DQogICAgPHN0eWxlPg0KICAgICAgLmNscy0xIHsNCiAgICAgICAgc3Ryb2tlOiAjNDJhNWY1Ow0KICAgICAgICBzdHJva2Utd2lkdGg6IDJweDsNCiAgICAgIH0NCg0KICAgICAgLmNscy0yIHsNCiAgICAgICAgZm9udC1zaXplOiA1MS4xNnB4Ow0KICAgICAgICBmaWxsOiAjNDJhNWY1Ow0KICAgICAgICBmb250LWZhbWlseTogQXJpYWw7DQogICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7DQogICAgICB9DQogICAgPC9zdHlsZT4NCiAgPC9kZWZzPg0KICA8Y2lyY2xlIGlkPSJFbGlwc2VfMSIgZGF0YS1uYW1lPSJFbGlwc2UgMSIgY2xhc3M9ImNscy0xIiBjeD0iMzEuNzgxIiBjeT0iMzIuMjE5IiByPSIyOS44MTMiLz4NCiAgPHRleHQgaWQ9IlYiIGNsYXNzPSJjbHMtMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTQuNzI4IDUwLjc2Mykgc2NhbGUoMC45NzcpIj5WPC90ZXh0Pg0KPC9zdmc+DQo=",Cp=({size:e="medium"})=>t.jsx(Cae,{src:jae,size:e,alt:""}),Xi={xsmall:"1.5rem",small:"3rem",medium:"5rem",large:"6rem",xlarge:"10rem",xxlarge:"12rem"},Cae=l.img`
  display: block !important;
  height: ${e=>e.size?Xi[e.size]:Xi.medium} !important;
  width: ${e=>e.size?Xi[e.size]:Xi.medium} !important;
`,wae=()=>t.jsxs(Sae,{children:[t.jsxs(Eae,{children:[t.jsxs(Iae,{children:[t.jsx(Aae,{level:4,children:"Facturación en Línea"}),t.jsx(kae,{children:t.jsx(Cp,{})})]}),t.jsx(Tae,{children:"VENTAMAX"})]}),t.jsx(Dae,{children:"Bienvenido"}),t.jsx(Pae,{children:"Lleva tu negocio siguiente nivel con nuestro sistema de punto de facturación fácil de utilizar y muy rápido."})]}),Sae=l.div`
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    margin-bottom: 1em;
    width: 100%;
`,Iae=l.div`
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 0.5em;
    width: fit-content;
`,Eae=l.div`
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    margin-bottom: 1em;
`,Aae=l.div`
    white-space: nowrap;
    margin: 0 !important;
    font-size: 1.2em !important;
    padding: 0.4em 1.2em;
    padding-right: 3em;
    background-color: var(--color);
    color: white !important;
    border-radius: 40px 0px 0px 40px;
    position: absolute;
    right: 3em;
    
    @media (max-width: 900px){
        padding-right: 2em;
    }
    @media (max-width: 800px){
        display: none;
    }
`,kae=l.div`
    z-index: 2;
    display: flex;
    justify-content: center;
`,Tae=l.span`
    font-size: 1.5em;
    margin: 0em 0;
    font-weight: 700;
    text-align: center;
    color: white;
    letter-spacing: 1px;
`,Pae=l.div`
    font-size: 1.1em;
    color: white;
    @media (max-width: 600px){
        text-align:  center;
    }
`,Dae=l.div`
    color: var(--color) !important;
    font-size: 2em !important; // Adjust the font size as needed
    font-weight: 600 !important;
    margin: 0em 0 1em;
    @media (max-width: 600px){
        text-align:  center;
    }
`,Zj=60*24*60*60*1e3,e1=60*24*60*60*1e3,$ae=55*24*60*60*1e3,Rae=5*60*1e3,Nae=15*60*1e3,Oae=5,Mae=2*60*60*1e3;async function Fae(e){const n=le($,"users");console.log(e);const s=he(n,te("user.name","==",e.name)),o=await Me(s);if(o.empty)throw new Error("Error: No se encontró el usuario");return o.docs[0]}async function Bae(e,n){if(e.lockUntil&&n<e.lockUntil)throw new Error("This account has been temporarily locked due to too many failed login attempts. Please try again later.")}async function Lae(e,n){const s=await Wo.compare(e.password,n.password);if(!s)throw new Error("Error: Contraseña incorrecta");return s}async function zae(e,n,s,o){let r=s?{"user.loginAttempts":0,"user.lockUntil":null}:{"user.loginAttempts":fn(1)};!s&&n.loginAttempts+1>=Oae&&(r["user.lockUntil"]=o+Mae),await je(e.ref,r)}async function Uae(e){try{const n=le($,"sessionTokens"),s=he(n,te("userId","==",e)),o=await Me(s),r=ue.fromMillis(ue.now().toMillis()-e1),i=o.docs.filter(a=>{const c=a.data();return!c.expiresAt||c.expiresAt.toMillis()<r.toMillis()}).map(a=>Ot(a.ref));await Promise.all(i)}catch(n){console.error("Error limpiando tokens antiguos:",n)}}async function Wae(e,n){const s=ue.now(),o=ue.fromMillis(s.toMillis()+Zj),r=`${e.name}_${s.toMillis()}`;await Uae(n.id),await De(F($,"sessionTokens",r),{userId:n.id,expiresAt:o,createdAt:de(),lastActivity:de()}),localStorage.setItem("sessionToken",r),localStorage.setItem("sessionExpires",o.toMillis().toString())}function qae(e,n){e(bc({uid:n.id,displayName:n.name}))}const Vae=async e=>{try{const n=await Fae(e),s=n.data().user,o=Date.now();Bae(s,o);const r=await Lae(e,s);return await zae(n,s,r,o),await Wae(e,n),s}catch(n){throw new Error(n.message)}},Gae=l.div`
   padding: 0 1em;
   width: 100%;
   justify-content: center;
   align-items: center;
   height: 100vh;
   display: flex;
`,_ae=l.div`
   max-width: 450px;
   width: 100%;
   background-color: #4d4d4d;
   border-radius: 1em;
   padding: 0 1em;
`,Hae=l.div`
   margin: 0rem 0;
`,Qae=l(M)`
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: white;
    height: 100%;
    gap: 16;
   
    label {
        color: white !important;
        font-weight: 500;
    }
   
    .ant-btn {
        border-radius: 8px;
        height: 48px;
        margin-top: 1rem;
    }
`,Yae=({setLoading:e=null})=>{const n=W(),s=Fe(),[o]=M.useForm(),r=async({username:i,password:a})=>{e(!0);try{const c=await Vae({name:i,password:a});qae(n,c),s(re.BASIC_TERM.HOME),Be.success({message:"Inicio de sesión exitoso",description:"¡Bienvenido!"})}catch(c){Be.error({message:"Error",description:c.message})}finally{e(!1)}};return t.jsx(Gae,{children:t.jsx(_ae,{children:t.jsxs(Qae,{autoComplete:"off",form:o,layout:"vertical",onFinish:r,children:[t.jsx(wae,{}),t.jsxs(Hae,{children:[t.jsx(M.Item,{name:"username",label:"Usuario",autoComplete:"off",rules:[{required:!0,message:"Por favor ingresa tu nombre de usuario!"}],children:t.jsx(ie,{size:"large",prefix:t.jsx(dc,{className:"site-form-item-icon"}),placeholder:"Usuario",autoComplete:"off"})}),t.jsx(M.Item,{name:"password",label:"Contraseña",rules:[{required:!0,message:"Por favor ingresa tu contraseña!"}],children:t.jsx(ie.Password,{size:"large",prefix:t.jsx(n0,{}),type:"password",autoComplete:"new-password",placeholder:"Contraseña"})})]}),t.jsx(U,{type:"primary",htmlType:"submit",size:"large",style:{width:"100%"},children:"Iniciar sesión"})]})})})},Kae=()=>{const e=Fe(),[n,s]=m.useState(!1),[o,r]=m.useState(null),[i,a]=m.useState(!0),[c,d]=m.useState(!1),u=m.useRef(null),p=D(q),h="/home",f=async()=>{a(!0),d(!1),r(null);try{const y=In(Ts,"app-config/login-image"),b=await ua(y);if(b.items.length>0){const v=await Ss(b.items[0]);r(v)}else a(!1)}catch(y){console.error("Error al cargar la imagen de login:",y),a(!1)}};m.useEffect(()=>{f()},[]),m.useEffect(()=>{o&&(a(!0),d(!1))},[o]),m.useEffect(()=>{u.current&&u.current.complete&&u.current.naturalWidth>0&&(d(!0),a(!1))},[o]),m.useEffect(()=>{if(!p)return;const y=localStorage.getItem("sessionToken"),b=localStorage.getItem("sessionExpires");(p||y&&b&&Date.now()<Number(b))&&e(h,{replace:!0})},[p,e]);const x=()=>e("/"),g={hidden:{opacity:0,scale:.95},visible:{opacity:1,scale:1,transition:{duration:.5}}};return t.jsx("div",{style:{position:"relative",height:"100vh",width:"100vw"},children:t.jsx(He,{spinning:n,tip:"Cargando...",size:"large",children:t.jsx(Jae,{children:t.jsxs(nce,{children:[t.jsxs(ece,{children:[t.jsx(Xae,{icon:z.arrows.arrowLeft,onClick:x,children:"Volver"}),o&&t.jsxs(Ie.div,{initial:"hidden",animate:c?"visible":"hidden",variants:g,style:{height:"100%",position:"relative"},children:[i&&t.jsx(Bp.Image,{style:{position:"absolute",inset:0,width:"100%",height:"100%",borderRadius:"1em",objectFit:"cover",zIndex:1},active:!0}),t.jsx(Zae,{children:t.jsx("img",{ref:u,src:o,alt:"Login visual",onLoad:()=>{d(!0),a(!1)},onError:()=>{console.error("No se pudo cargar la imagen:",o),r(null),a(!1)},style:{visibility:c?"visible":"hidden"}})})]},o),!o&&i&&t.jsx(Bp.Image,{style:{width:"100%",height:"100%",borderRadius:"1em",objectFit:"cover"},active:!0}),!o&&!i&&t.jsx(tce,{children:"No hay imagen de fondo disponible."})]}),t.jsx(Yae,{setLoading:s})]})})})})},Jae=l.div`
  background-color: #4d4d4d;
  height: 100vh;
  overflow-y: auto;
`,Xae=l(U)`
  position: absolute;
  cursor: pointer;
  display: flex;
  top: 2em;
  left: 2em;
  align-items: center;
  z-index: 10;
  gap: 0.5em;
`,Zae=l.div`
  height: 100%;
  overflow: hidden;
  border-radius: 1em;

  img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
`,ece=l.div`
  padding: 1em;
  height: 100vh;
  max-height: 800px;
  position: relative;
  padding-right: 0;

  @media (max-width: 800px) {
    display: none;
  }
`,tce=l.div`
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px dashed #777;
  border-radius: 1em;
  color: #ccc;
  background: rgba(0, 0, 0, 0.2);
`,nce=l.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
  max-width: 1366px;
  max-height: 800px;
  height: 100vh;
  margin: 0 auto;

  @media (max-width: 1000px) {
    grid-template-columns: 1fr 1fr;
  }

  @media (max-width: 800px) {
    grid-template-columns: 1fr;
    justify-content: center;
    justify-items: center;
  }
`,{LOGIN:sce}=re.AUTH_TERM,oce=[{path:sce,element:t.jsx(Kae,{}),isPublic:!0}],Gf=async(e,n)=>{if(!(e!=null&&e.businessID)||!(n!=null&&n.id))return;const s=F($,"businesses",e.businessID,"productOutflow",n.id),o=F($,"users",e.uid);try{const r=await Se(s);if(!r.exists()){console.log("Documento no existe, no se puede ajustar el stock ni eliminar.");return}const i=r.data();if(i.productList&&i.productList.length>0){const a=i.productList.map(c=>({product:c.product,quantityRemoved:c.quantityRemoved}));await bp(e,a)}await je(s,{isDeleted:!0,deletedAt:de(),deleteBy:o,updatedAt:de()}),console.log("Documento eliminado y stock ajustado correctamente.")}catch(r){console.error("Error al eliminar la salida de producto:",r)}},rce=({user:e,setOutflowList:n,setOutflowListLoader:s,dispatch:o})=>{if(!(e!=null&&e.businessID))return;const r=le($,"businesses",e.businessID,"productOutflow"),i=he(r,te("isDeleted","!=",!0));s(!0),Te(i,a=>{if(a.empty){n([]),s(!1);return}const c=a.docs.map(d=>d.data());n(c),setTimeout(()=>{s(!1)},1e3)},a=>{console.error("Error al leer de Firestore: ",a)})},ice=[],t1={id:null,product:null,motive:"",quantity:0,observations:"",status:!1};class ace{constructor({mode:n,productSelected:s,data:o}){this.mode=n||_e.CREATE.id,this.productSelected=s||t1,this.data={id:o&&(o==null?void 0:o.id)!=null?o.id:null,productList:o&&(o!=null&&o.productList)?o.productList:ice,date:o&&o.date?o.date:null}}}class cce{constructor(n){const{id:s,productList:o,date:r}=n;this.id=s,this.productList=o,this.date=r}}const lce=({data:e,mode:n,dispatch:s})=>{s(wc());const o=new ace({mode:n,EmptyProduct:t1,data:e});s(by({data:o}))},dce=()=>{const e=W(),n=()=>{e(wc())};return t.jsxs("span",{children:[t.jsx(Ze,{sectionName:"Salida de Producto"}),t.jsx(uce,{children:t.jsxs(pce,{children:[t.jsx(nt,{type:"subtitle",value:"Registro de salida de productos"}),t.jsx(ke,{"aria-label":"Nueva Salida",bgcolor:"primary",title:"Nueva Salida",borderRadius:"normal",onClick:n})]})})]})},uce=l.div`
background-color: var(--White);

width: 100%;
padding: 16px;
`,pce=l.div`
max-width: 1000px;
width: 100%;
margin: 0 auto;

display: grid;
align-items: center;
grid-template-columns: 1fr auto;
`;l.h2`
  margin: 0;
    font-size: 1.1rem;
`;const mce=()=>{const e=W(),n=m.useRef(null),[s,o]=m.useState([]),r=D(Xu),[i,a]=m.useState(!0),c=Bj(n),d=D(q),u=()=>{e(wc())},p=async h=>{try{await Gf(d,h),Be.success({message:"Salida de producto eliminada"})}catch{Be.error({message:"Error al eliminar la salida de producto"})}};return m.useEffect(()=>{const h=s.find(f=>(f==null?void 0:f.productList.length)===0);h&&Gf(h.id)},[s]),m.useEffect(()=>{r.mode===_e.UPDATE.id&&s.forEach(h=>{h.id===r.data.id&&e(by({data:h}))})},[s]),m.useEffect(()=>{rce({user:d,setOutflowList:o,setOutflowListLoader:a,dispatch:e})},[d]),t.jsxs(hce,{children:[t.jsx(dce,{}),t.jsxs(gce,{ref:n,children:[t.jsxs(xce,{isScrolled:c,children:[t.jsx(nt,{type:"subtitle-table",value:"#"}),t.jsx(nt,{type:"subtitle-table",value:"Fechas"}),t.jsx(nt,{type:"subtitle-table",value:"Cantidad de productos"}),t.jsx(nt,{type:"subtitle-table",value:"Acción"})]}),t.jsxs(fce,{children:[t.jsx(sp,{theme:"light",useRedux:!1,show:i,message:"Cargando lista de salidas de productos"}),i?null:s.length>0?s.sort((h,f)=>h.createdAt-f.createdAt).reverse().map((h,f)=>t.jsxs(bce,{children:[t.jsx(nt,{type:"number",value:s.length-f}),Ve.formatLuxonDate(Ve.convertTimestampToMillis(h==null?void 0:h.createdAt)),t.jsx("span",{children:t.jsx(nt,{type:"number",value:h.productList.reduce((x,g)=>x+Number(g==null?void 0:g.quantityRemoved),0)})}),t.jsxs(mi,{children:[t.jsx(U,{icon:z.operationModes.edit,onClick:()=>lce({mode:_e.UPDATE.label,data:new cce(h),dispatch:e})}),t.jsx(U,{icon:z.operationModes.delete,borderRadius:"normal",danger:!0,onClick:()=>p(h)})]})]},h.id)):t.jsx(si,{text:"Crea un nuevo registro de salida de productos",buttonText:"Nueva Salida",handleAction:u})]})]})]})},hce=l.div`
  display: grid;
  grid-template-rows: min-content auto 1fr;
  grid-gap: 16px;
  height: 100vh;
  background-color: var(--color2);
`,gce=l.div`
max-width: 1000px;
width: 100%;
overflow-y: scroll;
margin: 0 auto;
height: calc(100vh - 200px);
background-color: aliceblue;
border: 1px solid rgba(0, 0, 0, 0.0100);
border-radius: var(--border-radius);
background-color: var(--White);
position: relative;


`,fce=l.div`
  display: grid;
  height: calc(100% - 2.6em);
  align-content: flex-start;


`,xce=l.div`
  display: grid;
  grid-template-columns: 6em 1fr 1fr 5em;
  align-items: center;
  background-color: var(--White);

  padding: 8px;
  font-size: 14px;
  font-weight: bold;
  position: sticky;
    top: 0;
    border: 1px solid rgba(0, 0, 0, 0.000);
    transition: all 0.2s linear;
    ${({isScrolled:e})=>e&&`
    border-bottom: 1px solid rgba(0, 0, 0, 0.100);
    background-color: #ffffffdf;
    backdrop-filter: blur(10px);
    `}
  
`;l.div``;const bce=l.div`
  display: grid;
  grid-template-columns: 6em  1fr 1fr 5em;
  align-items: center;
  border-radius: 4px;
  padding: 8px;
  font-size: 14px;
  transition: all 0.2s linear;
  :hover{
    background-color: #f5f5f5;
  }
`,yce=l.div`
    display: grid;
    grid-template-columns: auto 1fr;
    height: 100%;
   

    overflow-y: hidden;
    
`,vce=l.div`
   display: flex;
   flex-direction: column;
   overflow-y: auto;
  /* background-color: #ffffff; */

  padding: 1em 0.4em;
  height: 100%;
`,jce=l.div`
  display: flex;
  flex-direction: column;
  height: 100%; /* Asegura que el contenedor de redimensionado ocupe el 100% de la altura */
  overflow-y: auto;



`,Cce=({Sidebar:e,children:n})=>t.jsxs(yce,{children:[t.jsx(jce,{children:e}),t.jsx(vce,{children:n})]}),wce=()=>{const e=D(q),[n,s]=m.useState([]),[o,r]=m.useState({}),[i,a]=m.useState({}),[c,d]=m.useState({}),[u,p]=m.useState({}),[h,f]=m.useState(!0),[x,g]=m.useState({}),[y,b]=m.useState({}),[v,C]=m.useState({}),[I,j]=m.useState(null),[k,A]=m.useState(null),[P,w]=m.useState([]),[S,E]=m.useState([]),[T,R]=m.useState([]),[N,G]=m.useState([]);m.useEffect(()=>{if(!(e!=null&&e.businessID))return;k&&k(),f(!0);const Z=YB(e,J=>{s(J),f(!1)});return A(()=>Z),()=>{Z&&Z()}},[e]),m.useEffect(()=>{P.forEach(J=>J()),w([]);const Z=[];return n.forEach(J=>{g(me=>({...me,[J.id]:!0}));const X=ure(e,J.id,me=>{r(fe=>({...fe,[J.id]:me})),g(fe=>({...fe,[J.id]:!1}))},me=>{j(me),g(fe=>({...fe,[J.id]:!1}))});Z.push(X)}),w(Z),()=>{Z.forEach(J=>J())}},[n,e]),m.useEffect(()=>{S.forEach(J=>J()),E([]);const Z=[];return Object.keys(o).forEach(J=>{o[J].forEach(X=>{b(fe=>({...fe,[X.id]:!0}));const me=fre(e,J,X.id,fe=>{a(se=>({...se,[X.id]:fe})),b(se=>({...se,[X.id]:!1}))},fe=>{j(fe),b(se=>({...se,[X.id]:!1}))});Z.push(me)})}),E(Z),()=>{Z.forEach(J=>J())}},[o,e]),m.useEffect(()=>{T.forEach(J=>J()),R([]);const Z=[];return Object.keys(i).forEach(J=>{i[J].forEach(X=>{C(fe=>({...fe,[X.id]:!0}));const me=wre(e,X.warehouseId,X.shelfId,X.id,fe=>{d(se=>({...se,[X.id]:fe})),C(se=>({...se,[X.id]:!1}))});Z.push(me)})}),R(Z),()=>{Z.forEach(J=>J())}},[i,e]),m.useEffect(()=>{N.forEach(J=>J()),G([]);const Z=[];return n.forEach(J=>{const X=Jd(e,{id:J.id,type:"warehouse"},me=>{p(fe=>({...fe,[J.id]:me}))});Z.push(X)}),Object.keys(o).forEach(J=>{o[J].forEach(X=>{const me=Jd(e,{id:X.id,type:"shelf"},fe=>{p(se=>({...se,[X.id]:fe}))});Z.push(me)})}),G(Z),()=>{Z.forEach(J=>J())}},[n,o,i,c,e]);const Q=()=>n.map(Z=>{const J=o[Z.id]||[];return{...Z,productStock:u[Z.id]||[],shelves:J.map(X=>{const me=i[X.id]||[];return{...X,productStock:u[X.id]||[],rows:me.map(fe=>{const se=c[fe.id]||[];return{...fe,productStock:u[fe.id]||[],segments:se.map(ee=>({...ee,productStock:u[ee.id]||[]}))}})}})}}),ae=m.useMemo(()=>Q(),[n,o,i,c,u]),oe=h||Object.values(x).some(Boolean)||Object.values(y).some(Boolean)||Object.values(v).some(Boolean);return{data:ae,loading:oe,error:I}},n1=()=>{const{data:e,loading:n,error:s}=wce(),o=i=>i.map(a=>{var c;return{id:a.id,name:a.name,children:(c=a.shelves)==null?void 0:c.map(d=>{var u;return{id:d.id,name:d.name,children:(u=d.rows)==null?void 0:u.map(p=>{var h;return{id:p.id,name:p.name,children:(h=p.segments)==null?void 0:h.map(f=>({id:f.id,name:f.name}))}})}})}});return{data:m.useMemo(()=>o(e),[e]),loading:n,error:s}},Sce=l(Xx)`
  margin-bottom: 16px;
`,Ice=l.span`
  cursor: pointer;
  color: #1890ff;
`,Ece=({breadcrumbs:e})=>{const n=W();return e.length>0?t.jsx(Sce,{children:e.map((s,o)=>t.jsx(Xx.Item,{children:t.jsx(Ice,{onClick:()=>n(vN(o)),children:s.title})},o))}):null},zc=(e,n,s=[],o=!1,r)=>{if(!e)return!1;const i=String(e.name||"").toLowerCase(),a=String(n||"").toLowerCase();let c=!1;return i.includes(a)?(s.forEach(d=>r.add(d)),r.add(e.id),c=!0):r.delete(e.id),e.children&&e.children.forEach(d=>{zc(d,n,[...s,e.id],o,r)?(s.forEach(p=>r.add(p)),r.add(e.id),c=!0):r.delete(d.id)}),c},Ace=(e,n)=>{const s=n.toLowerCase();return(e.productStock||[]).filter(o=>{var r;return(r=o.productName)==null?void 0:r.toLowerCase().includes(s)})},ru=(e,n,s)=>{if(!n)return e;const o=n.toLowerCase();return e.reduce((r,i)=>{var u;const a=(u=i.name)==null?void 0:u.toLowerCase().includes(o),c=Ace(i,n),d=ru(i.children||[],n,s);return(a||c.length>0||d.length>0)&&r.push({...i,...a&&s.showMatchedStockCount&&{matchedStockCount:c.length},children:d}),r},[])},kce=(e,n,s,o)=>{const r=new Set;e&&n.forEach(a=>s(a,e,[],!1,r));const i={};r.forEach(a=>{i[a]=!0}),o(i)},Tce=l.div`
  display: flex;
  align-items: center;
  margin-bottom: 10px;
`,Pce=({searchTerm:e,setSearchTerm:n,allExpanded:s,handleToggleAll:o})=>t.jsxs(Tce,{children:[t.jsx(ie,{placeholder:"Buscar por nombre o producto...",value:e,onChange:r=>n(r.target.value),prefix:t.jsx(Kr,{}),style:{marginRight:"10px",flex:1}}),t.jsx(U,{onClick:o,icon:s?t.jsx(c0,{}):t.jsx(l0,{}),type:"text"})]}),Dce=l.div`
  display: grid;
  overflow-x: hidden;
  overflow-y: auto;
  align-content: start;
  width: 100%;
`,$ce=({children:e,filteredData:n,selectedId:s,renderTree:o})=>n.length>0?t.jsx(Dce,{children:e}):s?t.jsx(Lt,{description:"Sin selección"}):t.jsx(Lt,{description:"No se encontraron elementos"}),Rce=({nodeId:e,node:n,level:s,config:o,selectedNode:r,setSelectedNode:i,setExpandedNodes:a,onNodeClick:c})=>{var u;if((u=o.disabledNodes)!=null&&u.includes(e))return;r===e?a(p=>({...p,[e]:!p[e]})):(i(e),a(p=>({...p,[e]:!0}))),c&&c(n,s)},Nce=l(O)`
  font-size: 0.6em;
`,Oce=({hasChildren:e,isExpanded:n,getNodeIcon:s,isLoading:o})=>e?t.jsx(O,{icon:n?Do:Zs}):t.jsx(Nce,{icon:s(),spin:o}),Mce=l.button`
  background: none;
  border: none;
  display: flex;
  padding: 0;
  width: 1.4em;
  justify-content: center;
  cursor: pointer;

  &:hover {
    color: #0056b3;
  }
`,Fce=({node:e,isExpanded:n,isSelected:s,hasChildren:o,setExpandedNodes:r,getNodeIcon:i})=>t.jsx(Mce,{children:t.jsx(Oce,{getNodeIcon:i,isExpanded:n,isSelected:s,hasChildren:o,isLoading:e.isLoading})}),Bce=l.div`
 margin-left: 8px;
   white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
 flex: 1;
  min-width: 0;
  /* background-color: black; */
  padding-right: 8px;
`,wp=({title:e,isMatch:n,children:s,isLoading:o,searchTerm:r,config:i,matchedStockCount:a,renderHighlightedText:c})=>{const d=()=>o?"Cargando":r?c(e,r):e,u=()=>!(i!=null&&i.showMatchedStockCount)||!a?null:` (${a} producto(s) encontrado(s))`;return t.jsxs(Bce,{title:e,isMatch:n,children:[d(),u()]})};wp.propTypes={title:we.string.isRequired,isMatch:we.bool,children:we.node,isLoading:we.bool,searchTerm:we.string,config:we.object,matchedStockCount:we.number,renderHighlightedText:we.func};wp.defaultProps={isMatch:!1,isLoading:!1,matchedStockCount:0};const Lce=l.div`
  display: flex;
  align-items: center;
`,zce=l.div`
  width: 15px;
  height: 40px;
  border-right: 1px solid #e0e0e0;
  display: inline-block;
`,Uce=({level:e})=>t.jsx(Lce,{children:Array(e).fill(null).map((n,s)=>t.jsx(zce,{},s))}),Wce=l.div`
  display: flex;
  align-items: center;
  margin-left: auto;
  flex-shrink: 0;
  position: relative;
  z-index: 1;
  background: inherit;
`,_f=l.button`
  background: none;
  border: none;
  display: flex;
  cursor: pointer;
  margin-left: 5px;

  &:hover {
    color: #0056b3;
  }
`,s1=({node:e,actions:n,level:s,path:o})=>t.jsx(Wce,{children:n.map(r=>{if(r.show&&!r.show(e,s))return null;if(r.type==="button")return t.jsx(_f,{onClick:i=>{i.stopPropagation(),r.handler(e,s,o)},title:r.name,children:t.jsx(O,{icon:r.icon})},r.name);if(r.type==="dropdown"){const i=typeof r.items=="function"?r.items(e,s,o):r.items;return t.jsx(Qs,{overlay:t.jsx(Lp,{children:i.map(a=>t.jsxs(Lp.Item,{onClick:c=>{c.domEvent.stopPropagation(),a.handler(e,s,o)},danger:a.name.toLowerCase().includes("eliminar"),children:[t.jsx(O,{icon:a.icon,style:{marginRight:"5px"}}),a.name]},a.name))}),trigger:["click"],children:t.jsx(_f,{onClick:a=>a.stopPropagation(),title:r.name,children:t.jsx(O,{icon:r.icon})})},r.name)}return null})});s1.propTypes={actions:we.arrayOf(we.shape({name:we.string.isRequired,type:we.oneOf(["button","dropdown"]).isRequired,icon:we.object.isRequired,handler:we.func.isRequired,show:we.func,items:we.oneOfType([we.arrayOf(we.shape({name:we.string.isRequired,icon:we.object.isRequired,handler:we.func.isRequired})),we.func])})).isRequired,node:we.object.isRequired,level:we.number.isRequired,path:we.array};const qce=({isLoading:e})=>e?t.jsx(O,{icon:An,spin:!0,style:{marginLeft:"5px"}}):null,Vce=l.div`
  display: grid;
  grid-template-columns: min-content 1fr min-content;
  align-items: center;
  margin: 0;
  padding: 0 0.2em;
  border-radius: 6px;
  background-color: ${e=>e.isSelected?"#e9e9e9":"transparent"};
  cursor: pointer; // Replace the 'not-allowed' logic
  opacity: 1; // Remove the disabled opacity
  height: 40px;
  position: relative;
  width: 100%;
  overflow: hidden;

  &:hover {
    background-color: ${e=>!e.disabled&&(e.isSelected,"#f0f0f0")};
  }

  &::after {
    content: "";
    position: absolute;
    right: 35px;
    top: 0;
    height: 100%;
    width: 20px;
    background: linear-gradient(
      to right,
      transparent,
      ${e=>e.isSelected?"#e9e9e9":"white"}
    );
    pointer-events: none;
  }

  &:hover::after {
    background: linear-gradient(to right, transparent, #f0f0f0);
  }
`,o1=m.memo(({node:e,level:n,expandedNodes:s,setExpandedNodes:o,searchTerm:r,selectedNode:i,setSelectedNode:a,config:c,traverse:d,renderHighlightedText:u,path:p,onToggleNode:h})=>{var C,I;const f=s[e.id]||!1,x=!!((C=e.children)!=null&&C.length),g=i===e.id;(I=c.disabledNodes)==null||I.includes(e.id);const y=m.useMemo(()=>e.name.toLowerCase().includes(r.toLowerCase())||e.productStock&&e.productStock.some(j=>j.productName.toLowerCase().includes(r.toLowerCase())),[e.name,e.productStock,r]),b=m.useCallback(()=>e.isLoading?An:x?null:Iw,[e.isLoading,x]),v=m.useCallback(j=>{j.preventDefault(),j.stopPropagation(),x&&!e.isLoading&&h(e.id)},[x,e.id,e.isLoading,h]);return t.jsxs("div",{children:[t.jsxs(Vce,{isSelected:g,onClick:()=>Rce({nodeId:e.id,node:e,level:n,config:c,selectedNode:i,setSelectedNode:a,setExpandedNodes:o,onNodeClick:c.onNodeClick}),children:[t.jsx(Uce,{level:n}),t.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1,minWidth:0,marginRight:8},children:[t.jsx(Fce,{getNodeIcon:b,isExpanded:f,isSelected:g,hasChildren:x,isLoading:e.isLoading,node:e,setExpandedNodes:o,onToggleNode:h,onClick:v}),t.jsx(wp,{title:e.name,isMatch:y,children:e.children,isLoading:e.isLoading,searchTerm:r,config:c,matchedStockCount:e.matchedStockCount,renderHighlightedText:u}),t.jsx(qce,{isLoading:e.isLoading})]}),t.jsx(s1,{node:e,actions:c.actions,level:n,path:p})," "]}),f&&x&&e.children.map(j=>t.jsx(o1,{node:j,level:n+1,expandedNodes:s,setExpandedNodes:o,searchTerm:r,selectedNode:i,setSelectedNode:a,config:c,traverse:d,renderHighlightedText:u,path:p,onToggleNode:h},j.id))]})},(e,n)=>e.node===n.node&&e.expandedNodes[e.node.id]===n.expandedNodes[e.node.id]&&e.selectedNode===n.selectedNode&&e.searchTerm===n.searchTerm),Gce=l.span`
  background-color: #ffff00b5;
`,_ce=(e,n)=>n?e.split(new RegExp(`(${n})`,"gi")).map((o,r)=>o.toLowerCase()===n.toLowerCase()?t.jsx(Gce,{children:o},r):o):e,Hce=e=>{const[n,s]=m.useState({}),[o,r]=m.useState({}),[i,a]=m.useState({}),[c,d]=m.useState(new Set),u=m.useMemo(()=>({...n,...Object.keys(o).reduce((x,g)=>(i[g]||(x[g]=!0),x),{})}),[n,o,i]),p=m.useCallback(x=>{const g=[],y=b=>{const v=zc(e,C=>C.id===b);v!=null&&v.children&&v.children.forEach(C=>{g.push(C.id),C.children&&y(C.id)})};return y(x),g},[e]),h=m.useCallback(x=>{s(g=>{const y={...g};return g[x]?(delete y[x],p(x).forEach(v=>{delete y[v]})):y[x]=!0,y}),d(g=>{const y=new Set(g);return n[x]?(y.add(x),p(x).forEach(b=>y.add(b))):y.delete(x),y})},[p,n]),f=m.useCallback(()=>{if(Object.keys(n).length>0)s({}),r({}),a({}),d(new Set);else{const x=new Set,g=y=>{y.forEach(b=>{x.add(b.id),b.children&&g(b.children)})};g(e),s(Object.fromEntries([...x].map(y=>[y,!0]))),a({})}},[e,n]);return{expandedNodes:u,handleToggleNode:h,handleToggleAll:f,manualExpandedNodes:n,searchExpandedNodes:o,manuallyClosedNodes:i,setManualExpandedNodes:s,setSearchExpandedNodes:r,setManuallyClosedNodes:a,explicitlyClosedNodes:c}},Qce=(e,n,s)=>{const[o,r]=m.useState("");return m.useEffect(()=>{if(!o){s({});return}const i=setTimeout(()=>{kce(o,e,zc,a=>{const c=Object.keys(a).reduce((d,u)=>(n[u]||(d[u]=!0),d),{});s(d=>({...c}))})},300);return()=>clearTimeout(i)},[o,e,n,s]),{searchTerm:o,setSearchTerm:r}};function Sp(e,n,s=[]){for(const o of e){const r=[...s,o.id];if(o.id===n)return r;if(o.children){const i=Sp(o.children,n,r);if(i)return i}}return null}const Yce=(e,n,s,o)=>{const[r,i]=m.useState(n);return m.useEffect(()=>{if(n&&n!==r){const a=Sp(e,n);a&&o(c=>{const d={...c};return a.forEach(u=>{s[u]||(d[u]=!0)}),d}),i(n)}},[n,e]),{selectedNode:r,setSelectedNode:i}},Kce=l.div`
  font-family: Arial, sans-serif;
  height: 100%;
  display: grid;
  grid-template-rows: min-content 1fr;
  resize: horizontal;
  overflow: hidden;
  min-width: 250px;
  max-width: 400px;
  padding: 8px; 
`,iu=m.memo(({data:e=[],config:n={},selectedId:s})=>{const o={showAllOnSearch:!0,initialVisibleCount:void 0,...n},{expandedNodes:r,handleToggleNode:i,handleToggleAll:a,manuallyClosedNodes:c,setManualExpandedNodes:d,setSearchExpandedNodes:u}=Hce(e),{searchTerm:p,setSearchTerm:h}=Qce(e,c,u),{selectedNode:f,setSelectedNode:x}=Yce(e,s,c,d),g=m.useCallback(v=>{x(v.id)},[x]),y=m.useMemo(()=>(o.filterNodes||ru)(e,p,o),[e,p,o]),b=m.useMemo(()=>{const v=(o.filterNodes||ru)(e,p,o);return p?v:!p&&o.initialVisibleCount?v.slice(0,o.initialVisibleCount):v},[e,p,o]);return t.jsxs(Kce,{children:[t.jsx(Pce,{handleToggleAll:a,searchTerm:p,setSearchTerm:h}),t.jsxs($ce,{filteredData:y,selectedId:s,children:[b.map(v=>{const C=Sp(e,v.id);return t.jsx(o1,{node:v,level:0,expandedNodes:r,setExpandedNodes:d,searchTerm:p,selectedNode:f,setSelectedNode:x,config:o,traverse:zc,renderHighlightedText:_ce,path:C,onNodeClick:g,onToggleNode:i},v.id)}),!p&&o.initialVisibleCount&&y.length>o.initialVisibleCount&&t.jsxs("div",{style:{padding:"8px 16px",color:"#666",fontSize:"0.9em",textAlign:"center"},children:["Mostrando ",o.initialVisibleCount," de ",y.length," elementos. Use la búsqueda para ver más."]})]})]})}),{TextArea:Jce}=ie,Xce=l.div`
  height: 300px;
  margin-top: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 4px;
  padding: 8px;
`,Zce=l.div`
  display: grid;
  grid-template-columns: repeat(3, 1fr); // Changed from 2 to 3 columns
  gap: 16px;
  margin-bottom: 16px;
`,ele=l.div`
  display: flex;
  align-items: center;
`;l.span`
  margin-left: 8px;
  color: ${e=>e.isExceeded?"red":"green"};
`;const tle=({maxQuantity:e})=>{const[n,s]=m.useState(0),o=n>e,r=i=>{s(i)};return t.jsx(ele,{children:t.jsx(M.Item,{name:"quantity",label:"Cantidad",validateStatus:o?"error":"",help:o?`La cantidad no puede exceder ${e}`:"",rules:[{required:!0,message:"Por favor ingrese la cantidad"}],children:t.jsx(Ke,{addonAfter:e,min:1,max:e,style:{width:"100%"},onChange:r})})})},au=(e,n,s=[])=>{for(let o of e){const r=[...s,o];if(o.id===n)return r;if(o.children){const i=au(o.children,n,r);if(i)return i}}return null},Hf=e=>e.map(n=>n.id).join("/"),nle=({visible:e,onCancel:n,onOk:s,product:o,currentNode:r})=>{const[i]=M.useForm(),[a,c]=m.useState(null),[d,u]=m.useState(!1),{data:p}=n1(),h=D(q);m.useEffect(()=>{e?i.setFieldsValue({product:(o==null?void 0:o.productName)||"Sin selección",destination:"",quantity:null,comment:""}):i.resetFields()},[e,o,i]),m.useEffect(()=>{i.setFieldsValue({product:(o==null?void 0:o.productName)||"Sin selección",destination:(a==null?void 0:a.name)||"Sin selección"})},[o,a,i]);const f=()=>{u(!0),i.validateFields().then(async y=>{if(!(o!=null&&o.id)||!(r!=null&&r.id)||!(a!=null&&a.id)){V.error("Faltan datos necesarios para el movimiento.");return}const b=au(p,r.id),v=au(p,a.id);if(!b||!v){V.error("Error al obtener la ruta completa de las ubicaciones");return}try{await Sz({user:h,productId:o.productId,productName:o.productName,productStockId:o.productStockId,batchId:o.batchId,quantityToMove:y.quantity,sourceLocation:Hf(b),destinationLocation:Hf(v),comment:y.comment}),V.success("Movimiento realizado exitosamente."),i.resetFields(),s(y)}catch(C){console.error("Error al mover el producto:",C),V.error(C.message||"Error al mover el producto.")}finally{u(!1)}})},x=()=>{i.resetFields(),n()},g={onNodeClick:(y,b)=>{y.id===r.id?V.info("Esta ubicación no se puede seleccionar, pero puedes explorarla y escoger una interna."):c(y)},actions:[]};return t.jsxs(Ce,{title:"Movimiento de Producto",open:e,onCancel:x,confirmLoading:d,onOk:f,style:{top:10},width:800,children:[t.jsxs(M,{form:i,layout:"vertical",initialValues:{product:(o==null?void 0:o.productName)||"Sin selección"},children:[t.jsx(M.Item,{name:"product",label:"Producto",children:t.jsx(ie,{readOnly:!0})}),t.jsxs(Zce,{children:[t.jsx(tle,{maxQuantity:(o==null?void 0:o.quantity)||0}),t.jsx(M.Item,{name:"destination",label:"Destino",children:t.jsx(ie,{readOnly:!0})}),t.jsx(M.Item,{name:"comment",label:"Comentario",children:t.jsx(Jce,{rows:1})})]})]}),t.jsx(Xce,{children:t.jsx(iu,{data:p,config:g,selectedId:a==null?void 0:a.id})})]})},{Title:sle,Text:bn}=Xe,ole=l(Ce)`
    .ant-modal-content {
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    .ant-modal-header {
        padding: 20px 24px;
        border-bottom: 1px solid #f0f0f0;
        background: #fafafa;
    }
    .ant-modal-body {
        padding: 24px;
    }
`,rle=l(Je)`
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    
    .ant-card-body {
        padding: 24px;
    }
`,ile=l.span`
    margin-right: 8px;
    color: #1890ff;
    font-size: 1.1em;
`;l(Je)`
    border-radius: 8px;
    text-align: center;
    height: 100%;
    background: ${e=>e.background||"#fff"};
    
    .ant-statistic-title {
        color: rgba(0, 0, 0, 0.65);
        font-size: 14px;
        margin-bottom: 8px;
    }
    
    .ant-statistic-content {
        color: ${e=>e.valueColor||"#000"};
        font-size: 24px;
        font-weight: 600;
    }
`;const ale=l(kn)`
    .ant-badge-status-dot {
        width: 8px;
        height: 8px;
    }
`,cle=l(Je)`
    border-radius: 8px;
    background: #fafafa;
    .ant-card-body {
        padding: 16px;
    }
`,lle=({visible:e,onClose:n,batchData:s})=>{const o=a=>a?typeof a=="object"&&a.seconds?We.unix(a.seconds).format("DD/MM/YYYY HH:mm"):We(a).format("DD/MM/YYYY HH:mm"):"-",r=a=>{switch(a){case"active":return"#52c41a";case"inactive":return"#ff4d4f";default:return"#d9d9d9"}},i=()=>s!=null&&s.initialQuantity?Math.round(s.quantity/s.initialQuantity*100):0;return t.jsx(ole,{title:t.jsxs(Ye,{size:"middle",align:"center",children:[t.jsx(ile,{children:t.jsx(O,{icon:Hr,size:"lg"})}),t.jsxs(Ye,{direction:"vertical",size:0,children:[t.jsxs(sle,{level:4,style:{margin:0},children:["Lote #",s==null?void 0:s.numberId]}),t.jsx(bn,{type:"secondary",style:{fontSize:"14px"},children:(s==null?void 0:s.shortName)||(s==null?void 0:s.productName)})]})]}),open:e,onCancel:n,footer:null,width:700,children:t.jsxs(Wt,{gutter:[16,16],children:[t.jsx(rt,{span:24,children:t.jsx(cle,{children:t.jsxs(Wt,{gutter:[16,16],align:"middle",children:[t.jsx(rt,{span:8,children:t.jsxs(Ye,{direction:"vertical",size:0,children:[t.jsxs(bn,{type:"secondary",children:[t.jsx(O,{icon:Bo})," Cantidad"]}),t.jsxs(Ye,{children:[t.jsx(bn,{strong:!0,style:{fontSize:"24px",color:"#1890ff"},children:s==null?void 0:s.quantity}),t.jsxs(bn,{type:"secondary",style:{fontSize:"14px"},children:["/ ",s==null?void 0:s.initialQuantity]})]})]})}),t.jsx(rt,{span:16,children:t.jsx(to,{percent:i(),strokeColor:{"0%":"#1890ff","100%":"#52c41a"},strokeWidth:12,status:i()<20?"exception":"normal"})})]})})}),t.jsx(rt,{span:24,children:t.jsx(rle,{children:t.jsxs(Wt,{gutter:[24,24],children:[t.jsx(rt,{span:24,children:t.jsxs(Ye,{align:"center",children:[t.jsx(O,{icon:_x}),t.jsx(bn,{strong:!0,children:"Estado:"}),t.jsx(ale,{status:(s==null?void 0:s.status)==="active"?"success":"error",text:t.jsx(bn,{style:{color:r(s==null?void 0:s.status)},children:(s==null?void 0:s.status)==="active"?"Activo":"Inactivo"})})]})}),t.jsx(rt,{span:12,children:t.jsxs(Ye,{direction:"vertical",size:4,children:[t.jsxs(Ye,{children:[t.jsx(O,{icon:ic}),t.jsx(bn,{type:"secondary",children:"Fecha Recepción"})]}),t.jsx(bn,{strong:!0,children:o(s==null?void 0:s.receivedDate)})]})}),t.jsx(rt,{span:12,children:t.jsxs(Ye,{direction:"vertical",size:4,children:[t.jsxs(Ye,{children:[t.jsx(O,{icon:Ew}),t.jsx(bn,{type:"secondary",children:"Última Actualización"})]}),t.jsx(bn,{strong:!0,children:o(s==null?void 0:s.updatedAt)})]})})]})})})]})})},dle=l.div`
  margin-bottom: 24px;
  min-height: 400px;
  display: grid;
  grid-template-rows: min-content min-content 1fr;

  border-radius: 8px;
  background-color: #fff;
`,ule=l.h2`
  margin-bottom: 1em;
  font-size: 1.1em;
  font-weight: 600;
`,ple=l.div`
/* padding: 1em 0; */
`,mle=l(M)`
  display: grid;
  grid-template-columns: min-content min-content min-content min-content;
  align-items: end;
  gap: 16px;
  /* margin-bottom: 24px; */
`,hle=l(ie)`
  width: 300px;

  .ant-input-prefix {
    color: #8c8c8c;
    margin-right: 8px;
  }
`,gle=l(yt.RangePicker)`
  width: 230px;
`,fle=l(U)`
  background: #f5f5f5;
  border: 1px solid #d9d9d9;
  
  &:hover {
    background: #e8e8e8;
    border-color: #d9d9d9;
    color: #ff4d4f;
  }
`,xle=l.div`
  display: flex;
  justify-content: flex-end;
  gap: 6px;
`,ble=l(U)`
  &.ant-btn {
    padding: 4px 8px;
    
    &:hover {
      background-color: #f5f5f5;
    }
  }
`,Xl=l.div`
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 2px 0;
  
  .anticon {
    font-size: 14px;
  }
`,yle=l(U)`
  display: flex;
  align-items: center;
  gap: 8px;
  
  .anticon {
    font-size: 14px;
  }
`,vle=({currentNode:e,searchTerm:n,setSearchTerm:s,setDateRange:o,location:r,warehouseData:i})=>{const a=Fe(),c=W(),d=D(q),{data:u,loading:p}=_v(r),[h,f]=m.useState(!1),[x,g]=m.useState(null),[y,b]=m.useState(null),[v,C]=m.useState({field:null,order:null}),[I,j]=m.useState(!1),[k,A]=m.useState(null),P=X=>{g(X),f(!0)},w=X=>{f(!1)},S=X=>{b(X),o(X)},E=()=>{s(""),b(null),o(null)},T=X=>{a(`/inventory/warehouses/products-stock/${X}`)},R=X=>{c(Qd({productStockId:X.id,batchId:X.batchId,actionType:"productStock"}))},N=async X=>{const me=await Qa(d,X);me&&(A(me),j(!0))},G=X=>({items:[{key:"view-stock",label:t.jsxs(Xl,{children:[t.jsx(cS,{}),"Ver todas las ubicaciones"]}),onClick:()=>T(X.productId)},{key:"move",label:t.jsxs(Xl,{children:[t.jsx(lS,{}),"Mover producto"]}),onClick:()=>P(X)},{key:"delete",danger:!0,label:t.jsxs(Xl,{children:[t.jsx(ht,{}),"Eliminar batch"]}),onClick:()=>R(X)}]}),Q=[{key:"productName-asc",label:"Nombre de Producto (A-Z)",onClick:()=>ae("productName","asc")},{key:"productName-desc",label:"Nombre de Producto (Z-A)",onClick:()=>ae("productName","desc")},{key:"batchNumberId-asc",label:"Número de Lote (Ascendente)",onClick:()=>ae("batchNumberId","asc")},{key:"expirationDate-asc",label:"Fecha de Vencimiento (Próximos)",onClick:()=>ae("expirationDate","asc")},{key:"expirationDate-desc",label:"Fecha de Vencimiento (Lejanos)",onClick:()=>ae("expirationDate","desc")},{key:"createdAt-desc",label:"Más recientes primero",onClick:()=>ae("createdAt","desc")},{key:"createdAt-asc",label:"Más antiguos primero",onClick:()=>ae("createdAt","asc")}],ae=(X,me)=>{C({field:X,order:me})},oe=X=>v.field?[...X].sort((me,fe)=>{const se=me[v.field],ee=fe[v.field];if(se==null)return 1;if(ee==null)return-1;let K=0;return v.field==="expirationDate"||v.field==="createdAt"?K=se-ee:K=String(se).localeCompare(String(ee)),v.order==="desc"?-K:K}):X,Z=[{Header:"Producto",accessor:"productName",minWidth:"200px"},{Header:"Cantidad Existente",accessor:"quantity",align:"right",minWidth:"100px"},{Header:"Batch",accessor:"batch",minWidth:"150px",cell:({value:X})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:"# "+X.batchNumberId||"N/A"}),X.batchId&&t.jsx(U,{type:"text",size:"small",icon:t.jsx(a0,{}),onClick:me=>{me.stopPropagation(),N(X.batchId)}})]})},{Header:"Fecha de Vencimiento",accessor:"expiryDate",minWidth:"150px"},{Header:"Acciones",accessor:"actions",align:"right",minWidth:"80px",cell:({value:X})=>t.jsx(xle,{children:t.jsx(Qs,{menu:G(X),placement:"bottomRight",trigger:["click"],children:t.jsx(ble,{icon:t.jsx(aS,{}),size:"small"})})})}],J=u?oe(u.filter(X=>{var me,fe;if(n){const se=((me=X.productName)==null?void 0:me.toLowerCase().includes(n.toLowerCase()))||!1,ee=((fe=X.batch)==null?void 0:fe.toString().toLowerCase().includes(n.toLowerCase()))||!1;if(!se&&!ee)return!1}if(y&&y[0]&&y[1]){const se=y[0].startOf("day").valueOf(),ee=y[1].endOf("day").valueOf();if(!X.expirationDate)return!1;const K=X.expirationDate;return K>=se&&K<=ee}return!0}).map(X=>({id:X.id,key:X.id,productName:X.productName||"Producto sin nombre",productId:X.productId||"",quantity:X.quantity||0,batch:{batchNumberId:X.batchNumberId||"N/A",batchId:X.batchId||null},batchId:X.batchId||null,actions:X,expiryDate:X!=null&&X.expirationDate?Ve.convertMillisToISODate(X==null?void 0:X.expirationDate):"N/A",...X}))):[];return t.jsxs(t.Fragment,{children:[t.jsxs(dle,{children:[t.jsx(ple,{children:t.jsx(ule,{children:"Gestión de Inventario"})}),t.jsxs(mle,{layout:"vertical",children:[t.jsx(M.Item,{children:t.jsx(hle,{prefix:t.jsx(Kr,{}),placeholder:"Buscar por Producto",value:n,onChange:X=>s(X.target.value),allowClear:!0})}),t.jsx(M.Item,{label:"Fecha de Vencimiento:",children:t.jsx(gle,{onChange:S,placeholder:["Inicio","Fin"],value:y,format:"DD/MM/YYYY"})}),t.jsx(M.Item,{children:t.jsx(Qs,{menu:{items:Q},placement:"bottomRight",children:t.jsx(yle,{icon:t.jsx(d0,{}),children:"Ordenar por"})})}),t.jsx(M.Item,{children:t.jsx(fle,{icon:t.jsx(iS,{}),onClick:()=>{E(),C({field:null,order:null})},title:"Limpiar filtros",children:"Limpiar"})})]}),t.jsx(rn,{columns:Z,data:J,loading:p,numberOfElementsPerPage:8,emptyText:"No hay registros para mostrar"})]}),t.jsx(nle,{visible:h,onCancel:()=>f(!1),onOk:w,product:x,currentNode:e}),t.jsx(lle,{visible:I,onClose:()=>j(!1),batchData:k})]})},jle=l.div`
  margin-top: 16px;
  display: grid;
  min-height: 300px;
`,Cle=l.div`
  display: flex;
  flex-direction: column;
  padding: 2px 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  background: ${({isEntry:e})=>e?"rgba(76, 175, 80, 0.08)":"rgba(239, 83, 80, 0.08)"}; // Rojo más suave y familiar (como acción)
  border-radius: 8px;
  border: 1px solid ${({isEntry:e})=>e?"rgba(76, 175, 80, 0.25)":"rgba(239, 83, 80, 0.25)"}; // Rojo institucional
  opacity: ${({isExternal:e})=>e?.85:1};
  ${({isExternal:e})=>e&&`
    background: #f5f5f5;
    border: 1px dashed #bdbdbd;
    &:hover {
      transform: none;
      box-shadow: none;
    }
  `}
  
  &:hover {
    transform: translateY(-1px);
    background: ${({isEntry:e})=>e?"rgba(76, 175, 80, 0.15)":"rgba(239, 83, 80, 0.15)"};
    box-shadow: 0 2px 8px ${({isEntry:e})=>e?"rgba(76, 175, 80, 0.2)":"rgba(239, 83, 80, 0.2)"};
  }
`;l.div`
  display: flex;
  align-items: center;
  gap: 8px;
`;const wle=l.div`
  font-weight: 600;
  color: ${({isEntry:e})=>e?"#2E7D32":"#C62828"};
  font-size: 1em;
  white-space: nowrap;
  letter-spacing: -0.3px;
`,Sle=l.div`
  display: flex;
  align-items: center;
  gap: 6px;
`,Ile=l.span`
  font-size: 1.1em;
  color: ${({isEntry:e})=>e?"#2E7D32":"#C62828"};
  font-weight: bold;
`,Ele=l.span`
  color: ${({isEntry:e})=>e?"#2E7D32":"#C62828"};
  font-size: 0.85em;
  font-weight: 500;
  opacity: 0.9;
  display: flex;
  align-items: center;
  gap: 4px;
`;l.span`
  color: #8E8E93;
  font-size: 0.85em;
  font-weight: 500;
  letter-spacing: -0.2px;
  background: #F2F2F7;
  padding: 2px 8px;
  border-radius: 4px;
  margin-left: 4px;
`;const Ale=l.span`
  background: ${({isEntry:e})=>e?"rgba(33, 150, 243, 0.1)":"rgba(156, 39, 176, 0.1)"};  // Púrpura (calidad y dignidad)
  color: ${({isEntry:e})=>e?"#1976D2":"#7B1FA2"};
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: 500;
  font-size: 0.9em;
  letter-spacing: -0.2px;
  transition: all 0.2s ease;
  
  &:hover {
    background: ${({isEntry:e})=>e?"rgba(33, 150, 243, 0.15)":"rgba(156, 39, 176, 0.15)"};
  }
`,kle=l.span`
  padding: 4px 12px;
  border-radius: 6px;
  font-size: 0.85em;
  font-weight: 500;
  white-space: nowrap;
  
  ${({reasonType:e})=>{switch(e){case Zn.Purchase:return`
          background: rgba(25, 118, 210, 0.1);
          color: #1976D2;
          border: 1px solid rgba(25, 118, 210, 0.2);
        `;case Zn.Sale:return`
          background: rgba(76, 175, 80, 0.1);
          color: #388E3C;
          border: 1px solid rgba(76, 175, 80, 0.2);
        `;case"adjustment":return`
          background: rgba(255, 152, 0, 0.1);
          color: #F57C00;
          border: 1px solid rgba(255, 152, 0.2);
        `;case"return":return`
          background: rgba(156, 39, 176, 0.1);
          color: #7B1FA2;
          border: 1px solid rgba(156, 39, 176, 0.2);
        `;case"initial_stock":return`
          background: rgba(0, 150, 136, 0.1);
          color: #00796B;
          border: 1px solid rgba(0, 150, 136, 0.2);
        `;case"transfer":return`
          background: rgba(121, 134, 203, 0.1);
          color: #5C6BC0;
          border: 1px solid rgba(121, 134, 203, 0.2);
        `;case"damaged":return`
          background: rgba(244, 67, 54, 0.1);
          color: #D32F2F;
          border: 1px solid rgba(244, 67, 54, 0.2);
        `;case"expired":return`
          background: rgba(121, 85, 72, 0.1);
          color: #5D4037;
          border: 1px solid rgba(121, 85, 72, 0.2);
        `;case"lost":return`
          background: rgba(96, 125, 139, 0.1);
          color: #455A64;
          border: 1px solid rgba(96, 125, 139, 0.2);
        `;default:return`
          background: rgba(158, 158, 158, 0.1);
          color: #757575;
          border: 1px solid rgba(158, 158, 158, 0.2);
        `}}}
`,Tle=e=>{if(["damaged","expired","lost","other"].includes(e.movementReason))return"Baja de Inventario";switch(e.movementReason){case"purchase":return"Proveedor Externo";case"sale":return"Cliente";case"return":return e.movementType==="in"?"Devolución Cliente":"Devolución Proveedor";case"initial_stock":return"Inventario Inicial";case"adjustment":return"Ajuste de Inventario";default:return e.movementType==="in"?"Origen Externo":"Destino Externo"}},Ple=e=>{if(["damaged","expired","lost","other"].includes(e.movementReason))return"Baja de Inventario";const s=e.movementType==="in",o=s?e.sourceLocationName:e.destinationLocationName;return!(s?e.sourceLocation:e.destinationLocation)||!o?Tle(e):o},Dle=e=>({purchase:"Compra",sale:"Venta",adjustment:"Ajuste",return:"Devolución",initial_stock:"Stock Inicial",transfer:"Transferencia",damaged:"Dañado",expired:"Expirado",lost:"Perdido",other:"Otro"})[e]||"Desconocido",$le=(e,n)=>{const s=e?n.sourceLocation:n.destinationLocation;if(!s)return null;const o=s.split("/");let r="/inventory/warehouses/warehouse";return o[0]&&(r+=`/${o[0]}`),o[1]&&(r+=`/shelf/${o[1]}`),o[2]&&(r+=`/row/${o[2]}`),o[3]&&(r+=`/segment/${o[3]}`),r},Rle=({location:e})=>{const n=D(q),s=Fe(),{data:o,loading:r}=Iz(n,e,e),i=o.map(c=>{var u,p;const d=(p=(u=c.createdAt)==null?void 0:u.toDate)==null?void 0:p.call(u);return{...c,key:c.id,date:d?d.toLocaleDateString():"Sin fecha",time:d?d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Sin hora",product:c.productName,movementType:c.movementType,sourceLocationName:c.sourceLocationName,location:c,destinationLocationName:c.destinationLocationName,quantity:c.quantity}}),a=[{Header:"Hora",accessor:"time",minWidth:"100px",keepWidth:!0},{Header:"Producto",accessor:"product",minWidth:"200px"},{Header:"Tipo",accessor:"movementType",minWidth:"120px",cell:({value:c})=>{const d=c==="in";return t.jsx(Ale,{isEntry:d,children:d?"Entrada":"Salida"})}},{Header:"Ubicación",accessor:"location",minWidth:"200px",cell:({value:c})=>{const d=c.movementType==="in",u=$le(d,c),p=Ple(c),h=!u;return t.jsxs(Cle,{isEntry:d,isExternal:h,onClick:()=>u?s(u):null,style:{cursor:u?"pointer":"default"},children:[t.jsx(wle,{isEntry:d,children:p}),t.jsx(Sle,{children:t.jsxs(Ele,{isEntry:d,children:[t.jsx(Ile,{isEntry:d,children:d?"←":"→"}),d?"Origen":"Destino"]})})]})}},{Header:"Motivo",accessor:"movementReason",minWidth:"150px",cell:({value:c})=>t.jsx(kle,{reasonType:c,children:Dle(c)})},{Header:"Cantidad",accessor:"quantity",align:"right",minWidth:"100px",type:"badge"}];return t.jsx(jle,{title:"Últimos Movimientos",children:t.jsx(rn,{title:"Historial de Movimientos",columns:a,data:i,loading:r,groupBy:"date",elementName:"movimientos",numberOfElementsPerPage:8,emptyText:"No hay movimientos para mostrar"})})},Nle=l.div`
    border-bottom: 1px solid #e0e0e0;
    margin-bottom: 0;
`,Ole=l.div`
    display: flex;
    overflow-x: auto;
    &::-webkit-scrollbar {
        height: 4px;
    }
    &::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }
`,jr=l.button`
    padding: 12px 16px;
    border: none;
    background: none;
    cursor: pointer;
    font-size: 14px;
    color: ${e=>e.active?"#1976d2":"#666"};
    border-bottom: 2px solid ${e=>e.active?"#1976d2":"transparent"};
    transition: all 0.3s ease;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 4px;

    &:hover {
        color: #1976d2;
    }
`,Qf=l.span`
    font-size: 12px;
    margin-left: 2px;
    opacity: 0.7;
`,r1=()=>{const e=Fe(),n=_t(),{defaultWarehouse:s,loading:o}=ap(),{INVENTORY_TERM:r,PURCHASE_TERM:i,ORDER_TERM:a}=re,{WAREHOUSES:c,PRODUCTS_STOCK:d,WAREHOUSE:u}=r,{BACKORDERS:p,PURCHASES:h}=i,{ORDERS:f}=a,[x,g]=st.useState(0),y=b=>{g(b);let v;switch(b){case 0:!o&&s&&(v=`${c}/warehouse/${s.id}`);break;case 1:v=d;break;case 2:v=p;break;case 3:v=h;break;case 4:v=f;break;default:v=c}v&&e(v)};return st.useEffect(()=>{const b=n.pathname;b===`${c}/products-stock`?g(1):b.startsWith(`${c}/warehouse/`)?g(0):b.includes("backorders")?g(2):b.includes("purchases")?g(3):b.includes("orders")?g(4):b===c&&(g(0),!o&&s&&e(`${c}/warehouse/${s.id}`))},[n.pathname,o,s,e,c]),t.jsx(Nle,{children:t.jsxs(Ole,{children:[t.jsx(jr,{active:x===0,onClick:()=>y(0),children:"Almacenes"}),t.jsx(jr,{active:x===1,onClick:()=>y(1),children:"Stock"}),t.jsx(jr,{active:x===2,onClick:()=>y(2),children:"Backorders"}),t.jsxs(jr,{active:x===3,onClick:()=>y(3),children:["Compras",t.jsx(Qf,{children:t.jsx(O,{icon:Fp})})]}),t.jsxs(jr,{active:x===4,onClick:()=>y(4),children:["Pedidos",t.jsx(Qf,{children:t.jsx(O,{icon:Fp})})]})]})})};l.div`
  flex: 1;
  padding: 20px;
  width: 100%;
`;l.h3`
  margin-top: 0;
  font-size: 1.5em;
  color: #2c3e50;
`;const Mle=l.div`
  margin-top: 10px;
  color: #333;
  font-size: 1em;
`,Zi=()=>{const{selectedWarehouse:e,selectedShelf:n,selectedRowShelf:s,selectedSegment:o,selectedProduct:r,breadcrumbs:i}=D(li);W();const[a,c]=m.useState(""),[d,u]=m.useState(null),{shelfId:p}=so(),h=r||o||s||n||e||null,f=[e==null?void 0:e.id,n==null?void 0:n.id,s==null?void 0:s.id,o==null?void 0:o.id,r==null?void 0:r.id].filter(Boolean).join("/");return t.jsxs("div",{style:{maxWidth:"1200px",width:"100%",margin:"0 auto",padding:" 0px 24px"},children:[t.jsx(Ece,{breadcrumbs:i}),h?t.jsxs(t.Fragment,{children:[t.jsx(vle,{currentNode:h,searchTerm:a,setSearchTerm:c,setDateRange:u,location:f}),t.jsx(Rle,{location:f})," "]}):t.jsx(Mle,{children:"Selecciona un elemento para ver los productos"})]})},Fle=l.div`
  padding: 10px;
  display: grid;
  height: 100%;
`,Ble=e=>{const n={0:{create:"Crear Estante",edit:"Editar Almacén",delete:"Eliminar Almacén"},1:{create:"Crear Fila",edit:"Editar Estante",delete:"Eliminar Estante"},2:{create:"Crear Segmento",edit:"Editar Fila",delete:"Eliminar Fila"},3:{edit:"Editar Segmento",delete:"Eliminar Segmento"}};return n[e]||n[0]},Gn=(e,n,s=[])=>{for(let o of e){const r=[...s,o];if(o.id===n)return r;if(o.children){const i=Gn(o.children,n,r);if(i)return i}}return null},i1=(e,n=null,s=null,o=null)=>e.map(r=>{const i={...r,parentId:n,grandParentId:s,greatGrandParentId:o};return r.children&&(i.children=i1(r.children,r.id,n,s)),i}),Lle={Almacén:"masculino",Estante:"masculino",Fila:"femenino",Segmento:"masculino"},zle=({onSelectNode:e,items:n,productItems:s=[]})=>{const o=W(),r=D(q),{currentView:i,selectedWarehouse:a,selectedShelf:c,selectedRowShelf:d,selectedSegment:u}=D(li),p=Fe(),h=_t(),{defaultWarehouse:f,loading:x}=ap(),[g,y]=m.useState(""),{products:b}=Rs(!0),v=g?$n(b,g):b,C=m.useMemo(()=>i1(n),[n]),{WAREHOUSE:I,SHELF:j,ROW:k,SEGMENT:A,PRODUCT_STOCK:P}=re.INVENTORY_TERM,[w,S]=m.useState(!1),E=(_,L)=>{const H=Gn(n,_.id);if(_&&H)switch(L){case 0:p(Tt(I,_.id));break;case 1:p(Tt(j,[H[0].id,_.id]));break;case 2:p(Tt(k,[H[0].id,H[1].id,_.id]));break;case 3:p(Tt(A,[H[0].id,H[1].id,H[2].id,_.id]));break;default:V.error("Nivel de nodo desconocido")}},T=_=>{p(Tt(P,[_.id]))},R=m.useCallback(()=>{var L;if(f)return f.id;if(!n||n.length===0)return"default";const _=n.find(H=>{var ne;return((ne=H.data)==null?void 0:ne.defaultWarehouse)===!0});return(_==null?void 0:_.id)||((L=n[0])==null?void 0:L.id)||"default"},[f,n]),N=()=>{o(Hd())},G=_=>{o(Hd(_))},Q=_=>{const L=Gn(n,_.id);o(zm({data:null,path:L.map(H=>({id:H.id,name:H.name}))}))},ae=_=>{const L=Gn(n,_.id);o(Um({data:null,path:L.map(H=>({id:H.id,name:H.name}))}))},oe=_=>{const L=Gn(n,_.id);o(Wm({data:null,path:L.map(H=>({id:H.id,name:H.name}))}))},Z=_=>{const L=Gn(n,_.id);o(zm({data:_,path:L.map(H=>({id:H.id,name:H.name}))}))},J=_=>{const L=Gn(n,_.id);o(Um({data:_,path:L.map(H=>({id:H.id,name:H.name}))}))},X=_=>{const L=Gn(n,_.id);o(Wm({data:_,path:L.map(H=>({id:H.id,name:H.name}))}))},me={Almacén:{deleteFn:async(_,L)=>{const H=L.id;await JB(r,H)}},Estante:{deleteFn:async(_,L)=>{const H=_[0].id;L.id,await mre(r,H)}},Fila:{deleteFn:async(_,L)=>{const H=_[0].id,ne=_[1].id,pe=L.id;await bre(r,H,ne,pe)}},Segmento:{deleteFn:async(_,L)=>{const H=_[0].id,ne=_[1].id,pe=_[2].id,ye=L.id;await Ire(r,H,ne,pe,ye)}}},fe=(_,L)=>{const ne={0:"Almacén",1:"Estante",2:"Fila",3:"Segmento"}[L];if(!ne){V.error("Tipo de nodo no soportado para eliminación");return}const pe=Gn(n,_.id);if(!pe){V.error("Camino al nodo no encontrado");return}const Pe=(Lle[ne]||"masculino")==="femenino"?"esta":"este";Ce.confirm({title:`Eliminar ${_.name}`,content:`¿Estás seguro de que deseas eliminar ${Pe} ${ne}?`,okText:"Eliminar",okType:"danger",cancelText:"Cancelar",onOk:async()=>{try{await me[ne].deleteFn(pe,_),V.success(`${_.name} eliminado correctamente`)}catch(Ue){console.error(`Error al eliminar ${_.name}: `,Ue),V.error(`Error al eliminar ${_.name}`)}}})},se=_=>{var L;return((L=_==null?void 0:_.data)==null?void 0:L.defaultWarehouse)===!0},ee={actions:[{name:"More",icon:Aw,type:"dropdown",show:(_,L)=>!(L===0&&se(_)),items:(_,L)=>{const H=Ble(L),ne=[];return H.create&&ne.push({name:H.create,icon:js,handler:(pe,ye)=>{ye===0&&H.create==="Crear Estante"?Q(pe):ye===1&&H.create==="Crear Fila"?ae(pe):ye===2&&H.create==="Crear Segmento"?oe(pe):ye===0&&H.create==="Crear Almacén"?N():alert(`${H.create} en: ${pe.name}`)}}),ne.push({name:H.edit,icon:Kx,handler:(pe,ye)=>{ye===0&&H.edit==="Editar Almacén"?G(pe):ye===1&&H.edit==="Editar Estante"?Z(pe):ye===2&&H.edit==="Editar Fila"?J(pe):ye===3&&H.edit==="Editar Segmento"&&X(pe)}},{name:H.delete,icon:ec,handler:(pe,ye)=>fe(pe,ye),danger:!0}),ne}}],onNodeClick:E,showMatchedStockCount:!0},K={actions:[],onNodeClick:T,showMatchedStockCount:!0,initialVisibleCount:10},B=()=>{switch(i){case"warehouse":return a==null?void 0:a.id;case"shelf":return c==null?void 0:c.id;case"rowShelf":return d==null?void 0:d.id;case"segment":return u==null?void 0:u.id;default:return null}};return m.useEffect(()=>{const _=h.pathname;if(_.includes("/products-stock")||_.includes("/product-stock-overview/"))S(!0);else if(S(!1),_==="/inventory/warehouses"||_==="/inventory/warehouses/warehouse/:warehouseId"){const L=R();x||p(`/inventory/warehouses/warehouse/${L}`)}},[h.pathname,p,R,x]),t.jsxs(Fle,{children:[w?t.jsx(iu,{data:v,config:K,selectedId:B()}):t.jsx(iu,{data:C,config:ee,selectedId:B()}),t.jsx(Pv,{})]})},Ule=e=>{const n=[];return e.warehouseId&&n.push(e.warehouseId),e.shelfId&&n.push(e.shelfId),e.rowId&&n.push(e.rowId),e.segmentId&&n.push(e.segmentId),n.join("/")},Wle=()=>{const{data:e,loading:n,error:s}=n1(),{defaultWarehouse:o,loading:r}=ap(),i=so(),a=Fe(),c=Ule(i);_v(c);const d=W();m.useEffect(()=>{var p,h,f,x,g,y;if(!i.warehouseId&&i.warehouseId===":warehouseId"&&!n&&!r&&o){a(`/inventory/warehouses/warehouse/${o.id}`);return}if(!n&&e){if(i.warehouseId){const b=e.find(v=>v.id===i.warehouseId);b&&d(wi({view:"warehouse",data:b}))}if(i.shelfId&&i.warehouseId){const b=e.find(C=>C.id===i.warehouseId),v=(p=b==null?void 0:b.children)==null?void 0:p.find(C=>C.id===i.shelfId);v&&d(wi({view:"shelf",data:v}))}if(i.rowId&&i.shelfId&&i.warehouseId){const b=e.find(I=>I.id===i.warehouseId),v=(h=b==null?void 0:b.children)==null?void 0:h.find(I=>I.id===i.shelfId),C=(f=v==null?void 0:v.children)==null?void 0:f.find(I=>I.id===i.rowId);C&&d(wi({view:"rowShelf",data:C}))}if(i.segmentId&&i.rowId&&i.shelfId&&i.warehouseId){const b=e.find(j=>j.id===i.warehouseId),v=(x=b==null?void 0:b.children)==null?void 0:x.find(j=>j.id===i.shelfId),C=(g=v==null?void 0:v.children)==null?void 0:g.find(j=>j.id===i.rowId),I=(y=C==null?void 0:C.children)==null?void 0:y.find(j=>j.id===i.segmentId);I&&d(wi({view:"segment",data:I}))}}},[n,r,e,i,d,o,a]);const u=m.useMemo(()=>t.jsx(zle,{items:e}),[e]);return s?t.jsx("div",{children:"Error al cargar los datos"}):t.jsxs(qle,{children:[t.jsx(Ze,{sectionName:"Almacenes"}),t.jsx(r1,{}),t.jsx(Cce,{Sidebar:u,children:t.jsx(pc,{})})]})},qle=l.div` 
  display: grid;
  grid-template-rows: min-content min-content 1fr;
  height: 100vh;
  overflow-y: hidden; 
`,Vle=(e,n,s,o,r)=>{const i=F($,"businesses",e.businessID,"products",n);return Te(i,c=>{c.exists()?(s({id:c.id,...c.data()}),o(null)):(s(null),o("Producto no encontrado")),r(!1)},c=>{console.error("Error al obtener el producto:",c),o("Error al obtener el producto"),r(!1)})},Gle=e=>{const n=D(q),[s,o]=m.useState(null),[r,i]=m.useState(!0),[a,c]=m.useState(null);return m.useEffect(()=>{if(e&&(n!=null&&n.businessID)){i(!0);const d=Vle(n,e,o,c,i);return()=>d()}},[e,n]),{data:s,loading:r,error:a}},_le=l.div`
display: grid;
grid-template-rows: auto 1fr;
max-height: 100vh;
overflow: hidden;
`,Hle=l.div`
    padding: 20px;
    overflow-y: auto;
    `,Qle=l.div`
    max-width: 1000px;
    margin: 0 auto;
    display: grid;
    gap: 1em;
    `,Yle=l.div`
    display: flex;
    gap: 20px;
`,Yf=l.div`
    flex: 1;
`,Kf=l.div`
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
`,Us=l.div`
    display: flex;
    align-items: center;
    gap: 10px;
`,Kle=l.img`
    width: 100%;
    height: 200px;
    background-color: #f5f5f5;
    object-fit: ${"contain"};
    border-radius: 8px;
`,yo=({icon:e,children:n})=>t.jsxs(Us,{children:[t.jsx(O,{icon:e}),t.jsx("span",{children:n})]});function Jle(){const{productId:e}=so(),{data:n,loading:s,error:o}=Gle(e);return s?t.jsx(He,{size:"large"}):o?t.jsxs("div",{children:["Error: ",o]}):t.jsxs(_le,{children:[t.jsx(Ze,{sectionName:"Productos"}),t.jsx(Hle,{children:t.jsx(Qle,{children:t.jsxs(Je,{title:n.name,extra:t.jsxs("span",{children:["ID: ",n.id]}),children:[t.jsxs(Yle,{children:[t.jsx(Yf,{children:t.jsx(Kle,{noImg:Js,src:Js,alt:n.name})}),t.jsxs(Yf,{children:[t.jsxs(kn.Ribbon,{text:n.isVisible?"Visible":"No Visible",color:n.isVisible?"green":"red",children:[t.jsx("h3",{children:"Precios"}),t.jsxs("p",{children:["Costo: $",n.pricing.cost.toFixed(2)]}),t.jsxs("p",{children:["Precio: $",n.pricing.price.toFixed(2)]}),t.jsxs("p",{children:["Precio de Lista: $",n.pricing.listPrice.toFixed(2)]}),t.jsxs("p",{children:["Precio Promedio: $",n.pricing.avgPrice.toFixed(2)]}),t.jsxs("p",{children:["Precio Mínimo: $",n.pricing.minPrice.toFixed(2)]}),t.jsxs("p",{children:["Impuesto: ",n.pricing.tax]})]}),n.promotions.isActive&&t.jsxs(t.Fragment,{children:[t.jsx(gn,{}),t.jsx("h3",{children:"Promoción"}),t.jsxs("p",{children:["Descuento: ",n.promotions.discount,"%"]}),t.jsxs("p",{children:["Inicio: ",n.promotions.start||"No especificado"]}),t.jsxs("p",{children:["Fin: ",n.promotions.end||"No especificado"]})]})]})]}),t.jsx(gn,{}),t.jsxs(Kf,{children:[t.jsxs(yo,{icon:kw,children:["Tipo: ",n.type||"No especificado"]}),t.jsxs(yo,{icon:Hr,children:["Tamaño: ",n.size||"No especificado"]}),t.jsxs(yo,{icon:Qx,children:["Stock: ",n.stock]}),t.jsxs(yo,{icon:Tw,children:["Contenido Neto: ",n.netContent||"No especificado"]}),n.weightDetail.isSoldByWeight&&t.jsxs(yo,{icon:gu,children:["Peso: ",n.weightDetail.weight," ",n.weightDetail.weightUnit]}),n.warranty.status&&t.jsxs(yo,{icon:nc,children:["Garantía: ",n.warranty.quantity," ",n.warranty.unit]})]}),t.jsx(gn,{}),t.jsxs(Kf,{children:[t.jsxs(Us,{children:["Creado por: ",n.createdBy]}),t.jsxs(Us,{children:["Rastrear Inventario: ",n.trackInventory?"Sí":"No"]}),t.jsxs(Us,{children:["Código QR: ",n.qrcode||"No especificado"]}),t.jsxs(Us,{children:["Código de Barras: ",n.barcode||"No especificado"]}),t.jsxs(Us,{children:["Orden: ",n.order]}),t.jsxs(Us,{children:["Fecha de Expiración: ",n.hasExpirationDate?"Sí":"No"]})]})]})})})]})}const Xle=({location:e,onClick:n,locationNames:s})=>{const o=String(e||""),[r,i,a,c]=o.split("/"),d=p=>{switch(p){case"warehouse":return Fr;case"shelf":return Dw;case"row":return Hx;case"segment":return Hr;default:return Fr}},u=p=>p?s[p]||"Cargando...":"Ubicación no disponible";return t.jsxs(ede,{onClick:n,children:[t.jsxs("div",{className:"location-label",children:[t.jsx(O,{icon:ac,className:"icon"}),"Ubicación"]}),t.jsxs(Zle,{children:[t.jsx("div",{className:"location-content",children:t.jsxs("div",{className:"location-segment",children:[t.jsx(O,{icon:d("segment"),className:"icon"}),t.jsx("span",{className:"location-text",children:u(o)})]})}),t.jsx(O,{icon:Pw,className:"navigation-icon"})]})]})},Zle=l.div`
  display: flex;
  align-items: flex-start; // Changed from center to allow wrapping
  gap: 8px;
  width: 100%;


  .location-content {
    flex: 1;
    min-width: 0;
  }

  .location-segment {
    display: flex;
    align-items: flex-start; // Allow wrapping
    padding: 4px 12px;
    background: #f8fafc;
    border-radius: 8px;
    font-size: 0.9rem;
    color: #1e293b;
    border: 1px solid #e2e8f0;
    white-space: normal; // Allow text wrapping
    word-break: break-word; // Better word wrapping
    
    .icon {
      color: #2563eb;
      margin-right: 6px;
      font-size: 0.85rem;
      flex-shrink: 0;
      margin-top: 3px; // Align icon with first line of text
    }

    .location-text {
      flex: 1;
    }
  }

  .navigation-icon {
    color: #2563eb;
    transition: transform 0.2s ease;
    font-size: 0.9rem;
    flex-shrink: 0;
    margin-top: 6px; // Align with first line of text
  }
`,ede=l.div`
  position: relative;
  background: #ffffff;
  padding: 8px;
  border-radius: 8px;
  font-size: 0.9rem;
  color: #1e293b;
  display: flex;
  flex-direction: column;
  gap: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 1px solid #e2e8f0;
  margin-top: auto;
 

  &:hover {
    border-color: #2563eb;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);

    .navigation-icon {
      transform: translateX(4px);
    }
  }

  .location-label {
    font-size: 0.75rem;
    color: #64748b;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 4px;

    .icon {
      color: #2563eb;
    }
  }

  .location-content {
    display: flex;
    align-items: center;
    width: 100%;
  }
`,tde=({stock:e,status:n,onDelete:s})=>t.jsxs(nde,{$status:n,children:[t.jsxs("div",{className:"stock-header",children:[t.jsx("div",{className:"stock-quantity",children:t.jsxs("div",{children:[t.jsx(O,{icon:Bo,className:"boxes-icon"}),t.jsx("span",{className:"quantity-value",children:e.quantity})]})}),t.jsx("div",{className:"stock-footer",children:t.jsxs("div",{className:"status-pill",children:[t.jsx(O,{icon:n.icon}),t.jsx("span",{children:n.label})]})})]}),t.jsx(ht,{className:"delete-button",onClick:o=>{o.stopPropagation(),s(e)},title:"Eliminar stock de esta ubicación"})]}),nde=l.div`
  padding: 0px 2px;
  background: ${e=>e.$status.background}10;
  border-radius: 12px;
  align-items: center;
  display: grid;
  grid-template-columns: 1fr min-content;
  gap: 1em;

  .stock-header {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .stock-quantity {
    /* display: flex; */
    align-items: center;
    gap: 8px;

    .boxes-icon {
      color: ${e=>e.$status.color};
      font-size: 1.2rem;
    }

    .quantity-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: ${e=>e.$status.color};
    }

    .quantity-label {
      font-size: 0.85rem;
      color: #64748b;
      font-weight: 500;
    }
  }

  .stock-footer {
    display: flex;
    justify-content: flex-start;

  }

  .status-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 0.75rem;
    padding: 4px 10px;
    border-radius: 16px;
    background: ${e=>e.$status.background};
    color: ${e=>e.$status.color};
    font-weight: 600;
  }

  .delete-button {
    color: #94a3b8;
    padding: 6px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    
    &:hover {
      color: #dc2626;
      background: #fee2e2;
    }
  }
`,sde=l(Ie.div)`
  background: #ffffff;
  border-radius: 8px;
  padding: 12px;
  border: 1px solid #e2e8f0;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);

  &:hover {
    border-color: #cbd5e1;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.03);
  }

  .card-content {
    display: flex;
    flex-direction: column;
    gap: 12px;
    height: 100%;
  }
`,ode=({stock:e,index:n,getStockStatus:s,handleDeleteProductStock:o,handleLocationClick:r,locationNames:i})=>{const a=s(e.quantity);return t.jsx(sde,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.05},$status:a,children:t.jsxs("div",{className:"card-content",children:[t.jsx(tde,{stock:e,status:a,onDelete:o}),t.jsx(Xle,{location:e.location,onClick:()=>r(e.location),locationNames:i})]})},e.id)},rde=l.div`
  background: #ffffff;
  border-radius: 12px;
  padding: 16px 0;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
  margin-bottom: 0px;
  
  .batch-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid #f1f5f9;

    .batch-info {
      .batch-number {
        font-size: 1.2rem;
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 6px;
        letter-spacing: -0.01em;
      }

      .batch-meta {
        display: flex;
        align-items: center;
        gap: 12px;
        color: #64748b;
        font-size: 0.85rem;

        .meta-item {
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 4px 0;
        }
      }
    }

    .batch-total {
      padding: 6px 12px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 0.01em;
      display: flex;
      align-items: center;
      gap: 8px;
      background: ${e=>e.$status.background}50;
      color: ${e=>e.$status.color};
      border: 1px solid ${e=>e.$status.color}20;

      .status-icon {
        font-size: 0.9rem;
      }
    }
  }

  .locations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));
    gap: 12px;
    padding: 0px;
  }
`,ide=l.div`
  display: flex;
  align-items: center;
  gap: 8px;
`,ade=l(U)`
  &.ant-btn {
    border: none;
    background: transparent;
    color: #64748b;
    padding: 4px 8px;
    
    &:hover {
      color: #dc2626;
      background: #fee2e2;
    }
  }
`,cde=({group:e,getStockStatus:n,handleDeleteBatch:s,handleDeleteProductStock:o,handleLocationClick:r,locationNames:i})=>t.jsxs(rde,{$status:n(e.total),children:[t.jsxs("div",{className:"batch-header",children:[t.jsxs("div",{className:"batch-info",children:[t.jsx("div",{className:"batch-number",children:e.batchNumberId?`Lote #${e.batchNumberId}`:"Sin lote asignado"}),t.jsxs("div",{className:"batch-meta",children:[e.expirationDate&&t.jsxs("span",{className:"meta-item",children:[t.jsx(Tn,{}),"Vence: ",new Date(e.expirationDate.seconds*1e3).toLocaleDateString()]}),t.jsxs("span",{className:"meta-item",children:[t.jsx(O,{icon:Bo}),e.items.length," ubicaciones"]})]})]}),t.jsxs(ide,{children:[t.jsx(ade,{icon:t.jsx(ht,{}),onClick:()=>s(e),title:"Eliminar batch completo"}),t.jsxs("div",{className:"batch-total",children:[t.jsx(O,{icon:n(e.total).icon,className:"status-icon"}),e.total," unidades"]})]})]}),t.jsx("div",{className:"locations-grid",children:e.items.map((a,c)=>t.jsx(ode,{getStockStatus:n,handleDeleteProductStock:o,handleLocationClick:r,index:c,locationNames:i,stock:a},a.id))})]}),As=e=>e instanceof ue?e.toDate():new Date(e),lde=e=>{const[n,s]=m.useState([]),[o,r]=m.useState(!0),[i,a]=m.useState(null);return m.useEffect(()=>{let c;return(async()=>{if(!(e!=null&&e.businessID)){s([]),r(!1);return}try{const u=le($,`businesses/${e.businessID}/backOrders`),p=he(u);c=Te(p,h=>{const f=h.docs.map(x=>({id:x.id,...x.data(),createdAt:As(x.data().createdAt),updatedAt:As(x.data().updatedAt)}));s(f),r(!1)},h=>{a(h),r(!1)})}catch(u){a(u),r(!1)}})(),()=>{c&&c()}},[e==null?void 0:e.businessID]),{data:n,loading:o,error:i}},dde=()=>{const[e,n]=m.useState([]),[s,o]=m.useState(!0),[r,i]=m.useState(null),a=D(q);return m.useEffect(()=>{let c;return(async()=>{if(!(a!=null&&a.businessID)){n([]),o(!1);return}try{const u=le($,`businesses/${a.businessID}/backOrders`),p=he(u,te("status","in",["pending","reserved"]));c=Te(p,async h=>{const f=await Promise.all(h.docs.map(async x=>{const g=x.data();let y=g==null?void 0:g.productName;if(!y&&(g!=null&&g.productId))try{const b=F($,`businesses/${a.businessID}/products/${g.productId}`),v=await Se(b);v.exists()&&(y=v.data().name,await je(x.ref,{productName:y,updatedAt:ue.now()}))}catch(b){console.error("Error fetching product:",b)}return{id:x.id,...g,productName:y||"Producto no encontrado",createdAt:As(g.createdAt),updatedAt:As(g.updatedAt)}}));n(f),o(!1)},h=>{i(h),o(!1)})}catch(u){i(u),o(!1)}})(),()=>{c&&c()}},[a==null?void 0:a.businessID]),{data:e,loading:s,error:r}},a1=async(e,n)=>{try{const s=le($,`businesses/${e}/backOrders`),o=he(s,te("productId","==",n),te("status","in",["pending","reserved"]));return(await Me(o)).docs.map(i=>({...i.data(),createdAt:As(i.data().createdAt),updatedAt:As(i.data().updatedAt)}))}catch(s){throw console.error("Error getting backorders:",s),s}},Ip=e=>{const n=D(q),[s,o]=m.useState([]),[r,i]=m.useState(null),[a,c]=m.useState(!0);return m.useEffect(()=>{let d;if(!(n!=null&&n.businessID)||!e){o([]),c(!1);return}try{const u=le($,`businesses/${n.businessID}/backOrders`),p=he(u,te("productId","==",e),te("status","in",["pending","reserved"]));d=Te(p,h=>{const f=h.docs.map(x=>({id:x.id,...x.data(),createdAt:As(x.data().createdAt),updatedAt:As(x.data().updatedAt)}));o(f),c(!1)},h=>{i(h),c(!1)})}catch(u){i(u),c(!1)}return()=>{d&&d()}},[n==null?void 0:n.businessID,e]),{backOrders:s,loading:a,error:r}},ude=l.div`
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 16px;
  cursor: pointer;
  transition: all 0.2s ease;
  
  &:hover {
    background: #f8fafc;
    border-radius: 8px;

    .view-more {
      opacity: 1;
    }
  }
  
  .header {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #64748b;
    font-size: 0.9rem;
    
    .icon {
      color: #94a3b8;
    }
  }
`,pde=l.div`
  display: flex;
  align-items: center;
  gap: 4px;
  
  .bar {
    flex: 1;
    height: 24px;
    background: #f1f5f9;
    border-radius: 12px;
    display: flex;
    overflow: hidden;
  }

  .progress {
    height: 100%;
    background: #0ea5e9;
    transition: width 0.3s ease;
  }
  
  .total {
    min-width: 70px;
    text-align: right;
    font-weight: 500;
    color: #0f172a;
    font-size: 0.9rem;
  }
`,mde=l.div`
  display: flex;
  flex-direction: column;
  gap: 12px;
`,hde=l.div`
  padding: 12px;
  background: #f8fafc;
  border-radius: 8px;
  position: relative;

  .date {
    color: #64748b;
    font-size: 0.85rem;
    margin-bottom: 12px;
  }

  .top-info {
    position: absolute;
    top: 12px;
    right: 12px;
  }

  .quantities {
    color: #0f172a;
    font-size: 0.9rem;
  }
`,gde=l.span`
  background: #e0f7fa;
  color: #00695c;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.75rem;
  margin-left: 8px;
`,fde=({productId:e})=>{const n={pending:"Pendiente",reserved:"Reservado"},[s,o]=m.useState(!1);D(q);const{backOrders:r,loading:i,error:a}=Ip(e);if(i)return t.jsx(He,{size:"small"});if(a||!(r!=null&&r.length))return null;const c=r.reduce((p,h)=>p+h.initialQuantity,0),d=r.reduce((p,h)=>p+h.pendingQuantity,0),u=Math.round((c-d)/c*100);return t.jsxs(t.Fragment,{children:[t.jsxs(ude,{onClick:()=>o(!0),children:[t.jsxs("div",{className:"header",children:[t.jsx(O,{icon:Bo,className:"icon"}),t.jsxs("span",{children:["Reservas por Abonar (",r.length,")"]}),t.jsxs(U,{type:"link",size:"small",className:"view-more",style:{marginLeft:"auto",opacity:0,padding:"4px 8px",display:"flex",alignItems:"center",gap:"4px"},children:["Ver detalles",t.jsx(O,{icon:Zs})]})]}),t.jsxs(pde,{children:[t.jsx("div",{className:"bar",children:t.jsx("div",{className:"progress",style:{width:`${u}%`}})}),t.jsxs("span",{className:"total",children:[d,"/",c]})]})]}),t.jsx(Ce,{title:"Detalles de Reservas por Abonar",open:s,onCancel:()=>o(!1),footer:null,width:600,children:t.jsx(mde,{children:r.map(p=>{const h=Math.round((p.initialQuantity-p.pendingQuantity)/p.initialQuantity*100);return t.jsxs(hde,{children:[t.jsx("div",{className:"top-info",children:t.jsx(Oe,{title:"Cantidad pendiente/inicial",children:t.jsxs("span",{className:"quantities",children:[p.pendingQuantity,"/",p.initialQuantity," unidades"]})})}),t.jsxs("div",{className:"date",children:[t.jsx(O,{icon:Gr,style:{marginRight:"8px"}}),ce.fromJSDate(p.createdAt).setLocale("es").toLocaleString(ce.DATETIME_MED),t.jsx(gde,{children:n[p.status]||p.status})]}),t.jsx(to,{percent:h,size:"small",strokeColor:"#0ea5e9"})]},p.id)})})})]})},xde=l.div`
  display: grid;
  gap: 24px;
  align-items: start;

  @media (max-width: 768px) {
    grid-template-columns: 1fr;
  }
`,bde=l.div`
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 16px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
`;l.div`
  display: flex;
  align-items: center;
  gap: 8px;
  color: #64748b;
  font-size: 0.9rem;
  padding-bottom: 8px;
  border-bottom: 1px solid #f1f5f9;
  
  .icon {
    color: #94a3b8;
  }
`;const yde=l.div`
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-top: 4px;
`,Zl=l.div`
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  border-radius: 8px;
  background: #f8fafc;
  transition: all 0.2s ease;

  &:hover {
    background: #f1f5f9;
  }
`,ed=l.div`
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  background: ${e=>e.background};
  color: ${e=>e.color};
  font-size: 0.9rem;
`,td=l.div`
  display: flex;
  flex-direction: column;
`,nd=l.div`
  font-size: 0.95rem;
  font-weight: 600;
  color: #0f172a;
`,sd=l.div`
  font-size: 0.75rem;
  color: #64748b;
`,vde=({filteredStock:e,productId:n})=>{const s=D(q),{data:o}=lde(s);o!=null&&o.reduce((d,u)=>d+u.pendingQuantity,0);const r=m.useCallback(d=>{if(!d.length)return{totalUnits:0,totalLocations:0,totalBatches:0};const u=new Set(d.map(p=>p.location));return{totalUnits:d.reduce((p,h)=>p+h.quantity,0),totalLocations:u.size,totalBatches:new Set(d.filter(p=>p.batchId).map(p=>p.batchId)).size}},[]),{totalUnits:i,totalLocations:a,totalBatches:c}=r(e);return t.jsxs(xde,{children:[!e||e.length===0?null:t.jsx(bde,{children:t.jsxs(yde,{children:[t.jsxs(Zl,{children:[t.jsx(ed,{background:"rgba(59, 130, 246, 0.1)",color:"#3b82f6",children:t.jsx(O,{icon:Bo})}),t.jsxs(td,{children:[t.jsx(nd,{children:i.toLocaleString()}),t.jsx(sd,{children:"Unidades"})]})]}),t.jsxs(Zl,{children:[t.jsx(ed,{background:"rgba(16, 185, 129, 0.1)",color:"#10b981",children:t.jsx(O,{icon:ac})}),t.jsxs(td,{children:[t.jsx(nd,{children:a}),t.jsx(sd,{children:"Ubicaciones"})]})]}),t.jsxs(Zl,{children:[t.jsx(ed,{background:"rgba(245, 158, 11, 0.1)",color:"#f59e0b",children:t.jsx(Tn,{})}),t.jsxs(td,{children:[t.jsx(nd,{children:c}),t.jsx(sd,{children:"Lotes"})]})]})]})}),t.jsx(fde,{productId:n})]})},od=l.div`
  padding: 16px;
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
  background: #ffffff;
  display: grid;
  gap: 24px;
  align-items: start;

  @media (max-width: 1200px) {
    grid-template-columns: 1fr;
  }
`,jde=l.div`
  display: flex;
  flex-direction: column;
  gap: 16px;
`,Cde=l.div`
  position: sticky;
  top: 16px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);

  @media (max-width: 1200px) {
    position: relative;
    top: 0;
  }
`,wde=e=>e<=0?{icon:$w,color:"#dc2626",background:"#fee2e2",label:"Sin Stock"}:e<10?{icon:fu,color:"#ea580c",background:"#ffedd5",label:"Stock Bajo"}:{icon:oc,color:"#059669",background:"#dcfce7",label:"Stock OK"},Sde=l(ie)`
  margin-bottom: 24px;
  border-radius: 8px;
  padding: 8px 12px;
  border: 1px solid #e2e8f0;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
  background: #ffffff;

  .ant-input {
    font-size: 0.95rem;
  }

  .ant-input-prefix {
    color: #64748b;
    margin-right: 8px;
    font-size: 1rem;
  }

  &:hover, &:focus {
    border-color: #cbd5e1;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.04);
  }
`,Jf=({})=>{const e=Fe(),n=W(),[s,o]=m.useState(""),{productId:r}=so(),{data:i,loading:a}=mp(r),{locationNames:c,fetchLocationName:d}=jj(),u=st.useMemo(()=>i?i.filter(g=>{const y=String(g.location||""),b=String(g.batchNumberId||"");return y.toLowerCase().includes(s.toLowerCase())||b.toLowerCase().includes(s.toLowerCase())}):[],[i,s]),p=st.useCallback(g=>{const[y,b,v,C]=g.split("/");let I=`/inventory/warehouses/warehouse/${y}`;b&&(I+=`/shelf/${b}`,v&&(I+=`/row/${v}`,C&&(I+=`/segment/${C}`))),e(I)},[e]);st.useEffect(()=>{i&&i.forEach(g=>{g.location&&!c[g.location]&&d(g.location)})},[i,c,d]);const h=st.useCallback(g=>g.length?g.reduce((y,b)=>{const v=b.batchId||"sin-lote";return y[v]||(y[v]={batchId:b.batchId,batchNumberId:b.batchNumberId,expirationDate:b.expirationDate,productName:b.productName,items:[],total:0}),y[v].items.push(b),y[v].total+=b.quantity,y},{}):{},[]),f=g=>{n(Qd({productStockId:null,batchId:g.batchId,actionType:"batch"}))},x=g=>{n(Qd({productStockId:g.id,batchId:g.batchId,actionType:"productStock"}))};return r?a?t.jsx(od,{children:t.jsx("div",{style:{textAlign:"center",padding:"40px"},children:t.jsx(He,{size:"large"})})}):t.jsxs(od,{children:[t.jsxs(jde,{children:[t.jsx(vde,{filteredStock:u,productId:r}),t.jsx(Sde,{placeholder:"Buscar por ubicación o número de lote...",prefix:t.jsx(Kr,{}),value:s,onChange:g=>o(g.target.value)}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:u.length===0?t.jsx(Lt,{description:"No hay stock disponible para este producto"}):Object.values(h(u)).map(g=>t.jsx(cde,{group:g,getStockStatus:wde,handleDeleteBatch:f,handleDeleteProductStock:x,handleLocationClick:p,locationNames:c},g.batchId||"sin-lote"))})]}),t.jsx(Cde,{})]}):t.jsx(od,{children:t.jsx(Lt,{description:"No se ha seleccionado ningún producto"})})},{INVENTORY_ITEMS:Ide,CATEGORIES:Ede,WAREHOUSE:Ade,SHELF:kde,ROW:Tde,SEGMENT:Pde,PRODUCTS_STOCK:Dde,PRODUCT_STOCK:$de,INVENTORY_SERVICES:Rde,PRODUCT_IMAGES_MANAGER:Nde,PRODUCT_OUTFLOW:Ode,CREATE_PRODUCT:Mde,PRODUCT:Fde,WAREHOUSES:Bde}=re.INVENTORY_TERM,Lde=[{path:Ide,element:t.jsx(Km,{})},{path:Fde,element:t.jsx(Jle,{})},{path:Ede,element:t.jsx(EH,{})},{path:Nde,element:t.jsx(l8,{})},{path:Bde,element:t.jsx(Wle,{}),children:[{path:Ade,element:t.jsx(Zi,{})},{path:kde,element:t.jsx(Zi,{})},{path:Tde,element:t.jsx(Zi,{})},{path:Pde,element:t.jsx(Zi,{})},{path:Dde,element:t.jsx(Jf,{})},{path:$de,element:t.jsx(Jf,{})}]},{path:Rde,element:t.jsx(Km,{})},{path:Ode,element:t.jsx(mce,{})},{path:Mde}],{CONTACT_TERM:zde}=re,{CLIENTS:Ude,SUPPLIERS:Wde}=zde,qde=[{path:Ude,element:t.jsx(rQ,{})},{path:Wde,element:t.jsx(tQ,{})}],c1=async e=>{const n=le($,"businesses");Te(n,s=>{const o=s.docs.map(r=>r.data());e(o)})},{Option:Vde}=ge,Gde=()=>{const[e,n]=m.useState([]),[s,o]=m.useState(null);m.useEffect(()=>{c1(n)},[]);const r=a=>{o(a)},i=()=>{};return t.jsxs(_de,{children:[t.jsx("h1",{children:"Cambiar Negocio"}),t.jsx(ge,{placeholder:"Selecciona un negocio",style:{width:300,marginTop:"1em"},onChange:r,value:s,children:e.map(({business:a})=>t.jsx(Vde,{value:a.id,children:a.name},a.id||a.name))}),t.jsx(U,{type:"primary",onClick:i,style:{marginLeft:16},children:"Cambiar"})]})},_de=l.div`
  padding: 2em;
`,Hde=l.div`
  display: none;
  width: ${e=>e.collapsed?"60px":"270px"};
  background: #fff;
  padding: 0.6em;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: width 0.3s ease;
  position: relative;

  @media (min-width: 769px) {
    display: block;
  }
`,Qde=l.div`
  font-size: 16px;
  font-weight: 600;
  color: #444;
  margin-bottom: 12px;
  padding: 0 12px;
  height: 36px;
  display: flex;
  align-items: center;
  opacity: ${e=>e.collapsed?0:1};
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  transition: opacity 0.2s ease;
`,Yde=l.button`
  width: 100%;
  max-width: 3em;
  height: 36px;
  min-width: 40px;
  background: transparent;
  border: none;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  margin-bottom: 8px;
  color: #444;
  transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);

  &:hover {
    background: #f0f0f0;
    color: #1890ff;
  }

  svg {
    font-size: 16px;
    transform: rotate(${e=>e.collapsed?"0deg":"180deg"});
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
`,Kde=l.div`
  display: flex;
  flex-direction: column;
  width: 100%;
  margin-bottom: 4px; /* Keep margin for collapsible groups */
`,Jde=l.div`
  font-size: 11px; /* Smaller font size */
  font-weight: 600; /* Bold */
  color: #888; /* Grey color */
  text-transform: uppercase; /* Uppercase text */
  padding: 10px 12px 4px 12px; /* Padding: more top/bottom, less bottom */
  margin-top: 8px; /* Add some space above the label */
  opacity: ${e=>e.collapsed?0:1};
  transition: opacity 0.2s ease;
  display: ${e=>e.collapsed?"none":"block"};
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;

  /* Add margin only if not the very first item */
  &:not(:first-child) {
     margin-top: 16px;
  }
`,Xf=l.div`
  padding: 10px 12px;
  height: 3em; /* Ensure consistent height */
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between; /* Keep space-between for potential arrow */
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  color: #666; /* Default color */
  white-space: nowrap;
  gap: 8px; /* Add gap for consistency */
  margin-bottom: 2px; /* Add small gap between rows */

  &:hover {
    background: #f0f0f0;
    color: #444; /* Hover color */
  }

  /* Active state styling (only applies if props.active is true) */
  ${e=>e.active&&`
    background: #e6f7ff;
    color: #1890ff;
    font-weight: 500;
  `}

  .row-content {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-grow: 1; /* Allow content to take available space */
    overflow: hidden; /* Hide overflow */
  }

  .row-icon {
    min-width: 22px;
    font-size: 16px;
    text-align: center;
    /* Icon color based on active state */
    color: ${e=>e.active?"#1890ff":"#666"};
  }

  .row-label {
    opacity: ${e=>e.collapsed?0:1};
    transition: opacity 0.2s ease;
    display: ${e=>e.collapsed?"none":"inline"};
    overflow: hidden;
    text-overflow: ellipsis;
    /* Removed max-width, rely on flex overflow */
  }

  .row-arrow {
    /* Only display arrow if it's a group and not collapsed */
    display: ${e=>e.isGroup&&!e.collapsed?"inline-block":"none"};
    transform: rotate(${e=>e.isOpen?"180deg":"0deg"});
    transition: transform 0.3s ease;
    color: #666; /* Default arrow color */
    margin-left: auto; /* Push arrow to the right */
    padding-left: 5px; /* Add some space before arrow */
  }
`,Xde=l.div`
  margin-left: ${e=>e.collapsed?"0":"12px"}; /* Keep indentation for group items */
  display: ${e=>e.isOpen?"flex":"none"};
  flex-direction: column;
  gap: 2px;
  margin-top: 2px;
  transition: all 0.3s ease;
`,Zde=l.div`
  display: none;
  @media (max-width: 768px) {
    display: block;
    position: relative;
  }
`,eue=l.button`
  width: 100%;
  padding: 12px;
  background: #fff;
  border: 1px solid #e8e8e8;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  
  span {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 80%;
    text-align: left;
  }
`,tue=l.div`
  display: ${e=>e.isOpen?"block":"none"};
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 998;
`,nue=l.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: #fff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  z-index: 999;
  opacity: ${e=>e.isOpen?"1":"0"};
  pointer-events: ${e=>e.isOpen?"all":"none"};
  transition: all 0.3s ease;
  transform: translateY(${e=>e.isOpen?"0":"-100%"});
  border-radius: 0 0 12px 12px;
`,sue=l.div`
  padding: 0.6em;
  max-height: 80vh;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;

`,oue=l.div`
  padding: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  border-radius: 6px;
  transition: all 0.2s ease;
  color: #444;

  &:hover {
    background: #f5f5f5;
  }

  ${e=>e.active&&`
    background: #e6f7ff;
    color: #1890ff;
    font-weight: 500;
  `}

  .menu-icon {
    font-size: 16px;
    width: 20px;
    text-align: center;
    color: #444;
  }

  .menu-label {
    font-size: 14px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    flex: 1;
  }
`,rue=l.div`
  display: flex;
  flex-direction: column;
  width: 100%;
`,iue=l.div`
  padding: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  color: #666;
  
  &:hover {
    background: #f5f5f5;
  }

  .group-title {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .group-icon {
    width: 20px;
    text-align: center;
    font-size: 16px;
  }

  .group-arrow {
    transform: rotate(${e=>e.isOpen?"180deg":"0deg"});
    transition: transform 0.3s ease;
  }
`,aue=l.div`
  margin-left: 12px;
  display: ${e=>e.isOpen?"flex":"none"};
  flex-direction: column;
  gap: 8px;
  margin-top: 2px;
  padding-left: 8px;
  border-left: 1px solid #f0f0f0;
`,cue=l.div`
  display: flex;
  flex-direction: column;
  height: 100vh;
  background: #f0f2f5;
  overflow: hidden;
`,lue=l.div`
  flex: 1;
  gap: 0.4em;
  display: flex;
  width: 100%;
  padding: 0.4em;
  height: calc(100vh - 64px);
  overflow: hidden;
  
  @media (max-width: 768px) {
    padding: 0.4em;
  }
`,due=l.div`
  display: flex;
  gap: 0.4em;
  flex: 1;
  overflow: hidden;
  
  @media (max-width: 768px) {
    flex-direction: column;
    gap: 0.4em;
  }
`,uue=l.div`
  display: none;
  @media (max-width: 768px) {
    display: flex;
    flex-direction: column;
    gap: 0.4em;
    width: 100%;
  }
`,pue=l.div`
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
`,mue=l.div`
  background: #fff;
  padding: 0.2em 0.4em;
  width: 100%;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  flex: 1;
  overflow-y: auto;

  &::-webkit-scrollbar {
    width: 6px;
  }

  &::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  &::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
  }

  &::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
`;function hue({menuItems:e,activeTab:n,onTabChange:s,header:o,children:r,title:i}){var I;const[a,c]=m.useState(!1),[d,u]=m.useState(!1),[p,h]=m.useState({}),f=(j,k)=>{k.stopPropagation(),h(A=>({...A,[j]:!A[j]}))},x=j=>{s(j),c(!1)},g=e.reduce((j,k)=>{var P;if(!k.group)return j.push(k),j;const A=j.findIndex(w=>w.isGroup&&w.key===k.group);if(A===-1){const w=e.filter(E=>E.group===k.group),S=((P=w[0])==null?void 0:P.groupType)||"collapsible";w.length>1||S==="labelled"?j.push({isGroup:!0,key:k.group,label:k.groupLabel||k.group,icon:k.groupIcon,groupType:S,items:[k]}):j.push(k)}else j[A].items.push(k);return j},[]),y=(j,k,A=!1)=>t.jsx(Xf,{active:!A&&n===j.key,onClick:()=>x(j.key),collapsed:k,isGroup:!1,children:t.jsxs("div",{className:"row-content",children:[j.icon&&t.jsx("div",{className:"row-icon",children:j.icon}),t.jsx("span",{className:"row-label",children:j.label})]})},j.key),b=(j,k)=>{const A=p[j.key];return t.jsxs(Kde,{children:[t.jsxs(Xf,{onClick:P=>f(j.key,P),isOpen:A,collapsed:k,isGroup:!0,active:!1,children:[t.jsxs("div",{className:"row-content",children:[j.icon&&t.jsx("div",{className:"row-icon",children:j.icon}),t.jsx("span",{className:"row-label",children:j.label})]}),t.jsx(O,{icon:Do,className:"row-arrow"})]}),t.jsx(Xde,{isOpen:A,collapsed:k,children:j.items.map(P=>y(P,k,!0))})]},j.key)},v=j=>t.jsxs(oue,{active:n===j.key,onClick:()=>x(j.key),children:[t.jsx("span",{className:"menu-icon",children:j.icon}),t.jsx("span",{className:"menu-label",children:j.label})]},j.key),C=j=>{const k=p[j.key];return t.jsxs(rue,{children:[t.jsxs(iue,{onClick:A=>f(j.key,A),isOpen:k,children:[t.jsxs("div",{className:"group-title",children:[j.icon&&t.jsx("span",{className:"group-icon",children:j.icon}),t.jsx("span",{children:j.label})]}),t.jsx(O,{icon:Do,className:"group-arrow"})]}),t.jsx(aue,{isOpen:k,children:j.items.map(v)})]},j.key)};return t.jsxs(cue,{children:[o,t.jsxs(lue,{children:[t.jsxs(Hde,{collapsed:d,children:[t.jsx(Yde,{collapsed:d,onClick:()=>u(!d),children:t.jsx(O,{icon:d?Rw:Nw})}),i&&t.jsx(Qde,{collapsed:d,children:i}),g.map((j,k)=>j.isGroup?j.groupType==="labelled"?t.jsxs(m.Fragment,{children:[t.jsx(Jde,{collapsed:d,children:j.label}),j.items.map(A=>y(A,d,!0))]},j.key):b(j,d):y(j,d))]}),t.jsxs(due,{children:[t.jsx(uue,{children:t.jsxs(Zde,{children:[t.jsxs(eue,{onClick:()=>c(!a),children:[t.jsx("span",{children:(I=e.find(j=>j.key===n))==null?void 0:I.label}),t.jsx(O,{icon:Zs,style:{transform:`rotate(${a?"90deg":"0deg"})`,transition:"transform 0.3s ease",color:"#444"}})]}),t.jsx(tue,{isOpen:a,onClick:()=>c(!1)}),t.jsx(nue,{isOpen:a,children:t.jsxs(sue,{children:[i&&t.jsx(gue,{children:i}),g.map(j=>j.isGroup?C(j):v(j))]})})]})}),t.jsx(pue,{children:t.jsx(mue,{children:r})})]})]})]})}const gue=l.div`
  font-size: 16px;
  font-weight: 600;
  color: #444;
  margin-bottom: 12px;
  padding: 8px 12px;
  border-bottom: 1px solid #f0f0f0;
`,fue=yO("/general-config");function xue(){const e=Fe(),s=_t().pathname,[o,r]=m.useState("billing"),i=D(fue);m.useEffect(()=>{s.includes("billing")?r("billing"):s.includes("business")?r("business"):s.includes("tax-receipt")?r("taxReceipt"):s.includes("users")?r("users"):s.includes("app-info")?r("appInfo"):s.includes("/general-config")&&(r("billing"),e(re.SETTING_TERM.GENERAL_CONFIG_BILLING,{replace:!0}))},[s,e]);const a=()=>{const u=(i==null?void 0:i.pathname)||"/home";e(u)},c=u=>{switch(u){case"billing":e(re.SETTING_TERM.GENERAL_CONFIG_BILLING);break;case"business":e(re.SETTING_TERM.GENERAL_CONFIG_BUSINESS);break;case"taxReceipt":e(re.SETTING_TERM.GENERAL_CONFIG_TAX_RECEIPT);break;case"users":e(re.SETTING_TERM.GENERAL_CONFIG_USERS);break;case"appInfo":e(re.SETTING_TERM.GENERAL_CONFIG_APP_INFO);break;default:e(re.SETTING_TERM.GENERAL_CONFIG_BILLING)}},d=[{key:"business",icon:t.jsx(O,{icon:zx}),label:"Datos de la Empresa"},{key:"billing",icon:t.jsx(O,{icon:Wx}),label:"Ventas y Facturación",group:"basic",groupLabel:"Configuración Básica",groupType:"labelled"},{key:"taxReceipt",icon:t.jsx(O,{icon:Ow}),label:"Comprobante Fiscal",group:"basic",groupLabel:"Configuración Básica",groupType:"labelled"},{key:"users",icon:t.jsx(O,{icon:xu}),label:"Administración de Usuarios",group:"advanced",groupLabel:"Configuración Avanzada",groupType:"labelled"},{key:"appInfo",icon:t.jsx(O,{icon:Yx}),label:"Info de la Aplicación",group:"help",groupLabel:"Sistema",groupIcon:t.jsx(O,{icon:Mw}),groupType:"labelled"}];return t.jsx(hue,{menuItems:d,activeTab:o,onTabChange:c,header:t.jsx(Ze,{onBackClick:a,sectionName:"Configuración General"}),children:t.jsx(pc,{})})}const{Title:bue,Paragraph:yue}=Xe,vue=l.div`
  padding: 1em;
  border-bottom: 1px solid #e8e8e8;
`,jue=l.div`
  cursor: pointer;
  display: flex;
  align-items: flex-start;
  gap: 8px;

  .header-content {
    flex: 1;
  }

  .fa-icon {
    margin-top: 6px;
    width: 14px;
  }

  &:hover {
    opacity: 0.8;
  }
`,Cue=l(Ie.div)`
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 16px 0;
`,rd=({title:e,description:n,children:s})=>{const[o,r]=m.useState(!1),i=m.useRef(null);return t.jsxs(vue,{ref:i,children:[t.jsxs(jue,{isExpanded:o,onClick:()=>r(!o),children:[t.jsx(Ie.div,{animate:{rotate:o?90:0},transition:{duration:.2},children:t.jsx(O,{icon:Zs,className:"fa-icon"})}),t.jsxs("div",{className:"header-content",children:[t.jsx(bue,{level:4,children:e}),t.jsx(yue,{children:n})]})]}),t.jsx(gt,{children:o&&t.jsx(Cue,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:"easeInOut"},children:s})})]})},Zf=l(Je)`
  margin-bottom: 16px;
  cursor: pointer;
  border: ${e=>e.selected?"2px solid #1890ff":"1px solid #f0f0f0"};
  background-color: ${e=>e.selected?"#e6f7ff":"#ffffff"};

  &:hover {
    border-color: #1890ff;
    background-color: #e6f7ff;
  }
`,wue=l.div`
  padding-left: ${e=>(e.level||0)*16}px;
  margin-bottom: 8px;
`,Sue=({billingMode:e})=>{const n=D(q),s=async o=>{try{await en(n,{billingMode:o})}catch{V.error("Error al guardar la configuración")}};return t.jsx(wue,{level:0,children:t.jsxs(Cs.Group,{value:e,style:{width:"100%"},children:[t.jsxs(Zf,{type:"inner",selected:e==="direct",onClick:()=>s("direct"),hoverable:!0,children:[t.jsxs(Cs,{value:"direct",children:[t.jsx("strong",{children:"Facturación Directa"})," (Predeterminada)"]}),t.jsx("p",{children:"Crea y emite la factura en el momento en que seleccionas los productos."})]}),t.jsxs(Zf,{type:"inner",selected:e==="deferred",onClick:()=>s("deferred"),hoverable:!0,children:[t.jsx(Cs,{value:"deferred",children:t.jsx("strong",{children:"Facturación Diferida"})}),t.jsx("p",{children:"Registra las ventas como órdenes preliminares que puedes revisar, completar o cancelar antes de generar la factura final."})]})]})})},Iue=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  
  .period {
    font-weight: 500;
  }
  
  .description {
    color: rgba(0, 0, 0, 0.45);
    font-size: 0.9em;
  }
`,ex=l.div`
  padding-left: ${e=>(e.level||0)*16}px;
  margin-bottom: 8px;
`,tx=l.div`
  border-left: 2px solid #f0f0f0;
  padding-left: 16px;
  margin-bottom: 16px;
`,Eue=()=>{const{billing:{hasDueDate:e,duePeriod:n,useCustomConfig:s}}=D(zt),o=D(q),[r,i]=m.useState((n==null?void 0:n.months)||0),[a,c]=m.useState((n==null?void 0:n.weeks)||0),[d,u]=m.useState((n==null?void 0:n.days)||0),[p,h]=m.useState("1_week"),[f,x]=m.useState(!1),[g,y]=m.useState(!1);m.useEffect(()=>{n&&(i(n.months||0),c(n.weeks||0),u(n.days||0))},[n]);const b=async k=>{try{await en(o,{hasDueDate:k}),V.success("Configuración actualizada")}catch{V.error("Error al actualizar la configuración")}},v=async k=>{try{h(k),await en(o,{selectedOption:k,useCustomConfig:!1}),k!=="custom"&&(await en(o,{duePeriod:{immediate:{weeks:0,days:0,months:0},"3_days":{weeks:0,days:3,months:0},"1_week":{weeks:1,days:0,months:0},"2_weeks":{weeks:2,days:0,months:0},"15_days":{weeks:0,days:15,months:0},"1_month":{weeks:0,days:0,months:1},"45_days":{weeks:0,days:45,months:0},"2_months":{weeks:0,days:0,months:2},"3_months":{weeks:0,days:0,months:3},"6_months":{weeks:0,days:0,months:6},"1_year":{weeks:0,days:0,months:12}}[k]}),V.success("Configuración de vencimiento actualizada"))}catch{V.error("Error al actualizar la configuración")}},C=async k=>{y(!0);try{await en(o,{useCustomConfig:k}),k?h(null):(h("1_week"),await en(o,{selectedOption:"1_week"}),await en(o,{duePeriod:{months:0,weeks:1,days:0}})),V.success("Configuración actualizada")}catch{V.error("Error al actualizar la configuración")}finally{y(!1)}},I=async()=>{x(!0);try{await en(o,{duePeriod:{months:r,weeks:a,days:d},useCustomConfig:!0}),V.success("Configuración de vencimiento personalizada guardada")}catch{V.error("Error al guardar la configuración")}finally{x(!1)}},j=(k,A)=>t.jsxs(Iue,{children:[t.jsx("span",{className:"period",children:k}),t.jsx("span",{className:"description",children:A})]});return t.jsxs(tx,{children:[t.jsx(M.Item,{children:t.jsx(St,{checked:e,onChange:k=>b(k.target.checked),children:"Habilitar fecha de vencimiento en facturas"})}),e&&t.jsxs(tx,{children:[t.jsx(ex,{level:2,children:t.jsx(M.Item,{label:"Opciones de vencimiento predefinidas",children:t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx(ge,{value:p,onChange:v,style:{width:"300px"},showSearch:!0,optionFilterProp:"children",filterOption:(k,A)=>{var w,S,E,T,R;const P=typeof(A==null?void 0:A.label)=="object"?(R=(T=(E=(S=(w=A==null?void 0:A.label)==null?void 0:w.props)==null?void 0:S.children)==null?void 0:E[0])==null?void 0:T.props)==null?void 0:R.children:A==null?void 0:A.label;return P==null?void 0:P.toLowerCase().includes(k.toLowerCase())},placeholder:"Buscar período de vencimiento...",options:[{value:"3_days",label:j("3 días","72 horas")},{value:"1_week",label:j("1 semana","7 días")},{value:"2_weeks",label:j("2 semanas","14 días")},{value:"15_days",label:j("15 días","Quincenal")},{value:"1_month",label:j("1 mes","30 días")},{value:"45_days",label:j("45 días","Mes y medio")},{value:"2_months",label:j("2 meses","60 días")},{value:"3_months",label:j("3 meses","Trimestral")},{value:"6_months",label:j("6 meses","Semestral")},{value:"1_year",label:j("1 año","Anual")}],disabled:s}),t.jsx(St,{checked:s,onChange:k=>C(k.target.checked),style:{marginLeft:"16px"},children:"Personalizado"})]})})}),s&&t.jsxs(ex,{level:2,children:[t.jsx(M.Item,{label:"Período de vencimiento personalizado",children:t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx(Ke,{min:0,value:r,onChange:k=>i(k),placeholder:"Meses",style:{width:"100px"}}),t.jsx("span",{children:"Meses"}),t.jsx(Ke,{min:0,value:a,onChange:k=>c(k),placeholder:"Semanas",style:{width:"100px"}}),t.jsx("span",{children:"Semanas"}),t.jsx(Ke,{min:0,value:d,onChange:k=>u(k),placeholder:"Días",style:{width:"100px"}}),t.jsx("span",{children:"Días"})]})}),t.jsx(U,{type:"primary",onClick:I,loading:f,children:"Guardar Configuración"})]})]})]})},nx=l.div`
  padding-left: ${e=>(e.level||0)*16}px;
  margin-bottom: 8px;
`,Aue=()=>t.jsxs(M,{layout:"vertical",children:[t.jsx(nx,{level:1,children:t.jsx(tj,{previewInModal:!0})}),t.jsx(nx,{level:1,children:t.jsx(Eue,{})})]}),id=l.div`
  padding-left: ${e=>(e.level||0)*16}px;
  margin-bottom: 8px;
`,kue=()=>{const e=D(q),[n]=M.useForm(),{billing:{quoteEnabled:s,quoteDefaultNote:o,quoteValidity:r}}=D(zt);m.useEffect(()=>{n.setFieldsValue({quoteEnabled:s,quoteDefaultNote:o,quoteValidity:r||15})},[s,o,r,n]);const i=async u=>{try{await en(e,{quoteEnabled:u}),V.success("Configuración guardada exitosamente")}catch{V.error("Error al guardar la configuración")}},a=async u=>{if(u)try{const p=Number(u);if(isNaN(p)){V.error("Por favor ingrese un número válido");return}const h=p>90?90:p;await en(e,{quoteValidity:h}),p>90&&(V.info("El valor máximo permitido es 90 días"),n.setFieldValue("quoteValidity",90))}catch{V.error("Error al guardar la configuración")}},c=async u=>{try{await en(e,{quoteDefaultNote:u.target.value})}catch{V.error("Error al guardar la configuración")}},d=M.useWatch("quoteEnabled",n);return t.jsxs(M,{layout:"vertical",form:n,children:[t.jsx(id,{level:0,children:t.jsx(M.Item,{name:"quoteEnabled",valuePropName:"checked",children:t.jsx(St,{onChange:u=>i(u.target.checked),children:"Habilitar cotizaciones"})})}),d&&t.jsxs(t.Fragment,{children:[t.jsx(id,{level:1,children:t.jsx(M.Item,{label:"Validez de cotización (días)",name:"quoteValidity",children:t.jsx(Ke,{min:1,max:90,onBlur:u=>a(u.target.value)})})}),t.jsx(id,{level:1,children:t.jsx(M.Item,{label:"Nota predeterminada en cotizaciones",name:"quoteDefaultNote",children:t.jsx(ie.TextArea,{rows:4,onBlur:c})})})]})]})},Tue=l.div`
  margin-top: 16px;
`,sx=()=>{const{billing:{billingMode:e}}=D(zt);return t.jsxs(Tue,{title:"Configuración de Ventas y Facturación",bordered:!1,children:[t.jsx(rd,{title:"Modo de Facturación",description:"Seleccione el modo de facturación que desea utilizar.",children:t.jsx(Sue,{billingMode:e})}),t.jsx(rd,{title:"Configuración de Factura",description:"Configure los detalles de su factura.",children:t.jsx(Aue,{})}),t.jsx(rd,{title:"Configuración de Cotizaciones",description:"Configure los parámetros predeterminados para sus cotizaciones.",children:t.jsx(kue,{})})]})},Pue=sn`
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.2);
  }
  100% {
    transform: scale(1);
  }
`,Due=l.button`
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #007bff;
  color: #fff;
  font-size: 1.5rem;
  width: 3.5rem;
  height: 3.5rem;
  border-radius: 50%;
  border: none;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #0062cc;
    animation: ${Pue} 0.5s ease-in-out;
  }

  &:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5);
  }
`,$ue=()=>{const e=Fe(),n=()=>{e("/app/settings")};return t.jsx(Due,{onClick:n,children:t.jsx(FaArrowLeft,{})})},Rue=l.div`
  background-color: #f7f7f7;
  padding: 3rem 2rem;
  border-radius: 1rem;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 600px;
  margin: 1em auto;
`,Nue=l.h2`
  font-size: 1.2rem;
  font-weight: 700;
  text-align: center;
  margin-bottom: 2rem;
`,Oue=l.ul`
  list-style: none;
  margin: 0;
  padding: 0;
`,Mue=l.li`
  font-size: 1.25rem;
  margin-bottom: 1.5rem;
  span{
    display: block;
    font-size: 1rem;
   // text-align: right;
  }
`,Fue=l.span`
  font-weight: 600;
  margin-right: 1rem;
  text-align: left !important;
`,Bue=[{label:"Versión:",value:"v3.3.0"},{label:"Email:",value:"pos.ventamax@gmail.com"},{label:"Teléfono:",value:"555-1234"},{label:"Derecho de autor:",value:"GISIS S.A © 2023. Todos los derechos reservados."},{label:"Términos de servicio:",value:"Los usuarios deben aceptar los términos y condiciones de la aplicación para utilizarla."},{label:"Política de privacidad:",value:"La aplicación recopila y utiliza información personal de los usuarios de acuerdo con nuestra política de privacidad."},{label:"FAQ:",value:"Para obtener ayuda con la aplicación, consulte nuestras preguntas frecuentes."},{label:"Soporte técnico:",value:"Para obtener ayuda adicional, comuníquese con nuestro equipo de soporte técnico."},{label:"Actualizaciones:",value:"La aplicación se actualiza periódicamente con nuevas funciones, mejoras y correcciones de errores para garantizar una mejor experiencia de usuario."},{label:"Licencia:",value:"Esta aplicación utiliza software de terceros, que está sujeto a sus propias licencias y términos de uso."},{label:"Información legal:",value:"Para obtener información adicional sobre nuestros términos y condiciones de compra, políticas de reembolso y otros detalles legales, consulte nuestro sitio web."}],ox=()=>t.jsxs(Rue,{children:[t.jsx($ue,{}),t.jsx(Nue,{children:"Información de la aplicación web"}),t.jsx(Oue,{children:Bue.map((e,n)=>t.jsxs(Mue,{children:[t.jsx(Fue,{children:e.label}),t.jsx("span",{children:e.value})]},n))})]}),l1=[{id:"ar",name:"Argentina"},{id:"bo",name:"Bolivia"},{id:"br",name:"Brasil"},{id:"cl",name:"Chile"},{id:"co",name:"Colombia"},{id:"cr",name:"Costa Rica"},{id:"cu",name:"Cuba"},{id:"do",name:"República Dominicana"},{id:"ec",name:"Ecuador"},{id:"sv",name:"El Salvador"},{id:"gt",name:"Guatemala"},{id:"hn",name:"Honduras"},{id:"mx",name:"México"},{id:"ni",name:"Nicaragua"},{id:"pa",name:"Panamá"},{id:"py",name:"Paraguay"},{id:"pe",name:"Perú"},{id:"pr",name:"Puerto Rico"},{id:"uy",name:"Uruguay"},{id:"ve",name:"Venezuela"}],{Option:ad}=ge,{Title:ea,Text:JCe}=Xe,rx=()=>{const e=D(ft),[n]=M.useForm(),s=D(q);Pu(768);const[o,r]=m.useState((e==null?void 0:e.logoUrl)||null),[i,a]=m.useState(!1);m.useEffect(()=>{e&&(r(e.logoUrl),n.setFieldsValue({...e,logo:e.logoUrl}))},[e,n]);const c=async x=>{const g=x.size/1048576,y={maxSizeMB:g>2?1:g*.8,maxWidthOrHeight:1200,useWebWorker:!0,fileType:"image/jpeg",initialQuality:g>2?.6:.8};try{const b=await Ad(x,y);return b.size>2*1024*1024?await Ad(b,{...y,maxSizeMB:1,initialQuality:.5}):b}catch{return V.error("Error al comprimir la imagen"),null}},d=async x=>{if(!(x.type==="image/jpeg"||x.type==="image/png"))return V.error("Solo puedes subir archivos JPG/PNG!"),!1;try{const y=await c(x);if(y){const b=(y.size/1048576).toFixed(2);return V.success(`Imagen optimizada a ${b}MB`),y}return!1}catch{return V.error("Error al procesar la imagen"),!1}},u=async x=>{if(x.file.status==="uploading"){a(!0);return}if(x.file.status==="done")try{const g=await SW(s,x.file.originFileObj);a(!1),r(g),n.setFieldsValue({logo:g}),V.success("Logo actualizado correctamente")}catch{a(!1),V.error("Error al actualizar el logo")}},p=async x=>{var g,y;try{const b={invoiceMessage:((g=x.invoice)==null?void 0:g.invoiceMessage)||"",invoiceType:((y=x.invoice)==null?void 0:y.invoiceType)||"invoiceTemplate1"},v={...e,...x,logoUrl:o||"",logo:x.logo||"",country:x.country||"",province:x.province||"",tel:x.tel||"",email:x.email||"",rnc:x.rnc||"",address:x.address||"",name:x.name||"",businessType:x.businessType||"general",invoice:b};await wW(s,v),V.success("Información actualizada")}catch{V.error("Error al actualizar la información")}},h=t.jsxs("div",{children:[i?t.jsx(Yr,{}):t.jsx(Jn,{}),t.jsx("div",{style:{marginTop:8},children:"Subir Logo"})]}),f=t.jsxs(Uue,{form:n,layout:"vertical",onFinish:p,children:[t.jsxs(ta,{children:[t.jsxs(ea,{level:4,children:[t.jsx(yu,{})," Información General"]}),t.jsxs(Je,{children:[t.jsx(M.Item,{name:"businessType",label:"Tipo de Negocio",rules:[{required:!0,message:"Por favor, selecciona el tipo de negocio"}],children:t.jsxs(ge,{placeholder:"Selecciona el tipo de negocio",children:[t.jsx(ad,{value:"general",children:"General"}),t.jsx(ad,{value:"pharmacy",children:"Farmacia"})]})}),t.jsx(Wue,{children:t.jsx(M.Item,{name:"logo",label:"Logo del negocio",extra:"Formato: JPG/PNG. Tamaño máximo: 2MB. Dimensiones recomendadas: 400x200px",children:t.jsx(Sd,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,beforeUpload:d,onChange:u,customRequest:({onSuccess:x})=>setTimeout(()=>x("ok"),0),children:o?t.jsx(que,{children:t.jsx("img",{src:o,alt:"logo"})}):h})})}),t.jsx(M.Item,{name:"name",label:"Nombre",rules:[{required:!0,message:"Por favor, ingresa el nombre del negocio"}],children:t.jsx(ie,{placeholder:"Nombre del negocio"})}),t.jsx(M.Item,{name:"rnc",label:"RNC",children:t.jsx(ie,{placeholder:"Ingresa el RNC"})})]})]}),t.jsxs(ta,{children:[t.jsxs(ea,{level:4,children:[t.jsx(u0,{})," Contacto"]}),t.jsx(Je,{children:t.jsxs(ix,{children:[t.jsx(M.Item,{name:"email",label:"Correo electrónico",rules:[{type:"email",message:"Ingresa un correo electrónico válido"}],children:t.jsx(ie,{placeholder:"ejemplo@dominio.com"})}),t.jsx(M.Item,{name:"tel",label:"Teléfono",rules:[{required:!0,message:"Por favor, ingresa el teléfono"}],children:t.jsx(ie,{placeholder:"55 1234 5678"})})]})})]}),t.jsxs(ta,{children:[t.jsxs(ea,{level:4,children:[t.jsx(uc,{})," Ubicación"]}),t.jsxs(Je,{children:[t.jsxs(ix,{children:[t.jsx(M.Item,{name:"country",label:"País",children:t.jsx(ge,{placeholder:"Selecciona un país",children:l1.map(x=>t.jsx(ad,{value:x.id,children:x.name},x.id))})}),t.jsx(M.Item,{name:"province",label:"Provincia/Estado",children:t.jsx(ie,{placeholder:"Provincia o Estado"})})]}),t.jsx(M.Item,{name:"address",label:"Dirección",rules:[{required:!0,message:"Por favor, ingresa la dirección"}],children:t.jsx(ie,{placeholder:"Calle 123, Colonia, Ciudad, Estado"})})]})]}),t.jsxs(ta,{children:[t.jsx(ea,{level:4,children:"Configuración de Factura"}),t.jsx(Je,{children:t.jsx(M.Item,{name:["invoice","invoiceMessage"],label:"Mensaje en la factura",children:t.jsx(ie.TextArea,{rows:4,placeholder:"Escribe un mensaje personalizado para la factura, como 'Gracias por su compra'"})})})]}),t.jsx(Vue,{children:t.jsx(U,{type:"primary",htmlType:"submit",size:"large",children:"Guardar Cambios"})})]});return t.jsx(Lue,{children:t.jsx(zue,{children:f})})},Lue=l.div`
  display: grid;

`,zue=l.div`
  padding: 24px;
  width: 100%;
  overflow-y: auto;
  `,Uue=l(M)`
max-width: 900px;
margin: 0 auto;
  background: transparent;
`,ta=l.div`
  margin-bottom: 32px;

  .ant-card {
    border-radius: 8px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
  }

  .ant-typography {
    margin-bottom: 16px;
  }
`,ix=l.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;

  @media (max-width: 768px) {
    grid-template-columns: 1fr;
  }
`,Wue=l.div`
  display: flex;
  justify-content: center;
  margin-bottom: 24px;

  .avatar-uploader {
    .ant-upload {
      width: 300px !important;
      height: 150px !important;
      border-radius: 8px;
      background: #fafafa;
      border: 2px dashed #d9d9d9;
      transition: all 0.3s ease;

      &:hover {
        border-color: #1890ff;
      }
    }
  }
`,que=l.div`
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  
  img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    border-radius: 4px;
  }
`,Vue=l.div`
  display: flex;
  justify-content: flex-end;
  margin-top: 24px;
  
  button {
    min-width: 150px;
  }
`,{Option:cd}=ge,{Title:ld,Text:XCe}=Xe,d1=()=>{const[e]=M.useForm(),n=Fe(),[s,o]=m.useState(null),[r,i]=m.useState(!1),{BUSINESSES:a}=re.DEV_VIEW_TERM,c=async d=>{var u;try{i(!0);const p={name:d.name,logoUrl:s||"",country:d.country||"",province:d.province||"",tel:d.tel||"",email:d.email||"",rnc:d.rnc||"",address:d.address||"",businessType:d.businessType||"general",invoice:{invoiceMessage:((u=d.invoice)==null?void 0:u.invoiceMessage)||"",invoiceType:"invoiceTemplate1"}};await CW(p),V.success("Negocio creado exitosamente"),n(a)}catch(p){V.error(p.message||"Error al crear el negocio")}finally{i(!1)}};return t.jsxs(Gue,{children:[t.jsx(Ze,{sectionName:"Crear Nuevo Negocio"}),t.jsx(_ue,{children:t.jsxs(Hue,{form:e,layout:"vertical",onFinish:c,children:[t.jsxs(dd,{children:[t.jsxs(ld,{level:4,children:[t.jsx(yu,{})," Información del Negocio"]}),t.jsxs(Je,{children:[t.jsx(M.Item,{name:"businessType",label:"Tipo de Negocio",rules:[{required:!0,message:"Por favor, selecciona el tipo de negocio"}],children:t.jsxs(ge,{placeholder:"Selecciona el tipo de negocio",children:[t.jsx(cd,{value:"general",children:"General"}),t.jsx(cd,{value:"pharmacy",children:"Farmacia"})]})}),t.jsx(M.Item,{name:"name",label:"Nombre del Negocio",rules:[{required:!0,message:"Por favor, ingresa el nombre del negocio"}],children:t.jsx(ie,{placeholder:"Nombre del negocio"})}),t.jsx(M.Item,{name:"rnc",label:"RNC",children:t.jsx(ie,{placeholder:"Ingresa el RNC"})})]})]}),t.jsxs(dd,{children:[t.jsxs(ld,{level:4,children:[t.jsx(u0,{})," Contacto"]}),t.jsx(Je,{children:t.jsxs(ax,{children:[t.jsx(M.Item,{name:"email",label:"Correo electrónico",children:t.jsx(ie,{placeholder:"ejemplo@dominio.com"})}),t.jsx(M.Item,{name:"tel",label:"Teléfono",rules:[{required:!0,message:"Por favor, ingresa el teléfono"}],children:t.jsx(ie,{placeholder:"55 1234 5678"})})]})})]}),t.jsxs(dd,{children:[t.jsxs(ld,{level:4,children:[t.jsx(uc,{})," Ubicación"]}),t.jsxs(Je,{children:[t.jsxs(ax,{children:[t.jsx(M.Item,{name:"country",label:"País",children:t.jsx(ge,{placeholder:"Selecciona un país",children:l1.map(d=>t.jsx(cd,{value:d.id,children:d.name},d.id))})}),t.jsx(M.Item,{name:"province",label:"Provincia/Estado",children:t.jsx(ie,{placeholder:"Provincia o Estado"})})]}),t.jsx(M.Item,{name:"address",label:"Dirección",rules:[{required:!0,message:"Por favor, ingresa la dirección"}],children:t.jsx(ie,{placeholder:"Calle 123, Colonia, Ciudad, Estado"})})]})]}),t.jsxs(Que,{children:[t.jsx(U,{onClick:()=>n("/settings"),style:{marginRight:8},children:"Cancelar"}),t.jsx(U,{type:"primary",htmlType:"submit",loading:r,children:"Crear Negocio"})]})]})})]})},Gue=l.div`
  display: grid;
  max-height: 100vh;
  grid-template-rows: min-content 1fr;
  overflow: hidden;
  background: #f5f5f5;
`,_ue=l.div`
  padding: 24px;
  width: 100%;
  overflow-y: auto;
`,Hue=l(M)`
  max-width: 900px;
  margin: 0 auto;
  background: transparent;
`,dd=l.div`
  margin-bottom: 32px;

  .ant-card {
    border-radius: 8px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
  }

  .ant-typography {
    margin-bottom: 16px;
  }
`,ax=l.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;

  @media (max-width: 768px) {
    grid-template-columns: 1fr;
  }
`;l.div`
  display: flex;
  justify-content: center;
  margin-bottom: 24px;

  .avatar-uploader {
    .ant-upload {
      width: 300px !important;
      height: 150px !important;
      border-radius: 8px;
      background: #fafafa;
      border: 2px dashed #d9d9d9;
      transition: all 0.3s ease;

      &:hover {
        border-color: #1890ff;
      }
    }
  }
`;l.div`
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  
  img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    border-radius: 4px;
  }
`;const Que=l.div`
  display: flex;
  justify-content: flex-end;
  margin-top: 24px;
  
  button {
    min-width: 100px;
  }
`;l.div`
      width: 100%;
  position: relative;
`;l.label`
     font-size: 13px;
 color: var(--Gray5);
`;l.div`
    font-size: 1em;
    display: grid;
    gap: 0.4em;
    
  

  
    overflow: auto;
    padding: 8px;

    & > p {
        height: 2em;
        display: flex;
        align-items: center;
        justify-content: center;
        ${({error:e})=>e&&`
        background-color: var(--color-danger-light);
        color: var(--color-danger-dark);
        border-radius: var(--border-radius);
        border: var(--border-danger);
        `}
    }
`;l.div`
max-width: 600px;
`;l.div`
h3{
    padding: 1em;
}
`;l.div`
padding: 1.8em 1.5em;
display: grid;
grid-template-columns: 1fr;
gap: 1.8em;
min-height: 340px;
align-items: start;
align-content: start;
`;l.div`
    display: flex;
    justify-content: end;
    padding: 0 1em;
`;l.div`
    display: grid;
    grid-template-columns: repeat(2, 1fr);
`;const Yue=[{Header:"#",accessor:"number",align:"left",description:"número",maxWidth:"0.2fr",minWidth:"60px"},{Header:"Nombre",accessor:"name",align:"left",maxWidth:"1fr",minWidth:"150px"},{Header:"Fecha de Creación",accessor:"createAt",align:"left",cell:({value:e})=>{const n=(e==null?void 0:e.seconds)*1e3;return ce.fromMillis(n).toLocaleString(ce.DATETIME_MED)}},{Header:"Rol",accessor:"role",align:"left",cell:({value:e})=>{const n=pn.find(s=>s.id===e)||{};return t.jsx(Kue,{primaryColor:n.primaryColor,secondaryColor:n.secondaryColor,children:Ese(e)})}},{Header:"Estado",accessor:"active",align:"left",description:"¿Esta Activo?",maxWidth:"0.4fr",minWidth:"100px"}],cx=()=>{const[e,n]=m.useState([]),s=D(q),o=W(),{abilities:r}=rs();m.useEffect(()=>{kv(s,n)},[s]);const i=e.map(({user:c},d)=>({number:c.number,name:c.name,createAt:c.createAt,role:c.role,active:c.active?"Activo":"inactivo",user:c})),a=c=>{r.can("manage","User")&&(o(lR(c)),o(ri({isOpen:!0,data:c})))};return!r.can("read","User")&&!r.can("manage","User")?t.jsx("div",{children:"No tienes permisos para ver la lista de usuarios."}):t.jsx(rn,{tableName:"Usuarios",data:i,columns:Yue,pagination:!0,onRowClick:r.can("manage","User")?c=>a(c.user):void 0})},Kue=l.div`
    height: 2em;
   
    border-radius: 100px;
    width: fit-content;
  display: flex;
  text-transform: capitalize;
  align-items: center;
  padding: 0 1em;
  color: ${e=>e.primaryColor};
  background-color: ${e=>e.secondaryColor};
  border: 2px solid ${e=>e.primaryColor};

  font-weight: 600;

      `;function Cr(e,n){const s=n.endsWith("/")?n:`${n}/`;return e.replace(s,"")}const{SETTINGS:u1,USERS:lx,USERS_LIST:Jue,TAX_RECEIPT:Xue,SETTING:vo,APP_INFO:Zue,BUSINESS_INFO:epe,CREATE_BUSINESS:tpe,GENERAL_CONFIG_APP_INFO:npe,GENERAL_CONFIG_BILLING:spe,GENERAL_CONFIG_BUSINESS:ope,GENERAL_CONFIG_TAX_RECEIPT:rpe,GENERAL_CONFIG_USERS:ipe}=re.SETTING_TERM,ud=u1,ape=[{path:u1,element:t.jsx(G_,{})},{path:lx,element:t.jsx(aQ,{}),name:lx,children:[{path:Jue,element:t.jsx(cx,{})}]},{path:`${vo}`,element:t.jsx(xue,{}),children:[{path:"",element:t.jsx(sx,{})},{path:Cr(spe,vo),element:t.jsx(sx,{})},{path:Cr(ope,vo),element:t.jsx(rx,{})},{path:Cr(rpe,vo),element:t.jsx(Sg,{})},{path:Cr(ipe,vo),element:t.jsx(cx,{})},{path:Cr(npe,vo),element:t.jsx(ox,{})}]},{path:`${ud}${Xue}`,element:t.jsx(Sg,{})},{path:`${ud}${epe}`,element:t.jsx(rx,{})},{path:`${tpe}`,element:t.jsx(d1,{})},{path:`${ud}${Zue}`,element:t.jsx(ox,{})},{path:re.DEV_VIEW_TERM.SWITCH_BUSINESS,element:t.jsx(Gde,{})}],cpe=l.div`
  display: grid;
  height: calc(100vh - 2.75em);
  max-height: 100vh;
`,lpe=l.main`
  flex-grow: 1;
  display: grid;
  grid-template-rows: auto 1fr;
  max-width: 112rem; 
  margin: 0 auto;
  overflow: auto;
`,dpe=({children:e})=>t.jsx(cpe,{children:t.jsx(lpe,{children:e})}),upe=l.input`
  width: 100%;
  padding: 0.5rem 0.75rem;
  border: 1px solid #D1D5DB; /* border-gray-300 */
  border-radius: 0.375rem;
  font-size: 1rem;
  color: #1F2937; /* text-gray-900 */
  
  &:focus {
    outline: none;
    border-color: #3B82F6; /* focus:border-blue-500 */
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); /* focus:shadow-outline-blue */
  }
`,ppe=e=>t.jsx(upe,{...e}),mpe=l.div`
  position: relative;
`,hpe=l(O)`
  position: absolute;
  left: 0.5rem;
  top: 50%;
  transform: translateY(-50%);
  color: #6B7280; /* text-muted-foreground */
  height: 1rem;
  width: 1rem;
`,gpe=l(ppe)`
  padding-left: 2rem; /* pl-8 */
`,fpe=({searchTerm:e,onSearch:n})=>{const s=o=>{n(o.target.value)};return t.jsxs(mpe,{children:[t.jsx(hpe,{icon:hu}),t.jsx(gpe,{type:"text",placeholder:"Buscar por cliente, ID o artículo...",value:e,onChange:s})]})},xpe=({color:e,children:n})=>t.jsx(Ge,{style:{fontSize:"16px",padding:"5px"},color:e,title:"Hola",children:n}),{Modal:bpe,Button:dx}=Ne,ype=({open:e,onConfirm:n,onCancel:s,title:o,message:r,danger:i=!1,type:a,confirmText:c="Confirmar",cancelText:d="Cancelar",data:u})=>{const p=()=>{switch(a){case"danger":return"danger";case"warning":return"warning";default:return"primary"}};return t.jsx(bpe,{title:o,open:e,onOk:()=>n(u),onCancel:s,footer:[t.jsx(dx,{onClick:s,children:d},"cancel"),t.jsx(dx,{danger:i,type:p(),onClick:()=>n(u),children:c},"confirm")],children:t.jsx("p",{style:{minHeight:"100px",maxWidth:"400px",margin:"0 10px",display:"grid",placeItems:"center"},children:r})})};async function vpe(e,n){var s;try{if(!((s=n==null?void 0:n.preorderDetails)!=null&&s.isOrWasPreorder)||!(n!=null&&n.status)=="pending")throw new Error("Preorder details are missing or invalid.");const o={type:"preorder",status:"cancelled",date:ue.now(),userID:e.uid},r={...n,status:"cancelled",date:de(),userID:e.uid,history:Vr(o),cancel:{reason:"cancelled",user:e.uid,cancelledAt:de()}},i=F($,"businesses",e==null?void 0:e.businessID,"invoices",r==null?void 0:r.id);return await je(i,{data:r}),r}catch(o){console.error("Error al generar la factura:",o)}}const{Modal:jpe,Button:Cpe,Table:wpe,Tag:Spe,Typography:Ipe,Divider:Epe,Input:Ape}=Ne,{Title:na,Text:an}=Ipe,{TextArea:ZCe}=Ape,kpe=l(jpe)`
  .ant-modal-content {
    max-width: 800px;
  }
`,sa=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,oa=l.div`
  border: 1px solid #f0f0f0;
  padding: 16px;
  border-radius: 4px;
  margin-bottom: 24px;
`,Tpe=l.div`
    display: grid;
    gap: 1em;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
`,ra=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`;function Ppe(){const[e,n]=m.useState(!1),[s,o]=m.useState(null),[r,i]=m.useState("");if(m.useEffect(()=>{fetch("https://hebbkx1anhila5yf.public.blob.vercel-storage.com/snippet-kLsSWKTzqCrT9GtLcfVJoFlCwQoqRH.txt").then(d=>d.json()).then(d=>o(d[0].data)).catch(d=>console.error("Error fetching data:",d))},[]),!s)return null;const a=d=>{switch(d.toLowerCase()){case"pending":return"volcano";case"completed":return"green";default:return"gray"}},c=d=>{switch(d.toLowerCase()){case"pending":return"Pendiente";case"completed":return"Completado";default:return"Desconocido"}};return t.jsxs(t.Fragment,{children:[t.jsx(Cpe,{icon:z.editingActions.show,type:"default",onClick:()=>n(!0)}),t.jsx(kpe,{title:"Detalles del Pedido",visible:e,onCancel:()=>n(!1),footer:null,width:800,children:t.jsxs("div",{children:[t.jsxs(Tpe,{children:[t.jsxs(oa,{children:[t.jsx(sa,{children:t.jsxs(ra,{children:[t.jsx(na,{level:5,style:{margin:"0 1em 0 0"},children:"Estado del Pedido"}),t.jsx(Spe,{color:a(s.status),children:c(s.status)})]})}),t.jsx("div",{style:{marginTop:16},children:t.jsxs(an,{strong:!0,style:{fontSize:"18px",display:"block"},children:["Pedido #",s.preorderDetails.numberID]})})]}),t.jsxs(oa,{children:[t.jsx(sa,{children:t.jsxs(ra,{children:[t.jsx(dc,{style:{marginRight:8}}),t.jsx(na,{level:5,style:{margin:0},children:"Información del Cliente"})]})}),t.jsxs("div",{style:{marginTop:16},children:[t.jsx(an,{strong:!0,children:s.client.name}),t.jsx("br",{}),t.jsxs(an,{children:[t.jsx("strong",{children:"Teléfono:"})," ",s.client.tel||"N/A"]}),t.jsx("br",{}),t.jsx(an,{type:"secondary",children:s.client.address})]})]})]}),t.jsxs(oa,{children:[t.jsx(sa,{children:t.jsxs(ra,{children:[t.jsx(dS,{style:{marginRight:8}}),t.jsx(na,{level:5,style:{margin:0},children:"Productos"})]})}),t.jsx(wpe,{columns:[{title:"Nombre",dataIndex:"name",key:"name",render:d=>t.jsx(an,{strong:!0,children:d})},{title:"Tamaño",dataIndex:"size",key:"size"},{title:"Cantidad",dataIndex:"amountToBuy",key:"amountToBuy"},{title:"Precio",dataIndex:["pricing","price"],key:"price",align:"right",render:d=>`$${d.toFixed(2)}`}],dataSource:s.products,rowKey:(d,u)=>u,pagination:!1,style:{marginTop:16}})]}),t.jsxs(oa,{children:[t.jsx(sa,{children:t.jsxs(ra,{children:[t.jsx(s0,{style:{marginRight:8}}),t.jsx(na,{level:5,style:{margin:0},children:"Resumen de Pago"})]})}),t.jsxs("div",{style:{marginTop:16},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx(an,{children:"Subtotal"}),t.jsx(an,{children:Y(s.totalPurchase.value-s.delivery.value)})]}),s.delivery.status&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx(an,{children:"Entrega"}),t.jsx(an,{children:Y(s.delivery.value)})]}),t.jsx(Epe,{}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold"},children:[t.jsx(an,{children:"Total"}),t.jsx(an,{children:Y(s.totalPurchase.value)})]})]})]})]})})]})}const Dpe=({value:e})=>{var d,u,p;const n=W(),s=e.data,o=D(q),[r,i]=m.useState(!1),a=async()=>{try{await vpe(o,s),i(!1)}catch{}},c=()=>{const{isValid:h,message:f}=$r(s);h?(n(Qu()),n(wD(s)),n(Yb())):Be.error({description:f})};return t.jsxs("div",{style:{display:"flex",gap:"10px"},children:[t.jsx(Ppe,{}),t.jsx(U,{icon:z.editingActions.complete,onClick:c}),t.jsx(U,{icon:z.editingActions.cancel,onClick:()=>i(!0),danger:!0}),t.jsx(ype,{open:r,onConfirm:()=>a(),onCancel:()=>i(!1),title:"Cancelar Preorden",message:`¿Estás seguro de que deseas cancelar la preorden ${(d=s==null?void 0:s.preorderDetails)==null?void 0:d.numberID} para el cliente ${(u=s==null?void 0:s.client)==null?void 0:u.name}?`,confirmText:"Cancelar Preorden",cancelText:"Volver",danger:!0,data:(p=s==null?void 0:s.preorderDetails)==null?void 0:p.numberID})]})},$pe=e=>({pending:"orange",completed:"green",cancelled:"red"})[e]||"gray",Rpe=[{Header:"N°",accessor:"numberID",sortable:!0,align:"left",maxWidth:"0.4fr",minWidth:"120px"},{Header:"Cliente",accessor:"client",sortable:!0,align:"left",maxWidth:"1.6fr",minWidth:"170px"},{Header:"Fecha",accessor:"date",sortable:!0,align:"left",cell:({value:e})=>{const n=e*1e3;return Od(n,0)},maxWidth:"1fr",minWidth:"160px"},{Header:"ITBIS",accessor:"itbis",align:"right",cell:({value:e})=>Y(e),maxWidth:"1fr",minWidth:"100px"},{Header:"Articulos",accessor:"products",align:"right",description:"Artículos en la preventa",maxWidth:"1fr",minWidth:"100px"},{Header:"Total",accessor:"total",align:"right",cell:({value:e})=>Y(e),description:"Monto total de la preventa",maxWidth:"1fr",minWidth:"110px"},{Header:"Estatus",accessor:"status",align:"right",description:"Estatus de la preventa",maxWidth:"1fr",minWidth:"100px",cell:({value:e})=>{const n=e==="pending"?"Pendiente":e==="completed"?"Completada":"Cancelada";return t.jsx(xpe,{color:$pe(e),children:n})}},{Header:"Acción",align:"right",accessor:"accion",description:"Acciones disponibles",maxWidth:"1fr",minWidth:"80px",cell:({value:e})=>t.jsx(Dpe,{value:e})}],Npe=({preSales:e=[],searchTerm:n})=>{const s=e==null?void 0:e.map(({data:r})=>{var a,c,d,u,p,h;const i=r==null?void 0:r.NCF;return{numberID:(a=r==null?void 0:r.preorderDetails)==null?void 0:a.numberID,ncf:r==null?void 0:r.NCF,client:(c=r==null?void 0:r.client)==null?void 0:c.name,date:(u=(d=r==null?void 0:r.preorderDetails)==null?void 0:d.date)==null?void 0:u.seconds,itbis:$s((r==null?void 0:r.products)||[]),products:Lu((r==null?void 0:r.products)||[]),status:r==null?void 0:r.status,total:zu((r==null?void 0:r.products)||[],0,0,i),accion:{data:r},dateGroup:ce.fromMillis(((h=(p=r==null?void 0:r.preorderDetails)==null?void 0:p.date)==null?void 0:h.seconds)*1e3).toLocaleString(ce.DATE_FULL)}}),o=Y(e==null?void 0:e.reduce((r,{data:i})=>{var a;return r+((a=i==null?void 0:i.totalPurchase)==null?void 0:a.value)},0));return t.jsx(rn,{columns:Rpe,data:s,groupBy:"dateGroup",emptyText:"No se encontraron preventas.",footerLeftSide:t.jsxs(Ope,{children:["Total: ",o," "]}),searchTerm:n,elementName:"preventas",tableName:"Preventas",numberOfElementsPerPage:40})},Ope=l.div`
  display: flex;
  justify-content: flex-end;
  align-items: center;
  padding: 0.2em 0.5em;
  gap: 0.5em;
  font-size: 1em;
  font-weight: 600;
`;async function Mpe(e,n){try{const s=le($,"businesses",e.businessID,"invoices"),o=he(s,te("data.status","==","pending"),te("data.preorderDetails.isOrWasPreorder","==",!0),it("data.preorderDetails.date","desc"));return Te(o,i=>{const a=i.docs.map(c=>c.data());n(a)})}catch(s){return console.error("Error fetching preorders: ",s),()=>{}}}const Fpe=l.div`
  margin: 1rem;
`,Bpe=()=>{const[e,n]=m.useState(""),[s,o]=m.useState(),[r,i]=m.useState([]),a=D(q);m.useEffect(()=>{if(!a||!a.businessID)return;let d=()=>{};return Mpe(a,i).then(u=>{d=u}),()=>{d()}},[a]);const c=d=>{const u=d.toLowerCase();n(d);const p=r.filter(h=>{var g,y,b,v,C,I;const f=(b=(y=(g=h==null?void 0:h.data)==null?void 0:g.client)==null?void 0:y.name)==null?void 0:b.toLowerCase(),x=(I=(C=(v=h==null?void 0:h.data)==null?void 0:v.products)==null?void 0:C.map(j=>{var k;return(k=j==null?void 0:j.name)==null?void 0:k.toLowerCase()}))==null?void 0:I.join(" ");return f.includes(u)||x.includes(u)});o(p)};return m.useEffect(()=>{c(e)},[r,e]),t.jsxs(Lpe,{children:[t.jsx(Ze,{sectionName:"Pre-ventas"}),t.jsxs(dpe,{children:[t.jsx(Fpe,{children:t.jsx(fpe,{searchTerm:e,onSearch:c})}),t.jsx(Npe,{preSales:s,searchTerm:e})]}),t.jsx(yj,{})]})},Lpe=l.div`
  max-height: 100vh;
  overflow: hidden;
`,{SALES:zpe,BILLS:Upe,CASH_RECONCILIATION:Wpe,PREORDERS:qpe}=re.SALES_TERM,Vpe=[{path:zpe,element:t.jsx(ZV,{}),title:"Ventas - Ventamax",metaDescription:"Realiza y gestiona ventas con escaneo de códigos de barras y control eficiente."},{path:Upe,element:t.jsx(X3,{}),title:"Facturas de Ventas - Ventamax",metaDescription:"Consulta, registra y gestiona las facturas relacionadas con las ventas en Ventamax POS."},{path:Wpe,element:t.jsx(Tv,{}),title:"Cuadre de Caja - Ventamax",metaDescription:"Realiza el cuadre de caja en Ventamax POS. Revisa, concilia y cierra el flujo de efectivo diario para asegurar la precisión de las transacciones."},{path:qpe,element:t.jsx(Bpe,{}),title:"Preventas - Ventamax",metaDescription:"Revisa, gestiona y convierte las preventas en Ventamax POS. Explora las opciones para cancelar o convertir preventas en facturas fácilmente."}],Gpe=l.div`
  max-height: 300px;
  overflow-y: auto;
`,_pe=l.div`
  display: flex;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #f0f0f0;
  
  &:hover {
    background-color: #f5f5f5;
  }
`,Hpe=l.div`
  flex: 1;
  margin-left: 10px;
`;l.span`
  color: #888;
  font-size: 12px;
  margin-left: 10px;
`;const Qpe=l.button`
  background: none;
  border: none;
  color: #ff4d4f;
  cursor: pointer;
  padding: 5px;
  
  &:hover {
    color: #cf1322;
  }
`,ux=l(Ge)`
  margin-left: 8px;
  font-size: 11px;
`,Ype=l.div`
  margin-bottom: 16px;
`,Kpe=l.button`
  background: none;
  border: none;
  color: #1890ff;
  cursor: pointer;
  padding: 5px;
  margin-right: 8px;
  
  &:hover {
    color: #40a9ff;
  }
`,Jpe=l.h4`
  margin: 12px 0;
  color: #666;
  font-weight: 500;
`,Xpe=l.span`
  margin-right: 8px;
  font-size: 16px;
  display: flex;
  align-items: center;
`,p1=({files:e=[],removeFile:n,handlePreview:s})=>{const o=d=>({receipts:"green",invoices:"blue",others:"orange"})[d==null?void 0:d.toLowerCase()]||"default",r=d=>{const u=d.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif"].includes(u)},i=d=>d.split(".").pop().toLowerCase()==="pdf",a=m.useMemo(()=>{const d={receipts:{title:"Recibos",files:[]},invoices:{title:"Facturas",files:[]},others:{title:"Otros Documentos",files:[]}};return e==null||e.forEach(u=>{var f;const p=((f=u.type)==null?void 0:f.toLowerCase())||"others";(d[p]||d.others).files.push(u)}),Object.entries(d).filter(([u,p])=>p.files.length>0)},[e]),c=d=>t.jsxs(_pe,{children:[t.jsx(Xpe,{children:r(d.name)?t.jsx(ts,{style:{color:"#52c41a"}}):i(d.name)?t.jsx(ns,{style:{color:"#ff4d4f"}}):t.jsx(no,{})}),t.jsxs(Hpe,{children:[t.jsx(Oe,{title:d.name,children:d.name}),t.jsx(ux,{color:o(d.type),children:d.type}),t.jsx(ux,{color:d.url?"purple":"blue",children:d.url?"Remoto":"Local"})]}),t.jsxs("div",{children:[(r(d.name)||i(d.name))&&t.jsx(Kpe,{onClick:()=>s(d),children:t.jsx(zo,{})}),n&&t.jsx(Qpe,{onClick:()=>n(d.id||d.url),children:t.jsx(ht,{})})]})]},d.id||d.url);return e!=null&&e.length?t.jsx(Gpe,{children:a.map(([d,u])=>t.jsxs(Ype,{children:[t.jsx(Jpe,{children:u.title}),u.files.map(c)]},d))}):t.jsx(Lt,{description:"No hay archivos adjuntos"})};p1.defaultProps={files:[],removeFile:()=>{},handlePreview:()=>{}};const Zpe=sn`
  from { opacity: 0; }
  to { opacity: 1; }
`,eme=sn`
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
`,tme=l.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  visibility: ${e=>e.isDragging?"visible":"hidden"};
  opacity: ${e=>e.isDragging?1:0};
  transition: all 0.3s ease-in-out;
  animation: ${Zpe} 0.3s ease-in-out;
`,nme=l.div`
  background: rgba(255, 255, 255, 0.95);
  padding: 48px 64px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  transform: scale(${e=>e.isDragging?"1.02":"1"});
  transition: transform 0.2s ease-in-out;

  .icon-wrapper {
    animation: ${eme} 2s infinite ease-in-out;
    margin-bottom: 20px;
  }

  h3 {
    margin: 16px 0;
    color: #1890ff;
    font-size: 24px;
    font-weight: 600;
  }

  p {
    color: #666;
    font-size: 16px;
    margin: 8px 0;
  }
`,sme=e=>{switch(e.toLowerCase()){case"imagen":return t.jsx(ts,{style:{fontSize:56,color:"#1890ff"}});case"pdf":return t.jsx(ns,{style:{fontSize:56,color:"#1890ff"}});default:return t.jsx(ss,{style:{fontSize:56,color:"#1890ff"}})}},ome=({isDragging:e,onDrop:n,onDragOver:s,onDragLeave:o,fileType:r})=>t.jsx(tme,{isDragging:e,onDrop:n,onDragOver:s,onDragLeave:o,children:t.jsxs(nme,{isDragging:e,children:[t.jsx("div",{className:"icon-wrapper",children:sme(r)}),t.jsx("h3",{children:"Arrastra y suelta tus archivos aquí"}),t.jsxs("p",{children:["Suelta los archivos para agregarlos como ",r]})]})}),rme=l.div`
  max-width: 100%;
  height: 100%;
`,ime=l.div`
  height: 100%;
  margin: 0;
  padding: 0;
  width: 100%;
  
  embed {
    width: 100%;
    height: 100%;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 4px;
  }
`,ame=({previewFile:e,previewVisible:n,setPreviewVisible:s,setPreviewFile:o})=>{const r=()=>{if(!e)return null;const i=e.name.split(".").pop().toLowerCase(),a=e.url||e.preview||e.file&&URL.createObjectURL(e.file);return["jpg","jpeg","png","gif"].includes(i)?t.jsx(Lo,{src:a,alt:e.name,style:{maxWidth:"100%",height:"auto"}}):i==="pdf"?t.jsx(ime,{children:t.jsx("embed",{src:`${a}#toolbar=1&navpanes=1&scrollbar=1&zoom=100`,type:"application/pdf"})}):t.jsx("p",{children:"No hay vista previa disponible para este tipo de archivo"})};return m.useEffect(()=>{let i;return(e==null?void 0:e.file)instanceof File&&(i=URL.createObjectURL(e.file)),()=>{i&&URL.revokeObjectURL(i)}},[e]),t.jsx(Rt,{open:n,onClose:()=>{s(!1),o(null)},width:"80%",height:"100%",title:e==null?void 0:e.name,placement:"bottom",footer:null,styles:{content:{height:"100%",padding:0,margin:0},body:{padding:"0",margin:"0",height:"100%",overflow:"hidden"}},children:t.jsx(rme,{children:r()})})},cme=({lightboxOpen:e,setLightboxOpen:n,lightboxIndex:s,setLightboxIndex:o,getImageFiles:r})=>t.jsx(mc,{open:e,close:()=>n(!1),index:s,slides:r(),plugins:[hc,gc,fc],carousel:{spacing:0,padding:0,imageFit:"contain"},zoom:{wheelZoomDistanceFactor:100,pinchZoomDistanceFactor:100,scrollToZoom:!0},thumbnails:{position:"bottom",width:120,height:80,gap:2,padding:5},captions:{showToggle:!0,descriptionTextAlign:"left"}}),lme=l.button`
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border: 1px solid #d9d9d9;
  border-radius: 6px;
  background: white;
  cursor: pointer;
  transition: all 0.3s;

  &:hover {
    border-color: #1890ff;
    color: #1890ff;
  }
`,dme=({onFileInput:e})=>t.jsxs(t.Fragment,{children:[t.jsxs(lme,{onClick:()=>document.getElementById("fileInput").click(),children:[t.jsx(ss,{}),"Cargar"]}),t.jsx("input",{id:"fileInput",type:"file",multiple:!0,onChange:e,style:{display:"none"}})]}),{Option:ume}=ge,pme=[{value:"receipts",label:"Recibos"},{value:"invoices",label:"Facturas"},{value:"others",label:"Otros"}],mme=({fileType:e,setFileType:n,handleFileInput:s})=>s?t.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"16px"},children:[t.jsx(M.Item,{label:"Tipo",children:t.jsx(ge,{value:e,style:{width:120},onChange:o=>n(o),children:pme.map(o=>t.jsx(ume,{value:o.value,children:o.label},o.value))})}),t.jsx(M.Item,{label:"Adjuntar Evidencia",children:t.jsx(dme,{onFileInput:s})})]}):null,hme=({files:e=[],attachmentUrls:n=[],onAddFiles:s=null,onRemoveFiles:o=null,showFileList:r=!0})=>{const[i,a]=m.useState("receipts"),[c,d]=m.useState(!1),[u,p]=m.useState(null),[h,f]=m.useState(!1),[x,g]=m.useState(!1),[y,b]=m.useState(0);m.useEffect(()=>{const w=E=>{E.preventDefault(),d(!0)},S=E=>{E.preventDefault(),E.relatedTarget===null&&d(!1)};return window.addEventListener("dragenter",w),window.addEventListener("dragleave",S),()=>{window.removeEventListener("dragenter",w),window.removeEventListener("dragleave",S)}},[]);const v=w=>{w.preventDefault(),d(!1);const S=Array.from(w.dataTransfer.files);I(S)},C=w=>{const S=Array.from(w.target.files);I(S)},I=w=>{const S=w.map(E=>({file:E,type:i,id:Math.random().toString(36).substr(2,9),name:E.name,isLocal:!0}));s(S),V.success(`${w.length} archivo(s) agregado(s)`)},j=w=>{o(w)},k=m.useCallback(()=>{const w=[];return e.forEach(S=>{Vt(S.name)&&w.push({src:nn(S.file),title:S.name,description:`Tipo: ${S.type}`})}),n.filter(S=>{var E;return(E=S.url)==null?void 0:E.includes("firebasestorage.googleapis.com")}).forEach(S=>{Vt(S.name)&&w.push({src:S.url,title:S.name,description:`Tipo: ${S.type}`})}),w},[e,n]),A=m.useMemo(()=>{const w=(e||[]).map(E=>({...E,isLocal:!0,preview:E.file?nn(E.file):null})),S=(n||[]).filter(E=>{var T;return(T=E.url)==null?void 0:T.includes("firebasestorage.googleapis.com")}).map(E=>({id:E.id||Math.random().toString(36).substr(2,9),name:E.name||"Archivo sin nombre",type:E.type||Nc(E.url),url:E.url,isLocal:!1}));return[...w,...S]},[e,n]);m.useEffect(()=>()=>{A.filter(w=>w.isLocal&&w.preview).forEach(w=>{Rc(w.preview)})},[A]);const P=m.useCallback(w=>{if(!w)return;const S=Vt(w.name),E=di(w.name);if(S){const R=k().findIndex(N=>N.title===w.name&&N.src===(w.url||w.file&&nn(w.file)));b(Math.max(0,R)),g(!0)}else E&&(p(w),f(!0))},[k]);return t.jsxs("div",{children:[s&&t.jsx(mme,{fileType:i,setFileType:a,handleFileInput:C}),r&&t.jsx(p1,{files:A,removeFile:o?j:null,handlePreview:P}),t.jsx(ame,{previewFile:u,previewVisible:h,setPreviewVisible:f,setPreviewFile:p}),t.jsx(cme,{lightboxOpen:x,setLightboxOpen:g,lightboxIndex:y,setLightboxIndex:b,getImageFiles:k}),t.jsx(ome,{isDragging:c,onDrop:v,onDragOver:w=>w.preventDefault(),onDragLeave:w=>{w.preventDefault(),w.relatedTarget===null&&d(!1)},fileType:i})]})},gme=({editing:e,dataIndex:n,title:s,inputType:o,record:r,index:i,children:a,onSave:c,onCloseEdit:d,setDateModalVisible:u,setSelectedRecord:p,onCellClick:h,...f})=>{const x=()=>o==="number"?t.jsx(Ke,{onBlur:y=>c(r,n,y.target.value),autoFocus:!0}):o==="date"?a:t.jsx(ie,{onBlur:y=>c(r,n,y.target.value),autoFocus:!0}),g=()=>{var y;if(o==="date"&&r.editable!==!1){p(r),u(!0);return}(y=f.onClick)==null||y.call(f)};return t.jsx("td",{...f,onClick:h||g,style:{cursor:"pointer"},children:e?t.jsx(M.Item,{name:n,style:{margin:0},noStyle:!0,rules:["freight","otherCosts"].includes(n)?[]:[{required:!0}],children:x()}):t.jsx("div",{className:"editable-cell-value-wrap",style:{paddingRight:24,whiteSpace:"nowrap"},children:a})})},fme=({products:e,removeProduct:n,onEditProduct:s,onQuantityClick:o})=>{const[r,i]=m.useState({row:"",col:""}),[a,c]=m.useState(!1),[d,u]=m.useState(null),[p]=M.useForm(),h=(v,C)=>r.row===v.key&&r.col===C,f=(v,C)=>{const I=v[C],j=C==="expirationDate"&&I?We(I):I;p.setFieldsValue({[C]:j}),i({row:v.key,col:C})},x=(v,C,I)=>{const j=C==="expirationDate"?I?Number(I):null:I,k={...v,[C]:j};if(C==="quantity")if(!v.selectedBackOrders||v.selectedBackOrders.length===0)k.quantity=Number(j)||0,k.purchaseQuantity=Number(j)||0;else{const A=v.selectedBackOrders.reduce((P,w)=>P+w.quantity,0);k.quantity=Number(j)||0,k.purchaseQuantity=(Number(j)||0)+A}else k[C]=j;s({...k,index:v.key}),i({row:"",col:""})},g=v=>{if(d){const C=v?v.startOf("day").valueOf():null;x(d,"expirationDate",C)}c(!1),u(null)},b=[{title:"Producto",dataIndex:"name",width:200,ellipsis:{showTitle:!0},render:v=>t.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:v})},{title:"Cantidad",dataIndex:"quantity",render:v=>v,editable:!0},{title:"Costo Base",dataIndex:"baseCost",render:v=>Ut(v),editable:!0},{title:"Costo Unitario",dataIndex:"unitCost",render:v=>Ut(v)},{title:"Subtotal",dataIndex:"subtotal",fixed:"right",render:v=>Ut(v)},{title:"Acciones",key:"actions",fixed:"right",render:(v,C)=>t.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"end"},children:t.jsx(U,{icon:t.jsx(ht,{}),danger:!0,onClick:()=>n(C.id)})})}].map(v=>v.editable?{...v,onCell:C=>({record:C,inputType:v.dataIndex==="expirationDate"?"date":["quantity","baseCost","taxPercentage","freight","otherCosts"].includes(v.dataIndex)?"number":"text",dataIndex:v.dataIndex,title:v.title,editing:h(C,v.dataIndex),onSave:x,...v.dataIndex==="quantity"?{onCellClick:()=>{o&&C.selectedBackOrders&&C.selectedBackOrders.length>0?o(C):f(C,v.dataIndex)}}:{onClick:()=>f(C,v.dataIndex)},onCloseEdit:()=>i({row:"",col:""}),setDateModalVisible:c,setSelectedRecord:u})}:v);return t.jsxs(t.Fragment,{children:[t.jsx(M,{form:p,component:!1,children:t.jsx(Gt,{components:{body:{cell:gme}},className:"editable-row-table",size:"small",scroll:{x:1300},columns:b,dataSource:e.map((v,C)=>({...v,key:C})),rowKey:(v,C)=>C,onRow:()=>({})})}),t.jsx(Ce,{title:"Seleccionar fecha de vencimiento",open:a,onCancel:()=>{c(!1),u(null)},footer:null,children:t.jsx(yt,{style:{width:"100%"},format:"DD/MM/YY",value:d!=null&&d.expirationDate?We(d.expirationDate):null,onChange:g})})]})},xme=l.div`
  padding: 1em 0;
`,bme=l(xme)`
  background: #fafafa;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-bottom: 16px;
`,yme=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  justify-items: center;
  gap: 16px;
  @media (max-width: 768px) {
    justify-items: start;
  }
`,cu=l(vn)`
  .ant-statistic-title {
    color: #8c8c8c;
    font-size: 14px;
  }
  .ant-statistic-content {
    color: #262626;
    font-size: 16px;
  }
`,vme=l(cu)`
  color: #cf1322;
  font-weight: bold;
`,jme=({replenishments:e})=>{const s=e.reduce((o,r)=>{const i=Number(r.baseCost),a=Number(r.taxPercentage)||0,c=i*a/100,d=Number(r.freight)||0,u=Number(r.otherCosts)||0,p=Number(r.purchaseQuantity||r.quantity),h=(i+c+d+u)*p;return{totalProducts:o.totalProducts+Number(r.quantity),totalBaseCost:o.totalBaseCost+i,grandTotal:o.grandTotal+h}},{totalProducts:0,totalBaseCost:0,grandTotal:0});return t.jsx(bme,{children:t.jsxs(yme,{children:[t.jsx(cu,{title:"Total Productos",value:s.totalProducts,prefix:"#"}),t.jsx(cu,{title:"Total Costo Base",value:s.totalBaseCost,prefix:"$",precision:2}),t.jsx(vme,{title:"Gran Total",value:s.grandTotal,prefix:"$",precision:2})]})})},Cme=l.div`
 padding: 0 1em;
`,wme=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
   align-items: start;
   overflow-y: auto;
   padding: 0 1em;
   align-content: start;
  gap: 12px;
`,Sme=l.div`
  background-color: white;
  border: 1px solid #e8e8e8;
  border-radius: 8px;
  padding: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 12px;

  &:hover {

    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
`,Ime=l.div`
  position: relative;
  width: 60px;
  height: 60px;
  flex-shrink: 0;
  background-color: #f5f5f5;
  border-radius: 6px;
  overflow: hidden;

  img, .placeholder-icon {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .placeholder-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #d9d9d9;
    font-size: 20px;
  }
`,Eme=l.div`
  flex: 1;
  min-width: 0; // Importante para que el text-overflow funcione

  .name {
    font-size: 13px;
    font-weight: 500;
    color: #262626;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .barcode {
    font-size: 11px;
    color: #8c8c8c;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,Ame=l.div`
 
  height: 100%;
  overflow: hidden;
  display: grid;
  grid-template-rows: min-content 1fr min-content;
  gap: 8px;
`,kme=l.div`
  display: flex;
  align-items: center;
`,Tme=({onSelect:e,selectedProduct:n})=>{const[s,o]=m.useState(!1),[r,i]=m.useState(""),a=m.useRef(null),[c,d]=m.useState(1),[u,p]=m.useState(14);m.useEffect(()=>{s&&a.current&&setTimeout(()=>{a.current.focus()},100)},[s]);const{products:h,loading:f}=Rs(!0),x=r?$n(h,r):h,g=(c-1)*u,y=c*u,b=x.slice(g,y);function v(I){e(I),i(""),d(1),o(!1),V.success("Product selected")}function C(I){i(I.target.value),d(1)}return t.jsxs("div",{children:[t.jsx(ie,{value:(n==null?void 0:n.name)||"",placeholder:"Search and select a product...",readOnly:!0,onClick:()=>o(!0)}),t.jsx(Rt,{title:"Lista de Productos",placement:"bottom",onClose:()=>o(!1),open:s,loading:f,height:"80%",styles:{body:{padding:"1em"}},width:1e3,children:t.jsxs(Ame,{children:[t.jsx(Cme,{children:t.jsx(ie,{ref:a,placeholder:"Buscar productos...",value:r,onChange:C,style:{width:"100%"}})}),t.jsx(wme,{children:b.map(I=>t.jsxs(Sme,{onClick:()=>v(I),children:[t.jsx(Ime,{children:I.image?t.jsx("img",{src:I.image,alt:I.name}):t.jsx("div",{className:"placeholder-icon",children:t.jsx(O,{icon:Aa})})}),t.jsxs(Eme,{children:[t.jsx("div",{className:"name",children:I==null?void 0:I.name}),t.jsx("div",{className:"barcode",children:I==null?void 0:I.barcode})]})]},I.id))}),t.jsx(kme,{children:t.jsx(Ta,{current:c,showSizeChanger:!1,hideOnSinglePage:!0,simple:{readOnly:!0},total:x.length,onChange:I=>d(I)})})]})})]})},Uc=({backOrders:e,isVisible:n,onCancel:s,onConfirm:o,initialSelectedBackOrders:r=[],initialPurchaseQuantity:i=0,productId:a,backOrderAssociationId:c})=>{const[d,u]=m.useState([]),[p,h]=m.useState(0),f=d.reduce((v,C)=>v+C.quantity,0),x=Math.max(0,p-f);m.useEffect(()=>{n&&(u(r),h(i))},[n]);const g=(v,C)=>{v.target.checked?u(I=>[...I,{id:C.id,quantity:C.pendingQuantity,productId:C.productId,orderId:C.orderId||C.purchaseId}]):u(I=>I.filter(j=>j.id!==C.id))},y=[{title:"Seleccionar",dataIndex:"id",width:100,render:(v,C)=>{const I=C.orderId||C.purchaseId,j=C.status==="reserved"&&(!c||I!==c);return t.jsx(St,{checked:d.some(k=>k.id===C.id),onChange:k=>g(k,C),disabled:j})}},{title:"Estado",dataIndex:"status",width:100,render:(v,C)=>C.status==="reserved"&&C.orderId!==c?"Reservado":v||"Pendiente"},{title:"Cantidad Pendiente",dataIndex:"pendingQuantity",width:150},{title:"Fecha",dataIndex:"createdAt",width:200,render:v=>We(v).format("DD/MM/YYYY HH:mm")}],b=()=>{if(!a){V.error("No se encontró productId");return}if(d.length>0&&p<f){V.error("La cantidad a comprar debe ser mayor o igual a la cantidad total de backorders seleccionados");return}o({id:a,selectedBackOrders:d,purchaseQuantity:p})};return t.jsx(Ce,{title:"Backorders Pendientes",open:n,onOk:b,onCancel:s,width:800,style:{top:10},okText:"Confirmar",cancelText:"Cancelar",children:t.jsxs(Pme,{children:[c,t.jsxs(Dme,{children:[t.jsxs($me,{children:[t.jsx("label",{children:"Cantidad total a comprar:"}),t.jsx(Ke,{value:p,onChange:v=>h(v||0),min:0,style:{width:120}})]}),t.jsxs(Rme,{children:[t.jsxs(px,{children:[t.jsx("label",{children:"BackOrders seleccionados:"}),t.jsxs("span",{children:[f," unidades"]})]}),t.jsxs(px,{children:[t.jsx("label",{children:"Cantidad restante:"}),t.jsxs("span",{children:[x," unidades"]})]})]})]}),d.length>0&&p<f&&t.jsx(Pt,{type:"warning",message:"La cantidad a comprar debe ser mayor o igual a la cantidad total de backorders seleccionados",style:{marginBottom:16}}),t.jsx("p",{children:"Opcionalmente, seleccione los backorders que desea cubrir con esta compra:"}),t.jsx(Gt,{dataSource:e,columns:y,size:"small",pagination:!1,rowKey:"id",scroll:{y:300}})]})})},Pme=l.div`
    display: flex;
    flex-direction: column;
    gap: 16px;
`,Dme=l.div`
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background-color: #f5f5f5;
    border-radius: 4px;
`,$me=l.div`
    display: flex;
    flex-direction: column;
    gap: 4px;

    label {
        font-size: 12px;
        color: #666;
    }
`,Rme=l.div`
    display: flex;
    gap: 24px;
`,px=l.div`
    display: flex;
    flex-direction: column;
    gap: 4px;
    
    label {
        font-size: 12px;
        color: #666;
    }
    
    span {
        font-size: 16px;
        font-weight: 500;
        color: ${e=>e.$warning?"#ff4d4f":"inherit"};
    }
`;function Nme({onSave:e,onClear:n,mode:s}){const o=W(),r=D(q),{id:i}=D(iy),[a]=M.useForm(),[c,d]=m.useState(0),[u,p]=m.useState(0),[h,f]=m.useState(0),[x,g]=m.useState(!1),[y,b]=m.useState(null),[v,C]=m.useState([]),[I,j]=m.useState(!1),[k,A]=m.useState(!1),[P,w]=m.useState(new Set),S=D(i$),E=!!(S!=null&&S.name)||!!(S!=null&&S.id),T=J=>{o(Pm(J)),A(!1),J!=null&&J.id||w(new Set)},R=()=>{const J=a.getFieldsValue(),X=Number(J.baseCost)||0,me=Number(J.taxPercentage)||0,fe=Number(J.freight)||0,se=Number(J.otherCosts)||0,ee=X*me/100;f(ee);const K=X+ee+fe+se;d(K);const B=(S==null?void 0:S.purchaseQuantity)||0;p(K*B)},N=async()=>{try{const J=await a.validateFields();e({...J,unitCost:c,subtotal:u,calculatedITBIS:h,selectedBackOrders:S.selectedBackOrders,quantity:S.quantity,purchaseQuantity:S.purchaseQuantity}),a.resetFields(),o(rl()),A(!1),w(new Set),V.success("Producto agregado correctamente")}catch(J){(J.errorFields||[]).length>0?V.error("Por favor complete todos los campos requeridos"):V.error("Error al agregar el producto")}},G=()=>{a.resetFields(),n(),T({}),w(new Set)},Q=async()=>{if(!(!(S!=null&&S.id)||!(r!=null&&r.businessID))&&!P.has(S.id)){j(!0);try{const J=await a1(r.businessID,S.id);(J==null?void 0:J.length)>0?(C(J),b(S),g(!0)):(o(rl()),A(!0),w(new Set([...P,S.id])))}finally{j(!1)}}},ae=J=>{o(Pm(y)),o(r$(J)),g(!1),b(null),R()},oe=()=>{g(!1),b(null),o(rl())},Z=J=>{a.validateFields().then(R).catch(()=>{})};return m.useEffect(()=>{S&&(a.setFieldsValue({name:S.name,quantity:S.quantity}),R())},[S]),t.jsxs(Ome,{children:[t.jsx(M,{form:a,layout:"horizontal",children:t.jsxs(Mme,{children:[t.jsx(Oe,{title:"Nombre del Producto",children:t.jsx(pd,{name:"name",label:"Producto",rules:[{required:E}],children:t.jsx(Tme,{onSelect:T,selectedProduct:S})})}),t.jsx(Oe,{title:"Cantidad",children:t.jsx(pd,{name:"quantity",label:"Cantidad",rules:[{required:E}],children:t.jsx(Ke,{controls:!1,disabled:!E||I,placeholder:"Cantidad",value:S==null?void 0:S.quantity,onChange:Z,onClick:Q,style:{cursor:E&&!I?"pointer":"not-allowed",width:"100%"},addonAfter:I&&t.jsx(O,{icon:An,spin:!0,style:{color:"#1890ff"}})})})}),t.jsx(Oe,{title:"Costo Base",children:t.jsx(pd,{name:"baseCost",label:"Costo Base",rules:[{required:E}],children:t.jsx(Ke,{controls:!1,disabled:!E,placeholder:"Costo",min:E&&.1,style:{width:"100%"},onChange:R})})}),t.jsx(Oe,{title:"Costo Unitario",children:t.jsx(mx,{title:"Costo Unitario",value:c,formatter:J=>Ut(J)})}),t.jsx(Oe,{title:"Subtotal",children:t.jsx(mx,{title:"Subtotal",value:u,formatter:J=>Ut(J)})}),t.jsxs(Bme,{children:[t.jsx(Oe,{title:"Borrar",children:t.jsx(U,{icon:z.operationModes.close,onClick:G,disabled:!E})}),t.jsx(Oe,{title:"Agregar Producto",children:t.jsx(U,{type:"primary",icon:z.operationModes.add,onClick:N,disabled:!E})})]})]})}),t.jsx(Uc,{isVisible:x,onCancel:oe,onConfirm:ae,initialSelectedBackOrders:S.selectedBackOrders,initialPurchaseQuantity:S.purchaseQuantity,productId:S.id,backOrders:v,mode:s,orderId:i})]})}const Ome=l.div`
    padding-bottom: 0.2em;
    margin-bottom: 1em;
    overflow-x: auto;
`,Mme=l.div`
    display: grid;
    grid-template-columns: 1.5fr 1fr 1fr 1fr 1fr min-content ;
    gap: 8px;
   
`,Fme=l.div`
    display: flex;
    gap: 8px;
`,mx=l(vn)`
    align-self: end;
    justify-content: space-between;
    .ant-statistic-title {
        font-size: 14px;
        color: #333;
          text-align: right; 
    }
    .ant-statistic-content {
        font-size: 16px;
        font-weight: bold;
        text-align: right;  // Alineación a la derecha
    }
`,Bme=l(Fme)`
    display: flex;
    align-items: end;
    padding: 0 0 0.3em 0;
    justify-content: flex-end;
     margin-left: 0.8em;
    gap: 0.4em;
    
   
`,pd=l(M.Item)`
    .ant-form-item-explain {
        display: none;
    }
    
    .ant-form-item-label {

    display: flex;
    align-items: end;
}


    .ant-form-item-control {
        min-height: unset; // Elimina la altura mínima predeterminada
    }

    &.ant-form-item {
        margin-bottom: 0;
       
        display: flex;
        flex-direction: column;
    }

`,Lme=l.div`
  height: 100%;
  display: grid;
  grid-template-rows: min-content 1fr;
  gap: 8px;
  overflow: hidden;
`,zme=l.div`
  display: flex;
  gap: 8px;
  align-items: center;
  padding: 0 1em;
  
  .search-container { flex: 1; }
`,Ume=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 12px;
  padding: 0 1em;
  overflow-y: auto;
  align-content: start;
`,Wme=l.div`
  background-color: ${e=>e.$isSelected?"#e6f7ff":"white"};
  border: 1px solid ${e=>e.$isSelected?"#1890ff":"#e8e8e8"};
  padding: 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;

  &:hover { box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 4px;
  }

  .actions {
    color: #8c8c8c;
    padding: 4px;
    border-radius: 4px;
    
    &:hover {
      background-color: rgba(0, 0, 0, 0.04);
    }
  }

  .name {
    font-size: 14px;
    font-weight: 500;
    color: #262626;
  }

  .rnc {
    font-size: 12px;
    color: #8c8c8c;
  }
`,qme=l.div`
  border: 1px solid #d9d9d9;
  border-radius: 8px;
  padding: 0.4em 0.6em 0.6em;
  cursor: pointer;
  transition: all 0.2s;

  &:hover {
    border-color: #40a9ff;
  }

  &.empty {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #8c8c8c;
    min-height: 100px;
  }

  .provider-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 4px;
  }

  .provider-name {
    font-size: 16px;
    font-weight: 500;
    color: #262626;
  }

  .provider-details {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 1.3em;
    font-size: 14px;
    line-height: 1.1pc;
    color: #595959;
  }

  .detail-item {
    gap: 4px;
  }

  .detail-label {
    color: #40a9ff;
    font-size: 12px;
  }
`,m1=({providers:e=[],selectedProvider:n,onSelectProvider:s,onAddProvider:o,onEditProvider:r,validateStatus:i,help:a})=>{var j;const[c,d]=m.useState(!1),[u,p]=m.useState(""),h=m.useRef(null);m.useEffect(()=>{c&&h.current&&setTimeout(()=>{h.current.focus()},100)},[c]);const f=u?e.filter(({provider:k})=>bt(k.name).includes(bt(u))||bt(k.rnc||"").includes(bt(u))):e,x=k=>{s==null||s(k.provider),d(!1),p("")},g=()=>{o==null||o()},y=(k,A)=>{k.target.closest(".dropdown-container")||x(A)},b=(k,A)=>{r==null||r(A),d(!1)},v=k=>[{key:"edit",label:"Editar",icon:t.jsx(es,{}),onClick:A=>b(A,k)}],C=k=>{k.preventDefault(),k.stopPropagation(),s==null||s(null)},I=(j=Nj.find(k=>(k==null?void 0:k.value)===(n==null?void 0:n.voucherType)))==null?void 0:j.label;return t.jsxs(M.Item,{required:!0,validateStatus:i,help:a,children:[t.jsx(qme,{className:n?"":"empty",onClick:()=>d(!0),children:n?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"provider-header",children:[t.jsx("span",{className:"provider-name",children:n.name}),t.jsx(Qr,{onClick:C,style:{cursor:"pointer",color:"#8c8c8c"}})]}),t.jsxs("div",{className:"provider-details",children:[t.jsxs("div",{className:"detail-item",children:[t.jsx("div",{className:"detail-label",children:"RNC:"}),n.rnc||"N/A"]}),t.jsxs("div",{className:"detail-item",children:[t.jsx("div",{className:"detail-label",children:"Tipo de Comprobante:"}),I||"N/A"]})]})]}):t.jsxs("div",{children:[t.jsx(Jn,{style:{marginRight:8}}),"Seleccionar Proveedor"]})}),t.jsx(Rt,{title:"Lista de Proveedores",placement:"bottom",onClose:()=>d(!1),open:c,height:"80%",styles:{body:{padding:"1em"}},children:t.jsxs(Lme,{children:[t.jsxs(zme,{children:[t.jsx("div",{className:"search-container",children:t.jsx(ie,{ref:h,placeholder:"Buscar proveedores...",value:u,onChange:k=>p(k.target.value)})}),t.jsx(Oe,{title:"Agregar proveedor",children:t.jsx(U,{type:"primary",icon:t.jsx(Jn,{}),onClick:g,children:"Proveedor"})})]}),t.jsx(Ume,{children:f.map(k=>t.jsxs(Wme,{onClick:A=>y(A,k),$isSelected:(n==null?void 0:n.id)===k.provider.id,children:[t.jsxs("div",{className:"card-header",children:[t.jsx("div",{className:"name",children:k.provider.name}),t.jsx("div",{className:"dropdown-container",onClick:A=>A.stopPropagation(),children:t.jsx(Qs,{menu:{items:v(k.provider)},trigger:["click"],children:t.jsx(U,{type:"text",className:"actions",icon:t.jsx(lc,{})})})})]}),t.jsxs("div",{className:"rnc",children:["RNC: ",k.provider.rnc||"N/A"]})]},k.provider.id))})]})})]})},Vme=e=>{const[n,s]=m.useState([]),[o,r]=m.useState(!0),[i,a]=m.useState(null),c=D(q);return m.useEffect(()=>{if(!(c!=null&&c.businessID)||!e){r(!1),s([]);return}r(!0);const d=le($,"businesses",c.businessID,"orders"),u=he(d,te("provider","==",e),te("status","==","pending"));return Te(u,h=>{let x=h.docs.map(g=>g.data()).map(g=>(bT(g,["createdAt","completedAt","deliveryDate","paymentDate","deletedAt"]),g));console.log("orderUpdated",x),s(x),r(!1)},h=>{console.error("Error fetching orders:",h),s([]),a(h),r(!1)})},[c==null?void 0:c.businessID,e]),console.log(" -------------------------- data",n,"id proveedor",e),{data:n,loading:o,error:i}};l.div`
  height: 100%;
  overflow: hidden;
  display: grid;
  grid-template-rows: min-content 1fr;
  gap: 8px;
`;l.div`
  padding: 0 1em;
  display: flex;
  gap: 8px;
  align-items: center;

  .search-container {
    flex: 1;
  }
`;l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  align-items: start;
  overflow-y: auto;
  padding: 0 1em;
  align-content: start;
  gap: 12px;

  .empty-container {
    grid-column: 1 / -1;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 200px;
    width: 100%;

    .ant-empty {
      .ant-empty-description {
        color: #8c8c8c;
        font-size: 14px;
      }
    }
  }
`;l.div`
  background-color: ${e=>e.$isSelected?"#e6f7ff":"white"};
  border: 1px solid ${e=>e.$isSelected?"#1890ff":"#e8e8e8"};
  border-radius: 8px;
  padding: 12px;
  cursor: pointer;
  transition: all 0.2s ease;

  &:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .order-number {
    font-size: 14px;
    font-weight: 500;
    color: #262626;
  }

  .order-date {
    font-size: 12px;
    color: #8c8c8c;
  }

  .order-total {
    font-size: 14px;
    color: #262626;
    margin-top: 4px;
  }
`;const{TextArea:Gme}=ie,_me=({initialValue:e="",onNoteChange:n,errors:s})=>{const[o,r]=m.useState(e);m.useEffect(()=>{r(e)},[e]);const i=m.useCallback(Cu(c=>{n(c)},500),[n]),a=c=>{const{value:d}=c.target;r(d),i(d)};return t.jsx(M.Item,{label:"Notas (opcional)",validateStatus:s!=null&&s.note?"error":"",help:s!=null&&s.note?"La nota no puede exceder los 300 caracteres":"",children:t.jsx(Gme,{value:o,onChange:a,status:s!=null&&s.note?"error":"",cols:30,rows:4,count:{show:!0,max:300},style:{maxWidth:"1000px",resize:"none"}})})},h1=({files:e,attachmentUrls:n,onAddFiles:s,onRemoveFiles:o,errors:r,mode:i,backOrderAssociationId:a})=>{const c=W(),d=D(q),[u,p]=m.useState(null),[h,f]=m.useState(""),x=m.useRef(null),{providers:g=[]}=oi(),[y,b]=m.useState(!1),[v,C]=m.useState(null),{backOrders:I=[]}=Ip(v==null?void 0:v.id),{numberId:j,replenishments:k,condition:A,provider:P,deliveryAt:w,paymentAt:S,note:E}=D(iy);V0(A);const T=Go.map(B=>({label:B.label,value:B.id})),R=B=>{c(o$(B)),c(s$())},N=()=>c(n$()),G=({index:B,..._})=>{c(e$({value:_,index:B}))},Q=B=>{c(t$({id:B}))},ae=(B,_)=>{c(fs({[B]:_?We(_).toISOString():null}))},oe=B=>{c(fs({condition:B}))};m.useMemo(()=>Cu(B=>{c(fs({note:B}))},300),[c]);const Z=m.useCallback(B=>{c(fs({note:B}))},[c]);m.useEffect(()=>{if(P){const B=g.find(_=>_.provider.id===P);B&&p(B.provider)}},[g,P]),m.useEffect(()=>(u!=null&&u.id&&(x.current&&x.current(),x.current=Te(F($,"businesses",d.businessID,"providers",u.id),B=>{if(B.exists()){const _={...u,...B.data().provider};p(_),c(fs({provider:u.id}))}},B=>{console.error("Error observando proveedor:",B),V.error("Error al sincronizar datos del proveedor")})),()=>{x.current&&x.current()}),[u==null?void 0:u.id]);const J=m.useMemo(()=>h?g.filter(({provider:B})=>bt(B.name).includes(bt(h))||bt(B.rnc||"").includes(bt(h))):g,[g,h]),X=B=>{p(B),c(fs({provider:(B==null?void 0:B.id)||null}))},me=()=>{c(Ys({mode:_e.CREATE.id,data:null}))},fe=B=>{c(Ys({mode:_e.UPDATE.id,data:B}))},se=async B=>{var ne;const _=k.find(pe=>pe.id===B.id);if(!_)return console.error("No se encontró el producto completo:",B),!1;if(C(_),((ne=_.selectedBackOrders)==null?void 0:ne.length)>0||I.filter(pe=>pe.productId===_.id).length>0)return b(!0),!0;const H={purchaseQuantity:_.quantity||0,selectedBackOrders:[]};return G({index:_.key,...H}),!1},ee=B=>{const _=B.selectedBackOrders.reduce((pe,ye)=>pe+ye.quantity,0),L=B.purchaseQuantity,H=Math.max(0,L-_),ne={...B,selectedBackOrders:B.selectedBackOrders,purchaseQuantity:L,quantity:H};G({...ne}),b(!1),C(null)},K=()=>{b(!1),C(null)};return t.jsxs(t.Fragment,{children:[t.jsx(Qme,{children:t.jsx(m1,{validateStatus:r!=null&&r.provider?"error":"",help:r!=null&&r.provider?"El proveedor es requerido":"",providers:J,selectedProvider:u,onSelectProvider:X,onAddProvider:me,onEditProvider:fe})}),t.jsx(Nme,{mode:i,onSave:R,onClear:N}),t.jsx(fme,{products:k,onEditProduct:G,removeProduct:Q,onQuantityClick:se}),t.jsx(jme,{replenishments:k}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:" repeat(auto-fit, minmax(350px, 1fr))",gap:"1.4em"},children:[t.jsxs("div",{children:[t.jsxs(Hme,{children:[t.jsx(M.Item,{label:"Condición",required:!0,children:t.jsx(ge,{options:T,value:A,onChange:oe})}),t.jsx(M.Item,{label:"Fecha de Entrega",required:!0,validateStatus:r!=null&&r.deliveryAt?"error":"",help:r!=null&&r.deliveryAt?"La fecha de entrega es requerida":"",children:t.jsx(yt,{value:w?We(w):null,onChange:B=>ae("deliveryAt",B),format:"DD/MM/YYYY",style:{width:"100%"},status:r!=null&&r.deliveryDate?"error":""})})]}),t.jsx(_me,{initialValue:E,onNoteChange:Z,errors:r})]}),t.jsx(hme,{files:e,attachmentUrls:n,onAddFiles:s,onRemoveFiles:o})]}),v&&t.jsx(Uc,{backOrders:I,isVisible:y,onCancel:K,onConfirm:ee,initialSelectedBackOrders:v.selectedBackOrders||[],initialPurchaseQuantity:v.purchaseQuantity||0,productId:v.id,backOrderAssociationId:a,mode:i,purchaseId:j})]})};h1.defaultProps={files:[],attachmentUrls:[],onAddFiles:()=>{},onRemoveFiles:()=>{},errors:{}};const Hme=l.div`
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1em;
    @media (width <= 768px) {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
`,Qme=l.div`
    overflow-x: auto;
    display: grid;
    grid-template-columns: 300px 200px 200px 200px;
    gap: 0.4em;
  
`;l.div`
    display: flex;
    justify-content: flex-end;
    position: sticky;
    bottom: 0;
    width: 100%;
    gap: 1em;
   background-color: white;
   padding-top: 1em;
   border-top: 1px solid #e8e8e8;
`;const Yme=(e,n={})=>{const s=(r,i)=>r==null?i in n?n[i]:null:typeof r=="string"&&r.trim()===""?"":typeof r=="number"&&isNaN(r)?0:r instanceof Date?ue.fromDate(r):typeof r=="object"&&r!==null&&!Array.isArray(r)?o(r):Array.isArray(r)?r.map(a=>s(a)):r,o=r=>{const i={};for(const a in r)i[a]=s(r[a],a);return i};return o(e)},Kme={createdAt:null,deletedAt:null,completedAt:null,deliveryAt:null,paymentAt:null,quantity:0,baseCost:0,unitCost:0,subTotal:0,calculatedITBIS:0},g1=e=>e?URL.createObjectURL(e):"",Wc=(e,n)=>e.map(s=>{if(s.location==="local"){const o=n.find(r=>r.name===s.name);if(o)return{...s,location:"remote",url:o.url,size:o.size,mimeType:o.mimeType}}return s}),qt=e=>{if(!e)return ue.now();const n=typeof e=="number"?e:new Date(e).getTime();return isNaN(n)?ue.now():ue.fromMillis(n)};async function hx({user:e,purchase:n,localFiles:s=[],setLoading:o=()=>{}}){var r;try{const i=be(),a=await Mt(e,"lastPurchaseNumberId"),c=F($,"businesses",e.businessID,"purchases",i);if(n.orderId){const g=F($,"businesses",e.businessID,"orders",n.orderId);await je(g,{status:"completed"})}let d=[];if(s&&s.length>0){const g=s.map(({file:y})=>y);d=await ui(e,"purchaseAndOrderFiles",g,{customMetadata:{type:"purchase_attachment"}})}const u=n.attachmentUrls||[],p=Wc(u,d),h=((r=n.replenishments)==null?void 0:r.map(g=>({...g,expirationDate:g.expirationDate?ue.fromMillis(new Date(g.expirationDate).getTime()):null})))||[],f=h.filter(g=>g.selectedBackOrders&&g.selectedBackOrders.length>0);if(f.length>0){const g=dt($);for(const y of f)for(const b of y.selectedBackOrders){const v=F($,"businesses",e.businessID,"backOrders",b.id);g.update(v,{status:"reserved",reservedBy:e.uid,reservedAt:de(),purchaseId:i,updatedAt:de(),updatedBy:e.uid})}await g.commit()}const x={...n,id:i,numberId:a,createdAt:de(),updatedAt:de(),deliveryAt:qt(n.deliveryAt),paymentAt:qt(n.paymentAt),completedAt:n.completedAt?qt(n.completedAt):null,attachmentUrls:p,replenishments:h};return await De(c,x),o(!1),x}catch(i){throw o(!1),console.error("Error in addPurchase:",i),i}}async function Jme({user:e,order:n,localFiles:s=[],setLoading:o=()=>{}}){if(!(!e||!e.businessID))try{const r=be(),i=await Mt(e,"lastOrdersId"),a=F($,"businesses",e.businessID,"orders",r);let c=[];if(s&&s.length>0){const h=s.map(({file:f})=>f);c=await ui(e,"purchaseAndOrderFiles",h,{customMetadata:{type:"purchase_attachment"}})}const d=n.attachmentUrls||[],u=Wc(d,c),p={...n,id:r,numberId:i,createdAt:de(),updatedAt:de(),deliveryAt:qt(n.deliveryAt),paymentAt:qt(n.paymentAt),completedAt:n.completedAt?qt(n.completedAt):null,attachmentUrls:u};if(n.replenishments){const h=n.replenishments.filter(f=>f.selectedBackOrders&&f.selectedBackOrders.length>0);if(h.length>0){const f=dt($);for(const x of h)for(const g of x.selectedBackOrders){const y=F($,"businesses",e.businessID,"backOrders",g.id);f.update(y,{status:"reserved",reservedBy:e.uid,orderId:r,updatedAt:de(),updatedBy:e.uid})}await f.commit()}}return await De(a,p),o(!1),p}catch(r){throw o(!1),console.error("Error in addPurchase:",r),r}}const Xme=async({user:e,order:n,localFiles:s=[]})=>{if(!e||!(e!=null&&e.businessID))return;const{id:o,createdAt:r,deliveryAt:i,paymentAt:a,completedAt:c}=n;try{let d=[];if(s&&s.length>0){const j=s.map(({file:k})=>k);d=await ui(e,"purchaseAndOrderFiles",j,{customMetadata:{type:"purchase_attachment"}})}const u=n.attachmentUrls||[],p=Wc(u,d);let h={...n,attachmentUrls:p,createdAt:qt(r),deliveryAt:qt(i),paymentAt:qt(a),completedAt:qt(c)};const f=F($,"businesses",e.businessID,"orders",o),x=await Se(f),g=x.exists()?x.data():null,y=[];g&&g.replenishments&&g.replenishments.forEach(j=>{j.selectedBackOrders&&j.selectedBackOrders.length>0&&j.selectedBackOrders.forEach(k=>y.push(k.id))});const b=[];n.replenishments&&n.replenishments.forEach(j=>{j.selectedBackOrders&&j.selectedBackOrders.length>0&&j.selectedBackOrders.forEach(k=>b.push(k.id))});const v=y.filter(j=>!b.includes(j)),C=b.filter(j=>!y.includes(j)),I=dt($);return v.forEach(j=>{const k=F($,"businesses",e.businessID,"backOrders",j);I.update(k,{status:"pending",updatedAt:de(),updatedBy:e.uid,reservedBy:null,reservedAt:null,orderId:null})}),C.forEach(j=>{const k=F($,"businesses",e.businessID,"backOrders",j);I.update(k,{status:"reserved",reservedBy:e.uid,reservedAt:de(),orderId:n.id,updatedAt:de(),updatedBy:e.uid})}),await I.commit(),await je(f,h),{success:!0,data:h}}catch(d){console.error("Error updating document: ",d)}},Zme=({editing:e,dataIndex:n,title:s,inputType:o,record:r,index:i,children:a,onSave:c,onCloseEdit:d,setDateModalVisible:u,setSelectedRecord:p,onCellClick:h,loadingQuantity:f,onClick:x,...g})=>{const y=()=>o==="number"?t.jsx(Ke,{onPressEnter:v=>c(r,n,v.target.value),onBlur:v=>c(r,n,v.target.value),autoFocus:!0}):o==="date"?a:t.jsx(ie,{onPressEnter:v=>c(r,n,v.target.value),onBlur:v=>c(r,n,v.target.value),autoFocus:!0}),b=()=>{n==="quantity"&&f===r.key||(h?h():o==="date"&&r.editable!==!1?(p(r),u(!0)):x&&x())};return t.jsx("td",{...g,onClick:b,style:{cursor:"pointer"},children:e?t.jsx(M.Item,{name:n,style:{margin:0},noStyle:!0,rules:["freight","otherCosts"].includes(n)?[]:[{required:!0}],children:y()}):t.jsx("div",{className:"editable-cell-value-wrap",style:{paddingRight:24,whiteSpace:"nowrap"},children:n==="expirationDate"&&r[n]?We(r[n]).format("DD/MM/YY"):n==="quantity"&&f===r.key?t.jsxs("span",{children:[t.jsx(Yr,{spin:!0})," Verificando..."]}):a})})},ehe=({products:e,removeProduct:n,onEditProduct:s,onQuantityClick:o})=>{const[r,i]=m.useState({row:"",col:""}),[a,c]=m.useState(!1),[d,u]=m.useState(null),[p,h]=m.useState(null),[f]=M.useForm(),x=(j,k)=>r.row===j.key&&r.col===k,g=(j,k)=>{const A=j[k],P=k==="expirationDate"&&A?We(A):A;f.setFieldsValue({[k]:P}),i({row:j.key,col:k})},y=(j,k,A)=>{const P=k==="expirationDate"?A?We(A).valueOf():null:A,w={...j};if(k==="quantity")if(!j.selectedBackOrders||j.selectedBackOrders.length===0)w.quantity=Number(P)||0,w.purchaseQuantity=Number(P)||0;else{const S=j.selectedBackOrders.reduce((E,T)=>E+T.quantity,0);w.quantity=Number(P)||0,w.purchaseQuantity=(Number(P)||0)+S}else w[k]=P;s(w),i({row:"",col:""})},b=j=>{if(d){const k=j?We(j).startOf("day").valueOf():null;y(d,"expirationDate",k)}c(!1),u(null)},v=async j=>{if(p!==j.key){h(j.key);try{await o(j)||g(j,"quantity")}catch(k){console.error("Error in handleQuantityClick:",k)}finally{h(null)}}},I=[{title:"Producto",dataIndex:"name",width:200,ellipsis:{showTitle:!0},render:j=>t.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:j})},{title:"F. Expiración",dataIndex:"expirationDate",render:j=>j?We(j).format("DD/MM/YY"):"-",editable:!0},{title:"Cantidad",dataIndex:"quantity",render:j=>j,editable:!0},{title:"Unid. Medida",dataIndex:"unitMeasurement",editable:!0},{title:"Costo Base",dataIndex:"baseCost",render:j=>Ut(j),editable:!0},{title:"ITBIS",dataIndex:"taxPercentage",render:j=>!j||j==0?"Exento":P6(j),editable:!0},{title:"Flete",dataIndex:"freight",render:j=>Ut(j),editable:!0},{title:"Otros Costos",dataIndex:"otherCosts",render:j=>Ut(j),editable:!0},{title:"Costo Unitario",dataIndex:"unitCost",render:j=>Ut(j)},{title:"Subtotal",dataIndex:"subtotal",fixed:"right",render:j=>Ut(j)},{title:"Acciones",key:"actions",fixed:"right",render:(j,k)=>t.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"end"},children:t.jsx(U,{icon:t.jsx(ht,{}),danger:!0,onClick:()=>n(k.id)})})}].map(j=>j.editable?{...j,onCell:k=>({record:k,inputType:j.dataIndex==="expirationDate"?"date":["quantity","baseCost","taxPercentage","freight","otherCosts"].includes(j.dataIndex)?"number":"text",dataIndex:j.dataIndex,title:j.title,editing:x(k,j.dataIndex),onSave:y,loadingQuantity:p,...j.dataIndex==="quantity"?{onCellClick:()=>v(k)}:{onClick:()=>g(k,j.dataIndex)},onCloseEdit:()=>i({row:"",col:""}),setDateModalVisible:c,setSelectedRecord:u})}:j);return e.map((j,k)=>({...j,key:j.id||k})),t.jsxs(t.Fragment,{children:[t.jsx(M,{form:f,component:!1,children:t.jsx(Gt,{components:{body:{cell:Zme}},className:"editable-row-table",size:"small",scroll:{x:1300},columns:I,dataSource:e.map((j,k)=>({...j,key:j.id||k})),rowKey:j=>j.id,onRow:()=>({})})}),t.jsx(Ce,{title:"Seleccionar fecha de vencimiento",open:a,onCancel:()=>{c(!1),u(null)},footer:null,children:t.jsx(yt,{style:{width:"100%"},format:"DD/MM/YY",value:d!=null&&d.expirationDate?We(d.expirationDate):null,onChange:b})})]})},the=l.div`
  padding: 1em 0;
`,nhe=l(the)`
  background: #fafafa;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-bottom: 16px;
`,she=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  justify-items: center;
  gap: 16px;
  @media (max-width: 768px) {
    justify-items: start;
  }
`,Co=l(vn)`
  .ant-statistic-title {
    color: #8c8c8c;
    font-size: 14px;
  }
  .ant-statistic-content {
    color: #262626;
    font-size: 16px;
  }
`,ohe=l(Co)`
  color: #cf1322;
  font-weight: bold;
`,rhe=({replenishments:e})=>{const s=e.reduce((o,r)=>{const i=Number(r.baseCost),a=Number(r.taxPercentage)||0,c=i*a/100,d=Number(r.freight)||0,u=Number(r.otherCosts)||0,p=(i+c+d+u)*Number((r==null?void 0:r.purchaseQuantity)||(r==null?void 0:r.quantity));return{totalProducts:o.totalProducts+Number(r.quantity),totalBaseCost:o.totalBaseCost+i,totalItbis:o.totalItbis+c,totalShipping:o.totalShipping+d,totalOtherCosts:o.totalOtherCosts+u,grandTotal:o.grandTotal+p}},{totalProducts:0,totalBaseCost:0,totalItbis:0,totalShipping:0,totalOtherCosts:0,grandTotal:0});return t.jsx(nhe,{children:t.jsxs(she,{children:[t.jsx(Co,{title:"Total Productos",value:s.totalProducts,prefix:"#"}),t.jsx(Co,{title:"Total Costo Base",value:s.totalBaseCost,prefix:"$",precision:2}),t.jsx(Co,{title:"Total ITBIS",value:s.totalItbis,prefix:"$",precision:2}),t.jsx(Co,{title:"Total Flete",value:s.totalShipping,prefix:"$",precision:2}),t.jsx(Co,{title:"Total Otros Costos",value:s.totalOtherCosts,prefix:"$",precision:2}),t.jsx(ohe,{title:"Gran Total",value:s.grandTotal,prefix:"$",precision:2})]})})},ihe=l.div`
 padding: 0 1em;
`,ahe=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
   align-items: start;
   overflow-y: auto;
   padding: 0 1em;
   align-content: start;
  gap: 12px;
`,che=l.div`
  background-color: white;
  border: 1px solid #e8e8e8;
  border-radius: 8px;
  padding: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 12px;

  &:hover {

    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
`,lhe=l.div`
  position: relative;
  width: 60px;
  height: 60px;
  flex-shrink: 0;
  background-color: #f5f5f5;
  border-radius: 6px;
  overflow: hidden;

  img, .placeholder-icon {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .placeholder-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #d9d9d9;
    font-size: 20px;
  }
`,dhe=l.div`
  flex: 1;
  min-width: 0; // Importante para que el text-overflow funcione

  .name {
    font-size: 13px;
    font-weight: 500;
    color: #262626;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .barcode {
    font-size: 11px;
    color: #8c8c8c;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,uhe=l.div`
 
  height: 100%;
  overflow: hidden;
  display: grid;
  grid-template-rows: min-content 1fr min-content;
  gap: 8px;
`,phe=l.div`
  display: flex;
  align-items: center;
`,mhe=({onSelect:e,selectedProduct:n})=>{const[s,o]=m.useState(!1),[r,i]=m.useState(""),a=m.useRef(null),[c,d]=m.useState(1),[u,p]=m.useState(14);m.useEffect(()=>{s&&a.current&&setTimeout(()=>{a.current.focus()},100)},[s]);const{products:h,loading:f}=Rs(!0),x=r?$n(h,r):h,g=(c-1)*u,y=c*u,b=x.slice(g,y);function v(I){e(I),i(""),d(1),o(!1),V.success("Product selected")}function C(I){i(I.target.value),d(1)}return t.jsxs("div",{children:[t.jsx(ie,{value:(n==null?void 0:n.name)||"",placeholder:"Search and select a product...",readOnly:!0,onClick:()=>o(!0)}),t.jsx(Rt,{title:"Lista de Productos",placement:"bottom",onClose:()=>o(!1),open:s,loading:f,height:"80%",styles:{body:{padding:"1em"}},width:1e3,children:t.jsxs(uhe,{children:[t.jsx(ihe,{children:t.jsx(ie,{ref:a,placeholder:"Buscar productos...",value:r,onChange:C,style:{width:"100%"}})}),t.jsx(ahe,{children:b.map(I=>t.jsxs(che,{onClick:()=>v(I),children:[t.jsx(lhe,{children:I.image?t.jsx("img",{src:I.image,alt:I.name}):t.jsx("div",{className:"placeholder-icon",children:t.jsx(O,{icon:Aa})})}),t.jsxs(dhe,{children:[t.jsx("div",{className:"name",children:I==null?void 0:I.name}),t.jsx("div",{className:"barcode",children:I==null?void 0:I.barcode})]})]},I.id))}),t.jsx(phe,{children:t.jsx(Ta,{current:c,showSizeChanger:!1,hideOnSinglePage:!0,simple:{readOnly:!0},total:x.length,onChange:I=>d(I)})})]})})]})};function hhe({onSave:e,onClear:n}){const s=W(),o=D(q),[r,i]=m.useState(!1),[a,c]=m.useState(new Set),[d]=M.useForm(),[u,p]=m.useState(0),[h,f]=m.useState(0),[x,g]=m.useState(0),[y,b]=m.useState(!1),[v,C]=m.useState(null),[I,j]=m.useState([]),k=D(GR),A=!!(k!=null&&k.name)||!!(k!=null&&k.id),P=Q=>{s(Mm(Q)),Q!=null&&Q.id||c(new Set)},w=()=>{const Q=d.getFieldsValue(),ae=Number(Q.baseCost)||0,oe=Number(Q.taxPercentage)||0,Z=Number(Q.freight)||0,J=Number(Q.otherCosts)||0,X=ae*oe/100;g(X);const me=ae+X+Z+J;p(me);const fe=(k==null?void 0:k.purchaseQuantity)||0;f(me*fe)},S=async()=>{try{const Q=await d.validateFields();e({...Q,expirationDate:Q.expirationDate?Q.expirationDate.valueOf():null,unitCost:u,subtotal:h,calculatedITBIS:x,purchaseQuantity:k.purchaseQuantity,selectedBackOrders:k.selectedBackOrders,quantity:k.quantity}),d.resetFields(),s(dl()),c(new Set),V.success("Producto agregado correctamente")}catch(Q){(Q.errorFields||[]).length>0?V.error("Por favor complete todos los campos requeridos"):V.error("Error al agregar el producto")}},E=()=>{d.resetFields(),n(),P({}),c(new Set)},T=async()=>{if(!(!(k!=null&&k.id)||!(o!=null&&o.businessID))&&!a.has(k.id)){i(!0);try{const Q=await a1(o.businessID,k.id);(Q==null?void 0:Q.length)>0?(j(Q),C(k),b(!0)):(s(dl()),c(new Set([...a,k.id])))}finally{i(!1)}}},R=Q=>{s(Mm(v)),s(qR(Q)),b(!1),C(null),w()},N=()=>{b(!1),C(null),s(dl())},G=Q=>{s(VR(Q||0)),w()};return m.useEffect(()=>{d.validateFields().then(w).catch(()=>{})},[d]),m.useEffect(()=>{k&&(d.setFieldsValue({name:k.name,quantity:k.quantity}),w())},[k]),t.jsxs(ghe,{children:[t.jsx(M,{form:d,layout:"horizontal",children:t.jsxs(fhe,{children:[t.jsx(Oe,{title:"Nombre del Producto",children:t.jsx(hs,{name:"name",label:"Producto",rules:[{required:A}],children:t.jsx(mhe,{onSelect:P,selectedProduct:k})})}),t.jsx(Oe,{title:"Fecha de Expiración",children:t.jsx(hs,{name:"expirationDate",label:"F. Expiración",children:t.jsx(yt,{format:"DD/MM/YY",disabled:!A,placeholder:"Fecha. Exp"})})}),t.jsx(Oe,{title:"Cantidad",children:t.jsx(hs,{name:"quantity",label:"Cantidad",rules:[{required:A}],children:t.jsx(Ke,{controls:!1,disabled:!A||r,placeholder:"Cantidad",value:k==null?void 0:k.quantity,onChange:G,onClick:T,style:{cursor:A&&!r?"pointer":"not-allowed"},addonAfter:r&&t.jsx(O,{icon:An,spin:!0,style:{color:"#1890ff"}})})})}),t.jsx(Oe,{title:"Unidad de Medida",children:t.jsx(hs,{name:"unitMeasurement",label:"Unid. Medida",rules:[{required:A}],children:t.jsx(ie,{placeholder:"Unidad",disabled:!A})})}),t.jsx(Oe,{title:"Costo Base",children:t.jsx(hs,{name:"baseCost",label:"Costo Base",rules:[{required:A}],children:t.jsx(Ke,{controls:!1,disabled:!A,placeholder:"Costo",min:A&&.1,style:{width:"100%"},onChange:w})})}),t.jsx(Oe,{title:"ITBIS",children:t.jsx(hs,{name:"taxPercentage",label:"ITBIS (%)",children:t.jsx(Ke,{disabled:!A,controls:!1,placeholder:"%",onChange:w})})}),t.jsx(Oe,{title:"Flete",children:t.jsx(hs,{name:"freight",label:"Flete",children:t.jsx(Ke,{disabled:!A,controls:!1,placeholder:"Flete",onChange:w})})}),t.jsx(Oe,{title:"Otros Costos",children:t.jsx(hs,{name:"otherCosts",label:"Otros",children:t.jsx(Ke,{controls:!1,placeholder:"Otros",disabled:!A,onChange:w})})}),t.jsx(Oe,{title:"Costo Unitario",children:t.jsx(gx,{title:"Costo Unitario",value:u,formatter:Q=>Ut(Q)})}),t.jsx(Oe,{title:"Subtotal",children:t.jsx(gx,{title:"Subtotal",value:h,formatter:Q=>Ut(Q)})}),t.jsxs(bhe,{children:[t.jsx(Oe,{title:"Borrar",children:t.jsx(U,{icon:z.operationModes.close,onClick:E,disabled:!A})}),t.jsx(Oe,{title:"Agregar Producto",children:t.jsx(U,{type:"primary",icon:z.operationModes.add,onClick:S,disabled:!A})})]})]})}),t.jsx(Uc,{isVisible:y,onCancel:N,onConfirm:R,initialSelectedBackOrders:k.selectedBackOrders,initialPurchaseQuantity:k.purchaseQuantity,productId:k.id,backOrders:I})]})}const ghe=l.div`
  padding-bottom: 0.2em;
  margin-bottom: 1em;
  overflow-x: auto;
`,fhe=l.div`
  display: grid;
  grid-template-columns: 
    1.2fr 
    100px 
    min-content 
    120px 
    105px 
    min-content  
    min-content 
    min-content 
    0.8fr 
    1fr 
    min-content;
  gap: 8px;
`,xhe=l.div`
  display: flex;
  gap: 8px;
`,gx=l(vn)`
  align-self: end;
  justify-content: space-between;
  .ant-statistic-title {
    font-size: 14px;
    color: #333;
    text-align: right;
  }
  .ant-statistic-content {
    font-size: 16px;
    font-weight: bold;
    text-align: right;
  }
`,bhe=l(xhe)`
  display: flex;
  align-items: end;
  padding: 0 0 0.3em 0;
  justify-content: flex-end;
  margin-left: 0.8em;
  gap: 0.4em;
`,hs=l(M.Item)`
  .ant-form-item-explain {
    display: none;
  }
  
  .ant-form-item-label {
    display: flex;
    align-items: end;
  }

  .ant-form-item-control {
    min-height: unset;
  }

  &.ant-form-item {
    margin-bottom: 0;
    display: flex;
    flex-direction: column;
  }
`,yhe=l.div`
  height: 100%;
  overflow: hidden;
  display: grid;
  grid-template-rows: min-content 1fr;
  gap: 8px;
`,vhe=l.div`
  padding: 0 1em;
  display: flex;
  gap: 8px;
  align-items: center;

  .search-container {
    flex: 1;
  }
`,jhe=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  align-items: start;
  overflow-y: auto;
  padding: 0 1em;
  align-content: start;
  gap: 12px;

  .empty-container {
    grid-column: 1 / -1;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 200px;
    width: 100%;

    .ant-empty {
      .ant-empty-description {
        color: #8c8c8c;
        font-size: 14px;
      }
    }
  }
`,Che=l.div`
  background-color: ${e=>e.$isSelected?"#e6f7ff":"white"};
  border: 1px solid ${e=>e.$isSelected?"#1890ff":"#e8e8e8"};
  border-radius: 8px;
  padding: 12px;
  cursor: pointer;
  transition: all 0.2s ease;

  &:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .order-number {
    font-size: 14px;
    font-weight: 500;
    color: #262626;
  }

  .order-date {
    font-size: 12px;
    color: #8c8c8c;
  }

  .order-total {
    font-size: 14px;
    color: #262626;
    margin-top: 4px;
  }
`,whe=({orders:e,orderLoading:n})=>{var b;const s=W(),[o,r]=m.useState(!1),[i,a]=m.useState(""),[c,d]=m.useState(null),u=m.useRef(null),{provider:p,orderId:h}=D(Oy),f=Fe();m.useEffect(()=>{o&&u.current&&setTimeout(()=>{u.current.focus()},100)},[o]),m.useEffect(()=>{if(h&&(e!=null&&e.length)){const v=e.find(C=>C.id===h);v&&d(v)}},[h,e]);const x=(i?e.filter(v=>{var C,I;return v?bt(((C=v==null?void 0:v.numberId)==null?void 0:C.toString())??"").includes(bt(i))||bt(Ve.convertMillisToISODate(((I=v==null?void 0:v.dates)==null?void 0:I.createdAt)??(v==null?void 0:v.createdAt)??0)).includes(bt(i)):!1}):e).filter(Boolean),g=v=>{d(v),f(`/orders/convert-to-purchase/${v.id}`),r(!1),a(""),V.success("Pedido seleccionado")},y=()=>{d(null),s(FR(null)),V.info("Pedido removido")};return t.jsxs("div",{children:[t.jsx("div",{style:{width:"100%",position:"relative"},children:t.jsx(M.Item,{label:"Pedido",rules:[{required:!0,message:"Por favor selecciona un pedido"}],help:c?`${Ve.convertMillisToISODate(((b=c==null?void 0:c.dates)==null?void 0:b.createdAt)??(c==null?void 0:c.createdAt)??0)} | (${Y($d(c.replenishments).grandTotal)}) `:"",children:t.jsxs(Ye.Compact,{style:{width:"100%"},children:[t.jsx(ie,{value:c?`Pedido #${c.numberId}`:"",placeholder:"Buscar y seleccionar pedido...",readOnly:!0,disabled:n,addonAfter:n?t.jsx(Yr,{}):t.jsx("span",{children:e.length||0}),onClick:()=>r(!0),style:{width:"100%"}}),c&&t.jsx(U,{onClick:y,type:"default",icon:z.operationModes.close})]})})}),t.jsx(Rt,{title:"Lista de Pedidos",placement:"bottom",onClose:()=>r(!1),open:o,height:"80%",styles:{body:{padding:"1em"}},children:t.jsxs(yhe,{children:[t.jsx(vhe,{children:t.jsx("div",{className:"search-container",children:t.jsx(ie,{ref:u,placeholder:"Buscar pedidos...",value:i,onChange:v=>a(v.target.value)})})}),t.jsx(jhe,{children:x.length>0?x.map(v=>{var I;if(!v)return null;const{grandTotal:C}=$d(v.replenishments);return t.jsxs(Che,{onClick:()=>g(v),$isSelected:(c==null?void 0:c.id)===(v==null?void 0:v.id),children:[t.jsxs("div",{className:"order-number",children:["Pedido #",(v==null?void 0:v.numberId)??"(sin número)"]}),t.jsx("div",{className:"order-date",children:Ve.convertMillisToISODate(((I=v==null?void 0:v.dates)==null?void 0:I.createdAt)??(v==null?void 0:v.createdAt)??0)}),t.jsxs("div",{className:"order-total",children:["Total: ",Y(C)]})]},v==null?void 0:v.id)}):t.jsx("div",{className:"empty-container",children:t.jsx(Lt,{image:Lt.PRESENTED_IMAGE_SIMPLE,description:i?"No se encontraron pedidos con los criterios de búsqueda":"No hay pedidos pendientes para este proveedor"})})})]})})]})},{TextArea:She}=ie,Ihe=({initialValue:e="",onNoteChange:n,errors:s})=>{const[o,r]=m.useState(e);m.useEffect(()=>{r(e)},[e]);const i=m.useCallback(Cu(c=>{n(c)},500),[n]),a=c=>{const{value:d}=c.target;d.length<=300&&(r(d),i(d))};return t.jsx(M.Item,{label:"Notas",children:t.jsx(She,{value:o,onChange:a,placeholder:"Agrega notas adicionales",cols:30,rows:4,style:{maxWidth:"1000px",resize:"none"}})})},{confirm:Ehe}=Ce,f1=({files:e,attachmentUrls:n,onAddFiles:s,onRemoveFiles:o,errors:r,backOrderAssociationId:i})=>{const a=W(),c=D(q),[d,u]=m.useState(null),[p,h]=m.useState(""),f=m.useRef(null),{providers:x=[]}=oi(),[g,y]=m.useState(!1),[b,v]=m.useState(null),{backOrders:C=[]}=Ip(b==null?void 0:b.id),{invoiceNumber:I,proofOfPurchase:j,replenishments:k,condition:A,provider:P,dates:w,deliveryAt:S,paymentAt:E,note:T}=D(Oy),{data:R=[],loading:N}=Vme(P);V0(A);const G=Go.map(ne=>({label:ne.label,value:ne.id}));m.useEffect(()=>{if(P){const ne=x.find(pe=>pe.provider.id===P);ne&&u(ne.provider)}},[x,P]),m.useEffect(()=>(d!=null&&d.id&&(f.current&&f.current(),f.current=Te(F($,"businesses",c.businessID,"providers",d.id),ne=>{if(ne.exists()){const pe={...d,...ne.data().provider};u(pe),a(dn({provider:d.id}))}},ne=>{console.error("Error observando proveedor:",ne),V.error("Error al sincronizar datos del proveedor")})),()=>{f.current&&f.current()}),[d==null?void 0:d.id]);const Q=m.useMemo(()=>p?x.filter(({provider:ne})=>bt(ne.name).includes(bt(p))||bt(ne.rnc||"").includes(bt(p))):x,[x,p]),ae=ne=>{d&&ne&&d.id!==ne.id?Ehe({title:"Confirmar cambio de proveedor",content:"¿Quieres reemplazar el proveedor y descartar datos actuales?",onOk(){a(wo()),a(dn({provider:ne.id})),u(ne)}}):ne?(u(ne),a(wo()),a(dn({provider:ne.id}))):(u(null),a(dn({provider:null}))),h("")},oe=()=>{a(Ys({mode:_e.CREATE.id,data:null}))},Z=ne=>{a(Ys({mode:_e.UPDATE.id,data:ne}))},J=ne=>{a(LR(ne)),a(UR())},X=()=>a(zR(null)),me=({index:ne,...pe})=>{a(BR({value:pe,index:ne}))},fe=ne=>{a(WR({id:ne}))},se=(ne,pe)=>{a(dn({[ne]:pe}))},ee=(ne,pe)=>{a(dn({[ne]:pe?We(pe).valueOf():null}))},K=ne=>{a(dn({condition:ne}))},B=m.useCallback(ne=>{a(dn({note:ne}))},[a]),_=async ne=>{var Pe;const pe=k.find(Ue=>Ue.id===ne.id);if(!pe)return console.error("No se encontró el producto completo:",ne),!1;if(v(pe),((Pe=pe.selectedBackOrders)==null?void 0:Pe.length)>0)return y(!0),!0;try{const Ue=C.filter(ut=>ut.productId===pe.id);if(Ue&&Ue.length>0)return y(!0),!0}catch(Ue){console.error("Error al verificar backorders:",Ue),V.error("Error al verificar backorders")}const ye={purchaseQuantity:pe.quantity||0,selectedBackOrders:[]};return me({index:pe.key,...ye}),!1},L=ne=>{const pe=ne.selectedBackOrders.reduce((ut,ve)=>ut+ve.quantity,0),ye=ne.purchaseQuantity,Pe=Math.max(0,ye-pe),Ue={...ne,selectedBackOrders:ne.selectedBackOrders,purchaseQuantity:ye,quantity:Pe};me({...Ue}),y(!1),v(null)},H=()=>{y(!1),v(null)};return t.jsxs(t.Fragment,{children:[t.jsxs(khe,{children:[t.jsx(m1,{validateStatus:r!=null&&r.provider?"error":"",help:r!=null&&r.provider?"El proveedor es requerido":"",providers:Q,selectedProvider:d,onSelectProvider:ae,onAddProvider:oe,onEditProvider:Z}),t.jsx(whe,{orders:R,orderLoading:N}),t.jsx(M.Item,{label:"Número de Factura",children:t.jsx(ie,{value:I,onChange:ne=>se("invoiceNumber",ne.target.value)})}),t.jsx(M.Item,{label:"Comprobante de Compra",children:t.jsx(ie,{value:j,onChange:ne=>se("proofOfPurchase",ne.target.value)})})]}),t.jsx(hhe,{onSave:J,onClear:X,backOrderAssociationId:i}),t.jsx(ehe,{products:k,onEditProduct:me,removeProduct:fe,onQuantityClick:_}),t.jsx(rhe,{replenishments:k}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:" repeat(auto-fit, minmax(350px, 1fr))",gap:"1.4em"},children:[t.jsxs("div",{children:[t.jsxs(Ahe,{children:[t.jsx(M.Item,{label:"Condición",required:!0,children:t.jsx(ge,{options:G,value:A,onChange:K})}),t.jsx(M.Item,{label:"Fecha de Entrega",required:!0,validateStatus:r!=null&&r.deliveryAt?"error":"",help:r!=null&&r.deliveryAt?"La fecha de entrega es requerida":"",children:t.jsx(yt,{value:S?We(S):null,onChange:ne=>ee("deliveryAt",ne),format:"DD/MM/YYYY",style:{width:"100%"},status:r!=null&&r.deliveryDate?"error":""})}),t.jsx(M.Item,{label:"Fecha de Pago",required:!0,validateStatus:r!=null&&r.paymentAt?"error":"",help:r!=null&&r.paymentAt?"La fecha de pago es requerida":"",children:t.jsx(yt,{value:E?We(E):null,onChange:ne=>ee("paymentAt",ne),format:"DD/MM/YYYY",style:{width:"100%"},status:r!=null&&r.paymentAt?"error":""})})]}),t.jsx(Ihe,{initialValue:T,onNoteChange:B,errors:{}})]}),t.jsx(Yj,{files:e,attachmentUrls:n,onAddFiles:s,onRemoveFiles:o})]}),b&&t.jsx(Uc,{backOrders:C,isVisible:g,onCancel:H,onConfirm:L,initialSelectedBackOrders:b.selectedBackOrders||[],initialPurchaseQuantity:b.purchaseQuantity||0,productId:b.id,backOrderAssociationId:i})]})};f1.defaultProps={files:[],attachmentUrls:[],onAddFiles:()=>{},onRemoveFiles:()=>{},errors:{}};const Ahe=l.div`
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1em;
    @media (width <= 768px) {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
`,khe=l.div`
    overflow-x: auto;
    display: grid;
    grid-template-columns: 300px 200px 200px 200px;
    gap: 0.4em;
  
`,The=(e,n={})=>{const s=(r,i)=>r==null?i in n?n[i]:null:typeof r=="string"&&r.trim()===""?"":typeof r=="number"&&isNaN(r)?0:r instanceof Date?ue.fromDate(r):typeof r=="object"&&r!==null&&!Array.isArray(r)?o(r):Array.isArray(r)?r.map(a=>s(a)):r,o=r=>{const i={};for(const a in r)i[a]=s(r[a],a);return i};return o(e)},Phe={createdAt:null,deletedAt:null,completedAt:null,deliveryDate:null,paymentDate:null,expirationDate:null,quantity:0,unitMeasurement:"unknown",baseCost:0,taxPercentage:0,freight:0,otherCosts:0,unitCost:0,subTotal:0,calculatedITBIS:0},Dhe=(e,n)=>e.map(s=>{if(s.location==="local"){const o=n.find(r=>r.name===s.name);if(o)return{...s,location:"remote",url:o.url,size:o.size,mimeType:o.mimeType}}return s}),x1=(e,n)=>e.filter(s=>s.url&&!n.some(o=>o.url===s.url)),b1=async e=>{const n=e.map(async s=>{try{if(s.url){const o=In(Ts,s.url);await Po(o),console.log(`Deleted file: ${s.url}`)}}catch(o){console.error(`Error deleting file ${s.url}:`,o)}});await Promise.all(n)},$he=async({user:e,purchase:n,localFiles:s=[],setLoading:o=()=>{}})=>{try{o(!0),console.log("Updating purchase:",n);const r=F($,"businesses",e.businessID,"purchases",n.id),a=(await Se(r)).data();if(a!=null&&a.attachmentUrls){const f=x1(a.attachmentUrls,n.attachmentUrls||[]);f.length>0&&await b1(f)}let c=[];if(s&&s.length>0){const f=s.map(({file:x})=>x);c=await ui(e,"purchaseAndOrderFiles",f,{customMetadata:{type:"purchase_attachment"}})}const d=n.attachmentUrls||[],u=Dhe(d,c),p=f=>{if(!f)return de();const x=typeof f=="number"?f:new Date(f).getTime();return isNaN(x)?de():ue.fromMillis(x)},h={...n,createdAt:n.createdAt||de(),updatedAt:de(),deliveryAt:p(n.deliveryAt),paymentAt:p(n.paymentAt),completedAt:n.completedAt?p(n.completedAt):null,attachmentUrls:u};return await je(r,h),o(!1),h}catch(r){throw o(!1),console.error("Error updating purchase:",r),r}},Rhe=async(e,n,s)=>{const o={},r={createdAt:de(),createdBy:e.uid,updatedAt:de(),updatedBy:e.uid,deletedAt:null,deletedBy:null,isDeleted:!1};for(const i of n.replenishments){const a=`${i.id}_${i.expirationDate}`;o[a]||(o[a]={productId:i.id,productName:i.name,expirationDate:i.expirationDate,items:[]}),o[a].items.push(i)}for(const i in o){const a=o[i],c=a.items.reduce((v,C)=>v+C.quantity,0),d=`${n.id}_${a.productId}_${new Date(a.expirationDate).getTime()}`,u=F($,"businesses",e.businessID,"products",a.productId),p={stock:c,updatedAt:de(),updatedBy:e.uid};c===0&&(p.status="inactive"),await je(u,p);const h=await Ez(e,{...r,productId:a.productId,purchaseId:n.id,numberId:await Mt(e,"batches"),shortName:`${a.productName}_${new Date(a.expirationDate).toISOString().split("T")[0]}`,batchNumber:d,status:c===0?"inactive":"active",receivedDate:new Date,providerId:n.provider,quantity:c,initialQuantity:c}),f={...r,batchId:h.id,batchNumberId:h.numberId,location:`${s.id}`,productId:a.productId,productName:a.productName,quantity:c,status:c===0?"inactive":"active",initialQuantity:c,expirationDate:a!=null&&a.expirationDate?new Date(a.expirationDate):null};await pp(e,f);const x=be(),g=F($,"businesses",e.businessID,"movements",x),y={...r,id:x,batchId:h.id,productName:a.productName,batchNumberId:h.numberId,destinationLocation:s.id,sourceLocation:null,productId:a.productId,quantity:c,movementType:ro.Entry,movementReason:Zn.Purchase};await De(g,y);const b=a.items.filter(v=>v.selectedBackOrders&&v.selectedBackOrders.length>0);if(b.length>0){const v=dt($);for(const C of b)for(const I of C.selectedBackOrders){const j=F($,"businesses",e.businessID,"backOrders",I.id);v.update(j,{status:"completed",completedAt:de(),completedBy:e.uid,completedWithPurchaseId:n.id,updatedAt:de(),updatedBy:e.uid,pendingQuantity:0})}await v.commit()}}},Nhe=async(e,n,s)=>{const o=F($,"businesses",e.businessID,"purchases",n.id),i=(await Se(o)).data();if(i!=null&&i.attachmentUrls){const u=x1(i.attachmentUrls,n.attachmentUrls||[]);u.length>0&&await b1(u)}let a=[];if(s&&s.length>0){const u=s.map(({file:p})=>p);a=await ui(e,"purchaseAndOrderFiles",u,{customMetadata:{type:"purchase_attachment"}})}const c=n.attachmentUrls||[];return Wc(c,a)},Ohe=async({user:e,purchase:n,localFiles:s=[],setLoading:o=()=>{}})=>{try{o(!0),console.log("Completing purchase:",n);const r=F($,"businesses",e.businessID,"purchases",n.id),i=await Oc(e),a=await Nhe(e,n,s),c={...n,status:"completed",updatedAt:de(),deliveryAt:qt(n.deliveryAt),paymentAt:qt(n.paymentAt),completedAt:n.completedAt?qt(n.completedAt):null,attachmentUrls:a};return await je(r,c),await Rhe(e,n,i),o(!1),c}catch(r){throw o(!1),console.error("Error completing purchase:",r),r}},Mhe=l.div`
  display: grid;
  height: 100vh;
  grid-template-rows: min-content 1fr min-content;
  overflow-y: hidden;
`,Fhe=l.div`
 padding: 1em;
  overflow-y: auto;
 width: 100%;
  margin: 0 auto;
`,Bhe=l.div`
  display: flex;
  justify-content: flex-end;
  position: sticky;
  bottom: 0;
  width: 100%;
  gap: 1em;
  background-color: #ffffff;
  padding: 1em;
  border-top: 1px solid #e8e8e8;
  margin-top: auto;
`;function y1({mode:e,purchaseId:n,orderId:s,operationType:o}){if(!e)throw new Error("Mode is required");if(e==="create"||!n&&o==="purchase"||!s&&o==="order")return null;switch(o){case"purchase":return e==="convert"?s:n;case"order":return e==="update"?s:null;default:throw new Error(`Invalid operationType: ${o}`)}}const ia=()=>{const e=W(),n=Fe(),{id:s}=so(),o=_t(),r=m.useMemo(()=>s?o.pathname.includes("/complete/")?"complete":o.pathname.includes("/convert-to-purchase/")?"convert":"update":"create",[s,o]),i=D(q),{purchase:a}=D(_R),c=y1({mode:r,purchaseId:s,orderId:a==null?void 0:a.orderId,operationType:"purchase"}),{PURCHASES:d}=re.PURCHASE_TERM,[u,p]=m.useState([]),[h,f]=m.useState(!1),[x,g]=m.useState({provider:!1,deliveryAt:!1,paymentAt:!1,note:!1}),{purchase:y,isLoading:b}=ST(s),{order:v}=tb(s),[C,I]=m.useState(!1),[j,k]=m.useState(null),A=m.useCallback(N=>{e(dn(N))},[e]),P=m.useCallback(N=>{const G=N.map(Q=>({type:Q.type,url:g1(Q.file),location:"local",id:Q.id,name:Q.name}));A({attachmentUrls:[...a.attachmentUrls||[],...G]}),p(Q=>[...Q,...N])},[a.attachmentUrls,A]),w=m.useCallback(N=>{p(G=>G.filter(Q=>Q.id!==N)),A({attachmentUrls:(a.attachmentUrls||[]).filter(G=>G.id!==N)})},[a.attachmentUrls,A]),S=m.useCallback(()=>{const N={provider:!a.provider,deliveryAt:!a.deliveryAt,paymentAt:!a.paymentAt,note:!1};return g(N),!Object.values(N).some(G=>G)},[a]);m.useEffect(()=>{(r==="update"||r==="complete")&&y?e(dn(y)):r==="convert"&&v&&e(dn({...v,id:"",orderId:v.id}))},[r,y,v,e]);const E=m.useCallback(async()=>{var N;if(!S()){V.error("Por favor complete todos los campos requeridos");return}if(((N=a==null?void 0:a.replenishments)==null?void 0:N.length)===0){V.error("Agrega un producto a la compra");return}f(!0);try{const G=The(a,Phe);switch(r){case"create":await hx({user:i,purchase:G,localFiles:u});break;case"update":await $he({user:i,purchase:G,localFiles:u});break;case"complete":await Ohe({user:i,purchase:G,localFiles:u}),n(d,{state:{completedPurchase:G,showSummary:!0}});break;case"convert":await hx({user:i,purchase:G,localFiles:u});break}V.success("Compra guardada exitosamente"),e(wo()),r!=="complete"&&n(d)}catch(G){console.error("Error al guardar la compra:",G),V.error("Error al guardar la compra")}finally{f(!1)}},[e,n,i,a,u,S,d,r]),T=m.useCallback(()=>{I(!1),e(wo()),n(d)},[e,n,d]),R=m.useCallback(()=>{e(wo()),n(d)},[e,n,d]);return m.useEffect(()=>{r==="create"&&e(wo())},[e,r]),t.jsxs(Mhe,{children:[t.jsx(Ze,{showBackButton:!1,sectionName:r==="create"?"Nueva Compra":r==="complete"?"Completar Compra":r==="convert"?"Convertir a Compra":"Editar Compra"}),t.jsx(ku,{loading:b,minHeight:"200px",children:t.jsx(Fhe,{children:t.jsx(M,{layout:"vertical",children:t.jsx(f1,{files:u,attachmentUrls:a.attachmentUrls||[],onAddFiles:P,onRemoveFiles:w,errors:x,backOrderAssociationId:c})})})}),t.jsxs(Bhe,{children:[t.jsx(U,{onClick:R,children:"Cancelar"}),t.jsx(U,{type:"primary",onClick:E,loading:h,children:"Guardar"})]}),t.jsx(ab,{visible:C,onClose:T,purchase:j})]})},Lhe=l.div`
  display: grid;
  height: 100vh;
  grid-template-rows: min-content 1fr min-content;
  overflow-y: hidden;
`,zhe=l.div`
 padding: 1em;
  overflow-y: auto;
 width: 100%;
  margin: 0 auto;
`,Uhe=l.div`
  display: flex;
  justify-content: flex-end;
  position: sticky;
  bottom: 0;
  width: 100%;
  gap: 1em;
  background-color: #ffffff;
  padding: 1em;
  border-top: 1px solid #e8e8e8;
  margin-top: auto;
`,fx=()=>{const e=W(),n=Fe(),{id:s}=so(),o=s?"update":"create",r=D(q),{order:i}=D(a$),{ORDERS:a}=re.ORDER_TERM,c=y1({mode:o,orderId:i.id,operationType:"order"}),[d,u]=m.useState([]),[p,h]=m.useState(!1),[f,x]=m.useState({provider:!1,deliveryAt:!1,note:!1}),{order:g,isLoading:y}=tb(s),b=m.useCallback(A=>{e(fs(A))},[e]),v=m.useCallback(A=>{const P=A.map(w=>({type:w.type,url:g1(w.file),location:"local",id:w.id,name:w.name}));b({attachmentUrls:[...i.attachmentUrls||[],...P]}),u(w=>[...w,...A])},[i.attachmentUrls,b]),C=m.useCallback(A=>{u(P=>P.filter(w=>w.id!==A)),b({attachmentUrls:(i.attachmentUrls||[]).filter(P=>P.id!==A)})},[i.attachmentUrls,b]),I=m.useCallback(()=>{const A={provider:!i.provider,deliveryAt:!i.deliveryAt,note:i.note&&i.note.length>300};return x(A),!Object.values(A).some(P=>P)},[i]);m.useEffect(()=>{o==="update"&&g&&e(fs(g))},[o,g,e]);const j=m.useCallback(async()=>{if(!I()){V.error("Por favor complete todos los campos requeridos");return}h(!0);try{const A=Yme(i,Kme);o==="create"?await Jme({user:r,order:A,localFiles:d}):o==="update"&&await Xme({user:r,order:A,localFiles:d}),V.success("Pedido guardado exitosamente"),e(ol()),n(a)}catch(A){console.error("Error al guardar el pedido:",A),V.error("Error al guardar el pedido")}finally{h(!1)}},[e,n,r,i,d,I,a,o]),k=m.useCallback(()=>{e(ol()),n(a)},[e,n,a]);return m.useEffect(()=>{o==="create"&&e(ol())},[e,o]),t.jsxs(Lhe,{children:[t.jsx(Ze,{showBackButton:!1,sectionName:o==="create"?"Nuevo Pedido":"Editar Pedido"}),t.jsx(ku,{loading:y,minHeight:"200px",children:t.jsx(zhe,{children:t.jsx(M,{layout:"vertical",children:t.jsx(h1,{mode:o,files:d,attachmentUrls:i.attachmentUrls||[],onAddFiles:v,onRemoveFiles:C,errors:f,backOrderAssociationId:c})})})}),t.jsxs(Uhe,{children:[t.jsx(U,{onClick:k,children:"Cancelar"}),t.jsx(U,{type:"primary",onClick:j,loading:p,children:"Guardar"})]})]})},{RangePicker:Whe}=yt,{Option:qhe}=ge,Vhe=l.div`
  margin-bottom: 24px;
`,Ghe=l.div`
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
`,md=l.div`
  padding: 6px 12px;
  border-radius: 4px;
  min-width: 80px;
  
  &.total {
    background: #fafafa;
    border: 1px solid #f0f0f0;
  }
  
  &.pending {
    background: #fff7e6;
    border: 1px solid #ffd591;
  }
  
  &.reserved {
    background: #e6f7ff;
    border: 1px solid #91d5ff;
  }
`,_he=l.div`
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
`,Hhe=[{value:"pending-desc",label:"Mayor cantidad pendiente"},{value:"pending-asc",label:"Menor cantidad pendiente"},{value:"date-desc",label:"Más recientes"},{value:"date-asc",label:"Más antiguos"},{value:"progress-desc",label:"Mayor progreso"},{value:"progress-asc",label:"Menor progreso"}],Qhe=({stats:e,searchText:n,setSearchText:s,dateRange:o,setDateRange:r,sortBy:i,setSortBy:a})=>t.jsxs(Vhe,{children:[t.jsxs(Ghe,{children:[t.jsxs(md,{className:"total",children:[t.jsx("div",{style:{fontSize:"16px",fontWeight:"500"},children:e.total}),t.jsx("div",{style:{fontSize:"11px",color:"#8c8c8c"},children:"Total"})]}),t.jsxs(md,{className:"pending",children:[t.jsx("div",{style:{fontSize:"16px",fontWeight:"500"},children:e.pending}),t.jsx("div",{style:{fontSize:"11px",color:"#8c8c8c"},children:"Pendientes"})]}),t.jsxs(md,{className:"reserved",children:[t.jsx("div",{style:{fontSize:"16px",fontWeight:"500"},children:e.reserved}),t.jsx("div",{style:{fontSize:"11px",color:"#8c8c8c"},children:"Reservados"})]})]}),t.jsxs(_he,{children:[t.jsx(ie,{placeholder:"Buscar producto",prefix:t.jsx(Kr,{}),value:n,onChange:c=>s(c.target.value),style:{width:"180px"}}),t.jsx(Whe,{onChange:r,placeholder:["Inicio","Fin"],style:{width:"auto"}}),t.jsx(ge,{value:i,onChange:a,style:{width:"160px"},placeholder:"Ordenar por",suffixIcon:t.jsx(d0,{}),children:Hhe.map(c=>t.jsx(qhe,{value:c.value,children:c.label},c.value))})]})]}),Yhe=l(Ie.div)`
  padding: 8px 12px;
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 12px;
  border-radius: 4px;
  background: white;
  border: 1px solid #f0f0f0;
`,Khe=l.div`
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  height: fit-content;
  align-self: center;
  text-transform: capitalize;
  font-weight: 500;
  background: ${e=>e.status==="pending"?"#fff7e6":"#e6f7ff"};
  color: ${e=>e.status==="pending"?"#d46b08":"#096dd9"};
  border: 1px solid ${e=>e.status==="pending"?"#ffd591":"#91d5ff"};
`,Jhe=l.div`
  display: flex;
  flex-direction: column;
  gap: 4px;
  align-items: flex-end;
`,Xhe=l.span`
  font-size: 11px;
  color: #595959;
  font-weight: 500;
`,Zhe=l.span`
  font-size: 13px;
  font-weight: 500;
  color: #262626;
`,ege=({item:e,index:n})=>t.jsxs(Yhe,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.15,delay:n*.02},children:[t.jsx(Khe,{status:e.status,children:e.status==="pending"?"Pendiente":"En proceso"}),t.jsxs(Jhe,{children:[t.jsx(Xhe,{children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.jsxs(Zhe,{children:[e.pendingQuantity," unidades"]})]})]}),tge=l(Ie.div)`
  background: white;
  border-radius: 8px;
  border: 1px solid #e6e6e6;
  overflow: hidden;
  height: ${e=>e.isCollapsed?"min-content":"auto"};

`,nge=l.div`
  border-bottom: ${e=>e.isCollapsed?"none":"1px solid #f0f0f0"};
  background: white;
`,sge=l.div`
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 8px 16px;
  height: ${e=>e.isCollapsed?"0":"auto"};
`,oge=l.div`
  padding: 8px 0;
  font-weight: 500;
  font-size: 13px;
  color: #8c8c8c;
  border-bottom: 1px solid #f0f0f0;
  margin-bottom: 8px;
`,rge=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 8px;
`,ige=({group:e,isCollapsed:n,onToggle:s})=>t.jsxs(tge,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},isCollapsed:n,children:[t.jsx(nge,{isCollapsed:n,children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 16px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx(U,{type:"text",icon:n?t.jsx(l0,{}):t.jsx(c0,{}),onClick:s,size:"small",style:{padding:4}}),t.jsx("span",{style:{fontSize:"14px",fontWeight:"500"},children:e.productName})]}),t.jsxs("span",{style:{fontSize:"14px"},children:[e.totalQuantity," u"]})]})}),!n&&t.jsx(sge,{isCollapsed:n,children:Object.entries(e.dateGroups).sort(([,o],[,r])=>r.date-o.date).map(([o,r])=>t.jsxs("div",{children:[t.jsxs(oge,{children:[new Date(r.date).toLocaleDateString()," - ",r.totalQuantity," unidades"]}),t.jsx(rge,{children:r.items.map((i,a)=>t.jsx(ege,{item:i,index:a},i.id))})]},o))})]}),age=l.div`
  height: 100vh;
  display: flex;
  flex-direction: column;
`,cge=l.div`
  flex: 1;
  padding: 24px;
  background: #ffffff;
  overflow-y: auto;
`,lge=l.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
  gap: 12px;
`,dge=()=>{const[e,n]=m.useState(""),[s,o]=m.useState(null),[r,i]=m.useState("date-desc"),[a,c]=m.useState({}),{data:d}=dde();D(q);const u=m.useMemo(()=>({total:d.length,pending:d.filter(f=>f.status==="pending").length,reserved:d.filter(f=>f.status==="reserved").length,completed:d.filter(f=>f.status==="completed").length}),[d]),p=m.useMemo(()=>{const x=d.filter(g=>{const y=e?g.productName.toLowerCase().includes(e.toLowerCase()):!0,b=s?new Date(g.createdAt)>=s[0].startOf("day")&&new Date(g.createdAt)<=s[1].endOf("day"):!0;return y&&b}).reduce((g,y)=>{const b=y.productId,v=new Date(y.createdAt).toLocaleDateString();return g[b]||(g[b]={productId:b,productName:y.productName,totalQuantity:0,pendingQuantity:0,lastUpdate:y.updatedAt,progress:0,dateGroups:{}}),g[b].dateGroups[v]||(g[b].dateGroups[v]={date:new Date(y.createdAt),items:[],totalQuantity:0,pendingQuantity:0}),g[b].dateGroups[v].items.push(y),g[b].dateGroups[v].totalQuantity+=y.initialQuantity||0,g[b].dateGroups[v].pendingQuantity+=y.pendingQuantity||0,g[b].totalQuantity+=y.initialQuantity||0,g[b].pendingQuantity+=y.pendingQuantity||0,g[b].lastUpdate=new Date(Math.max(new Date(g[b].lastUpdate),new Date(y.updatedAt))),g[b].progress=Math.round((g[b].totalQuantity-g[b].pendingQuantity)/g[b].totalQuantity*100),g},{});return Object.values(x).sort((g,y)=>{switch(r){case"pending-desc":return y.pendingQuantity-g.pendingQuantity;case"pending-asc":return g.pendingQuantity-y.pendingQuantity;case"date-desc":return y.lastUpdate-g.lastUpdate;case"date-asc":return g.lastUpdate-y.lastUpdate;case"progress-desc":return y.progress-g.progress;case"progress-asc":return g.progress-y.progress;default:return 0}})},[d,e,s,r]),h=f=>{c(x=>({...x,[f]:!x[f]}))};return t.jsxs(age,{children:[t.jsx(Ze,{data:[],sectionName:"BackOrders",sectionNameIcon:"📦",displayName:"Back Orders",onBackClick:()=>{}}),t.jsx(r1,{}),t.jsxs(cge,{children:[t.jsx(Qhe,{stats:u,searchText:e,setSearchText:n,dateRange:s,setDateRange:o,sortBy:r,setSortBy:i}),t.jsx(gt,{children:t.jsx(lge,{children:p.map(f=>t.jsx(ige,{group:f,isCollapsed:a[f.productId],onToggle:()=>h(f.productId)},f.productId))})})]})]})},{PURCHASES:uge,PURCHASES_CREATE:pge,PURCHASES_UPDATE:mge,PURCHASES_COMPLETE:hge,BACKORDERS:gge}=re.PURCHASE_TERM,{ORDERS:fge,ORDERS_CREATE:xge,ORDERS_CONVERT:bge,ORDERS_UPDATE:yge}=re.ORDER_TERM,vge=[{path:uge,element:t.jsx(RT,{})},{path:pge,element:t.jsx(ia,{})},{path:mge,element:t.jsx(ia,{})},{path:hge,element:t.jsx(ia,{})},{path:fge,element:t.jsx(kk,{})},{path:xge,element:t.jsx(fx,{})},{path:yge,element:t.jsx(fx,{})},{path:bge,element:t.jsx(ia,{})},{path:gge,element:t.jsx(dge,{})}],jge=()=>(W(),t.jsx("div",{children:t.jsx(pc,{})})),Cge=[{path:"/lab",element:t.jsx(jge,{})}],v1=()=>{const e=D(q);return t.jsxs(wge,{children:[t.jsx(Sge,{children:z.user.user}),e==null?void 0:e.displayName]})},wge=l.div`
  display: flex;
  align-items: center;
  gap: 0.4em;

`,Sge=l.div`
  width: 1.6em;
  height: 1.6em;
  border-radius: 50%;
  background-color: var(--Black);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.2em;
  margin-right: 0.4em;
`,Ep=({date:e})=>{let n;if(typeof e=="string")try{e=JSON.parse(e)}catch(r){console.error("Error parsing date string:",r)}typeof e=="number"&&(n=ce.fromMillis(e));const s=n?n.toLocaleString(ce.DATE_SHORT):"",o=n?n.toFormat("hh:mm a"):"";return e&&n&&t.jsx(Ige,{children:t.jsxs(Ege,{children:[t.jsx("span",{children:s}),t.jsx("span",{children:o})]})})},Ige=l.div`

//border-radius: var(--border-radius);
//background-color: var(--White);
//border: 1px solid rgba(0, 0, 0, 0.150);
//padding: 0.1em 0.6em;
//display: flex;
//align-items: center;
//align-content: center;
//justify-content: space-between;
`,Ege=l.div`
display: flex;
gap: 1em;
align-items: center;
grid-template-columns: 1fr 1fr;
flex-wrap: nowrap;
font-size: 14px;



`;l.div`
    display: flex;
    gap: 1em;
    align-items: center;
    
`;l.span`
  font-size: 13px;
 color: var(--Gray5);


  margin-bottom: 0px;
`;l.div`
    border-radius: var(--border-radius);
    padding: 0.2em 0.6em;
    background-color: #eee094;
`;const Age=qe`
  display: inline-flex;
  align-items: center;
  justify-content: space-between;
  border: 1px solid #e2e1e1;
  border-radius: 50px;
  padding: 0.4em 0.6em;
  gap: 0.6em;
  font-size: 1em;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.25s ease;
  width: auto;

  &:active {
    transform: translateY(1px);
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
  }
  &:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    box-shadow: none;
  }
`,kge=l.button`
  ${Age}
  background-color: ${({bg:e})=>e||"white"};
  color: ${({color:e})=>e||"black"};
`,Tge=l.span`
  display: flex;
  align-items: center;

`,Pge=l.span`
  font-weight: 500;
 
`,j1=({icon:e,children:n,loading:s,bg:o,color:r,disabled:i,onClick:a,badgeCount:c})=>t.jsxs(kge,{bg:o,color:r,disabled:i||s,onClick:a,children:[e&&t.jsx(Tge,{children:e}),t.jsx(Pge,{children:n}),t.jsx(kn,{count:c,overflowCount:9999,style:{zIndex:10}}),s&&t.jsx(He,{size:"small"})]}),Dge=({invoices:e=[]})=>{const[n,s]=m.useState(!1),o=()=>e.map(c=>Ga({data:c.data,type:"Resumen"})),r=()=>Ga({data:e,type:"Detailed"}),i=async c=>{if(e.length===0){V.error("No hay Facturas para exportar");return}s(!0);try{const d=(async()=>{switch(c){case"Resumen":const p=_a("Resumen","REPORTE DE CONCILIACIÓN - RESUMEN");return await Va(o(),"Conciliación Resumen","conciliacion_resumen.xlsx",p),"El reporte resumen se ha generado correctamente";case"Detailed":const h=_a("Detailed","REPORTE DE CONCILIACIÓN - DETALLE");return await Va(r(),"Conciliación Detalle","conciliacion_detalle.xlsx",h),"El reporte detallado se ha generado correctamente";default:return"Exportación completada"}})(),[u]=await Promise.all([d,new Promise(p=>setTimeout(p,1e3))]);V.success(u)}catch(d){console.error("Error al exportar:",d),V.error("Hubo un problema al generar el archivo Excel. Inténtelo nuevamente.")}finally{s(!1)}},a=[{key:"detailed",label:"Exportar Detalle",onClick:()=>i("Detailed"),disabled:n},{key:"resumen",label:"Exportar Resumen",onClick:()=>i("Resumen"),disabled:n}];return t.jsx($ge,{children:t.jsx(Rge,{children:t.jsx(Qs,{menu:{items:a},placement:"bottomRight",disabled:n,children:t.jsx(U,{icon:n?t.jsx(Nge,{icon:An,style:{marginRight:4}}):z.arrows.chevronDown,disabled:n,children:n?"Generando...":"Exportar"})})})})},$ge=l.div`
    max-width: 1300px;
    width: 100%;
    height: 3em;
    display: flex;
    align-items: center;
    margin: 0 auto;
    gap: 1em;
    justify-content: space-between;
`,Rge=l.div`   
    display: flex;
    align-items: center;
    gap: 1em;
`,Nge=l(O)`
    animation: spin 1s linear infinite;
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
`,Oge=m.lazy(()=>ks(()=>import("./SaleReportTable-BqR42KvU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166]))),Mge=()=>t.jsx("div",{style:{padding:"2em",textAlign:"center"},children:"Cargando..."}),C1=m.memo(({invoices:e=[],isOpen:n,onClose:s})=>t.jsx(Rt,{open:n,onClose:s,width:"100%",height:"100%",placement:"bottom",extra:t.jsx(Dge,{invoices:e}),styles:{header:{paddingBlock:0},body:{padding:0}},children:t.jsx(m.Suspense,{fallback:t.jsx(Mge,{}),children:t.jsx(Fge,{children:t.jsx(Oge,{bills:e})})})})),Fge=l.div`
    height: 100%;
    width: 100%;
    display: grid;
    grid-template-rows: 1fr;
    background-color: var(--color2);
`,Bge=({invoices:e,invoicesCount:n,loading:s})=>{const[o,r]=m.useState(!1),i=()=>r(!0);return t.jsxs(t.Fragment,{children:[t.jsx(j1,{onClick:i,loading:s,badgeCount:n,children:"Facturas"}),t.jsx(C1,{isOpen:o,invoices:e,onClose:()=>r(!1)})]})},Lge=({state:e="closed"})=>t.jsx(zge,{children:t.jsxs(Uge,{children:[t.jsx(xx,{children:t.jsx(v1,{})}),t.jsx(xx,{children:t.jsx(Ev,{state:e})})]})}),xx=l.div`
    display: flex;
    align-items: center;
    gap: 1em;
`,zge=l.div`
    //height: 4.4em;
    background-color: white;
    padding: 0.4em;
    border-radius: var(--border-radius);
    border: var(--border-primary);
    `,Uge=l.div`
    display: flex;
    align-items: center;
    justify-content: space-between;

    
    
`,Wge=({isExpanded:e,onClick:n})=>t.jsx(qge,{onClick:n,children:e?z.arrows.chevronUp:z.arrows.chevronDown}),qge=l.div``,Vge=({isExpanded:e,handleExpanded:n})=>{const s={open:{opacity:1,y:0,boxShadow:"inset 0px 0px 10px 0px rgba(0, 0, 0, 0.100)",backdropFilter:"blur(2.5px)"},closed:{opacity:0,y:"-100%",boxShadow:"none",blur:"blur(0px)"}};return t.jsxs(Gge,{animate:e?"closed":"open",variants:s,transition:{duration:.5},onClick:n,children:["Expandir",t.jsx("span",{children:z.arrows.UpRightAndDownLeftFromCenter})]})},Gge=l(Ie.div)`
    position: absolute;
    height: 100%;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5em;
  
`,w1=({bill:e,index:n,inputDisabled:s,readOnly:o=!1,updateBillQuantity:r})=>{const i=Y(e.value*e.quantity);return t.jsxs(_ge,{children:[t.jsx(Hge,{children:e.ref}),t.jsx(Ke,{min:0,value:e.quantity,readOnly:o,disabled:!!s,onChange:a=>r(n,a),placeholder:"cantidad",style:{width:"100%"},"aria-label":`Cantidad para denominación ${e.ref}`}),t.jsx(nt,{type:"subtitle",value:i,size:"small",align:"right"})]})};w1.propTypes={bill:we.shape({ref:we.string.isRequired,value:we.number.isRequired,quantity:we.number.isRequired}).isRequired,index:we.number.isRequired,inputDisabled:we.bool,updateBillQuantity:we.func.isRequired};const _ge=l.div`
    display: grid;
    grid-template-columns: 3em 10em 1fr;
    gap: 1.4em;
    border-radius: var(--border-radius);
    align-items: center;
`,Hge=l.div`
    width: 3.4em;
    text-align: right;
`,Ap=({isExpanded:e=null,readOnly:n=!1,inputDisabled:s=null,banknotes:o,setBanknotes:r,setIsExpanded:i,datetime:a,title:c,width:d,columns:u})=>{const p=o,h=m.useRef(null),f=()=>i(!e),x=p.reduce((y,b)=>y+b.value*b.quantity,0),g={open:{opacity:1,height:"auto"},closed:{overflow:"hidden",height:"4em"}};return t.jsxs(Qge,{width:d,ref:h,children:[t.jsxs(Kge,{children:[t.jsx(bx,{children:t.jsx(nt,{size:"small",type:"title",value:c})}),t.jsxs(bx,{children:[a&&t.jsx(nt,{size:"xsmall",value:a}),t.jsx(Wge,{onClick:f,isExpanded:e})]})]}),t.jsxs(Yge,{animate:e?"open":"closed",variants:g,transition:{duration:.5},columns:u,children:[p.slice().reverse().map((y,b)=>t.jsx(w1,{bill:y,inputDisabled:s,readOnly:n,index:b,updateBillQuantity:(v,C)=>{const I=[...p];I[p.length-1-v]={...p[p.length-1-v],quantity:C||""},r(I)}},b)),t.jsx(Vge,{isExpanded:e,handleExpanded:f})]}),t.jsxs(Jge,{children:[t.jsx(nt,{size:"small",type:"title",value:"Total:"}),t.jsx(nt,{size:"small",align:"right",type:"title",value:mt(p.reduce((y,b)=>y+Number(b.quantity),0))}),t.jsx(nt,{size:"small",type:"title",align:"right",value:Y(x)})]})]})},Qge=l.div`
    box-sizing: border-box;
    display: grid;
    font-family: 'Noto Sans Mono', monospace;
    ${({width:e})=>e==="small"&&`
        max-width: 20em;
    `}
    background-color: white;
    border-radius: var(--border-radius);
    border: 1px solid #e2e2e2;
   
`,Yge=l(Ie.div)`
    padding: 0.6em;
    display: grid;
    gap: 0.4em ;
    overflow: hidden;
    position: relative;
    
    ${({columns:e})=>{switch(e){case"auto":return`
                grid-template-columns: repeat(auto-fit, minmax(20em, 1fr));
            `;case"1":return`
                grid-template-columns: 1fr;
            `;case"2":return`
                grid-template-columns: repeat(2, 1fr);
            `;default:return`
                grid-template-columns: 1fr;
            `}}}
`;l.div`
    width: 3.4em;
    text-align: right;
`;const Kge=l.div`
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.6em;
    border-bottom: 1px solid var(--Gray2);
`,Jge=l.div`
    border-top: 1px solid var(--Gray2);
    padding: 0.4em ;
    display: grid;
    grid-template-columns: 3.6em 10em 1fr;
    gap: 0.8em;
    font-weight: bold;
    position: sticky;
    bottom: 0;
    span{
        :nth-child(2){
            text-align: right;
        }
            :last-child{

            text-align: right;
        }
    }
`,bx=l.div`
    display: flex;
    gap: 1em;
    align-items: center;
`,kp=({icon:e,label:n,...s})=>t.jsx(Xge,{children:t.jsx(Zge,{label:n,colon:!1,labelCol:{span:24},wrapperCol:{span:24},children:t.jsx(ie.TextArea,{label:n,placeholder:"Escribe aquí ...",icon:e,autoSize:{minRows:2,maxRows:10},...s})})}),Xge=l.div`
    padding: 0.4em 0.4em; 
    background-color: white;
    border-radius: 0.5em;
    border: var(--border-primary);

`,Zge=l(M.Item)`
    margin: 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    
    .ant-form-item-label {
        text-align: left;
        padding: 0;
        display: block;
        margin-bottom: 4px;
    }

    .ant-form-item-label > label {
        height: auto;
    }

    .ant-form-item-control {
        width: 100%;
    }
 `,yx=({user:e,user2:n,label:s="Entregado por",label2:o="",title:r})=>t.jsxs(efe,{children:[r&&t.jsx(nt,{value:r,size:"small",type:"title"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(vx,{children:[t.jsx(jx,{label:s,colon:!1,labelCol:{span:24},wrapperCol:{span:24},children:t.jsx(ie,{readOnly:!0,value:e==null?void 0:e.name})}),t.jsx(Cx,{children:z.user.userCheck})]}),n&&t.jsxs(vx,{children:[t.jsx(jx,{label:o,colon:!1,labelCol:{span:24},wrapperCol:{span:24},children:t.jsx(ie,{readOnly:!0,value:n==null?void 0:n.name})}),t.jsx(Cx,{children:z.user.userCheck})]})]})]}),efe=l.div`
    padding: 0.4em;
    background-color: white;
    border-radius: var(--border-radius);
    border: var(--border-primary);
    display: grid;
    gap: 0.4em;

 `,vx=l.div`
    display: grid;
    grid-template-columns: 1fr min-content;
    gap: 0.4em;
 `,jx=l(M.Item)`
    margin: 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    
    .ant-form-item-label {
        text-align: left;
        padding: 0;
        display: block;
        margin-bottom: 4px;
    }

    .ant-form-item-label > label {
        height: auto;
    }

    .ant-form-item-control {
        width: 100%;
    }
 `,Cx=l.div`
    width: 2em;
    height: 2em;
    align-self: end;
    display: flex;
    align-items: center;
    justify-content: center;

 `,tfe=({calculationIsOpen:e,setCalculationIsOpen:n})=>{var a,c,d,u;const s=D(_o),{banknotes:o}=s.opening,r=W(),i=p=>r(jy(p));return t.jsxs(nfe,{children:[t.jsx(Ap,{readOnly:!0,banknotes:o,setBanknotes:i,title:"Apertura",datetime:t.jsx(Ep,{date:s.opening.date}),isExpanded:e,setIsExpanded:n}),t.jsx(yx,{user:(a=s.opening)==null?void 0:a.employee,label:"Entregado por",user2:(c=s.opening)==null?void 0:c.approvalEmployee,label2:"Recibido por",title:"Autorización de Apertura"}),s.closing.initialized===!0?t.jsx(yx,{user:(d=s.closing)==null?void 0:d.employee,label:"Entregado por",user2:(u=s.closing)==null?void 0:u.approvalEmployee,label2:"Recibido por",title:"Autorización de Cierre"}):null,t.jsx(kp,{label:"Comentario de apertura",placeholder:"Escribe aquí ...",readOnly:!0,rows:6,value:s.opening.comments})]})},nfe=l.div`
  display: grid;
  align-items: start;
  align-content: start;
  gap: 0.4em;
`,_s=({label:e=null,...n})=>t.jsxs(sfe,{label:e,children:[e&&t.jsx(nt,{size:"small",type:"title",...n,value:e}),t.jsx(Ke,{addonBefore:"$",...n,style:{width:"100%"}})]}),sfe=l.div`
    display: grid;
    align-items: center;
    align-content: center;
    padding: 0 0.4em ;
    gap: 1em;
    ${e=>e&&`
        grid-template-columns: 10em 1fr;
    `}
   
`,ofe=({invoices:e,loading:n})=>{const s=D(_o),{totalCard:o,totalRegister:r,totalTransfer:i}=rp(s,e);return t.jsx(He,{spinning:n,children:t.jsxs(rfe,{children:[t.jsx(_s,{label:"Total Tarjeta",readOnly:!0,type:"subtitle",value:mt(o)}),t.jsx(_s,{label:"Total Transferencia",readOnly:!0,type:"subtitle",value:mt(i)}),t.jsx(_s,{label:"Total en caja",type:"subtitle",readOnly:!0,value:mt(r)})]})})},rfe=l.div`
    display: grid;
    gap: 0.4em;
    padding: 0.4em;
    border-radius: var(--border-radius);
    border: var(--border1);
    background-color: white;
`,ife=({invoices:e,loading:n,expenses:s=[],expensesLoading:o=!1})=>{const r=D(_o),{totalSystem:i,totalCharged:a,totalDiscrepancy:c,totalExpenses:d}=rp(r,e,s);return t.jsx(He,{spinning:n,children:t.jsxs(afe,{children:[t.jsx(_s,{label:"Total Facturado",readOnly:!0,value:mt(a)}),d>0&&t.jsx(_s,{label:"Total Gastos",readOnly:!0,themeColor:"warning",value:mt(d)}),t.jsx(_s,{label:"Total sistema",readOnly:!0,value:mt(i)}),c!==0&&t.jsx(_s,{themeColor:c>0?"success":"danger",readOnly:!0,label:c>0?"Sobrante":"Faltante",value:mt(c)})]})})},afe=l.div`
    display: grid;
    gap: 0.4em;
    padding: 0.4em;
    border-radius: var(--border-radius);
    border: var(--border1);
    background-color: white;
`,{Title:cfe,Text:lfe}=Xe,dfe=({cashCountId:e,loading:n=!1,expenses:s=[]})=>{const[o,r]=m.useState(!1),i=()=>{r(!0),fetchExpenses()},a=()=>{r(!1)},c=[{title:"Descripción",dataIndex:["description"],key:"description",width:"40%"},{title:"Categoría",dataIndex:["category"],key:"category",width:"20%",render:u=>t.jsx(Ge,{color:"blue",children:u})},{title:"Método de Pago",dataIndex:["payment","method"],key:"paymentMethod",width:"20%",render:u=>({open_cash:"Efectivo de Caja",cash:"Efectivo",credit_card:"Tarjeta",check:"Cheque",bank_transfer:"Transferencia"})[u]||u},{title:"Monto",dataIndex:["amount"],key:"amount",width:"20%",render:u=>t.jsxs(lfe,{strong:!0,children:["RD$ ",parseFloat(u).toFixed(2)]})}],d=s.reduce((u,p)=>u+parseFloat(p.amount||0),0);return t.jsxs(ufe,{children:[t.jsx(j1,{onClick:i,loading:n,disabled:!s.length,badgeCount:s.length,children:"Gastos"}),t.jsx(Ce,{title:"Gastos Registrados",open:o,onCancel:a,footer:null,width:800,children:n?t.jsxs(mfe,{children:[t.jsx(He,{size:"large"}),t.jsx("p",{children:"Cargando gastos..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(Gt,{dataSource:s,columns:c,rowKey:"id",pagination:!1,scroll:{y:300}}),t.jsx(pfe,{children:t.jsxs(cfe,{level:4,children:["Total Gastos: RD$ ",d.toFixed(2)]})})]})})]})},ufe=l.div`
`,pfe=l.div`
  display: flex;
  justify-content: flex-end;
  margin-top: 1rem;
  padding: 1rem;
  background-color: #f7f7f7;
  border-radius: 0.4em;
`,mfe=l.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  
  p {
    margin-top: 1rem;
  }
`,hfe=async(e,n)=>{if(!e.businessID||!n)return[];console.log("user.businessID",e.businessID),console.log("cashCountID",n);const s=le($,"businesses",e.businessID,"invoices"),o=he(s,te("data.cashCountId","==",n));try{return(await Me(o)).docs.map(i=>i.data()).filter(i=>{var a;return((a=i.data)==null?void 0:a.status)!=="cancelled"}).sort((i,a)=>{const c=typeof i.data.date.toMillis=="function"?i.data.date.toMillis():new Date(i.data.date).getTime();return(typeof a.data.date.toMillis=="function"?a.data.date.toMillis():new Date(a.data.date).getTime())-c})}catch(r){return console.error("Error al cargar facturas:",r),[]}},gfe=e=>{var o;const n=D(q),s=Uo({queryKey:["invoices",n==null?void 0:n.businessID,e],queryFn:()=>hfe(n,e),enabled:!!(n!=null&&n.businessID)&&!!e});return{data:s.data,loading:s.isLoading,error:s.error,count:((o=s.data)==null?void 0:o.length)||0,refetch:s.refetch}},ffe=async(e,n)=>{if(!e.businessID||!n)return console.error("Missing required parameters for loading expenses"),{count:0,data:[],loading:!1};try{const s=le($,"businesses",e.businessID,"expenses"),o=he(s,te("expense.payment.cashRegister","==",n)),r=await Me(o),i=[];return r.forEach(a=>i.push(a.data().expense)),{count:i.length,data:i,loading:!1}}catch(s){return console.error("Error loading expenses for cash count:",s),{count:0,data:[],loading:!1,error:s.message}}},xfe=e=>{const[n,s]=m.useState({count:0,data:[],loading:!0,error:null}),o=D(q);return m.useEffect(()=>{if(!(o!=null&&o.businessID)||!e)return;const r=new AbortController;return(async()=>{try{s(a=>({...a,loading:!0,error:null}));const i=await ffe(o,e,"all",{signal:r.signal});r.signal.aborted||s(i)}catch(i){r.signal.aborted||s(a=>({...a,loading:!1,error:i}))}})(),()=>r.abort()},[o,e]),n};function bfe(e){const n=m.useMemo(()=>new Intl.NumberFormat("es-DO",{style:"currency",currency:"DOP",minimumFractionDigits:2}),[]),s=m.useCallback(()=>{if(oB(e))return"";const o=d=>d.padEnd(14," "),r="GASTOS (detalle)",i=[];let a=0;if(e.filter(d=>{var u,p;return(p=(u=d==null?void 0:d.payment)==null?void 0:u.comment)==null?void 0:p.trim()}).forEach(({description:d="—",amount:u=0,payment:p})=>{a+=Number(u),i.push("",`• ${o("Concepto:")} ${d.trim()}`,`  ${o("Importe:")} ${n.format(u)}`,`  ${o("Observaciones:")} ${p.comment.trim()}`)}),!i.length)return"";const c=`
TOTAL GASTOS: ${n.format(a)}`;return[r,...i,c].join(`
`)},[e,n]);return m.useMemo(s,[s])}const yfe=({calculationIsOpen:e,setCalculationIsOpen:n})=>{const s=W(),o=D(_o,oC),{id:r,state:i}=o,{banknotes:a,comments:c}=o.closing,d=m.useRef(!1),{data:u,loading:p,count:h}=gfe(r),{data:f,loading:x,count:g}=xfe(r),y=m.useCallback(j=>{const P=(o.closing.comments||"").replace(/\n\nGASTOS.*$/s,"").trim()+(j?`${j}`:"");s($m(P))},[s,o.closing.comments]),b=bfe(f),v=m.useCallback(j=>{s($m(j))},[s,b]),C=m.useCallback(j=>s(nR(j)),[s]),I=m.useMemo(()=>rp(o,u,f),[o,u,f]);return m.useEffect(()=>{s(sR(I)),s(eR(I))},[s,I]),m.useEffect(()=>{!d.current&&b&&(y(b),d.current=!0)},[b,y]),t.jsxs(vfe,{children:[t.jsx(Ap,{banknotes:a,setBanknotes:C,title:"Cierre",datetime:t.jsx(Ep,{date:o.closing.date}),isExpanded:e,setIsExpanded:n,readOnly:i==="closed"}),t.jsx(ofe,{invoices:u,loading:p}),t.jsxs(jfe,{children:[t.jsx(Bge,{invoices:u,invoicesCount:h,loading:p}),t.jsx(dfe,{cashCountId:r,expenses:f,loading:x})]}),t.jsx(ife,{loading:p||x,invoices:u,expenses:f}),t.jsx(kp,{label:"Comentario de cierre",placeholder:"Escribe aquí ...",readOnly:i==="closed",value:c,rows:6,onChange:j=>v(j.target.value)})]})},vfe=l.div`
  display: grid;
  align-items: start;
  align-content: start;
  gap: 0.4em;
`,jfe=l.div`
  display: flex;
  gap: 0.4em;
`,Cfe=({closingDate:e})=>{const[n,s]=m.useState(!0),[o,r]=m.useState(!1),[i,a]=m.useState("leftSide");return m.useEffect(()=>{const c=()=>{r(window.innerWidth<768)};return c(),window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c)}},[]),t.jsxs(wfe,{children:[o&&t.jsxs(Ife,{children:[t.jsx(wx,{active:i==="leftSide",onClick:()=>a("leftSide"),children:"Apertura"}),t.jsx(wx,{active:i==="rightSide",onClick:()=>a("rightSide"),children:"Cierre"})]}),t.jsxs(Sfe,{narrow:o,children:[(!o||i==="leftSide")&&t.jsx(tfe,{calculationIsOpen:n,setCalculationIsOpen:s}),(!o||i==="rightSide")&&t.jsx(yfe,{calculationIsOpen:n,setCalculationIsOpen:s,date:e})]})]})},wfe=l.div`
    display: grid;
    gap: 0.4em;
`,Sfe=l.div`
  display: grid;
  gap: 3em;
  justify-content: space-between;
  grid-template-columns: ${e=>e.narrow?"1fr":"repeat(2, 1fr)"};
`,Ife=l.div`
  display: flex;
  background: #ffffff;
  border-radius: 30px;
  width: fit-content;
  padding: 4px;
  margin: 0 auto 0 auto;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
`,wx=l.button`
  padding: 8px 16px;
  border-radius: 20px;
  border: none;
  background: ${e=>e.active?"#4285F4":"transparent"};
  color: ${e=>e.active?"white":"#333"};
  font-weight: ${e=>e.active?"600":"400"};
  cursor: pointer;
  transition: all 0.3s ease;
  
  &:hover {
    background: ${e=>e.active?"#4285F4":"#e0e0e0"};
  }

  &:focus {
    outline: none;
  }
`,S1=({onSubmit:e,onCancel:n})=>{const s=()=>{n&&n()};return t.jsxs(Efe,{children:[t.jsx(U,{onClick:s,children:e?"Cancelar":"Cerrar"}),e&&t.jsx(U,{onClick:e,type:"primary",children:"Confirmar"})]})},Efe=l.div`
    display: flex;
    gap: 1em;
    justify-content: flex-end;
`,Afe=({onSubmit:e,onCancel:n})=>t.jsx(kfe,{children:t.jsx(S1,{onSubmit:e,onCancel:n})}),kfe=l.div`
    background-color: white;
    padding: 0.4em;
    position: sticky;
    bottom: 2px;
    border-radius: var(--border-radius);
    border: var(--border-primary);
`,{Title:Tfe,Text:Pfe}=Xe,Dfe=({description:e="Permite a un segundo usuario autorizar la apertura de la caja después de una revisión."})=>t.jsxs("div",{style:{display:"grid",gap:"1em",rowGap:"1.4em"},children:[t.jsxs("div",{style:{gridTemplateColumns:"min-content 1fr",display:"grid",gap:"1.2em",paddingRight:"0.5em"},children:[t.jsx(Cp,{size:"small"}),t.jsx("div",{style:{width:"calc(100% - 2.5em)"},children:t.jsx(Tfe,{level:4,style:{margin:0,fontWeight:500},children:"Confirmación de Usuario autorizado"})})]}),t.jsx(Pfe,{type:"secondary",style:{fontSize:"0.9rem",lineHeight:"1.5"},children:e})]});async function $fe(e){const n=le($,"users"),s=he(n,te("user.name","==",e.name)),o=await Me(s);if(o.empty)throw new Error("Usuario no encontrado");return o.docs[0]}async function Rfe(e,n){const s=await Wo.compare(e.password,n.password);if(!s)throw new Error("Contraseña incorrecta");return s}const Nfe=async(e,n)=>{let s={error:null};try{const o=await $fe(e),r=o.data().user,i=await Rfe(e,r);n=o.id}catch(o){console.error("An error occurred during user validation"),s.error=o.message}return{userData:{uid:n},response:s}},Ofe=l.div`
  font-size: 1em;
  min-height: 2em;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #FFEBEE;
  color: #D32F2F;
  border-radius: 4px;
  border: 1px solid #EF5350;
  margin: 0;
  padding: 8px 12px;
  margin-top: 1em;
  font-weight: 500;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
`,I1=({isOpen:e,setIsOpen:n,onSubmit:s,description:o})=>{const[r]=M.useForm(),[i,a]=m.useState(""),[c,d]=m.useState(!1),u=W(),p=Fe(),h=()=>{r.resetFields()},f=async()=>{try{const g=await r.validateFields();d(!0);try{const{userData:y,response:b}=await Nfe(g);if(b!=null&&b.error){a(b.error),d(!1);return}s(y),setTimeout(()=>{p(-1),u(Pc())},1e3)}catch(y){d(!1),a("An error occurred. Please try again."),console.log(y)}h(),n(!1)}catch{return}},x=()=>{setTimeout(()=>{n(!1)},300),h(),a(""),d(!1)};return t.jsxs(Ce,{open:e,onCancel:x,centered:!0,width:450,destroyOnHidden:!0,styles:{body:{padding:"0px",minHeight:300,display:"flex",flexDirection:"column",gap:"1.2em"},content:{}},footer:[t.jsx(U,{onClick:x,disabled:c,children:"Cancelar"},"cancel"),t.jsx(U,{type:"primary",loading:c,onClick:f,children:"Autorizar"},"submit")],children:[t.jsx(Dfe,{description:o}),c?t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:100},children:t.jsx(He,{size:"large"})}):t.jsxs(t.Fragment,{children:[t.jsxs(M,{form:r,layout:"vertical",autoComplete:"off",children:[t.jsx(M.Item,{name:"name",label:"Nombre de usuario",rules:[{required:!0,message:"Por favor ingrese su usuario"}],children:t.jsx(ie,{placeholder:"Usuario",disabled:c,autoComplete:"off"})}),t.jsx(M.Item,{name:"password",label:"Contraseña",rules:[{required:!0,message:"Por favor ingrese su contraseña"}],children:t.jsx(ie.Password,{placeholder:"Contraseña",disabled:c,autoComplete:"new-password"})})]}),i&&t.jsx(Ofe,{children:i})]})]})},Mfe=async(e,n,s,o,r)=>{if(!e||!(e!=null&&e.businessID))return null;const i=F($,"users",s),a=F($,"users",o),c=F($,"businesses",e==null?void 0:e.businessID,"cashCounts",n.id);try{return await je(c,{"cashCount.state":"closed","cashCount.closing":{...n.closing,employee:i,approvalEmployee:a,initialized:!0,date:ue.fromMillis(r)},"cashCount.totalCard":n==null?void 0:n.totalCard,"cashCount.totalTransfer":n==null?void 0:n.totalTransfer,"cashCount.totalCharged":n==null?void 0:n.totalCharged,"cashCount.totalDiscrepancy":n==null?void 0:n.totalDiscrepancy,"cashCount.totalRegister":n==null?void 0:n.totalRegister,"cashCount.totalSystem":n==null?void 0:n.totalSystem}),"success"}catch(d){return console.error("Error writing cash count closing document: ",d),d}},Sx=async(e,n,s)=>{var r,i;if(!n||!(n!=null&&n.businessID))return null;const o=F($,"businesses",n==null?void 0:n.businessID,"cashCounts",e.id);try{if((n==null?void 0:n.uid)===((i=(r=e==null?void 0:e.opening)==null?void 0:r.employee)==null?void 0:i.id)||n.role==="admin"||n.role==="manager")return await je(o,{"cashCount.state":s,"cashCount.updatedAt":ue.fromMillis(Date.now()),"cashCount.stateHistory":Vr({state:s,timestamp:ue.fromMillis(Date.now()),updatedBy:n==null?void 0:n.uid})}),"success";throw new Error("User is not the employee who opened the cash count")}catch(a){return console.error("Error writing cash count closing document: ",a),a}},Ffe=(e,n,s,o)=>{const r=F($,"businesses",e,"cashCounts",n);return Te(r,i=>{i.exists()?s(i.data()):s(null)},o)},Bfe=e=>{const[n,s]=m.useState(null),o=D(q);return m.useEffect(()=>{if(!e||!(o!=null&&o.businessID)){s(null);return}const r=a=>{console.error("Error fetching cash count:",a),s(null)};return Ffe(o.businessID,e,s,r)},[e,o==null?void 0:o.businessID]),n},Lfe=()=>{var g;const e=W(),n=Fe(),[s,o]=m.useState(!1),[r,i]=m.useState(ce.now()),a=D(q),c=D(_o),d=(c==null?void 0:c.state)==="open",u=(c==null?void 0:c.state)==="closed";m.useEffect(()=>{d&&Sx(c,a,"closing")},[]),m.useEffect(()=>{var y;(y=c==null?void 0:c.opening)!=null&&y.initialized||n("/cash-reconciliation")},[c]);const p=()=>{if(c.opening.employee.id!==a.uid&&a.role!=="admin"){Be.error({message:"Error",description:"No tienes permisos para realizar esta acción"});return}o(!0)},h=async()=>{(c.state==="closing"||c.state==="open")&&Sx(c,a,"open"),e(Pc()),n("/cash-reconciliation")},f=async y=>{try{await Mfe(a,c,a.uid,y.uid,r.toMillis())}catch{}},x=Bfe(c==null?void 0:c.id);return t.jsxs(zfe,{children:[t.jsxs(Ufe,{children:[t.jsx(Lge,{state:(g=x==null?void 0:x.cashCount)==null?void 0:g.state}),t.jsx(Cfe,{closingDate:r}),t.jsx(Afe,{onSubmit:u?null:p,onCancel:h})]}),t.jsx(I1,{isOpen:s,setIsOpen:o,description:"Permite a un segundo usuario autorizar el cierre de la caja después de una revisión.",onSubmit:f})]})},zfe=l.div`
width: 100%;
height: 100vh;
background-color: #f0f0f0;
overflow-y: scroll;
`,Ufe=l.div`
  width: 100%;
  max-width: 1000px;
  height: 100vh;
  padding: 0.4em;
  margin: 0 auto;
  display: grid;
  gap: 0.4em;
  
`,Wfe=()=>t.jsx(qfe,{children:t.jsx(v1,{})}),qfe=l.div``,Vfe=({onSubmit:e,onCancel:n})=>t.jsx(Gfe,{children:t.jsx(S1,{onSubmit:e,onCancel:n})}),Gfe=l.div`
      background-color: #ffffff96;
      backdrop-filter: blur(5px);
      padding: 0.4em;
      position: sticky;
      bottom: 0;
      /* position: absolute;
      bottom: 4px;
      right: 0; */
      border-radius: var(--border-radius);
      border: var(--border-primary);
  `,_fe=async(e,n,s,o,r)=>{if(!e||!(e!=null&&e.businessID))return null;const i=F($,"users",s),a=F($,"users",o),c=be(10),d=await Mt(e,"lastCashCountId");n={...n,id:c,incrementNumber:d};const u=F($,"businesses",e==null?void 0:e.businessID,"cashCounts",c);try{return await De(u,{cashCount:{...n,createdAt:ue.fromMillis(Date.now()),updatedAt:ue.fromMillis(Date.now()),state:"open",opening:{...n.opening,employee:i,approvalEmployee:a,initialized:!0,date:ue.fromMillis(r)}}}),"success"}catch(p){return console.error("Error writing cash count opening document: ",p),p}},Hfe=()=>{const[e,n]=m.useState(!1),s=D(_o),{banknotes:o}=s.opening,[r,i]=m.useState(ce.now()),[a,c]=m.useState(!0),d=Fe(),u=_t(),p=W(),h=v=>{p(jy(v))},f=v=>{p(tR(v))},x=()=>{n(!0)},g=D(q),y=v=>{_fe(g,s,g.uid,v.uid,r.toMillis())},b=()=>{var v;((v=u.state)==null?void 0:v.from)==="factura"?d("/sales"):d(-1),p(Pc())};return t.jsxs(Qfe,{children:[t.jsxs(Yfe,{children:[t.jsx(Wfe,{}),t.jsx(Ap,{title:"Efectivo para apertura",banknotes:o,datetime:t.jsx(Ep,{date:r}),setBanknotes:h,isExpanded:a,setIsExpanded:c}),t.jsx(kp,{label:"Comentario de Apertura",onChange:v=>f(v.target.value)}),t.jsx(Vfe,{onSubmit:x,onCancel:b})]}),t.jsx(I1,{isOpen:e,setIsOpen:n,onSubmit:y})]})},Qfe=l.div`
  background-color: #F5F5F5;
  height: 100vh;
  overflow-y: scroll;
  
`,Yfe=l.div`
  max-width: 500px;
  height: 100vh;
  position: relative;
  margin: 0 auto;
  display: grid;
  align-items: start;
  align-content: start;
  gap: 0.8em;
  padding: 1em;
`,{CASH_RECONCILIATION_CLOSURE:Kfe,CASH_RECONCILIATION_LIST:Jfe,CASH_RECONCILIATION_OPENING:Xfe,CASH_RECONCILIATION_INVOICE_OVERVIEW:Zfe}=re.CASH_RECONCILIATION_TERM,exe=[{path:Jfe,element:t.jsx(Tv,{})},{path:Kfe,element:t.jsx(Lfe,{})},{path:Xfe,element:t.jsx(Hfe,{})},{path:Zfe,element:t.jsx(C1,{})}],txe=({isOpen:e,data:n,onClose:s})=>{var c;const[o,r]=m.useState(""),i=()=>{Jj(n.user.id,o),s()},a=()=>{s(),setIsModalVisible(!1),setEditingUser(null)};return t.jsx(Ce,{title:"Editar Contraseña",open:e,onOk:i,onCancel:a,children:t.jsxs(M,{name:"editPasswordForm",initialValues:{remember:!0},onFinish:i,children:[t.jsx(Xe.Title,{level:5,children:"Editar Contraseña"}),t.jsx(M.Item,{children:t.jsx(ie,{value:(c=n==null?void 0:n.user)==null?void 0:c.name,disabled:!0})}),t.jsx(M.Item,{label:"Nueva Contraseña",name:"password",rules:[{required:!0,message:"Por favor ingresa la nueva contraseña!"}],children:t.jsx(ie.Password,{onChange:d=>r(d.target.value)})})]})})},nxe=({users:e=[]})=>{const[n,s]=m.useState(!1),[o,r]=m.useState(null),i=e.reduce((d,u)=>{if(u&&u.user&&u.user.businessID){const p=u.user.businessID;d.find(h=>h.value===p)||d.push({text:p,value:p})}return d},[]),a=[{title:"ID",dataIndex:["user","id"],key:"id"},{title:"Nombre",dataIndex:["user","name"],key:"name"},{title:"businessID",dataIndex:["user","businessID"],key:"businessID",filters:i,onFilter:(d,u)=>{var p;return((p=u==null?void 0:u.user)==null?void 0:p.businessID)===d}},{title:"Rol",dataIndex:["user","role"],key:"role"},{title:"Activo",dataIndex:["user","active"],key:"active",render:(d,u)=>u.user.active?"Sí":"No"},{title:"Intentos de Ingreso",dataIndex:["user","loginAttempts"],key:"loginAttempts"},{title:"Acción",key:"action",render:(d,u)=>{const p=()=>{s(!0),r(u)};return t.jsx("span",{children:t.jsx(U,{onClick:p,children:"Editar"})})}}],c={pageSize:6};return t.jsxs(sxe,{children:[t.jsx(Gt,{pagination:c,columns:a,dataSource:e,rowKey:"id"}),t.jsx(txe,{isOpen:n,data:o,onClose:()=>s(!1)})]})},sxe=l.div`
    
`;async function oxe(){const e=le($,"users");return(await Me(e)).docs.map(o=>({id:o.id,...o.data()}))}const rxe=()=>{const[e,n]=m.useState([]);return m.useEffect(()=>{oxe().then(s=>{n(s)})},[]),t.jsxs("div",{children:[t.jsx(Ze,{sectionName:"Usuarios"}),t.jsx(nxe,{users:e})]})},ixe=()=>t.jsx(rxe,{});l.textarea`
    width: 100%;
    height: 100px;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    resize: vertical;
`;const axe=async e=>{const n=F($,"app","3Iz5UZWWfF4vCJPlDSy1"),s={version:de(),lastChangelog:e};await je(n,s)},cxe=async e=>{let n={id:be(12),content:e,createdAt:ue.now()};try{const s=F($,"changelogs",n.id);await De(s,{changelog:n}),await axe(n==null?void 0:n.id)}catch(s){throw console.error("Error adding document: ",s),s}},lxe=({editorState:e,setEditorState:n,onClear:s})=>{const o=Fe(),r=h=>{const f=mn.RichUtils.toggleInlineStyle(e,h);n(f)},i=h=>{const f=mn.RichUtils.toggleBlockType(e,h);n(f)},a=h=>e.getCurrentInlineStyle().has(h),c=h=>mn.RichUtils.getCurrentBlockType(e)===h,d=async h=>{try{const f=h.getCurrentContent(),x=mn.convertToRaw(f),g=JSON.stringify(x);await cxe(g)}catch{}},u=()=>{o("/home"),s()},p=[{text:"H1",action:()=>i("header-one"),isActive:c("header-one")},{text:"H2",action:()=>i("header-two"),isActive:c("header-two")},{text:"H3",action:()=>i("header-three"),isActive:c("header-three")},{text:"H4",action:()=>i("header-four"),isActive:c("header-four")},{text:"H5",action:()=>i("header-five"),isActive:c("header-five")},{text:"H6",action:()=>i("header-six"),isActive:c("header-six")}];return t.jsxs(dxe,{children:[t.jsxs(Kt,{onClick:()=>u(),children:[z.arrows.replyAll,"Salir"]}),t.jsxs(Kt,{onClick:()=>d(e),children:[z.editingActions.save,"Guardar"]}),t.jsxs(Kt,{onClick:()=>r("STRIKETHROUGH"),isActive:a("STRIKETHROUGH"),size:"small",children:[z.fontStyles.strikeThrough,"Tachado"]}),t.jsxs(Kt,{onClick:()=>r("BOLD"),isActive:a("BOLD"),size:"small",children:[z.fontStyles.bold," Negrita"]}),t.jsxs(Kt,{onClick:()=>r("ITALIC"),isActive:a("ITALIC"),size:"small",children:[z.fontStyles.italic,"Cursiva"]}),t.jsxs(Kt,{onClick:()=>r("UNDERLINE"),isActive:a("UNDERLINE"),size:"small",children:[z.fontStyles.underline,"Subrayado"]}),t.jsx(cp,{options:p,customButton:t.jsxs(Kt,{size:"small",children:[z.fontStyles.heading,"Títulos"]})}),t.jsxs("div",{children:[t.jsx(Kt,{onClick:()=>i("unordered-list-item"),isActive:c("unordered-list-item"),size:"small",children:z.fontStyles.ul}),t.jsx(Kt,{onClick:()=>i("ordered-list-item"),isActive:c("ordered-list-item"),size:"small",children:z.fontStyles.ol})]}),t.jsxs(Kt,{onClick:()=>i("blockquote"),isActive:c("blockquote"),size:"small",children:[z.fontStyles.quoteLeft,"Cita"]}),t.jsx(Kt,{onClick:()=>i("atomic"),isActive:c("atomic"),children:"Imagen"}),t.jsxs(Kt,{onClick:()=>i("unstyled"),isActive:c("unstyled"),size:"small",children:[z.fontStyles.paragraph,"Párrafo"]})]})},dxe=l.div`
    display: flex;
    gap: 10px;
    background-color: #f5f5f5;
    padding: 2px 12px;
    height: 3em;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
`,Kt=l.button`
   display: grid;
    border: 1px solid #ccc;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
    font-size: ${e=>{switch(e.size){case"small":return"12px";case"medium":return"16px";case"large":return"18px";default:return"16px"}}};
    svg{
        font-size: 16px;
    }

    background-color: ${e=>e.isActive?"#007BFF":"transparent"};
    color: ${e=>e.isActive?"white":"black"};

    &:hover {
        background-color: ${e=>e.isActive?"#0056b3":"#e0e0e0"};
    }

    &:active {
        background-color: #d0d0d0;
    }
`;function uxe(){const[e,n]=m.useState(()=>mn.EditorState.createEmpty()),s=()=>n(()=>mn.EditorState.createEmpty());return t.jsxs(pxe,{children:[t.jsx(lxe,{onClear:s,editorState:e,setEditorState:n}),t.jsx(mxe,{children:t.jsx(hxe,{children:t.jsx(mn.Editor,{editorState:e,onChange:n})})})]})}const pxe=l.div`

    width: 100%;
   
`,mxe=l.div`
    width: 100%;
    height: 100%;
    display: flex;
    padding: 1em;
    align-items: center;
    justify-content: center;
    gap: 20px;
`,hxe=l.div`
    width: 100%;
    max-width: 600px;
    height: 100%;
    min-height: 200px;
    display: grid;
    background-color: #fff;
    border-radius: 4px;
    padding: 2em;
    box-shadow: 0 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;

`,gxe=()=>t.jsx(uxe,{}),fxe=({business:e,onEditBusiness:n})=>{const s=a=>{if(!a)return"Fecha no disponible";const c=ce.now(),d=a.seconds?ce.fromSeconds(a.seconds):ce.fromISO(a);if(!d.isValid)return"Fecha no válida";const u=c.diff(d,["years","months","days","hours","minutes","seconds"]).toObject();return u.years>0?`Desde hace ${u.years} ${u.years===1?"año":"años"}${u.months>0?` y ${u.months} ${u.months===1?"mes":"meses"}`:""}`:u.months>0?`Desde hace ${u.months} ${u.months===1?"mes":"meses"}${u.days>0?` y ${Math.floor(u.days)} ${Math.floor(u.days)===1?"día":"días"}`:""}`:u.days>6?`Desde hace ${Math.floor(u.days/7)} semanas`:u.days>0?`Desde hace ${Math.floor(u.days)} ${Math.floor(u.days)===1?"día":"días"}`:u.hours>0?`Desde hace ${Math.floor(u.hours)} ${Math.floor(u.hours)===1?"hora":"horas"}${u.minutes>0?` y ${Math.floor(u.minutes)} ${Math.floor(u.minutes)===1?"minuto":"minutos"}`:""}`:u.minutes>0?`Desde hace ${Math.floor(u.minutes)} ${Math.floor(u.minutes)===1?"minuto":"minutos"}${u.seconds>0?` y ${Math.floor(u.seconds)} ${Math.floor(u.seconds)===1?"segundo":"segundos"}`:""}`:u.seconds>0?`Desde hace ${Math.floor(u.seconds)} ${Math.floor(u.seconds)===1?"segundo":"segundos"}`:"Creado justo ahora"},o=m.useMemo(()=>({address:e.address||"Sin dirección proporcionada",tel:e.tel||"Sin teléfono registrado",name:e.name||"Negocio sin nombre",id:e.id||"ID no disponible",createdAt:e.createdAt,timeAgo:s(e.createdAt)}),[e]),r=a=>{a.stopPropagation(),n(e)},i=a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),r(a))};return t.jsxs(xxe,{onClick:r,onKeyDown:i,role:"button",tabIndex:0,children:["            ",t.jsxs(bxe,{children:[t.jsx(Oe,{title:o.name,placement:"top",children:t.jsx(yxe,{children:o.name})}),"                ",t.jsx(vxe,{children:t.jsx(O,{icon:Kx})})]}),"            ",t.jsxs(jxe,{children:[t.jsxs(ca,{children:[t.jsx(aa,{children:t.jsx(O,{icon:Fw})})," ",t.jsx("span",{children:o.id})]}),t.jsxs(ca,{children:[t.jsx(aa,{children:t.jsx(O,{icon:ac})})," ",t.jsx("span",{children:o.address})]}),t.jsxs(ca,{children:[t.jsx(aa,{children:t.jsx(O,{icon:rc})})," ",t.jsx("span",{children:o.tel})]}),t.jsxs(ca,{className:"time-ago-item",children:[t.jsx(aa,{children:t.jsx(O,{icon:ic})})," ",t.jsx("span",{children:o.timeAgo})]})]})]})},xxe=l.div`
    padding: 0.75rem;
    border: 1px solid var(--color-border, #e8e8e8);
    border-radius: 6px;
    background-color: #ffffff;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0,0,0,0.02);

    &:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
`,bxe=l.div`
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--color-border, #f0f0f0);
`,yxe=l.div`
    color: var(--color-text-primary, #262626);
    font-size: 1rem;
    font-weight: 600;
    margin-right: 0.5rem;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    flex: 1; /* Toma todo el espacio disponible */
    position: relative;
    line-height: normal; /* Mantiene todo en una línea */
    
    &:hover::before {
        content: attr(data-tooltip);
        position: absolute;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.85rem;
        white-space: nowrap;
        z-index: 100;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
    }
`,vxe=l.span`
    color: var(--color-primary, #1890ff);
    opacity: 0.7;
    transition: opacity 0.2s ease;
    padding: 4px;

    &:hover {
        opacity: 1;
    }
`,jxe=l.div`
    display: grid;

    gap: 0.5rem;
`,aa=l.span`
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.4em;
    height: 1.4em;
    flex-shrink: 0;
`,ca=l.div`
    display: flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--color-text-secondary, #595959);
    font-size: 0.85rem;
    min-width: 0;
    overflow: hidden;

    span {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    svg {
        flex-shrink: 0;
        font-size: 0.9rem;
        color: var(--color-text-secondary, #8c8c8c);
    }
`,Cxe=({isOpen:e,onClose:n,business:s})=>{const o=W(),r=u=>{u.stopPropagation(),o(ri({isOpen:!0,businessID:s==null?void 0:s.id}))},i=u=>{u&&u.stopPropagation(),n()},{Title:a,Text:c,Paragraph:d}=Xe;return t.jsxs(Ce,{title:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx(O,{icon:bu,style:{color:"#1890ff",fontSize:"20px"}}),t.jsxs("span",{children:["Editar Negocio: ",s==null?void 0:s.name]})]}),open:e,onCancel:i,maskClosable:!0,keyboard:!0,width:600,footer:[t.jsx(U,{onClick:i,children:"Cerrar"},"close")],children:[t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx(a,{level:4,children:"Información del Negocio"}),t.jsx(d,{children:"Aquí podrás gestionar la información y configuraciones de este negocio."}),t.jsxs("div",{style:{background:"#f5f5f5",padding:"12px",borderRadius:"6px",marginBottom:"16px"},children:[t.jsx(c,{strong:!0,children:"ID:"})," ",t.jsx(c,{children:s==null?void 0:s.id}),t.jsx("br",{}),t.jsx(c,{strong:!0,children:"Dirección:"})," ",t.jsx(c,{children:(s==null?void 0:s.address)||"No especificada"}),t.jsx("br",{}),t.jsx(c,{strong:!0,children:"Teléfono:"})," ",t.jsx(c,{children:(s==null?void 0:s.tel)||"No especificado"})]})]}),t.jsx(gn,{}),t.jsxs("div",{children:["        ",t.jsxs(a,{level:4,style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(O,{icon:Ea})," Gestión de Usuarios"]}),t.jsx(d,{children:"Administra los usuarios que tienen acceso a este negocio. Puedes agregar nuevos usuarios asignándoles diferentes roles y permisos."}),t.jsx(Je,{style:{marginTop:"16px",backgroundColor:"#f0f7ff",borderColor:"#d6e8fd"},children:t.jsxs(Ye,{direction:"vertical",size:"middle",style:{width:"100%"},children:[t.jsx(c,{children:"Agrega un nuevo usuario a este negocio para darle acceso al sistema."}),"            ",t.jsx(U,{type:"primary",icon:t.jsx(O,{icon:Gx}),size:"large",block:!0,onClick:r,children:"Agregar Usuario"})]})})]})]})},la=l.div`
  margin-bottom: 8px;
  font-size: 14px;
  color: #595959;
  display: flex;
  align-items: center;
`,wxe=({visible:e,onClose:n,filters:s,handleFilterChange:o,resetFilters:r,availableProvinces:i,availableCountries:a,availableBusinessTypes:c,resultsCount:d})=>t.jsx(Rt,{title:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx(O,{icon:Or,style:{color:"#1890ff"}}),t.jsx("span",{children:"Filtros y Ordenamiento"})]}),placement:"right",onClose:n,open:e,width:360,footer:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(Xe.Text,{children:[d," ",d===1?"negocio encontrado":"negocios encontrados"]}),t.jsx(U,{onClick:r,children:"Limpiar Filtros"})]}),children:t.jsxs(Ye,{direction:"vertical",style:{width:"100%"},size:"large",children:[t.jsxs("div",{children:[t.jsxs(la,{children:[t.jsx(O,{icon:ac,style:{marginRight:"8px"}}),"Provincia"]}),t.jsx(ge,{style:{width:"100%"},placeholder:"Seleccionar provincia",value:s.province,onChange:u=>o("province",u),allowClear:!0,children:i.map(u=>t.jsx(ge.Option,{value:u,children:u},u))})]}),t.jsxs("div",{children:[t.jsxs(la,{children:[t.jsx(O,{icon:Bw,style:{marginRight:"8px"}}),"País"]}),t.jsx(ge,{style:{width:"100%"},placeholder:"Seleccionar país",value:s.country,onChange:u=>o("country",u),allowClear:!0,children:a.map(u=>t.jsx(ge.Option,{value:u,children:u==="do"?"República Dominicana":u==="co"?"Colombia":u==="us"?"Estados Unidos":u},u))})]}),t.jsxs("div",{children:[t.jsxs(la,{children:[t.jsx(O,{icon:wd,style:{marginRight:"8px"}}),"Tipo de Negocio"]}),t.jsx(ge,{style:{width:"100%"},placeholder:"Seleccionar tipo",value:s.businessType,onChange:u=>o("businessType",u),allowClear:!0,children:c.map(u=>t.jsx(ge.Option,{value:u,children:u==="general"?"General":u==="pharmacy"?"Farmacia":u==="restaurant"?"Restaurante":u},u))})]}),t.jsxs("div",{children:[t.jsxs(la,{children:[t.jsx(O,{icon:ic,style:{marginRight:"8px"}}),"Ordenar por Fecha de Creación"]}),t.jsxs(ge,{style:{width:"100%"},value:s.sortBy,onChange:u=>o("sortBy",u),children:[t.jsx(ge.Option,{value:"newest",children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(O,{icon:Lw}),t.jsx("span",{children:"Más recientes primero"})]})}),t.jsx(ge.Option,{value:"oldest",children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(O,{icon:zw}),t.jsx("span",{children:"Más antiguos primero"})]})})]})]})]})}),Sxe=()=>{const[e,n]=m.useState([]),[s,o]=m.useState(1),[r,i]=m.useState(""),[a,c]=m.useState(""),[d,u]=m.useState(!1),[p,h]=m.useState(null),[f,x]=m.useState(!1),[g,y]=m.useState(null),[b,v]=m.useState({province:"",country:"",businessType:"",hasRNC:!1,sortBy:"newest"}),[C,I]=m.useState(!1),[j,k]=m.useState([]),[A,P]=m.useState([]),[w,S]=m.useState([]),E=20;m.useEffect(()=>{(async()=>{x(!0),y(null);try{await c1(n)}catch(B){console.error("Error al cargar los negocios:",B),y("No se pudieron cargar los negocios. Por favor, intente de nuevo más tarde.")}finally{x(!1)}})()},[]),m.useEffect(()=>{if(e&&e.length){const K=[...new Set(e.map(L=>{var H;return(H=L.business)==null?void 0:H.province}).filter(Boolean))].sort();k(K);const B=[...new Set(e.map(L=>{var H;return(H=L.business)==null?void 0:H.country}).filter(Boolean))].sort();P(B);const _=[...new Set(e.map(L=>{var H;return(H=L.business)==null?void 0:H.businessType}).filter(Boolean))].sort();S(_)}},[e]),m.useEffect(()=>{const K=setTimeout(()=>{c(r)},300);return()=>{clearTimeout(K)}},[r]);const T=(K,B)=>{v(_=>({..._,[K]:B})),o(1)},R=()=>{v({province:"",country:"",businessType:"",hasRNC:!1,sortBy:"newest"})},N=()=>{I(!0)},G=()=>{I(!1)},Q=e.filter(K=>{const B=K.business,_=!a||B.name&&B.name.toLowerCase().includes(a.toLowerCase())||B.address&&B.address.toLowerCase().includes(a.toLowerCase())||B.tel&&B.tel.toLowerCase().includes(a.toLowerCase())||B.email&&B.email.toLowerCase().includes(a.toLowerCase())||B.rnc&&B.rnc.toLowerCase().includes(a.toLowerCase()),L=!b.province||B.province&&B.province===b.province,H=!b.country||B.country&&B.country===b.country,ne=!b.businessType||B.businessType&&B.businessType===b.businessType,pe=!b.hasRNC||B.rnc&&B.rnc.trim()!=="";return _&&L&&H&&ne&&pe}),ae=[...Q].sort((K,B)=>{var H,ne,pe,ye;const _=((ne=(H=K.business)==null?void 0:H.createdAt)==null?void 0:ne.seconds)||0,L=((ye=(pe=B.business)==null?void 0:pe.createdAt)==null?void 0:ye.seconds)||0;return b.sortBy==="newest"?L-_:_-L}),oe=s*E,Z=oe-E,J=ae.slice(Z,oe),X=Math.ceil(Q.length/E),me=()=>{s>1&&o(s-1)},fe=()=>{s<X&&o(s+1)},se=K=>{h(K),u(!0)},ee=()=>{u(!1),h(null)};return t.jsxs(Ixe,{children:[t.jsxs(Exe,{children:[t.jsx(Ze,{sectionName:"Gestionar Negocios"}),"        ",t.jsxs(Axe,{children:[t.jsx(kxe,{children:t.jsx(ie,{placeholder:"Buscar por nombre, dirección, teléfono...",value:r,onChange:K=>i(K.target.value),prefix:t.jsx(O,{icon:hu})})}),"          ",t.jsxs(U,{icon:t.jsx(O,{icon:Or}),onClick:N,type:C?"primary":"default",children:["Filtros ",b.province||b.country||b.businessType?`(${Q.length})`:""]})]}),t.jsx(wxe,{visible:C,onClose:G,filters:b,handleFilterChange:T,resetFilters:R,availableProvinces:j,availableCountries:A,availableBusinessTypes:w,resultsCount:Q.length})]}),"      ",t.jsx(Txe,{children:f?t.jsxs($xe,{children:[t.jsx(O,{icon:wd,spin:!0})," Cargando negocios..."]}):g?t.jsx(Rxe,{children:g}):J.length===0?t.jsx(Nxe,{children:a||b.province||b.country||b.businessType||b.hasRNC?t.jsxs(t.Fragment,{children:[t.jsx(O,{icon:Or,style:{fontSize:"2rem",marginBottom:"1rem",opacity:.5}}),t.jsx("p",{children:"No se encontraron negocios con los filtros aplicados."}),t.jsx(U,{onClick:R,children:"Limpiar filtros"})]}):t.jsxs(t.Fragment,{children:[t.jsx(O,{icon:wd,style:{fontSize:"2rem",marginBottom:"1rem",opacity:.5}}),t.jsx("p",{children:"No hay negocios registrados."})]})}):J.map(({business:K},B)=>t.jsx(fxe,{business:K,onEditBusiness:se},B))}),t.jsxs(Pxe,{children:[t.jsx(U,{shape:"circle",icon:t.jsx(O,{icon:Ux}),onClick:me,disabled:s===1}),t.jsxs(Dxe,{children:[s,"/",X]}),t.jsx(U,{shape:"circle",icon:t.jsx(O,{icon:Zs}),onClick:fe,disabled:s===X})]}),p&&t.jsx(Cxe,{isOpen:d,onClose:ee,business:p})]})},Ixe=l.div`
  display: grid;
  grid-template-rows: min-content 1fr min-content;
  height: 100vh;
  overflow: hidden;
`,Exe=l.div``;l.div`
  padding: 10px;
  width: 300px;
`;const Axe=l.div`
  display: flex;
  padding: 10px;
  gap: 10px;
  align-items: center;
`,kxe=l.div`
  width: 300px;
`;l.div`
  padding: 0 10px 10px 10px;
  background-color: #f9f9f9;
  border-bottom: 1px solid #e8e8e8;
`;l.div`
  margin-bottom: 8px;
  font-size: 14px;
  color: #595959;
  display: flex;
  align-items: center;
`;const Txe=l.div`
  display: grid;
  padding: 10px;
  gap: 10px;
  background-color: var(--color2);
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  align-content: start;
  overflow: auto;
`,Pxe=l.div`
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 10px;
  gap: 15px;
`,Dxe=l.div`
  font-size: 14px;
  font-weight: 500;
  color: #595959;
  min-width: 40px;
  text-align: center;
`,$xe=l.div`
  grid-column: 1 / -1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 1rem;
  color: #595959;
  gap: 1rem;
  font-size: 1rem;
`,Rxe=l.div`
  grid-column: 1 / -1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 1rem;
  color: #ff4d4f;
  text-align: center;
  font-size: 1rem;
`,Nxe=l.div`
  grid-column: 1 / -1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 1rem;
  color: #595959;
  text-align: center;
  
  p {
    margin-bottom: 1rem;
    font-size: 1rem;
  }
`;l.div``;l.div``;l.div``;function Oxe(){const e=["primary","error","warning","info","success"],n=s=>[`${s}`,`on-${s}`,`${s}-contained`,`on-${s}-contained`];return t.jsx(Bxe,{children:e.map((s,o)=>t.jsx("div",{children:n(s).map((r,i)=>t.jsx(Mxe,{color:r},i))}))})}const Mxe=({color:e="primary"})=>{if(!e||!Td.colors[e])return;const n=Td.colors[e]||[];return t.jsx(Fxe,{children:t.jsxs(Lxe,{color:n.text,bg:n.bg,children:[n.bg,t.jsx("br",{})]})})},Fxe=l.div`
  display: grid;


`,Bxe=l.div`
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  ${e=>`
      background-color: ${e.color};
    `}
`,Lxe=l.div`
 height: 8em;
  padding: 1em;
  ${e=>{const n=e.color;return`
      background-color: ${e.bg};
      color: ${n};

    `}}
`,zxe=()=>{const e=Fe(),n=[{title:"Imagen de Login",description:"Configurar la imagen que se muestra en la página de inicio de sesión",route:re.DEV_VIEW_TERM.APP_CONFIG.LOGIN_IMAGE}];return t.jsxs(Uxe,{children:[t.jsx(Ze,{sectionName:"Configuración de App",sectionNameIcon:t.jsx(o0,{}),showBackButton:!0,onBackClick:()=>e(-1)}),t.jsx(Wxe,{children:t.jsx(Sn,{grid:{gutter:16,xs:1,sm:1,md:2,lg:2,xl:3,xxl:3},dataSource:n,renderItem:s=>t.jsx(Sn.Item,{children:t.jsx(Xa,{to:s.route,children:t.jsx(qxe,{hoverable:!0,children:t.jsx(Je.Meta,{title:s.title,description:s.description})})})})})})]})},Uxe=l.div`
    min-height: 100vh;
`,Wxe=l.div`
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 1rem;
`,qxe=l(Je)`
    height: 100%;
    .ant-card-meta-title {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }
    .ant-card-meta-description {
        color: rgba(0, 0, 0, 0.45);
        line-height: 1.5;
    }
`,Ix=.4,Vxe=1024,Gxe=.1,_xe=.1,Hxe=()=>{const e=Fe(),[n,s]=m.useState([]),[o,r]=m.useState(null),[i,a]=m.useState(!0),[c,d]=m.useState(!1),[u,p]=m.useState(0),[h,f]=m.useState(null),[x,g]=m.useState(null),y=In(Ts,"app-config/login-image");m.useEffect(()=>{b()},[]);const b=async()=>{try{const A=await ua(y);if(A.items.length>0){const P=await Ss(A.items[0]);r(P)}}catch(A){console.error("Error fetching current image:",A),V.error("Error al cargar la imagen actual")}finally{a(!1)}},v=async A=>{const P={maxWidthOrHeight:Vxe,useWebWorker:!0,onProgress:E=>p(E)};let w=.8,S=A;for(;S.size/1024/1024>Ix&&w>=_xe;){const E={...P,maxSizeMB:Ix,initialQuality:w};S=await Ad(A,E),w-=Gxe}return S},C=A=>A.type.startsWith("image/")?(s([A]),!1):(V.error("Solo puedes subir imágenes"),Sd.LIST_IGNORE),I=async()=>{d(!0);try{const A=await ua(y);await Promise.all(A.items.map(P=>Po(P))),r(null),V.success("Imagen eliminada correctamente")}catch(A){console.error("Error deleting image:",A),V.error("Error al eliminar la imagen")}finally{d(!1)}},j=async()=>{if(n.length!==0){d(!0),p(0);try{const A=n[0],P=(A.size/1024).toFixed(1);f(P);const w=await v(A),S=(w.size/1024).toFixed(1);g(S);const E=await ua(y);await Promise.all(E.items.map(N=>Po(N)));const T=In(y,A.name);await Ox(T,w.size<A.size?w:A);const R=await Ss(T);r(R),s([]),V.success("Imagen actualizada correctamente")}catch(A){console.error("Error uploading image:",A),V.error("Error al subir la imagen")}finally{d(!1),p(0)}}},k=()=>i?t.jsx(He,{size:"large"}):o?t.jsxs(Xxe,{children:[t.jsx(Lo,{src:o,alt:"Login",preview:!1}),t.jsx(Zxe,{icon:t.jsx(ht,{}),onClick:I,disabled:c,children:c?t.jsx(He,{size:"small"}):"Eliminar"})]}):t.jsx(Lt,{description:"No hay imagen configurada"});return t.jsxs(Qxe,{children:[t.jsx(Ze,{sectionName:"Imagen de Login",showBackButton:!0,onBackClick:()=>e(-1)}),t.jsxs(Yxe,{children:[t.jsx(Kxe,{children:k()}),t.jsxs(Jxe,{children:[t.jsx(Sd,{beforeUpload:C,fileList:n,showUploadList:!1,maxCount:1,disabled:c,children:t.jsx(U,{icon:t.jsx(Ed,{}),size:"large",children:"Seleccionar Imagen"})}),n.length>0&&t.jsx(U,{type:"primary",onClick:j,disabled:c,size:"large",children:c?"Guardando...":"Guardar Cambios"})]}),c&&u>0&&t.jsxs(e0e,{children:[t.jsx(to,{percent:Math.round(u)}),h&&x&&t.jsxs(t0e,{children:[t.jsxs("p",{children:["Original: ",h," KB"]}),t.jsxs("p",{children:["Optimizado: ",x," KB"]}),t.jsxs("p",{children:["Reducción: ",((h-x)/h*100).toFixed(1),"%"]})]})]})]})]})},Qxe=l.div`min-height:100vh; background:#f0f2f5;`,Yxe=l.div`max-width:900px; margin:2rem auto; padding:0 1rem;`,Kxe=l.div`display:flex; justify-content:center; align-items:center; min-height:300px; background:#fff; border-radius:8px; margin-bottom:2rem; padding:1rem;`,Jxe=l.div`display:flex; gap:1rem; justify-content:center; margin-bottom:1rem;`,Xxe=l.div`position:relative; .ant-image img{max-height:300px; object-fit:contain;}`,Zxe=l(U)`position:absolute; bottom:1rem; right:1rem; background:rgba(0,0,0,0.6); color:#fff; border:none; &:hover{background:rgba(0,0,0,0.8);}`,e0e=l.div`max-width:600px; margin:0 auto 1rem;`,t0e=l.div`text-align:center; p{margin:4px 0;}`,n0e=({content:e,closeModal:n})=>t.jsx(s0e,{children:t.jsxs(o0e,{children:[e,t.jsx("button",{onClick:n,children:"Cerrar"})]})}),s0e=l.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
`,o0e=l.div`
  background-color: #fff;
  height: 100%;
    width: 100%;
  border-radius: 4px;
  box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.2);
`,r0e=({isOpen:e,onClose:n,options:s})=>{const[o,r]=m.useState(!1),[i,a]=m.useState(null),c=u=>{a(u),r(!0)},d=()=>{a(null),r(!1)};return e&&t.jsx(i0e,{children:t.jsxs(a0e,{children:[t.jsxs(l0e,{children:[t.jsx("h1",{children:"Configuraciones"}),t.jsx(ke,{title:z.operationModes.close,onClick:n})]}),s==null?void 0:s.map(u=>t.jsx(c0e,{onClick:()=>c(u),children:u.label},u.id)),o&&t.jsx(n0e,{content:i.component,closeModal:d})]})})},i0e=l.div`
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  z-index: 1000000000000000000;
  background-color: rgba(0, 0, 0, 0.5);

`,a0e=l.div`
  display: grid;
  height: 90vh;
  width: 100%;
  position: relative;
  max-width: 500px;
  border: var(--border-primary);
  background-color: white;
  align-content: start;
  margin: 0 auto;
`,c0e=l.button`
  background-color: #3498db;
  color: #fff;
  border: none;
  padding: 8px 16px;
  cursor: pointer;
`,l0e=l.div`
    display: flex;
    justify-content: space-between;
    align-items: center;
`,{Title:wr,Text:ze}=Xe,{Option:Ex}=ge,d0e=()=>{const[e,n]=m.useState(!1),[s,o]=m.useState([]),[r,i]=m.useState([]),[a,c]=m.useState([]),[d,u]=m.useState("todas"),[p,h]=m.useState(null),[f,x]=m.useState(!1),[g,y]=m.useState(!1),[b,v]=m.useState(!1),[C,I]=m.useState(0),j=D(q),k=async()=>{if(!(j!=null&&j.businessID)){console.error("No se encontró businessID");return}n(!0);try{const E=le($,"businesses",j.businessID,"invoices"),T=he(E,it("data.date","desc")),R=await Me(T),N=[],G=new Map,Q=new Map;R.forEach(oe=>{var me,fe,se,ee,K,B;const Z=oe.data(),J=(me=Z.data)==null?void 0:me.NCF,X=(fe=Z.data)==null?void 0:fe.date;if(J&&X){const _={id:oe.id,docId:oe.id,ncf:J,fecha:X.seconds?new Date(X.seconds*1e3):new Date(X),fechaFormateada:X.seconds?new Date(X.seconds*1e3).toLocaleDateString("es-DO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):new Date(X).toLocaleDateString("es-DO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),totalPurchase:((ee=(se=Z.data)==null?void 0:se.totalPurchase)==null?void 0:ee.value)||0,cliente:((B=(K=Z.data)==null?void 0:K.client)==null?void 0:B.name)||"N/A",isDuplicate:!1,duplicateCode:null,originalData:Z};if(G.has(J)){const L=G.get(J);_.isDuplicate=!0,_.duplicateCode=L;const H=N.find(ne=>ne.ncf===J);H&&!H.isDuplicate&&(H.isDuplicate=!0,H.duplicateCode=L),Q.has(L)?Q.get(L).push(_):Q.set(L,[H,_].filter(Boolean))}else{const L=be(7);G.set(J,L),_.duplicateCode=L}N.push(_)}});const ae=Array.from(Q.entries()).map(([oe,Z])=>{var J;return{codigo:oe,cantidad:Z.length,ncf:(J=Z[0])==null?void 0:J.ncf}});o(N),i(N),c(ae),console.log(`Facturas cargadas: ${N.length}`),console.log(`Grupos de duplicados encontrados: ${ae.length}`)}catch(E){console.error("Error cargando facturas:",E)}finally{n(!1)}},A=()=>{if(!s.length)return;const E=K=>{if(!K||K.length<3)return 0;const B=K.substring(3);return parseInt(B)||0},T=K=>!K||K.length<3?{serie:"B",tipo:"02"}:{serie:K.substring(0,1),tipo:K.substring(1,3)},R=(K,B,_)=>{const L=_.toString().padStart(8,"0");return`${K}${B}${L}`},N=(K,B)=>`${K}${B}`,G=[...s].sort((K,B)=>K.fecha-B.fecha),Q=new Map;G.forEach(K=>{const{serie:B,tipo:_}=T(K.ncf),L=N(B,_);Q.has(L)||Q.set(L,[]),Q.get(L).push(K)}),console.log("=== DEBUG NUEVA LÓGICA POR SERIE Y TIPO ==="),console.log("Grupos encontrados:",Array.from(Q.keys())),Q.forEach((K,B)=>{console.log(`${B}: ${K.length} facturas`)}),console.log("==========================================");const ae=[],oe=new Set;let Z=0,J=0,X=0;const me=new Map;Q.forEach((K,B)=>{const[_,L]=[B.substring(0,1),B.substring(1,3)],H=K[0],ne=E(H.ncf);let pe=ne;const ye={serie:_,tipo:L,clave:B,totalFacturas:K.length,secuenciaInicial:ne,facturasSinCambios:0,facturasConCambios:0,duplicados:0,inconsistencias:0};console.log(`=== Procesando grupo ${B} ===`),console.log(`Facturas: ${K.length}, Secuencia base: ${ne}`),K.forEach((Pe,Ue)=>{const ut=E(Pe.ncf),ve=Pe.ncf;let xe=!1,Ae=null,Re="";if(Ue===0){ae.push({...Pe,accion:"MANTENER_COMO_BASE_DEL_GRUPO",ncfOriginal:ve,ncfNuevo:ve,secuenciaOriginal:ut,secuenciaNueva:ut,secuenciaEsperada:pe,posicionCronologica:G.indexOf(Pe)+1,serieYTipo:B,esBaseDelGrupo:!0,necesitaCorreccion:!1,tipoProblema:null,razon:`NCF base del grupo ${B} - primer elemento cronológico`}),oe.add(ve),pe++,ye.facturasSinCambios++;return}const $e=R(_,L,pe);oe.has(ve)?(xe=!0,Ae="DUPLICADO",J++,Z++,ye.duplicados++,ye.facturasConCambios++,Re=`NCF duplicado en grupo ${B} - ya utilizado anteriormente`):ve!==$e?(xe=!0,Ae="SECUENCIA_INCORRECTA",X++,Z++,ye.inconsistencias++,ye.facturasConCambios++,ut<pe?Re=`Secuencia se "devuelve" en grupo ${B} - esperado #${pe}, encontrado #${ut}`:Re=`Secuencia salta en grupo ${B} - esperado #${pe}, encontrado #${ut}`):ye.facturasSinCambios++;let Le,Qt,Mn;xe?(Le=$e,Qt=pe,Mn=Ae==="DUPLICADO"?"CORREGIR_DUPLICADO":"CORREGIR_SECUENCIA"):(Le=ve,Qt=ut,pe=ut,Mn="SIN_CAMBIOS",Re=`NCF correcto en grupo ${B} - sigue secuencia lógica`),ae.push({...Pe,accion:Mn,ncfOriginal:ve,ncfNuevo:Le,secuenciaOriginal:ut,secuenciaNueva:Qt,secuenciaEsperada:pe,posicionCronologica:G.indexOf(Pe)+1,serieYTipo:B,necesitaCorreccion:xe,tipoProblema:Ae,razon:Re}),oe.add(Le),pe=Qt+1}),me.set(B,ye),console.log(`Grupo ${B} completado:`,ye)});const fe=ae.filter(K=>!K.necesitaCorreccion),se=ae.filter(K=>K.necesitaCorreccion);console.log("=== RESUMEN NUEVA LÓGICA POR SERIE Y TIPO ==="),console.log("Total facturas analizadas:",G.length),console.log("Grupos de serie+tipo encontrados:",Q.size),console.log("Facturas sin cambios:",fe.length),console.log("Facturas con cambios:",se.length),console.log("Total duplicados detectados:",J),console.log("Total inconsistencias de secuencia:",X),console.log("Total problemas:",Z),me.forEach((K,B)=>{console.log(`Grupo ${B}:`,K)}),console.log("============================================");const ee={resumen:{totalFacturasAnalizadas:s.length,gruposSerieYTipo:Array.from(me.values()),totalGrupos:Q.size,totalProblemas:Z,totalDuplicados:J,totalInconsistencias:X,facturasSinCambios:fe.length,facturasConCambios:se.length,estrategia:"CORRECCION_SECUENCIAL_POR_SERIE_Y_TIPO"},correcciones:[{descripcion:"Corrección secuencial independiente por cada serie y tipo",facturas:ae}],impacto:{facturasSinCambios:fe.length,facturasConNuevoNCF:se.length,gruposAfectados:Array.from(me.entries()).map(([K,B])=>({serieYTipo:K,totalFacturas:B.totalFacturas,sinCambios:B.facturasSinCambios,conCambios:B.facturasConCambios,duplicados:B.duplicados,inconsistencias:B.inconsistencias})),metodologia:`Secuencia independiente por serie+tipo - ${Q.size} grupos procesados, Sin cambios: ${fe.length}, Corregidas: ${se.length}`,fechaSimulacion:new Date().toLocaleDateString("es-DO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}};h(ee),x(!0)},P=async()=>{if(!p||!(j!=null&&j.businessID)){Be.error({message:"Error",description:"No hay correcciones para aplicar o no se encontró businessID"});return}Ce.confirm({title:"⚠️ ¿Aplicar Correcciones en Firestore?",content:t.jsxs("div",{children:[t.jsx("p",{children:t.jsx("strong",{children:"Esta acción modificará permanentemente los NCF en la base de datos."})}),t.jsx("br",{}),t.jsx("p",{children:t.jsx("strong",{children:"Resumen de cambios:"})}),t.jsxs("ul",{children:[t.jsxs("li",{children:["Facturas sin cambios: ",t.jsx("strong",{children:p.resumen.facturasSinCambios})]}),t.jsxs("li",{children:["Facturas a corregir: ",t.jsx("strong",{children:p.resumen.facturasConCambios})]}),t.jsxs("li",{children:["Total duplicados: ",t.jsx("strong",{children:p.resumen.totalDuplicados})]}),t.jsxs("li",{children:["Total inconsistencias: ",t.jsx("strong",{children:p.resumen.totalInconsistencias})]})]}),t.jsx("br",{}),t.jsx("p",{children:t.jsx("strong",{children:"⚠️ Esta acción no se puede deshacer."})})]}),okText:"Sí, Aplicar Correcciones",cancelText:"Cancelar",okType:"danger",width:500,onOk:()=>w()})},w=async()=>{v(!0),I(0);try{const E=dt($),T=p.correcciones[0].facturas.filter(Q=>Q.necesitaCorreccion);let R=0;const N=T.length;Be.info({message:"Iniciando Correcciones",description:`Aplicando correcciones a ${N} facturas...`,duration:3});const G=10;for(let Q=0;Q<T.length;Q+=G){const ae=T.slice(Q,Q+G),oe=dt($);for(const Z of ae){const J=F($,"businesses",j.businessID,"invoices",Z.docId);oe.update(J,{"data.NCF":Z.ncfNuevo}),R++,I(Math.round(R/N*100))}await oe.commit(),console.log(`Lote ${Math.ceil((Q+1)/G)} completado: ${ae.length} facturas actualizadas`)}Be.success({message:"✅ Correcciones Aplicadas Exitosamente",description:`Se han corregido ${N} facturas en Firestore. Los NCF han sido actualizados con la secuencia correcta.`,duration:6}),await k(),x(!1),h(null)}catch(E){console.error("Error aplicando correcciones:",E),Be.error({message:"Error al Aplicar Correcciones",description:`Ocurrió un error: ${E.message}. Algunas correcciones pueden no haberse aplicado.`,duration:8})}finally{v(!1),I(0)}},S=E=>{if(u(E),E==="todas")i(s);else{const T=s.filter(R=>R.duplicateCode===E);i(T)}};return t.jsxs("div",{className:"p-6",children:[t.jsx(Je,{children:t.jsxs(Ye,{direction:"vertical",size:"large",style:{width:"100%"},children:[t.jsxs("div",{children:[t.jsx(wr,{level:3,children:"Análisis de Facturas Duplicadas por NCF"}),t.jsx(ze,{type:"secondary",children:"Esta herramienta analiza todas las facturas y identifica aquellas con NCF duplicados. Cada grupo de duplicados recibe un código único de 7 caracteres."})]}),"          ",t.jsxs(Ye,{size:"middle",children:[t.jsx(U,{type:"primary",onClick:k,loading:e,size:"large",children:e?"Cargando...":"Cargar Facturas"}),a.length>0&&t.jsxs(t.Fragment,{children:["                ",t.jsx(U,{type:"default",icon:t.jsx(zo,{}),onClick:A,size:"large",children:"Ver Overview de Corrección Avanzada"}),t.jsx(U,{type:"default",icon:t.jsx(Is,{}),onClick:()=>y(!0),size:"large",children:"¿Qué detecta?"}),t.jsxs(ge,{style:{width:300},value:d,onChange:S,placeholder:"Filtrar por grupo de duplicados",size:"large",children:[t.jsxs(Ex,{value:"todas",children:["Todas las facturas (",s.length,")"]}),a.map(E=>t.jsxs(Ex,{value:E.codigo,children:[E.ncf," - ",E.cantidad," facturas (Código: ",E.codigo,")"]},E.codigo))]})]})]}),e&&t.jsxs("div",{style:{textAlign:"center",padding:"50px"},children:[t.jsx(He,{size:"large"}),t.jsx("div",{style:{marginTop:"20px"},children:t.jsx(ze,{children:"Analizando facturas..."})})]})]})}),p&&t.jsxs(Ye,{direction:"vertical",size:"large",style:{width:"100%"},children:["            ",t.jsx(Pt,{message:"Simulación de Corrección por Serie y Tipo",description:`Análisis con corrección secuencial independiente por cada serie y tipo de NCF. Se encontraron ${p.resumen.totalGrupos} grupos diferentes. Problemas detectados: ${p.resumen.totalProblemas} (${p.resumen.totalDuplicados} duplicados, ${p.resumen.totalInconsistencias} inconsistencias). Generado el ${p.impacto.fechaSimulacion}.`,type:"info",showIcon:!0}),t.jsxs(Je,{title:"� Resumen por Serie y Tipo",size:"small",children:[t.jsx("div",{style:{marginBottom:"16px"},children:t.jsx(ze,{strong:!0,children:"Grupos de Serie+Tipo encontrados:"})}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"12px"},children:p.resumen.gruposSerieYTipo.map(E=>t.jsxs("div",{style:{padding:"12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"#fafafa"},children:[t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx(Ge,{color:"blue",style:{fontSize:"12px",fontWeight:"bold"},children:E.clave}),t.jsxs(ze,{strong:!0,children:[" - ",E.totalFacturas," facturas"]})]}),t.jsxs("div",{style:{fontSize:"11px"},children:[t.jsx("div",{children:t.jsxs(ze,{type:"secondary",children:["Serie: ",E.serie," | Tipo: ",E.tipo]})}),t.jsx("div",{children:t.jsxs(ze,{type:"secondary",children:["Secuencia inicial: ",E.secuenciaInicial]})}),t.jsx("div",{style:{marginTop:"4px"},children:t.jsxs(ze,{style:{color:"#52c41a"},children:["✓ Sin cambios: ",E.facturasSinCambios]})}),t.jsx("div",{children:t.jsxs(ze,{style:{color:"#faad14"},children:["⚠ Con cambios: ",E.facturasConCambios]})}),E.duplicados>0&&t.jsx("div",{children:t.jsxs(ze,{style:{color:"#ff4d4f"},children:["🔄 Duplicados: ",E.duplicados]})}),E.inconsistencias>0&&t.jsx("div",{children:t.jsxs(ze,{style:{color:"#fa8c16"},children:["📊 Inconsistencias: ",E.inconsistencias]})})]})]},E.clave))})]}),t.jsxs(Je,{title:"📊 Resumen del Impacto General",size:"small",children:["              ",t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px"},children:[t.jsxs("div",{children:[t.jsx(ze,{type:"secondary",children:"Total de Facturas"}),t.jsx("div",{children:t.jsx(ze,{strong:!0,style:{fontSize:"18px"},children:p.resumen.totalFacturasAnalizadas})})]}),t.jsxs("div",{children:[t.jsx(ze,{type:"secondary",children:"Grupos Serie+Tipo"}),t.jsx("div",{children:t.jsx(ze,{strong:!0,style:{fontSize:"18px",color:"#1890ff"},children:p.resumen.totalGrupos})})]}),t.jsxs("div",{children:[t.jsx(ze,{type:"secondary",children:"Total Problemas"}),t.jsx("div",{children:t.jsx(ze,{strong:!0,style:{fontSize:"18px",color:"#ff4d4f"},children:p.resumen.totalProblemas})})]}),t.jsxs("div",{children:[t.jsx(ze,{type:"secondary",children:"Duplicados Detectados"}),t.jsx("div",{children:t.jsx(ze,{strong:!0,style:{fontSize:"18px",color:"#ff4d4f"},children:p.resumen.totalDuplicados})})]}),t.jsxs("div",{children:[t.jsx(ze,{type:"secondary",children:"Inconsistencias Secuencia"}),t.jsx("div",{children:t.jsx(ze,{strong:!0,style:{fontSize:"18px",color:"#fa8c16"},children:p.resumen.totalInconsistencias})})]}),t.jsxs("div",{children:[t.jsx(ze,{type:"secondary",children:"Facturas Sin Cambios"}),t.jsx("div",{children:t.jsx(ze,{strong:!0,style:{fontSize:"18px",color:"#52c41a"},children:p.resumen.facturasSinCambios})})]}),t.jsxs("div",{children:[t.jsx(ze,{type:"secondary",children:"Facturas Corregidas"}),t.jsx("div",{children:t.jsx(ze,{strong:!0,style:{fontSize:"18px",color:"#faad14"},children:p.resumen.facturasConCambios})})]}),t.jsxs("div",{children:[t.jsx(ze,{type:"secondary",children:"Estrategia Aplicada"}),t.jsx("div",{children:t.jsx(ze,{code:!0,style:{fontSize:"10px",color:"#722ed1"},children:p.resumen.estrategia})})]}),t.jsxs("div",{children:[t.jsx(ze,{type:"secondary",children:"Estrategia"}),t.jsx("div",{children:t.jsx(Ge,{color:"blue",style:{fontSize:"10px"},children:"SECUENCIAL ESTRICTA"})})]})]})]}),"            ",t.jsx(gn,{}),t.jsxs("div",{children:[t.jsx(wr,{level:4,children:"📋 Vista Completa de Todas las Facturas"}),t.jsx(Pt,{message:`Estrategia: ${p.resumen.estrategia}`,description:t.jsxs("div",{children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Metodología:"})," ",p.impacto.metodologia]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Grupos procesados:"})," ",p.resumen.totalGrupos," combinaciones de serie+tipo diferentes"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Lógica:"})," Cada grupo de serie+tipo mantiene su propia secuencia independiente - no se comparan entre grupos diferentes"]}),t.jsxs("div",{style:{marginTop:"8px"},children:[t.jsx("strong",{children:"Grupos encontrados:"}),p.resumen.gruposSerieYTipo.map((E,T)=>t.jsxs(Ge,{color:"blue",style:{marginLeft:"4px"},children:[E.clave," (",E.totalFacturas,")"]},T))]})]}),type:"info",style:{marginBottom:"16px"}}),p.correcciones.map((E,T)=>t.jsxs(Je,{size:"small",style:{marginBottom:"16px"},title:t.jsxs(Ye,{children:[t.jsx(ze,{strong:!0,children:"Todas las Facturas Clasificadas por Estado"}),t.jsxs(Ge,{color:"green",children:[E.facturas.filter(R=>!R.necesitaCorreccion).length," sin cambios"]}),t.jsxs(Ge,{color:"orange",children:[E.facturas.filter(R=>R.necesitaCorreccion).length," corregidas"]}),t.jsxs(Ge,{color:"red",children:[E.facturas.filter(R=>R.tipoProblema==="DUPLICADO").length," duplicados"]}),t.jsxs(Ge,{color:"purple",children:[E.facturas.filter(R=>R.tipoProblema==="SECUENCIA_INCORRECTA").length," secuencia"]}),t.jsxs(Ge,{color:"gray",children:[E.facturas.length," total"]})]}),children:[t.jsx(Gt,{size:"small",dataSource:E.facturas,rowKey:"docId",pagination:{pageSize:20,showSizeChanger:!0,showQuickJumper:!0,showTotal:(R,N)=>`${N[0]}-${N[1]} de ${R} facturas`},columns:[{title:"Estado",dataIndex:"accion",key:"estado",width:140,render:(R,N)=>{if(N.esBaseDelGrupo)return t.jsx(Ge,{color:"blue",children:"BASE GRUPO"});if(N.necesitaCorreccion){if(N.tipoProblema==="DUPLICADO")return t.jsx(Ge,{color:"red",children:"DUPLICADO"});if(N.tipoProblema==="SECUENCIA_INCORRECTA")return t.jsx(Ge,{color:"orange",children:"SECUENCIA INCORRECTA"})}else return t.jsx(Ge,{color:"green",children:"SIN CAMBIOS"});return t.jsx(Ge,{color:"gray",children:"DESCONOCIDO"})}},{title:"Orden Cronológico",key:"posicion",width:80,render:(R,N)=>t.jsxs(Ge,{color:"blue",style:{fontSize:"10px"},children:["#",N.posicionCronologica||"N/A"]})},{title:"Secuencia Esperada",dataIndex:"secuenciaEsperada",key:"secuenciaEsperada",width:100,render:(R,N)=>N.esBaseDelGrupo?t.jsxs(Ge,{color:"blue",style:{fontSize:"10px"},children:["BASE #",R]}):t.jsxs(Ge,{color:"purple",style:{fontSize:"10px"},children:["#",R]})},{title:"Fecha",dataIndex:"fechaFormateada",key:"fecha",width:120},{title:"Total",dataIndex:"totalPurchase",key:"total",width:80,render:R=>`$${(R==null?void 0:R.toFixed(2))||"0.00"}`},{title:"NCF Original",dataIndex:"ncfOriginal",key:"ncfOriginal",width:150,render:(R,N)=>{let G="#52c41a";return N.necesitaCorreccion&&(G="#ff4d4f"),t.jsx(ze,{code:!0,style:{fontSize:"11px",color:G},children:R})}},{title:"NCF Final",dataIndex:"ncfNuevo",key:"ncfNuevo",width:150,render:(R,N)=>{const G=N.ncfOriginal!==N.ncfNuevo;return t.jsxs(Ye,{direction:"vertical",size:0,children:[t.jsx(ze,{code:!0,style:{color:G?"#52c41a":"#1890ff",fontSize:"11px",fontWeight:G?"bold":"normal"},children:R}),G&&t.jsxs(ze,{type:"secondary",style:{fontSize:"10px"},children:["Nueva secuencia: #",N.secuenciaNueva]}),!G&&t.jsx(ze,{type:"secondary",style:{fontSize:"10px"},children:"Sin cambios"})]})}},{title:"Serie+Tipo",dataIndex:"serieYTipo",key:"serieYTipo",width:80,render:R=>t.jsx(Ge,{color:"cyan",style:{fontSize:"10px"},children:R})},{title:"Razón",dataIndex:"razon",key:"razon",width:250,render:(R,N)=>t.jsx(ze,{style:{fontSize:"11px"},children:R})}]}),"                "]},T)),t.jsx(gn,{}),t.jsx(Je,{title:"🚀 Aplicar Correcciones",size:"small",children:t.jsxs(Ye,{direction:"vertical",style:{width:"100%"},children:[b&&t.jsxs("div",{children:[t.jsx(ze,{strong:!0,children:"Aplicando correcciones en Firestore..."}),t.jsx(to,{percent:C,status:"active",format:E=>`${E}% completado`})]}),t.jsx(Pt,{message:"⚠️ Acción Permanente",description:t.jsxs("div",{children:[t.jsx("p",{children:"Esta operación modificará permanentemente los NCF en Firestore."}),t.jsxs("p",{children:[t.jsx("strong",{children:"Facturas a corregir:"})," ",p.resumen.facturasConCambios]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Facturas sin cambios:"})," ",p.resumen.facturasSinCambios]})]}),type:"warning",showIcon:!0}),t.jsxs(Ye,{children:[t.jsx(U,{type:"primary",danger:!0,size:"large",loading:b,disabled:p.resumen.facturasConCambios===0,onClick:P,icon:t.jsx(Is,{}),children:b?"Aplicando...":"Aplicar Correcciones en Firestore"}),t.jsx(U,{size:"large",onClick:()=>h(null),disabled:b,children:"Cancelar"})]})]})})]})]}),t.jsx(Ce,{title:"🔧 Corrección Avanzada de NCF - ¿Qué detecta y corrige?",open:g,onCancel:()=>y(!1),footer:[t.jsx(U,{type:"primary",onClick:()=>y(!1),children:"Entendido"},"ok")],width:700,children:t.jsxs("div",{style:{lineHeight:1.6},children:[t.jsx(Pt,{message:"Sistema Mejorado de Detección",description:"Ahora detecta y corrige TODOS los problemas de NCF, no solo duplicados.",type:"success",showIcon:!0,style:{marginBottom:"16px"}}),t.jsx(wr,{level:5,children:"🔍 Problemas que detecta:"}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx(Ge,{color:"red",children:"DUPLICADOS"}),t.jsx(ze,{children:" - NCF exactamente iguales (ej: dos facturas con B0200000050)"})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx(Ge,{color:"orange",children:"INCONSISTENCIAS CRONOLÓGICAS"}),t.jsx(ze,{children:" - NCF con secuencia menor que NCF anteriores"})]}),t.jsx(wr,{level:5,children:"📝 Ejemplo del problema que resuelve:"}),t.jsxs("div",{style:{backgroundColor:"#f5f5f5",padding:"12px",borderRadius:"6px",marginBottom:"16px"},children:[t.jsx(ze,{code:!0,children:"25 Feb 2025 - 1:17 PM → B0200000096"}),t.jsx("br",{}),t.jsx(ze,{code:!0,style:{color:"#ff4d4f"},children:"25 Feb 2025 - 2:29 PM → B0100000001 ❌"}),t.jsx("br",{}),t.jsx(ze,{type:"secondary",children:"Problema: La secuencia 1 es menor que 96, rompe orden cronológico"})]}),t.jsx(wr,{level:5,children:"🛠️ Cómo lo corrige:"}),t.jsxs("div",{style:{backgroundColor:"#f6ffed",padding:"12px",borderRadius:"6px",marginBottom:"16px"},children:[t.jsx(ze,{children:"1. Identifica el primer problema cronológicamente"}),t.jsx("br",{}),t.jsx(ze,{children:"2. Toma como referencia el NCF anterior más alto"}),t.jsx("br",{}),t.jsx(ze,{children:"3. Reasigna secuencialmente desde esa base:"}),t.jsx("br",{}),t.jsxs("div",{style:{marginLeft:"16px",marginTop:"8px"},children:[t.jsx(ze,{code:!0,style:{color:"#52c41a"},children:"B0200000096 → Sin cambios"}),t.jsx("br",{}),t.jsx(ze,{code:!0,style:{color:"#1890ff"},children:"B0100000001 → B0200000097 ✅"}),t.jsx("br",{}),t.jsx(ze,{code:!0,style:{color:"#1890ff"},children:"Siguiente factura → B0200000098 ✅"})]})]}),t.jsx(Pt,{message:"Resultado",description:"Secuencia cronológicamente correcta sin duplicados ni inconsistencias.",type:"info",showIcon:!0})]})})]})},{CREATE_BUSINESS:u0e,BUSINESSES:p0e,CHANGELOG_CREATE:m0e,CHANGELOG_MANAGE:ewe,ALL_USERS:h0e,APP_CONFIG:Ax}=re.DEV_VIEW_TERM,g0e=[{path:p0e,element:t.jsx(Sxe,{})},{path:u0e,element:t.jsx(d1,{})},{path:"/doc",element:t.jsx(Oxe,{})},{path:"/menu",element:t.jsx(r0e,{})},{path:"/prueba",element:t.jsx(d0e,{})},{path:h0e,element:t.jsx(ixe,{})},{path:m0e,element:t.jsx(gxe,{})},{path:Ax.ROOT,element:t.jsx(zxe,{})},{path:Ax.LOGIN_IMAGE,element:t.jsx(Hxe,{})}],f0e=()=>{const[e,n]=m.useState([]),[s,o]=m.useState("");return m.useEffect(()=>{try{const r=le($,"changelogs"),i=Te(r,a=>{const c=a.docs.map(d=>{var h;const u=d.data(),p=new Date(((h=u==null?void 0:u.changelog)==null?void 0:h.createdAt.seconds)*1e3);return{...u,changelog:{...u.changelog,createdAt:p}}});n(c)});return()=>i()}catch(r){o(r)}},[]),{changelogs:e,error:s}},x0e=e=>{try{const n=typeof e=="string"?JSON.parse(e):e,s=mn.convertFromRaw(n);return mn.EditorState.createWithContent(s)}catch(n){return console.error("Failed to convert raw content to EditorState:",n),mn.EditorState.createEmpty()}},b0e=()=>{const{changelogs:e}=f0e();return t.jsxs(m.Fragment,{children:[t.jsx(Ze,{}),t.jsx(y0e,{children:t.jsxs(v0e,{children:[t.jsx("h1",{children:"Ventamax — Notas del lanzamiento"}),t.jsx("br",{}),e.sort((n,s)=>{var o,r;return new Date((o=s==null?void 0:s.changelog)==null?void 0:o.createdAt)-new Date((r=n==null?void 0:n.changelog)==null?void 0:r.createdAt)}).map(({changelog:n},s)=>t.jsx(j0e,{children:t.jsx(mn.Editor,{editorState:x0e(n.content)},s)}))]})})]})},y0e=l.div`
    width: 100%;
    height: calc(100vh - 2.75em);

`,v0e=l.div`
    padding: 1em;
    max-width: 900px;
    width: 100%;
    overflow: auto;
    margin: 0 auto;
    h1{
        margin-left: 0;
    }
    h2{
        margin-left: 0;
    }
`,j0e=l.div`
    margin-bottom: 6em;
    :last-child{
        margin-bottom: 0;
    }
`,C0e=()=>t.jsx("div",{children:"ChangelogManage"}),{CHANGELOG_LIST:w0e,CHANGELOG_MANAGE:S0e}=re.CHANGELOG_TERM,I0e=[{path:w0e,element:t.jsx(b0e,{})},{},{path:S0e,element:t.jsx(C0e,{})}];pt.register(Et,It,Xr,Zr,ei,At,ti);const E0e=({invoices:e})=>{const n=m.useRef(null);m.useEffect(()=>()=>{n.current&&n.current.destroy()},[]);const s=e.reduce((c,d)=>{const u=ce.fromMillis(d.data.date.seconds*1e3).toFormat("dd/MM/yyyy");return c[u]=(c[u]||0)+d.data.totalPurchase.value,c},{}),r=Object.values(s).reduce((c,d)=>c+d,0)/Object.keys(s).length,i={labels:Object.keys(s),datasets:[{label:"Ventas por Día",data:Object.values(s),borderColor:"blue",borderWidth:2,fill:!1,backgroundColor:"rgba(0, 0, 255, 0.2)"},{type:"line",label:"Promedio",data:Array(Object.keys(s).length).fill(r),borderColor:"red",borderDash:[5,5],fill:!1}]},a={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{x:{title:{display:!0,text:"Fecha"}},y:{title:{display:!0,text:"Ventas ($)"}}},plugins:{tooltip:{callbacks:{label:function(c){let d=c.dataset.label||"";return d&&(d+=" "+Y(c.parsed.y)),d}}}}};return t.jsxs(A0e,{children:[t.jsx(Qe,{variant:"h3",children:"Ventas por Día"}),t.jsx(Jr,{ref:n,data:i,options:a})]})},A0e=l.div`
 height: 200px;
 width: 100%;
 display: grid;
 gap: 1em;
`;pt.register(Et,It,Xr,Zr,ei,At,ti);const k0e=({invoices:e})=>{const n=m.useRef(null);m.useEffect(()=>()=>{n.current&&n.current.destroy()},[]);const s=e.reduce((c,d)=>{const u=ce.fromMillis(d.data.date.seconds*1e3).toFormat("WW/yyyy");return c[u]=(c[u]||0)+d.data.totalPurchase.value,c},{}),r=Object.values(s).reduce((c,d)=>c+d,0)/Object.keys(s).length,i={labels:Object.keys(s),datasets:[{label:"Ventas por Semana",data:Object.values(s),borderColor:"blue",borderWidth:2,fill:!1,tension:.4,backgroundColor:"rgba(0, 0, 255, 0.2)"},{type:"line",label:"Promedio",data:Array(Object.keys(s).length).fill(r),borderColor:"red",borderDash:[5,5],fill:!1}]},a={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{x:{title:{display:!0,text:"Semana del Año"}},y:{title:{display:!0,text:"Ventas ($)"}}},plugins:{tooltip:{callbacks:{label:function(c){let d=c.dataset.label||"";return d&&(d+=": "+Y(c.parsed.y)),d}}}}};return t.jsxs(T0e,{children:[t.jsx(Qe,{variant:"h3",children:"Ventas por Semana"}),t.jsx(Jr,{ref:n,data:i,options:a})]})},T0e=l.div`
 height: 200px;
 width: 100%;
 display: grid;
 gap: 1em;
`;pt.register(Et,It,Xr,Zr,ei,At,ti);const P0e=({invoices:e})=>{const n=m.useRef(null);m.useEffect(()=>()=>{n.current&&n.current.destroy()},[]);const s=e.reduce((c,d)=>{const u=ce.fromMillis(d.data.date.seconds*1e3),h=`${u.day<=15?"1ra Quincena":"2da Quincena"}/${u.toFormat("MM/yyyy")}`;return c[h]=(c[h]||0)+d.data.totalPurchase.value,c},{}),r=Object.values(s).reduce((c,d)=>c+d,0)/Object.keys(s).length,i={labels:Object.keys(s),datasets:[{label:"Ventas por Quincena",data:Object.values(s),borderColor:"blue",borderWidth:2,fill:!1,tension:.4,backgroundColor:"rgba(0, 0, 255, 0.2)"},{type:"line",label:"Promedio",data:Array(Object.keys(s).length).fill(r),borderColor:"red",borderDash:[5,5],fill:!1}]},a={responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Quincena del Año"}},y:{title:{display:!0,text:"Ventas ($)"}}},interaction:{mode:"index",intersect:!1},plugins:{tooltip:{callbacks:{label:function(c){let d=c.dataset.label||"";return d&&(d+=": "+Y(c.parsed.y)),d}}}}};return t.jsxs(D0e,{children:[t.jsx(Qe,{variant:"h3",children:"Ventas por Quincena"}),t.jsx(Jr,{ref:n,data:i,options:a})]})},D0e=l.div`
 height: 200px;
 width: 100%;
 display: grid;
 gap: 1em;
`,$0e=({totalSales:e})=>{const n={labels:["Total de Ventas"],datasets:[{label:"Ventas Totales",data:[e],backgroundColor:"#4BC0C0",borderColor:"#4BC0C0",borderWidth:1}]},s={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Ventas ($)"}},x:{title:{display:!0,text:"Resumen"}}},plugins:{tooltip:{callbacks:{label:function(o){let r=o.dataset.label||"";return r&&(r+=" "+Y(o.parsed.y)),r}}}}};return t.jsx(R0e,{children:t.jsx(jt,{data:n,options:s})})},R0e=l.div`
  height: 200px;
  display: grid;
  gap: 1em;
`;pt.register(Et,It,Xr,Zr,ei,At,ti);const N0e=({invoices:e})=>{const n=m.useRef(null);m.useEffect(()=>()=>{n.current&&n.current.destroy()},[]);const s=e.reduce((i,a)=>{const c=ce.fromMillis(a.data.date.seconds*1e3).toFormat("MM/yyyy");return i[c]=(i[c]||0)+a.data.totalPurchase.value,i},{}),o={labels:Object.keys(s),datasets:[{label:"Ventas por Mes",data:Object.values(s),borderColor:"#4BC0C0",backgroundColor:"blue",borderWidth:2,fill:!1}]},r={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{x:{title:{display:!0,text:"Fecha"}},y:{title:{display:!0,text:"Ventas ($)"}}},plugins:{tooltip:{callbacks:{label:function(i){let a=i.dataset.label||"";return a&&(a+=" "+Y(i.parsed.y)),a}}}}};return t.jsxs(O0e,{children:["            ",t.jsx(Jr,{ref:n,data:o,options:r})]})},O0e=l.div`
  height: 200px;
  display: grid;
  gap: 1em;
`,M0e=({invoices:e})=>{const n=e.reduce((s,o)=>s+o.data.totalPurchase.value,0);return t.jsxs(F0e,{children:[t.jsx(Qe,{variant:"h3",children:"Tendencia de Ventas Mensuales y Resumen Total"}),t.jsxs(B0e,{children:[t.jsx($0e,{totalSales:n}),t.jsx(N0e,{invoices:e})]})]})},F0e=l.div`
    height: 200px;
    display: grid;
`,B0e=l.div`
  display: grid;
  grid-template-columns: 200px 1fr;

  gap: 1em;
`,L0e=e=>{const n={};return e.forEach(s=>{const r=ce.fromMillis(s.data.date.seconds*1e3).toFormat("yyyy-MM");n[r]=(n[r]||0)+s.data.totalPurchase.value}),n},z0e=e=>{const n={};return e.forEach(s=>{const r=ce.fromMillis(s.expense.dates.expenseDate).toFormat("yyyy-MM");n[r]=(n[r]||0)+s.expense.amount}),n};pt.register(Et,It,Xr,Zr,ei,At,ti);const U0e=({expenses:e,invoices:n})=>{const s=m.useRef(null);m.useEffect(()=>()=>{s.current&&s.current.destroy()},[]);const o=L0e(n),r=z0e(e),i=[...new Set([...Object.keys(o),...Object.keys(r)])].sort(),a=i.map(p=>o[p]||0),c=i.map(p=>r[p]||0),d={labels:i,datasets:[{label:"Ventas",data:a,borderColor:"rgb(75, 192, 192)",fill:!0,backgroundColor:"blue",tension:.1},{label:"Gastos",data:c,borderColor:"rgb(255, 99, 132)",fill:!0,backgroundColor:"red",tension:.1}]},u={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Ventas ($)"}},x:{title:{display:!0,text:"Meses"}}},plugins:{legend:{position:"top"},tooltip:{callbacks:{label:function(p){let h=p.dataset.label||"";return h&&(h+=" "+Y(p.parsed.y)),h}}}}};return t.jsxs(W0e,{children:[t.jsx(Qe,{variant:"h3",children:"Finanzas Mensuales: Ventas, Gastos, Utilidad"}),t.jsx(Jr,{ref:s,data:d,options:u})]})},W0e=l.div`
 height: 200px;
 width: 100%;
 display: grid;
 gap: 1em;
`,q0e=({isOpen:e=!0})=>{const[n,s]=m.useState(Ct("thisMonth")),{expenses:o}=wv(n),{invoices:r}=Uv(n),i={open:{opacity:1,y:0},close:{opacity:0,y:"100vh"}};return t.jsxs(V0e,{children:[t.jsx(Ze,{sectionName:"Utilidad"}),t.jsxs(G0e,{variants:i,initial:"close",animate:e?"open":"close",transition:{duration:.5},exit:"close",children:[t.jsx(H0e,{children:t.jsx(Qe,{variant:"h2",children:"Utilidad"})}),t.jsx(_0e,{children:t.jsx(vc,{dates:n,setDates:s,dateOptionsMenu:!0,datesDefault:"thisMonth"})}),t.jsxs(Q0e,{children:[t.jsx(E0e,{invoices:r}),t.jsx(k0e,{invoices:r}),t.jsx(P0e,{invoices:r}),t.jsx(M0e,{invoices:r}),t.jsx(U0e,{expenses:o,invoices:r})]})]})]})},V0e=l.div`
height: 100vh;
    display: grid;
    overflow: hidden;
    grid-template-rows: min-content 1fr;
`;l.div`
  
`;const G0e=l(Ie.div)`
  width: 98vw;
  display: grid;
  grid-template-rows: min-content 1fr;
  gap: 1em;
  margin: 0 auto;
  height: 100%;
  background-color: #ffffff;
  border: 1px solid #1d1d1d37;
  border-radius: 0.5em;
  overflow-y: scroll;
  padding: 0 1em;
 
  `,_0e=l.div`
    position: sticky;
    top: 0;
    padding: 0.5em 0;
    background-color: white;
    border-bottom: 1px solid #1d1d1d37;
`,H0e=l.div`
  display: grid;
  align-items: center;
  position: sticky;
  top: 0;
  padding: 1em 1em 0 ;
  background: white;
  gap: 1em;
  `,Q0e=l.div`
    display: grid;
    align-content: start;   
    gap: 4em;
  `,{UTILITY:twe,UTILITY_REPORT:Y0e}=re.UTILITY_TERM,K0e=[{path:Y0e,element:t.jsx(q0e,{})}];async function J0e(e,n){if(!(e!=null&&e.businessID))throw new Error("User business ID is missing");const s=F($,`businesses/${e.businessID}/accountsReceivable`,n),o=await Se(s);if(!o.exists())throw new Error("Account Receivable not found");const r=o.data(),i=async(p,h,f)=>{const x=le($,`businesses/${e.businessID}/${p}`),g=he(x,te(h,"==",f));return(await Me(g)).docs.map(b=>b.data())},a=await i("accountsReceivableInstallments","arId",n),c=await i("accountsReceivableInstallmentPayments","arId",n),d=c.map(p=>p.paymentId),u=await Promise.all(d.map(p=>i("accountsReceivablePayments","paymentId",p))).then(p=>p.flat());return{ar:r,installments:a,installmentPayments:c,payments:u}}const X0e=({items:e=[]})=>t.jsx(Z0e,{children:e.map((n,s)=>t.jsxs(ebe,{children:[t.jsx(tbe,{children:n==null?void 0:n.label}),t.jsx(nbe,{children:n==null?void 0:n.value})]},s))}),Z0e=l.div`
   
      max-width: 500px;
      border-radius: 8px;
    padding:1.2em;
    background-color: white;

  `,ebe=l.div`
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  :not(:last-child){
        border-bottom: 1px solid #d7d7db;
      }

`,tbe=l.span`
  font-weight: 600;
  color: #333;
`,nbe=l.span`
  color: #555;
`,sbe=()=>{const{id:e}=so(),n=D(q),{data:s,isLoading:o,error:r,refetch:i}=Uo({queryKey:["accountReceivable",e],queryFn:()=>J0e(n,e),enabled:!!(n!=null&&n.businessID)&&!!e});if(m.useEffect(()=>{n&&e&&i()},[n,e,i]),o)return t.jsx("div",{children:"Loading..."});if(r)return t.jsxs("div",{children:["Error: ",r.message," "]});if(!s)return t.jsx("div",{children:"No data available"});const{ar:a,installments:c,payments:d,installmentPayments:u}=s,p=f=>ce.fromMillis((f==null?void 0:f.seconds)*1e3).toFormat("dd/MM/yyyy HH:mm"),h=[{label:"Nombre del Cliente:",value:a.clientId},{label:"Número de Cuenta:",value:a.numberId},{label:"Fecha de Creación:",value:p(a.createdAt)},{label:"Estado de la Cuenta:",value:a.isClosed?"Cerrada":"Abierta"},{label:"Monto Total:",value:Y(a.totalReceivable)},{label:"Ultimo Monto Pagado:",value:Y(a.lastPayment)},{label:"Monto Pendiente:",value:Y(a.currentBalance)},{label:"Fecha de Vencimiento:",value:p(a.paymentDate)}];return t.jsxs(obe,{children:[t.jsxs(rbe,{children:[t.jsx(cbe,{children:"← Back"}),t.jsx(abe,{children:"Detalles de Cuenta por Cobrar"})]}),t.jsxs(ibe,{children:[t.jsxs(pbe,{children:[t.jsx(X0e,{items:h}),t.jsxs(dbe,{children:[t.jsx(Qe,{variant:"h3",children:"Acciones Disponibles"}),t.jsxs(ube,{children:[t.jsx(gd,{children:"Registrar Pago"}),t.jsx(gd,{disabled:!0,children:"Editar Cuenta"}),t.jsx(gd,{disabled:!0,children:"Generar Reporte"})]})]})]}),t.jsxs("div",{children:[t.jsx(da,{children:"Detalles de Cuotas"}),t.jsxs(hd,{children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx(cn,{children:"Número de Cuota"}),t.jsx(cn,{children:"Monto de la Cuota"}),t.jsx(cn,{children:"Fecha de Vencimiento"}),t.jsx(cn,{children:"Estado de la Cuota"})]})}),t.jsx("tbody",{children:s.installments.sort((f,x)=>f.installmentDate.seconds-x.installmentDate.seconds).map((f,x)=>t.jsxs("tr",{children:[t.jsx(ln,{children:x+1}),t.jsx(ln,{children:Y(f.installmentAmount)}),t.jsx(ln,{children:p(f.installmentDate)}),t.jsx(ln,{children:f.isActive?"Pendiente":"Pagada"})]},f.id))})]})]}),t.jsxs("div",{children:[t.jsx(da,{children:"Historial de Pagos"}),t.jsxs(hd,{children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx(cn,{children:"Fecha de Pago"}),t.jsx(cn,{children:"Monto Pagado"}),t.jsx(cn,{children:"Estado del Pago"})]})}),t.jsx("tbody",{children:s.installmentPayments.sort((f,x)=>f.createdAt.seconds-x.createdAt.seconds).map(f=>t.jsxs("tr",{children:[t.jsx(ln,{children:p(f.createdAt)}),t.jsxs(ln,{children:["$",f.paymentAmount]}),t.jsx(ln,{children:f.isActive?"Confirmado":"Pendiente"})]},f.id))})]})]}),t.jsxs("div",{children:[t.jsx(da,{children:"Pagos"}),t.jsxs(hd,{children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx(cn,{children:"Fecha de Pago"}),t.jsx(cn,{children:"Monto Total Pagado"}),t.jsx(cn,{children:"Método de Pago"}),t.jsx(cn,{children:"Estado del Pago"})]})}),t.jsx("tbody",{children:d.sort((f,x)=>f.createdAt.seconds-x.createdAt.seconds).map(f=>{var x;return t.jsxs("tr",{children:[t.jsx(ln,{children:p(f.createdAt)}),t.jsxs(ln,{children:["$",f.totalPaid]}),t.jsx(ln,{children:((x=f.paymentMethods.find(g=>g.status))==null?void 0:x.method)||"N/A"}),t.jsx(ln,{children:f.isActive?"Confirmado":"Pendiente"})]},f.id)})})]})]}),t.jsx(da,{children:"Comentarios y Notas"}),t.jsx(lbe,{children:t.jsx("textarea",{rows:"4",cols:"50"})})]})]})},obe=l.div`
  padding: 20px;
  font-family: Arial, sans-serif;
  background-color: var(--color2);
`,rbe=l.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
`,ibe=l.div`
    

`,abe=l.h1`
  font-size: 24px;
  color: #006fee;
`,cbe=l.button`
  background: none;
  border: none;
  color: #006fee;
  cursor: pointer;
`,lbe=l.div`
  margin-bottom: 20px;
`,hd=l.table`
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
  background-color: white;
`,cn=l.th`
  border: 1px solid #d7d7db;
  padding: 10px;
  background-color: #f5f5f5;
`,ln=l.td`
  border: 1px solid #d7d7db;
  padding: 10px;
  text-align: center;
`,gd=l.button`
  background-color: #006fee;
  color: white;
  padding: 0.4em 20px;
  border: none;
  cursor: pointer;

  &:hover {
    background-color: #005bb5;
  }
  ${e=>e.disabled&&`
    background-color: #929292;
    cursor: not-allowed;
    :hover{
        background-color: #929292;
        }
    `}
`,dbe=l.div`
    padding: 1em;
    background-color: #f9f9f9;
    border: 1px solid #d7d7db;
    display: grid;
    align-items: start;
   

`,ube=l.div`
display: grid;
gap: 0.4em;
`,pbe=l.div`
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
`;l.div`
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
`;const da=l.h2`
    margin-top: 20px;
    font-size: 1em;
`,E1=()=>{var s,o,r,i;const e=D(ft),n=(e==null?void 0:e.businessType)||"";return{data:e,businessType:n,businessName:(e==null?void 0:e.name)||"",isPharmacy:n==="pharmacy",hasInsurance:!!((s=e==null?void 0:e.features)!=null&&s.insurance),hasInventory:!!((o=e==null?void 0:e.features)!=null&&o.inventory),hasMultipleWarehouses:!!((r=e==null?void 0:e.features)!=null&&r.multipleWarehouses),hasDelivery:!!((i=e==null?void 0:e.features)!=null&&i.delivery),isBusinessType:a=>n===a}},mbe=({value:e})=>{const n=W(),s=()=>{n(Uy({isOpen:!0,arId:e.account.id}))};return t.jsx(U,{icon:t.jsx(zo,{}),onClick:s})},hbe=({value:e})=>{const n=W(),s=()=>{const o=e.account,i={isOpen:!0,paymentDetails:{clientId:e.account.client.id,arId:o.id,paymentScope:"account",totalAmount:o.balance},extra:{...o==null?void 0:o.account}};n($c(i))};return t.jsx(U,{icon:t.jsx(Da,{}),onClick:s})},gbe=e=>{const n=[{Header:"Cliente",accessor:"client",sortable:!0,align:"left",maxWidth:"1.8fr",minWidth:"200px",fixed:"left"},{Header:"Cédula/RNC",accessor:"rnc",sortable:!0,align:"left",maxWidth:"1.2fr",minWidth:"130px"},{Header:"Factura",accessor:"invoiceNumber",sortable:!0,align:"left",maxWidth:"1fr",minWidth:"120px"},{Header:"Fecha",accessor:"date",sortable:!0,align:"left",cell:({value:s})=>{const o=s.seconds*1e3;return Od(o,0)},maxWidth:"1fr",minWidth:"160px"},{Header:"Monto inicial",accessor:"initialAmount",align:"right",cell:({value:s})=>Y(s),maxWidth:"1fr",minWidth:"120px"},{Header:"Último pago",accessor:"lastPaymentDate",align:"left",cell:({value:s})=>s?Od(s.seconds*1e3,0):"Sin pagos",maxWidth:"1fr",minWidth:"160px"},{Header:"Total pagado",accessor:"totalPaid",align:"right",cell:({value:s})=>Y(s),maxWidth:"1fr",minWidth:"120px"},{Header:"Balance",accessor:"balance",align:"right",cell:({value:s})=>Y(s),maxWidth:"1fr",minWidth:"120px"},{Header:"Acciones",align:"center",accessor:"actions",maxWidth:"1fr",minWidth:"120px",fixed:"right",cell:({value:s})=>t.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"center"},children:[t.jsx(mbe,{value:s}),t.jsx(hbe,{value:s})]})}];return e&&n.splice(2,0,{Header:"Aseguradora",accessor:"insurance",sortable:!0,align:"left",maxWidth:"1.5fr",minWidth:"180px",cell:({value:s})=>s||"N/A"}),n},fbe=({data:e=[],searchTerm:n="",totalBalance:s,showInsuranceColumn:o})=>{const{isPharmacy:r}=E1(),i=o!==void 0?o:r;return t.jsx(rn,{columns:gbe(i),data:e,tableName:"accountsReceivable-list",elementName:"cuentas",searchTerm:n,footerLeftSide:`Total: ${s}`,emptyText:"No hay cuentas por cobrar para mostrar"})},lu=(e,n,s)=>{const o=[...e];switch(n){case"defaultCriteria":return o;case"date":o.sort((r,i)=>{var d,u;const a=((d=r.date)==null?void 0:d.seconds)||0,c=((u=i.date)==null?void 0:u.seconds)||0;return s==="asc"?a-c:c-a});break;case"invoiceNumber":o.sort((r,i)=>{const a=Number(r.invoiceNumber.replace(/\D/g,""))||0,c=Number(i.invoiceNumber.replace(/\D/g,""))||0;return s==="asc"?a-c:c-a});break;case"client":o.sort((r,i)=>{var d,u;const a=((d=r.client)==null?void 0:d.toUpperCase())||"",c=((u=i.client)==null?void 0:u.toUpperCase())||"";return s==="asc"?a.localeCompare(c):c.localeCompare(a)});break;case"insurance":o.sort((r,i)=>{var d,u;const a=((d=r.insurance)==null?void 0:d.toUpperCase())||"Z",c=((u=i.insurance)==null?void 0:u.toUpperCase())||"Z";return s==="asc"?a.localeCompare(c):c.localeCompare(a)});break;case"balance":o.sort((r,i)=>{const a=r.balance||0,c=i.balance||0;return s==="asc"?a-c:c-a});break;case"initialAmount":o.sort((r,i)=>{const a=r.initialAmount||0,c=i.initialAmount||0;return s==="asc"?a-c:c-a});break}return o};l.div`
  height: 3em;
  display: grid;
  padding: 0 1em;
  align-items: center;
  background: white;
  border-radius: 8px;
`;const A1=({datesSelected:e=[],setDatesSelected:n=()=>{},accounts:s=[],onSort:o=()=>{},onClientTypeChange:r=()=>{}})=>{const[i,a]=m.useState("defaultCriteria"),[c,d]=m.useState("asc"),[u,p]=m.useState("normal"),{isPharmacy:h}=E1(),f=I=>{a(I);const j=lu(s,I,c);o(j)},x=()=>{const I=c==="asc"?"desc":"asc";d(I);const j=lu(s,i,I);o(j)},g=I=>{f(I)},y=I=>{n(I)},b=I=>{p(I),r(I)},v=[{value:"defaultCriteria",label:"Por defecto"},{value:"date",label:"Fecha"},{value:"invoiceNumber",label:"Número de Factura"},{value:"client",label:"Cliente"},{value:"balance",label:"Balance"},{value:"initialAmount",label:"Monto Inicial"}];h&&v.splice(4,0,{value:"insurance",label:"Aseguradora"});const C=Ps();return t.jsxs(xbe,{children:[t.jsxs(ybe,{children:[t.jsx(vc,{inputMovilWidth:!0,setDates:n,dates:e}),t.jsx(Tu,{setDates:y,dates:e}),h&&t.jsx(Cbe,{children:t.jsx(ge,{defaultValue:"normal",style:{width:130},onChange:b,options:[{value:"normal",label:"Clientes"},{value:"insurance",label:"Aseguradoras"}]})})]}),t.jsxs(bbe,{children:[t.jsxs(vbe,{children:[t.jsx(M.Item,{label:"Ordenar: ",style:{marginBottom:0},children:t.jsx(ge,{defaultValue:"defaultCriteria",style:{width:180},onChange:g,options:v})}),t.jsx(U,{icon:c==="asc"?z.sort.sortAsc:z.sort.sortDesc,onClick:x,disabled:i==="defaultCriteria"})]}),C<900&&t.jsxs(jbe,{children:[t.jsx(kx,{children:"Total de Cuentas"}),t.jsxs(kx,{children:["#",s.length]})]})]})]})};A1.defaultProps={onFilter:()=>{},datesSelected:[],setDatesSelected:()=>{},onReportSaleOpen:()=>{},processedInvoices:[],setProcessedInvoices:()=>{}};const xbe=l.div`
  width: 100%;
  display: flex;
  background-color: var(--White);
  align-items: end;
  border-bottom: 1px solid var(--Gray);
  padding: 0.4em 1em;
  margin: 0 auto;
  gap: 1em;

  select {
    padding: 0.1em 0.2em;
  }

  @media (max-width: 900px) {
    gap: 0.8em;
    display: grid;
  }
`,bbe=l.div`
  display: flex;
  flex-wrap: wrap;
  gap: 1em;

  @media (max-width: 900px) {
    gap: 0.2em;
    order: 1;
    justify-content: space-between;
  }
`,kx=l.div`
  font-size: 1em;
  font-weight: 550;
  min-height: 2em;
  display: flex;
  align-items: center;
  white-space: nowrap;

  @media (max-width: 800px) {
    font-size: 1em;
  }
`,ybe=l.div`
  display: grid;
  gap: 1em;
  align-items: end;
  grid-template-columns: min-content min-content min-content;

  @media (max-width: 800px) {
    row-gap: 0;
    column-gap: 1em;
  }
`,vbe=l.div`
  display: flex;
  gap: 1em;
  align-items: center;

  @media (max-width: 800px) {
    gap: 0.2em;
  }
`,jbe=l.div`
  display: flex;
  gap: 1em;
  align-items: center;
`,Cbe=l.div`
  display: flex;
  align-items: center;

`,wbe=l.div`
    display: grid;
    height: 100vh;
    grid-template-rows: min-content min-content 1fr;
`,Sbe=e=>e==null?void 0:e.map(n=>{var c,d,u,p,h,f,x,g,y,b,v,C;const s=(c=n==null?void 0:n.invoice)==null?void 0:c.data,o=(n==null?void 0:n.client)||{},i=((s==null?void 0:s.paymentMethod)||[]).reduce((I,j)=>j.status?I+j.value:I,0),a=((d=n==null?void 0:n.account)==null?void 0:d.type)==="insurance";return{ncf:(s==null?void 0:s.NCF)||"N/A",invoiceNumber:(s==null?void 0:s.numberID)||"N/A",client:(o==null?void 0:o.name)||"Generic Client",rnc:o==null?void 0:o.personalID,insurance:((u=s==null?void 0:s.insurance)==null?void 0:u.name)||((h=(p=n==null?void 0:n.account)==null?void 0:p.insurance)==null?void 0:h.name)||"N/A",hasInsurance:!!((f=s==null?void 0:s.insurance)!=null&&f.name||(g=(x=n==null?void 0:n.account)==null?void 0:x.insurance)!=null&&g.name),isInsurance:a,date:n==null?void 0:n.createdAt,initialAmount:(n==null?void 0:n.initialAmountAr)||0,lastPaymentDate:n==null?void 0:n.lastPaymentDate,totalPaid:i,balance:(n==null?void 0:n.balance)||0,products:((y=s==null?void 0:s.products)==null?void 0:y.length)||0,total:((b=s==null?void 0:s.totalPurchase)==null?void 0:b.value)||0,ver:{account:n},actions:{account:n},type:((v=n==null?void 0:n.account)==null?void 0:v.type)||"normal",dateGroup:(C=n==null?void 0:n.createdAt)!=null&&C.seconds?ce.fromMillis(n.createdAt.seconds*1e3).toLocaleString(ce.DATE_FULL):"N/A"}}),Ibe=()=>{const e=D(q),[n,s]=m.useState(Ct("today")),[o,r]=m.useState([]),[i,a]=m.useState(""),[c,d]=m.useState("defaultCriteria"),[u,p]=m.useState("asc"),[h,f]=m.useState("normal"),x=Mv(e,n);m.useEffect(()=>{const C=Sbe(x),I=g(C,h),j=lu(I,c,u);r(j)},[x,c,u,h]);const g=(C,I)=>C?I==="insurance"?C.filter(j=>j.type==="insurance"):C.filter(j=>j.type!=="insurance"):[],y=o.reduce((C,I)=>C+(I.balance||0),0),b=C=>{r(C)},v=C=>{f(C)};return t.jsxs(wbe,{children:[t.jsx(Ze,{searchData:i,setSearchData:a}),t.jsx(A1,{accounts:o,onSort:b,datesSelected:n,setDatesSelected:s,onClientTypeChange:v}),t.jsx(fbe,{data:o,searchTerm:i,totalBalance:y,showInsuranceColumn:h==="insurance"})]})},Ebe=async({queryKey:e})=>{const[n,s,o]=e;yc(o);const{businessID:r,uid:i,role:a}=o,c=new Date(s.startDate),d=new Date(s.endDate),u=new Date("2024-01-21T14:41:00"),p=le($,"businesses",r,"accountsReceivablePaymentReceipt");let h;new Date>=u?["admin","owner","dev"].includes(a)?h=he(p,te("createdAt",">=",c),te("createdAt","<=",d),it("createdAt","desc")):h=he(p,te("createdAt",">=",c),te("createdAt","<=",d),te("createdBy","==",i),it("createdAt","desc")):h=he(p,te("createdAt",">=",c),te("createdAt","<=",d),it("createdAt","desc"));const f=await Me(h);return f.empty?[]:f.docs.map(x=>({id:x.id,...x.data()})).filter(x=>x.paymentMethod.some(g=>g.status===!0))},Abe=e=>{const n=D(q),{data:s,isLoading:o}=Uo({queryKey:["paymentReceipts",e,n],queryFn:Ebe,enabled:!!e&&!!n});return{paymentReceipts:s,loading:o}},kbe=m.lazy(()=>ks(()=>import("./SaleReportTable-BqR42KvU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166]))),Tbe=()=>{const[e,n]=m.useState(Ct("today")),{loading:s,paymentReceipts:o}=Abe(e),[r,i]=m.useState(!1),[a,c]=m.useState(""),[d,u]=m.useState(o||[]),p=()=>i(!r);return m.useEffect(()=>{u(o)},[o]),t.jsx(m.Fragment,{children:t.jsxs(Pbe,{animate:{x:0},transition:{type:"spring",stiffness:0},children:[t.jsx(Ze,{displayName:"Recibos de Pagos por Cobrar",data:o,searchData:a,setSearchData:c}),t.jsx(Wv,{invoices:o,processedInvoices:d,setProcessedInvoices:u,datesSelected:e,setDatesSelected:n,onReportSaleOpen:p}),"        ",t.jsx(m.Suspense,{fallback:t.jsx("div",{style:{padding:"2em",textAlign:"center"},children:"Cargando..."}),children:t.jsx(kbe,{bills:d,searchTerm:a,loading:s})})]})})},Pbe=l(Ie.div)`
  max-height: calc(100vh);
  height: 100vh;
  overflow: hidden;
  display: grid;
  background-color: var(--color2);
  grid-template-rows: min-content min-content 1fr;
  box-sizing: border-box;
`,{ACCOUNT_RECEIVABLE_LIST:Dbe,ACCOUNT_RECEIVABLE_INFO:$be,RECEIVABLE_PAYMENT_RECEIPTS:Rbe}=re.ACCOUNT_RECEIVABLE,Nbe=[{path:Dbe,element:t.jsx(Ibe,{})},{path:$be,element:t.jsx(sbe,{})},{path:Rbe,element:t.jsx(Tbe,{})}],Obe=({visible:e,onClose:n,onSelect:s,title:o,currentValue:r})=>{const[i,a]=m.useState(!1),[c,d]=m.useState(1),[u,p]=m.useState(1),[h,f]=m.useState(null);m.useEffect(()=>{var g;e?r&&(r.isPredefined?(a(!1),f(r.days)):(a(!0),d(r.value||1),p(((g=Nr.find(y=>y.unit===r.timeUnit))==null?void 0:g.value)||1))):(a(!1),d(1),p(1),f(null))},[e,r]);const x=()=>{if(i){const g=Nr.find(b=>b.value===u),y=c===1?g.label:g.pluralLabel;s({value:c,timeUnit:g.unit,displayText:`${c} ${y}`,isPredefined:!1})}else{const g=qs.find(y=>y.days===h);s({value:g.value,timeUnit:g.timeUnit,displayText:g.label,days:g.days,isPredefined:!0})}n()};return t.jsxs(Ce,{title:o,open:e,onCancel:n,width:400,footer:[t.jsx(U,{onClick:n,children:"Cancelar"},"cancel"),t.jsx(U,{type:"primary",onClick:x,disabled:i?!c:!h,children:"Confirmar"},"submit")],children:[t.jsx(St,{style:{marginBottom:16},checked:i,onChange:g=>a(g.target.checked),children:"Período personalizado"}),t.jsxs(Ye,{direction:"vertical",style:{width:"100%"},size:"large",children:[!i&&t.jsx(Je,{size:"small",children:t.jsx(Ye,{direction:"vertical",style:{width:"100%"},children:qs.map(({days:g,label:y})=>t.jsx(U,{type:h===g?"primary":"text",onClick:()=>f(g),style:{width:"100%",textAlign:"left"},children:y},g))})}),i&&t.jsx(Je,{size:"small",children:t.jsxs(Ye,{children:[t.jsx(Ke,{min:1,max:999,value:c,onChange:g=>d(g),style:{width:120}}),t.jsx(ge,{value:u,onChange:g=>p(g),style:{width:120},children:Nr.map(g=>t.jsx(ge.Option,{value:g.value,children:g.pluralLabel},g.value))})]})})]})]})},du=l.div`
  background: white;
  border-radius: 8px;
  padding: 1em 0em 0.4em;
  transition: all 0.3s ease;
`,fd=l.div`
  font-size: 16px;
  font-weight: 600;
  color: #1f1f1f;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;

  .anticon {
    color: #1890ff;
    font-size: 18px;
  }
`,Mbe=l(du)`
  background: #fafafa;
  border: 1px solid #f0f0f0;
  margin-bottom: 8px;
  padding: 12px;
  position: relative;

  &:last-child {
    margin-bottom: 0;
  }

  .delete-button {
    position: absolute;
    right: 8px;
    top: 8px;
    transition: all 0.2s;
    z-index: 10;
  }

  &:hover .delete-button {
    color: #ff4d4f;
    background: #fff0f0;
  }
`,Fbe=l.div`
  display: grid;
  grid-template-columns: 2fr 1fr 1fr;
  gap: 12px;
  align-items: start;

  .ant-form-item {
    margin-bottom: 0;
  }
`,Bbe=l.div`
  max-height: 400px;
  overflow-y: auto;
  padding-right: 8px;
  margin: 16px 0;

  &::-webkit-scrollbar {
    width: 6px;
  }

  &::-webkit-scrollbar-thumb {
    background: #d9d9d9;
    border-radius: 3px;
  }
`,Lbe=l.div`
  margin-top: 24px;
  padding: 16px 0;
  border-top: 1px solid #f0f0f0;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
`,zbe=l.button`
  width: 100%;
  padding: 8px;
  border: 1px dashed #d9d9d9;
  background: transparent;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  color: #1890ff;
  transition: all 0.3s;

  &:hover {
    border-color: #1890ff;
    color: #40a9ff;
  }

  .anticon {
    font-size: 16px;
  }
`,qs=[{days:1,label:"1 día",timeUnit:"day",value:1},{days:7,label:"1 semana",timeUnit:"week",value:1},{days:15,label:"15 días",timeUnit:"day",value:15},{days:30,label:"1 mes",timeUnit:"month",value:1},{days:90,label:"3 meses",timeUnit:"month",value:3},{days:180,label:"6 meses",timeUnit:"month",value:6},{days:365,label:"1 año",timeUnit:"year",value:1}],Nr=[{value:1,label:"día",pluralLabel:"días",unit:"day"},{value:7,label:"semana",pluralLabel:"semanas",unit:"week"},{value:30,label:"mes",pluralLabel:"meses",unit:"month"},{value:365,label:"año",pluralLabel:"años",unit:"year"}],k1=()=>{const e=W(),{isOpen:n,initialValues:s}=D(hO),o=D(q),[r]=M.useForm(),[i,a]=m.useState(!1),[c,d]=m.useState([]),[u,p]=m.useState(!1),[h,f]=m.useState(!1),[x,g]=m.useState({index:null,field:null});m.useEffect(()=>{if(n&&!u){if(s!=null&&s.insuranceTypes){const P=s.insuranceTypes.map(w=>{const S={...w,id:w.id||En()},E=N=>{var G;if(!N)return null;if(N.isPredefined!==void 0)return N;if(typeof N=="number"){const Q=qs.find(ae=>ae.days===N);if(Q)return{value:Q.value,timeUnit:Q.timeUnit,days:Q.days,isPredefined:!0}}if(N.value&&N.timeUnit){const Q=N.value*(((G=Nr.find(oe=>oe.unit===N.timeUnit))==null?void 0:G.value)||1),ae=qs.find(oe=>oe.days===Q);return ae?{value:ae.value,timeUnit:ae.timeUnit,days:ae.days,isPredefined:!0}:{...N,isPredefined:!1}}return N},T=E(w.paymentTerm),R=E(w.prescriptionValidity);return{...S,paymentTerm:T,prescriptionValidity:R,paymentTermDisplay:w.paymentTermDisplay||y(T),prescriptionValidityDisplay:w.prescriptionValidityDisplay||y(R)}});d(P)}r.setFieldsValue({insuranceName:s==null?void 0:s.insuranceName,insuranceCompanyName:s==null?void 0:s.insuranceCompanyName,insuranceCompanyRNC:s==null?void 0:s.insuranceCompanyRNC}),p(!0)}},[n,u,s,r]);const y=P=>{if(!P)return"";if(P.isPredefined){const S=qs.find(E=>E.days===P.days);return(S==null?void 0:S.label)||""}const w=Nr.find(S=>S.unit===P.timeUnit);return w?`${P.value} ${P.value===1?w.label:w.pluralLabel}`:""};m.useEffect(()=>{n||(b(),p(!1))},[n]);const b=()=>{r.resetFields(),d([])},v=()=>{d([...c,{id:En(),type:"",paymentTerm:null,paymentTermDisplay:"",prescriptionValidity:null,prescriptionValidityDisplay:""}])},C=P=>{d(w=>w.filter((E,T)=>T!==P))},I=()=>{b(),e(_m())},j=async P=>{if(!P.insuranceName||!P.insuranceCompanyName||!P.insuranceCompanyRNC){V.error("Por favor complete todos los campos del formulario");return}if(c.length===0){V.error("Debe agregar al menos un tipo de plan");return}if(c.some(S=>{var E,T;return!S.type||!((E=S.paymentTerm)!=null&&E.value)||!((T=S.prescriptionValidity)!=null&&T.value)})){V.error("Por favor complete todos los campos en los tipos de planes");return}a(!0);try{const S={...s,...P,insuranceTypes:c.map(E=>({id:E.id,type:E.type,paymentTerm:{value:E.paymentTerm.value,timeUnit:E.paymentTerm.timeUnit},prescriptionValidity:{value:E.prescriptionValidity.value,timeUnit:E.prescriptionValidity.timeUnit}}))};await nV(o,S),V.success("Configuración guardada exitosamente"),b(),e(_m())}catch(S){console.error("Error al guardar:",S),V.error("No se pudo guardar la configuración")}finally{a(!1)}};m.useEffect(()=>{n||b()},[n]);const k=(P,w)=>{const S=c[P],E=S[w];g({index:P,field:w,currentValue:{value:E==null?void 0:E.value,timeUnit:E==null?void 0:E.timeUnit,displayText:S[`${w}Display`],isPredefined:E==null?void 0:E.isPredefined,days:E==null?void 0:E.days}}),f(!0)},A=P=>{const{index:w,field:S}=x;d(E=>{const T=[...E];return T[w]={...T[w],[S]:{value:P.value,timeUnit:P.timeUnit,isPredefined:P.isPredefined,days:P.days},[`${S}Display`]:P.displayText},T})};return t.jsxs(t.Fragment,{children:[t.jsx(Ce,{title:t.jsxs(Ye,{children:[t.jsx(ma,{}),t.jsx("span",{children:s!=null&&s.id?"Editar Seguro":"Nuevo Seguro"})]}),open:n,onCancel:I,footer:null,maskClosable:!1,width:800,style:{top:20},children:t.jsxs(M,{form:r,layout:"vertical",onFinish:j,children:[t.jsxs(du,{children:[t.jsxs(fd,{children:[t.jsx(Up,{}),"Información General"]}),t.jsx(M.Item,{name:"insuranceName",label:"Nombre del Seguro",rules:[{required:!0,message:"Por favor ingrese el nombre del seguro"}],children:t.jsx(ie,{placeholder:"Ej: Seguro de Salud Premium"})})]}),t.jsxs(du,{children:[t.jsxs(fd,{children:[t.jsx(ma,{}),"Información de la Aseguradora"]}),t.jsxs("div",{style:{display:"flex",gap:"16px"},children:[t.jsx(M.Item,{name:"insuranceCompanyName",label:"Nombre de la Empresa",style:{flex:2},rules:[{required:!0,message:"Por favor ingrese el nombre de la empresa de seguro"}],children:t.jsx(ie,{prefix:t.jsx(ma,{}),placeholder:"Ej: Mapfre"})}),t.jsx(M.Item,{name:"insuranceCompanyRNC",label:"RNC",style:{flex:1},rules:[{required:!0,message:"Por favor ingrese el RNC"}],children:t.jsx(ie,{prefix:t.jsx($a,{}),placeholder:"Ej: 123456789"})})]})]}),t.jsxs(fd,{style:{margin:"24px 0 16px"},children:[t.jsx(Up,{}),"Tipos de Planes"]}),t.jsx(Bbe,{children:c.map((P,w)=>{var S,E;return t.jsxs(Mbe,{children:[t.jsx(U,{type:"text",danger:!0,size:"small",className:"delete-button",icon:t.jsx(ht,{}),onClick:()=>C(w)}),t.jsxs(Fbe,{children:[t.jsx(M.Item,{label:"Tipo de Plan",rules:[{required:!0}],children:t.jsx(ie,{size:"middle",value:P.type,onChange:T=>{d(R=>{const N=[...R];return N[w]={...N[w],type:T.target.value},N})},placeholder:"Ej: Premium, Básico"})}),t.jsx(M.Item,{label:"Tiempo Pago",rules:[{required:!0}],children:t.jsx(ie,{size:"middle",value:P.paymentTermDisplay||(P.paymentTerm?((S=qs.find(T=>T.days===P.paymentTerm))==null?void 0:S.label)||`${P.paymentTerm} días`:""),placeholder:"Seleccionar período",readOnly:!0,onClick:()=>k(w,"paymentTerm"),suffix:t.jsx(Tn,{})})}),t.jsx(M.Item,{label:"Vigencia",rules:[{required:!0}],children:t.jsx(ie,{size:"middle",value:P.prescriptionValidityDisplay||(P.prescriptionValidity?((E=qs.find(T=>T.days===P.prescriptionValidity))==null?void 0:E.label)||`${P.prescriptionValidity} días`:""),placeholder:"Seleccionar vigencia",readOnly:!0,onClick:()=>k(w,"prescriptionValidity"),suffix:t.jsx(Tn,{})})})]})]},P.id)})}),t.jsxs(zbe,{onClick:v,children:[t.jsx(Jn,{}),"Agregar Nuevo Tipo de Seguro"]}),t.jsxs(Lbe,{children:[t.jsx(U,{onClick:I,disabled:i,children:"Cancelar"}),t.jsx(U,{type:"primary",htmlType:"submit",loading:i,children:s!=null&&s.id?"Actualizar":"Guardar"})]})]})}),t.jsx(Obe,{visible:h,onClose:()=>f(!1),onSelect:A,title:x.field==="paymentTerm"?"Seleccionar Tiempo de Pago":"Seleccionar Vigencia",currentValue:x.currentValue})]})},Ube=({types:e=[]})=>{if(!e||e.length===0)return null;const n=e.slice(0,2),s=e.length-2;return t.jsxs(Wbe,{children:[n.map((o,r)=>t.jsx(Vbe,{children:o.type},o.id||r)),s>0&&t.jsxs(qbe,{children:["+",s]})]})},Wbe=l.div`
    display: flex;
    gap: 4px;
    align-items: center;
`,qbe=l.div`
    background: #f0f0f0;
    color: #666;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: 600;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
    transition: all 0.2s ease;
    cursor: pointer;

    &:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        background: #e0e0e0;
    }
`,Vbe=l.div`
    background: #3f3f3f; /* Color único para todas las opciones */
    color: white;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: 500;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: all 0.2s ease;

    &:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
`,Gbe=()=>{const e=W(),[n,s]=m.useState(""),{data:o}=gj(),r=[{accessor:"insuranceName",Header:"Nombre del Seguro",align:"left",maxWidth:"1.4fr",minWidth:"150px"},{accessor:"insuranceCompanyName",Header:"Nombre de la Empresa",align:"left",maxWidth:"1.4fr",minWidth:"180px"},{accessor:"insuranceCompanyRNC",Header:"RNC",align:"left",maxWidth:"1.4fr",minWidth:"150px"},{accessor:"insuranceTypes",Header:"Tipos de Planes",align:"left",maxWidth:"1.4fr",minWidth:"250px",cell:({value:c})=>t.jsx(Ube,{types:c||[]})},{accessor:"createdAt",Header:"Fecha de Creación",align:"left",maxWidth:"1.4fr",minWidth:"150px"}],i=(o||[]).map(c=>({insuranceName:c.insuranceName,insuranceCompanyName:c.insuranceCompanyName,insuranceCompanyRNC:c.insuranceCompanyRNC,insuranceTypes:Array.isArray(c.insuranceTypes)?c.insuranceTypes:[],createdAt:Ve.convertMillisToFriendlyDate(Ve.convertTimestampToMillis(c.createdAt)),data:c})),a=c=>{e(iv(c.data))};return t.jsxs(_be,{children:[t.jsx(Ze,{sectionName:"Configuración de Seguros",sectionNameIcon:z.insurance.insurance,displayName:"seguros"}),t.jsx(Hbe,{children:t.jsx(rn,{columns:r,data:i,searchTerm:n,onRowClick:a,elementName:"seguros",emptyText:"No hay configuraciones de seguro",numberOfElementsPerPage:10})}),t.jsx(k1,{})]})},_be=l.div`
    display: flex;
    flex-direction: column;
    height: 100vh;
    width: 100%;
`,Hbe=l.div`
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 1em;
`;l.div`
    display: flex;
    justify-content: flex-end;
    gap: 1em;
`;const{INSURANCE_CONFIG:Qbe,INSURANCE_CREATE:Ybe}=jc.INSURANCE_TERM,Kbe=[{path:Qbe,element:t.jsx(Gbe,{})},{path:Ybe,element:t.jsx(k1,{})}],Jbe=async(e,n,s)=>{try{if(n===null||s===null||!e)return;const o=be(12),r=F($,"errors",o),i={user:e.uid,business:e.businessID,id:o,createdAt:new Date,status:"pending",errorStackTrace:n,errorInfo:s};await De(r,i),console.log("Error registrado en Firebase con éxito")}catch(o){console.error("Error añadiendo documento: ",o)}},jn={ERROR_TITLE:"¡Ups! Algo salió mal",ERROR_DESCRIPTION:"Un error inesperado ha ocurrido. Por favor, intenta de nuevo más tarde.",REPORT_ERROR:"Reportar error",REPORT_DESCRIPTION:"Si marcas esta casilla, el error será registrado para su posterior revisión",GO_BACK:"Volver Atrás",GO_HOME:"Ir a Inicio",CANT_GO_BACK:"No se puede retroceder",CANT_GO_BACK_DESC:"No hay páginas anteriores disponibles. Serás redirigido al inicio.",ERROR_REPORTED:"Error reportado",ERROR_REPORTED_DESC:"El error ha sido reportado con éxito. Gracias por tu colaboración."},xd={container:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0},exit:{opacity:0,y:-20}},logo:{hidden:{scale:0},visible:{scale:1,transition:{delay:.2}}},errorDetails:{hidden:{opacity:0,height:0},visible:{opacity:1,height:"auto",transition:{delay:.5}}}},Xbe=(e,n)=>{const s=D(q),o=Fe(),[r,i]=m.useState(!1),[a,c]=m.useState(!1),[d,u]=m.useState(!1),{HOME:p}=re.BASIC_TERM;return m.useEffect(()=>{u(window.history.length>2)},[]),{user:s,loading:r,reportError:a,canGoBack:d,handleBack:async g=>{g.preventDefault();try{i(!0),a&&(await Jbe(s,e,n),Be.success({message:jn.ERROR_REPORTED,description:jn.ERROR_REPORTED_DESC,icon:createElement(cc,{style:{color:"#52c41a"}})})),window.location.href=p}catch(y){i(!1),console.error("Error al reportar:",y)}},handleGoBack:()=>{try{o(-1)}catch{Be.warning({message:jn.CANT_GO_BACK,description:jn.CANT_GO_BACK_DESC}),window.location.href=p}},handleReportChange:g=>{c(g.target.checked)}}},T1=({children:e})=>t.jsx(Zbe,{children:e});T1.propTypes={children:we.node.isRequired};const Zbe=l(Je)`
    max-width: 600px;
    width: 100%;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border-radius: 8px;
    
    .ant-card-body {
        padding: 24px;
        
        @media (max-width: 576px) {
            padding: 16px;
        }
    }
    
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
`,{Title:eye,Paragraph:tye}=Xe,P1=({errorStackTrace:e,variants:n})=>t.jsxs(nye,{variants:n,children:[t.jsx(eye,{level:5,children:"Detalles del error:"}),t.jsx(sye,{children:t.jsx(tye,{copyable:!0,code:!0,children:e})})]});P1.propTypes={errorStackTrace:we.string,variants:we.object};const nye=l(Ie.div)`
    background: #f8f9fa;
    border-radius: 6px;
    padding: 1rem;
`,sye=l.div`
    max-height: 200px;
    overflow-y: auto;
    background: #f0f2f5;
    border-radius: 4px;
    padding: 1rem;
    
    &::-webkit-scrollbar {
        width: 8px;
    }
    
    &::-webkit-scrollbar-track {
        background: #f1f1f1;
    }
    
    &::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }
`,{Button:Tx,Checkbox:oye,Typography:rye,Space:Tp,Alert:iye}=Ne,{Title:aye,Text:bd}=rye,D1=({errorInfo:e,errorStackTrace:n})=>{const{user:s,loading:o,canGoBack:r,handleBack:i,handleGoBack:a,handleReportChange:c}=Xbe(e,n);return t.jsx(cye,{variants:xd.container,initial:"hidden",animate:"visible",exit:"exit",children:t.jsx(T1,{children:t.jsx(Tp,{direction:"vertical",size:"large",style:{width:"100%"},children:t.jsxs(gt,{children:[t.jsx(lye,{variants:xd.logo,initial:"hidden",animate:"visible",children:t.jsx(Cp,{})}),t.jsx(dye,{icon:t.jsx(e0,{className:"error-icon"}),message:t.jsx(aye,{level:4,style:{margin:0},children:jn.ERROR_TITLE}),description:t.jsx(bd,{children:jn.ERROR_DESCRIPTION}),type:"error",showIcon:!0}),t.jsxs(uye,{children:[t.jsx(oye,{onChange:c,children:t.jsx(bd,{strong:!0,children:jn.REPORT_ERROR})}),t.jsx(bd,{type:"secondary",className:"report-description",children:jn.REPORT_DESCRIPTION})]}),t.jsxs(pye,{children:[r&&t.jsx(Tx,{icon:t.jsx(uS,{}),onClick:a,size:"large",className:"back-button",children:jn.GO_BACK}),t.jsx(Tx,{type:"primary",size:"large",icon:t.jsx(uc,{}),onClick:i,loading:o,className:"home-button",children:jn.GO_HOME})]}),(s==null?void 0:s.role)==="dev"&&t.jsx(P1,{errorStackTrace:n,variants:xd.errorDetails})]})})})})};D1.propTypes={errorInfo:we.string,errorStackTrace:we.string};const cye=l(Ie.div)`
    min-height: 100vh;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    background: linear-gradient(145deg, var(--color-background-light) 0%, var(--color-background-dark) 100%);
    overflow: hidden;
`,lye=l(Ie.div)`
    display: flex;
    justify-content: center;
    margin-bottom: 2.5rem;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
`,dye=l(iye)`
    border-radius: 12px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(255, 0, 0, 0.1);
    margin: 1em 0;
    
    .error-icon {
        font-size: 28px;
        color: #ff4d4f;
    }

    .ant-alert-message {
        margin-bottom: 8px;
    }
`,uye=l(Tp)`
    padding: 1.5rem;
    background: var(--color-background-light);
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.06);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
    
    .report-description {
        font-size: 0.9rem;
        opacity: 0.85;
        padding-left: 24px;
    }

    .ant-checkbox-wrapper:hover {
        opacity: 0.8;
    }
`,pye=l(Tp)`
    width: 100%;
    justify-content: center;
    gap: 16px !important;
    margin-top: 1rem;
    
    .back-button {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        &:hover {
            transform: translateX(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    }
    
    .home-button {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        &:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    }

    button {
        height: 44px;
        padding: 0 24px;
        border-radius: 8px;
    }
`;class $1 extends m.Component{constructor(n){super(n),this.state={hasError:!1,error:null,errorStackTrace:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){const o=n.stack;s=s.componentStack,this.setState({errorStackTrace:o,errorInfo:s})}render(){return this.state.hasError?t.jsx(D1,{errorStackTrace:this.state.errorStackTrace,errorInfo:this.state.errorInfo}):this.props.children}}const mye=e=>t.jsx($1,{children:t.jsx(lX,{children:e})}),hye=e=>{const{element:n,isPublic:s=!1,...o}=e;return s?{...o,element:t.jsx($1,{children:n})}:{...o,element:mye(n)}},R1=e=>e.map(n=>{const s=hye(n);return s.children&&s.children.length>0?{...s,children:R1(s.children)}:s}),gye=[...vae,...oce,...Lde,...qde,...ape,...Vpe,...vge,...Cge,...exe,...rF,...g0e,...I0e,...K0e,...Nbe,...Kbe,{path:"*",element:t.jsx(v8,{}),title:"Página no encontrada",metaDescription:"Lo sentimos, la página que estás buscando no existe.",isPublic:!0}],N1=R1(gye),fye=()=>{const e=D(q),n=W();m.useEffect(()=>{if(!e||!(e!=null&&e.businessID))return;const s=F($,"businesses",e.businessID,"settings","taxReceipt"),o=Te(s,r=>{r.exists()?(n(Hp(r.data().taxReceiptEnabled)),n(Sm(r.data().taxReceiptEnabled))):(n(Hp(!1)),n(Sm(!1)))},r=>{console.error("Ocurrió un error al obtener el comprobante fiscal:",r)});return()=>o()},[e,n])};function xye(e){const n=W();m.useEffect(()=>{if(e){const s=Te(F($,"users",e),o=>{if(o.exists()){const r=o.data().user,i=r!=null&&r.realName?r==null?void 0:r.realName:r==null?void 0:r.name;n(bc({uid:o.id,displayName:i,realName:r==null?void 0:r.realName,username:r==null?void 0:r.name})),n(BS({businessID:r==null?void 0:r.businessID,role:r==null?void 0:r.role}))}else n(Kn())});return()=>s()}},[e])}const bye=()=>{const e=W(),n=D(q);m.useEffect(()=>{try{if(!n||!(n!=null&&n.businessID))return;const s=le($,"businesses",n==null?void 0:n.businessID,"cashCounts"),o=he(s,te("cashCount.state","in",["open","closing"])),r=Te(o,async i=>{const a=i.docs.map(async p=>{const h=p.data();h.cashCount.opening.date&&(h.cashCount.opening.date=Ve.convertTimestampToMillis(h.cashCount.opening.date)),h.cashCount&&h.cashCount.createdAt&&(h.cashCount.createdAt=Ve.convertTimestampToMillis(h.cashCount.createdAt)),h.cashCount&&h.cashCount.updatedAt&&(h.cashCount.updatedAt=Ve.convertTimestampToMillis(h.cashCount.updatedAt));const f=await ys(h.cashCount.opening.employee),x=await ys(h.cashCount.opening.approvalEmployee),g=await ys(h.cashCount.closing.employee),y=await ys(h.cashCount.closing.approvalEmployee);return delete h.cashCount.sales,delete h.cashCount.stateHistory,h.cashCount={...h.cashCount,opening:{...h.cashCount.opening,employee:f,approvalEmployee:x},closing:{...h.cashCount.closing,employee:g,approvalEmployee:y},sales:[]},h}),c=await Promise.all(a),d=c.find(({cashCount:p})=>p.state==="open"&&p.opening.employee.id===n.uid);if(d){e(Rm({state:"open",cashCount:d.cashCount}));return}const u=c.find(({cashCount:p})=>p.state==="closing"&&p.opening.employee.id===n.uid);if(u){e(Rm({state:"closing",cashCount:u.cashCount}));return}e(pR())});return()=>r()}catch{}},[n])},yye=()=>{const e=_t(),n=N1.find(s=>s.path===e.pathname)||{title:"Aplicación - Plataforma de Gestión",metaDescription:"Una plataforma avanzada para gestionar tus procesos empresariales."};return t.jsxs(p0,{children:[t.jsx("title",{children:n.title}),t.jsx("meta",{name:"description",content:n.metaDescription})]})};let O1=ue.now(),wn=!1;function M1(){O1=ue.now()}function vye(e){const n=ue.now(),s=ue.fromMillis(n.toMillis()+Zj);return{token:`${e}_${n.toMillis()}`,expiresAt:s}}const F1=e=>{wn||(wn=!0,Ce.warning({title:"Sesión Expirada",content:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",okText:"Aceptar",onOk:()=>{wn=!1,e("/login",{replace:!0})},afterClose:()=>{wn=!1},centered:!0,maskClosable:!1,keyboard:!1}))},jye=async(e,n,s)=>{wn||(wn=!0,Ce.confirm({title:"Inactividad Prolongada",content:"¿Deseas mantener tu sesión activa? Se cerrará en 5 días por inactividad.",okText:"Sí, mantener activa",cancelText:"No, cerrar sesión",centered:!0,onCancel:async()=>{e&&await Ot(F($,"sessionTokens",e)),localStorage.clear(),n(Kn()),s("/login",{replace:!0})},afterClose:()=>{wn=!1}}))},Cye=async(e,n,s)=>{wn||(wn=!0,Ce.confirm({title:"Sesión por Expirar",content:"Tu sesión expirará pronto.",okText:"Entendido",cancelText:"Cerrar sesión",centered:!0,onCancel:async()=>{await Ot(F($,"sessionTokens",e)),localStorage.clear(),n(Kn()),s("/login",{replace:!0})},afterClose:()=>{wn=!1}}))},B1=async(e,n)=>{try{const s=le($,"sessionTokens"),o=he(s,te("userId","==",e)),r=await Me(o),i=ue.fromMillis(ue.now().toMillis()-e1),a=r.docs.filter(c=>{if(c.id===n)return!1;const d=c.data();return!d.expiresAt||d.expiresAt.toMillis()<i.toMillis()}).map(c=>Ot(c.ref));await Promise.all(a)}catch(s){console.error("Error limpiando tokens antiguos:",s)}},wye=async(e,n)=>{if(!e)return null;const s=JSON.parse(e);if(!(s!=null&&s.uid))return null;await B1(s.uid,null);const{token:o,expiresAt:r}=vye(s.uid);await De(F($,"sessionTokens",o),{userId:s.uid,expiresAt:r,createdAt:de(),lastActivity:de()}),localStorage.setItem("sessionToken",o),localStorage.setItem("sessionExpires",r.toMillis().toString()),localStorage.removeItem("user");const i=await Se(F($,"users",s.uid));if(i.exists()){const a=i.data().user;n(bc({uid:s.uid,displayName:(a==null?void 0:a.realName)||(a==null?void 0:a.name),username:a==null?void 0:a.name,realName:a==null?void 0:a.realName}))}return o},Sye=async(e,n,s,o)=>{var f;if(!e||!n){s(Kn());return}const r=ue.now(),i=ue.fromMillis(parseInt(n));if(r.toMillis()>i.toMillis()){await Ot(F($,"sessionTokens",e)),localStorage.clear(),s(Kn()),F1(o);return}const a=await Se(F($,"sessionTokens",e));if(!a.exists()){localStorage.clear(),s(Kn());return}await De(F($,"sessionTokens",e),{lastActivity:de()},{merge:!0});const c=a.data(),d=c.expiresAt;d.toMillis()!==parseInt(n)&&(localStorage.setItem("sessionExpires",d.toMillis().toString()),r.toMillis()>d.toMillis()-24*60*60*1e3&&await Cye(e,s,o));const u=c.userId;await B1(u,e);const p=await Se(F($,"users",u)),h=(f=p==null?void 0:p.data())==null?void 0:f.user;s(bc({uid:p==null?void 0:p.id,displayName:(h==null?void 0:h.realName)||(h==null?void 0:h.name),username:h==null?void 0:h.name,realName:h==null?void 0:h.realName}))},Iye=(e,n)=>{const s=["mousedown","keydown","scroll","touchstart"];s.forEach(r=>{window.addEventListener(r,M1)});const o=setInterval(()=>{if(ue.now().toMillis()-O1.toMillis()>$ae){const i=localStorage.getItem("sessionToken");jye(i,e,n)}},Nae);return{events:s,activityCheck:o}};function Eye(){const e=W(),n=Fe();return m.useEffect(()=>{const s=async()=>{try{const a=localStorage==null?void 0:localStorage.getItem("sessionToken"),c=localStorage==null?void 0:localStorage.getItem("sessionExpires"),d=localStorage==null?void 0:localStorage.getItem("user");d&&!a&&await wye(d,e),await Sye(a,c,e,n)}catch(a){console.error("Error en checkSession:",a),localStorage.clear(),e(Kn()),F1(n)}};s();const o=setInterval(s,Rae),{events:r,activityCheck:i}=Iye(e,n);return()=>{r.forEach(a=>{window.removeEventListener(a,M1)}),clearInterval(i),clearInterval(o)}},[]),null}const Aye="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4NCiAgPGRlZnM+DQogICAgPHN0eWxlPg0KICAgICAgLmNscy0xIHsNCiAgICAgICAgc3Ryb2tlOiAjNDJhNWY1Ow0KICAgICAgICBzdHJva2Utd2lkdGg6IDJweDsNCiAgICAgIH0NCg0KICAgICAgLmNscy0yIHsNCiAgICAgICAgZm9udC1zaXplOiA1MS4xNnB4Ow0KICAgICAgICBmaWxsOiAjNDJhNWY1Ow0KICAgICAgICBmb250LWZhbWlseTogQXJpYWw7DQogICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7DQogICAgICB9DQogICAgPC9zdHlsZT4NCiAgPC9kZWZzPg0KICA8Y2lyY2xlIGlkPSJFbGlwc2VfMSIgZGF0YS1uYW1lPSJFbGlwc2UgMSIgY2xhc3M9ImNscy0xIiBjeD0iMzEuNzgxIiBjeT0iMzIuMjE5IiByPSIyOS44MTMiLz4NCiAgPHRleHQgaWQ9IlYiIGNsYXNzPSJjbHMtMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTQuNzI4IDUwLjc2Mykgc2NhbGUoMC45NzcpIj5WPC90ZXh0Pg0KPC9zdmc+DQo=";b0.registerPlugin(y0);const kye=l.div`
  position: fixed;
  inset: 0;
  background: #000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  user-select: none;
`,Tye=l.h1`
  margin: 0;
  font-size: 3rem;
  font-weight: 800;
  color: #0090ff;          /* azul Ventamax */
  letter-spacing: 0.02em;
`,Pye=l.h2`
  margin: 0;
  font-size: 1rem;
  font-weight: 400;
  color: #d1d1d1;          /* gris suave */
  letter-spacing: 0.25em;
  text-transform: uppercase;
`;function Dye({onFinish:e}){const n=m.useRef(null),s=m.useRef(null),o=m.useRef(null),r=m.useRef(null);return PS(()=>{const i=new y0(o.current,{type:"chars"}),a=b0.timeline({defaults:{ease:"power3.out"}});return a.from(n.current,{autoAlpha:0,duration:.4}),a.fromTo(s.current,{scale:.85},{scale:1.4,duration:.9,yoyo:!0,repeat:1,ease:"elastic.out(1, 0.45)"},"<"),a.from(i.chars,{yPercent:120,opacity:0,duration:.6,stagger:.04},"+=0.2"),a.from(r.current,{y:20,opacity:0,duration:.5},"-=0.35"),a.to(n.current,{autoAlpha:0,duration:.5,delay:.7,onComplete:e}),()=>a.revert()},[]),t.jsxs(kye,{ref:n,children:[t.jsx("img",{ref:s,src:Aye,alt:"Ventamax logo",width:120}),t.jsx(Tye,{ref:o,children:"Ventamax"}),t.jsx(Pye,{ref:r,children:"by gysys"})]})}const $ye=()=>{const e=D(q);Eye();const n=1200,s=8e3,[o,r]=m.useState(!0),i=m.useRef(Date.now()),a=m.useRef(null);m.useEffect(()=>{if(a.current&&clearTimeout(a.current),e){const d=Date.now()-i.current,u=Math.max(0,n-d);a.current=setTimeout(()=>{r(!1)},u)}else a.current=setTimeout(()=>{r(!1)},s);return()=>{a.current&&clearTimeout(a.current)}},[e,n,s]);const c=()=>r(!1);return t.jsx(t.Fragment,{children:o&&t.jsx(Dye,{onFinish:c})})},Rye=async e=>{const n=le($,"businesses",e,"products");return(await Me(n)).docs.map(o=>({id:o.id,...o.data()}))},Nye=async(e,n)=>{const s=le($,"businesses",e,"batches"),o=he(s,te("productId","==",n),te("isDeleted","==",!1));return(await Me(o)).docs.reduce((i,a)=>i+(a.data().quantity||0),0)},L1="ventamax_last_stock_sync",Oye=e=>{const n=localStorage.getItem(`${L1}_${e}`);return n?new Date(n).getTime():null},Mye=e=>{localStorage.setItem(`${L1}_${e}`,new Date().toISOString())},yd=async e=>{try{console.log("Iniciando sincronización de stock...");const n=await Rye(e);for(const s of n){const o=await Nye(e,s.id);if(s.stock!==o){const r=F($,"businesses",e,"products",s.id);await je(r,{stock:o,lastStockSync:new Date().toISOString()}),console.log(`Stock actualizado para ${s.name}: ${o}`)}}Mye(e),console.log("Sincronización de stock completada")}catch(n){console.error("Error en la sincronización de stock:",n)}},Fye=(e=720)=>{const n=D(q);m.useEffect(()=>{if(!(n!=null&&n.businessID))return;const s=()=>{const i=Oye(n.businessID);if(!i)return!0;const a=Date.now()-i,c=e*60*1e3;return a>=c};s()&&yd(n.businessID);const r=setInterval(()=>{window.requestIdleCallback?window.requestIdleCallback(()=>{s()&&yd(n.businessID)}):setTimeout(()=>{s()&&yd(n.businessID)},0)},10*60*1e3);return()=>clearInterval(r)},[n,e])},Bye=()=>{const e=_t(),n=W();return m.useEffect(()=>{n(bO({pathname:e.pathname,search:e.search,hash:e.hash,state:e.state,key:e.key}))},[e,n]),null},Lye=e=>e==="B"?8:10;function zye(){const[e,n]=m.useState([]),[s,o]=m.useState(!0),[r,i]=m.useState(null),a=D(q),c=a==null?void 0:a.businessID;return m.useEffect(()=>{if(!c){o(!1);return}o(!0);const p=le($,"businesses",c,"taxReceipts"),h=Te(p,async f=>{if(f.docs.some(y=>{var b;return typeof((b=y.data().data)==null?void 0:b.sequence)!="string"})){console.warn("useTaxReceiptsFix: hay recibos con sequence no-string; se omite proceso."),o(!1);return}await Promise.all(f.docs.map(async y=>{const b=y.data().data??{},v={};b.id!==y.id&&(v["data.id"]=y.id),typeof b.disabled!="boolean"&&(v["data.disabled"]=!1),typeof b.sequenceLength!="number"&&(v["data.sequenceLength"]=Lye(b.serie));const C=Number(b.sequence);Number.isNaN(C)||(v["data.sequence"]=C),Object.keys(v).length&&await je(F($,"businesses",c,"taxReceipts",y.id),v)}));const g=f.docs.map(y=>{const b=y.data().data;return{id:b.id,name:b.name,type:b.type,serie:b.serie,sequence:b.sequence,sequenceLength:b.sequenceLength,increase:b.increase,quantity:b.quantity,disabled:b.disabled}});n(g),o(!1)},f=>{console.error("Snapshot error:",f),i(f),o(!1)});return()=>h()},[c]),{taxReceipts:e,loading:s,error:r,updateSequence:async(p,h=1)=>{var f;if(!c){console.warn("updateSequence: no businessID");return}try{const x=F($,"businesses",c,"taxReceipts",p),g=await Se(x);if(!g.exists())throw new Error("Receipt not found");const y=(f=g.data().data)==null?void 0:f.sequence;if(typeof y!="number"){console.warn("updateSequence: sequence no es numérico; se omite.");return}const b=y+h;await je(x,{"data.sequence":b})}catch(x){console.error("Error updating sequence:",x),i(x)}},formatNCF:({type:p,serie:h,sequence:f,sequenceLength:x})=>p+h+String(f).padStart(x,"0")}}const Uye=({data:e})=>{const{title:n,message:s,percentage:o,seriesInfo:r}=e;return t.jsxs(Wye,{children:[t.jsx(qye,{children:"📄"}),t.jsx(Vye,{children:n}),t.jsx(Gye,{children:r}),t.jsxs(_ye,{children:[t.jsx(Hye,{percentage:o}),t.jsxs(Qye,{children:[o,"% restante"]})]}),t.jsx(Yye,{children:s}),t.jsx(Kye,{children:"Solicitar más"})]})},Wye=l.div`
  display: flex;
  flex-direction: column;
  padding: var(--space-5);
  background-color: var(--bg-base);
  border-left: 4px solid var(--warning);
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
`,qye=l.div`
  font-size: 1.25rem;
  margin-bottom: var(--space-3);
`,Vye=l.h3`
  font-size: 1.1rem;
  font-weight: 600;
  margin: 0;
  color: var(--text-100);
`,Gye=l.div`
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--text-60);
  margin: var(--space-1) 0 var(--space-4) 0;
`,_ye=l.div`
  width: 100%;
  margin-bottom: var(--space-3);
  position: relative;
`,Hye=l.div`
  height: 6px;
  width: 100%;
  background-color: var(--progress-bg);
  border-radius: 3px;
  
  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: ${e=>e.percentage}%;
    background-color: var(--warning);
    border-radius: 3px;
  }
`,Qye=l.div`
  position: absolute;
  right: 0;
  top: -1.25rem;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--warning);
`,Yye=l.p`
  font-size: 0.9rem;
  margin: var(--space-3) 0 var(--space-5) 0;
  color: var(--text-100);
`,Kye=l.button`
  padding: var(--space-2) var(--space-3);
  background-color: transparent;
  border: none;
  border-radius: var(--radius);
  font-weight: 500;
  text-align: center;
  cursor: pointer;
  color: var(--primary);
  
  &:hover {
    background-color: rgba(0, 102, 255, 0.05); /* primary con baja opacidad */
  }
`,Jye=({data:e})=>{const{fiscalReceipts:n,inventory:s,sales:o,system:r}=e;return t.jsx(Xye,{children:t.jsx(Zye,{children:t.jsx(Uye,{data:n})})})},Xye=l.div`
  padding: var(--space-4);
`,Zye=l.div`
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-4);
  
  /* Media query para pantallas más grandes */
  @media (min-width: 768px) {
    grid-template-columns: repeat(2, 1fr);
  }
`,eve={open:{y:0,opacity:1,transition:{type:"spring",stiffness:300,damping:24,mass:1}},closed:{y:"-100%",opacity:0,transition:{type:"spring",stiffness:300,damping:24,mass:1}}},tve=()=>{const[e]=m.useState("notifications"),{isOpen:n}=D(S$),s=W(),o={fiscalReceipts:{title:"Comprobantes Fiscales",alertType:"warning",message:"Quedan 150 comprobantes de 1000. Solicita más antes de que se agoten.",percentage:15,seriesInfo:"Facturas Serie A"},inventory:{title:"Inventario Bajo",items:[{name:"Papel Térmico 80mm",status:"crítico"},{name:"Tinta Epson T664",status:"crítico"},{name:"Café Premium 1kg",status:"bajo"}]},sales:{title:"Meta de Ventas",current:78e3,goal:1e5,percentage:78,daysLeft:3},system:{title:"Actualizaciones del Sistema",currentVersion:"2.4.1",newVersion:"2.5.0",hasUpdate:!0,improvements:"Incluye mejoras de seguridad y nuevas funcionalidades."}},r=()=>s(w$());return t.jsxs(t.Fragment,{children:[t.jsx(nve,{isOpen:n,onClick:r}),t.jsxs(sve,{animate:n?"open":"closed",initial:"closed",variants:eve,children:[t.jsxs(ove,{children:[t.jsxs(rve,{children:[t.jsx(ive,{children:"🔔"}),t.jsxs(ave,{children:[t.jsx(cve,{children:"Centro de Notificaciones"}),t.jsx(lve,{children:"Gestiona alertas de tu TPV"})]})]}),t.jsx(dve,{onClick:r,children:"✕"})]}),t.jsx(uve,{children:t.jsx(Jye,{data:o})})]})]})},nve=l.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 9950;
  visibility: ${e=>e.isOpen?"visible":"hidden"};
  opacity: ${e=>e.isOpen?1:0};
  transition: visibility 0.3s, opacity 0.3s;
`,sve=l(Ie.div)`
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100vh;
  background-color: var(--bg-base);
  position: fixed;
  top: 0;
  right: 0;
  z-index: 9999;
  box-shadow: var(--shadow-md);
  overflow-y: auto;
  padding: var(--space-5);
  font-family: var(--font-sans);
`,ove=l.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: var(--space-3);
  border-bottom: 1px solid var(--border-200);
  margin-bottom: var(--space-4);
`,rve=l.div`
  display: flex;
  align-items: center;
`,ive=l.div`
  font-size: 1.25rem;
`,ave=l.div`
  margin-left: var(--space-2);
`,cve=l.h1`
  font-size: 1.25rem;
  font-weight: 600;
  margin: 0;
  color: var(--text-100);
`,lve=l.p`
  font-size: 0.8rem;
  color: var(--text-60);
  margin: 0;
`,dve=l.button`
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  color: var(--text-60);
  transition: color 0.2s;

  &:hover {
    color: var(--text-100);
  }
`,uve=l.div`
  background-color: var(--bg-base);
  border-radius: var(--radius);
  overflow: hidden;
  flex: 1;
`,pve=()=>{const e=D(q),n=W(),s=jS();m.useEffect(()=>{if(!(e!=null&&e.businessID))return;const o=F($,"businesses",e.businessID,"settings","billing");(async()=>{try{(await Se(o)).exists()||await De(o,{billingMode:"direct"})}catch(a){console.error("Error al inicializar la configuración de facturación:",a)}})();const i=Te(o,a=>{const c=a.data()||{billingMode:"direct",invoiceType:"template1"};s.setQueryData(["billingSettings",e.businessID],c),n(Em({...c,isLoading:!1,isError:!1}))},a=>{n(Em({billingMode:null,isLoading:!1,isError:!0}))});return()=>i()},[e==null?void 0:e.businessID,n,s])};async function mve(e){if(!e||typeof e!="string")throw new Error("Debe proporcionar un businessID válido");const n=F($,`businesses/${e}/counters/users`),s=await Se(n);let o=0;if(s.exists()){const u=s.data();typeof u.value=="number"&&(o=u.value)}const r=le($,"users"),i=he(r,te("user.businessID","==",e),it("user.createAt","asc")),a=await Me(i);if(a.empty)return{ok:!0,last:o,processed:0};const c=dt($);let d=0;return a.forEach(u=>{const p=u.data().user;p.number==null?(o++,c.update(u.ref,{"user.number":o}),d++):typeof p.number=="number"&&p.number>o&&(o=p.number)}),c.set(n,{value:o},{merge:!0}),await c.commit(),{ok:!0,last:o,processed:d}}const hve=()=>{const[e,n]=m.useState(!1),[s,o]=m.useState(null),[r,i]=m.useState(null),a=D(q);return m.useEffect(()=>{(async()=>{if(!a||!a.businessID)return;const d=`backfill-user-numbers-${a.businessID}`;if(localStorage.getItem(d)==="completed"){console.log("Backfill already executed for this business");return}n(!0),i(null);try{const u=await mve(a.businessID);o(u),localStorage.setItem(d,"completed")}catch(u){console.error("Error al hacer backfill de números de usuario:",u),i(u.message||"Error desconocido")}finally{n(!1)}})()},[a]),{loading:e,data:s,error:r}},gve=()=>{const e=W(),n=D(q),s=(n==null?void 0:n.role)==="dev";return m.useEffect(()=>{if(!s)return;let r="",i=null;const a=c=>{const d=document.activeElement;if(!(d&&(d.tagName==="INPUT"||d.tagName==="TEXTAREA"||d.contentEditable==="true"))){if(i&&clearTimeout(i),r+=c.key.toLowerCase(),r.includes("dev")){if(c.preventDefault(),r.includes("devconsole")){e(yn({activeTab:"console"})),r="";return}else if(r.includes("devdebug")){e(yn({activeTab:"debug"})),r="";return}else if(r.includes("devinfo")){e(yn({activeTab:"info"})),r="";return}else if(r.endsWith("dev")){e(yn()),r="";return}}if(c.ctrlKey&&c.shiftKey&&c.key==="D"){c.preventDefault(),e(yn()),r="";return}if(c.key==="Escape"&&r.includes("escape")&&(r.match(/escape/g)||[]).length>=2){e(yn()),r="";return}i=setTimeout(()=>{r=""},2e3),r.length>20&&(r=r.slice(-20))}};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a),i&&clearTimeout(i)}},[s,e]),{openDeveloperModal:(r="console")=>{s&&e(yn({activeTab:r}))},isDeveloper:s}},fve=()=>(Bye(),null);function xve(){const e=W(),n=D(q);return zye(),gve(),m.useEffect(()=>{e(VS())},[]),pve(),AP(),hve(),xye(n==null?void 0:n.uid),bye(),EP(),nI(),fye(),iI(),YS(),Iu(),Fye(),t.jsx(m.Fragment,{children:t.jsxs(sC,{children:[t.jsx(fve,{}),t.jsx($ye,{}),t.jsx(yye,{}),t.jsx(gt,{mode:"wait",children:t.jsx(pS,{children:N1.map((s,o)=>t.jsx(Wp,{path:s.path,element:s.element,children:s.children&&s.children.map((r,i)=>t.jsx(Wp,{path:r==null?void 0:r.path,element:r==null?void 0:r.element},i))},o))})}),t.jsx(gt,{children:t.jsx(aae,{})}),t.jsx(tve,{})]})})}const bve={grey:{50:"#424242",100:"#616161",200:"#757575",300:"#9e9e9e",400:"#bdbdbd",500:"#e0e0e0",600:"#eeeeee",700:"#f5f5f5",800:"#fafafa",900:"#ffffff",A100:"#616161",A200:"#424242",A400:"#212121",A700:"#000000"},colors:{neutral:{light:"#616161",main:"#9e9e9e",dark:"#bdbdbd"},primary:{light:"#7986cb",main:"#3f51b5",dark:"#303f9f",contrastText:"#fff"},secondary:{light:"#ff4081",main:"#f50057",dark:"#c51162",contrastText:"#fff"},error:{light:"#e57373",main:"#f44336",dark:"#d32f2f",contrastText:"#fff"},warning:{light:"rgba(255, 152, 0, 0.87)",main:"rgba(255, 152, 0, 1)",dark:"rgba(245, 124, 0, 1)",contrastText:"rgba(0, 0, 0, 0.87)"},info:{light:"rgba(33, 150, 243, 0.7)",main:"rgba(33, 150, 243, 1)",dark:"rgba(25, 118, 210, 1)",contrastText:"rgba(255, 255, 255, .87)"},success:{light:"#81c784",main:"#4caf50",dark:"#388e3c",contrastText:"rgba(0,0,0,.87)"}},common:{black:"#fff",white:"#000"},text:{primary:"rgba(255,255,255,.87)",secondary:"rgba(255,255,255,.54)",disabled:"rgba(255,255,255,.38)",hint:"rgba(255,255,255,.38)"},divider:"rgba(255,255,255,.12)",bg:{shade:"rgb(20, 20, 20)",shade2:"rgb(45, 45, 45)",shade3:"rgb(55, 55, 55)",color:"#1b415f",color2:"#525252",color3:"#444444"},borders:{basic:"1px solid #e2e8f0",highlighted:"2px solid #a0aec0",accent:"2px dashed #718096"},action:{active:"rgba(255, 255, 255, 0.54)",hover:"rgba(255, 255, 255, 0.04)",hoverOpacity:.04,selected:"rgba(255, 255, 255, 0.08)",selectedOpacity:.08,disabled:"rgba(255, 255, 255, 0.26)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.12}},yve={...Td},vve={...bve},jve=({children:e})=>{const n=D(b$);return t.jsx(dC,{theme:n==="light"?yve:vve,children:e})},Cve=[jve,K2,JA],wve=({children:e})=>Cve.reduce((n,s)=>t.jsx(s,{children:n}),e),Sve="activo",Ive="eliminado",Eve={active:Sve,deleted:Ive},Ave={es:{status:Eve}};v0.use(DS).init({resources:Ave,lng:"es",interpolation:{escapeValue:!1}});const{ConfigProvider:kve}=Ne,Tve={mask:{backgroundColor:"rgba(255, 0, 0, 0.5)"}},Pve=({children:e})=>t.jsx(kve,{theme:{components:{Modal:Tve}},children:e}),Dve=new CS,$ve=({children:e})=>(m.useEffect(()=>{document.body.classList.add("production-mode")},[]),e),Rve=W1.createRoot(document.getElementById("root"));Rve.render(t.jsx(m.StrictMode,{children:t.jsx(rC,{store:dv,children:t.jsx(_w,{children:t.jsx(hS,{children:t.jsx($S,{i18n:v0,children:t.jsx(wve,{children:t.jsx(Pve,{children:t.jsx(wS,{client:Dve,children:t.jsx($ve,{children:t.jsx(xve,{})})})})})})})})})}));export{rn as A,KCe as C,Ve as D,ej as I,Cp as L,zt as S,xpe as T,ft as a,FV as b,fR as c,$ as d,zu as e,Lu as f,Od as g,$s as h,z as i,tN as o,q as s,Y as u,hG as w};
//# sourceMappingURL=index-rUC063_I.js.map
