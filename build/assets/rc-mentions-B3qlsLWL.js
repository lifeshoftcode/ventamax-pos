import{c as E,k as Te,d as F,g as ke}from"./@babel-DQaiFHLa.js";import{c as st}from"./classnames-C28gIRGy.js";import{B as ct}from"./rc-input-BrplG3Px.js";import{f as Oe,A as ft,K as y}from"./rc-util-C_kT1Pk-.js";import{r as o,a as h}from"./react-rfUEOKBT.js";import{T as vt}from"./rc-textarea-TypTsaWD.js";import"./rc-resize-observer-CVw_Y2pA.js";import{d as dt}from"./@rc-component-DxyG_Y2B.js";import{E as mt,M as Pe}from"./rc-menu-DuuJLGul.js";function pt(){var e=o.useState({id:0,callback:null}),n=E(e,2),u=n[0],s=n[1],i=o.useCallback(function(c){s(function(a){var f=a.id;return{id:f+1,callback:c}})},[]);return o.useEffect(function(){var c;(c=u.callback)===null||c===void 0||c.call(u)},[u]),i}var $e=o.createContext(null);function gt(e){var n=o.useContext($e),u=n.notFoundContent,s=n.activeIndex,i=n.setActiveIndex,c=n.selectOption,a=n.onFocus,f=n.onBlur,d=n.onScroll,m=e.prefixCls,g=e.options,b=g[s]||{};return o.createElement(mt,{prefixCls:"".concat(m,"-menu"),activeKey:b.key,onSelect:function(C){var p=C.key,S=g.find(function(M){var I=M.key;return I===p});c(S)},onFocus:a,onBlur:f,onScroll:d},g.map(function(x,C){var p=x.key,S=x.disabled,M=x.className,I=x.style,L=x.label;return o.createElement(Pe,{key:p,disabled:S,className:M,style:I,onMouseEnter:function(){i(C)}},L)}),!g.length&&o.createElement(Pe,{disabled:!0},u))}var xt={bottomRight:{points:["tl","br"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},bottomLeft:{points:["tr","bl"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},topRight:{points:["bl","tr"],offset:[0,-4],overflow:{adjustX:1,adjustY:1}},topLeft:{points:["br","tl"],offset:[0,-4],overflow:{adjustX:1,adjustY:1}}},ht=function(n){var u=n.prefixCls,s=n.options,i=n.children,c=n.visible,a=n.transitionName,f=n.getPopupContainer,d=n.dropdownClassName,m=n.direction,g=n.placement,b="".concat(u,"-dropdown"),x=o.createElement(gt,{prefixCls:b,options:s}),C=o.useMemo(function(){var p;return m==="rtl"?p=g==="top"?"topLeft":"bottomLeft":p=g==="top"?"topRight":"bottomRight",p},[m,g]);return o.createElement(dt,{prefixCls:b,popupVisible:c,popup:x,popupPlacement:C,popupTransitionName:a,builtinPlacements:xt,getPopupContainer:f,popupClassName:d},i)},Ct=function(){return null};function St(e){var n=e.selectionStart;return e.value.slice(0,n)}function wt(e,n){return n.reduce(function(u,s){var i=e.lastIndexOf(s);return i>u.location?{location:i,prefix:s}:u},{location:-1,prefix:""})}function Re(e){return(e||"").toLowerCase()}function yt(e,n,u){var s=e[0];if(!s||s===u)return e;for(var i=e,c=n.length,a=0;a<c;a+=1)if(Re(i[a])!==Re(n[a])){i=i.slice(a);break}else a===c-1&&(i=i.slice(c));return i}function Et(e,n){var u=n.measureLocation,s=n.prefix,i=n.targetText,c=n.selectionStart,a=n.split,f=e.slice(0,u);f[f.length-a.length]===a&&(f=f.slice(0,f.length-a.length)),f&&(f="".concat(f).concat(a));var d=yt(e.slice(c),i.slice(c-u-s.length),a);d.slice(0,a.length)===a&&(d=d.slice(a.length));var m="".concat(f).concat(s).concat(i).concat(a);return{text:"".concat(m).concat(d),selectionLocation:m.length}}function bt(e,n){e.setSelectionRange(n,n),e.blur(),e.focus()}function It(e,n){return!n||e.indexOf(n)===-1}function _t(e,n){var u=n.value,s=u===void 0?"":u,i=e.toLowerCase();return s.toLowerCase().indexOf(i)!==-1}var Mt=["prefixCls","className","style","prefix","split","notFoundContent","value","defaultValue","children","options","open","allowClear","silent","validateSearch","filterOption","onChange","onKeyDown","onKeyUp","onPressEnter","onSearch","onSelect","onFocus","onBlur","transitionName","placement","direction","getPopupContainer","dropdownClassName","rows","visible","onPopupScroll"],Nt=["suffix","prefixCls","defaultValue","value","allowClear","onChange","classNames","className","disabled","onClear"],Pt=o.forwardRef(function(e,n){var u=e.prefixCls,s=e.className,i=e.style,c=e.prefix,a=c===void 0?"@":c,f=e.split,d=f===void 0?" ":f,m=e.notFoundContent,g=m===void 0?"Not Found":m,b=e.value,x=e.defaultValue,C=e.children,p=e.options,S=e.open;e.allowClear;var M=e.silent,I=e.validateSearch,L=I===void 0?It:I,A=e.filterOption,R=A===void 0?_t:A,K=e.onChange,_=e.onKeyDown,w=e.onKeyUp,ae=e.onPressEnter,oe=e.onSearch,H=e.onSelect,le=e.onFocus,G=e.onBlur,Fe=e.transitionName,Le=e.placement,Ae=e.direction,Ke=e.getPopupContainer,Be=e.dropdownClassName,ie=e.rows,De=ie===void 0?1:ie;e.visible;var q=e.onPopupScroll,Ve=Te(e,Mt),j=o.useMemo(function(){return Array.isArray(a)?a:[a]},[a]),ue=o.useRef(null),B=o.useRef(null),J=o.useRef(null),Q=function(){var t;return(t=B.current)===null||t===void 0||(t=t.resizableTextArea)===null||t===void 0?void 0:t.textArea};h.useImperativeHandle(n,function(){var l;return{focus:function(){var r;return(r=B.current)===null||r===void 0?void 0:r.focus()},blur:function(){var r;return(r=B.current)===null||r===void 0?void 0:r.blur()},textarea:(l=B.current)===null||l===void 0||(l=l.resizableTextArea)===null||l===void 0?void 0:l.textArea,nativeElement:ue.current}});var je=o.useState(!1),se=E(je,2),U=se[0],ce=se[1],Ue=o.useState(""),fe=E(Ue,2),ve=fe[0],de=fe[1],We=o.useState(""),me=E(We,2),pe=me[0],Xe=me[1],Ye=o.useState(0),ge=E(Ye,2),xe=ge[0],he=ge[1],ze=o.useState(0),Ce=E(ze,2),Z=Ce[0],ee=Ce[1],He=o.useState(!1),Se=E(He,2),Ge=Se[0],we=Se[1],qe=Oe("",{defaultValue:x,value:b}),ye=E(qe,2),T=ye[0],Je=ye[1];o.useEffect(function(){U&&J.current&&(J.current.scrollTop=Q().scrollTop)},[U]);var Qe=h.useMemo(function(){if(S)for(var l=0;l<j.length;l+=1){var t=j[l],r=T.lastIndexOf(t);if(r>=0)return[!0,"",t,r]}return[U,ve,pe,xe]},[S,U,j,T,ve,pe,xe]),W=E(Qe,4),k=W[0],te=W[1],X=W[2],ne=W[3],re=h.useCallback(function(l){var t;return p&&p.length>0?t=p.map(function(r){var v;return F(F({},r),{},{key:(v=r==null?void 0:r.key)!==null&&v!==void 0?v:r.value})}):t=ft(C).map(function(r){var v=r.props,N=r.key;return F(F({},v),{},{label:v.children,key:N||v.value})}),t.filter(function(r){return R===!1?!0:R(l,r)})},[C,p,R]),Y=h.useMemo(function(){return re(te)},[re,te]),Ze=pt(),et=function(t,r,v){ce(!0),de(t),Xe(r),he(v),ee(0)},O=function(t){ce(!1),he(0),de(""),Ze(t)},Ee=function(t){Je(t),K==null||K(t)},tt=function(t){var r=t.target.value;Ee(r)},be=function(t){var r,v=t.value,N=v===void 0?"":v,P=Et(T,{measureLocation:ne,targetText:N,prefix:X,selectionStart:(r=Q())===null||r===void 0?void 0:r.selectionStart,split:d}),$=P.text,D=P.selectionLocation;Ee($),O(function(){bt(Q(),D)}),H==null||H(t,X)},nt=function(t){var r=t.which;if(_==null||_(t),!!k){if(r===y.UP||r===y.DOWN){var v=Y.length,N=r===y.UP?-1:1,P=(Z+N+v)%v;ee(P),t.preventDefault()}else if(r===y.ESC)O();else if(r===y.ENTER){if(t.preventDefault(),M)return;if(!Y.length){O();return}var $=Y[Z];be($)}}},rt=function(t){var r=t.key,v=t.which,N=t.target,P=St(N),$=wt(P,j),D=$.location,z=$.prefix;if(w==null||w(t),[y.ESC,y.UP,y.DOWN,y.ENTER].indexOf(v)===-1)if(D!==-1){var V=P.slice(D+z.length),Ne=L(V,d),ut=!!re(V).length;Ne?(r===z||r==="Shift"||v===y.ALT||r==="AltGraph"||k||V!==te&&ut)&&et(V,z,D):k&&O(),oe&&Ne&&oe(V,z)}else k&&O()},at=function(t){!k&&ae&&ae(t)},Ie=o.useRef(),_e=function(t){window.clearTimeout(Ie.current),!Ge&&t&&le&&le(t),we(!0)},Me=function(t){Ie.current=window.setTimeout(function(){we(!1),O(),G==null||G(t)},0)},ot=function(){_e()},lt=function(){Me()},it=function(t){q==null||q(t)};return h.createElement("div",{className:st(u,s),style:i,ref:ue},h.createElement(vt,ke({ref:B,value:T},Ve,{rows:De,onChange:tt,onKeyDown:nt,onKeyUp:rt,onPressEnter:at,onFocus:_e,onBlur:Me})),k&&h.createElement("div",{ref:J,className:"".concat(u,"-measure")},T.slice(0,ne),h.createElement($e.Provider,{value:{notFoundContent:g,activeIndex:Z,setActiveIndex:ee,selectOption:be,onFocus:ot,onBlur:lt,onScroll:it}},h.createElement(ht,{prefixCls:u,transitionName:Fe,placement:Le,direction:Ae,options:Y,visible:!0,getPopupContainer:Ke,dropdownClassName:Be},h.createElement("span",null,X))),T.slice(ne+X.length)))}),Rt=o.forwardRef(function(e,n){var u=e.suffix,s=e.prefixCls,i=s===void 0?"rc-mentions":s,c=e.defaultValue,a=e.value,f=e.allowClear,d=e.onChange,m=e.classNames,g=e.className,b=e.disabled,x=e.onClear,C=Te(e,Nt),p=o.useRef(null),S=o.useRef(null);o.useImperativeHandle(n,function(){var _,w;return F(F({},S.current),{},{nativeElement:((_=p.current)===null||_===void 0?void 0:_.nativeElement)||((w=S.current)===null||w===void 0?void 0:w.nativeElement)})});var M=Oe("",{defaultValue:c,value:a}),I=E(M,2),L=I[0],A=I[1],R=function(w){A(w),d==null||d(w)},K=function(){R("")};return h.createElement(ct,{suffix:u,prefixCls:i,value:L,allowClear:f,handleReset:K,className:g,classNames:m,disabled:b,ref:p,onClear:x},h.createElement(Pt,ke({className:m==null?void 0:m.mentions,prefixCls:i,ref:S,onChange:R,disabled:b},C)))});Rt.Option=Ct;export{Rt as M};
//# sourceMappingURL=rc-mentions-B3qlsLWL.js.map
