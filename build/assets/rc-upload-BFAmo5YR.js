import{r as $,s as E,f as q,h as N,i as I,a as L,b as F,j as D,_ as T,k as z,g as U,d as J,e as Q}from"./@babel-DQaiFHLa.js";import{a as j,r as W}from"./react-rfUEOKBT.js";import{c as V}from"./classnames-C28gIRGy.js";import{b as Y,q as Z}from"./rc-util-C_kT1Pk-.js";const M=function(o,i){if(o&&i){var v=Array.isArray(i)?i:i.split(","),e=o.name||"",r=o.type||"",t=r.replace(/\/.*$/,"");return v.some(function(h){var n=h.trim();if(/^\*(\/\*)?$/.test(h))return!0;if(n.charAt(0)==="."){var c=e.toLowerCase(),s=n.toLowerCase(),u=[s];return(s===".jpg"||s===".jpeg")&&(u=[".jpg",".jpeg"]),u.some(function(p){return c.endsWith(p)})}return/\/\*$/.test(n)?t===n.replace(/\/.*$/,""):r===n?!0:/^\w+$/.test(n)?(Y(!1,"Upload takes an invalidate 'accept' type '".concat(n,"'.Skip for check.")),!0):!1})}return!0};function _(o,i){var v="cannot ".concat(o.method," ").concat(o.action," ").concat(i.status,"'"),e=new Error(v);return e.status=i.status,e.method=o.method,e.url=o.action,e}function A(o){var i=o.responseText||o.response;if(!i)return i;try{return JSON.parse(i)}catch{return i}}function x(o){var i=new XMLHttpRequest;o.onProgress&&i.upload&&(i.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),o.onProgress(t)});var v=new FormData;o.data&&Object.keys(o.data).forEach(function(r){var t=o.data[r];if(Array.isArray(t)){t.forEach(function(h){v.append("".concat(r,"[]"),h)});return}v.append(r,t)}),o.file instanceof Blob?v.append(o.filename,o.file,o.file.name):v.append(o.filename,o.file),i.onerror=function(t){o.onError(t)},i.onload=function(){return i.status<200||i.status>=300?o.onError(_(o,i),A(i)):o.onSuccess(A(i),i)},i.open(o.method,o.action,!0),o.withCredentials&&"withCredentials"in i&&(i.withCredentials=!0);var e=o.headers||{};return e["X-Requested-With"]!==null&&i.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(e).forEach(function(r){e[r]!==null&&i.setRequestHeader(r,e[r])}),i.send(v),{abort:function(){i.abort()}}}var ee=function(){var o=$(E().mark(function i(v,e){var r,t,h,n,c,s,u,p;return E().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:s=function(){return s=$(E().mark(function k(f){return E().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",new Promise(function(m){f.file(function(b){e(b)?(f.fullPath&&!b.webkitRelativePath&&(Object.defineProperties(b,{webkitRelativePath:{writable:!0}}),b.webkitRelativePath=f.fullPath.replace(/^\//,""),Object.defineProperties(b,{webkitRelativePath:{writable:!1}})),m(b)):m(null)})}));case 1:case"end":return y.stop()}},k)})),s.apply(this,arguments)},c=function(k){return s.apply(this,arguments)},n=function(){return n=$(E().mark(function k(f){var w,y,m,b,a;return E().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:w=f.createReader(),y=[];case 2:return C.next=5,new Promise(function(R){w.readEntries(R,function(){return R([])})});case 5:if(m=C.sent,b=m.length,b){C.next=9;break}return C.abrupt("break",12);case 9:for(a=0;a<b;a++)y.push(m[a]);C.next=2;break;case 12:return C.abrupt("return",y);case 13:case"end":return C.stop()}},k)})),n.apply(this,arguments)},h=function(k){return n.apply(this,arguments)},r=[],t=[],v.forEach(function(g){return t.push(g.webkitGetAsEntry())}),u=function(){var g=$(E().mark(function k(f,w){var y,m;return E().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(f){a.next=2;break}return a.abrupt("return");case 2:if(f.path=w||"",!f.isFile){a.next=10;break}return a.next=6,c(f);case 6:y=a.sent,y&&r.push(y),a.next=15;break;case 10:if(!f.isDirectory){a.next=15;break}return a.next=13,h(f);case 13:m=a.sent,t.push.apply(t,q(m));case 15:case"end":return a.stop()}},k)}));return function(f,w){return g.apply(this,arguments)}}(),p=0;case 9:if(!(p<t.length)){d.next=15;break}return d.next=12,u(t[p]);case 12:p++,d.next=9;break;case 15:return d.abrupt("return",r);case 16:case"end":return d.stop()}},i)}));return function(v,e){return o.apply(this,arguments)}}(),re=+new Date,ae=0;function O(){return"rc-upload-".concat(re,"-").concat(++ae)}var te=["component","prefixCls","className","classNames","disabled","id","name","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],ne=function(o){N(v,o);var i=I(v);function v(){var e;L(this,v);for(var r=arguments.length,t=new Array(r),h=0;h<r;h++)t[h]=arguments[h];return e=i.call.apply(i,[this].concat(t)),F(D(e),"state",{uid:O()}),F(D(e),"reqs",{}),F(D(e),"fileInput",void 0),F(D(e),"_isMounted",void 0),F(D(e),"onChange",function(n){var c=e.props,s=c.accept,u=c.directory,p=n.target.files,l=q(p).filter(function(d){return!u||M(d,s)});e.uploadFiles(l),e.reset()}),F(D(e),"onClick",function(n){var c=e.fileInput;if(c){var s=n.target,u=e.props.onClick;if(s&&s.tagName==="BUTTON"){var p=c.parentNode;p.focus(),s.blur()}c.click(),u&&u(n)}}),F(D(e),"onKeyDown",function(n){n.key==="Enter"&&e.onClick(n)}),F(D(e),"onDataTransferFiles",function(){var n=$(E().mark(function c(s,u){var p,l,d,g,k,f,w;return E().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(p=e.props,l=p.multiple,d=p.accept,g=p.directory,k=q(s.items||[]),f=q(s.files||[]),(f.length>0||k.some(function(b){return b.kind==="file"}))&&(u==null||u()),!g){m.next=11;break}return m.next=7,ee(Array.prototype.slice.call(k),function(b){return M(b,e.props.accept)});case 7:f=m.sent,e.uploadFiles(f),m.next=14;break;case 11:w=q(f).filter(function(b){return M(b,d)}),l===!1&&(w=f.slice(0,1)),e.uploadFiles(w);case 14:case"end":return m.stop()}},c)}));return function(c,s){return n.apply(this,arguments)}}()),F(D(e),"onFilePaste",function(){var n=$(E().mark(function c(s){var u,p;return E().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(u=e.props.pastable,u){d.next=3;break}return d.abrupt("return");case 3:if(s.type!=="paste"){d.next=6;break}return p=s.clipboardData,d.abrupt("return",e.onDataTransferFiles(p,function(){s.preventDefault()}));case 6:case"end":return d.stop()}},c)}));return function(c){return n.apply(this,arguments)}}()),F(D(e),"onFileDragOver",function(n){n.preventDefault()}),F(D(e),"onFileDrop",function(){var n=$(E().mark(function c(s){var u;return E().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(s.preventDefault(),s.type!=="drop"){l.next=4;break}return u=s.dataTransfer,l.abrupt("return",e.onDataTransferFiles(u));case 4:case"end":return l.stop()}},c)}));return function(c){return n.apply(this,arguments)}}()),F(D(e),"uploadFiles",function(n){var c=q(n),s=c.map(function(u){return u.uid=O(),e.processFile(u,c)});Promise.all(s).then(function(u){var p=e.props.onBatchStart;p==null||p(u.map(function(l){var d=l.origin,g=l.parsedFile;return{file:d,parsedFile:g}})),u.filter(function(l){return l.parsedFile!==null}).forEach(function(l){e.post(l)})})}),F(D(e),"processFile",function(){var n=$(E().mark(function c(s,u){var p,l,d,g,k,f,w,y,m;return E().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(p=e.props.beforeUpload,l=s,!p){a.next=14;break}return a.prev=3,a.next=6,p(s,u);case 6:l=a.sent,a.next=12;break;case 9:a.prev=9,a.t0=a.catch(3),l=!1;case 12:if(l!==!1){a.next=14;break}return a.abrupt("return",{origin:s,parsedFile:null,action:null,data:null});case 14:if(d=e.props.action,typeof d!="function"){a.next=21;break}return a.next=18,d(s);case 18:g=a.sent,a.next=22;break;case 21:g=d;case 22:if(k=e.props.data,typeof k!="function"){a.next=29;break}return a.next=26,k(s);case 26:f=a.sent,a.next=30;break;case 29:f=k;case 30:return w=(Q(l)==="object"||typeof l=="string")&&l?l:s,w instanceof File?y=w:y=new File([w],s.name,{type:s.type}),m=y,m.uid=s.uid,a.abrupt("return",{origin:s,data:f,parsedFile:m,action:g});case 35:case"end":return a.stop()}},c,null,[[3,9]])}));return function(c,s){return n.apply(this,arguments)}}()),F(D(e),"saveFileInput",function(n){e.fileInput=n}),e}return T(v,[{key:"componentDidMount",value:function(){this._isMounted=!0;var r=this.props.pastable;r&&document.addEventListener("paste",this.onFilePaste)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort(),document.removeEventListener("paste",this.onFilePaste)}},{key:"componentDidUpdate",value:function(r){var t=this.props.pastable;t&&!r.pastable?document.addEventListener("paste",this.onFilePaste):!t&&r.pastable&&document.removeEventListener("paste",this.onFilePaste)}},{key:"post",value:function(r){var t=this,h=r.data,n=r.origin,c=r.action,s=r.parsedFile;if(this._isMounted){var u=this.props,p=u.onStart,l=u.customRequest,d=u.name,g=u.headers,k=u.withCredentials,f=u.method,w=n.uid,y=l||x,m={action:c,filename:d,data:h,file:s,headers:g,withCredentials:k,method:f||"post",onProgress:function(a){var P=t.props.onProgress;P==null||P(a,s)},onSuccess:function(a,P){var C=t.props.onSuccess;C==null||C(a,s,P),delete t.reqs[w]},onError:function(a,P){var C=t.props.onError;C==null||C(a,P,s),delete t.reqs[w]}};p(n),this.reqs[w]=y(m)}}},{key:"reset",value:function(){this.setState({uid:O()})}},{key:"abort",value:function(r){var t=this.reqs;if(r){var h=r.uid?r.uid:r;t[h]&&t[h].abort&&t[h].abort(),delete t[h]}else Object.keys(t).forEach(function(n){t[n]&&t[n].abort&&t[n].abort(),delete t[n]})}},{key:"render",value:function(){var r=this.props,t=r.component,h=r.prefixCls,n=r.className,c=r.classNames,s=c===void 0?{}:c,u=r.disabled,p=r.id,l=r.name,d=r.style,g=r.styles,k=g===void 0?{}:g,f=r.multiple,w=r.accept,y=r.capture,m=r.children,b=r.directory,a=r.openFileDialogOnClick,P=r.onMouseEnter,C=r.onMouseLeave,R=r.hasControlInside,B=z(r,te),H=V(F(F(F({},h,!0),"".concat(h,"-disabled"),u),n,n)),X=b?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},K=u?{}:{onClick:a?this.onClick:function(){},onKeyDown:a?this.onKeyDown:function(){},onMouseEnter:P,onMouseLeave:C,onDrop:this.onFileDrop,onDragOver:this.onFileDragOver,tabIndex:R?void 0:"0"};return j.createElement(t,U({},K,{className:H,role:R?void 0:"button",style:d}),j.createElement("input",U({},Z(B,{aria:!0,data:!0}),{id:p,name:l,disabled:u,type:"file",ref:this.saveFileInput,onClick:function(G){return G.stopPropagation()},key:this.state.uid,style:J({display:"none"},k.input),className:s.input,accept:w},X,{multiple:f,onChange:this.onChange},y!=null?{capture:y}:{})),m)}}]),v}(W.Component);function S(){}var se=function(o){N(v,o);var i=I(v);function v(){var e;L(this,v);for(var r=arguments.length,t=new Array(r),h=0;h<r;h++)t[h]=arguments[h];return e=i.call.apply(i,[this].concat(t)),F(D(e),"uploader",void 0),F(D(e),"saveUploader",function(n){e.uploader=n}),e}return T(v,[{key:"abort",value:function(r){this.uploader.abort(r)}},{key:"render",value:function(){return j.createElement(ne,U({},this.props,{ref:this.saveUploader}))}}]),v}(W.Component);F(se,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:S,onError:S,onSuccess:S,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});export{se as U};
//# sourceMappingURL=rc-upload-BFAmo5YR.js.map
