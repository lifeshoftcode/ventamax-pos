import{A as Or,b as Ze,v as vr,e as Pr,K as me,f as hr}from"./rc-util-C_kT1Pk-.js";import{d as A,f as re,k as yr,b as Hr,e as Cr,c as B,g as Sr,p as Ar}from"./@babel-DQaiFHLa.js";import{u as Rr,b as $r,B as Fr}from"./rc-select-DqdyuVBS.js";import{r as t}from"./react-rfUEOKBT.js";import{a as ir,c as Wr,U as jr,T as Ur}from"./rc-tree-iXRYS6u9.js";import"./classnames-C28gIRGy.js";import"./rc-overflow-CaWLhvk3.js";import"./react-dom-CWvG3IXd.js";import"./rc-resize-observer-CVw_Y2pA.js";import"./rc-motion-F1MUgz2i.js";const Br=function(e){var r=t.useRef({valueLabels:new Map});return t.useMemo(function(){var l=r.current.valueLabels,i=new Map,o=e.map(function(c){var a=c.value,n=c.label,u=n??l.get(a);return i.set(a,u),A(A({},c),{},{label:u})});return r.current.valueLabels=i,[o]},[e])};var Gr=function(r,l,i,o){return t.useMemo(function(){var c=function(_){return _.map(function(N){var L=N.value;return L})},a=c(r),n=c(l),u=a.filter(function(M){return!o[M]}),g=a,v=n;if(i){var K=ir(a,!0,o);g=K.checkedKeys,v=K.halfCheckedKeys}return[Array.from(new Set([].concat(re(u),re(g)))),v]},[r,l,i,o])},Jr=function(r){return Array.isArray(r)?r:r!==void 0?[r]:[]},Yr=function(r){var l=r||{},i=l.label,o=l.value,c=l.children;return{_title:i?[i]:["title","label"],value:o||"value",key:o||"value",children:c||"children"}},ur=function(r){return!r||r.disabled||r.disableCheckbox||r.checkable===!1},qr=function(r,l){var i=[],o=function c(a){a.forEach(function(n){var u=n[l.children];u&&(i.push(n[l.value]),c(u))})};return o(r),i},pr=function(r){return r==null};const zr=function(e,r){return t.useMemo(function(){var l=Wr(e,{fieldNames:r,initWrapper:function(o){return A(A({},o),{},{valueEntities:new Map})},processEntity:function(o,c){var a=o.node[r.value];c.valueEntities.set(a,o)}});return l},[e,r])};var br=function(){return null},Qr=["children","value"];function xr(e){return Or(e).map(function(r){if(!t.isValidElement(r)||!r.type)return null;var l=r,i=l.key,o=l.props,c=o.children,a=o.value,n=yr(o,Qr),u=A({key:i,value:a},n),g=xr(c);return g.length&&(u.children=g),u}).filter(function(r){return r})}function or(e){if(!e)return e;var r=A({},e);return"props"in r||Object.defineProperty(r,"props",{get:function(){return Ze(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),r}}),r}function Xr(e,r,l,i,o,c){var a=null,n=null;function u(){function g(v){var K=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0",M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return v.map(function(_,N){var L="".concat(K,"-").concat(N),w=_[c.value],j=l.includes(w),te=g(_[c.children]||[],L,j),z=t.createElement(br,_,te.map(function(R){return R.node}));if(r===w&&(a=z),j){var ce={pos:L,node:z,children:te};return M||n.push(ce),ce}return null}).filter(function(_){return _})}n||(n=[],g(i),n.sort(function(v,K){var M=v.node.props.value,_=K.node.props.value,N=l.indexOf(M),L=l.indexOf(_);return N-L}))}Object.defineProperty(e,"triggerNode",{get:function(){return Ze(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),u(),a}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return Ze(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),u(),o?n:n.map(function(v){var K=v.node;return K})}})}var Zr=function(r,l,i){var o=i.fieldNames,c=i.treeNodeFilterProp,a=i.filterTreeNode,n=o.children;return t.useMemo(function(){if(!l||a===!1)return r;var u=typeof a=="function"?a:function(v,K){return String(K[c]).toUpperCase().includes(l.toUpperCase())},g=function v(K){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return K.reduce(function(_,N){var L=N[n],w=M||u(l,or(N)),j=v(L||[],w);return(w||j.length)&&_.push(A(A({},N),{},Hr({isLeaf:void 0},n,j))),_},[])};return g(r)},[r,l,n,c,a])};function gr(e){var r=t.useRef();r.current=e;var l=t.useCallback(function(){return r.current.apply(r,arguments)},[]);return l}function et(e,r){var l=r.id,i=r.pId,o=r.rootPId,c=new Map,a=[];return e.forEach(function(n){var u=n[l],g=A(A({},n),{},{key:n.key||u});c.set(u,g)}),c.forEach(function(n){var u=n[i],g=c.get(u);g?(g.children=g.children||[],g.children.push(n)):(u===o||o===null)&&a.push(n)}),a}function rt(e,r,l){return t.useMemo(function(){if(e){if(l){var i=A({id:"id",pId:"pId",rootPId:null},Cr(l)==="object"?l:{});return et(e,i)}return e}return xr(r)},[r,l,e])}var Er=t.createContext(null),kr=t.createContext(null),tt={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},at=function(r,l){var i=Rr(),o=i.prefixCls,c=i.multiple,a=i.searchValue,n=i.toggleOpen,u=i.open,g=i.notFoundContent,v=t.useContext(kr),K=v.virtual,M=v.listHeight,_=v.listItemHeight,N=v.listItemScrollOffset,L=v.treeData,w=v.fieldNames,j=v.onSelect,te=v.dropdownMatchSelectWidth,z=v.treeExpandAction,ce=v.treeTitleRender,R=v.onPopupScroll,I=v.leftMaxCount,we=v.leafCountOnly,Q=v.valueEntities,b=t.useContext(Er),ae=b.checkable,V=b.checkedKeys,Ke=b.halfCheckedKeys,ne=b.treeExpandedKeys,Ie=b.treeDefaultExpandAll,Me=b.treeDefaultExpandedKeys,ye=b.onTreeExpand,Le=b.treeIcon,Te=b.showTreeIcon,Ne=b.switcherIcon,Ve=b.treeLine,Oe=b.treeNodeFilterProp,Pe=b.loadData,Ce=b.treeLoadedKeys,He=b.treeMotion,Ae=b.onTreeLoad,Re=b.keyEntities,le=t.useRef(),ie=vr(function(){return L},[u,L],function(h,s){return s[0]&&h[1]!==s[1]}),$e=t.useMemo(function(){return ae?{checked:V,halfChecked:Ke}:null},[ae,V,Ke]);t.useEffect(function(){if(u&&!c&&V.length){var h;(h=le.current)===null||h===void 0||h.scrollTo({key:V[0]})}},[u]);var de=function(s){s.preventDefault()},se=function(s,D){var S=D.node;ae&&ur(S)||(j(S.key,{selected:!V.includes(S.key)}),c||n(!1))},Fe=t.useState(Me),Se=B(Fe,2),fe=Se[0],We=Se[1],Y=t.useState(null),be=B(Y,2),je=be[0],Ue=be[1],ue=t.useMemo(function(){return ne?re(ne):a?je:fe},[fe,je,ne,a]),ve=function(s){We(s),Ue(s),ye&&ye(s)},xe=String(a).toLowerCase(),$=function(s){return xe?String(s[Oe]).toLowerCase().includes(xe):!1};t.useEffect(function(){a&&Ue(qr(L,w))},[a]);var rr=t.useState(function(){return new Map}),Ee=B(rr,2),G=Ee[0],tr=Ee[1];t.useEffect(function(){I&&tr(new Map)},[I]);function q(h){var s=h[w.value];if(!G.has(s)){var D=Q.get(s),S=(D.children||[]).length===0;if(S)G.set(s,!1);else{var x=D.children.filter(function(P){return!P.node.disabled&&!P.node.disableCheckbox&&!V.includes(P.node[w.value])}),W=x.length;G.set(s,W>I)}}return G.get(s)}var k=Pr(function(h){var s=h[w.value];return V.includes(s)||I===null?!1:I<=0?!0:we&&I?q(h):!1}),ar=function h(s){var D=Ar(s),S;try{for(D.s();!(S=D.n()).done;){var x=S.value;if(!(x.disabled||x.selectable===!1)){if(a){if($(x))return x}else return x;if(x[w.children]){var W=h(x[w.children]);if(W)return W}}}}catch(P){D.e(P)}finally{D.f()}return null},Be=t.useState(null),ke=B(Be,2),he=ke[0],Ge=ke[1],F=Re[he];t.useEffect(function(){if(u){var h=null,s=function(){var S=ar(ie);return S?S[w.value]:null};!c&&V.length&&!a?h=V[0]:h=s(),Ge(h)}},[u,a]),t.useImperativeHandle(l,function(){var h;return{scrollTo:(h=le.current)===null||h===void 0?void 0:h.scrollTo,onKeyDown:function(D){var S,x=D.which;switch(x){case me.UP:case me.DOWN:case me.LEFT:case me.RIGHT:(S=le.current)===null||S===void 0||S.onKeyDown(D);break;case me.ENTER:{if(F){var W=k(F.node),P=(F==null?void 0:F.node)||{},Ye=P.selectable,X=P.value,qe=P.disabled;Ye!==!1&&!qe&&!W&&se(null,{node:{key:he},selected:!V.includes(X)})}break}case me.ESC:n(!1)}},onKeyUp:function(){}}});var Je=vr(function(){return!a},[a,ne||fe],function(h,s){var D=B(h,1),S=D[0],x=B(s,2),W=x[0],P=x[1];return S!==W&&!!(W||P)}),T=Je?Pe:null;if(ie.length===0)return t.createElement("div",{role:"listbox",className:"".concat(o,"-empty"),onMouseDown:de},g);var O={fieldNames:w};return Ce&&(O.loadedKeys=Ce),ue&&(O.expandedKeys=ue),t.createElement("div",{onMouseDown:de},F&&u&&t.createElement("span",{style:tt,"aria-live":"assertive"},F.node.value),t.createElement(jr.Provider,{value:{nodeDisabled:k}},t.createElement(Ur,Sr({ref:le,focusable:!1,prefixCls:"".concat(o,"-tree"),treeData:ie,height:M,itemHeight:_,itemScrollOffset:N,virtual:K!==!1&&te!==!1,multiple:c,icon:Le,showIcon:Te,switcherIcon:Ne,showLine:Ve,loadData:T,motion:He,activeKey:he,checkable:ae,checkStrictly:!0,checkedKeys:$e,selectedKeys:ae?[]:V,defaultExpandAll:Ie,titleRender:ce},O,{onActiveChange:Ge,onSelect:se,onCheck:se,onExpand:ve,onLoad:Ae,filterTreeNode:$,expandAction:z,onScroll:R}))))},nt=t.forwardRef(at),Dr="SHOW_ALL",_r="SHOW_PARENT",cr="SHOW_CHILD";function mr(e,r,l,i){var o=new Set(e);return r===cr?e.filter(function(c){var a=l[c];return!a||!a.children||!a.children.some(function(n){var u=n.node;return o.has(u[i.value])})||!a.children.every(function(n){var u=n.node;return ur(u)||o.has(u[i.value])})}):r===_r?e.filter(function(c){var a=l[c],n=a?a.parent:null;return!n||ur(n.node)||!o.has(n.key)}):e}var lt=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","maxCount","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","listItemScrollOffset","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion","treeTitleRender","onPopupScroll"];function it(e){return!e||Cr(e)!=="object"}var ut=t.forwardRef(function(e,r){var l=e.id,i=e.prefixCls,o=i===void 0?"rc-tree-select":i,c=e.value,a=e.defaultValue,n=e.onChange,u=e.onSelect,g=e.onDeselect,v=e.searchValue,K=e.inputValue,M=e.onSearch,_=e.autoClearSearchValue,N=_===void 0?!0:_,L=e.filterTreeNode,w=e.treeNodeFilterProp,j=w===void 0?"value":w,te=e.showCheckedStrategy,z=e.treeNodeLabelProp,ce=e.multiple,R=e.treeCheckable,I=e.treeCheckStrictly,we=e.labelInValue,Q=e.maxCount,b=e.fieldNames,ae=e.treeDataSimpleMode,V=e.treeData,Ke=e.children,ne=e.loadData,Ie=e.treeLoadedKeys,Me=e.onTreeLoad,ye=e.treeDefaultExpandAll,Le=e.treeExpandedKeys,Te=e.treeDefaultExpandedKeys,Ne=e.onTreeExpand,Ve=e.treeExpandAction,Oe=e.virtual,Pe=e.listHeight,Ce=Pe===void 0?200:Pe,He=e.listItemHeight,Ae=He===void 0?20:He,Re=e.listItemScrollOffset,le=Re===void 0?0:Re,ie=e.onDropdownVisibleChange,$e=e.dropdownMatchSelectWidth,de=$e===void 0?!0:$e,se=e.treeLine,Fe=e.treeIcon,Se=e.showTreeIcon,fe=e.switcherIcon,We=e.treeMotion,Y=e.treeTitleRender,be=e.onPopupScroll,je=yr(e,lt),Ue=$r(l),ue=R&&!I,ve=R||I,xe=I||we,$=ve||ce,rr=hr(a,{value:c}),Ee=B(rr,2),G=Ee[0],tr=Ee[1],q=t.useMemo(function(){return R?te||cr:Dr},[te,R]),k=t.useMemo(function(){return Yr(b)},[JSON.stringify(b)]),ar=hr("",{value:v!==void 0?v:K,postState:function(d){return d||""}}),Be=B(ar,2),ke=Be[0],he=Be[1],Ge=function(d){he(d),M==null||M(d)},F=rt(V,Ke,ae),Je=zr(F,k),T=Je.keyEntities,O=Je.valueEntities,h=t.useCallback(function(f){var d=[],p=[];return f.forEach(function(m){O.has(m)?p.push(m):d.push(m)}),{missingRawValues:d,existRawValues:p}},[O]),s=Zr(F,ke,{fieldNames:k,treeNodeFilterProp:j,filterTreeNode:L}),D=t.useCallback(function(f){if(f){if(z)return f[z];for(var d=k._title,p=0;p<d.length;p+=1){var m=f[d[p]];if(m!==void 0)return m}}},[k,z]),S=t.useCallback(function(f){var d=Jr(f);return d.map(function(p){return it(p)?{value:p}:p})},[]),x=t.useCallback(function(f){var d=S(f);return d.map(function(p){var m=p.label,U=p.value,E=p.halfChecked,y,C=O.get(U);if(C){var H;m=Y?Y(C.node):(H=m)!==null&&H!==void 0?H:D(C.node),y=C.node.disabled}else if(m===void 0){var Z=S(G).find(function(De){return De.value===U});m=Z.label}return{label:m,value:U,halfChecked:E,disabled:y}})},[O,D,S,G]),W=t.useMemo(function(){return S(G===null?[]:G)},[S,G]),P=t.useMemo(function(){var f=[],d=[];return W.forEach(function(p){p.halfChecked?d.push(p):f.push(p)}),[f,d]},[W]),Ye=B(P,2),X=Ye[0],qe=Ye[1],dr=t.useMemo(function(){return X.map(function(f){return f.value})},[X]),wr=Gr(X,qe,ue,T),sr=B(wr,2),pe=sr[0],ze=sr[1],Kr=t.useMemo(function(){var f=mr(pe,q,T,k),d=f.map(function(E){var y,C;return(y=(C=T[E])===null||C===void 0||(C=C.node)===null||C===void 0?void 0:C[k.value])!==null&&y!==void 0?y:E}),p=d.map(function(E){var y=X.find(function(H){return H.value===E}),C=we?y==null?void 0:y.label:Y==null?void 0:Y(y);return{value:E,label:C}}),m=x(p),U=m[0];return!$&&U&&pr(U.value)&&pr(U.label)?[]:m.map(function(E){var y;return A(A({},E),{},{label:(y=E.label)!==null&&y!==void 0?y:E.value})})},[k,$,pe,X,x,q,T]),Ir=Br(Kr),Mr=B(Ir,1),nr=Mr[0],fr=t.useMemo(function(){return $&&(q==="SHOW_CHILD"||I||!R)?Q:null},[Q,$,I,q,R]),Qe=gr(function(f,d,p){var m=mr(f,q,T,k);if(!(fr&&m.length>fr)){var U=x(f);if(tr(U),N&&he(""),n){var E=f;ue&&(E=m.map(function(J){var ee=O.get(J);return ee?ee.node[k.value]:J}));var y=d||{triggerValue:void 0,selected:void 0},C=y.triggerValue,H=y.selected,Z=E;if(I){var De=qe.filter(function(J){return!E.includes(J.value)});Z=[].concat(re(Z),re(De))}var _e=x(Z),oe={preValue:X,triggerValue:C},ge=!0;(I||p==="selection"&&!H)&&(ge=!1),Xr(oe,C,f,F,ge,k),ve?oe.checked=H:oe.selected=H;var Xe=xe?_e:_e.map(function(J){return J.value});n($?Xe:Xe[0],xe?null:_e.map(function(J){return J.label}),oe)}}}),lr=t.useCallback(function(f,d){var p,m=d.selected,U=d.source,E=T[f],y=E==null?void 0:E.node,C=(p=y==null?void 0:y[k.value])!==null&&p!==void 0?p:f;if(!$)Qe([C],{selected:!0,triggerValue:C},"option");else{var H=m?[].concat(re(dr),[C]):pe.filter(function(ee){return ee!==C});if(ue){var Z=h(H),De=Z.missingRawValues,_e=Z.existRawValues,oe=_e.map(function(ee){return O.get(ee).key}),ge;if(m){var Xe=ir(oe,!0,T);ge=Xe.checkedKeys}else{var J=ir(oe,{halfCheckedKeys:ze},T);ge=J.checkedKeys}H=[].concat(re(De),re(ge.map(function(ee){return T[ee].node[k.value]})))}Qe(H,{selected:m,triggerValue:C},U||"option")}m||!$?u==null||u(C,or(y)):g==null||g(C,or(y))},[h,O,T,k,$,dr,Qe,ue,u,g,pe,ze,Q]),Lr=t.useCallback(function(f){if(ie){var d={};Object.defineProperty(d,"documentClickClose",{get:function(){return Ze(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),ie(f,d)}},[ie]),Tr=gr(function(f,d){var p=f.map(function(m){return m.value});if(d.type==="clear"){Qe(p,{},"selection");return}d.values.length&&lr(d.values[0].value,{selected:!1,source:"selection"})}),Nr=t.useMemo(function(){return{virtual:Oe,dropdownMatchSelectWidth:de,listHeight:Ce,listItemHeight:Ae,listItemScrollOffset:le,treeData:s,fieldNames:k,onSelect:lr,treeExpandAction:Ve,treeTitleRender:Y,onPopupScroll:be,leftMaxCount:Q===void 0?null:Q-nr.length,leafCountOnly:q==="SHOW_CHILD"&&!I&&!!R,valueEntities:O}},[Oe,de,Ce,Ae,le,s,k,lr,Ve,Y,be,Q,nr.length,q,I,R,O]),Vr=t.useMemo(function(){return{checkable:ve,loadData:ne,treeLoadedKeys:Ie,onTreeLoad:Me,checkedKeys:pe,halfCheckedKeys:ze,treeDefaultExpandAll:ye,treeExpandedKeys:Le,treeDefaultExpandedKeys:Te,onTreeExpand:Ne,treeIcon:Fe,treeMotion:We,showTreeIcon:Se,switcherIcon:fe,treeLine:se,treeNodeFilterProp:j,keyEntities:T}},[ve,ne,Ie,Me,pe,ze,ye,Le,Te,Ne,Fe,We,Se,fe,se,j,T]);return t.createElement(kr.Provider,{value:Nr},t.createElement(Er.Provider,{value:Vr},t.createElement(Fr,Sr({ref:r},je,{id:Ue,prefixCls:o,mode:$?"multiple":void 0,displayValues:nr,onDisplayValuesChange:Tr,searchValue:ke,onSearch:Ge,OptionList:nt,emptyOptions:!F.length,onDropdownVisibleChange:Lr,dropdownMatchSelectWidth:de}))))}),er=ut;er.TreeNode=br;er.SHOW_ALL=Dr;er.SHOW_PARENT=_r;er.SHOW_CHILD=cr;export{er as G,Dr as S,br as T,_r as a,cr as b};
//# sourceMappingURL=rc-tree-select-BHlP8Nzj.js.map
